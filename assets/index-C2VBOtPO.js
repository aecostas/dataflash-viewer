(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))i(n);new MutationObserver(n=>{for(const a of n)if(a.type==="childList")for(const s of a.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&i(s)}).observe(document,{childList:!0,subtree:!0});function t(n){const a={};return n.integrity&&(a.integrity=n.integrity),n.referrerPolicy&&(a.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?a.credentials="include":n.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function i(n){if(n.ep)return;n.ep=!0;const a=t(n);fetch(n.href,a)}})();function gD(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}var EM={exports:{}},Ax={};/**
 * @license React
 * react-jsx-runtime.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var LO;function CZ(){if(LO)return Ax;LO=1;var r=Symbol.for("react.transitional.element"),e=Symbol.for("react.fragment");function t(i,n,a){var s=null;if(a!==void 0&&(s=""+a),n.key!==void 0&&(s=""+n.key),"key"in n){a={};for(var o in n)o!=="key"&&(a[o]=n[o])}else a=n;return n=a.ref,{$$typeof:r,type:i,key:s,ref:n!==void 0?n:null,props:a}}return Ax.Fragment=e,Ax.jsx=t,Ax.jsxs=t,Ax}var OO;function MZ(){return OO||(OO=1,EM.exports=CZ()),EM.exports}var pn=MZ(),IM={exports:{}},ri={};/**
 * @license React
 * react.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var NO;function EZ(){if(NO)return ri;NO=1;var r=Symbol.for("react.transitional.element"),e=Symbol.for("react.portal"),t=Symbol.for("react.fragment"),i=Symbol.for("react.strict_mode"),n=Symbol.for("react.profiler"),a=Symbol.for("react.consumer"),s=Symbol.for("react.context"),o=Symbol.for("react.forward_ref"),l=Symbol.for("react.suspense"),c=Symbol.for("react.memo"),f=Symbol.for("react.lazy"),p=Symbol.for("react.activity"),y=Symbol.iterator;function b(xe){return xe===null||typeof xe!="object"?null:(xe=y&&xe[y]||xe["@@iterator"],typeof xe=="function"?xe:null)}var S={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},C=Object.assign,E={};function P(xe,$e,pt){this.props=xe,this.context=$e,this.refs=E,this.updater=pt||S}P.prototype.isReactComponent={},P.prototype.setState=function(xe,$e){if(typeof xe!="object"&&typeof xe!="function"&&xe!=null)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,xe,$e,"setState")},P.prototype.forceUpdate=function(xe){this.updater.enqueueForceUpdate(this,xe,"forceUpdate")};function O(){}O.prototype=P.prototype;function B(xe,$e,pt){this.props=xe,this.context=$e,this.refs=E,this.updater=pt||S}var F=B.prototype=new O;F.constructor=B,C(F,P.prototype),F.isPureReactComponent=!0;var W=Array.isArray;function $(){}var q={H:null,A:null,T:null,S:null},Q=Object.prototype.hasOwnProperty;function ee(xe,$e,pt){var _t=pt.ref;return{$$typeof:r,type:xe,key:$e,ref:_t!==void 0?_t:null,props:pt}}function te(xe,$e){return ee(xe.type,$e,xe.props)}function ae(xe){return typeof xe=="object"&&xe!==null&&xe.$$typeof===r}function de(xe){var $e={"=":"=0",":":"=2"};return"$"+xe.replace(/[=:]/g,function(pt){return $e[pt]})}var ve=/\/+/g;function ye(xe,$e){return typeof xe=="object"&&xe!==null&&xe.key!=null?de(""+xe.key):$e.toString(36)}function Ae(xe){switch(xe.status){case"fulfilled":return xe.value;case"rejected":throw xe.reason;default:switch(typeof xe.status=="string"?xe.then($,$):(xe.status="pending",xe.then(function($e){xe.status==="pending"&&(xe.status="fulfilled",xe.value=$e)},function($e){xe.status==="pending"&&(xe.status="rejected",xe.reason=$e)})),xe.status){case"fulfilled":return xe.value;case"rejected":throw xe.reason}}throw xe}function me(xe,$e,pt,_t,Dt){var qt=typeof xe;(qt==="undefined"||qt==="boolean")&&(xe=null);var _r=!1;if(xe===null)_r=!0;else switch(qt){case"bigint":case"string":case"number":_r=!0;break;case"object":switch(xe.$$typeof){case r:case e:_r=!0;break;case f:return _r=xe._init,me(_r(xe._payload),$e,pt,_t,Dt)}}if(_r)return Dt=Dt(xe),_r=_t===""?"."+ye(xe,0):_t,W(Dt)?(pt="",_r!=null&&(pt=_r.replace(ve,"$&/")+"/"),me(Dt,$e,pt,"",function(yr){return yr})):Dt!=null&&(ae(Dt)&&(Dt=te(Dt,pt+(Dt.key==null||xe&&xe.key===Dt.key?"":(""+Dt.key).replace(ve,"$&/")+"/")+_r)),$e.push(Dt)),1;_r=0;var Kt=_t===""?".":_t+":";if(W(xe))for(var zt=0;zt<xe.length;zt++)_t=xe[zt],qt=Kt+ye(_t,zt),_r+=me(_t,$e,pt,qt,Dt);else if(zt=b(xe),typeof zt=="function")for(xe=zt.call(xe),zt=0;!(_t=xe.next()).done;)_t=_t.value,qt=Kt+ye(_t,zt++),_r+=me(_t,$e,pt,qt,Dt);else if(qt==="object"){if(typeof xe.then=="function")return me(Ae(xe),$e,pt,_t,Dt);throw $e=String(xe),Error("Objects are not valid as a React child (found: "+($e==="[object Object]"?"object with keys {"+Object.keys(xe).join(", ")+"}":$e)+"). If you meant to render a collection of children, use an array instead.")}return _r}function De(xe,$e,pt){if(xe==null)return xe;var _t=[],Dt=0;return me(xe,_t,"","",function(qt){return $e.call(pt,qt,Dt++)}),_t}function Fe(xe){if(xe._status===-1){var $e=xe._result;$e=$e(),$e.then(function(pt){(xe._status===0||xe._status===-1)&&(xe._status=1,xe._result=pt)},function(pt){(xe._status===0||xe._status===-1)&&(xe._status=2,xe._result=pt)}),xe._status===-1&&(xe._status=0,xe._result=$e)}if(xe._status===1)return xe._result.default;throw xe._result}var je=typeof reportError=="function"?reportError:function(xe){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var $e=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof xe=="object"&&xe!==null&&typeof xe.message=="string"?String(xe.message):String(xe),error:xe});if(!window.dispatchEvent($e))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",xe);return}console.error(xe)},ct={map:De,forEach:function(xe,$e,pt){De(xe,function(){$e.apply(this,arguments)},pt)},count:function(xe){var $e=0;return De(xe,function(){$e++}),$e},toArray:function(xe){return De(xe,function($e){return $e})||[]},only:function(xe){if(!ae(xe))throw Error("React.Children.only expected to receive a single React element child.");return xe}};return ri.Activity=p,ri.Children=ct,ri.Component=P,ri.Fragment=t,ri.Profiler=n,ri.PureComponent=B,ri.StrictMode=i,ri.Suspense=l,ri.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=q,ri.__COMPILER_RUNTIME={__proto__:null,c:function(xe){return q.H.useMemoCache(xe)}},ri.cache=function(xe){return function(){return xe.apply(null,arguments)}},ri.cacheSignal=function(){return null},ri.cloneElement=function(xe,$e,pt){if(xe==null)throw Error("The argument must be a React element, but you passed "+xe+".");var _t=C({},xe.props),Dt=xe.key;if($e!=null)for(qt in $e.key!==void 0&&(Dt=""+$e.key),$e)!Q.call($e,qt)||qt==="key"||qt==="__self"||qt==="__source"||qt==="ref"&&$e.ref===void 0||(_t[qt]=$e[qt]);var qt=arguments.length-2;if(qt===1)_t.children=pt;else if(1<qt){for(var _r=Array(qt),Kt=0;Kt<qt;Kt++)_r[Kt]=arguments[Kt+2];_t.children=_r}return ee(xe.type,Dt,_t)},ri.createContext=function(xe){return xe={$$typeof:s,_currentValue:xe,_currentValue2:xe,_threadCount:0,Provider:null,Consumer:null},xe.Provider=xe,xe.Consumer={$$typeof:a,_context:xe},xe},ri.createElement=function(xe,$e,pt){var _t,Dt={},qt=null;if($e!=null)for(_t in $e.key!==void 0&&(qt=""+$e.key),$e)Q.call($e,_t)&&_t!=="key"&&_t!=="__self"&&_t!=="__source"&&(Dt[_t]=$e[_t]);var _r=arguments.length-2;if(_r===1)Dt.children=pt;else if(1<_r){for(var Kt=Array(_r),zt=0;zt<_r;zt++)Kt[zt]=arguments[zt+2];Dt.children=Kt}if(xe&&xe.defaultProps)for(_t in _r=xe.defaultProps,_r)Dt[_t]===void 0&&(Dt[_t]=_r[_t]);return ee(xe,qt,Dt)},ri.createRef=function(){return{current:null}},ri.forwardRef=function(xe){return{$$typeof:o,render:xe}},ri.isValidElement=ae,ri.lazy=function(xe){return{$$typeof:f,_payload:{_status:-1,_result:xe},_init:Fe}},ri.memo=function(xe,$e){return{$$typeof:c,type:xe,compare:$e===void 0?null:$e}},ri.startTransition=function(xe){var $e=q.T,pt={};q.T=pt;try{var _t=xe(),Dt=q.S;Dt!==null&&Dt(pt,_t),typeof _t=="object"&&_t!==null&&typeof _t.then=="function"&&_t.then($,je)}catch(qt){je(qt)}finally{$e!==null&&pt.types!==null&&($e.types=pt.types),q.T=$e}},ri.unstable_useCacheRefresh=function(){return q.H.useCacheRefresh()},ri.use=function(xe){return q.H.use(xe)},ri.useActionState=function(xe,$e,pt){return q.H.useActionState(xe,$e,pt)},ri.useCallback=function(xe,$e){return q.H.useCallback(xe,$e)},ri.useContext=function(xe){return q.H.useContext(xe)},ri.useDebugValue=function(){},ri.useDeferredValue=function(xe,$e){return q.H.useDeferredValue(xe,$e)},ri.useEffect=function(xe,$e){return q.H.useEffect(xe,$e)},ri.useEffectEvent=function(xe){return q.H.useEffectEvent(xe)},ri.useId=function(){return q.H.useId()},ri.useImperativeHandle=function(xe,$e,pt){return q.H.useImperativeHandle(xe,$e,pt)},ri.useInsertionEffect=function(xe,$e){return q.H.useInsertionEffect(xe,$e)},ri.useLayoutEffect=function(xe,$e){return q.H.useLayoutEffect(xe,$e)},ri.useMemo=function(xe,$e){return q.H.useMemo(xe,$e)},ri.useOptimistic=function(xe,$e){return q.H.useOptimistic(xe,$e)},ri.useReducer=function(xe,$e,pt){return q.H.useReducer(xe,$e,pt)},ri.useRef=function(xe){return q.H.useRef(xe)},ri.useState=function(xe){return q.H.useState(xe)},ri.useSyncExternalStore=function(xe,$e,pt){return q.H.useSyncExternalStore(xe,$e,pt)},ri.useTransition=function(){return q.H.useTransition()},ri.version="19.2.0",ri}var BO;function vD(){return BO||(BO=1,IM.exports=EZ()),IM.exports}var so=vD();const IZ=gD(so);var PM={exports:{}},Cx={},RM={exports:{}},DM={};/**
 * @license React
 * scheduler.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var zO;function PZ(){return zO||(zO=1,(function(r){function e(me,De){var Fe=me.length;me.push(De);e:for(;0<Fe;){var je=Fe-1>>>1,ct=me[je];if(0<n(ct,De))me[je]=De,me[Fe]=ct,Fe=je;else break e}}function t(me){return me.length===0?null:me[0]}function i(me){if(me.length===0)return null;var De=me[0],Fe=me.pop();if(Fe!==De){me[0]=Fe;e:for(var je=0,ct=me.length,xe=ct>>>1;je<xe;){var $e=2*(je+1)-1,pt=me[$e],_t=$e+1,Dt=me[_t];if(0>n(pt,Fe))_t<ct&&0>n(Dt,pt)?(me[je]=Dt,me[_t]=Fe,je=_t):(me[je]=pt,me[$e]=Fe,je=$e);else if(_t<ct&&0>n(Dt,Fe))me[je]=Dt,me[_t]=Fe,je=_t;else break e}}return De}function n(me,De){var Fe=me.sortIndex-De.sortIndex;return Fe!==0?Fe:me.id-De.id}if(r.unstable_now=void 0,typeof performance=="object"&&typeof performance.now=="function"){var a=performance;r.unstable_now=function(){return a.now()}}else{var s=Date,o=s.now();r.unstable_now=function(){return s.now()-o}}var l=[],c=[],f=1,p=null,y=3,b=!1,S=!1,C=!1,E=!1,P=typeof setTimeout=="function"?setTimeout:null,O=typeof clearTimeout=="function"?clearTimeout:null,B=typeof setImmediate<"u"?setImmediate:null;function F(me){for(var De=t(c);De!==null;){if(De.callback===null)i(c);else if(De.startTime<=me)i(c),De.sortIndex=De.expirationTime,e(l,De);else break;De=t(c)}}function W(me){if(C=!1,F(me),!S)if(t(l)!==null)S=!0,$||($=!0,de());else{var De=t(c);De!==null&&Ae(W,De.startTime-me)}}var $=!1,q=-1,Q=5,ee=-1;function te(){return E?!0:!(r.unstable_now()-ee<Q)}function ae(){if(E=!1,$){var me=r.unstable_now();ee=me;var De=!0;try{e:{S=!1,C&&(C=!1,O(q),q=-1),b=!0;var Fe=y;try{t:{for(F(me),p=t(l);p!==null&&!(p.expirationTime>me&&te());){var je=p.callback;if(typeof je=="function"){p.callback=null,y=p.priorityLevel;var ct=je(p.expirationTime<=me);if(me=r.unstable_now(),typeof ct=="function"){p.callback=ct,F(me),De=!0;break t}p===t(l)&&i(l),F(me)}else i(l);p=t(l)}if(p!==null)De=!0;else{var xe=t(c);xe!==null&&Ae(W,xe.startTime-me),De=!1}}break e}finally{p=null,y=Fe,b=!1}De=void 0}}finally{De?de():$=!1}}}var de;if(typeof B=="function")de=function(){B(ae)};else if(typeof MessageChannel<"u"){var ve=new MessageChannel,ye=ve.port2;ve.port1.onmessage=ae,de=function(){ye.postMessage(null)}}else de=function(){P(ae,0)};function Ae(me,De){q=P(function(){me(r.unstable_now())},De)}r.unstable_IdlePriority=5,r.unstable_ImmediatePriority=1,r.unstable_LowPriority=4,r.unstable_NormalPriority=3,r.unstable_Profiling=null,r.unstable_UserBlockingPriority=2,r.unstable_cancelCallback=function(me){me.callback=null},r.unstable_forceFrameRate=function(me){0>me||125<me?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):Q=0<me?Math.floor(1e3/me):5},r.unstable_getCurrentPriorityLevel=function(){return y},r.unstable_next=function(me){switch(y){case 1:case 2:case 3:var De=3;break;default:De=y}var Fe=y;y=De;try{return me()}finally{y=Fe}},r.unstable_requestPaint=function(){E=!0},r.unstable_runWithPriority=function(me,De){switch(me){case 1:case 2:case 3:case 4:case 5:break;default:me=3}var Fe=y;y=me;try{return De()}finally{y=Fe}},r.unstable_scheduleCallback=function(me,De,Fe){var je=r.unstable_now();switch(typeof Fe=="object"&&Fe!==null?(Fe=Fe.delay,Fe=typeof Fe=="number"&&0<Fe?je+Fe:je):Fe=je,me){case 1:var ct=-1;break;case 2:ct=250;break;case 5:ct=1073741823;break;case 4:ct=1e4;break;default:ct=5e3}return ct=Fe+ct,me={id:f++,callback:De,priorityLevel:me,startTime:Fe,expirationTime:ct,sortIndex:-1},Fe>je?(me.sortIndex=Fe,e(c,me),t(l)===null&&me===t(c)&&(C?(O(q),q=-1):C=!0,Ae(W,Fe-je))):(me.sortIndex=ct,e(l,me),S||b||(S=!0,$||($=!0,de()))),me},r.unstable_shouldYield=te,r.unstable_wrapCallback=function(me){var De=y;return function(){var Fe=y;y=De;try{return me.apply(this,arguments)}finally{y=Fe}}}})(DM)),DM}var FO;function RZ(){return FO||(FO=1,RM.exports=PZ()),RM.exports}var kM={exports:{}},ys={};/**
 * @license React
 * react-dom.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var VO;function DZ(){if(VO)return ys;VO=1;var r=vD();function e(l){var c="https://react.dev/errors/"+l;if(1<arguments.length){c+="?args[]="+encodeURIComponent(arguments[1]);for(var f=2;f<arguments.length;f++)c+="&args[]="+encodeURIComponent(arguments[f])}return"Minified React error #"+l+"; visit "+c+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function t(){}var i={d:{f:t,r:function(){throw Error(e(522))},D:t,C:t,L:t,m:t,X:t,S:t,M:t},p:0,findDOMNode:null},n=Symbol.for("react.portal");function a(l,c,f){var p=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:n,key:p==null?null:""+p,children:l,containerInfo:c,implementation:f}}var s=r.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;function o(l,c){if(l==="font")return"";if(typeof c=="string")return c==="use-credentials"?c:""}return ys.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=i,ys.createPortal=function(l,c){var f=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!c||c.nodeType!==1&&c.nodeType!==9&&c.nodeType!==11)throw Error(e(299));return a(l,c,null,f)},ys.flushSync=function(l){var c=s.T,f=i.p;try{if(s.T=null,i.p=2,l)return l()}finally{s.T=c,i.p=f,i.d.f()}},ys.preconnect=function(l,c){typeof l=="string"&&(c?(c=c.crossOrigin,c=typeof c=="string"?c==="use-credentials"?c:"":void 0):c=null,i.d.C(l,c))},ys.prefetchDNS=function(l){typeof l=="string"&&i.d.D(l)},ys.preinit=function(l,c){if(typeof l=="string"&&c&&typeof c.as=="string"){var f=c.as,p=o(f,c.crossOrigin),y=typeof c.integrity=="string"?c.integrity:void 0,b=typeof c.fetchPriority=="string"?c.fetchPriority:void 0;f==="style"?i.d.S(l,typeof c.precedence=="string"?c.precedence:void 0,{crossOrigin:p,integrity:y,fetchPriority:b}):f==="script"&&i.d.X(l,{crossOrigin:p,integrity:y,fetchPriority:b,nonce:typeof c.nonce=="string"?c.nonce:void 0})}},ys.preinitModule=function(l,c){if(typeof l=="string")if(typeof c=="object"&&c!==null){if(c.as==null||c.as==="script"){var f=o(c.as,c.crossOrigin);i.d.M(l,{crossOrigin:f,integrity:typeof c.integrity=="string"?c.integrity:void 0,nonce:typeof c.nonce=="string"?c.nonce:void 0})}}else c==null&&i.d.M(l)},ys.preload=function(l,c){if(typeof l=="string"&&typeof c=="object"&&c!==null&&typeof c.as=="string"){var f=c.as,p=o(f,c.crossOrigin);i.d.L(l,f,{crossOrigin:p,integrity:typeof c.integrity=="string"?c.integrity:void 0,nonce:typeof c.nonce=="string"?c.nonce:void 0,type:typeof c.type=="string"?c.type:void 0,fetchPriority:typeof c.fetchPriority=="string"?c.fetchPriority:void 0,referrerPolicy:typeof c.referrerPolicy=="string"?c.referrerPolicy:void 0,imageSrcSet:typeof c.imageSrcSet=="string"?c.imageSrcSet:void 0,imageSizes:typeof c.imageSizes=="string"?c.imageSizes:void 0,media:typeof c.media=="string"?c.media:void 0})}},ys.preloadModule=function(l,c){if(typeof l=="string")if(c){var f=o(c.as,c.crossOrigin);i.d.m(l,{as:typeof c.as=="string"&&c.as!=="script"?c.as:void 0,crossOrigin:f,integrity:typeof c.integrity=="string"?c.integrity:void 0})}else i.d.m(l)},ys.requestFormReset=function(l){i.d.r(l)},ys.unstable_batchedUpdates=function(l,c){return l(c)},ys.useFormState=function(l,c,f){return s.H.useFormState(l,c,f)},ys.useFormStatus=function(){return s.H.useHostTransitionStatus()},ys.version="19.2.0",ys}var UO;function kZ(){if(UO)return kM.exports;UO=1;function r(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(r)}catch(e){console.error(e)}}return r(),kM.exports=DZ(),kM.exports}/**
 * @license React
 * react-dom-client.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var HO;function LZ(){if(HO)return Cx;HO=1;var r=RZ(),e=vD(),t=kZ();function i(d){var _="https://react.dev/errors/"+d;if(1<arguments.length){_+="?args[]="+encodeURIComponent(arguments[1]);for(var T=2;T<arguments.length;T++)_+="&args[]="+encodeURIComponent(arguments[T])}return"Minified React error #"+d+"; visit "+_+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function n(d){return!(!d||d.nodeType!==1&&d.nodeType!==9&&d.nodeType!==11)}function a(d){var _=d,T=d;if(d.alternate)for(;_.return;)_=_.return;else{d=_;do _=d,(_.flags&4098)!==0&&(T=_.return),d=_.return;while(d)}return _.tag===3?T:null}function s(d){if(d.tag===13){var _=d.memoizedState;if(_===null&&(d=d.alternate,d!==null&&(_=d.memoizedState)),_!==null)return _.dehydrated}return null}function o(d){if(d.tag===31){var _=d.memoizedState;if(_===null&&(d=d.alternate,d!==null&&(_=d.memoizedState)),_!==null)return _.dehydrated}return null}function l(d){if(a(d)!==d)throw Error(i(188))}function c(d){var _=d.alternate;if(!_){if(_=a(d),_===null)throw Error(i(188));return _!==d?null:d}for(var T=d,D=_;;){var U=T.return;if(U===null)break;var G=U.alternate;if(G===null){if(D=U.return,D!==null){T=D;continue}break}if(U.child===G.child){for(G=U.child;G;){if(G===T)return l(U),d;if(G===D)return l(U),_;G=G.sibling}throw Error(i(188))}if(T.return!==D.return)T=U,D=G;else{for(var ne=!1,_e=U.child;_e;){if(_e===T){ne=!0,T=U,D=G;break}if(_e===D){ne=!0,D=U,T=G;break}_e=_e.sibling}if(!ne){for(_e=G.child;_e;){if(_e===T){ne=!0,T=G,D=U;break}if(_e===D){ne=!0,D=G,T=U;break}_e=_e.sibling}if(!ne)throw Error(i(189))}}if(T.alternate!==D)throw Error(i(190))}if(T.tag!==3)throw Error(i(188));return T.stateNode.current===T?d:_}function f(d){var _=d.tag;if(_===5||_===26||_===27||_===6)return d;for(d=d.child;d!==null;){if(_=f(d),_!==null)return _;d=d.sibling}return null}var p=Object.assign,y=Symbol.for("react.element"),b=Symbol.for("react.transitional.element"),S=Symbol.for("react.portal"),C=Symbol.for("react.fragment"),E=Symbol.for("react.strict_mode"),P=Symbol.for("react.profiler"),O=Symbol.for("react.consumer"),B=Symbol.for("react.context"),F=Symbol.for("react.forward_ref"),W=Symbol.for("react.suspense"),$=Symbol.for("react.suspense_list"),q=Symbol.for("react.memo"),Q=Symbol.for("react.lazy"),ee=Symbol.for("react.activity"),te=Symbol.for("react.memo_cache_sentinel"),ae=Symbol.iterator;function de(d){return d===null||typeof d!="object"?null:(d=ae&&d[ae]||d["@@iterator"],typeof d=="function"?d:null)}var ve=Symbol.for("react.client.reference");function ye(d){if(d==null)return null;if(typeof d=="function")return d.$$typeof===ve?null:d.displayName||d.name||null;if(typeof d=="string")return d;switch(d){case C:return"Fragment";case P:return"Profiler";case E:return"StrictMode";case W:return"Suspense";case $:return"SuspenseList";case ee:return"Activity"}if(typeof d=="object")switch(d.$$typeof){case S:return"Portal";case B:return d.displayName||"Context";case O:return(d._context.displayName||"Context")+".Consumer";case F:var _=d.render;return d=d.displayName,d||(d=_.displayName||_.name||"",d=d!==""?"ForwardRef("+d+")":"ForwardRef"),d;case q:return _=d.displayName||null,_!==null?_:ye(d.type)||"Memo";case Q:_=d._payload,d=d._init;try{return ye(d(_))}catch{}}return null}var Ae=Array.isArray,me=e.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,De=t.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,Fe={pending:!1,data:null,method:null,action:null},je=[],ct=-1;function xe(d){return{current:d}}function $e(d){0>ct||(d.current=je[ct],je[ct]=null,ct--)}function pt(d,_){ct++,je[ct]=d.current,d.current=_}var _t=xe(null),Dt=xe(null),qt=xe(null),_r=xe(null);function Kt(d,_){switch(pt(qt,_),pt(Dt,d),pt(_t,null),_.nodeType){case 9:case 11:d=(d=_.documentElement)&&(d=d.namespaceURI)?px(d):0;break;default:if(d=_.tagName,_=_.namespaceURI)_=px(_),d=hh(_,d);else switch(d){case"svg":d=1;break;case"math":d=2;break;default:d=0}}$e(_t),pt(_t,d)}function zt(){$e(_t),$e(Dt),$e(qt)}function yr(d){d.memoizedState!==null&&pt(_r,d);var _=_t.current,T=hh(_,d.type);_!==T&&(pt(Dt,d),pt(_t,T))}function Gt(d){Dt.current===d&&($e(_t),$e(Dt)),_r.current===d&&($e(_r),gt._currentValue=Fe)}var Jt,Tr;function dr(d){if(Jt===void 0)try{throw Error()}catch(T){var _=T.stack.trim().match(/\n( *(at )?)/);Jt=_&&_[1]||"",Tr=-1<T.stack.indexOf(`
    at`)?" (<anonymous>)":-1<T.stack.indexOf("@")?"@unknown:0:0":""}return`
`+Jt+d+Tr}var $r=!1;function ii(d,_){if(!d||$r)return"";$r=!0;var T=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var D={DetermineComponentFrameRoot:function(){try{if(_){var Pt=function(){throw Error()};if(Object.defineProperty(Pt.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(Pt,[])}catch(bt){var vt=bt}Reflect.construct(d,[],Pt)}else{try{Pt.call()}catch(bt){vt=bt}d.call(Pt.prototype)}}else{try{throw Error()}catch(bt){vt=bt}(Pt=d())&&typeof Pt.catch=="function"&&Pt.catch(function(){})}}catch(bt){if(bt&&vt&&typeof bt.stack=="string")return[bt.stack,vt.stack]}return[null,null]}};D.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var U=Object.getOwnPropertyDescriptor(D.DetermineComponentFrameRoot,"name");U&&U.configurable&&Object.defineProperty(D.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var G=D.DetermineComponentFrameRoot(),ne=G[0],_e=G[1];if(ne&&_e){var Ue=ne.split(`
`),dt=_e.split(`
`);for(U=D=0;D<Ue.length&&!Ue[D].includes("DetermineComponentFrameRoot");)D++;for(;U<dt.length&&!dt[U].includes("DetermineComponentFrameRoot");)U++;if(D===Ue.length||U===dt.length)for(D=Ue.length-1,U=dt.length-1;1<=D&&0<=U&&Ue[D]!==dt[U];)U--;for(;1<=D&&0<=U;D--,U--)if(Ue[D]!==dt[U]){if(D!==1||U!==1)do if(D--,U--,0>U||Ue[D]!==dt[U]){var At=`
`+Ue[D].replace(" at new "," at ");return d.displayName&&At.includes("<anonymous>")&&(At=At.replace("<anonymous>",d.displayName)),At}while(1<=D&&0<=U);break}}}finally{$r=!1,Error.prepareStackTrace=T}return(T=d?d.displayName||d.name:"")?dr(T):""}function Zi(d,_){switch(d.tag){case 26:case 27:case 5:return dr(d.type);case 16:return dr("Lazy");case 13:return d.child!==_&&_!==null?dr("Suspense Fallback"):dr("Suspense");case 19:return dr("SuspenseList");case 0:case 15:return ii(d.type,!1);case 11:return ii(d.type.render,!1);case 1:return ii(d.type,!0);case 31:return dr("Activity");default:return""}}function In(d){try{var _="",T=null;do _+=Zi(d,T),T=d,d=d.return;while(d);return _}catch(D){return`
Error generating stack: `+D.message+`
`+D.stack}}var Li=Object.prototype.hasOwnProperty,Oa=r.unstable_scheduleCallback,Na=r.unstable_cancelCallback,Ls=r.unstable_shouldYield,vo=r.unstable_requestPaint,ea=r.unstable_now,Zf=r.unstable_getCurrentPriorityLevel,Do=r.unstable_ImmediatePriority,Ll=r.unstable_UserBlockingPriority,Ya=r.unstable_NormalPriority,Ge=r.unstable_LowPriority,he=r.unstable_IdlePriority,fe=r.log,we=r.unstable_setDisableYieldValue,Ne=null,Be=null;function We(d){if(typeof fe=="function"&&we(d),Be&&typeof Be.setStrictMode=="function")try{Be.setStrictMode(Ne,d)}catch{}}var it=Math.clz32?Math.clz32:kt,Ke=Math.log,yt=Math.LN2;function kt(d){return d>>>=0,d===0?32:31-(Ke(d)/yt|0)|0}var St=256,rr=262144,pr=4194304;function Qe(d){var _=d&42;if(_!==0)return _;switch(d&-d){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:return 128;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:return d&261888;case 262144:case 524288:case 1048576:case 2097152:return d&3932160;case 4194304:case 8388608:case 16777216:case 33554432:return d&62914560;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return d}}function Kr(d,_,T){var D=d.pendingLanes;if(D===0)return 0;var U=0,G=d.suspendedLanes,ne=d.pingedLanes;d=d.warmLanes;var _e=D&134217727;return _e!==0?(D=_e&~G,D!==0?U=Qe(D):(ne&=_e,ne!==0?U=Qe(ne):T||(T=_e&~d,T!==0&&(U=Qe(T))))):(_e=D&~G,_e!==0?U=Qe(_e):ne!==0?U=Qe(ne):T||(T=D&~d,T!==0&&(U=Qe(T)))),U===0?0:_!==0&&_!==U&&(_&G)===0&&(G=U&-U,T=_&-_,G>=T||G===32&&(T&4194048)!==0)?_:U}function pi(d,_){return(d.pendingLanes&~(d.suspendedLanes&~d.pingedLanes)&_)===0}function or(d,_){switch(d){case 1:case 2:case 4:case 8:case 64:return _+250;case 16:case 32:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return _+5e3;case 4194304:case 8388608:case 16777216:case 33554432:return-1;case 67108864:case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function ui(){var d=pr;return pr<<=1,(pr&62914560)===0&&(pr=4194304),d}function zn(d){for(var _=[],T=0;31>T;T++)_.push(d);return _}function Mn(d,_){d.pendingLanes|=_,_!==268435456&&(d.suspendedLanes=0,d.pingedLanes=0,d.warmLanes=0)}function jn(d,_,T,D,U,G){var ne=d.pendingLanes;d.pendingLanes=T,d.suspendedLanes=0,d.pingedLanes=0,d.warmLanes=0,d.expiredLanes&=T,d.entangledLanes&=T,d.errorRecoveryDisabledLanes&=T,d.shellSuspendCounter=0;var _e=d.entanglements,Ue=d.expirationTimes,dt=d.hiddenUpdates;for(T=ne&~T;0<T;){var At=31-it(T),Pt=1<<At;_e[At]=0,Ue[At]=-1;var vt=dt[At];if(vt!==null)for(dt[At]=null,At=0;At<vt.length;At++){var bt=vt[At];bt!==null&&(bt.lane&=-536870913)}T&=~Pt}D!==0&&fa(d,D,0),G!==0&&U===0&&d.tag!==0&&(d.suspendedLanes|=G&~(ne&~_))}function fa(d,_,T){d.pendingLanes|=_,d.suspendedLanes&=~_;var D=31-it(_);d.entangledLanes|=_,d.entanglements[D]=d.entanglements[D]|1073741824|T&261930}function Vi(d,_){var T=d.entangledLanes|=_;for(d=d.entanglements;T;){var D=31-it(T),U=1<<D;U&_|d[D]&_&&(d[D]|=_),T&=~U}}function $n(d,_){var T=_&-_;return T=(T&42)!==0?1:Ti(T),(T&(d.suspendedLanes|_))!==0?0:T}function Ti(d){switch(d){case 2:d=1;break;case 8:d=4;break;case 32:d=16;break;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:d=128;break;case 268435456:d=134217728;break;default:d=0}return d}function It(d){return d&=-d,2<d?8<d?(d&134217727)!==0?32:268435456:8:2}function Os(){var d=De.p;return d!==0?d:(d=window.event,d===void 0?32:Ra(d.type))}function mo(d,_){var T=De.p;try{return De.p=d,_()}finally{De.p=T}}var Wn=Math.random().toString(36).slice(2),mi="__reactFiber$"+Wn,Lt="__reactProps$"+Wn,Br="__reactContainer$"+Wn,Ur="__reactEvents$"+Wn,ko="__reactListeners$"+Wn,ul="__reactHandles$"+Wn,Ns="__reactResources$"+Wn,Nr="__reactMarker$"+Wn;function wu(d){delete d[mi],delete d[Lt],delete d[Ur],delete d[ko],delete d[ul]}function cl(d){var _=d[mi];if(_)return _;for(var T=d.parentNode;T;){if(_=T[Br]||T[mi]){if(T=_.alternate,_.child!==null||T!==null&&T.child!==null)for(d=I_(d);d!==null;){if(T=d[mi])return T;d=I_(d)}return _}d=T,T=d.parentNode}return null}function is(d){if(d=d[mi]||d[Br]){var _=d.tag;if(_===5||_===6||_===13||_===31||_===26||_===27||_===3)return d}return null}function Ol(d){var _=d.tag;if(_===5||_===26||_===27||_===6)return d.stateNode;throw Error(i(33))}function yo(d){var _=d[Ns];return _||(_=d[Ns]={hoistableStyles:new Map,hoistableScripts:new Map}),_}function mn(d){d[Nr]=!0}var Pn=new Set,_o={};function Ri(d,_){hl(d,_),hl(d+"Capture",_)}function hl(d,_){for(_o[d]=_,d=0;d<_.length;d++)Pn.add(_[d])}var Oh=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),yp={},Su={};function Nl(d){return Li.call(Su,d)?!0:Li.call(yp,d)?!1:Oh.test(d)?Su[d]=!0:(yp[d]=!0,!1)}function qf(d,_,T){if(Nl(_))if(T===null)d.removeAttribute(_);else{switch(typeof T){case"undefined":case"function":case"symbol":d.removeAttribute(_);return;case"boolean":var D=_.toLowerCase().slice(0,5);if(D!=="data-"&&D!=="aria-"){d.removeAttribute(_);return}}d.setAttribute(_,""+T)}}function Nh(d,_,T){if(T===null)d.removeAttribute(_);else{switch(typeof T){case"undefined":case"function":case"symbol":case"boolean":d.removeAttribute(_);return}d.setAttribute(_,""+T)}}function fl(d,_,T,D){if(D===null)d.removeAttribute(T);else{switch(typeof D){case"undefined":case"function":case"symbol":case"boolean":d.removeAttribute(T);return}d.setAttributeNS(_,T,""+D)}}function Ca(d){switch(typeof d){case"bigint":case"boolean":case"number":case"string":case"undefined":return d;case"object":return d;default:return""}}function Qg(d){var _=d.type;return(d=d.nodeName)&&d.toLowerCase()==="input"&&(_==="checkbox"||_==="radio")}function Tb(d,_,T){var D=Object.getOwnPropertyDescriptor(d.constructor.prototype,_);if(!d.hasOwnProperty(_)&&typeof D<"u"&&typeof D.get=="function"&&typeof D.set=="function"){var U=D.get,G=D.set;return Object.defineProperty(d,_,{configurable:!0,get:function(){return U.call(this)},set:function(ne){T=""+ne,G.call(this,ne)}}),Object.defineProperty(d,_,{enumerable:D.enumerable}),{getValue:function(){return T},setValue:function(ne){T=""+ne},stopTracking:function(){d._valueTracker=null,delete d[_]}}}}function Jg(d){if(!d._valueTracker){var _=Qg(d)?"checked":"value";d._valueTracker=Tb(d,_,""+d[_])}}function Ny(d){if(!d)return!1;var _=d._valueTracker;if(!_)return!0;var T=_.getValue(),D="";return d&&(D=Qg(d)?d.checked?"true":"false":d.value),d=D,d!==T?(_.setValue(d),!0):!1}function Yf(d){if(d=d||(typeof document<"u"?document:void 0),typeof d>"u")return null;try{return d.activeElement||d.body}catch{return d.body}}var ev=/[\n"\\]/g;function da(d){return d.replace(ev,function(_){return"\\"+_.charCodeAt(0).toString(16)+" "})}function Kf(d,_,T,D,U,G,ne,_e){d.name="",ne!=null&&typeof ne!="function"&&typeof ne!="symbol"&&typeof ne!="boolean"?d.type=ne:d.removeAttribute("type"),_!=null?ne==="number"?(_===0&&d.value===""||d.value!=_)&&(d.value=""+Ca(_)):d.value!==""+Ca(_)&&(d.value=""+Ca(_)):ne!=="submit"&&ne!=="reset"||d.removeAttribute("value"),_!=null?Bl(d,ne,Ca(_)):T!=null?Bl(d,ne,Ca(T)):D!=null&&d.removeAttribute("value"),U==null&&G!=null&&(d.defaultChecked=!!G),U!=null&&(d.checked=U&&typeof U!="function"&&typeof U!="symbol"),_e!=null&&typeof _e!="function"&&typeof _e!="symbol"&&typeof _e!="boolean"?d.name=""+Ca(_e):d.removeAttribute("name")}function tv(d,_,T,D,U,G,ne,_e){if(G!=null&&typeof G!="function"&&typeof G!="symbol"&&typeof G!="boolean"&&(d.type=G),_!=null||T!=null){if(!(G!=="submit"&&G!=="reset"||_!=null)){Jg(d);return}T=T!=null?""+Ca(T):"",_=_!=null?""+Ca(_):T,_e||_===d.value||(d.value=_),d.defaultValue=_}D=D??U,D=typeof D!="function"&&typeof D!="symbol"&&!!D,d.checked=_e?d.checked:!!D,d.defaultChecked=!!D,ne!=null&&typeof ne!="function"&&typeof ne!="symbol"&&typeof ne!="boolean"&&(d.name=ne),Jg(d)}function Bl(d,_,T){_==="number"&&Yf(d.ownerDocument)===d||d.defaultValue===""+T||(d.defaultValue=""+T)}function Tu(d,_,T,D){if(d=d.options,_){_={};for(var U=0;U<T.length;U++)_["$"+T[U]]=!0;for(T=0;T<d.length;T++)U=_.hasOwnProperty("$"+d[T].value),d[T].selected!==U&&(d[T].selected=U),U&&D&&(d[T].defaultSelected=!0)}else{for(T=""+Ca(T),_=null,U=0;U<d.length;U++){if(d[U].value===T){d[U].selected=!0,D&&(d[U].defaultSelected=!0);return}_!==null||d[U].disabled||(_=d[U])}_!==null&&(_.selected=!0)}}function By(d,_,T){if(_!=null&&(_=""+Ca(_),_!==d.value&&(d.value=_),T==null)){d.defaultValue!==_&&(d.defaultValue=_);return}d.defaultValue=T!=null?""+Ca(T):""}function Bh(d,_,T,D){if(_==null){if(D!=null){if(T!=null)throw Error(i(92));if(Ae(D)){if(1<D.length)throw Error(i(93));D=D[0]}T=D}T==null&&(T=""),_=T}T=Ca(_),d.defaultValue=T,D=d.textContent,D===T&&D!==""&&D!==null&&(d.value=D),Jg(d)}function dl(d,_){if(_){var T=d.firstChild;if(T&&T===d.lastChild&&T.nodeType===3){T.nodeValue=_;return}}d.textContent=_}var rv=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function Ba(d,_,T){var D=_.indexOf("--")===0;T==null||typeof T=="boolean"||T===""?D?d.setProperty(_,""):_==="float"?d.cssFloat="":d[_]="":D?d.setProperty(_,T):typeof T!="number"||T===0||rv.has(_)?_==="float"?d.cssFloat=T:d[_]=(""+T).trim():d[_]=T+"px"}function ni(d,_,T){if(_!=null&&typeof _!="object")throw Error(i(62));if(d=d.style,T!=null){for(var D in T)!T.hasOwnProperty(D)||_!=null&&_.hasOwnProperty(D)||(D.indexOf("--")===0?d.setProperty(D,""):D==="float"?d.cssFloat="":d[D]="");for(var U in _)D=_[U],_.hasOwnProperty(U)&&T[U]!==D&&Ba(d,U,D)}else for(var G in _)_.hasOwnProperty(G)&&Ba(d,G,_[G])}function Au(d){if(d.indexOf("-")===-1)return!1;switch(d){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Ka=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),Rc=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function Zr(d){return Rc.test(""+d)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":d}function Lo(){}var Dc=null;function Cu(d){return d=d.target||d.srcElement||window,d.correspondingUseElement&&(d=d.correspondingUseElement),d.nodeType===3?d.parentNode:d}var ta=null,Rn=null;function ra(d){var _=is(d);if(_&&(d=_.stateNode)){var T=d[Lt]||null;e:switch(d=_.stateNode,_.type){case"input":if(Kf(d,T.value,T.defaultValue,T.defaultValue,T.checked,T.defaultChecked,T.type,T.name),_=T.name,T.type==="radio"&&_!=null){for(T=d;T.parentNode;)T=T.parentNode;for(T=T.querySelectorAll('input[name="'+da(""+_)+'"][type="radio"]'),_=0;_<T.length;_++){var D=T[_];if(D!==d&&D.form===d.form){var U=D[Lt]||null;if(!U)throw Error(i(90));Kf(D,U.value,U.defaultValue,U.defaultValue,U.checked,U.defaultChecked,U.type,U.name)}}for(_=0;_<T.length;_++)D=T[_],D.form===d.form&&Ny(D)}break e;case"textarea":By(d,T.value,T.defaultValue);break e;case"select":_=T.value,_!=null&&Tu(d,!!T.multiple,_,!1)}}}var ia=!1;function qi(d,_,T){if(ia)return d(_,T);ia=!0;try{var D=d(_);return D}finally{if(ia=!1,(ta!==null||Rn!==null)&&(h_(),ta&&(_=ta,d=Rn,Rn=ta=null,ra(_),d)))for(_=0;_<d.length;_++)ra(d[_])}}function pl(d,_){var T=d.stateNode;if(T===null)return null;var D=T[Lt]||null;if(D===null)return null;T=D[_];e:switch(_){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(D=!D.disabled)||(d=d.type,D=!(d==="button"||d==="input"||d==="select"||d==="textarea")),d=!D;break e;default:d=!1}if(d)return null;if(T&&typeof T!="function")throw Error(i(231,_,typeof T));return T}var En=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),Qa=!1;if(En)try{var pa={};Object.defineProperty(pa,"passive",{get:function(){Qa=!0}}),window.addEventListener("test",pa,pa),window.removeEventListener("test",pa,pa)}catch{Qa=!1}var ns=null,Di=null,nn=null;function Qr(){if(nn)return nn;var d,_=Di,T=_.length,D,U="value"in ns?ns.value:ns.textContent,G=U.length;for(d=0;d<T&&_[d]===U[d];d++);var ne=T-d;for(D=1;D<=ne&&_[T-D]===U[G-D];D++);return nn=U.slice(d,1<D?1-D:void 0)}function Mr(d){var _=d.keyCode;return"charCode"in d?(d=d.charCode,d===0&&_===13&&(d=13)):d=_,d===10&&(d=13),32<=d||d===13?d:0}function zl(){return!0}function Hr(){return!1}function Ma(d){function _(T,D,U,G,ne){this._reactName=T,this._targetInst=U,this.type=D,this.nativeEvent=G,this.target=ne,this.currentTarget=null;for(var _e in d)d.hasOwnProperty(_e)&&(T=d[_e],this[_e]=T?T(G):G[_e]);return this.isDefaultPrevented=(G.defaultPrevented!=null?G.defaultPrevented:G.returnValue===!1)?zl:Hr,this.isPropagationStopped=Hr,this}return p(_.prototype,{preventDefault:function(){this.defaultPrevented=!0;var T=this.nativeEvent;T&&(T.preventDefault?T.preventDefault():typeof T.returnValue!="unknown"&&(T.returnValue=!1),this.isDefaultPrevented=zl)},stopPropagation:function(){var T=this.nativeEvent;T&&(T.stopPropagation?T.stopPropagation():typeof T.cancelBubble!="unknown"&&(T.cancelBubble=!0),this.isPropagationStopped=zl)},persist:function(){},isPersistent:zl}),_}var Dn={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(d){return d.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},zh=Ma(Dn),Fl=p({},Dn,{view:0,detail:0}),Qf=Ma(Fl),Mu,kc,Lc,Oc=p({},Fl,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Jf,button:0,buttons:0,relatedTarget:function(d){return d.relatedTarget===void 0?d.fromElement===d.srcElement?d.toElement:d.fromElement:d.relatedTarget},movementX:function(d){return"movementX"in d?d.movementX:(d!==Lc&&(Lc&&d.type==="mousemove"?(Mu=d.screenX-Lc.screenX,kc=d.screenY-Lc.screenY):kc=Mu=0,Lc=d),Mu)},movementY:function(d){return"movementY"in d?d.movementY:kc}}),Fh=Ma(Oc),gl=p({},Oc,{dataTransfer:0}),ga=Ma(gl),Nc=p({},Fl,{relatedTarget:0}),Bc=Ma(Nc),Eu=p({},Dn,{animationName:0,elapsedTime:0,pseudoElement:0}),va=Ma(Eu),_p=p({},Dn,{clipboardData:function(d){return"clipboardData"in d?d.clipboardData:window.clipboardData}}),bp=Ma(_p),zy=p({},Dn,{data:0}),Fy=Ma(zy),na={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},Vh={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},as={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function xp(d){var _=this.nativeEvent;return _.getModifierState?_.getModifierState(d):(d=as[d])?!!_[d]:!1}function Jf(){return xp}var ed=p({},Fl,{key:function(d){if(d.key){var _=na[d.key]||d.key;if(_!=="Unidentified")return _}return d.type==="keypress"?(d=Mr(d),d===13?"Enter":String.fromCharCode(d)):d.type==="keydown"||d.type==="keyup"?Vh[d.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Jf,charCode:function(d){return d.type==="keypress"?Mr(d):0},keyCode:function(d){return d.type==="keydown"||d.type==="keyup"?d.keyCode:0},which:function(d){return d.type==="keypress"?Mr(d):d.type==="keydown"||d.type==="keyup"?d.keyCode:0}}),Vl=Ma(ed),Bs=p({},Oc,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),iv=Ma(Bs),wp=p({},Fl,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Jf}),Ab=Ma(wp),nv=p({},Dn,{propertyName:0,elapsedTime:0,pseudoElement:0}),Cb=Ma(nv),Sp=p({},Oc,{deltaX:function(d){return"deltaX"in d?d.deltaX:"wheelDeltaX"in d?-d.wheelDeltaX:0},deltaY:function(d){return"deltaY"in d?d.deltaY:"wheelDeltaY"in d?-d.wheelDeltaY:"wheelDelta"in d?-d.wheelDelta:0},deltaZ:0,deltaMode:0}),av=Ma(Sp),Tp=p({},Dn,{newState:0,oldState:0}),Uh=Ma(Tp),ov=[9,13,27,32],Oo=En&&"CompositionEvent"in window,Hh=null;En&&"documentMode"in document&&(Hh=document.documentMode);var sv=En&&"TextEvent"in window&&!Hh,zc=En&&(!Oo||Hh&&8<Hh&&11>=Hh),jh=" ",Vy=!1;function td(d,_){switch(d){case"keyup":return ov.indexOf(_.keyCode)!==-1;case"keydown":return _.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Uy(d){return d=d.detail,typeof d=="object"&&"data"in d?d.data:null}var zs=!1;function Hy(d,_){switch(d){case"compositionend":return Uy(_);case"keypress":return _.which!==32?null:(Vy=!0,jh);case"textInput":return d=_.data,d===jh&&Vy?null:d;default:return null}}function lv(d,_){if(zs)return d==="compositionend"||!Oo&&td(d,_)?(d=Qr(),nn=Di=ns=null,zs=!1,d):null;switch(d){case"paste":return null;case"keypress":if(!(_.ctrlKey||_.altKey||_.metaKey)||_.ctrlKey&&_.altKey){if(_.char&&1<_.char.length)return _.char;if(_.which)return String.fromCharCode(_.which)}return null;case"compositionend":return zc&&_.locale!=="ko"?null:_.data;default:return null}}var jy={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function uv(d){var _=d&&d.nodeName&&d.nodeName.toLowerCase();return _==="input"?!!jy[d.type]:_==="textarea"}function Ap(d,_,T,D){ta?Rn?Rn.push(D):Rn=[D]:ta=D,_=Yv(_,"onChange"),0<_.length&&(T=new zh("onChange","change",null,T,D),d.push({event:T,listeners:_}))}var $h=null,Wh=null;function rd(d){BS(d,0)}function id(d){var _=Ol(d);if(Ny(_))return d}function Iu(d,_){if(d==="change")return _}var cv=!1;if(En){var Cp;if(En){var Ul="oninput"in document;if(!Ul){var hv=document.createElement("div");hv.setAttribute("oninput","return;"),Ul=typeof hv.oninput=="function"}Cp=Ul}else Cp=!1;cv=Cp&&(!document.documentMode||9<document.documentMode)}function nd(){$h&&($h.detachEvent("onpropertychange",$y),Wh=$h=null)}function $y(d){if(d.propertyName==="value"&&id(Wh)){var _=[];Ap(_,Wh,d,Cu(d)),qi(rd,_)}}function Wy(d,_,T){d==="focusin"?(nd(),$h=_,Wh=T,$h.attachEvent("onpropertychange",$y)):d==="focusout"&&nd()}function fv(d){if(d==="selectionchange"||d==="keyup"||d==="keydown")return id(Wh)}function Gy(d,_){if(d==="click")return id(_)}function Xy(d,_){if(d==="input"||d==="change")return id(_)}function dv(d,_){return d===_&&(d!==0||1/d===1/_)||d!==d&&_!==_}var Ja=typeof Object.is=="function"?Object.is:dv;function Pu(d,_){if(Ja(d,_))return!0;if(typeof d!="object"||d===null||typeof _!="object"||_===null)return!1;var T=Object.keys(d),D=Object.keys(_);if(T.length!==D.length)return!1;for(D=0;D<T.length;D++){var U=T[D];if(!Li.call(_,U)||!Ja(d[U],_[U]))return!1}return!0}function vl(d){for(;d&&d.firstChild;)d=d.firstChild;return d}function Mp(d,_){var T=vl(d);d=0;for(var D;T;){if(T.nodeType===3){if(D=d+T.textContent.length,d<=_&&D>=_)return{node:T,offset:_-d};d=D}e:{for(;T;){if(T.nextSibling){T=T.nextSibling;break e}T=T.parentNode}T=void 0}T=vl(T)}}function Ep(d,_){return d&&_?d===_?!0:d&&d.nodeType===3?!1:_&&_.nodeType===3?Ep(d,_.parentNode):"contains"in d?d.contains(_):d.compareDocumentPosition?!!(d.compareDocumentPosition(_)&16):!1:!1}function yi(d){d=d!=null&&d.ownerDocument!=null&&d.ownerDocument.defaultView!=null?d.ownerDocument.defaultView:window;for(var _=Yf(d.document);_ instanceof d.HTMLIFrameElement;){try{var T=typeof _.contentWindow.location.href=="string"}catch{T=!1}if(T)d=_.contentWindow;else break;_=Yf(d.document)}return _}function Ip(d){var _=d&&d.nodeName&&d.nodeName.toLowerCase();return _&&(_==="input"&&(d.type==="text"||d.type==="search"||d.type==="tel"||d.type==="url"||d.type==="password")||_==="textarea"||d.contentEditable==="true")}var pv=En&&"documentMode"in document&&11>=document.documentMode,os=null,ad=null,od=null,gv=!1;function Zy(d,_,T){var D=T.window===T?T.document:T.nodeType===9?T:T.ownerDocument;gv||os==null||os!==Yf(D)||(D=os,"selectionStart"in D&&Ip(D)?D={start:D.selectionStart,end:D.selectionEnd}:(D=(D.ownerDocument&&D.ownerDocument.defaultView||window).getSelection(),D={anchorNode:D.anchorNode,anchorOffset:D.anchorOffset,focusNode:D.focusNode,focusOffset:D.focusOffset}),od&&Pu(od,D)||(od=D,D=Yv(ad,"onSelect"),0<D.length&&(_=new zh("onSelect","select",null,_,T),d.push({event:_,listeners:D}),_.target=os)))}function Fc(d,_){var T={};return T[d.toLowerCase()]=_.toLowerCase(),T["Webkit"+d]="webkit"+_,T["Moz"+d]="moz"+_,T}var Vc={animationend:Fc("Animation","AnimationEnd"),animationiteration:Fc("Animation","AnimationIteration"),animationstart:Fc("Animation","AnimationStart"),transitionrun:Fc("Transition","TransitionRun"),transitionstart:Fc("Transition","TransitionStart"),transitioncancel:Fc("Transition","TransitionCancel"),transitionend:Fc("Transition","TransitionEnd")},vv={},mv={};En&&(mv=document.createElement("div").style,"AnimationEvent"in window||(delete Vc.animationend.animation,delete Vc.animationiteration.animation,delete Vc.animationstart.animation),"TransitionEvent"in window||delete Vc.transitionend.transition);function ml(d){if(vv[d])return vv[d];if(!Vc[d])return d;var _=Vc[d],T;for(T in _)if(_.hasOwnProperty(T)&&T in mv)return vv[d]=_[T];return d}var sd=ml("animationend"),ld=ml("animationiteration"),Pp=ml("animationstart"),Uc=ml("transitionrun"),ud=ml("transitionstart"),Gh=ml("transitioncancel"),No=ml("transitionend"),yv=new Map,Rp="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");Rp.push("scrollEnd");function Bo(d,_){yv.set(d,_),Ri(_,[d])}var yl=typeof reportError=="function"?reportError:function(d){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var _=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof d=="object"&&d!==null&&typeof d.message=="string"?String(d.message):String(d),error:d});if(!window.dispatchEvent(_))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",d);return}console.error(d)},eo=[],Hl=0,Hc=0;function jc(){for(var d=Hl,_=Hc=Hl=0;_<d;){var T=eo[_];eo[_++]=null;var D=eo[_];eo[_++]=null;var U=eo[_];eo[_++]=null;var G=eo[_];if(eo[_++]=null,D!==null&&U!==null){var ne=D.pending;ne===null?U.next=U:(U.next=ne.next,ne.next=U),D.pending=U}G!==0&&_v(T,U,G)}}function cd(d,_,T,D){eo[Hl++]=d,eo[Hl++]=_,eo[Hl++]=T,eo[Hl++]=D,Hc|=D,d.lanes|=D,d=d.alternate,d!==null&&(d.lanes|=D)}function Ru(d,_,T,D){return cd(d,_,T,D),Du(d)}function ss(d,_){return cd(d,null,null,_),Du(d)}function _v(d,_,T){d.lanes|=T;var D=d.alternate;D!==null&&(D.lanes|=T);for(var U=!1,G=d.return;G!==null;)G.childLanes|=T,D=G.alternate,D!==null&&(D.childLanes|=T),G.tag===22&&(d=G.stateNode,d===null||d._visibility&1||(U=!0)),d=G,G=G.return;return d.tag===3?(G=d.stateNode,U&&_!==null&&(U=31-it(T),d=G.hiddenUpdates,D=d[U],D===null?d[U]=[_]:D.push(_),_.lane=T|536870912),G):null}function Du(d){if(50<On)throw On=0,Hv=null,Error(i(185));for(var _=d.return;_!==null;)d=_,_=d.return;return d.tag===3?d.stateNode:null}var jr={};function Dp(d,_,T,D){this.tag=d,this.key=T,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=_,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=D,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function zo(d,_,T,D){return new Dp(d,_,T,D)}function hd(d){return d=d.prototype,!(!d||!d.isReactComponent)}function Fo(d,_){var T=d.alternate;return T===null?(T=zo(d.tag,_,d.key,d.mode),T.elementType=d.elementType,T.type=d.type,T.stateNode=d.stateNode,T.alternate=d,d.alternate=T):(T.pendingProps=_,T.type=d.type,T.flags=0,T.subtreeFlags=0,T.deletions=null),T.flags=d.flags&65011712,T.childLanes=d.childLanes,T.lanes=d.lanes,T.child=d.child,T.memoizedProps=d.memoizedProps,T.memoizedState=d.memoizedState,T.updateQueue=d.updateQueue,_=d.dependencies,T.dependencies=_===null?null:{lanes:_.lanes,firstContext:_.firstContext},T.sibling=d.sibling,T.index=d.index,T.ref=d.ref,T.refCleanup=d.refCleanup,T}function qy(d,_){d.flags&=65011714;var T=d.alternate;return T===null?(d.childLanes=0,d.lanes=_,d.child=null,d.subtreeFlags=0,d.memoizedProps=null,d.memoizedState=null,d.updateQueue=null,d.dependencies=null,d.stateNode=null):(d.childLanes=T.childLanes,d.lanes=T.lanes,d.child=T.child,d.subtreeFlags=0,d.deletions=null,d.memoizedProps=T.memoizedProps,d.memoizedState=T.memoizedState,d.updateQueue=T.updateQueue,d.type=T.type,_=T.dependencies,d.dependencies=_===null?null:{lanes:_.lanes,firstContext:_.firstContext}),d}function $c(d,_,T,D,U,G){var ne=0;if(D=d,typeof d=="function")hd(d)&&(ne=1);else if(typeof d=="string")ne=le(d,T,_t.current)?26:d==="html"||d==="head"||d==="body"?27:5;else e:switch(d){case ee:return d=zo(31,T,_,U),d.elementType=ee,d.lanes=G,d;case C:return jl(T.children,U,G,_);case E:ne=8,U|=24;break;case P:return d=zo(12,T,_,U|2),d.elementType=P,d.lanes=G,d;case W:return d=zo(13,T,_,U),d.elementType=W,d.lanes=G,d;case $:return d=zo(19,T,_,U),d.elementType=$,d.lanes=G,d;default:if(typeof d=="object"&&d!==null)switch(d.$$typeof){case B:ne=10;break e;case O:ne=9;break e;case F:ne=11;break e;case q:ne=14;break e;case Q:ne=16,D=null;break e}ne=29,T=Error(i(130,d===null?"null":typeof d,"")),D=null}return _=zo(ne,T,_,U),_.elementType=d,_.type=D,_.lanes=G,_}function jl(d,_,T,D){return d=zo(7,d,D,_),d.lanes=T,d}function bv(d,_,T){return d=zo(6,d,null,_),d.lanes=T,d}function kp(d){var _=zo(18,null,null,0);return _.stateNode=d,_}function Xh(d,_,T){return _=zo(4,d.children!==null?d.children:[],d.key,_),_.lanes=T,_.stateNode={containerInfo:d.containerInfo,pendingChildren:null,implementation:d.implementation},_}var fd=new WeakMap;function to(d,_){if(typeof d=="object"&&d!==null){var T=fd.get(d);return T!==void 0?T:(_={value:d,source:_,stack:In(_)},fd.set(d,_),_)}return{value:d,source:_,stack:In(_)}}var $l=[],ku=0,Wc=null,Lu=0,za=[],ma=0,Fs=null,_l=1,bo="";function Wl(d,_){$l[ku++]=Lu,$l[ku++]=Wc,Wc=d,Lu=_}function xv(d,_,T){za[ma++]=_l,za[ma++]=bo,za[ma++]=Fs,Fs=d;var D=_l;d=bo;var U=32-it(D)-1;D&=~(1<<U),T+=1;var G=32-it(_)+U;if(30<G){var ne=U-U%5;G=(D&(1<<ne)-1).toString(32),D>>=ne,U-=ne,_l=1<<32-it(_)+U|T<<U|D,bo=G+d}else _l=1<<G|T<<U|D,bo=d}function Gc(d){d.return!==null&&(Wl(d,1),xv(d,1,0))}function Zh(d){for(;d===Wc;)Wc=$l[--ku],$l[ku]=null,Lu=$l[--ku],$l[ku]=null;for(;d===Fs;)Fs=za[--ma],za[ma]=null,bo=za[--ma],za[ma]=null,_l=za[--ma],za[ma]=null}function dd(d,_){za[ma++]=_l,za[ma++]=bo,za[ma++]=Fs,_l=_.id,bo=_.overflow,Fs=d}var Gn=null,Oi=null,ai=!1,Vs=null,Vo=!1,yn=Error(i(519));function xo(d){var _=Error(i(418,1<arguments.length&&arguments[1]!==void 0&&arguments[1]?"text":"HTML",""));throw bl(to(_,d)),yn}function Uo(d){var _=d.stateNode,T=d.type,D=d.memoizedProps;switch(_[mi]=d,_[Lt]=D,T){case"dialog":bi("cancel",_),bi("close",_);break;case"iframe":case"object":case"embed":bi("load",_);break;case"video":case"audio":for(T=0;T<Zv.length;T++)bi(Zv[T],_);break;case"source":bi("error",_);break;case"img":case"image":case"link":bi("error",_),bi("load",_);break;case"details":bi("toggle",_);break;case"input":bi("invalid",_),tv(_,D.value,D.defaultValue,D.checked,D.defaultChecked,D.type,D.name,!0);break;case"select":bi("invalid",_);break;case"textarea":bi("invalid",_),Bh(_,D.value,D.defaultValue,D.children)}T=D.children,typeof T!="string"&&typeof T!="number"&&typeof T!="bigint"||_.textContent===""+T||D.suppressHydrationWarning===!0||fx(_.textContent,T)?(D.popover!=null&&(bi("beforetoggle",_),bi("toggle",_)),D.onScroll!=null&&bi("scroll",_),D.onScrollEnd!=null&&bi("scrollend",_),D.onClick!=null&&(_.onclick=Lo),_=!0):_=!1,_||xo(d,!0)}function Lp(d){for(Gn=d.return;Gn;)switch(Gn.tag){case 5:case 31:case 13:Vo=!1;return;case 27:case 3:Vo=!0;return;default:Gn=Gn.return}}function Gl(d){if(d!==Gn)return!1;if(!ai)return Lp(d),ai=!0,!1;var _=d.tag,T;if((T=_!==3&&_!==27)&&((T=_===5)&&(T=d.type,T=!(T!=="form"&&T!=="button")||A_(d.type,d.memoizedProps)),T=!T),T&&Oi&&xo(d),Lp(d),_===13){if(d=d.memoizedState,d=d!==null?d.dehydrated:null,!d)throw Error(i(317));Oi=yx(d)}else if(_===31){if(d=d.memoizedState,d=d!==null?d.dehydrated:null,!d)throw Error(i(317));Oi=yx(d)}else _===27?(_=Oi,lu(d.type)?(d=E_,E_=null,Oi=d):Oi=_):Oi=Gn?ps(d.stateNode.nextSibling):null;return!0}function Xl(){Oi=Gn=null,ai=!1}function Zl(){var d=Vs;return d!==null&&(qo===null?qo=d:qo.push.apply(qo,d),Vs=null),d}function bl(d){Vs===null?Vs=[d]:Vs.push(d)}var Xc=xe(null),xl=null,Us=null;function ql(d,_,T){pt(Xc,_._currentValue),_._currentValue=T}function Hs(d){d._currentValue=Xc.current,$e(Xc)}function pd(d,_,T){for(;d!==null;){var D=d.alternate;if((d.childLanes&_)!==_?(d.childLanes|=_,D!==null&&(D.childLanes|=_)):D!==null&&(D.childLanes&_)!==_&&(D.childLanes|=_),d===T)break;d=d.return}}function Ou(d,_,T,D){var U=d.child;for(U!==null&&(U.return=d);U!==null;){var G=U.dependencies;if(G!==null){var ne=U.child;G=G.firstContext;e:for(;G!==null;){var _e=G;G=U;for(var Ue=0;Ue<_.length;Ue++)if(_e.context===_[Ue]){G.lanes|=T,_e=G.alternate,_e!==null&&(_e.lanes|=T),pd(G.return,T,d),D||(ne=null);break e}G=_e.next}}else if(U.tag===18){if(ne=U.return,ne===null)throw Error(i(341));ne.lanes|=T,G=ne.alternate,G!==null&&(G.lanes|=T),pd(ne,T,d),ne=null}else ne=U.child;if(ne!==null)ne.return=U;else for(ne=U;ne!==null;){if(ne===d){ne=null;break}if(U=ne.sibling,U!==null){U.return=ne.return,ne=U;break}ne=ne.return}U=ne}}function ls(d,_,T,D){d=null;for(var U=_,G=!1;U!==null;){if(!G){if((U.flags&524288)!==0)G=!0;else if((U.flags&262144)!==0)break}if(U.tag===10){var ne=U.alternate;if(ne===null)throw Error(i(387));if(ne=ne.memoizedProps,ne!==null){var _e=U.type;Ja(U.pendingProps.value,ne.value)||(d!==null?d.push(_e):d=[_e])}}else if(U===_r.current){if(ne=U.alternate,ne===null)throw Error(i(387));ne.memoizedState.memoizedState!==U.memoizedState.memoizedState&&(d!==null?d.push(gt):d=[gt])}U=U.return}d!==null&&Ou(_,d,T,D),_.flags|=262144}function gd(d){for(d=d.firstContext;d!==null;){if(!Ja(d.context._currentValue,d.memoizedValue))return!0;d=d.next}return!1}function Nu(d){xl=d,Us=null,d=d.dependencies,d!==null&&(d.firstContext=null)}function ya(d){return wv(xl,d)}function vd(d,_){return xl===null&&Nu(d),wv(d,_)}function wv(d,_){var T=_._currentValue;if(_={context:_,memoizedValue:T,next:null},Us===null){if(d===null)throw Error(i(308));Us=_,d.dependencies={lanes:0,firstContext:_},d.flags|=524288}else Us=Us.next=_;return T}var qh=typeof AbortController<"u"?AbortController:function(){var d=[],_=this.signal={aborted:!1,addEventListener:function(T,D){d.push(D)}};this.abort=function(){_.aborted=!0,d.forEach(function(T){return T()})}},Yh=r.unstable_scheduleCallback,wo=r.unstable_NormalPriority,Yi={$$typeof:B,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function md(){return{controller:new qh,data:new Map,refCount:0}}function Fa(d){d.refCount--,d.refCount===0&&Yh(wo,function(){d.controller.abort()})}var ro=null,Bu=0,Ea=0,Ho=null;function Mb(d,_){if(ro===null){var T=ro=[];Bu=0,Ea=pf(),Ho={status:"pending",value:void 0,then:function(D){T.push(D)}}}return Bu++,_.then(Op,Op),_}function Op(){if(--Bu===0&&ro!==null){Ho!==null&&(Ho.status="fulfilled");var d=ro;ro=null,Ea=0,Ho=null;for(var _=0;_<d.length;_++)(0,d[_])()}}function Eb(d,_){var T=[],D={status:"pending",value:null,reason:null,then:function(U){T.push(U)}};return d.then(function(){D.status="fulfilled",D.value=_;for(var U=0;U<T.length;U++)(0,T[U])(_)},function(U){for(D.status="rejected",D.reason=U,U=0;U<T.length;U++)(0,T[U])(void 0)}),D}var Kh=me.S;me.S=function(d,_){MS=ea(),typeof _=="object"&&_!==null&&typeof _.then=="function"&&Mb(d,_),Kh!==null&&Kh(d,_)};var zu=xe(null);function Zc(){var d=zu.current;return d!==null?d:en.pooledCache}function us(d,_){_===null?pt(zu,zu.current):pt(zu,_.pool)}function Zt(){var d=Zc();return d===null?null:{parent:Yi._currentValue,pool:d}}var qc=Error(i(460)),yd=Error(i(474)),Fu=Error(i(542)),Vu={then:function(){}};function Uu(d){return d=d.status,d==="fulfilled"||d==="rejected"}function Yc(d,_,T){switch(T=d[T],T===void 0?d.push(_):T!==_&&(_.then(Lo,Lo),_=T),_.status){case"fulfilled":return _.value;case"rejected":throw d=_.reason,_d(d),d;default:if(typeof _.status=="string")_.then(Lo,Lo);else{if(d=en,d!==null&&100<d.shellSuspendCounter)throw Error(i(482));d=_,d.status="pending",d.then(function(D){if(_.status==="pending"){var U=_;U.status="fulfilled",U.value=D}},function(D){if(_.status==="pending"){var U=_;U.status="rejected",U.reason=D}})}switch(_.status){case"fulfilled":return _.value;case"rejected":throw d=_.reason,_d(d),d}throw wl=_,qc}}function zr(d){try{var _=d._init;return _(d._payload)}catch(T){throw T!==null&&typeof T=="object"&&typeof T.then=="function"?(wl=T,qc):T}}var wl=null;function Sv(){if(wl===null)throw Error(i(459));var d=wl;return wl=null,d}function _d(d){if(d===qc||d===Fu)throw Error(i(483))}var Hu=null,Qh=0;function bd(d){var _=Qh;return Qh+=1,Hu===null&&(Hu=[]),Yc(Hu,d,_)}function ju(d,_){_=_.props.ref,d.ref=_!==void 0?_:null}function xd(d,_){throw _.$$typeof===y?Error(i(525)):(d=Object.prototype.toString.call(_),Error(i(31,d==="[object Object]"?"object with keys {"+Object.keys(_).join(", ")+"}":d)))}function Tv(d){function _(Je,Ze){if(d){var ft=Je.deletions;ft===null?(Je.deletions=[Ze],Je.flags|=16):ft.push(Ze)}}function T(Je,Ze){if(!d)return null;for(;Ze!==null;)_(Je,Ze),Ze=Ze.sibling;return null}function D(Je){for(var Ze=new Map;Je!==null;)Je.key!==null?Ze.set(Je.key,Je):Ze.set(Je.index,Je),Je=Je.sibling;return Ze}function U(Je,Ze){return Je=Fo(Je,Ze),Je.index=0,Je.sibling=null,Je}function G(Je,Ze,ft){return Je.index=ft,d?(ft=Je.alternate,ft!==null?(ft=ft.index,ft<Ze?(Je.flags|=67108866,Ze):ft):(Je.flags|=67108866,Ze)):(Je.flags|=1048576,Ze)}function ne(Je){return d&&Je.alternate===null&&(Je.flags|=67108866),Je}function _e(Je,Ze,ft,Mt){return Ze===null||Ze.tag!==6?(Ze=bv(ft,Je.mode,Mt),Ze.return=Je,Ze):(Ze=U(Ze,ft),Ze.return=Je,Ze)}function Ue(Je,Ze,ft,Mt){var Ar=ft.type;return Ar===C?At(Je,Ze,ft.props.children,Mt,ft.key):Ze!==null&&(Ze.elementType===Ar||typeof Ar=="object"&&Ar!==null&&Ar.$$typeof===Q&&zr(Ar)===Ze.type)?(Ze=U(Ze,ft.props),ju(Ze,ft),Ze.return=Je,Ze):(Ze=$c(ft.type,ft.key,ft.props,null,Je.mode,Mt),ju(Ze,ft),Ze.return=Je,Ze)}function dt(Je,Ze,ft,Mt){return Ze===null||Ze.tag!==4||Ze.stateNode.containerInfo!==ft.containerInfo||Ze.stateNode.implementation!==ft.implementation?(Ze=Xh(ft,Je.mode,Mt),Ze.return=Je,Ze):(Ze=U(Ze,ft.children||[]),Ze.return=Je,Ze)}function At(Je,Ze,ft,Mt,Ar){return Ze===null||Ze.tag!==7?(Ze=jl(ft,Je.mode,Mt,Ar),Ze.return=Je,Ze):(Ze=U(Ze,ft),Ze.return=Je,Ze)}function Pt(Je,Ze,ft){if(typeof Ze=="string"&&Ze!==""||typeof Ze=="number"||typeof Ze=="bigint")return Ze=bv(""+Ze,Je.mode,ft),Ze.return=Je,Ze;if(typeof Ze=="object"&&Ze!==null){switch(Ze.$$typeof){case b:return ft=$c(Ze.type,Ze.key,Ze.props,null,Je.mode,ft),ju(ft,Ze),ft.return=Je,ft;case S:return Ze=Xh(Ze,Je.mode,ft),Ze.return=Je,Ze;case Q:return Ze=zr(Ze),Pt(Je,Ze,ft)}if(Ae(Ze)||de(Ze))return Ze=jl(Ze,Je.mode,ft,null),Ze.return=Je,Ze;if(typeof Ze.then=="function")return Pt(Je,bd(Ze),ft);if(Ze.$$typeof===B)return Pt(Je,vd(Je,Ze),ft);xd(Je,Ze)}return null}function vt(Je,Ze,ft,Mt){var Ar=Ze!==null?Ze.key:null;if(typeof ft=="string"&&ft!==""||typeof ft=="number"||typeof ft=="bigint")return Ar!==null?null:_e(Je,Ze,""+ft,Mt);if(typeof ft=="object"&&ft!==null){switch(ft.$$typeof){case b:return ft.key===Ar?Ue(Je,Ze,ft,Mt):null;case S:return ft.key===Ar?dt(Je,Ze,ft,Mt):null;case Q:return ft=zr(ft),vt(Je,Ze,ft,Mt)}if(Ae(ft)||de(ft))return Ar!==null?null:At(Je,Ze,ft,Mt,null);if(typeof ft.then=="function")return vt(Je,Ze,bd(ft),Mt);if(ft.$$typeof===B)return vt(Je,Ze,vd(Je,ft),Mt);xd(Je,ft)}return null}function bt(Je,Ze,ft,Mt,Ar){if(typeof Mt=="string"&&Mt!==""||typeof Mt=="number"||typeof Mt=="bigint")return Je=Je.get(ft)||null,_e(Ze,Je,""+Mt,Ar);if(typeof Mt=="object"&&Mt!==null){switch(Mt.$$typeof){case b:return Je=Je.get(Mt.key===null?ft:Mt.key)||null,Ue(Ze,Je,Mt,Ar);case S:return Je=Je.get(Mt.key===null?ft:Mt.key)||null,dt(Ze,Je,Mt,Ar);case Q:return Mt=zr(Mt),bt(Je,Ze,ft,Mt,Ar)}if(Ae(Mt)||de(Mt))return Je=Je.get(ft)||null,At(Ze,Je,Mt,Ar,null);if(typeof Mt.then=="function")return bt(Je,Ze,ft,bd(Mt),Ar);if(Mt.$$typeof===B)return bt(Je,Ze,ft,vd(Ze,Mt),Ar);xd(Ze,Mt)}return null}function fr(Je,Ze,ft,Mt){for(var Ar=null,zi=null,er=Ze,Ir=Ze=0,ei=null;er!==null&&Ir<ft.length;Ir++){er.index>Ir?(ei=er,er=null):ei=er.sibling;var ti=vt(Je,er,ft[Ir],Mt);if(ti===null){er===null&&(er=ei);break}d&&er&&ti.alternate===null&&_(Je,er),Ze=G(ti,Ze,Ir),zi===null?Ar=ti:zi.sibling=ti,zi=ti,er=ei}if(Ir===ft.length)return T(Je,er),ai&&Wl(Je,Ir),Ar;if(er===null){for(;Ir<ft.length;Ir++)er=Pt(Je,ft[Ir],Mt),er!==null&&(Ze=G(er,Ze,Ir),zi===null?Ar=er:zi.sibling=er,zi=er);return ai&&Wl(Je,Ir),Ar}for(er=D(er);Ir<ft.length;Ir++)ei=bt(er,Je,Ir,ft[Ir],Mt),ei!==null&&(d&&ei.alternate!==null&&er.delete(ei.key===null?Ir:ei.key),Ze=G(ei,Ze,Ir),zi===null?Ar=ei:zi.sibling=ei,zi=ei);return d&&er.forEach(function(ms){return _(Je,ms)}),ai&&Wl(Je,Ir),Ar}function Lr(Je,Ze,ft,Mt){if(ft==null)throw Error(i(151));for(var Ar=null,zi=null,er=Ze,Ir=Ze=0,ei=null,ti=ft.next();er!==null&&!ti.done;Ir++,ti=ft.next()){er.index>Ir?(ei=er,er=null):ei=er.sibling;var ms=vt(Je,er,ti.value,Mt);if(ms===null){er===null&&(er=ei);break}d&&er&&ms.alternate===null&&_(Je,er),Ze=G(ms,Ze,Ir),zi===null?Ar=ms:zi.sibling=ms,zi=ms,er=ei}if(ti.done)return T(Je,er),ai&&Wl(Je,Ir),Ar;if(er===null){for(;!ti.done;Ir++,ti=ft.next())ti=Pt(Je,ti.value,Mt),ti!==null&&(Ze=G(ti,Ze,Ir),zi===null?Ar=ti:zi.sibling=ti,zi=ti);return ai&&Wl(Je,Ir),Ar}for(er=D(er);!ti.done;Ir++,ti=ft.next())ti=bt(er,Je,Ir,ti.value,Mt),ti!==null&&(d&&ti.alternate!==null&&er.delete(ti.key===null?Ir:ti.key),Ze=G(ti,Ze,Ir),zi===null?Ar=ti:zi.sibling=ti,zi=ti);return d&&er.forEach(function(ic){return _(Je,ic)}),ai&&Wl(Je,Ir),Ar}function sn(Je,Ze,ft,Mt){if(typeof ft=="object"&&ft!==null&&ft.type===C&&ft.key===null&&(ft=ft.props.children),typeof ft=="object"&&ft!==null){switch(ft.$$typeof){case b:e:{for(var Ar=ft.key;Ze!==null;){if(Ze.key===Ar){if(Ar=ft.type,Ar===C){if(Ze.tag===7){T(Je,Ze.sibling),Mt=U(Ze,ft.props.children),Mt.return=Je,Je=Mt;break e}}else if(Ze.elementType===Ar||typeof Ar=="object"&&Ar!==null&&Ar.$$typeof===Q&&zr(Ar)===Ze.type){T(Je,Ze.sibling),Mt=U(Ze,ft.props),ju(Mt,ft),Mt.return=Je,Je=Mt;break e}T(Je,Ze);break}else _(Je,Ze);Ze=Ze.sibling}ft.type===C?(Mt=jl(ft.props.children,Je.mode,Mt,ft.key),Mt.return=Je,Je=Mt):(Mt=$c(ft.type,ft.key,ft.props,null,Je.mode,Mt),ju(Mt,ft),Mt.return=Je,Je=Mt)}return ne(Je);case S:e:{for(Ar=ft.key;Ze!==null;){if(Ze.key===Ar)if(Ze.tag===4&&Ze.stateNode.containerInfo===ft.containerInfo&&Ze.stateNode.implementation===ft.implementation){T(Je,Ze.sibling),Mt=U(Ze,ft.children||[]),Mt.return=Je,Je=Mt;break e}else{T(Je,Ze);break}else _(Je,Ze);Ze=Ze.sibling}Mt=Xh(ft,Je.mode,Mt),Mt.return=Je,Je=Mt}return ne(Je);case Q:return ft=zr(ft),sn(Je,Ze,ft,Mt)}if(Ae(ft))return fr(Je,Ze,ft,Mt);if(de(ft)){if(Ar=de(ft),typeof Ar!="function")throw Error(i(150));return ft=Ar.call(ft),Lr(Je,Ze,ft,Mt)}if(typeof ft.then=="function")return sn(Je,Ze,bd(ft),Mt);if(ft.$$typeof===B)return sn(Je,Ze,vd(Je,ft),Mt);xd(Je,ft)}return typeof ft=="string"&&ft!==""||typeof ft=="number"||typeof ft=="bigint"?(ft=""+ft,Ze!==null&&Ze.tag===6?(T(Je,Ze.sibling),Mt=U(Ze,ft),Mt.return=Je,Je=Mt):(T(Je,Ze),Mt=bv(ft,Je.mode,Mt),Mt.return=Je,Je=Mt),ne(Je)):T(Je,Ze)}return function(Je,Ze,ft,Mt){try{Qh=0;var Ar=sn(Je,Ze,ft,Mt);return Hu=null,Ar}catch(er){if(er===qc||er===Fu)throw er;var zi=zo(29,er,null,Je.mode);return zi.lanes=Mt,zi.return=Je,zi}finally{}}}var $u=Tv(!0),Av=Tv(!1),Yl=!1;function Sl(d){d.updateQueue={baseState:d.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function Ni(d,_){d=d.updateQueue,_.updateQueue===d&&(_.updateQueue={baseState:d.baseState,firstBaseUpdate:d.firstBaseUpdate,lastBaseUpdate:d.lastBaseUpdate,shared:d.shared,callbacks:null})}function Kl(d){return{lane:d,tag:0,payload:null,callback:null,next:null}}function cs(d,_,T){var D=d.updateQueue;if(D===null)return null;if(D=D.shared,(Ci&2)!==0){var U=D.pending;return U===null?_.next=_:(_.next=U.next,U.next=_),D.pending=_,_=Du(d),_v(d,null,T),_}return cd(d,D,_,T),Du(d)}function Wu(d,_,T){if(_=_.updateQueue,_!==null&&(_=_.shared,(T&4194048)!==0)){var D=_.lanes;D&=d.pendingLanes,T|=D,_.lanes=T,Vi(d,T)}}function wd(d,_){var T=d.updateQueue,D=d.alternate;if(D!==null&&(D=D.updateQueue,T===D)){var U=null,G=null;if(T=T.firstBaseUpdate,T!==null){do{var ne={lane:T.lane,tag:T.tag,payload:T.payload,callback:null,next:null};G===null?U=G=ne:G=G.next=ne,T=T.next}while(T!==null);G===null?U=G=_:G=G.next=_}else U=G=_;T={baseState:D.baseState,firstBaseUpdate:U,lastBaseUpdate:G,shared:D.shared,callbacks:D.callbacks},d.updateQueue=T;return}d=T.lastBaseUpdate,d===null?T.firstBaseUpdate=_:d.next=_,T.lastBaseUpdate=_}var Kc=!1;function Jh(){if(Kc){var d=Ho;if(d!==null)throw d}}function Qc(d,_,T,D){Kc=!1;var U=d.updateQueue;Yl=!1;var G=U.firstBaseUpdate,ne=U.lastBaseUpdate,_e=U.shared.pending;if(_e!==null){U.shared.pending=null;var Ue=_e,dt=Ue.next;Ue.next=null,ne===null?G=dt:ne.next=dt,ne=Ue;var At=d.alternate;At!==null&&(At=At.updateQueue,_e=At.lastBaseUpdate,_e!==ne&&(_e===null?At.firstBaseUpdate=dt:_e.next=dt,At.lastBaseUpdate=Ue))}if(G!==null){var Pt=U.baseState;ne=0,At=dt=Ue=null,_e=G;do{var vt=_e.lane&-536870913,bt=vt!==_e.lane;if(bt?(xi&vt)===vt:(D&vt)===vt){vt!==0&&vt===Ea&&(Kc=!0),At!==null&&(At=At.next={lane:0,tag:_e.tag,payload:_e.payload,callback:null,next:null});e:{var fr=d,Lr=_e;vt=_;var sn=T;switch(Lr.tag){case 1:if(fr=Lr.payload,typeof fr=="function"){Pt=fr.call(sn,Pt,vt);break e}Pt=fr;break e;case 3:fr.flags=fr.flags&-65537|128;case 0:if(fr=Lr.payload,vt=typeof fr=="function"?fr.call(sn,Pt,vt):fr,vt==null)break e;Pt=p({},Pt,vt);break e;case 2:Yl=!0}}vt=_e.callback,vt!==null&&(d.flags|=64,bt&&(d.flags|=8192),bt=U.callbacks,bt===null?U.callbacks=[vt]:bt.push(vt))}else bt={lane:vt,tag:_e.tag,payload:_e.payload,callback:_e.callback,next:null},At===null?(dt=At=bt,Ue=Pt):At=At.next=bt,ne|=vt;if(_e=_e.next,_e===null){if(_e=U.shared.pending,_e===null)break;bt=_e,_e=bt.next,bt.next=null,U.lastBaseUpdate=bt,U.shared.pending=null}}while(!0);At===null&&(Ue=Pt),U.baseState=Ue,U.firstBaseUpdate=dt,U.lastBaseUpdate=At,G===null&&(U.shared.lanes=0),hf|=ne,d.lanes=ne,d.memoizedState=Pt}}function js(d,_){if(typeof d!="function")throw Error(i(191,d));d.call(_)}function Sd(d,_){var T=d.callbacks;if(T!==null)for(d.callbacks=null,d=0;d<T.length;d++)js(T[d],_)}var tr=xe(null),gr=xe(0);function Jc(d,_){d=Qu,pt(gr,d),pt(tr,_),Qu=d|_.baseLanes}function Np(){pt(gr,Qu),pt(tr,tr.current)}function ef(){Qu=gr.current,$e(tr),$e(gr)}var Ki=xe(null),jo=null;function _a(d){var _=d.alternate;pt(an,an.current&1),pt(Ki,d),jo===null&&(_===null||tr.current!==null||_.memoizedState!==null)&&(jo=d)}function Ql(d){pt(an,an.current),pt(Ki,d),jo===null&&(jo=d)}function Yy(d){d.tag===22?(pt(an,an.current),pt(Ki,d),jo===null&&(jo=d)):Gu()}function Gu(){pt(an,an.current),pt(Ki,Ki.current)}function $o(d){$e(Ki),jo===d&&(jo=null),$e(an)}var an=xe(0);function Qi(d){for(var _=d;_!==null;){if(_.tag===13){var T=_.memoizedState;if(T!==null&&(T=T.dehydrated,T===null||mx(T)||vf(T)))return _}else if(_.tag===19&&(_.memoizedProps.revealOrder==="forwards"||_.memoizedProps.revealOrder==="backwards"||_.memoizedProps.revealOrder==="unstable_legacy-backwards"||_.memoizedProps.revealOrder==="together")){if((_.flags&128)!==0)return _}else if(_.child!==null){_.child.return=_,_=_.child;continue}if(_===d)break;for(;_.sibling===null;){if(_.return===null||_.return===d)return null;_=_.return}_.sibling.return=_.return,_=_.sibling}return null}var Bi=0,kr=null,Ai=null,hn=null,eh=!1,Tl=!1,Jl=!1,$s=0,Ws=0,Xu=null,Bp=0;function ji(){throw Error(i(321))}function Td(d,_){if(_===null)return!1;for(var T=0;T<_.length&&T<d.length;T++)if(!Ja(d[T],_[T]))return!1;return!0}function Ad(d,_,T,D,U,G){return Bi=G,kr=_,_.memoizedState=null,_.updateQueue=null,_.lanes=0,me.H=d===null||d.memoizedState===null?Fp:Cl,Jl=!1,G=T(D,U),Jl=!1,Tl&&(G=zp(_,T,D,U)),Cd(d),G}function Cd(d){me.H=rh;var _=Ai!==null&&Ai.next!==null;if(Bi=0,hn=Ai=kr=null,eh=!1,Ws=0,Xu=null,_)throw Error(i(300));d===null||aa||(d=d.dependencies,d!==null&&gd(d)&&(aa=!0))}function zp(d,_,T,D){kr=d;var U=0;do{if(Tl&&(Xu=null),Ws=0,Tl=!1,25<=U)throw Error(i(301));if(U+=1,hn=Ai=null,d.updateQueue!=null){var G=d.updateQueue;G.lastEffect=null,G.events=null,G.stores=null,G.memoCache!=null&&(G.memoCache.index=0)}me.H=Vp,G=_(T,D)}while(Tl);return G}function I(){var d=me.H,_=d.useState()[0];return _=typeof _.then=="function"?H(_):_,d=d.useState()[0],(Ai!==null?Ai.memoizedState:null)!==d&&(kr.flags|=1024),_}function u(){var d=$s!==0;return $s=0,d}function m(d,_,T){_.updateQueue=d.updateQueue,_.flags&=-2053,d.lanes&=~T}function w(d){if(eh){for(d=d.memoizedState;d!==null;){var _=d.queue;_!==null&&(_.pending=null),d=d.next}eh=!1}Bi=0,hn=Ai=kr=null,Tl=!1,Ws=$s=0,Xu=null}function M(){var d={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return hn===null?kr.memoizedState=hn=d:hn=hn.next=d,hn}function R(){if(Ai===null){var d=kr.alternate;d=d!==null?d.memoizedState:null}else d=Ai.next;var _=hn===null?kr.memoizedState:hn.next;if(_!==null)hn=_,Ai=d;else{if(d===null)throw kr.alternate===null?Error(i(467)):Error(i(310));Ai=d,d={memoizedState:Ai.memoizedState,baseState:Ai.baseState,baseQueue:Ai.baseQueue,queue:Ai.queue,next:null},hn===null?kr.memoizedState=hn=d:hn=hn.next=d}return hn}function N(){return{lastEffect:null,events:null,stores:null,memoCache:null}}function H(d){var _=Ws;return Ws+=1,Xu===null&&(Xu=[]),d=Yc(Xu,d,_),_=kr,(hn===null?_.memoizedState:hn.next)===null&&(_=_.alternate,me.H=_===null||_.memoizedState===null?Fp:Cl),d}function j(d){if(d!==null&&typeof d=="object"){if(typeof d.then=="function")return H(d);if(d.$$typeof===B)return ya(d)}throw Error(i(438,String(d)))}function Y(d){var _=null,T=kr.updateQueue;if(T!==null&&(_=T.memoCache),_==null){var D=kr.alternate;D!==null&&(D=D.updateQueue,D!==null&&(D=D.memoCache,D!=null&&(_={data:D.data.map(function(U){return U.slice()}),index:0})))}if(_==null&&(_={data:[],index:0}),T===null&&(T=N(),kr.updateQueue=T),T.memoCache=_,T=_.data[_.index],T===void 0)for(T=_.data[_.index]=Array(d),D=0;D<d;D++)T[D]=te;return _.index++,T}function K(d,_){return typeof _=="function"?_(d):_}function ie(d){var _=R();return re(_,Ai,d)}function re(d,_,T){var D=d.queue;if(D===null)throw Error(i(311));D.lastRenderedReducer=T;var U=d.baseQueue,G=D.pending;if(G!==null){if(U!==null){var ne=U.next;U.next=G.next,G.next=ne}_.baseQueue=U=G,D.pending=null}if(G=d.baseState,U===null)d.memoizedState=G;else{_=U.next;var _e=ne=null,Ue=null,dt=_,At=!1;do{var Pt=dt.lane&-536870913;if(Pt!==dt.lane?(xi&Pt)===Pt:(Bi&Pt)===Pt){var vt=dt.revertLane;if(vt===0)Ue!==null&&(Ue=Ue.next={lane:0,revertLane:0,gesture:null,action:dt.action,hasEagerState:dt.hasEagerState,eagerState:dt.eagerState,next:null}),Pt===Ea&&(At=!0);else if((Bi&vt)===vt){dt=dt.next,vt===Ea&&(At=!0);continue}else Pt={lane:0,revertLane:dt.revertLane,gesture:null,action:dt.action,hasEagerState:dt.hasEagerState,eagerState:dt.eagerState,next:null},Ue===null?(_e=Ue=Pt,ne=G):Ue=Ue.next=Pt,kr.lanes|=vt,hf|=vt;Pt=dt.action,Jl&&T(G,Pt),G=dt.hasEagerState?dt.eagerState:T(G,Pt)}else vt={lane:Pt,revertLane:dt.revertLane,gesture:dt.gesture,action:dt.action,hasEagerState:dt.hasEagerState,eagerState:dt.eagerState,next:null},Ue===null?(_e=Ue=vt,ne=G):Ue=Ue.next=vt,kr.lanes|=Pt,hf|=Pt;dt=dt.next}while(dt!==null&&dt!==_);if(Ue===null?ne=G:Ue.next=_e,!Ja(G,d.memoizedState)&&(aa=!0,At&&(T=Ho,T!==null)))throw T;d.memoizedState=G,d.baseState=ne,d.baseQueue=Ue,D.lastRenderedState=G}return U===null&&(D.lanes=0),[d.memoizedState,D.dispatch]}function ue(d){var _=R(),T=_.queue;if(T===null)throw Error(i(311));T.lastRenderedReducer=d;var D=T.dispatch,U=T.pending,G=_.memoizedState;if(U!==null){T.pending=null;var ne=U=U.next;do G=d(G,ne.action),ne=ne.next;while(ne!==U);Ja(G,_.memoizedState)||(aa=!0),_.memoizedState=G,_.baseQueue===null&&(_.baseState=G),T.lastRenderedState=G}return[G,D]}function pe(d,_,T){var D=kr,U=R(),G=ai;if(G){if(T===void 0)throw Error(i(407));T=T()}else T=_();var ne=!Ja((Ai||U).memoizedState,T);if(ne&&(U.memoizedState=T,aa=!0),U=U.queue,Jr(Ce.bind(null,D,U,d),[d]),U.getSnapshot!==_||ne||hn!==null&&hn.memoizedState.tag&1){if(D.flags|=2048,gi(9,{destroy:void 0},Te.bind(null,D,U,T,_),null),en===null)throw Error(i(349));G||(Bi&127)!==0||Se(D,_,T)}return T}function Se(d,_,T){d.flags|=16384,d={getSnapshot:_,value:T},_=kr.updateQueue,_===null?(_=N(),kr.updateQueue=_,_.stores=[d]):(T=_.stores,T===null?_.stores=[d]:T.push(d))}function Te(d,_,T,D){_.value=T,_.getSnapshot=D,Ie(_)&&ke(d)}function Ce(d,_,T){return T(function(){Ie(_)&&ke(d)})}function Ie(d){var _=d.getSnapshot;d=d.value;try{var T=_();return!Ja(d,T)}catch{return!0}}function ke(d){var _=ss(d,2);_!==null&&Co(_,d,2)}function Re(d){var _=M();if(typeof d=="function"){var T=d;if(d=T(),Jl){We(!0);try{T()}finally{We(!1)}}}return _.memoizedState=_.baseState=d,_.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:K,lastRenderedState:d},_}function ze(d,_,T,D){return d.baseState=T,re(d,Ai,typeof D=="function"?D:K)}function He(d,_,T,D,U){if(Ao(d))throw Error(i(485));if(d=_.action,d!==null){var G={payload:U,action:d,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(ne){G.listeners.push(ne)}};me.T!==null?T(!0):G.isTransition=!1,D(G),T=_.pending,T===null?(G.next=_.pending=G,Le(_,G)):(G.next=T.next,_.pending=T.next=G)}}function Le(d,_){var T=_.action,D=_.payload,U=d.state;if(_.isTransition){var G=me.T,ne={};me.T=ne;try{var _e=T(U,D),Ue=me.S;Ue!==null&&Ue(ne,_e),Xe(d,_,_e)}catch(dt){at(d,_,dt)}finally{G!==null&&ne.types!==null&&(G.types=ne.types),me.T=G}}else try{G=T(U,D),Xe(d,_,G)}catch(dt){at(d,_,dt)}}function Xe(d,_,T){T!==null&&typeof T=="object"&&typeof T.then=="function"?T.then(function(D){ht(d,_,D)},function(D){return at(d,_,D)}):ht(d,_,T)}function ht(d,_,T){_.status="fulfilled",_.value=T,st(_),d.state=T,_=d.pending,_!==null&&(T=_.next,T===_?d.pending=null:(T=T.next,_.next=T,Le(d,T)))}function at(d,_,T){var D=d.pending;if(d.pending=null,D!==null){D=D.next;do _.status="rejected",_.reason=T,st(_),_=_.next;while(_!==D)}d.action=null}function st(d){d=d.listeners;for(var _=0;_<d.length;_++)(0,d[_])()}function lt(d,_){return _}function Ot(d,_){if(ai){var T=en.formState;if(T!==null){e:{var D=kr;if(ai){if(Oi){t:{for(var U=Oi,G=Vo;U.nodeType!==8;){if(!G){U=null;break t}if(U=ps(U.nextSibling),U===null){U=null;break t}}G=U.data,U=G==="F!"||G==="F"?U:null}if(U){Oi=ps(U.nextSibling),D=U.data==="F!";break e}}xo(D)}D=!1}D&&(_=T[0])}}return T=M(),T.memoizedState=T.baseState=_,D={pending:null,lanes:0,dispatch:null,lastRenderedReducer:lt,lastRenderedState:_},T.queue=D,T=rf.bind(null,kr,D),D.dispatch=T,D=Re(!1),G=Zs.bind(null,kr,!1,D.queue),D=M(),U={state:_,dispatch:null,action:d,pending:null},D.queue=U,T=He.bind(null,kr,U,G,T),U.dispatch=T,D.memoizedState=d,[_,T,!1]}function Bt(d){var _=R();return Ct(_,Ai,d)}function Ct(d,_,T){if(_=re(d,_,lt)[0],d=ie(K)[0],typeof _=="object"&&_!==null&&typeof _.then=="function")try{var D=H(_)}catch(ne){throw ne===qc?Fu:ne}else D=_;_=R();var U=_.queue,G=U.dispatch;return T!==_.memoizedState&&(kr.flags|=2048,gi(9,{destroy:void 0},nr.bind(null,U,T),null)),[D,G,d]}function nr(d,_){d.action=_}function Pr(d){var _=R(),T=Ai;if(T!==null)return Ct(_,T,d);R(),_=_.memoizedState,T=R();var D=T.queue.dispatch;return T.memoizedState=d,[_,D,!1]}function gi(d,_,T,D){return d={tag:d,create:T,deps:D,inst:_,next:null},_=kr.updateQueue,_===null&&(_=N(),kr.updateQueue=_),T=_.lastEffect,T===null?_.lastEffect=d.next=d:(D=T.next,T.next=d,d.next=D,_.lastEffect=d),d}function Mi(){return R().memoizedState}function Ei(d,_,T,D){var U=M();kr.flags|=d,U.memoizedState=gi(1|_,{destroy:void 0},T,D===void 0?null:D)}function Ji(d,_,T,D){var U=R();D=D===void 0?null:D;var G=U.memoizedState.inst;Ai!==null&&D!==null&&Td(D,Ai.memoizedState.deps)?U.memoizedState=gi(_,G,T,D):(kr.flags|=d,U.memoizedState=gi(1|_,G,T,D))}function $i(d,_){Ei(8390656,8,d,_)}function Jr(d,_){Ji(2048,8,d,_)}function fn(d){kr.flags|=4;var _=kr.updateQueue;if(_===null)_=N(),kr.updateQueue=_,_.events=[d];else{var T=_.events;T===null?_.events=[d]:T.push(d)}}function ba(d){var _=R().memoizedState;return fn({ref:_,nextImpl:d}),function(){if((Ci&2)!==0)throw Error(i(440));return _.impl.apply(void 0,arguments)}}function kn(d,_){return Ji(4,2,d,_)}function Ln(d,_){return Ji(4,4,d,_)}function Va(d,_){if(typeof _=="function"){d=d();var T=_(d);return function(){typeof T=="function"?T():_(null)}}if(_!=null)return d=d(),_.current=d,function(){_.current=null}}function eu(d,_,T){T=T!=null?T.concat([d]):null,Ji(4,4,Va.bind(null,_,d),T)}function Wo(){}function tu(d,_){var T=R();_=_===void 0?null:_;var D=T.memoizedState;return _!==null&&Td(_,D[1])?D[0]:(T.memoizedState=[d,_],d)}function Zu(d,_){var T=R();_=_===void 0?null:_;var D=T.memoizedState;if(_!==null&&Td(_,D[1]))return D[0];if(D=d(),Jl){We(!0);try{d()}finally{We(!1)}}return T.memoizedState=[D,_],D}function tf(d,_,T){return T===void 0||(Bi&1073741824)!==0&&(xi&261930)===0?d.memoizedState=_:(d.memoizedState=T,d=Zb(),kr.lanes|=d,hf|=d,T)}function th(d,_,T,D){return Ja(T,_)?T:tr.current!==null?(d=tf(d,T,D),Ja(d,_)||(aa=!0),d):(Bi&42)===0||(Bi&1073741824)!==0&&(xi&261930)===0?(aa=!0,d.memoizedState=T):(d=Zb(),kr.lanes|=d,hf|=d,_)}function Al(d,_,T,D,U){var G=De.p;De.p=G!==0&&8>G?G:8;var ne=me.T,_e={};me.T=_e,Zs(d,!1,_,T);try{var Ue=U(),dt=me.S;if(dt!==null&&dt(_e,Ue),Ue!==null&&typeof Ue=="object"&&typeof Ue.then=="function"){var At=Eb(Ue,D);Xs(d,_,At,ds(d))}else Xs(d,_,D,ds(d))}catch(Pt){Xs(d,_,{then:function(){},status:"rejected",reason:Pt},ds())}finally{De.p=G,ne!==null&&_e.types!==null&&(ne.types=_e.types),me.T=ne}}function Go(){}function hs(d,_,T,D){if(d.tag!==5)throw Error(i(476));var U=Gs(d).queue;Al(d,U,_,Fe,T===null?Go:function(){return So(d),T(D)})}function Gs(d){var _=d.memoizedState;if(_!==null)return _;_={memoizedState:Fe,baseState:Fe,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:K,lastRenderedState:Fe},next:null};var T={};return _.next={memoizedState:T,baseState:T,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:K,lastRenderedState:T},next:null},d.memoizedState=_,d=d.alternate,d!==null&&(d.memoizedState=_),_}function So(d){var _=Gs(d);_.next===null&&(_=d.alternate.memoizedState),Xs(d,_.next.queue,{},ds())}function _n(){return ya(gt)}function Xn(){return R().memoizedState}function To(){return R().memoizedState}function xa(d){for(var _=d.return;_!==null;){switch(_.tag){case 24:case 3:var T=ds();d=Kl(T);var D=cs(_,d,T);D!==null&&(Co(D,_,T),Wu(D,_,T)),_={cache:md()},d.payload=_;return}_=_.return}}function Cv(d,_,T){var D=ds();T={lane:D,revertLane:0,gesture:null,action:T,hasEagerState:!1,eagerState:null,next:null},Ao(d)?ru(_,T):(T=Ru(d,_,T,D),T!==null&&(Co(T,d,D),iu(T,_,D)))}function rf(d,_,T){var D=ds();Xs(d,_,T,D)}function Xs(d,_,T,D){var U={lane:D,revertLane:0,gesture:null,action:T,hasEagerState:!1,eagerState:null,next:null};if(Ao(d))ru(_,U);else{var G=d.alternate;if(d.lanes===0&&(G===null||G.lanes===0)&&(G=_.lastRenderedReducer,G!==null))try{var ne=_.lastRenderedState,_e=G(ne,T);if(U.hasEagerState=!0,U.eagerState=_e,Ja(_e,ne))return cd(d,_,U,0),en===null&&jc(),!1}catch{}finally{}if(T=Ru(d,_,U,D),T!==null)return Co(T,d,D),iu(T,_,D),!0}return!1}function Zs(d,_,T,D){if(D={lane:2,revertLane:pf(),gesture:null,action:D,hasEagerState:!1,eagerState:null,next:null},Ao(d)){if(_)throw Error(i(479))}else _=Ru(d,T,D,2),_!==null&&Co(_,d,2)}function Ao(d){var _=d.alternate;return d===kr||_!==null&&_===kr}function ru(d,_){Tl=eh=!0;var T=d.pending;T===null?_.next=_:(_.next=T.next,T.next=_),d.pending=_}function iu(d,_,T){if((T&4194048)!==0){var D=_.lanes;D&=d.pendingLanes,T|=D,_.lanes=T,Vi(d,T)}}var rh={readContext:ya,use:j,useCallback:ji,useContext:ji,useEffect:ji,useImperativeHandle:ji,useLayoutEffect:ji,useInsertionEffect:ji,useMemo:ji,useReducer:ji,useRef:ji,useState:ji,useDebugValue:ji,useDeferredValue:ji,useTransition:ji,useSyncExternalStore:ji,useId:ji,useHostTransitionStatus:ji,useFormState:ji,useActionState:ji,useOptimistic:ji,useMemoCache:ji,useCacheRefresh:ji};rh.useEffectEvent=ji;var Fp={readContext:ya,use:j,useCallback:function(d,_){return M().memoizedState=[d,_===void 0?null:_],d},useContext:ya,useEffect:$i,useImperativeHandle:function(d,_,T){T=T!=null?T.concat([d]):null,Ei(4194308,4,Va.bind(null,_,d),T)},useLayoutEffect:function(d,_){return Ei(4194308,4,d,_)},useInsertionEffect:function(d,_){Ei(4,2,d,_)},useMemo:function(d,_){var T=M();_=_===void 0?null:_;var D=d();if(Jl){We(!0);try{d()}finally{We(!1)}}return T.memoizedState=[D,_],D},useReducer:function(d,_,T){var D=M();if(T!==void 0){var U=T(_);if(Jl){We(!0);try{T(_)}finally{We(!1)}}}else U=_;return D.memoizedState=D.baseState=U,d={pending:null,lanes:0,dispatch:null,lastRenderedReducer:d,lastRenderedState:U},D.queue=d,d=d.dispatch=Cv.bind(null,kr,d),[D.memoizedState,d]},useRef:function(d){var _=M();return d={current:d},_.memoizedState=d},useState:function(d){d=Re(d);var _=d.queue,T=rf.bind(null,kr,_);return _.dispatch=T,[d.memoizedState,T]},useDebugValue:Wo,useDeferredValue:function(d,_){var T=M();return tf(T,d,_)},useTransition:function(){var d=Re(!1);return d=Al.bind(null,kr,d.queue,!0,!1),M().memoizedState=d,[!1,d]},useSyncExternalStore:function(d,_,T){var D=kr,U=M();if(ai){if(T===void 0)throw Error(i(407));T=T()}else{if(T=_(),en===null)throw Error(i(349));(xi&127)!==0||Se(D,_,T)}U.memoizedState=T;var G={value:T,getSnapshot:_};return U.queue=G,$i(Ce.bind(null,D,G,d),[d]),D.flags|=2048,gi(9,{destroy:void 0},Te.bind(null,D,G,T,_),null),T},useId:function(){var d=M(),_=en.identifierPrefix;if(ai){var T=bo,D=_l;T=(D&~(1<<32-it(D)-1)).toString(32)+T,_="_"+_+"R_"+T,T=$s++,0<T&&(_+="H"+T.toString(32)),_+="_"}else T=Bp++,_="_"+_+"r_"+T.toString(32)+"_";return d.memoizedState=_},useHostTransitionStatus:_n,useFormState:Ot,useActionState:Ot,useOptimistic:function(d){var _=M();_.memoizedState=_.baseState=d;var T={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return _.queue=T,_=Zs.bind(null,kr,!0,T),T.dispatch=_,[d,_]},useMemoCache:Y,useCacheRefresh:function(){return M().memoizedState=xa.bind(null,kr)},useEffectEvent:function(d){var _=M(),T={impl:d};return _.memoizedState=T,function(){if((Ci&2)!==0)throw Error(i(440));return T.impl.apply(void 0,arguments)}}},Cl={readContext:ya,use:j,useCallback:tu,useContext:ya,useEffect:Jr,useImperativeHandle:eu,useInsertionEffect:kn,useLayoutEffect:Ln,useMemo:Zu,useReducer:ie,useRef:Mi,useState:function(){return ie(K)},useDebugValue:Wo,useDeferredValue:function(d,_){var T=R();return th(T,Ai.memoizedState,d,_)},useTransition:function(){var d=ie(K)[0],_=R().memoizedState;return[typeof d=="boolean"?d:H(d),_]},useSyncExternalStore:pe,useId:Xn,useHostTransitionStatus:_n,useFormState:Bt,useActionState:Bt,useOptimistic:function(d,_){var T=R();return ze(T,Ai,d,_)},useMemoCache:Y,useCacheRefresh:To};Cl.useEffectEvent=ba;var Vp={readContext:ya,use:j,useCallback:tu,useContext:ya,useEffect:Jr,useImperativeHandle:eu,useInsertionEffect:kn,useLayoutEffect:Ln,useMemo:Zu,useReducer:ue,useRef:Mi,useState:function(){return ue(K)},useDebugValue:Wo,useDeferredValue:function(d,_){var T=R();return Ai===null?tf(T,d,_):th(T,Ai.memoizedState,d,_)},useTransition:function(){var d=ue(K)[0],_=R().memoizedState;return[typeof d=="boolean"?d:H(d),_]},useSyncExternalStore:pe,useId:Xn,useHostTransitionStatus:_n,useFormState:Pr,useActionState:Pr,useOptimistic:function(d,_){var T=R();return Ai!==null?ze(T,Ai,d,_):(T.baseState=d,[d,T.queue.dispatch])},useMemoCache:Y,useCacheRefresh:To};Vp.useEffectEvent=ba;function Md(d,_,T,D){_=d.memoizedState,T=T(D,_),T=T==null?_:p({},_,T),d.memoizedState=T,d.lanes===0&&(d.updateQueue.baseState=T)}var ih={enqueueSetState:function(d,_,T){d=d._reactInternals;var D=ds(),U=Kl(D);U.payload=_,T!=null&&(U.callback=T),_=cs(d,U,D),_!==null&&(Co(_,d,D),Wu(_,d,D))},enqueueReplaceState:function(d,_,T){d=d._reactInternals;var D=ds(),U=Kl(D);U.tag=1,U.payload=_,T!=null&&(U.callback=T),_=cs(d,U,D),_!==null&&(Co(_,d,D),Wu(_,d,D))},enqueueForceUpdate:function(d,_){d=d._reactInternals;var T=ds(),D=Kl(T);D.tag=2,_!=null&&(D.callback=_),_=cs(d,D,T),_!==null&&(Co(_,d,T),Wu(_,d,T))}};function Ib(d,_,T,D,U,G,ne){return d=d.stateNode,typeof d.shouldComponentUpdate=="function"?d.shouldComponentUpdate(D,G,ne):_.prototype&&_.prototype.isPureReactComponent?!Pu(T,D)||!Pu(U,G):!0}function nf(d,_,T,D){d=_.state,typeof _.componentWillReceiveProps=="function"&&_.componentWillReceiveProps(T,D),typeof _.UNSAFE_componentWillReceiveProps=="function"&&_.UNSAFE_componentWillReceiveProps(T,D),_.state!==d&&ih.enqueueReplaceState(_,_.state,null)}function qs(d,_){var T=_;if("ref"in _){T={};for(var D in _)D!=="ref"&&(T[D]=_[D])}if(d=d.defaultProps){T===_&&(T=p({},T));for(var U in d)T[U]===void 0&&(T[U]=d[U])}return T}function Pb(d){yl(d)}function cS(d){console.error(d)}function Ky(d){yl(d)}function Mv(d,_){try{var T=d.onUncaughtError;T(_.value,{componentStack:_.stack})}catch(D){setTimeout(function(){throw D})}}function Ev(d,_,T){try{var D=d.onCaughtError;D(T.value,{componentStack:T.stack,errorBoundary:_.tag===1?_.stateNode:null})}catch(U){setTimeout(function(){throw U})}}function Qy(d,_,T){return T=Kl(T),T.tag=3,T.payload={element:null},T.callback=function(){Mv(d,_)},T}function hS(d){return d=Kl(d),d.tag=3,d}function Jy(d,_,T,D){var U=T.type.getDerivedStateFromError;if(typeof U=="function"){var G=D.value;d.payload=function(){return U(G)},d.callback=function(){Ev(_,T,D)}}var ne=T.stateNode;ne!==null&&typeof ne.componentDidCatch=="function"&&(d.callback=function(){Ev(_,T,D),typeof U!="function"&&(lh===null?lh=new Set([this]):lh.add(this));var _e=D.stack;this.componentDidCatch(D.value,{componentStack:_e!==null?_e:""})})}function fM(d,_,T,D,U){if(T.flags|=32768,D!==null&&typeof D=="object"&&typeof D.then=="function"){if(_=T.alternate,_!==null&&ls(_,T,U,!0),T=Ki.current,T!==null){switch(T.tag){case 31:case 13:return jo===null?f_():T.alternate===null&&Zn===0&&(Zn=3),T.flags&=-257,T.flags|=65536,T.lanes=U,D===Vu?T.flags|=16384:(_=T.updateQueue,_===null?T.updateQueue=new Set([D]):_.add(D),Wv(d,D,U)),!1;case 22:return T.flags|=65536,D===Vu?T.flags|=16384:(_=T.updateQueue,_===null?(_={transitions:null,markerInstances:null,retryQueue:new Set([D])},T.updateQueue=_):(T=_.retryQueue,T===null?_.retryQueue=new Set([D]):T.add(D)),Wv(d,D,U)),!1}throw Error(i(435,T.tag))}return Wv(d,D,U),f_(),!1}if(ai)return _=Ki.current,_!==null?((_.flags&65536)===0&&(_.flags|=256),_.flags|=65536,_.lanes=U,D!==yn&&(d=Error(i(422),{cause:D}),bl(to(d,T)))):(D!==yn&&(_=Error(i(423),{cause:D}),bl(to(_,T))),d=d.current.alternate,d.flags|=65536,U&=-U,d.lanes|=U,D=to(D,T),U=Qy(d.stateNode,D,U),wd(d,U),Zn!==4&&(Zn=2)),!1;var G=Error(i(520),{cause:D});if(G=to(G,T),Nd===null?Nd=[G]:Nd.push(G),Zn!==4&&(Zn=2),_===null)return!0;D=to(D,T),T=_;do{switch(T.tag){case 3:return T.flags|=65536,d=U&-U,T.lanes|=d,d=Qy(T.stateNode,D,d),wd(T,d),!1;case 1:if(_=T.type,G=T.stateNode,(T.flags&128)===0&&(typeof _.getDerivedStateFromError=="function"||G!==null&&typeof G.componentDidCatch=="function"&&(lh===null||!lh.has(G))))return T.flags|=65536,U&=-U,T.lanes|=U,U=hS(U),Jy(U,d,T,D),wd(T,U),!1}T=T.return}while(T!==null);return!1}var Iv=Error(i(461)),aa=!1;function Ua(d,_,T,D){_.child=d===null?Av(_,null,T,D):$u(_,d.child,T,D)}function Ed(d,_,T,D,U){T=T.render;var G=_.ref;if("ref"in D){var ne={};for(var _e in D)_e!=="ref"&&(ne[_e]=D[_e])}else ne=D;return Nu(_),D=Ad(d,_,T,ne,G,U),_e=u(),d!==null&&!aa?(m(d,_,U),nu(d,_,U)):(ai&&_e&&Gc(_),_.flags|=1,Ua(d,_,D,U),_.child)}function fS(d,_,T,D,U){if(d===null){var G=T.type;return typeof G=="function"&&!hd(G)&&G.defaultProps===void 0&&T.compare===null?(_.tag=15,_.type=G,Id(d,_,G,D,U)):(d=$c(T.type,null,D,_,_.mode,U),d.ref=_.ref,d.return=_,_.child=d)}if(G=d.child,!Ob(d,U)){var ne=G.memoizedProps;if(T=T.compare,T=T!==null?T:Pu,T(ne,D)&&d.ref===_.ref)return nu(d,_,U)}return _.flags|=1,d=Fo(G,D),d.ref=_.ref,d.return=_,_.child=d}function Id(d,_,T,D,U){if(d!==null){var G=d.memoizedProps;if(Pu(G,D)&&d.ref===_.ref)if(aa=!1,_.pendingProps=D=G,Ob(d,U))(d.flags&131072)!==0&&(aa=!0);else return _.lanes=d.lanes,nu(d,_,U)}return Dv(d,_,T,D,U)}function Pv(d,_,T,D){var U=D.children,G=d!==null?d.memoizedState:null;if(d===null&&_.stateNode===null&&(_.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),D.mode==="hidden"){if((_.flags&128)!==0){if(G=G!==null?G.baseLanes|T:T,d!==null){for(D=_.child=d.child,U=0;D!==null;)U=U|D.lanes|D.childLanes,D=D.sibling;D=U&~G}else D=0,_.child=null;return dS(d,_,G,T,D)}if((T&536870912)!==0)_.memoizedState={baseLanes:0,cachePool:null},d!==null&&us(_,G!==null?G.cachePool:null),G!==null?Jc(_,G):Np(),Yy(_);else return D=_.lanes=536870912,dS(d,_,G!==null?G.baseLanes|T:T,T,D)}else G!==null?(us(_,G.cachePool),Jc(_,G),Gu(),_.memoizedState=null):(d!==null&&us(_,null),Np(),Gu());return Ua(d,_,U,T),_.child}function af(d,_){return d!==null&&d.tag===22||_.stateNode!==null||(_.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),_.sibling}function dS(d,_,T,D,U){var G=Zc();return G=G===null?null:{parent:Yi._currentValue,pool:G},_.memoizedState={baseLanes:T,cachePool:G},d!==null&&us(_,null),Np(),Yy(_),d!==null&&ls(d,_,D,!0),_.childLanes=U,null}function e_(d,_){return _=Lv({mode:_.mode,children:_.children},d.mode),_.ref=d.ref,d.child=_,_.return=d,_}function pS(d,_,T){return $u(_,d.child,null,T),d=e_(_,_.pendingProps),d.flags|=2,$o(_),_.memoizedState=null,d}function dM(d,_,T){var D=_.pendingProps,U=(_.flags&128)!==0;if(_.flags&=-129,d===null){if(ai){if(D.mode==="hidden")return d=e_(_,D),_.lanes=536870912,af(null,d);if(Ql(_),(d=Oi)?(d=$S(d,Vo),d=d!==null&&d.data==="&"?d:null,d!==null&&(_.memoizedState={dehydrated:d,treeContext:Fs!==null?{id:_l,overflow:bo}:null,retryLane:536870912,hydrationErrors:null},T=kp(d),T.return=_,_.child=T,Gn=_,Oi=null)):d=null,d===null)throw xo(_);return _.lanes=536870912,null}return e_(_,D)}var G=d.memoizedState;if(G!==null){var ne=G.dehydrated;if(Ql(_),U)if(_.flags&256)_.flags&=-257,_=pS(d,_,T);else if(_.memoizedState!==null)_.child=d.child,_.flags|=128,_=null;else throw Error(i(558));else if(aa||ls(d,_,T,!1),U=(T&d.childLanes)!==0,aa||U){if(D=en,D!==null&&(ne=$n(D,T),ne!==0&&ne!==G.retryLane))throw G.retryLane=ne,ss(d,ne),Co(D,d,ne),Iv;f_(),_=pS(d,_,T)}else d=G.treeContext,Oi=ps(ne.nextSibling),Gn=_,ai=!0,Vs=null,Vo=!1,d!==null&&dd(_,d),_=e_(_,D),_.flags|=4096;return _}return d=Fo(d.child,{mode:D.mode,children:D.children}),d.ref=_.ref,_.child=d,d.return=_,d}function Rv(d,_){var T=_.ref;if(T===null)d!==null&&d.ref!==null&&(_.flags|=4194816);else{if(typeof T!="function"&&typeof T!="object")throw Error(i(284));(d===null||d.ref!==T)&&(_.flags|=4194816)}}function Dv(d,_,T,D,U){return Nu(_),T=Ad(d,_,T,D,void 0,U),D=u(),d!==null&&!aa?(m(d,_,U),nu(d,_,U)):(ai&&D&&Gc(_),_.flags|=1,Ua(d,_,T,U),_.child)}function Rb(d,_,T,D,U,G){return Nu(_),_.updateQueue=null,T=zp(_,D,T,U),Cd(d),D=u(),d!==null&&!aa?(m(d,_,G),nu(d,_,G)):(ai&&D&&Gc(_),_.flags|=1,Ua(d,_,T,G),_.child)}function Db(d,_,T,D,U){if(Nu(_),_.stateNode===null){var G=jr,ne=T.contextType;typeof ne=="object"&&ne!==null&&(G=ya(ne)),G=new T(D,G),_.memoizedState=G.state!==null&&G.state!==void 0?G.state:null,G.updater=ih,_.stateNode=G,G._reactInternals=_,G=_.stateNode,G.props=D,G.state=_.memoizedState,G.refs={},Sl(_),ne=T.contextType,G.context=typeof ne=="object"&&ne!==null?ya(ne):jr,G.state=_.memoizedState,ne=T.getDerivedStateFromProps,typeof ne=="function"&&(Md(_,T,ne,D),G.state=_.memoizedState),typeof T.getDerivedStateFromProps=="function"||typeof G.getSnapshotBeforeUpdate=="function"||typeof G.UNSAFE_componentWillMount!="function"&&typeof G.componentWillMount!="function"||(ne=G.state,typeof G.componentWillMount=="function"&&G.componentWillMount(),typeof G.UNSAFE_componentWillMount=="function"&&G.UNSAFE_componentWillMount(),ne!==G.state&&ih.enqueueReplaceState(G,G.state,null),Qc(_,D,G,U),Jh(),G.state=_.memoizedState),typeof G.componentDidMount=="function"&&(_.flags|=4194308),D=!0}else if(d===null){G=_.stateNode;var _e=_.memoizedProps,Ue=qs(T,_e);G.props=Ue;var dt=G.context,At=T.contextType;ne=jr,typeof At=="object"&&At!==null&&(ne=ya(At));var Pt=T.getDerivedStateFromProps;At=typeof Pt=="function"||typeof G.getSnapshotBeforeUpdate=="function",_e=_.pendingProps!==_e,At||typeof G.UNSAFE_componentWillReceiveProps!="function"&&typeof G.componentWillReceiveProps!="function"||(_e||dt!==ne)&&nf(_,G,D,ne),Yl=!1;var vt=_.memoizedState;G.state=vt,Qc(_,D,G,U),Jh(),dt=_.memoizedState,_e||vt!==dt||Yl?(typeof Pt=="function"&&(Md(_,T,Pt,D),dt=_.memoizedState),(Ue=Yl||Ib(_,T,Ue,D,vt,dt,ne))?(At||typeof G.UNSAFE_componentWillMount!="function"&&typeof G.componentWillMount!="function"||(typeof G.componentWillMount=="function"&&G.componentWillMount(),typeof G.UNSAFE_componentWillMount=="function"&&G.UNSAFE_componentWillMount()),typeof G.componentDidMount=="function"&&(_.flags|=4194308)):(typeof G.componentDidMount=="function"&&(_.flags|=4194308),_.memoizedProps=D,_.memoizedState=dt),G.props=D,G.state=dt,G.context=ne,D=Ue):(typeof G.componentDidMount=="function"&&(_.flags|=4194308),D=!1)}else{G=_.stateNode,Ni(d,_),ne=_.memoizedProps,At=qs(T,ne),G.props=At,Pt=_.pendingProps,vt=G.context,dt=T.contextType,Ue=jr,typeof dt=="object"&&dt!==null&&(Ue=ya(dt)),_e=T.getDerivedStateFromProps,(dt=typeof _e=="function"||typeof G.getSnapshotBeforeUpdate=="function")||typeof G.UNSAFE_componentWillReceiveProps!="function"&&typeof G.componentWillReceiveProps!="function"||(ne!==Pt||vt!==Ue)&&nf(_,G,D,Ue),Yl=!1,vt=_.memoizedState,G.state=vt,Qc(_,D,G,U),Jh();var bt=_.memoizedState;ne!==Pt||vt!==bt||Yl||d!==null&&d.dependencies!==null&&gd(d.dependencies)?(typeof _e=="function"&&(Md(_,T,_e,D),bt=_.memoizedState),(At=Yl||Ib(_,T,At,D,vt,bt,Ue)||d!==null&&d.dependencies!==null&&gd(d.dependencies))?(dt||typeof G.UNSAFE_componentWillUpdate!="function"&&typeof G.componentWillUpdate!="function"||(typeof G.componentWillUpdate=="function"&&G.componentWillUpdate(D,bt,Ue),typeof G.UNSAFE_componentWillUpdate=="function"&&G.UNSAFE_componentWillUpdate(D,bt,Ue)),typeof G.componentDidUpdate=="function"&&(_.flags|=4),typeof G.getSnapshotBeforeUpdate=="function"&&(_.flags|=1024)):(typeof G.componentDidUpdate!="function"||ne===d.memoizedProps&&vt===d.memoizedState||(_.flags|=4),typeof G.getSnapshotBeforeUpdate!="function"||ne===d.memoizedProps&&vt===d.memoizedState||(_.flags|=1024),_.memoizedProps=D,_.memoizedState=bt),G.props=D,G.state=bt,G.context=Ue,D=At):(typeof G.componentDidUpdate!="function"||ne===d.memoizedProps&&vt===d.memoizedState||(_.flags|=4),typeof G.getSnapshotBeforeUpdate!="function"||ne===d.memoizedProps&&vt===d.memoizedState||(_.flags|=1024),D=!1)}return G=D,Rv(d,_),D=(_.flags&128)!==0,G||D?(G=_.stateNode,T=D&&typeof T.getDerivedStateFromError!="function"?null:G.render(),_.flags|=1,d!==null&&D?(_.child=$u(_,d.child,null,U),_.child=$u(_,null,T,U)):Ua(d,_,T,U),_.memoizedState=G.state,d=_.child):d=nu(d,_,U),d}function gS(d,_,T,D){return Xl(),_.flags|=256,Ua(d,_,T,D),_.child}var kb={dehydrated:null,treeContext:null,retryLane:0,hydrationErrors:null};function t_(d){return{baseLanes:d,cachePool:Zt()}}function r_(d,_,T){return d=d!==null?d.childLanes&~T:0,_&&(d|=Ks),d}function vS(d,_,T){var D=_.pendingProps,U=!1,G=(_.flags&128)!==0,ne;if((ne=G)||(ne=d!==null&&d.memoizedState===null?!1:(an.current&2)!==0),ne&&(U=!0,_.flags&=-129),ne=(_.flags&32)!==0,_.flags&=-33,d===null){if(ai){if(U?_a(_):Gu(),(d=Oi)?(d=$S(d,Vo),d=d!==null&&d.data!=="&"?d:null,d!==null&&(_.memoizedState={dehydrated:d,treeContext:Fs!==null?{id:_l,overflow:bo}:null,retryLane:536870912,hydrationErrors:null},T=kp(d),T.return=_,_.child=T,Gn=_,Oi=null)):d=null,d===null)throw xo(_);return vf(d)?_.lanes=32:_.lanes=536870912,null}var _e=D.children;return D=D.fallback,U?(Gu(),U=_.mode,_e=Lv({mode:"hidden",children:_e},U),D=jl(D,U,T,null),_e.return=_,D.return=_,_e.sibling=D,_.child=_e,D=_.child,D.memoizedState=t_(T),D.childLanes=r_(d,ne,T),_.memoizedState=kb,af(null,D)):(_a(_),kv(_,_e))}var Ue=d.memoizedState;if(Ue!==null&&(_e=Ue.dehydrated,_e!==null)){if(G)_.flags&256?(_a(_),_.flags&=-257,_=Ov(d,_,T)):_.memoizedState!==null?(Gu(),_.child=d.child,_.flags|=128,_=null):(Gu(),_e=D.fallback,U=_.mode,D=Lv({mode:"visible",children:D.children},U),_e=jl(_e,U,T,null),_e.flags|=2,D.return=_,_e.return=_,D.sibling=_e,_.child=D,$u(_,d.child,null,T),D=_.child,D.memoizedState=t_(T),D.childLanes=r_(d,ne,T),_.memoizedState=kb,_=af(null,D));else if(_a(_),vf(_e)){if(ne=_e.nextSibling&&_e.nextSibling.dataset,ne)var dt=ne.dgst;ne=dt,D=Error(i(419)),D.stack="",D.digest=ne,bl({value:D,source:null,stack:null}),_=Ov(d,_,T)}else if(aa||ls(d,_,T,!1),ne=(T&d.childLanes)!==0,aa||ne){if(ne=en,ne!==null&&(D=$n(ne,T),D!==0&&D!==Ue.retryLane))throw Ue.retryLane=D,ss(d,D),Co(ne,d,D),Iv;mx(_e)||f_(),_=Ov(d,_,T)}else mx(_e)?(_.flags|=192,_.child=d.child,_=null):(d=Ue.treeContext,Oi=ps(_e.nextSibling),Gn=_,ai=!0,Vs=null,Vo=!1,d!==null&&dd(_,d),_=kv(_,D.children),_.flags|=4096);return _}return U?(Gu(),_e=D.fallback,U=_.mode,Ue=d.child,dt=Ue.sibling,D=Fo(Ue,{mode:"hidden",children:D.children}),D.subtreeFlags=Ue.subtreeFlags&65011712,dt!==null?_e=Fo(dt,_e):(_e=jl(_e,U,T,null),_e.flags|=2),_e.return=_,D.return=_,D.sibling=_e,_.child=D,af(null,D),D=_.child,_e=d.child.memoizedState,_e===null?_e=t_(T):(U=_e.cachePool,U!==null?(Ue=Yi._currentValue,U=U.parent!==Ue?{parent:Ue,pool:Ue}:U):U=Zt(),_e={baseLanes:_e.baseLanes|T,cachePool:U}),D.memoizedState=_e,D.childLanes=r_(d,ne,T),_.memoizedState=kb,af(d.child,D)):(_a(_),T=d.child,d=T.sibling,T=Fo(T,{mode:"visible",children:D.children}),T.return=_,T.sibling=null,d!==null&&(ne=_.deletions,ne===null?(_.deletions=[d],_.flags|=16):ne.push(d)),_.child=T,_.memoizedState=null,T)}function kv(d,_){return _=Lv({mode:"visible",children:_},d.mode),_.return=d,d.child=_}function Lv(d,_){return d=zo(22,d,null,_),d.lanes=0,d}function Ov(d,_,T){return $u(_,d.child,null,T),d=kv(_,_.pendingProps.children),d.flags|=2,_.memoizedState=null,d}function Up(d,_,T){d.lanes|=_;var D=d.alternate;D!==null&&(D.lanes|=_),pd(d.return,_,T)}function io(d,_,T,D,U,G){var ne=d.memoizedState;ne===null?d.memoizedState={isBackwards:_,rendering:null,renderingStartTime:0,last:D,tail:T,tailMode:U,treeForkCount:G}:(ne.isBackwards=_,ne.rendering=null,ne.renderingStartTime=0,ne.last=D,ne.tail=T,ne.tailMode=U,ne.treeForkCount=G)}function Lb(d,_,T){var D=_.pendingProps,U=D.revealOrder,G=D.tail;D=D.children;var ne=an.current,_e=(ne&2)!==0;if(_e?(ne=ne&1|2,_.flags|=128):ne&=1,pt(an,ne),Ua(d,_,D,T),D=ai?Lu:0,!_e&&d!==null&&(d.flags&128)!==0)e:for(d=_.child;d!==null;){if(d.tag===13)d.memoizedState!==null&&Up(d,T,_);else if(d.tag===19)Up(d,T,_);else if(d.child!==null){d.child.return=d,d=d.child;continue}if(d===_)break e;for(;d.sibling===null;){if(d.return===null||d.return===_)break e;d=d.return}d.sibling.return=d.return,d=d.sibling}switch(U){case"forwards":for(T=_.child,U=null;T!==null;)d=T.alternate,d!==null&&Qi(d)===null&&(U=T),T=T.sibling;T=U,T===null?(U=_.child,_.child=null):(U=T.sibling,T.sibling=null),io(_,!1,U,T,G,D);break;case"backwards":case"unstable_legacy-backwards":for(T=null,U=_.child,_.child=null;U!==null;){if(d=U.alternate,d!==null&&Qi(d)===null){_.child=U;break}d=U.sibling,U.sibling=T,T=U,U=d}io(_,!0,T,null,G,D);break;case"together":io(_,!1,null,null,void 0,D);break;default:_.memoizedState=null}return _.child}function nu(d,_,T){if(d!==null&&(_.dependencies=d.dependencies),hf|=_.lanes,(T&_.childLanes)===0)if(d!==null){if(ls(d,_,T,!1),(T&_.childLanes)===0)return null}else return null;if(d!==null&&_.child!==d.child)throw Error(i(153));if(_.child!==null){for(d=_.child,T=Fo(d,d.pendingProps),_.child=T,T.return=_;d.sibling!==null;)d=d.sibling,T=T.sibling=Fo(d,d.pendingProps),T.return=_;T.sibling=null}return _.child}function Ob(d,_){return(d.lanes&_)!==0?!0:(d=d.dependencies,!!(d!==null&&gd(d)))}function mS(d,_,T){switch(_.tag){case 3:Kt(_,_.stateNode.containerInfo),ql(_,Yi,d.memoizedState.cache),Xl();break;case 27:case 5:yr(_);break;case 4:Kt(_,_.stateNode.containerInfo);break;case 10:ql(_,_.type,_.memoizedProps.value);break;case 31:if(_.memoizedState!==null)return _.flags|=128,Ql(_),null;break;case 13:var D=_.memoizedState;if(D!==null)return D.dehydrated!==null?(_a(_),_.flags|=128,null):(T&_.child.childLanes)!==0?vS(d,_,T):(_a(_),d=nu(d,_,T),d!==null?d.sibling:null);_a(_);break;case 19:var U=(d.flags&128)!==0;if(D=(T&_.childLanes)!==0,D||(ls(d,_,T,!1),D=(T&_.childLanes)!==0),U){if(D)return Lb(d,_,T);_.flags|=128}if(U=_.memoizedState,U!==null&&(U.rendering=null,U.tail=null,U.lastEffect=null),pt(an,an.current),D)break;return null;case 22:return _.lanes=0,Pv(d,_,T,_.pendingProps);case 24:ql(_,Yi,d.memoizedState.cache)}return nu(d,_,T)}function yS(d,_,T){if(d!==null)if(d.memoizedProps!==_.pendingProps)aa=!0;else{if(!Ob(d,T)&&(_.flags&128)===0)return aa=!1,mS(d,_,T);aa=(d.flags&131072)!==0}else aa=!1,ai&&(_.flags&1048576)!==0&&xv(_,Lu,_.index);switch(_.lanes=0,_.tag){case 16:e:{var D=_.pendingProps;if(d=zr(_.elementType),_.type=d,typeof d=="function")hd(d)?(D=qs(d,D),_.tag=1,_=Db(null,_,d,D,T)):(_.tag=0,_=Dv(null,_,d,D,T));else{if(d!=null){var U=d.$$typeof;if(U===F){_.tag=11,_=Ed(null,_,d,D,T);break e}else if(U===q){_.tag=14,_=fS(null,_,d,D,T);break e}}throw _=ye(d)||d,Error(i(306,_,""))}}return _;case 0:return Dv(d,_,_.type,_.pendingProps,T);case 1:return D=_.type,U=qs(D,_.pendingProps),Db(d,_,D,U,T);case 3:e:{if(Kt(_,_.stateNode.containerInfo),d===null)throw Error(i(387));D=_.pendingProps;var G=_.memoizedState;U=G.element,Ni(d,_),Qc(_,D,null,T);var ne=_.memoizedState;if(D=ne.cache,ql(_,Yi,D),D!==G.cache&&Ou(_,[Yi],T,!0),Jh(),D=ne.element,G.isDehydrated)if(G={element:D,isDehydrated:!1,cache:ne.cache},_.updateQueue.baseState=G,_.memoizedState=G,_.flags&256){_=gS(d,_,D,T);break e}else if(D!==U){U=to(Error(i(424)),_),bl(U),_=gS(d,_,D,T);break e}else{switch(d=_.stateNode.containerInfo,d.nodeType){case 9:d=d.body;break;default:d=d.nodeName==="HTML"?d.ownerDocument.body:d}for(Oi=ps(d.firstChild),Gn=_,ai=!0,Vs=null,Vo=!0,T=Av(_,null,D,T),_.child=T;T;)T.flags=T.flags&-3|4096,T=T.sibling}else{if(Xl(),D===U){_=nu(d,_,T);break e}Ua(d,_,D,T)}_=_.child}return _;case 26:return Rv(d,_),d===null?(T=qS(_.type,null,_.pendingProps,null))?_.memoizedState=T:ai||(T=_.type,d=_.pendingProps,D=T_(qt.current).createElement(T),D[mi]=_,D[Lt]=d,sa(D,T,d),mn(D),_.stateNode=D):_.memoizedState=qS(_.type,d.memoizedProps,_.pendingProps,d.memoizedState),null;case 27:return yr(_),d===null&&ai&&(D=_.stateNode=WS(_.type,_.pendingProps,qt.current),Gn=_,Vo=!0,U=Oi,lu(_.type)?(E_=U,Oi=ps(D.firstChild)):Oi=U),Ua(d,_,_.pendingProps.children,T),Rv(d,_),d===null&&(_.flags|=4194304),_.child;case 5:return d===null&&ai&&((U=D=Oi)&&(D=M_(D,_.type,_.pendingProps,Vo),D!==null?(_.stateNode=D,Gn=_,Oi=ps(D.firstChild),Vo=!1,U=!0):U=!1),U||xo(_)),yr(_),U=_.type,G=_.pendingProps,ne=d!==null?d.memoizedProps:null,D=G.children,A_(U,G)?D=null:ne!==null&&A_(U,ne)&&(_.flags|=32),_.memoizedState!==null&&(U=Ad(d,_,I,null,null,T),gt._currentValue=U),Rv(d,_),Ua(d,_,D,T),_.child;case 6:return d===null&&ai&&((d=T=Oi)&&(T=MM(T,_.pendingProps,Vo),T!==null?(_.stateNode=T,Gn=_,Oi=null,d=!0):d=!1),d||xo(_)),null;case 13:return vS(d,_,T);case 4:return Kt(_,_.stateNode.containerInfo),D=_.pendingProps,d===null?_.child=$u(_,null,D,T):Ua(d,_,D,T),_.child;case 11:return Ed(d,_,_.type,_.pendingProps,T);case 7:return Ua(d,_,_.pendingProps,T),_.child;case 8:return Ua(d,_,_.pendingProps.children,T),_.child;case 12:return Ua(d,_,_.pendingProps.children,T),_.child;case 10:return D=_.pendingProps,ql(_,_.type,D.value),Ua(d,_,D.children,T),_.child;case 9:return U=_.type._context,D=_.pendingProps.children,Nu(_),U=ya(U),D=D(U),_.flags|=1,Ua(d,_,D,T),_.child;case 14:return fS(d,_,_.type,_.pendingProps,T);case 15:return Id(d,_,_.type,_.pendingProps,T);case 19:return Lb(d,_,T);case 31:return dM(d,_,T);case 22:return Pv(d,_,T,_.pendingProps);case 24:return Nu(_),D=ya(Yi),d===null?(U=Zc(),U===null&&(U=en,G=md(),U.pooledCache=G,G.refCount++,G!==null&&(U.pooledCacheLanes|=T),U=G),_.memoizedState={parent:D,cache:U},Sl(_),ql(_,Yi,U)):((d.lanes&T)!==0&&(Ni(d,_),Qc(_,null,null,T),Jh()),U=d.memoizedState,G=_.memoizedState,U.parent!==D?(U={parent:D,cache:D},_.memoizedState=U,_.lanes===0&&(_.memoizedState=_.updateQueue.baseState=U),ql(_,Yi,D)):(D=G.cache,ql(_,Yi,D),D!==U.cache&&Ou(_,[Yi],T,!0))),Ua(d,_,_.pendingProps.children,T),_.child;case 29:throw _.pendingProps}throw Error(i(156,_.tag))}function nh(d){d.flags|=4}function i_(d,_,T,D,U){if((_=(d.mode&32)!==0)&&(_=!1),_){if(d.flags|=16777216,(U&335544128)===U)if(d.stateNode.complete)d.flags|=8192;else if(IS())d.flags|=8192;else throw wl=Vu,yd}else d.flags&=-16777217}function _S(d,_){if(_.type!=="stylesheet"||(_.state.loading&4)!==0)d.flags&=-16777217;else if(d.flags|=16777216,!ce(_))if(IS())d.flags|=8192;else throw wl=Vu,yd}function Hp(d,_){_!==null&&(d.flags|=4),d.flags&16384&&(_=d.tag!==22?ui():536870912,d.lanes|=_,Od|=_)}function jp(d,_){if(!ai)switch(d.tailMode){case"hidden":_=d.tail;for(var T=null;_!==null;)_.alternate!==null&&(T=_),_=_.sibling;T===null?d.tail=null:T.sibling=null;break;case"collapsed":T=d.tail;for(var D=null;T!==null;)T.alternate!==null&&(D=T),T=T.sibling;D===null?_||d.tail===null?d.tail=null:d.tail.sibling=null:D.sibling=null}}function bn(d){var _=d.alternate!==null&&d.alternate.child===d.child,T=0,D=0;if(_)for(var U=d.child;U!==null;)T|=U.lanes|U.childLanes,D|=U.subtreeFlags&65011712,D|=U.flags&65011712,U.return=d,U=U.sibling;else for(U=d.child;U!==null;)T|=U.lanes|U.childLanes,D|=U.subtreeFlags,D|=U.flags,U.return=d,U=U.sibling;return d.subtreeFlags|=D,d.childLanes=T,_}function pM(d,_,T){var D=_.pendingProps;switch(Zh(_),_.tag){case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return bn(_),null;case 1:return bn(_),null;case 3:return T=_.stateNode,D=null,d!==null&&(D=d.memoizedState.cache),_.memoizedState.cache!==D&&(_.flags|=2048),Hs(Yi),zt(),T.pendingContext&&(T.context=T.pendingContext,T.pendingContext=null),(d===null||d.child===null)&&(Gl(_)?nh(_):d===null||d.memoizedState.isDehydrated&&(_.flags&256)===0||(_.flags|=1024,Zl())),bn(_),null;case 26:var U=_.type,G=_.memoizedState;return d===null?(nh(_),G!==null?(bn(_),_S(_,G)):(bn(_),i_(_,U,null,D,T))):G?G!==d.memoizedState?(nh(_),bn(_),_S(_,G)):(bn(_),_.flags&=-16777217):(d=d.memoizedProps,d!==D&&nh(_),bn(_),i_(_,U,d,D,T)),null;case 27:if(Gt(_),T=qt.current,U=_.type,d!==null&&_.stateNode!=null)d.memoizedProps!==D&&nh(_);else{if(!D){if(_.stateNode===null)throw Error(i(166));return bn(_),null}d=_t.current,Gl(_)?Uo(_):(d=WS(U,D,T),_.stateNode=d,nh(_))}return bn(_),null;case 5:if(Gt(_),U=_.type,d!==null&&_.stateNode!=null)d.memoizedProps!==D&&nh(_);else{if(!D){if(_.stateNode===null)throw Error(i(166));return bn(_),null}if(G=_t.current,Gl(_))Uo(_);else{var ne=T_(qt.current);switch(G){case 1:G=ne.createElementNS("http://www.w3.org/2000/svg",U);break;case 2:G=ne.createElementNS("http://www.w3.org/1998/Math/MathML",U);break;default:switch(U){case"svg":G=ne.createElementNS("http://www.w3.org/2000/svg",U);break;case"math":G=ne.createElementNS("http://www.w3.org/1998/Math/MathML",U);break;case"script":G=ne.createElement("div"),G.innerHTML="<script><\/script>",G=G.removeChild(G.firstChild);break;case"select":G=typeof D.is=="string"?ne.createElement("select",{is:D.is}):ne.createElement("select"),D.multiple?G.multiple=!0:D.size&&(G.size=D.size);break;default:G=typeof D.is=="string"?ne.createElement(U,{is:D.is}):ne.createElement(U)}}G[mi]=_,G[Lt]=D;e:for(ne=_.child;ne!==null;){if(ne.tag===5||ne.tag===6)G.appendChild(ne.stateNode);else if(ne.tag!==4&&ne.tag!==27&&ne.child!==null){ne.child.return=ne,ne=ne.child;continue}if(ne===_)break e;for(;ne.sibling===null;){if(ne.return===null||ne.return===_)break e;ne=ne.return}ne.sibling.return=ne.return,ne=ne.sibling}_.stateNode=G;e:switch(sa(G,U,D),U){case"button":case"input":case"select":case"textarea":D=!!D.autoFocus;break e;case"img":D=!0;break e;default:D=!1}D&&nh(_)}}return bn(_),i_(_,_.type,d===null?null:d.memoizedProps,_.pendingProps,T),null;case 6:if(d&&_.stateNode!=null)d.memoizedProps!==D&&nh(_);else{if(typeof D!="string"&&_.stateNode===null)throw Error(i(166));if(d=qt.current,Gl(_)){if(d=_.stateNode,T=_.memoizedProps,D=null,U=Gn,U!==null)switch(U.tag){case 27:case 5:D=U.memoizedProps}d[mi]=_,d=!!(d.nodeValue===T||D!==null&&D.suppressHydrationWarning===!0||fx(d.nodeValue,T)),d||xo(_,!0)}else d=T_(d).createTextNode(D),d[mi]=_,_.stateNode=d}return bn(_),null;case 31:if(T=_.memoizedState,d===null||d.memoizedState!==null){if(D=Gl(_),T!==null){if(d===null){if(!D)throw Error(i(318));if(d=_.memoizedState,d=d!==null?d.dehydrated:null,!d)throw Error(i(557));d[mi]=_}else Xl(),(_.flags&128)===0&&(_.memoizedState=null),_.flags|=4;bn(_),d=!1}else T=Zl(),d!==null&&d.memoizedState!==null&&(d.memoizedState.hydrationErrors=T),d=!0;if(!d)return _.flags&256?($o(_),_):($o(_),null);if((_.flags&128)!==0)throw Error(i(558))}return bn(_),null;case 13:if(D=_.memoizedState,d===null||d.memoizedState!==null&&d.memoizedState.dehydrated!==null){if(U=Gl(_),D!==null&&D.dehydrated!==null){if(d===null){if(!U)throw Error(i(318));if(U=_.memoizedState,U=U!==null?U.dehydrated:null,!U)throw Error(i(317));U[mi]=_}else Xl(),(_.flags&128)===0&&(_.memoizedState=null),_.flags|=4;bn(_),U=!1}else U=Zl(),d!==null&&d.memoizedState!==null&&(d.memoizedState.hydrationErrors=U),U=!0;if(!U)return _.flags&256?($o(_),_):($o(_),null)}return $o(_),(_.flags&128)!==0?(_.lanes=T,_):(T=D!==null,d=d!==null&&d.memoizedState!==null,T&&(D=_.child,U=null,D.alternate!==null&&D.alternate.memoizedState!==null&&D.alternate.memoizedState.cachePool!==null&&(U=D.alternate.memoizedState.cachePool.pool),G=null,D.memoizedState!==null&&D.memoizedState.cachePool!==null&&(G=D.memoizedState.cachePool.pool),G!==U&&(D.flags|=2048)),T!==d&&T&&(_.child.flags|=8192),Hp(_,_.updateQueue),bn(_),null);case 4:return zt(),d===null&&__(_.stateNode.containerInfo),bn(_),null;case 10:return Hs(_.type),bn(_),null;case 19:if($e(an),D=_.memoizedState,D===null)return bn(_),null;if(U=(_.flags&128)!==0,G=D.rendering,G===null)if(U)jp(D,!1);else{if(Zn!==0||d!==null&&(d.flags&128)!==0)for(d=_.child;d!==null;){if(G=Qi(d),G!==null){for(_.flags|=128,jp(D,!1),d=G.updateQueue,_.updateQueue=d,Hp(_,d),_.subtreeFlags=0,d=T,T=_.child;T!==null;)qy(T,d),T=T.sibling;return pt(an,an.current&1|2),ai&&Wl(_,D.treeForkCount),_.child}d=d.sibling}D.tail!==null&&ea()>Bd&&(_.flags|=128,U=!0,jp(D,!1),_.lanes=4194304)}else{if(!U)if(d=Qi(G),d!==null){if(_.flags|=128,U=!0,d=d.updateQueue,_.updateQueue=d,Hp(_,d),jp(D,!0),D.tail===null&&D.tailMode==="hidden"&&!G.alternate&&!ai)return bn(_),null}else 2*ea()-D.renderingStartTime>Bd&&T!==536870912&&(_.flags|=128,U=!0,jp(D,!1),_.lanes=4194304);D.isBackwards?(G.sibling=_.child,_.child=G):(d=D.last,d!==null?d.sibling=G:_.child=G,D.last=G)}return D.tail!==null?(d=D.tail,D.rendering=d,D.tail=d.sibling,D.renderingStartTime=ea(),d.sibling=null,T=an.current,pt(an,U?T&1|2:T&1),ai&&Wl(_,D.treeForkCount),d):(bn(_),null);case 22:case 23:return $o(_),ef(),D=_.memoizedState!==null,d!==null?d.memoizedState!==null!==D&&(_.flags|=8192):D&&(_.flags|=8192),D?(T&536870912)!==0&&(_.flags&128)===0&&(bn(_),_.subtreeFlags&6&&(_.flags|=8192)):bn(_),T=_.updateQueue,T!==null&&Hp(_,T.retryQueue),T=null,d!==null&&d.memoizedState!==null&&d.memoizedState.cachePool!==null&&(T=d.memoizedState.cachePool.pool),D=null,_.memoizedState!==null&&_.memoizedState.cachePool!==null&&(D=_.memoizedState.cachePool.pool),D!==T&&(_.flags|=2048),d!==null&&$e(zu),null;case 24:return T=null,d!==null&&(T=d.memoizedState.cache),_.memoizedState.cache!==T&&(_.flags|=2048),Hs(Yi),bn(_),null;case 25:return null;case 30:return null}throw Error(i(156,_.tag))}function gM(d,_){switch(Zh(_),_.tag){case 1:return d=_.flags,d&65536?(_.flags=d&-65537|128,_):null;case 3:return Hs(Yi),zt(),d=_.flags,(d&65536)!==0&&(d&128)===0?(_.flags=d&-65537|128,_):null;case 26:case 27:case 5:return Gt(_),null;case 31:if(_.memoizedState!==null){if($o(_),_.alternate===null)throw Error(i(340));Xl()}return d=_.flags,d&65536?(_.flags=d&-65537|128,_):null;case 13:if($o(_),d=_.memoizedState,d!==null&&d.dehydrated!==null){if(_.alternate===null)throw Error(i(340));Xl()}return d=_.flags,d&65536?(_.flags=d&-65537|128,_):null;case 19:return $e(an),null;case 4:return zt(),null;case 10:return Hs(_.type),null;case 22:case 23:return $o(_),ef(),d!==null&&$e(zu),d=_.flags,d&65536?(_.flags=d&-65537|128,_):null;case 24:return Hs(Yi),null;case 25:return null;default:return null}}function bS(d,_){switch(Zh(_),_.tag){case 3:Hs(Yi),zt();break;case 26:case 27:case 5:Gt(_);break;case 4:zt();break;case 31:_.memoizedState!==null&&$o(_);break;case 13:$o(_);break;case 19:$e(an);break;case 10:Hs(_.type);break;case 22:case 23:$o(_),ef(),d!==null&&$e(zu);break;case 24:Hs(Yi)}}function of(d,_){try{var T=_.updateQueue,D=T!==null?T.lastEffect:null;if(D!==null){var U=D.next;T=U;do{if((T.tag&d)===d){D=void 0;var G=T.create,ne=T.inst;D=G(),ne.destroy=D}T=T.next}while(T!==U)}}catch(_e){Ui(_,_.return,_e)}}function qu(d,_,T){try{var D=_.updateQueue,U=D!==null?D.lastEffect:null;if(U!==null){var G=U.next;D=G;do{if((D.tag&d)===d){var ne=D.inst,_e=ne.destroy;if(_e!==void 0){ne.destroy=void 0,U=_;var Ue=T,dt=_e;try{dt()}catch(At){Ui(U,Ue,At)}}}D=D.next}while(D!==G)}}catch(At){Ui(_,_.return,At)}}function Nb(d){var _=d.updateQueue;if(_!==null){var T=d.stateNode;try{Sd(_,T)}catch(D){Ui(d,d.return,D)}}}function sf(d,_,T){T.props=qs(d.type,d.memoizedProps),T.state=d.memoizedState;try{T.componentWillUnmount()}catch(D){Ui(d,_,D)}}function ah(d,_){try{var T=d.ref;if(T!==null){switch(d.tag){case 26:case 27:case 5:var D=d.stateNode;break;case 30:D=d.stateNode;break;default:D=d.stateNode}typeof T=="function"?d.refCleanup=T(D):T.current=D}}catch(U){Ui(d,_,U)}}function Yu(d,_){var T=d.ref,D=d.refCleanup;if(T!==null)if(typeof D=="function")try{D()}catch(U){Ui(d,_,U)}finally{d.refCleanup=null,d=d.alternate,d!=null&&(d.refCleanup=null)}else if(typeof T=="function")try{T(null)}catch(U){Ui(d,_,U)}else T.current=null}function xS(d){var _=d.type,T=d.memoizedProps,D=d.stateNode;try{e:switch(_){case"button":case"input":case"select":case"textarea":T.autoFocus&&D.focus();break e;case"img":T.src?D.src=T.src:T.srcSet&&(D.srcset=T.srcSet)}}catch(U){Ui(d,d.return,U)}}function Bb(d,_,T){try{var D=d.stateNode;Vd(D,d.type,T,_),D[Lt]=_}catch(U){Ui(d,d.return,U)}}function wS(d){return d.tag===5||d.tag===3||d.tag===26||d.tag===27&&lu(d.type)||d.tag===4}function zb(d){e:for(;;){for(;d.sibling===null;){if(d.return===null||wS(d.return))return null;d=d.return}for(d.sibling.return=d.return,d=d.sibling;d.tag!==5&&d.tag!==6&&d.tag!==18;){if(d.tag===27&&lu(d.type)||d.flags&2||d.child===null||d.tag===4)continue e;d.child.return=d,d=d.child}if(!(d.flags&2))return d.stateNode}}function Fb(d,_,T){var D=d.tag;if(D===5||D===6)d=d.stateNode,_?(T.nodeType===9?T.body:T.nodeName==="HTML"?T.ownerDocument.body:T).insertBefore(d,_):(_=T.nodeType===9?T.body:T.nodeName==="HTML"?T.ownerDocument.body:T,_.appendChild(d),T=T._reactRootContainer,T!=null||_.onclick!==null||(_.onclick=Lo));else if(D!==4&&(D===27&&lu(d.type)&&(T=d.stateNode,_=null),d=d.child,d!==null))for(Fb(d,_,T),d=d.sibling;d!==null;)Fb(d,_,T),d=d.sibling}function n_(d,_,T){var D=d.tag;if(D===5||D===6)d=d.stateNode,_?T.insertBefore(d,_):T.appendChild(d);else if(D!==4&&(D===27&&lu(d.type)&&(T=d.stateNode),d=d.child,d!==null))for(n_(d,_,T),d=d.sibling;d!==null;)n_(d,_,T),d=d.sibling}function a_(d){var _=d.stateNode,T=d.memoizedProps;try{for(var D=d.type,U=_.attributes;U.length;)_.removeAttributeNode(U[0]);sa(_,D,T),_[mi]=d,_[Lt]=T}catch(G){Ui(d,d.return,G)}}var oh=!1,oa=!1,Pd=!1,SS=typeof WeakSet=="function"?WeakSet:Set,ci=null;function $p(d,_){if(d=d.containerInfo,w_=xr,d=yi(d),Ip(d)){if("selectionStart"in d)var T={start:d.selectionStart,end:d.selectionEnd};else e:{T=(T=d.ownerDocument)&&T.defaultView||window;var D=T.getSelection&&T.getSelection();if(D&&D.rangeCount!==0){T=D.anchorNode;var U=D.anchorOffset,G=D.focusNode;D=D.focusOffset;try{T.nodeType,G.nodeType}catch{T=null;break e}var ne=0,_e=-1,Ue=-1,dt=0,At=0,Pt=d,vt=null;t:for(;;){for(var bt;Pt!==T||U!==0&&Pt.nodeType!==3||(_e=ne+U),Pt!==G||D!==0&&Pt.nodeType!==3||(Ue=ne+D),Pt.nodeType===3&&(ne+=Pt.nodeValue.length),(bt=Pt.firstChild)!==null;)vt=Pt,Pt=bt;for(;;){if(Pt===d)break t;if(vt===T&&++dt===U&&(_e=ne),vt===G&&++At===D&&(Ue=ne),(bt=Pt.nextSibling)!==null)break;Pt=vt,vt=Pt.parentNode}Pt=bt}T=_e===-1||Ue===-1?null:{start:_e,end:Ue}}else T=null}T=T||{start:0,end:0}}else T=null;for(S_={focusedElem:d,selectionRange:T},xr=!1,ci=_;ci!==null;)if(_=ci,d=_.child,(_.subtreeFlags&1028)!==0&&d!==null)d.return=_,ci=d;else for(;ci!==null;){switch(_=ci,G=_.alternate,d=_.flags,_.tag){case 0:if((d&4)!==0&&(d=_.updateQueue,d=d!==null?d.events:null,d!==null))for(T=0;T<d.length;T++)U=d[T],U.ref.impl=U.nextImpl;break;case 11:case 15:break;case 1:if((d&1024)!==0&&G!==null){d=void 0,T=_,U=G.memoizedProps,G=G.memoizedState,D=T.stateNode;try{var fr=qs(T.type,U);d=D.getSnapshotBeforeUpdate(fr,G),D.__reactInternalSnapshotBeforeUpdate=d}catch(Lr){Ui(T,T.return,Lr)}}break;case 3:if((d&1024)!==0){if(d=_.stateNode.containerInfo,T=d.nodeType,T===9)rg(d);else if(T===1)switch(d.nodeName){case"HEAD":case"HTML":case"BODY":rg(d);break;default:d.textContent=""}}break;case 5:case 26:case 27:case 6:case 4:case 17:break;default:if((d&1024)!==0)throw Error(i(163))}if(d=_.sibling,d!==null){d.return=_.return,ci=d;break}ci=_.return}}function Vb(d,_,T){var D=T.flags;switch(T.tag){case 0:case 11:case 15:sh(d,T),D&4&&of(5,T);break;case 1:if(sh(d,T),D&4)if(d=T.stateNode,_===null)try{d.componentDidMount()}catch(ne){Ui(T,T.return,ne)}else{var U=qs(T.type,_.memoizedProps);_=_.memoizedState;try{d.componentDidUpdate(U,_,d.__reactInternalSnapshotBeforeUpdate)}catch(ne){Ui(T,T.return,ne)}}D&64&&Nb(T),D&512&&ah(T,T.return);break;case 3:if(sh(d,T),D&64&&(d=T.updateQueue,d!==null)){if(_=null,T.child!==null)switch(T.child.tag){case 27:case 5:_=T.child.stateNode;break;case 1:_=T.child.stateNode}try{Sd(d,_)}catch(ne){Ui(T,T.return,ne)}}break;case 27:_===null&&D&4&&a_(T);case 26:case 5:sh(d,T),_===null&&D&4&&xS(T),D&512&&ah(T,T.return);break;case 12:sh(d,T);break;case 31:sh(d,T),D&4&&Wp(d,T);break;case 13:sh(d,T),D&4&&o_(d,T),D&64&&(d=T.memoizedState,d!==null&&(d=d.dehydrated,d!==null&&(T=bM.bind(null,T),ja(d,T))));break;case 22:if(D=T.memoizedState!==null||oh,!D){_=_!==null&&_.memoizedState!==null||oa,U=oh;var G=oa;oh=D,(oa=_)&&!G?Ys(d,T,(T.subtreeFlags&8772)!==0):sh(d,T),oh=U,oa=G}break;case 30:break;default:sh(d,T)}}function Nv(d){var _=d.alternate;_!==null&&(d.alternate=null,Nv(_)),d.child=null,d.deletions=null,d.sibling=null,d.tag===5&&(_=d.stateNode,_!==null&&wu(_)),d.stateNode=null,d.return=null,d.dependencies=null,d.memoizedProps=null,d.memoizedState=null,d.pendingProps=null,d.stateNode=null,d.updateQueue=null}var dn=null,Ha=!1;function Ku(d,_,T){for(T=T.child;T!==null;)Ub(d,_,T),T=T.sibling}function Ub(d,_,T){if(Be&&typeof Be.onCommitFiberUnmount=="function")try{Be.onCommitFiberUnmount(Ne,T)}catch{}switch(T.tag){case 26:oa||Yu(T,_),Ku(d,_,T),T.memoizedState?T.memoizedState.count--:T.stateNode&&(T=T.stateNode,T.parentNode.removeChild(T));break;case 27:oa||Yu(T,_);var D=dn,U=Ha;lu(T.type)&&(dn=T.stateNode,Ha=!1),Ku(d,_,T),ig(T.stateNode),dn=D,Ha=U;break;case 5:oa||Yu(T,_);case 6:if(D=dn,U=Ha,dn=null,Ku(d,_,T),dn=D,Ha=U,dn!==null)if(Ha)try{(dn.nodeType===9?dn.body:dn.nodeName==="HTML"?dn.ownerDocument.body:dn).removeChild(T.stateNode)}catch(G){Ui(T,_,G)}else try{dn.removeChild(T.stateNode)}catch(G){Ui(T,_,G)}break;case 18:dn!==null&&(Ha?(d=dn,vx(d.nodeType===9?d.body:d.nodeName==="HTML"?d.ownerDocument.body:d,T.stateNode),Eo(d)):vx(dn,T.stateNode));break;case 4:D=dn,U=Ha,dn=T.stateNode.containerInfo,Ha=!0,Ku(d,_,T),dn=D,Ha=U;break;case 0:case 11:case 14:case 15:qu(2,T,_),oa||qu(4,T,_),Ku(d,_,T);break;case 1:oa||(Yu(T,_),D=T.stateNode,typeof D.componentWillUnmount=="function"&&sf(T,_,D)),Ku(d,_,T);break;case 21:Ku(d,_,T);break;case 22:oa=(D=oa)||T.memoizedState!==null,Ku(d,_,T),oa=D;break;default:Ku(d,_,T)}}function Wp(d,_){if(_.memoizedState===null&&(d=_.alternate,d!==null&&(d=d.memoizedState,d!==null))){d=d.dehydrated;try{Eo(d)}catch(T){Ui(_,_.return,T)}}}function o_(d,_){if(_.memoizedState===null&&(d=_.alternate,d!==null&&(d=d.memoizedState,d!==null&&(d=d.dehydrated,d!==null))))try{Eo(d)}catch(T){Ui(_,_.return,T)}}function Gp(d){switch(d.tag){case 31:case 13:case 19:var _=d.stateNode;return _===null&&(_=d.stateNode=new SS),_;case 22:return d=d.stateNode,_=d._retryCache,_===null&&(_=d._retryCache=new SS),_;default:throw Error(i(435,d.tag))}}function Rd(d,_){var T=Gp(d);_.forEach(function(D){if(!T.has(D)){T.add(D);var U=xM.bind(null,d,D);D.then(U,U)}})}function Ia(d,_){var T=_.deletions;if(T!==null)for(var D=0;D<T.length;D++){var U=T[D],G=d,ne=_,_e=ne;e:for(;_e!==null;){switch(_e.tag){case 27:if(lu(_e.type)){dn=_e.stateNode,Ha=!1;break e}break;case 5:dn=_e.stateNode,Ha=!1;break e;case 3:case 4:dn=_e.stateNode.containerInfo,Ha=!0;break e}_e=_e.return}if(dn===null)throw Error(i(160));Ub(G,ne,U),dn=null,Ha=!1,G=U.alternate,G!==null&&(G.return=null),U.return=null}if(_.subtreeFlags&13886)for(_=_.child;_!==null;)TS(_,d),_=_.sibling}var Xo=null;function TS(d,_){var T=d.alternate,D=d.flags;switch(d.tag){case 0:case 11:case 14:case 15:Ia(_,d),Zo(d),D&4&&(qu(3,d,d.return),of(3,d),qu(5,d,d.return));break;case 1:Ia(_,d),Zo(d),D&512&&(oa||T===null||Yu(T,T.return)),D&64&&oh&&(d=d.updateQueue,d!==null&&(D=d.callbacks,D!==null&&(T=d.shared.hiddenCallbacks,d.shared.hiddenCallbacks=T===null?D:T.concat(D))));break;case 26:var U=Xo;if(Ia(_,d),Zo(d),D&512&&(oa||T===null||Yu(T,T.return)),D&4){var G=T!==null?T.memoizedState:null;if(D=d.memoizedState,T===null)if(D===null)if(d.stateNode===null){e:{D=d.type,T=d.memoizedProps,U=U.ownerDocument||U;t:switch(D){case"title":G=U.getElementsByTagName("title")[0],(!G||G[Nr]||G[mi]||G.namespaceURI==="http://www.w3.org/2000/svg"||G.hasAttribute("itemprop"))&&(G=U.createElement(D),U.head.insertBefore(G,U.querySelector("head > title"))),sa(G,D,T),G[mi]=d,mn(G),D=G;break e;case"link":var ne=J("link","href",U).get(D+(T.href||""));if(ne){for(var _e=0;_e<ne.length;_e++)if(G=ne[_e],G.getAttribute("href")===(T.href==null||T.href===""?null:T.href)&&G.getAttribute("rel")===(T.rel==null?null:T.rel)&&G.getAttribute("title")===(T.title==null?null:T.title)&&G.getAttribute("crossorigin")===(T.crossOrigin==null?null:T.crossOrigin)){ne.splice(_e,1);break t}}G=U.createElement(D),sa(G,D,T),U.head.appendChild(G);break;case"meta":if(ne=J("meta","content",U).get(D+(T.content||""))){for(_e=0;_e<ne.length;_e++)if(G=ne[_e],G.getAttribute("content")===(T.content==null?null:""+T.content)&&G.getAttribute("name")===(T.name==null?null:T.name)&&G.getAttribute("property")===(T.property==null?null:T.property)&&G.getAttribute("http-equiv")===(T.httpEquiv==null?null:T.httpEquiv)&&G.getAttribute("charset")===(T.charSet==null?null:T.charSet)){ne.splice(_e,1);break t}}G=U.createElement(D),sa(G,D,T),U.head.appendChild(G);break;default:throw Error(i(468,D))}G[mi]=d,mn(G),D=G}d.stateNode=D}else oe(U,d.type,d.stateNode);else d.stateNode=L(U,D,d.memoizedProps);else G!==D?(G===null?T.stateNode!==null&&(T=T.stateNode,T.parentNode.removeChild(T)):G.count--,D===null?oe(U,d.type,d.stateNode):L(U,D,d.memoizedProps)):D===null&&d.stateNode!==null&&Bb(d,d.memoizedProps,T.memoizedProps)}break;case 27:Ia(_,d),Zo(d),D&512&&(oa||T===null||Yu(T,T.return)),T!==null&&D&4&&Bb(d,d.memoizedProps,T.memoizedProps);break;case 5:if(Ia(_,d),Zo(d),D&512&&(oa||T===null||Yu(T,T.return)),d.flags&32){U=d.stateNode;try{dl(U,"")}catch(fr){Ui(d,d.return,fr)}}D&4&&d.stateNode!=null&&(U=d.memoizedProps,Bb(d,U,T!==null?T.memoizedProps:U)),D&1024&&(Pd=!0);break;case 6:if(Ia(_,d),Zo(d),D&4){if(d.stateNode===null)throw Error(i(162));D=d.memoizedProps,T=d.stateNode;try{T.nodeValue=D}catch(fr){Ui(d,d.return,fr)}}break;case 3:if(Z=null,U=Xo,Xo=Jv(_.containerInfo),Ia(_,d),Xo=U,Zo(d),D&4&&T!==null&&T.memoizedState.isDehydrated)try{Eo(_.containerInfo)}catch(fr){Ui(d,d.return,fr)}Pd&&(Pd=!1,lf(d));break;case 4:D=Xo,Xo=Jv(d.stateNode.containerInfo),Ia(_,d),Zo(d),Xo=D;break;case 12:Ia(_,d),Zo(d);break;case 31:Ia(_,d),Zo(d),D&4&&(D=d.updateQueue,D!==null&&(d.updateQueue=null,Rd(d,D)));break;case 13:Ia(_,d),Zo(d),d.child.flags&8192&&d.memoizedState!==null!=(T!==null&&T.memoizedState!==null)&&(Uv=ea()),D&4&&(D=d.updateQueue,D!==null&&(d.updateQueue=null,Rd(d,D)));break;case 22:U=d.memoizedState!==null;var Ue=T!==null&&T.memoizedState!==null,dt=oh,At=oa;if(oh=dt||U,oa=At||Ue,Ia(_,d),oa=At,oh=dt,Zo(d),D&8192)e:for(_=d.stateNode,_._visibility=U?_._visibility&-2:_._visibility|1,U&&(T===null||Ue||oh||oa||uf(d)),T=null,_=d;;){if(_.tag===5||_.tag===26){if(T===null){Ue=T=_;try{if(G=Ue.stateNode,U)ne=G.style,typeof ne.setProperty=="function"?ne.setProperty("display","none","important"):ne.display="none";else{_e=Ue.stateNode;var Pt=Ue.memoizedProps.style,vt=Pt!=null&&Pt.hasOwnProperty("display")?Pt.display:null;_e.style.display=vt==null||typeof vt=="boolean"?"":(""+vt).trim()}}catch(fr){Ui(Ue,Ue.return,fr)}}}else if(_.tag===6){if(T===null){Ue=_;try{Ue.stateNode.nodeValue=U?"":Ue.memoizedProps}catch(fr){Ui(Ue,Ue.return,fr)}}}else if(_.tag===18){if(T===null){Ue=_;try{var bt=Ue.stateNode;U?Qv(bt,!0):Qv(Ue.stateNode,!1)}catch(fr){Ui(Ue,Ue.return,fr)}}}else if((_.tag!==22&&_.tag!==23||_.memoizedState===null||_===d)&&_.child!==null){_.child.return=_,_=_.child;continue}if(_===d)break e;for(;_.sibling===null;){if(_.return===null||_.return===d)break e;T===_&&(T=null),_=_.return}T===_&&(T=null),_.sibling.return=_.return,_=_.sibling}D&4&&(D=d.updateQueue,D!==null&&(T=D.retryQueue,T!==null&&(D.retryQueue=null,Rd(d,T))));break;case 19:Ia(_,d),Zo(d),D&4&&(D=d.updateQueue,D!==null&&(d.updateQueue=null,Rd(d,D)));break;case 30:break;case 21:break;default:Ia(_,d),Zo(d)}}function Zo(d){var _=d.flags;if(_&2){try{for(var T,D=d.return;D!==null;){if(wS(D)){T=D;break}D=D.return}if(T==null)throw Error(i(160));switch(T.tag){case 27:var U=T.stateNode,G=zb(d);n_(d,G,U);break;case 5:var ne=T.stateNode;T.flags&32&&(dl(ne,""),T.flags&=-33);var _e=zb(d);n_(d,_e,ne);break;case 3:case 4:var Ue=T.stateNode.containerInfo,dt=zb(d);Fb(d,dt,Ue);break;default:throw Error(i(161))}}catch(At){Ui(d,d.return,At)}d.flags&=-3}_&4096&&(d.flags&=-4097)}function lf(d){if(d.subtreeFlags&1024)for(d=d.child;d!==null;){var _=d;lf(_),_.tag===5&&_.flags&1024&&_.stateNode.reset(),d=d.sibling}}function sh(d,_){if(_.subtreeFlags&8772)for(_=_.child;_!==null;)Vb(d,_.alternate,_),_=_.sibling}function uf(d){for(d=d.child;d!==null;){var _=d;switch(_.tag){case 0:case 11:case 14:case 15:qu(4,_,_.return),uf(_);break;case 1:Yu(_,_.return);var T=_.stateNode;typeof T.componentWillUnmount=="function"&&sf(_,_.return,T),uf(_);break;case 27:ig(_.stateNode);case 26:case 5:Yu(_,_.return),uf(_);break;case 22:_.memoizedState===null&&uf(_);break;case 30:uf(_);break;default:uf(_)}d=d.sibling}}function Ys(d,_,T){for(T=T&&(_.subtreeFlags&8772)!==0,_=_.child;_!==null;){var D=_.alternate,U=d,G=_,ne=G.flags;switch(G.tag){case 0:case 11:case 15:Ys(U,G,T),of(4,G);break;case 1:if(Ys(U,G,T),D=G,U=D.stateNode,typeof U.componentDidMount=="function")try{U.componentDidMount()}catch(dt){Ui(D,D.return,dt)}if(D=G,U=D.updateQueue,U!==null){var _e=D.stateNode;try{var Ue=U.shared.hiddenCallbacks;if(Ue!==null)for(U.shared.hiddenCallbacks=null,U=0;U<Ue.length;U++)js(Ue[U],_e)}catch(dt){Ui(D,D.return,dt)}}T&&ne&64&&Nb(G),ah(G,G.return);break;case 27:a_(G);case 26:case 5:Ys(U,G,T),T&&D===null&&ne&4&&xS(G),ah(G,G.return);break;case 12:Ys(U,G,T);break;case 31:Ys(U,G,T),T&&ne&4&&Wp(U,G);break;case 13:Ys(U,G,T),T&&ne&4&&o_(U,G);break;case 22:G.memoizedState===null&&Ys(U,G,T),ah(G,G.return);break;case 30:break;default:Ys(U,G,T)}_=_.sibling}}function Bv(d,_){var T=null;d!==null&&d.memoizedState!==null&&d.memoizedState.cachePool!==null&&(T=d.memoizedState.cachePool.pool),d=null,_.memoizedState!==null&&_.memoizedState.cachePool!==null&&(d=_.memoizedState.cachePool.pool),d!==T&&(d!=null&&d.refCount++,T!=null&&Fa(T))}function s_(d,_){d=null,_.alternate!==null&&(d=_.alternate.memoizedState.cache),_=_.memoizedState.cache,_!==d&&(_.refCount++,d!=null&&Fa(d))}function Ml(d,_,T,D){if(_.subtreeFlags&10256)for(_=_.child;_!==null;)AS(d,_,T,D),_=_.sibling}function AS(d,_,T,D){var U=_.flags;switch(_.tag){case 0:case 11:case 15:Ml(d,_,T,D),U&2048&&of(9,_);break;case 1:Ml(d,_,T,D);break;case 3:Ml(d,_,T,D),U&2048&&(d=null,_.alternate!==null&&(d=_.alternate.memoizedState.cache),_=_.memoizedState.cache,_!==d&&(_.refCount++,d!=null&&Fa(d)));break;case 12:if(U&2048){Ml(d,_,T,D),d=_.stateNode;try{var G=_.memoizedProps,ne=G.id,_e=G.onPostCommit;typeof _e=="function"&&_e(ne,_.alternate===null?"mount":"update",d.passiveEffectDuration,-0)}catch(Ue){Ui(_,_.return,Ue)}}else Ml(d,_,T,D);break;case 31:Ml(d,_,T,D);break;case 13:Ml(d,_,T,D);break;case 23:break;case 22:G=_.stateNode,ne=_.alternate,_.memoizedState!==null?G._visibility&2?Ml(d,_,T,D):zv(d,_):G._visibility&2?Ml(d,_,T,D):(G._visibility|=2,Xp(d,_,T,D,(_.subtreeFlags&10256)!==0||!1)),U&2048&&Bv(ne,_);break;case 24:Ml(d,_,T,D),U&2048&&s_(_.alternate,_);break;default:Ml(d,_,T,D)}}function Xp(d,_,T,D,U){for(U=U&&((_.subtreeFlags&10256)!==0||!1),_=_.child;_!==null;){var G=d,ne=_,_e=T,Ue=D,dt=ne.flags;switch(ne.tag){case 0:case 11:case 15:Xp(G,ne,_e,Ue,U),of(8,ne);break;case 23:break;case 22:var At=ne.stateNode;ne.memoizedState!==null?At._visibility&2?Xp(G,ne,_e,Ue,U):zv(G,ne):(At._visibility|=2,Xp(G,ne,_e,Ue,U)),U&&dt&2048&&Bv(ne.alternate,ne);break;case 24:Xp(G,ne,_e,Ue,U),U&&dt&2048&&s_(ne.alternate,ne);break;default:Xp(G,ne,_e,Ue,U)}_=_.sibling}}function zv(d,_){if(_.subtreeFlags&10256)for(_=_.child;_!==null;){var T=d,D=_,U=D.flags;switch(D.tag){case 22:zv(T,D),U&2048&&Bv(D.alternate,D);break;case 24:zv(T,D),U&2048&&s_(D.alternate,D);break;default:zv(T,D)}_=_.sibling}}var Fv=8192;function Zp(d,_,T){if(d.subtreeFlags&Fv)for(d=d.child;d!==null;)Dd(d,_,T),d=d.sibling}function Dd(d,_,T){switch(d.tag){case 26:Zp(d,_,T),d.flags&Fv&&d.memoizedState!==null&&ge(T,Xo,d.memoizedState,d.memoizedProps);break;case 5:Zp(d,_,T);break;case 3:case 4:var D=Xo;Xo=Jv(d.stateNode.containerInfo),Zp(d,_,T),Xo=D;break;case 22:d.memoizedState===null&&(D=d.alternate,D!==null&&D.memoizedState!==null?(D=Fv,Fv=16777216,Zp(d,_,T),Fv=D):Zp(d,_,T));break;default:Zp(d,_,T)}}function CS(d){var _=d.alternate;if(_!==null&&(d=_.child,d!==null)){_.child=null;do _=d.sibling,d.sibling=null,d=_;while(d!==null)}}function Vv(d){var _=d.deletions;if((d.flags&16)!==0){if(_!==null)for(var T=0;T<_.length;T++){var D=_[T];ci=D,jb(D,d)}CS(d)}if(d.subtreeFlags&10256)for(d=d.child;d!==null;)Hb(d),d=d.sibling}function Hb(d){switch(d.tag){case 0:case 11:case 15:Vv(d),d.flags&2048&&qu(9,d,d.return);break;case 3:Vv(d);break;case 12:Vv(d);break;case 22:var _=d.stateNode;d.memoizedState!==null&&_._visibility&2&&(d.return===null||d.return.tag!==13)?(_._visibility&=-3,l_(d)):Vv(d);break;default:Vv(d)}}function l_(d){var _=d.deletions;if((d.flags&16)!==0){if(_!==null)for(var T=0;T<_.length;T++){var D=_[T];ci=D,jb(D,d)}CS(d)}for(d=d.child;d!==null;){switch(_=d,_.tag){case 0:case 11:case 15:qu(8,_,_.return),l_(_);break;case 22:T=_.stateNode,T._visibility&2&&(T._visibility&=-3,l_(_));break;default:l_(_)}d=d.sibling}}function jb(d,_){for(;ci!==null;){var T=ci;switch(T.tag){case 0:case 11:case 15:qu(8,T,_);break;case 23:case 22:if(T.memoizedState!==null&&T.memoizedState.cachePool!==null){var D=T.memoizedState.cachePool.pool;D!=null&&D.refCount++}break;case 24:Fa(T.memoizedState.cache)}if(D=T.child,D!==null)D.return=T,ci=D;else e:for(T=d;ci!==null;){D=ci;var U=D.sibling,G=D.return;if(Nv(D),D===T){ci=null;break e}if(U!==null){U.return=G,ci=U;break e}ci=G}}}var vM={getCacheForType:function(d){var _=ya(Yi),T=_.data.get(d);return T===void 0&&(T=d(),_.data.set(d,T)),T},cacheSignal:function(){return ya(Yi).controller.signal}},$b=typeof WeakMap=="function"?WeakMap:Map,Ci=0,en=null,_i=null,xi=0,Wi=0,fs=null,cf=!1,qp=!1,kd=!1,Qu=0,Zn=0,hf=0,Ld=0,Wb=0,Ks=0,Od=0,Nd=null,qo=null,u_=!1,Uv=0,MS=0,Bd=1/0,c_=null,lh=null,Pa=0,ff=null,Yp=null,Ju=0,Gb=0,Xb=null,Kp=null,On=0,Hv=null;function ds(){return(Ci&2)!==0&&xi!==0?xi&-xi:me.T!==null?pf():Os()}function Zb(){if(Ks===0)if((xi&536870912)===0||ai){var d=rr;rr<<=1,(rr&3932160)===0&&(rr=262144),Ks=d}else Ks=536870912;return d=Ki.current,d!==null&&(d.flags|=32),Ks}function Co(d,_,T){(d===en&&(Wi===2||Wi===9)||d.cancelPendingCommit!==null)&&(Qp(d,0),df(d,xi,Ks,!1)),Mn(d,T),((Ci&2)===0||d!==en)&&(d===en&&((Ci&2)===0&&(Ld|=T),Zn===4&&df(d,xi,Ks,!1)),ou(d))}function zd(d,_,T){if((Ci&6)!==0)throw Error(i(327));var D=!T&&(_&127)===0&&(_&d.expiredLanes)===0||pi(d,_),U=D?DS(d,_):Kb(d,_,!0),G=D;do{if(U===0){qp&&!D&&df(d,_,0,!1);break}else{if(T=d.current.alternate,G&&!mM(T)){U=Kb(d,_,!1),G=!1;continue}if(U===2){if(G=_,d.errorRecoveryDisabledLanes&G)var ne=0;else ne=d.pendingLanes&-536870913,ne=ne!==0?ne:ne&536870912?536870912:0;if(ne!==0){_=ne;e:{var _e=d;U=Nd;var Ue=_e.current.memoizedState.isDehydrated;if(Ue&&(Qp(_e,ne).flags|=256),ne=Kb(_e,ne,!1),ne!==2){if(kd&&!Ue){_e.errorRecoveryDisabledLanes|=G,Ld|=G,U=4;break e}G=qo,qo=U,G!==null&&(qo===null?qo=G:qo.push.apply(qo,G))}U=ne}if(G=!1,U!==2)continue}}if(U===1){Qp(d,0),df(d,_,0,!0);break}e:{switch(D=d,G=U,G){case 0:case 1:throw Error(i(345));case 4:if((_&4194048)!==_)break;case 6:df(D,_,Ks,!cf);break e;case 2:qo=null;break;case 3:case 5:break;default:throw Error(i(329))}if((_&62914560)===_&&(U=Uv+300-ea(),10<U)){if(df(D,_,Ks,!cf),Kr(D,0,!0)!==0)break e;Ju=_,D.timeoutHandle=gx(qb.bind(null,D,T,qo,c_,u_,_,Ks,Ld,Od,cf,G,"Throttled",-0,0),U);break e}qb(D,T,qo,c_,u_,_,Ks,Ld,Od,cf,G,null,-0,0)}}break}while(!0);ou(d)}function qb(d,_,T,D,U,G,ne,_e,Ue,dt,At,Pt,vt,bt){if(d.timeoutHandle=-1,Pt=_.subtreeFlags,Pt&8192||(Pt&16785408)===16785408){Pt={stylesheets:null,count:0,imgCount:0,imgBytes:0,suspenseyImages:[],waitingForImages:!0,waitingForViewTransition:!1,unsuspend:Lo},Dd(_,G,Pt);var fr=(G&62914560)===G?Uv-ea():(G&4194048)===G?MS-ea():0;if(fr=Ee(Pt,fr),fr!==null){Ju=G,d.cancelPendingCommit=fr($v.bind(null,d,_,G,T,D,U,ne,_e,Ue,At,Pt,null,vt,bt)),df(d,G,ne,!dt);return}}$v(d,_,G,T,D,U,ne,_e,Ue)}function mM(d){for(var _=d;;){var T=_.tag;if((T===0||T===11||T===15)&&_.flags&16384&&(T=_.updateQueue,T!==null&&(T=T.stores,T!==null)))for(var D=0;D<T.length;D++){var U=T[D],G=U.getSnapshot;U=U.value;try{if(!Ja(G(),U))return!1}catch{return!1}}if(T=_.child,_.subtreeFlags&16384&&T!==null)T.return=_,_=T;else{if(_===d)break;for(;_.sibling===null;){if(_.return===null||_.return===d)return!0;_=_.return}_.sibling.return=_.return,_=_.sibling}}return!0}function df(d,_,T,D){_&=~Wb,_&=~Ld,d.suspendedLanes|=_,d.pingedLanes&=~_,D&&(d.warmLanes|=_),D=d.expirationTimes;for(var U=_;0<U;){var G=31-it(U),ne=1<<G;D[G]=-1,U&=~ne}T!==0&&fa(d,T,_)}function h_(){return(Ci&6)===0?(Fd(0),!1):!0}function Yb(){if(_i!==null){if(Wi===0)var d=_i.return;else d=_i,Us=xl=null,w(d),Hu=null,Qh=0,d=_i;for(;d!==null;)bS(d.alternate,d),d=d.return;_i=null}}function Qp(d,_){var T=d.timeoutHandle;T!==-1&&(d.timeoutHandle=-1,CM(T)),T=d.cancelPendingCommit,T!==null&&(d.cancelPendingCommit=null,T()),Ju=0,Yb(),en=d,_i=T=Fo(d.current,null),xi=_,Wi=0,fs=null,cf=!1,qp=pi(d,_),kd=!1,Od=Ks=Wb=Ld=hf=Zn=0,qo=Nd=null,u_=!1,(_&8)!==0&&(_|=_&32);var D=d.entangledLanes;if(D!==0)for(d=d.entanglements,D&=_;0<D;){var U=31-it(D),G=1<<U;_|=d[U],D&=~G}return Qu=_,jc(),T}function ES(d,_){kr=null,me.H=rh,_===qc||_===Fu?(_=Sv(),Wi=3):_===yd?(_=Sv(),Wi=4):Wi=_===Iv?8:_!==null&&typeof _=="object"&&typeof _.then=="function"?6:1,fs=_,_i===null&&(Zn=1,Mv(d,to(_,d.current)))}function IS(){var d=Ki.current;return d===null?!0:(xi&4194048)===xi?jo===null:(xi&62914560)===xi||(xi&536870912)!==0?d===jo:!1}function PS(){var d=me.H;return me.H=rh,d===null?rh:d}function RS(){var d=me.A;return me.A=vM,d}function f_(){Zn=4,cf||(xi&4194048)!==xi&&Ki.current!==null||(qp=!0),(hf&134217727)===0&&(Ld&134217727)===0||en===null||df(en,xi,Ks,!1)}function Kb(d,_,T){var D=Ci;Ci|=2;var U=PS(),G=RS();(en!==d||xi!==_)&&(c_=null,Qp(d,_)),_=!1;var ne=Zn;e:do try{if(Wi!==0&&_i!==null){var _e=_i,Ue=fs;switch(Wi){case 8:Yb(),ne=6;break e;case 3:case 2:case 9:case 6:Ki.current===null&&(_=!0);var dt=Wi;if(Wi=0,fs=null,ec(d,_e,Ue,dt),T&&qp){ne=0;break e}break;default:dt=Wi,Wi=0,fs=null,ec(d,_e,Ue,dt)}}yM(),ne=Zn;break}catch(At){ES(d,At)}while(!0);return _&&d.shellSuspendCounter++,Us=xl=null,Ci=D,me.H=U,me.A=G,_i===null&&(en=null,xi=0,jc()),ne}function yM(){for(;_i!==null;)Jb(_i)}function DS(d,_){var T=Ci;Ci|=2;var D=PS(),U=RS();en!==d||xi!==_?(c_=null,Bd=ea()+500,Qp(d,_)):qp=pi(d,_);e:do try{if(Wi!==0&&_i!==null){_=_i;var G=fs;t:switch(Wi){case 1:Wi=0,fs=null,ec(d,_,G,1);break;case 2:case 9:if(Uu(G)){Wi=0,fs=null,uh(_);break}_=function(){Wi!==2&&Wi!==9||en!==d||(Wi=7),ou(d)},G.then(_,_);break e;case 3:Wi=7;break e;case 4:Wi=5;break e;case 7:Uu(G)?(Wi=0,fs=null,uh(_)):(Wi=0,fs=null,ec(d,_,G,7));break;case 5:var ne=null;switch(_i.tag){case 26:ne=_i.memoizedState;case 5:case 27:var _e=_i;if(ne?ce(ne):_e.stateNode.complete){Wi=0,fs=null;var Ue=_e.sibling;if(Ue!==null)_i=Ue;else{var dt=_e.return;dt!==null?(_i=dt,ch(dt)):_i=null}break t}}Wi=0,fs=null,ec(d,_,G,5);break;case 6:Wi=0,fs=null,ec(d,_,G,6);break;case 8:Yb(),Zn=6;break e;default:throw Error(i(462))}}Qb();break}catch(At){ES(d,At)}while(!0);return Us=xl=null,me.H=D,me.A=U,Ci=T,_i!==null?0:(en=null,xi=0,jc(),Zn)}function Qb(){for(;_i!==null&&!Ls();)Jb(_i)}function Jb(d){var _=yS(d.alternate,d,Qu);d.memoizedProps=d.pendingProps,_===null?ch(d):_i=_}function uh(d){var _=d,T=_.alternate;switch(_.tag){case 15:case 0:_=Rb(T,_,_.pendingProps,_.type,void 0,xi);break;case 11:_=Rb(T,_,_.pendingProps,_.type.render,_.ref,xi);break;case 5:w(_);default:bS(T,_),_=_i=qy(_,Qu),_=yS(T,_,Qu)}d.memoizedProps=d.pendingProps,_===null?ch(d):_i=_}function ec(d,_,T,D){Us=xl=null,w(_),Hu=null,Qh=0;var U=_.return;try{if(fM(d,U,_,T,xi)){Zn=1,Mv(d,to(T,d.current)),_i=null;return}}catch(G){if(U!==null)throw _i=U,G;Zn=1,Mv(d,to(T,d.current)),_i=null;return}_.flags&32768?(ai||D===1?d=!0:qp||(xi&536870912)!==0?d=!1:(cf=d=!0,(D===2||D===9||D===3||D===6)&&(D=Ki.current,D!==null&&D.tag===13&&(D.flags|=16384))),jv(_,d)):ch(_)}function ch(d){var _=d;do{if((_.flags&32768)!==0){jv(_,cf);return}d=_.return;var T=pM(_.alternate,_,Qu);if(T!==null){_i=T;return}if(_=_.sibling,_!==null){_i=_;return}_i=_=d}while(_!==null);Zn===0&&(Zn=5)}function jv(d,_){do{var T=gM(d.alternate,d);if(T!==null){T.flags&=32767,_i=T;return}if(T=d.return,T!==null&&(T.flags|=32768,T.subtreeFlags=0,T.deletions=null),!_&&(d=d.sibling,d!==null)){_i=d;return}_i=d=T}while(d!==null);Zn=6,_i=null}function $v(d,_,T,D,U,G,ne,_e,Ue){d.cancelPendingCommit=null;do d_();while(Pa!==0);if((Ci&6)!==0)throw Error(i(327));if(_!==null){if(_===d.current)throw Error(i(177));if(G=_.lanes|_.childLanes,G|=Hc,jn(d,T,G,ne,_e,Ue),d===en&&(_i=en=null,xi=0),Yp=_,ff=d,Ju=T,Gb=G,Xb=U,Kp=D,(_.subtreeFlags&10256)!==0||(_.flags&10256)!==0?(d.callbackNode=null,d.callbackPriority=0,wM(Ya,function(){return rx(),null})):(d.callbackNode=null,d.callbackPriority=0),D=(_.flags&13878)!==0,(_.subtreeFlags&13878)!==0||D){D=me.T,me.T=null,U=De.p,De.p=2,ne=Ci,Ci|=4;try{$p(d,_,T)}finally{Ci=ne,De.p=U,me.T=D}}Pa=1,kS(),LS(),ex()}}function kS(){if(Pa===1){Pa=0;var d=ff,_=Yp,T=(_.flags&13878)!==0;if((_.subtreeFlags&13878)!==0||T){T=me.T,me.T=null;var D=De.p;De.p=2;var U=Ci;Ci|=4;try{TS(_,d);var G=S_,ne=yi(d.containerInfo),_e=G.focusedElem,Ue=G.selectionRange;if(ne!==_e&&_e&&_e.ownerDocument&&Ep(_e.ownerDocument.documentElement,_e)){if(Ue!==null&&Ip(_e)){var dt=Ue.start,At=Ue.end;if(At===void 0&&(At=dt),"selectionStart"in _e)_e.selectionStart=dt,_e.selectionEnd=Math.min(At,_e.value.length);else{var Pt=_e.ownerDocument||document,vt=Pt&&Pt.defaultView||window;if(vt.getSelection){var bt=vt.getSelection(),fr=_e.textContent.length,Lr=Math.min(Ue.start,fr),sn=Ue.end===void 0?Lr:Math.min(Ue.end,fr);!bt.extend&&Lr>sn&&(ne=sn,sn=Lr,Lr=ne);var Je=Mp(_e,Lr),Ze=Mp(_e,sn);if(Je&&Ze&&(bt.rangeCount!==1||bt.anchorNode!==Je.node||bt.anchorOffset!==Je.offset||bt.focusNode!==Ze.node||bt.focusOffset!==Ze.offset)){var ft=Pt.createRange();ft.setStart(Je.node,Je.offset),bt.removeAllRanges(),Lr>sn?(bt.addRange(ft),bt.extend(Ze.node,Ze.offset)):(ft.setEnd(Ze.node,Ze.offset),bt.addRange(ft))}}}}for(Pt=[],bt=_e;bt=bt.parentNode;)bt.nodeType===1&&Pt.push({element:bt,left:bt.scrollLeft,top:bt.scrollTop});for(typeof _e.focus=="function"&&_e.focus(),_e=0;_e<Pt.length;_e++){var Mt=Pt[_e];Mt.element.scrollLeft=Mt.left,Mt.element.scrollTop=Mt.top}}xr=!!w_,S_=w_=null}finally{Ci=U,De.p=D,me.T=T}}d.current=_,Pa=2}}function LS(){if(Pa===2){Pa=0;var d=ff,_=Yp,T=(_.flags&8772)!==0;if((_.subtreeFlags&8772)!==0||T){T=me.T,me.T=null;var D=De.p;De.p=2;var U=Ci;Ci|=4;try{Vb(d,_.alternate,_)}finally{Ci=U,De.p=D,me.T=T}}Pa=3}}function ex(){if(Pa===4||Pa===3){Pa=0,vo();var d=ff,_=Yp,T=Ju,D=Kp;(_.subtreeFlags&10256)!==0||(_.flags&10256)!==0?Pa=5:(Pa=0,Yp=ff=null,tx(d,d.pendingLanes));var U=d.pendingLanes;if(U===0&&(lh=null),It(T),_=_.stateNode,Be&&typeof Be.onCommitFiberRoot=="function")try{Be.onCommitFiberRoot(Ne,_,void 0,(_.current.flags&128)===128)}catch{}if(D!==null){_=me.T,U=De.p,De.p=2,me.T=null;try{for(var G=d.onRecoverableError,ne=0;ne<D.length;ne++){var _e=D[ne];G(_e.value,{componentStack:_e.stack})}}finally{me.T=_,De.p=U}}(Ju&3)!==0&&d_(),ou(d),U=d.pendingLanes,(T&261930)!==0&&(U&42)!==0?d===Hv?On++:(On=0,Hv=d):On=0,Fd(0)}}function tx(d,_){(d.pooledCacheLanes&=_)===0&&(_=d.pooledCache,_!=null&&(d.pooledCache=null,Fa(_)))}function d_(){return kS(),LS(),ex(),rx()}function rx(){if(Pa!==5)return!1;var d=ff,_=Gb;Gb=0;var T=It(Ju),D=me.T,U=De.p;try{De.p=32>T?32:T,me.T=null,T=Xb,Xb=null;var G=ff,ne=Ju;if(Pa=0,Yp=ff=null,Ju=0,(Ci&6)!==0)throw Error(i(331));var _e=Ci;if(Ci|=4,Hb(G.current),AS(G,G.current,ne,T),Ci=_e,Fd(0,!1),Be&&typeof Be.onPostCommitFiberRoot=="function")try{Be.onPostCommitFiberRoot(Ne,G)}catch{}return!0}finally{De.p=U,me.T=D,tx(d,_)}}function ix(d,_,T){_=to(T,_),_=Qy(d.stateNode,_,2),d=cs(d,_,2),d!==null&&(Mn(d,2),ou(d))}function Ui(d,_,T){if(d.tag===3)ix(d,d,T);else for(;_!==null;){if(_.tag===3){ix(_,d,T);break}else if(_.tag===1){var D=_.stateNode;if(typeof _.type.getDerivedStateFromError=="function"||typeof D.componentDidCatch=="function"&&(lh===null||!lh.has(D))){d=to(T,d),T=hS(2),D=cs(_,T,2),D!==null&&(Jy(T,D,_,d),Mn(D,2),ou(D));break}}_=_.return}}function Wv(d,_,T){var D=d.pingCache;if(D===null){D=d.pingCache=new $b;var U=new Set;D.set(_,U)}else U=D.get(_),U===void 0&&(U=new Set,D.set(_,U));U.has(T)||(kd=!0,U.add(T),d=_M.bind(null,d,_,T),_.then(d,d))}function _M(d,_,T){var D=d.pingCache;D!==null&&D.delete(_),d.pingedLanes|=d.suspendedLanes&T,d.warmLanes&=~T,en===d&&(xi&T)===T&&(Zn===4||Zn===3&&(xi&62914560)===xi&&300>ea()-Uv?(Ci&2)===0&&Qp(d,0):Wb|=T,Od===xi&&(Od=0)),ou(d)}function nx(d,_){_===0&&(_=ui()),d=ss(d,_),d!==null&&(Mn(d,_),ou(d))}function bM(d){var _=d.memoizedState,T=0;_!==null&&(T=_.retryLane),nx(d,T)}function xM(d,_){var T=0;switch(d.tag){case 31:case 13:var D=d.stateNode,U=d.memoizedState;U!==null&&(T=U.retryLane);break;case 19:D=d.stateNode;break;case 22:D=d.stateNode._retryCache;break;default:throw Error(i(314))}D!==null&&D.delete(_),nx(d,T)}function wM(d,_){return Oa(d,_)}var p_=null,Jp=null,g_=!1,Gv=!1,au=!1,Yo=0;function ou(d){d!==Jp&&d.next===null&&(Jp===null?p_=Jp=d:Jp=Jp.next=d),Gv=!0,g_||(g_=!0,ax())}function Fd(d,_){if(!au&&Gv){au=!0;do for(var T=!1,D=p_;D!==null;){if(d!==0){var U=D.pendingLanes;if(U===0)var G=0;else{var ne=D.suspendedLanes,_e=D.pingedLanes;G=(1<<31-it(42|d)+1)-1,G&=U&~(ne&~_e),G=G&201326741?G&201326741|1:G?G|2:0}G!==0&&(T=!0,m_(D,G))}else G=xi,G=Kr(D,D===en?G:0,D.cancelPendingCommit!==null||D.timeoutHandle!==-1),(G&3)===0||pi(D,G)||(T=!0,m_(D,G));D=D.next}while(T);au=!1}}function SM(){Xv()}function Xv(){Gv=g_=!1;var d=0;Yo!==0&&VS()&&(d=Yo);for(var _=ea(),T=null,D=p_;D!==null;){var U=D.next,G=v_(D,_);G===0?(D.next=null,T===null?p_=U:T.next=U,U===null&&(Jp=T)):(T=D,(d!==0||(G&3)!==0)&&(Gv=!0)),D=U}Pa!==0&&Pa!==5||Fd(d),Yo!==0&&(Yo=0)}function v_(d,_){for(var T=d.suspendedLanes,D=d.pingedLanes,U=d.expirationTimes,G=d.pendingLanes&-62914561;0<G;){var ne=31-it(G),_e=1<<ne,Ue=U[ne];Ue===-1?((_e&T)===0||(_e&D)!==0)&&(U[ne]=or(_e,_)):Ue<=_&&(d.expiredLanes|=_e),G&=~_e}if(_=en,T=xi,T=Kr(d,d===_?T:0,d.cancelPendingCommit!==null||d.timeoutHandle!==-1),D=d.callbackNode,T===0||d===_&&(Wi===2||Wi===9)||d.cancelPendingCommit!==null)return D!==null&&D!==null&&Na(D),d.callbackNode=null,d.callbackPriority=0;if((T&3)===0||pi(d,T)){if(_=T&-T,_===d.callbackPriority)return _;switch(D!==null&&Na(D),It(T)){case 2:case 8:T=Ll;break;case 32:T=Ya;break;case 268435456:T=he;break;default:T=Ya}return D=OS.bind(null,d),T=Oa(T,D),d.callbackPriority=_,d.callbackNode=T,_}return D!==null&&D!==null&&Na(D),d.callbackPriority=2,d.callbackNode=null,2}function OS(d,_){if(Pa!==0&&Pa!==5)return d.callbackNode=null,d.callbackPriority=0,null;var T=d.callbackNode;if(d_()&&d.callbackNode!==T)return null;var D=xi;return D=Kr(d,d===en?D:0,d.cancelPendingCommit!==null||d.timeoutHandle!==-1),D===0?null:(zd(d,D,_),v_(d,ea()),d.callbackNode!=null&&d.callbackNode===T?OS.bind(null,d):null)}function m_(d,_){if(d_())return null;zd(d,_,!0)}function ax(){HS(function(){(Ci&6)!==0?Oa(Do,SM):Xv()})}function pf(){if(Yo===0){var d=Ea;d===0&&(d=St,St<<=1,(St&261888)===0&&(St=256)),Yo=d}return Yo}function ox(d){return d==null||typeof d=="symbol"||typeof d=="boolean"?null:typeof d=="function"?d:Zr(""+d)}function sx(d,_){var T=_.ownerDocument.createElement("input");return T.name=_.name,T.value=_.value,d.id&&T.setAttribute("form",d.id),_.parentNode.insertBefore(T,_),d=new FormData(d),T.parentNode.removeChild(T),d}function lx(d,_,T,D,U){if(_==="submit"&&T&&T.stateNode===U){var G=ox((U[Lt]||null).action),ne=D.submitter;ne&&(_=(_=ne[Lt]||null)?ox(_.formAction):ne.getAttribute("formAction"),_!==null&&(G=_,ne=null));var _e=new zh("action","action",null,D,U);d.push({event:_e,listeners:[{instance:null,listener:function(){if(D.defaultPrevented){if(Yo!==0){var Ue=ne?sx(U,ne):new FormData(U);hs(T,{pending:!0,data:Ue,method:U.method,action:G},null,Ue)}}else typeof G=="function"&&(_e.preventDefault(),Ue=ne?sx(U,ne):new FormData(U),hs(T,{pending:!0,data:Ue,method:U.method,action:G},G,Ue))},currentTarget:U}]})}}for(var y_=0;y_<Rp.length;y_++){var eg=Rp[y_],NS=eg.toLowerCase(),TM=eg[0].toUpperCase()+eg.slice(1);Bo(NS,"on"+TM)}Bo(sd,"onAnimationEnd"),Bo(ld,"onAnimationIteration"),Bo(Pp,"onAnimationStart"),Bo("dblclick","onDoubleClick"),Bo("focusin","onFocus"),Bo("focusout","onBlur"),Bo(Uc,"onTransitionRun"),Bo(ud,"onTransitionStart"),Bo(Gh,"onTransitionCancel"),Bo(No,"onTransitionEnd"),hl("onMouseEnter",["mouseout","mouseover"]),hl("onMouseLeave",["mouseout","mouseover"]),hl("onPointerEnter",["pointerout","pointerover"]),hl("onPointerLeave",["pointerout","pointerover"]),Ri("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),Ri("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),Ri("onBeforeInput",["compositionend","keypress","textInput","paste"]),Ri("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),Ri("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),Ri("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Zv="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),AM=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat(Zv));function BS(d,_){_=(_&4)!==0;for(var T=0;T<d.length;T++){var D=d[T],U=D.event;D=D.listeners;e:{var G=void 0;if(_)for(var ne=D.length-1;0<=ne;ne--){var _e=D[ne],Ue=_e.instance,dt=_e.currentTarget;if(_e=_e.listener,Ue!==G&&U.isPropagationStopped())break e;G=_e,U.currentTarget=dt;try{G(U)}catch(At){yl(At)}U.currentTarget=null,G=Ue}else for(ne=0;ne<D.length;ne++){if(_e=D[ne],Ue=_e.instance,dt=_e.currentTarget,_e=_e.listener,Ue!==G&&U.isPropagationStopped())break e;G=_e,U.currentTarget=dt;try{G(U)}catch(At){yl(At)}U.currentTarget=null,G=Ue}}}}function bi(d,_){var T=_[Ur];T===void 0&&(T=_[Ur]=new Set);var D=d+"__bubble";T.has(D)||(ux(_,d,2,!1),T.add(D))}function qv(d,_,T){var D=0;_&&(D|=4),ux(T,d,D,_)}var su="_reactListening"+Math.random().toString(36).slice(2);function __(d){if(!d[su]){d[su]=!0,Pn.forEach(function(T){T!=="selectionchange"&&(AM.has(T)||qv(T,!1,d),qv(T,!0,d))});var _=d.nodeType===9?d:d.ownerDocument;_===null||_[su]||(_[su]=!0,qv("selectionchange",!1,_))}}function ux(d,_,T,D){switch(Ra(_)){case 2:var U=Er;break;case 8:U=vr;break;default:U=ar}T=U.bind(null,_,T,d),U=void 0,!Qa||_!=="touchstart"&&_!=="touchmove"&&_!=="wheel"||(U=!0),D?U!==void 0?d.addEventListener(_,T,{capture:!0,passive:U}):d.addEventListener(_,T,!0):U!==void 0?d.addEventListener(_,T,{passive:U}):d.addEventListener(_,T,!1)}function b_(d,_,T,D,U){var G=D;if((_&1)===0&&(_&2)===0&&D!==null)e:for(;;){if(D===null)return;var ne=D.tag;if(ne===3||ne===4){var _e=D.stateNode.containerInfo;if(_e===U)break;if(ne===4)for(ne=D.return;ne!==null;){var Ue=ne.tag;if((Ue===3||Ue===4)&&ne.stateNode.containerInfo===U)return;ne=ne.return}for(;_e!==null;){if(ne=cl(_e),ne===null)return;if(Ue=ne.tag,Ue===5||Ue===6||Ue===26||Ue===27){D=G=ne;continue e}_e=_e.parentNode}}D=D.return}qi(function(){var dt=G,At=Cu(T),Pt=[];e:{var vt=yv.get(d);if(vt!==void 0){var bt=zh,fr=d;switch(d){case"keypress":if(Mr(T)===0)break e;case"keydown":case"keyup":bt=Vl;break;case"focusin":fr="focus",bt=Bc;break;case"focusout":fr="blur",bt=Bc;break;case"beforeblur":case"afterblur":bt=Bc;break;case"click":if(T.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":bt=Fh;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":bt=ga;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":bt=Ab;break;case sd:case ld:case Pp:bt=va;break;case No:bt=Cb;break;case"scroll":case"scrollend":bt=Qf;break;case"wheel":bt=av;break;case"copy":case"cut":case"paste":bt=bp;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":bt=iv;break;case"toggle":case"beforetoggle":bt=Uh}var Lr=(_&4)!==0,sn=!Lr&&(d==="scroll"||d==="scrollend"),Je=Lr?vt!==null?vt+"Capture":null:vt;Lr=[];for(var Ze=dt,ft;Ze!==null;){var Mt=Ze;if(ft=Mt.stateNode,Mt=Mt.tag,Mt!==5&&Mt!==26&&Mt!==27||ft===null||Je===null||(Mt=pl(Ze,Je),Mt!=null&&Lr.push(tg(Ze,Mt,ft))),sn)break;Ze=Ze.return}0<Lr.length&&(vt=new bt(vt,fr,null,T,At),Pt.push({event:vt,listeners:Lr}))}}if((_&7)===0){e:{if(vt=d==="mouseover"||d==="pointerover",bt=d==="mouseout"||d==="pointerout",vt&&T!==Dc&&(fr=T.relatedTarget||T.fromElement)&&(cl(fr)||fr[Br]))break e;if((bt||vt)&&(vt=At.window===At?At:(vt=At.ownerDocument)?vt.defaultView||vt.parentWindow:window,bt?(fr=T.relatedTarget||T.toElement,bt=dt,fr=fr?cl(fr):null,fr!==null&&(sn=a(fr),Lr=fr.tag,fr!==sn||Lr!==5&&Lr!==27&&Lr!==6)&&(fr=null)):(bt=null,fr=dt),bt!==fr)){if(Lr=Fh,Mt="onMouseLeave",Je="onMouseEnter",Ze="mouse",(d==="pointerout"||d==="pointerover")&&(Lr=iv,Mt="onPointerLeave",Je="onPointerEnter",Ze="pointer"),sn=bt==null?vt:Ol(bt),ft=fr==null?vt:Ol(fr),vt=new Lr(Mt,Ze+"leave",bt,T,At),vt.target=sn,vt.relatedTarget=ft,Mt=null,cl(At)===dt&&(Lr=new Lr(Je,Ze+"enter",fr,T,At),Lr.target=ft,Lr.relatedTarget=sn,Mt=Lr),sn=Mt,bt&&fr)t:{for(Lr=cx,Je=bt,Ze=fr,ft=0,Mt=Je;Mt;Mt=Lr(Mt))ft++;Mt=0;for(var Ar=Ze;Ar;Ar=Lr(Ar))Mt++;for(;0<ft-Mt;)Je=Lr(Je),ft--;for(;0<Mt-ft;)Ze=Lr(Ze),Mt--;for(;ft--;){if(Je===Ze||Ze!==null&&Je===Ze.alternate){Lr=Je;break t}Je=Lr(Je),Ze=Lr(Ze)}Lr=null}else Lr=null;bt!==null&&hx(Pt,vt,bt,Lr,!1),fr!==null&&sn!==null&&hx(Pt,sn,fr,Lr,!0)}}e:{if(vt=dt?Ol(dt):window,bt=vt.nodeName&&vt.nodeName.toLowerCase(),bt==="select"||bt==="input"&&vt.type==="file")var zi=Iu;else if(uv(vt))if(cv)zi=Xy;else{zi=fv;var er=Wy}else bt=vt.nodeName,!bt||bt.toLowerCase()!=="input"||vt.type!=="checkbox"&&vt.type!=="radio"?dt&&Au(dt.elementType)&&(zi=Iu):zi=Gy;if(zi&&(zi=zi(d,dt))){Ap(Pt,zi,T,At);break e}er&&er(d,vt,dt),d==="focusout"&&dt&&vt.type==="number"&&dt.memoizedProps.value!=null&&Bl(vt,"number",vt.value)}switch(er=dt?Ol(dt):window,d){case"focusin":(uv(er)||er.contentEditable==="true")&&(os=er,ad=dt,od=null);break;case"focusout":od=ad=os=null;break;case"mousedown":gv=!0;break;case"contextmenu":case"mouseup":case"dragend":gv=!1,Zy(Pt,T,At);break;case"selectionchange":if(pv)break;case"keydown":case"keyup":Zy(Pt,T,At)}var Ir;if(Oo)e:{switch(d){case"compositionstart":var ei="onCompositionStart";break e;case"compositionend":ei="onCompositionEnd";break e;case"compositionupdate":ei="onCompositionUpdate";break e}ei=void 0}else zs?td(d,T)&&(ei="onCompositionEnd"):d==="keydown"&&T.keyCode===229&&(ei="onCompositionStart");ei&&(zc&&T.locale!=="ko"&&(zs||ei!=="onCompositionStart"?ei==="onCompositionEnd"&&zs&&(Ir=Qr()):(ns=At,Di="value"in ns?ns.value:ns.textContent,zs=!0)),er=Yv(dt,ei),0<er.length&&(ei=new Fy(ei,d,null,T,At),Pt.push({event:ei,listeners:er}),Ir?ei.data=Ir:(Ir=Uy(T),Ir!==null&&(ei.data=Ir)))),(Ir=sv?Hy(d,T):lv(d,T))&&(ei=Yv(dt,"onBeforeInput"),0<ei.length&&(er=new Fy("onBeforeInput","beforeinput",null,T,At),Pt.push({event:er,listeners:ei}),er.data=Ir)),lx(Pt,d,dt,T,At)}BS(Pt,_)})}function tg(d,_,T){return{instance:d,listener:_,currentTarget:T}}function Yv(d,_){for(var T=_+"Capture",D=[];d!==null;){var U=d,G=U.stateNode;if(U=U.tag,U!==5&&U!==26&&U!==27||G===null||(U=pl(d,T),U!=null&&D.unshift(tg(d,U,G)),U=pl(d,_),U!=null&&D.push(tg(d,U,G))),d.tag===3)return D;d=d.return}return[]}function cx(d){if(d===null)return null;do d=d.return;while(d&&d.tag!==5&&d.tag!==27);return d||null}function hx(d,_,T,D,U){for(var G=_._reactName,ne=[];T!==null&&T!==D;){var _e=T,Ue=_e.alternate,dt=_e.stateNode;if(_e=_e.tag,Ue!==null&&Ue===D)break;_e!==5&&_e!==26&&_e!==27||dt===null||(Ue=dt,U?(dt=pl(T,G),dt!=null&&ne.unshift(tg(T,dt,Ue))):U||(dt=pl(T,G),dt!=null&&ne.push(tg(T,dt,Ue)))),T=T.return}ne.length!==0&&d.push({event:_,listeners:ne})}var Kv=/\r\n?/g,zS=/\u0000|\uFFFD/g;function x_(d){return(typeof d=="string"?d:""+d).replace(Kv,`
`).replace(zS,"")}function fx(d,_){return _=x_(_),x_(d)===_}function hi(d,_,T,D,U,G){switch(T){case"children":typeof D=="string"?_==="body"||_==="textarea"&&D===""||dl(d,D):(typeof D=="number"||typeof D=="bigint")&&_!=="body"&&dl(d,""+D);break;case"className":Nh(d,"class",D);break;case"tabIndex":Nh(d,"tabindex",D);break;case"dir":case"role":case"viewBox":case"width":case"height":Nh(d,T,D);break;case"style":ni(d,D,G);break;case"data":if(_!=="object"){Nh(d,"data",D);break}case"src":case"href":if(D===""&&(_!=="a"||T!=="href")){d.removeAttribute(T);break}if(D==null||typeof D=="function"||typeof D=="symbol"||typeof D=="boolean"){d.removeAttribute(T);break}D=Zr(""+D),d.setAttribute(T,D);break;case"action":case"formAction":if(typeof D=="function"){d.setAttribute(T,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}else typeof G=="function"&&(T==="formAction"?(_!=="input"&&hi(d,_,"name",U.name,U,null),hi(d,_,"formEncType",U.formEncType,U,null),hi(d,_,"formMethod",U.formMethod,U,null),hi(d,_,"formTarget",U.formTarget,U,null)):(hi(d,_,"encType",U.encType,U,null),hi(d,_,"method",U.method,U,null),hi(d,_,"target",U.target,U,null)));if(D==null||typeof D=="symbol"||typeof D=="boolean"){d.removeAttribute(T);break}D=Zr(""+D),d.setAttribute(T,D);break;case"onClick":D!=null&&(d.onclick=Lo);break;case"onScroll":D!=null&&bi("scroll",d);break;case"onScrollEnd":D!=null&&bi("scrollend",d);break;case"dangerouslySetInnerHTML":if(D!=null){if(typeof D!="object"||!("__html"in D))throw Error(i(61));if(T=D.__html,T!=null){if(U.children!=null)throw Error(i(60));d.innerHTML=T}}break;case"multiple":d.multiple=D&&typeof D!="function"&&typeof D!="symbol";break;case"muted":d.muted=D&&typeof D!="function"&&typeof D!="symbol";break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":break;case"autoFocus":break;case"xlinkHref":if(D==null||typeof D=="function"||typeof D=="boolean"||typeof D=="symbol"){d.removeAttribute("xlink:href");break}T=Zr(""+D),d.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",T);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":D!=null&&typeof D!="function"&&typeof D!="symbol"?d.setAttribute(T,""+D):d.removeAttribute(T);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":D&&typeof D!="function"&&typeof D!="symbol"?d.setAttribute(T,""):d.removeAttribute(T);break;case"capture":case"download":D===!0?d.setAttribute(T,""):D!==!1&&D!=null&&typeof D!="function"&&typeof D!="symbol"?d.setAttribute(T,D):d.removeAttribute(T);break;case"cols":case"rows":case"size":case"span":D!=null&&typeof D!="function"&&typeof D!="symbol"&&!isNaN(D)&&1<=D?d.setAttribute(T,D):d.removeAttribute(T);break;case"rowSpan":case"start":D==null||typeof D=="function"||typeof D=="symbol"||isNaN(D)?d.removeAttribute(T):d.setAttribute(T,D);break;case"popover":bi("beforetoggle",d),bi("toggle",d),qf(d,"popover",D);break;case"xlinkActuate":fl(d,"http://www.w3.org/1999/xlink","xlink:actuate",D);break;case"xlinkArcrole":fl(d,"http://www.w3.org/1999/xlink","xlink:arcrole",D);break;case"xlinkRole":fl(d,"http://www.w3.org/1999/xlink","xlink:role",D);break;case"xlinkShow":fl(d,"http://www.w3.org/1999/xlink","xlink:show",D);break;case"xlinkTitle":fl(d,"http://www.w3.org/1999/xlink","xlink:title",D);break;case"xlinkType":fl(d,"http://www.w3.org/1999/xlink","xlink:type",D);break;case"xmlBase":fl(d,"http://www.w3.org/XML/1998/namespace","xml:base",D);break;case"xmlLang":fl(d,"http://www.w3.org/XML/1998/namespace","xml:lang",D);break;case"xmlSpace":fl(d,"http://www.w3.org/XML/1998/namespace","xml:space",D);break;case"is":qf(d,"is",D);break;case"innerText":case"textContent":break;default:(!(2<T.length)||T[0]!=="o"&&T[0]!=="O"||T[1]!=="n"&&T[1]!=="N")&&(T=Ka.get(T)||T,qf(d,T,D))}}function gf(d,_,T,D,U,G){switch(T){case"style":ni(d,D,G);break;case"dangerouslySetInnerHTML":if(D!=null){if(typeof D!="object"||!("__html"in D))throw Error(i(61));if(T=D.__html,T!=null){if(U.children!=null)throw Error(i(60));d.innerHTML=T}}break;case"children":typeof D=="string"?dl(d,D):(typeof D=="number"||typeof D=="bigint")&&dl(d,""+D);break;case"onScroll":D!=null&&bi("scroll",d);break;case"onScrollEnd":D!=null&&bi("scrollend",d);break;case"onClick":D!=null&&(d.onclick=Lo);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":break;case"innerText":case"textContent":break;default:if(!_o.hasOwnProperty(T))e:{if(T[0]==="o"&&T[1]==="n"&&(U=T.endsWith("Capture"),_=T.slice(2,U?T.length-7:void 0),G=d[Lt]||null,G=G!=null?G[T]:null,typeof G=="function"&&d.removeEventListener(_,G,U),typeof D=="function")){typeof G!="function"&&G!==null&&(T in d?d[T]=null:d.hasAttribute(T)&&d.removeAttribute(T)),d.addEventListener(_,D,U);break e}T in d?d[T]=D:D===!0?d.setAttribute(T,""):qf(d,T,D)}}}function sa(d,_,T){switch(_){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":bi("error",d),bi("load",d);var D=!1,U=!1,G;for(G in T)if(T.hasOwnProperty(G)){var ne=T[G];if(ne!=null)switch(G){case"src":D=!0;break;case"srcSet":U=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(i(137,_));default:hi(d,_,G,ne,T,null)}}U&&hi(d,_,"srcSet",T.srcSet,T,null),D&&hi(d,_,"src",T.src,T,null);return;case"input":bi("invalid",d);var _e=G=ne=U=null,Ue=null,dt=null;for(D in T)if(T.hasOwnProperty(D)){var At=T[D];if(At!=null)switch(D){case"name":U=At;break;case"type":ne=At;break;case"checked":Ue=At;break;case"defaultChecked":dt=At;break;case"value":G=At;break;case"defaultValue":_e=At;break;case"children":case"dangerouslySetInnerHTML":if(At!=null)throw Error(i(137,_));break;default:hi(d,_,D,At,T,null)}}tv(d,G,_e,Ue,dt,ne,U,!1);return;case"select":bi("invalid",d),D=ne=G=null;for(U in T)if(T.hasOwnProperty(U)&&(_e=T[U],_e!=null))switch(U){case"value":G=_e;break;case"defaultValue":ne=_e;break;case"multiple":D=_e;default:hi(d,_,U,_e,T,null)}_=G,T=ne,d.multiple=!!D,_!=null?Tu(d,!!D,_,!1):T!=null&&Tu(d,!!D,T,!0);return;case"textarea":bi("invalid",d),G=U=D=null;for(ne in T)if(T.hasOwnProperty(ne)&&(_e=T[ne],_e!=null))switch(ne){case"value":D=_e;break;case"defaultValue":U=_e;break;case"children":G=_e;break;case"dangerouslySetInnerHTML":if(_e!=null)throw Error(i(91));break;default:hi(d,_,ne,_e,T,null)}Bh(d,D,U,G);return;case"option":for(Ue in T)if(T.hasOwnProperty(Ue)&&(D=T[Ue],D!=null))switch(Ue){case"selected":d.selected=D&&typeof D!="function"&&typeof D!="symbol";break;default:hi(d,_,Ue,D,T,null)}return;case"dialog":bi("beforetoggle",d),bi("toggle",d),bi("cancel",d),bi("close",d);break;case"iframe":case"object":bi("load",d);break;case"video":case"audio":for(D=0;D<Zv.length;D++)bi(Zv[D],d);break;case"image":bi("error",d),bi("load",d);break;case"details":bi("toggle",d);break;case"embed":case"source":case"link":bi("error",d),bi("load",d);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(dt in T)if(T.hasOwnProperty(dt)&&(D=T[dt],D!=null))switch(dt){case"children":case"dangerouslySetInnerHTML":throw Error(i(137,_));default:hi(d,_,dt,D,T,null)}return;default:if(Au(_)){for(At in T)T.hasOwnProperty(At)&&(D=T[At],D!==void 0&&gf(d,_,At,D,T,void 0));return}}for(_e in T)T.hasOwnProperty(_e)&&(D=T[_e],D!=null&&hi(d,_,_e,D,T,null))}function Vd(d,_,T,D){switch(_){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var U=null,G=null,ne=null,_e=null,Ue=null,dt=null,At=null;for(bt in T){var Pt=T[bt];if(T.hasOwnProperty(bt)&&Pt!=null)switch(bt){case"checked":break;case"value":break;case"defaultValue":Ue=Pt;default:D.hasOwnProperty(bt)||hi(d,_,bt,null,D,Pt)}}for(var vt in D){var bt=D[vt];if(Pt=T[vt],D.hasOwnProperty(vt)&&(bt!=null||Pt!=null))switch(vt){case"type":G=bt;break;case"name":U=bt;break;case"checked":dt=bt;break;case"defaultChecked":At=bt;break;case"value":ne=bt;break;case"defaultValue":_e=bt;break;case"children":case"dangerouslySetInnerHTML":if(bt!=null)throw Error(i(137,_));break;default:bt!==Pt&&hi(d,_,vt,bt,D,Pt)}}Kf(d,ne,_e,Ue,dt,At,G,U);return;case"select":bt=ne=_e=vt=null;for(G in T)if(Ue=T[G],T.hasOwnProperty(G)&&Ue!=null)switch(G){case"value":break;case"multiple":bt=Ue;default:D.hasOwnProperty(G)||hi(d,_,G,null,D,Ue)}for(U in D)if(G=D[U],Ue=T[U],D.hasOwnProperty(U)&&(G!=null||Ue!=null))switch(U){case"value":vt=G;break;case"defaultValue":_e=G;break;case"multiple":ne=G;default:G!==Ue&&hi(d,_,U,G,D,Ue)}_=_e,T=ne,D=bt,vt!=null?Tu(d,!!T,vt,!1):!!D!=!!T&&(_!=null?Tu(d,!!T,_,!0):Tu(d,!!T,T?[]:"",!1));return;case"textarea":bt=vt=null;for(_e in T)if(U=T[_e],T.hasOwnProperty(_e)&&U!=null&&!D.hasOwnProperty(_e))switch(_e){case"value":break;case"children":break;default:hi(d,_,_e,null,D,U)}for(ne in D)if(U=D[ne],G=T[ne],D.hasOwnProperty(ne)&&(U!=null||G!=null))switch(ne){case"value":vt=U;break;case"defaultValue":bt=U;break;case"children":break;case"dangerouslySetInnerHTML":if(U!=null)throw Error(i(91));break;default:U!==G&&hi(d,_,ne,U,D,G)}By(d,vt,bt);return;case"option":for(var fr in T)if(vt=T[fr],T.hasOwnProperty(fr)&&vt!=null&&!D.hasOwnProperty(fr))switch(fr){case"selected":d.selected=!1;break;default:hi(d,_,fr,null,D,vt)}for(Ue in D)if(vt=D[Ue],bt=T[Ue],D.hasOwnProperty(Ue)&&vt!==bt&&(vt!=null||bt!=null))switch(Ue){case"selected":d.selected=vt&&typeof vt!="function"&&typeof vt!="symbol";break;default:hi(d,_,Ue,vt,D,bt)}return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var Lr in T)vt=T[Lr],T.hasOwnProperty(Lr)&&vt!=null&&!D.hasOwnProperty(Lr)&&hi(d,_,Lr,null,D,vt);for(dt in D)if(vt=D[dt],bt=T[dt],D.hasOwnProperty(dt)&&vt!==bt&&(vt!=null||bt!=null))switch(dt){case"children":case"dangerouslySetInnerHTML":if(vt!=null)throw Error(i(137,_));break;default:hi(d,_,dt,vt,D,bt)}return;default:if(Au(_)){for(var sn in T)vt=T[sn],T.hasOwnProperty(sn)&&vt!==void 0&&!D.hasOwnProperty(sn)&&gf(d,_,sn,void 0,D,vt);for(At in D)vt=D[At],bt=T[At],!D.hasOwnProperty(At)||vt===bt||vt===void 0&&bt===void 0||gf(d,_,At,vt,D,bt);return}}for(var Je in T)vt=T[Je],T.hasOwnProperty(Je)&&vt!=null&&!D.hasOwnProperty(Je)&&hi(d,_,Je,null,D,vt);for(Pt in D)vt=D[Pt],bt=T[Pt],!D.hasOwnProperty(Pt)||vt===bt||vt==null&&bt==null||hi(d,_,Pt,vt,D,bt)}function dx(d){switch(d){case"css":case"script":case"font":case"img":case"image":case"input":case"link":return!0;default:return!1}}function FS(){if(typeof performance.getEntriesByType=="function"){for(var d=0,_=0,T=performance.getEntriesByType("resource"),D=0;D<T.length;D++){var U=T[D],G=U.transferSize,ne=U.initiatorType,_e=U.duration;if(G&&_e&&dx(ne)){for(ne=0,_e=U.responseEnd,D+=1;D<T.length;D++){var Ue=T[D],dt=Ue.startTime;if(dt>_e)break;var At=Ue.transferSize,Pt=Ue.initiatorType;At&&dx(Pt)&&(Ue=Ue.responseEnd,ne+=At*(Ue<_e?1:(_e-dt)/(Ue-dt)))}if(--D,_+=8*(G+ne)/(U.duration/1e3),d++,10<d)break}}if(0<d)return _/d/1e6}return navigator.connection&&(d=navigator.connection.downlink,typeof d=="number")?d:5}var w_=null,S_=null;function T_(d){return d.nodeType===9?d:d.ownerDocument}function px(d){switch(d){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function hh(d,_){if(d===0)switch(_){case"svg":return 1;case"math":return 2;default:return 0}return d===1&&_==="foreignObject"?0:d}function A_(d,_){return d==="textarea"||d==="noscript"||typeof _.children=="string"||typeof _.children=="number"||typeof _.children=="bigint"||typeof _.dangerouslySetInnerHTML=="object"&&_.dangerouslySetInnerHTML!==null&&_.dangerouslySetInnerHTML.__html!=null}var C_=null;function VS(){var d=window.event;return d&&d.type==="popstate"?d===C_?!1:(C_=d,!0):(C_=null,!1)}var gx=typeof setTimeout=="function"?setTimeout:void 0,CM=typeof clearTimeout=="function"?clearTimeout:void 0,US=typeof Promise=="function"?Promise:void 0,HS=typeof queueMicrotask=="function"?queueMicrotask:typeof US<"u"?function(d){return US.resolve(null).then(d).catch(jS)}:gx;function jS(d){setTimeout(function(){throw d})}function lu(d){return d==="head"}function vx(d,_){var T=_,D=0;do{var U=T.nextSibling;if(d.removeChild(T),U&&U.nodeType===8)if(T=U.data,T==="/$"||T==="/&"){if(D===0){d.removeChild(U),Eo(_);return}D--}else if(T==="$"||T==="$?"||T==="$~"||T==="$!"||T==="&")D++;else if(T==="html")ig(d.ownerDocument.documentElement);else if(T==="head"){T=d.ownerDocument.head,ig(T);for(var G=T.firstChild;G;){var ne=G.nextSibling,_e=G.nodeName;G[Nr]||_e==="SCRIPT"||_e==="STYLE"||_e==="LINK"&&G.rel.toLowerCase()==="stylesheet"||T.removeChild(G),G=ne}}else T==="body"&&ig(d.ownerDocument.body);T=U}while(T);Eo(_)}function Qv(d,_){var T=d;d=0;do{var D=T.nextSibling;if(T.nodeType===1?_?(T._stashedDisplay=T.style.display,T.style.display="none"):(T.style.display=T._stashedDisplay||"",T.getAttribute("style")===""&&T.removeAttribute("style")):T.nodeType===3&&(_?(T._stashedText=T.nodeValue,T.nodeValue=""):T.nodeValue=T._stashedText||""),D&&D.nodeType===8)if(T=D.data,T==="/$"){if(d===0)break;d--}else T!=="$"&&T!=="$?"&&T!=="$~"&&T!=="$!"||d++;T=D}while(T)}function rg(d){var _=d.firstChild;for(_&&_.nodeType===10&&(_=_.nextSibling);_;){var T=_;switch(_=_.nextSibling,T.nodeName){case"HTML":case"HEAD":case"BODY":rg(T),wu(T);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if(T.rel.toLowerCase()==="stylesheet")continue}d.removeChild(T)}}function M_(d,_,T,D){for(;d.nodeType===1;){var U=T;if(d.nodeName.toLowerCase()!==_.toLowerCase()){if(!D&&(d.nodeName!=="INPUT"||d.type!=="hidden"))break}else if(D){if(!d[Nr])switch(_){case"meta":if(!d.hasAttribute("itemprop"))break;return d;case"link":if(G=d.getAttribute("rel"),G==="stylesheet"&&d.hasAttribute("data-precedence"))break;if(G!==U.rel||d.getAttribute("href")!==(U.href==null||U.href===""?null:U.href)||d.getAttribute("crossorigin")!==(U.crossOrigin==null?null:U.crossOrigin)||d.getAttribute("title")!==(U.title==null?null:U.title))break;return d;case"style":if(d.hasAttribute("data-precedence"))break;return d;case"script":if(G=d.getAttribute("src"),(G!==(U.src==null?null:U.src)||d.getAttribute("type")!==(U.type==null?null:U.type)||d.getAttribute("crossorigin")!==(U.crossOrigin==null?null:U.crossOrigin))&&G&&d.hasAttribute("async")&&!d.hasAttribute("itemprop"))break;return d;default:return d}}else if(_==="input"&&d.type==="hidden"){var G=U.name==null?null:""+U.name;if(U.type==="hidden"&&d.getAttribute("name")===G)return d}else return d;if(d=ps(d.nextSibling),d===null)break}return null}function MM(d,_,T){if(_==="")return null;for(;d.nodeType!==3;)if((d.nodeType!==1||d.nodeName!=="INPUT"||d.type!=="hidden")&&!T||(d=ps(d.nextSibling),d===null))return null;return d}function $S(d,_){for(;d.nodeType!==8;)if((d.nodeType!==1||d.nodeName!=="INPUT"||d.type!=="hidden")&&!_||(d=ps(d.nextSibling),d===null))return null;return d}function mx(d){return d.data==="$?"||d.data==="$~"}function vf(d){return d.data==="$!"||d.data==="$?"&&d.ownerDocument.readyState!=="loading"}function ja(d,_){var T=d.ownerDocument;if(d.data==="$~")d._reactRetry=_;else if(d.data!=="$?"||T.readyState!=="loading")_();else{var D=function(){_(),T.removeEventListener("DOMContentLoaded",D)};T.addEventListener("DOMContentLoaded",D),d._reactRetry=D}}function ps(d){for(;d!=null;d=d.nextSibling){var _=d.nodeType;if(_===1||_===3)break;if(_===8){if(_=d.data,_==="$"||_==="$!"||_==="$?"||_==="$~"||_==="&"||_==="F!"||_==="F")break;if(_==="/$"||_==="/&")return null}}return d}var E_=null;function yx(d){d=d.nextSibling;for(var _=0;d;){if(d.nodeType===8){var T=d.data;if(T==="/$"||T==="/&"){if(_===0)return ps(d.nextSibling);_--}else T!=="$"&&T!=="$!"&&T!=="$?"&&T!=="$~"&&T!=="&"||_++}d=d.nextSibling}return null}function I_(d){d=d.previousSibling;for(var _=0;d;){if(d.nodeType===8){var T=d.data;if(T==="$"||T==="$!"||T==="$?"||T==="$~"||T==="&"){if(_===0)return d;_--}else T!=="/$"&&T!=="/&"||_++}d=d.previousSibling}return null}function WS(d,_,T){switch(_=T_(T),d){case"html":if(d=_.documentElement,!d)throw Error(i(452));return d;case"head":if(d=_.head,!d)throw Error(i(453));return d;case"body":if(d=_.body,!d)throw Error(i(454));return d;default:throw Error(i(451))}}function ig(d){for(var _=d.attributes;_.length;)d.removeAttributeNode(_[0]);wu(d)}var Qs=new Map,GS=new Set;function Jv(d){return typeof d.getRootNode=="function"?d.getRootNode():d.nodeType===9?d:d.ownerDocument}var uu=De.d;De.d={f:_x,r:XS,D:ZS,C:bx,L:R_,m:em,X:Sx,S:xx,M:Tx};function _x(){var d=uu.f(),_=h_();return d||_}function XS(d){var _=is(d);_!==null&&_.tag===5&&_.type==="form"?So(_):uu.r(d)}var tc=typeof document>"u"?null:document;function P_(d,_,T){var D=tc;if(D&&typeof _=="string"&&_){var U=da(_);U='link[rel="'+d+'"][href="'+U+'"]',typeof T=="string"&&(U+='[crossorigin="'+T+'"]'),GS.has(U)||(GS.add(U),d={rel:d,crossOrigin:T,href:_},D.querySelector(U)===null&&(_=D.createElement("link"),sa(_,"link",d),mn(_),D.head.appendChild(_)))}}function ZS(d){uu.D(d),P_("dns-prefetch",d,null)}function bx(d,_){uu.C(d,_),P_("preconnect",d,_)}function R_(d,_,T){uu.L(d,_,T);var D=tc;if(D&&d&&_){var U='link[rel="preload"][as="'+da(_)+'"]';_==="image"&&T&&T.imageSrcSet?(U+='[imagesrcset="'+da(T.imageSrcSet)+'"]',typeof T.imageSizes=="string"&&(U+='[imagesizes="'+da(T.imageSizes)+'"]')):U+='[href="'+da(d)+'"]';var G=U;switch(_){case"style":G=v(d);break;case"script":G=A(d)}Qs.has(G)||(d=p({rel:"preload",href:_==="image"&&T&&T.imageSrcSet?void 0:d,as:_},T),Qs.set(G,d),D.querySelector(U)!==null||_==="style"&&D.querySelector(h(G))||_==="script"&&D.querySelector(k(G))||(_=D.createElement("link"),sa(_,"link",d),mn(_),D.head.appendChild(_)))}}function em(d,_){uu.m(d,_);var T=tc;if(T&&d){var D=_&&typeof _.as=="string"?_.as:"script",U='link[rel="modulepreload"][as="'+da(D)+'"][href="'+da(d)+'"]',G=U;switch(D){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":G=A(d)}if(!Qs.has(G)&&(d=p({rel:"modulepreload",href:d},_),Qs.set(G,d),T.querySelector(U)===null)){switch(D){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(T.querySelector(k(G)))return}D=T.createElement("link"),sa(D,"link",d),mn(D),T.head.appendChild(D)}}}function xx(d,_,T){uu.S(d,_,T);var D=tc;if(D&&d){var U=yo(D).hoistableStyles,G=v(d);_=_||"default";var ne=U.get(G);if(!ne){var _e={loading:0,preload:null};if(ne=D.querySelector(h(G)))_e.loading=5;else{d=p({rel:"stylesheet",href:d,"data-precedence":_},T),(T=Qs.get(G))&&V(d,T);var Ue=ne=D.createElement("link");mn(Ue),sa(Ue,"link",d),Ue._p=new Promise(function(dt,At){Ue.onload=dt,Ue.onerror=At}),Ue.addEventListener("load",function(){_e.loading|=1}),Ue.addEventListener("error",function(){_e.loading|=2}),_e.loading|=4,z(ne,_,D)}ne={type:"stylesheet",instance:ne,count:1,state:_e},U.set(G,ne)}}}function Sx(d,_){uu.X(d,_);var T=tc;if(T&&d){var D=yo(T).hoistableScripts,U=A(d),G=D.get(U);G||(G=T.querySelector(k(U)),G||(d=p({src:d,async:!0},_),(_=Qs.get(U))&&X(d,_),G=T.createElement("script"),mn(G),sa(G,"link",d),T.head.appendChild(G)),G={type:"script",instance:G,count:1,state:null},D.set(U,G))}}function Tx(d,_){uu.M(d,_);var T=tc;if(T&&d){var D=yo(T).hoistableScripts,U=A(d),G=D.get(U);G||(G=T.querySelector(k(U)),G||(d=p({src:d,async:!0,type:"module"},_),(_=Qs.get(U))&&X(d,_),G=T.createElement("script"),mn(G),sa(G,"link",d),T.head.appendChild(G)),G={type:"script",instance:G,count:1,state:null},D.set(U,G))}}function qS(d,_,T,D){var U=(U=qt.current)?Jv(U):null;if(!U)throw Error(i(446));switch(d){case"meta":case"title":return null;case"style":return typeof T.precedence=="string"&&typeof T.href=="string"?(_=v(T.href),T=yo(U).hoistableStyles,D=T.get(_),D||(D={type:"style",instance:null,count:0,state:null},T.set(_,D)),D):{type:"void",instance:null,count:0,state:null};case"link":if(T.rel==="stylesheet"&&typeof T.href=="string"&&typeof T.precedence=="string"){d=v(T.href);var G=yo(U).hoistableStyles,ne=G.get(d);if(ne||(U=U.ownerDocument||U,ne={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},G.set(d,ne),(G=U.querySelector(h(d)))&&!G._p&&(ne.instance=G,ne.state.loading=5),Qs.has(d)||(T={rel:"preload",as:"style",href:T.href,crossOrigin:T.crossOrigin,integrity:T.integrity,media:T.media,hrefLang:T.hrefLang,referrerPolicy:T.referrerPolicy},Qs.set(d,T),G||x(U,d,T,ne.state))),_&&D===null)throw Error(i(528,""));return ne}if(_&&D!==null)throw Error(i(529,""));return null;case"script":return _=T.async,T=T.src,typeof T=="string"&&_&&typeof _!="function"&&typeof _!="symbol"?(_=A(T),T=yo(U).hoistableScripts,D=T.get(_),D||(D={type:"script",instance:null,count:0,state:null},T.set(_,D)),D):{type:"void",instance:null,count:0,state:null};default:throw Error(i(444,d))}}function v(d){return'href="'+da(d)+'"'}function h(d){return'link[rel="stylesheet"]['+d+"]"}function g(d){return p({},d,{"data-precedence":d.precedence,precedence:null})}function x(d,_,T,D){d.querySelector('link[rel="preload"][as="style"]['+_+"]")?D.loading=1:(_=d.createElement("link"),D.preload=_,_.addEventListener("load",function(){return D.loading|=1}),_.addEventListener("error",function(){return D.loading|=2}),sa(_,"link",T),mn(_),d.head.appendChild(_))}function A(d){return'[src="'+da(d)+'"]'}function k(d){return"script[async]"+d}function L(d,_,T){if(_.count++,_.instance===null)switch(_.type){case"style":var D=d.querySelector('style[data-href~="'+da(T.href)+'"]');if(D)return _.instance=D,mn(D),D;var U=p({},T,{"data-href":T.href,"data-precedence":T.precedence,href:null,precedence:null});return D=(d.ownerDocument||d).createElement("style"),mn(D),sa(D,"style",U),z(D,T.precedence,d),_.instance=D;case"stylesheet":U=v(T.href);var G=d.querySelector(h(U));if(G)return _.state.loading|=4,_.instance=G,mn(G),G;D=g(T),(U=Qs.get(U))&&V(D,U),G=(d.ownerDocument||d).createElement("link"),mn(G);var ne=G;return ne._p=new Promise(function(_e,Ue){ne.onload=_e,ne.onerror=Ue}),sa(G,"link",D),_.state.loading|=4,z(G,T.precedence,d),_.instance=G;case"script":return G=A(T.src),(U=d.querySelector(k(G)))?(_.instance=U,mn(U),U):(D=T,(U=Qs.get(G))&&(D=p({},T),X(D,U)),d=d.ownerDocument||d,U=d.createElement("script"),mn(U),sa(U,"link",D),d.head.appendChild(U),_.instance=U);case"void":return null;default:throw Error(i(443,_.type))}else _.type==="stylesheet"&&(_.state.loading&4)===0&&(D=_.instance,_.state.loading|=4,z(D,T.precedence,d));return _.instance}function z(d,_,T){for(var D=T.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),U=D.length?D[D.length-1]:null,G=U,ne=0;ne<D.length;ne++){var _e=D[ne];if(_e.dataset.precedence===_)G=_e;else if(G!==U)break}G?G.parentNode.insertBefore(d,G.nextSibling):(_=T.nodeType===9?T.head:T,_.insertBefore(d,_.firstChild))}function V(d,_){d.crossOrigin==null&&(d.crossOrigin=_.crossOrigin),d.referrerPolicy==null&&(d.referrerPolicy=_.referrerPolicy),d.title==null&&(d.title=_.title)}function X(d,_){d.crossOrigin==null&&(d.crossOrigin=_.crossOrigin),d.referrerPolicy==null&&(d.referrerPolicy=_.referrerPolicy),d.integrity==null&&(d.integrity=_.integrity)}var Z=null;function J(d,_,T){if(Z===null){var D=new Map,U=Z=new Map;U.set(T,D)}else U=Z,D=U.get(T),D||(D=new Map,U.set(T,D));if(D.has(d))return D;for(D.set(d,null),T=T.getElementsByTagName(d),U=0;U<T.length;U++){var G=T[U];if(!(G[Nr]||G[mi]||d==="link"&&G.getAttribute("rel")==="stylesheet")&&G.namespaceURI!=="http://www.w3.org/2000/svg"){var ne=G.getAttribute(_)||"";ne=d+ne;var _e=D.get(ne);_e?_e.push(G):D.set(ne,[G])}}return D}function oe(d,_,T){d=d.ownerDocument||d,d.head.insertBefore(T,_==="title"?d.querySelector("head > title"):null)}function le(d,_,T){if(T===1||_.itemProp!=null)return!1;switch(d){case"meta":case"title":return!0;case"style":if(typeof _.precedence!="string"||typeof _.href!="string"||_.href==="")break;return!0;case"link":if(typeof _.rel!="string"||typeof _.href!="string"||_.href===""||_.onLoad||_.onError)break;switch(_.rel){case"stylesheet":return d=_.disabled,typeof _.precedence=="string"&&d==null;default:return!0}case"script":if(_.async&&typeof _.async!="function"&&typeof _.async!="symbol"&&!_.onLoad&&!_.onError&&_.src&&typeof _.src=="string")return!0}return!1}function ce(d){return!(d.type==="stylesheet"&&(d.state.loading&3)===0)}function ge(d,_,T,D){if(T.type==="stylesheet"&&(typeof D.media!="string"||matchMedia(D.media).matches!==!1)&&(T.state.loading&4)===0){if(T.instance===null){var U=v(D.href),G=_.querySelector(h(U));if(G){_=G._p,_!==null&&typeof _=="object"&&typeof _.then=="function"&&(d.count++,d=qe.bind(d),_.then(d,d)),T.state.loading|=4,T.instance=G,mn(G);return}G=_.ownerDocument||_,D=g(D),(U=Qs.get(U))&&V(D,U),G=G.createElement("link"),mn(G);var ne=G;ne._p=new Promise(function(_e,Ue){ne.onload=_e,ne.onerror=Ue}),sa(G,"link",D),T.instance=G}d.stylesheets===null&&(d.stylesheets=new Map),d.stylesheets.set(T,_),(_=T.state.preload)&&(T.state.loading&3)===0&&(d.count++,T=qe.bind(d),_.addEventListener("load",T),_.addEventListener("error",T))}}var be=0;function Ee(d,_){return d.stylesheets&&d.count===0&&Ve(d,d.stylesheets),0<d.count||0<d.imgCount?function(T){var D=setTimeout(function(){if(d.stylesheets&&Ve(d,d.stylesheets),d.unsuspend){var G=d.unsuspend;d.unsuspend=null,G()}},6e4+_);0<d.imgBytes&&be===0&&(be=62500*FS());var U=setTimeout(function(){if(d.waitingForImages=!1,d.count===0&&(d.stylesheets&&Ve(d,d.stylesheets),d.unsuspend)){var G=d.unsuspend;d.unsuspend=null,G()}},(d.imgBytes>be?50:800)+_);return d.unsuspend=T,function(){d.unsuspend=null,clearTimeout(D),clearTimeout(U)}}:null}function qe(){if(this.count--,this.count===0&&(this.imgCount===0||!this.waitingForImages)){if(this.stylesheets)Ve(this,this.stylesheets);else if(this.unsuspend){var d=this.unsuspend;this.unsuspend=null,d()}}}var Oe=null;function Ve(d,_){d.stylesheets=null,d.unsuspend!==null&&(d.count++,Oe=new Map,_.forEach(ot,d),Oe=null,qe.call(d))}function ot(d,_){if(!(_.state.loading&4)){var T=Oe.get(d);if(T)var D=T.get(null);else{T=new Map,Oe.set(d,T);for(var U=d.querySelectorAll("link[data-precedence],style[data-precedence]"),G=0;G<U.length;G++){var ne=U[G];(ne.nodeName==="LINK"||ne.getAttribute("media")!=="not all")&&(T.set(ne.dataset.precedence,ne),D=ne)}D&&T.set(null,D)}U=_.instance,ne=U.getAttribute("data-precedence"),G=T.get(ne)||D,G===D&&T.set(null,U),T.set(ne,U),this.count++,D=qe.bind(this),U.addEventListener("load",D),U.addEventListener("error",D),G?G.parentNode.insertBefore(U,G.nextSibling):(d=d.nodeType===9?d.head:d,d.insertBefore(U,d.firstChild)),_.state.loading|=4}}var gt={$$typeof:B,Provider:null,Consumer:null,_currentValue:Fe,_currentValue2:Fe,_threadCount:0};function Et(d,_,T,D,U,G,ne,_e,Ue){this.tag=1,this.containerInfo=d,this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=zn(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=zn(0),this.hiddenUpdates=zn(null),this.identifierPrefix=D,this.onUncaughtError=U,this.onCaughtError=G,this.onRecoverableError=ne,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=Ue,this.incompleteTransitions=new Map}function Wt(d,_,T,D,U,G,ne,_e,Ue,dt,At,Pt){return d=new Et(d,_,T,ne,Ue,dt,At,Pt,_e),_=1,G===!0&&(_|=24),G=zo(3,null,null,_),d.current=G,G.stateNode=d,_=md(),_.refCount++,d.pooledCache=_,_.refCount++,G.memoizedState={element:D,isDehydrated:T,cache:_},Sl(G),d}function Ft(d){return d?(d=jr,d):jr}function Ht(d,_,T,D,U,G){U=Ft(U),D.context===null?D.context=U:D.pendingContext=U,D=Kl(_),D.payload={element:T},G=G===void 0?null:G,G!==null&&(D.callback=G),T=cs(d,D,_),T!==null&&(Co(T,d,_),Wu(T,d,_))}function ur(d,_){if(d=d.memoizedState,d!==null&&d.dehydrated!==null){var T=d.retryLane;d.retryLane=T!==0&&T<_?T:_}}function Ut(d,_){ur(d,_),(d=d.alternate)&&ur(d,_)}function jt(d){if(d.tag===13||d.tag===31){var _=ss(d,67108864);_!==null&&Co(_,d,67108864),Ut(d,67108864)}}function Tt(d){if(d.tag===13||d.tag===31){var _=ds();_=Ti(_);var T=ss(d,_);T!==null&&Co(T,d,_),Ut(d,_)}}var xr=!0;function Er(d,_,T,D){var U=me.T;me.T=null;var G=De.p;try{De.p=2,ar(d,_,T,D)}finally{De.p=G,me.T=U}}function vr(d,_,T,D){var U=me.T;me.T=null;var G=De.p;try{De.p=8,ar(d,_,T,D)}finally{De.p=G,me.T=U}}function ar(d,_,T,D){if(xr){var U=Yr(D);if(U===null)b_(d,_,D,on,T),gs(d,D);else if(Qo(U,d,_,T,D))D.stopPropagation();else if(gs(d,D),_&4&&-1<Mo.indexOf(d)){for(;U!==null;){var G=is(U);if(G!==null)switch(G.tag){case 3:if(G=G.stateNode,G.current.memoizedState.isDehydrated){var ne=Qe(G.pendingLanes);if(ne!==0){var _e=G;for(_e.pendingLanes|=2,_e.entangledLanes|=2;ne;){var Ue=1<<31-it(ne);_e.entanglements[1]|=Ue,ne&=~Ue}ou(G),(Ci&6)===0&&(Bd=ea()+500,Fd(0))}}break;case 31:case 13:_e=ss(G,2),_e!==null&&Co(_e,G,2),h_(),Ut(G,2)}if(G=Yr(D),G===null&&b_(d,_,D,on,T),G===U)break;U=G}U!==null&&D.stopPropagation()}else b_(d,_,D,null,T)}}function Yr(d){return d=Cu(d),Fn(d)}var on=null;function Fn(d){if(on=null,d=cl(d),d!==null){var _=a(d);if(_===null)d=null;else{var T=_.tag;if(T===13){if(d=s(_),d!==null)return d;d=null}else if(T===31){if(d=o(_),d!==null)return d;d=null}else if(T===3){if(_.stateNode.current.memoizedState.isDehydrated)return _.tag===3?_.stateNode.containerInfo:null;d=null}else _!==d&&(d=null)}}return on=d,null}function Ra(d){switch(d){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch(Zf()){case Do:return 2;case Ll:return 8;case Ya:case Ge:return 32;case he:return 268435456;default:return 32}default:return 32}}var Ko=!1,qn=null,xn=null,ki=null,Nn=new Map,Vn=new Map,wn=[],Mo="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function gs(d,_){switch(d){case"focusin":case"focusout":qn=null;break;case"dragenter":case"dragleave":xn=null;break;case"mouseover":case"mouseout":ki=null;break;case"pointerover":case"pointerout":Nn.delete(_.pointerId);break;case"gotpointercapture":case"lostpointercapture":Vn.delete(_.pointerId)}}function Bn(d,_,T,D,U,G){return d===null||d.nativeEvent!==G?(d={blockedOn:_,domEventName:T,eventSystemFlags:D,nativeEvent:G,targetContainers:[U]},_!==null&&(_=is(_),_!==null&&jt(_)),d):(d.eventSystemFlags|=D,_=d.targetContainers,U!==null&&_.indexOf(U)===-1&&_.push(U),d)}function Qo(d,_,T,D,U){switch(_){case"focusin":return qn=Bn(qn,d,_,T,D,U),!0;case"dragenter":return xn=Bn(xn,d,_,T,D,U),!0;case"mouseover":return ki=Bn(ki,d,_,T,D,U),!0;case"pointerover":var G=U.pointerId;return Nn.set(G,Bn(Nn.get(G)||null,d,_,T,D,U)),!0;case"gotpointercapture":return G=U.pointerId,Vn.set(G,Bn(Vn.get(G)||null,d,_,T,D,U)),!0}return!1}function Yn(d){var _=cl(d.target);if(_!==null){var T=a(_);if(T!==null){if(_=T.tag,_===13){if(_=s(T),_!==null){d.blockedOn=_,mo(d.priority,function(){Tt(T)});return}}else if(_===31){if(_=o(T),_!==null){d.blockedOn=_,mo(d.priority,function(){Tt(T)});return}}else if(_===3&&T.stateNode.current.memoizedState.isDehydrated){d.blockedOn=T.tag===3?T.stateNode.containerInfo:null;return}}}d.blockedOn=null}function Un(d){if(d.blockedOn!==null)return!1;for(var _=d.targetContainers;0<_.length;){var T=Yr(d.nativeEvent);if(T===null){T=d.nativeEvent;var D=new T.constructor(T.type,T);Dc=D,T.target.dispatchEvent(D),Dc=null}else return _=is(T),_!==null&&jt(_),d.blockedOn=T,!1;_.shift()}return!0}function la(d,_,T){Un(d)&&T.delete(_)}function Kn(){Ko=!1,qn!==null&&Un(qn)&&(qn=null),xn!==null&&Un(xn)&&(xn=null),ki!==null&&Un(ki)&&(ki=null),Nn.forEach(la),Vn.forEach(la)}function Hi(d,_){d.blockedOn===_&&(d.blockedOn=null,Ko||(Ko=!0,r.unstable_scheduleCallback(r.unstable_NormalPriority,Kn)))}var vs=null;function Ud(d){vs!==d&&(vs=d,r.unstable_scheduleCallback(r.unstable_NormalPriority,function(){vs===d&&(vs=null);for(var _=0;_<d.length;_+=3){var T=d[_],D=d[_+1],U=d[_+2];if(typeof D!="function"){if(Fn(D||T)===null)continue;break}var G=is(T);G!==null&&(d.splice(_,3),_-=3,hs(G,{pending:!0,data:U,method:T.method,action:D},D,U))}}))}function Eo(d){function _(Ue){return Hi(Ue,d)}qn!==null&&Hi(qn,d),xn!==null&&Hi(xn,d),ki!==null&&Hi(ki,d),Nn.forEach(_),Vn.forEach(_);for(var T=0;T<wn.length;T++){var D=wn[T];D.blockedOn===d&&(D.blockedOn=null)}for(;0<wn.length&&(T=wn[0],T.blockedOn===null);)Yn(T),T.blockedOn===null&&wn.shift();if(T=(d.ownerDocument||d).$$reactFormReplay,T!=null)for(D=0;D<T.length;D+=3){var U=T[D],G=T[D+1],ne=U[Lt]||null;if(typeof G=="function")ne||Ud(T);else if(ne){var _e=null;if(G&&G.hasAttribute("formAction")){if(U=G,ne=G[Lt]||null)_e=ne.formAction;else if(Fn(U)!==null)continue}else _e=ne.action;typeof _e=="function"?T[D+1]=_e:(T.splice(D,3),D-=3),Ud(T)}}}function YS(){function d(G){G.canIntercept&&G.info==="react-transition"&&G.intercept({handler:function(){return new Promise(function(ne){return U=ne})},focusReset:"manual",scroll:"manual"})}function _(){U!==null&&(U(),U=null),D||setTimeout(T,20)}function T(){if(!D&&!navigation.transition){var G=navigation.currentEntry;G&&G.url!=null&&navigation.navigate(G.url,{state:G.getState(),info:"react-transition",history:"replace"})}}if(typeof navigation=="object"){var D=!1,U=null;return navigation.addEventListener("navigate",d),navigation.addEventListener("navigatesuccess",_),navigation.addEventListener("navigateerror",_),setTimeout(T,100),function(){D=!0,navigation.removeEventListener("navigate",d),navigation.removeEventListener("navigatesuccess",_),navigation.removeEventListener("navigateerror",_),U!==null&&(U(),U=null)}}}function mf(d){this._internalRoot=d}rc.prototype.render=mf.prototype.render=function(d){var _=this._internalRoot;if(_===null)throw Error(i(409));var T=_.current,D=ds();Ht(T,D,d,_,null,null)},rc.prototype.unmount=mf.prototype.unmount=function(){var d=this._internalRoot;if(d!==null){this._internalRoot=null;var _=d.containerInfo;Ht(d.current,2,null,d,null,null),h_(),_[Br]=null}};function rc(d){this._internalRoot=d}rc.prototype.unstable_scheduleHydration=function(d){if(d){var _=Os();d={blockedOn:null,target:d,priority:_};for(var T=0;T<wn.length&&_!==0&&_<wn[T].priority;T++);wn.splice(T,0,d),T===0&&Yn(d)}};var Hd=e.version;if(Hd!=="19.2.0")throw Error(i(527,Hd,"19.2.0"));De.findDOMNode=function(d){var _=d._reactInternals;if(_===void 0)throw typeof d.render=="function"?Error(i(188)):(d=Object.keys(d).join(","),Error(i(268,d)));return d=c(_),d=d!==null?f(d):null,d=d===null?null:d.stateNode,d};var ng={bundleType:0,version:"19.2.0",rendererPackageName:"react-dom",currentDispatcherRef:me,reconcilerVersion:"19.2.0"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var fh=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!fh.isDisabled&&fh.supportsFiber)try{Ne=fh.inject(ng),Be=fh}catch{}}return Cx.createRoot=function(d,_){if(!n(d))throw Error(i(299));var T=!1,D="",U=Pb,G=cS,ne=Ky;return _!=null&&(_.unstable_strictMode===!0&&(T=!0),_.identifierPrefix!==void 0&&(D=_.identifierPrefix),_.onUncaughtError!==void 0&&(U=_.onUncaughtError),_.onCaughtError!==void 0&&(G=_.onCaughtError),_.onRecoverableError!==void 0&&(ne=_.onRecoverableError)),_=Wt(d,1,!1,null,null,T,D,null,U,G,ne,YS),d[Br]=_.current,__(d),new mf(_)},Cx.hydrateRoot=function(d,_,T){if(!n(d))throw Error(i(299));var D=!1,U="",G=Pb,ne=cS,_e=Ky,Ue=null;return T!=null&&(T.unstable_strictMode===!0&&(D=!0),T.identifierPrefix!==void 0&&(U=T.identifierPrefix),T.onUncaughtError!==void 0&&(G=T.onUncaughtError),T.onCaughtError!==void 0&&(ne=T.onCaughtError),T.onRecoverableError!==void 0&&(_e=T.onRecoverableError),T.formState!==void 0&&(Ue=T.formState)),_=Wt(d,1,!0,_,T??null,D,U,Ue,G,ne,_e,YS),_.context=Ft(null),T=_.current,D=ds(),D=Ti(D),U=Kl(D),U.callback=null,cs(T,U,D),T=D,_.current.lanes=T,Mn(_,T),ou(_),d[Br]=_.current,__(d),new rc(_)},Cx.version="19.2.0",Cx}var jO;function OZ(){if(jO)return PM.exports;jO=1;function r(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(r)}catch(e){console.error(e)}}return r(),PM.exports=LZ(),PM.exports}var NZ=OZ();const BZ=async(r,e)=>{try{const i=await(await fetch(`https://nominatim.openstreetmap.org/reverse?lat=${r}&lon=${e}&format=json&addressdetails=1&accept-language=es`)).json();return i&&i.display_name?i.display_name.split(", ").slice(0,3).join(", "):`${r.toFixed(4)}, ${e.toFixed(4)}`}catch(t){return console.error("Error obteniendo ubicación:",t),`${r.toFixed(4)}, ${e.toFixed(4)}`}};var m2={exports:{}};/**
 * MapLibre GL JS
 * @license 3-Clause BSD. Full text of license: https://github.com/maplibre/maplibre-gl-js/blob/v5.9.0/LICENSE.txt
 */var zZ=m2.exports,$O;function FZ(){return $O||($O=1,(function(r,e){(function(t,i){r.exports=i()})(zZ,(function(){var t={},i={};function n(s,o,l){if(i[s]=l,s==="index"){var c="var sharedModule = {}; ("+i.shared+")(sharedModule); ("+i.worker+")(sharedModule);",f={};return i.shared(f),i.index(t,f),typeof window<"u"&&t.setWorkerUrl(window.URL.createObjectURL(new Blob([c],{type:"text/javascript"}))),t}}n("shared",["exports"],(function(s){function o(v,h,g,x){return new(g||(g=Promise))((function(A,k){function L(X){try{V(x.next(X))}catch(Z){k(Z)}}function z(X){try{V(x.throw(X))}catch(Z){k(Z)}}function V(X){var Z;X.done?A(X.value):(Z=X.value,Z instanceof g?Z:new g((function(J){J(Z)}))).then(L,z)}V((x=x.apply(v,h||[])).next())}))}function l(v,h){this.x=v,this.y=h}function c(v){return v&&v.__esModule&&Object.prototype.hasOwnProperty.call(v,"default")?v.default:v}var f,p;typeof SuppressedError=="function"&&SuppressedError,l.prototype={clone(){return new l(this.x,this.y)},add(v){return this.clone()._add(v)},sub(v){return this.clone()._sub(v)},multByPoint(v){return this.clone()._multByPoint(v)},divByPoint(v){return this.clone()._divByPoint(v)},mult(v){return this.clone()._mult(v)},div(v){return this.clone()._div(v)},rotate(v){return this.clone()._rotate(v)},rotateAround(v,h){return this.clone()._rotateAround(v,h)},matMult(v){return this.clone()._matMult(v)},unit(){return this.clone()._unit()},perp(){return this.clone()._perp()},round(){return this.clone()._round()},mag(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals(v){return this.x===v.x&&this.y===v.y},dist(v){return Math.sqrt(this.distSqr(v))},distSqr(v){const h=v.x-this.x,g=v.y-this.y;return h*h+g*g},angle(){return Math.atan2(this.y,this.x)},angleTo(v){return Math.atan2(this.y-v.y,this.x-v.x)},angleWith(v){return this.angleWithSep(v.x,v.y)},angleWithSep(v,h){return Math.atan2(this.x*h-this.y*v,this.x*v+this.y*h)},_matMult(v){const h=v[2]*this.x+v[3]*this.y;return this.x=v[0]*this.x+v[1]*this.y,this.y=h,this},_add(v){return this.x+=v.x,this.y+=v.y,this},_sub(v){return this.x-=v.x,this.y-=v.y,this},_mult(v){return this.x*=v,this.y*=v,this},_div(v){return this.x/=v,this.y/=v,this},_multByPoint(v){return this.x*=v.x,this.y*=v.y,this},_divByPoint(v){return this.x/=v.x,this.y/=v.y,this},_unit(){return this._div(this.mag()),this},_perp(){const v=this.y;return this.y=this.x,this.x=-v,this},_rotate(v){const h=Math.cos(v),g=Math.sin(v),x=g*this.x+h*this.y;return this.x=h*this.x-g*this.y,this.y=x,this},_rotateAround(v,h){const g=Math.cos(v),x=Math.sin(v),A=h.y+x*(this.x-h.x)+g*(this.y-h.y);return this.x=h.x+g*(this.x-h.x)-x*(this.y-h.y),this.y=A,this},_round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},constructor:l},l.convert=function(v){if(v instanceof l)return v;if(Array.isArray(v))return new l(+v[0],+v[1]);if(v.x!==void 0&&v.y!==void 0)return new l(+v.x,+v.y);throw new Error("Expected [x, y] or {x, y} point format")};var y=(function(){if(p)return f;function v(h,g,x,A){this.cx=3*h,this.bx=3*(x-h)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*g,this.by=3*(A-g)-this.cy,this.ay=1-this.cy-this.by,this.p1x=h,this.p1y=g,this.p2x=x,this.p2y=A}return p=1,f=v,v.prototype={sampleCurveX:function(h){return((this.ax*h+this.bx)*h+this.cx)*h},sampleCurveY:function(h){return((this.ay*h+this.by)*h+this.cy)*h},sampleCurveDerivativeX:function(h){return(3*this.ax*h+2*this.bx)*h+this.cx},solveCurveX:function(h,g){if(g===void 0&&(g=1e-6),h<0)return 0;if(h>1)return 1;for(var x=h,A=0;A<8;A++){var k=this.sampleCurveX(x)-h;if(Math.abs(k)<g)return x;var L=this.sampleCurveDerivativeX(x);if(Math.abs(L)<1e-6)break;x-=k/L}var z=0,V=1;for(x=h,A=0;A<20&&(k=this.sampleCurveX(x),!(Math.abs(k-h)<g));A++)h>k?z=x:V=x,x=.5*(V-z)+z;return x},solve:function(h,g){return this.sampleCurveY(this.solveCurveX(h,g))}},f})(),b=c(y);let S,C;function E(){return S==null&&(S=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")&&typeof createImageBitmap=="function"),S}function P(){if(C==null&&(C=!1,E())){const h=new OffscreenCanvas(5,5).getContext("2d",{willReadFrequently:!0});if(h){for(let x=0;x<25;x++){const A=4*x;h.fillStyle=`rgb(${A},${A+1},${A+2})`,h.fillRect(x%5,Math.floor(x/5),1,1)}const g=h.getImageData(0,0,5,5).data;for(let x=0;x<100;x++)if(x%4!=3&&g[x]!==x){C=!0;break}}}return C||!1}var O=1e-6,B=typeof Float32Array<"u"?Float32Array:Array;function F(){var v=new B(9);return B!=Float32Array&&(v[1]=0,v[2]=0,v[3]=0,v[5]=0,v[6]=0,v[7]=0),v[0]=1,v[4]=1,v[8]=1,v}function W(v){return v[0]=1,v[1]=0,v[2]=0,v[3]=0,v[4]=0,v[5]=1,v[6]=0,v[7]=0,v[8]=0,v[9]=0,v[10]=1,v[11]=0,v[12]=0,v[13]=0,v[14]=0,v[15]=1,v}function $(){var v=new B(3);return B!=Float32Array&&(v[0]=0,v[1]=0,v[2]=0),v}function q(v){var h=v[0],g=v[1],x=v[2];return Math.sqrt(h*h+g*g+x*x)}function Q(v,h,g){var x=new B(3);return x[0]=v,x[1]=h,x[2]=g,x}function ee(v,h,g){return v[0]=h[0]+g[0],v[1]=h[1]+g[1],v[2]=h[2]+g[2],v}function te(v,h,g){return v[0]=h[0]*g,v[1]=h[1]*g,v[2]=h[2]*g,v}function ae(v,h,g){var x=h[0],A=h[1],k=h[2],L=g[0],z=g[1],V=g[2];return v[0]=A*V-k*z,v[1]=k*L-x*V,v[2]=x*z-A*L,v}var de,ve=q;function ye(v,h,g){var x=h[0],A=h[1],k=h[2],L=h[3];return v[0]=g[0]*x+g[4]*A+g[8]*k+g[12]*L,v[1]=g[1]*x+g[5]*A+g[9]*k+g[13]*L,v[2]=g[2]*x+g[6]*A+g[10]*k+g[14]*L,v[3]=g[3]*x+g[7]*A+g[11]*k+g[15]*L,v}function Ae(){var v=new B(4);return B!=Float32Array&&(v[0]=0,v[1]=0,v[2]=0),v[3]=1,v}function me(v,h,g,x){var A=arguments.length>4&&arguments[4]!==void 0?arguments[4]:"zyx",k=Math.PI/360;h*=k,x*=k,g*=k;var L=Math.sin(h),z=Math.cos(h),V=Math.sin(g),X=Math.cos(g),Z=Math.sin(x),J=Math.cos(x);switch(A){case"xyz":v[0]=L*X*J+z*V*Z,v[1]=z*V*J-L*X*Z,v[2]=z*X*Z+L*V*J,v[3]=z*X*J-L*V*Z;break;case"xzy":v[0]=L*X*J-z*V*Z,v[1]=z*V*J-L*X*Z,v[2]=z*X*Z+L*V*J,v[3]=z*X*J+L*V*Z;break;case"yxz":v[0]=L*X*J+z*V*Z,v[1]=z*V*J-L*X*Z,v[2]=z*X*Z-L*V*J,v[3]=z*X*J+L*V*Z;break;case"yzx":v[0]=L*X*J+z*V*Z,v[1]=z*V*J+L*X*Z,v[2]=z*X*Z-L*V*J,v[3]=z*X*J-L*V*Z;break;case"zxy":v[0]=L*X*J-z*V*Z,v[1]=z*V*J+L*X*Z,v[2]=z*X*Z+L*V*J,v[3]=z*X*J-L*V*Z;break;case"zyx":v[0]=L*X*J-z*V*Z,v[1]=z*V*J+L*X*Z,v[2]=z*X*Z-L*V*J,v[3]=z*X*J+L*V*Z;break;default:throw new Error("Unknown angle order "+A)}return v}function De(){var v=new B(2);return B!=Float32Array&&(v[0]=0,v[1]=0),v}function Fe(v,h){var g=new B(2);return g[0]=v,g[1]=h,g}$(),de=new B(4),B!=Float32Array&&(de[0]=0,de[1]=0,de[2]=0,de[3]=0),$(),Q(1,0,0),Q(0,1,0),Ae(),Ae(),F(),De();const je=8192;function ct(v,h,g){return h*(je/(v.tileSize*Math.pow(2,g-v.tileID.overscaledZ)))}function xe(v,h){return(v%h+h)%h}function $e(v,h,g){return v*(1-g)+h*g}function pt(v){if(v<=0)return 0;if(v>=1)return 1;const h=v*v,g=h*v;return 4*(v<.5?g:3*(v-h)+g-.75)}function _t(v,h,g,x){const A=new b(v,h,g,x);return k=>A.solve(k)}const Dt=_t(.25,.1,.25,1);function qt(v,h,g){return Math.min(g,Math.max(h,v))}function _r(v,h,g){const x=g-h,A=((v-h)%x+x)%x+h;return A===h?g:A}function Kt(v,...h){for(const g of h)for(const x in g)v[x]=g[x];return v}let zt=1;function yr(v,h,g){const x={};for(const A in v)x[A]=h.call(this,v[A],A,v);return x}function Gt(v,h,g){const x={};for(const A in v)h.call(this,v[A],A,v)&&(x[A]=v[A]);return x}function Jt(v){return Array.isArray(v)?v.map(Jt):typeof v=="object"&&v?yr(v,Jt):v}const Tr={};function dr(v){Tr[v]||(typeof console<"u"&&console.warn(v),Tr[v]=!0)}function $r(v,h,g){return(g.y-v.y)*(h.x-v.x)>(h.y-v.y)*(g.x-v.x)}function ii(v){return typeof WorkerGlobalScope<"u"&&v!==void 0&&v instanceof WorkerGlobalScope}let Zi=null;function In(v){if(Zi==null){const h=v.navigator?v.navigator.userAgent:null;Zi=!!v.safari||!(!h||!(/\b(iPad|iPhone|iPod)\b/.test(h)||h.match("Safari")&&!h.match("Chrome")))}return Zi}function Li(v){return typeof ImageBitmap<"u"&&v instanceof ImageBitmap}const Oa="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";function Na(v,h,g,x,A){return o(this,void 0,void 0,(function*(){if(typeof VideoFrame>"u")throw new Error("VideoFrame not supported");const k=new VideoFrame(v,{timestamp:0});try{const L=k?.format;if(!L||!L.startsWith("BGR")&&!L.startsWith("RGB"))throw new Error(`Unrecognized format ${L}`);const z=L.startsWith("BGR"),V=new Uint8ClampedArray(x*A*4);if(yield k.copyTo(V,(function(X,Z,J,oe,le){const ce=4*Math.max(-Z,0),ge=(Math.max(0,J)-J)*oe*4+ce,be=4*oe,Ee=Math.max(0,Z),qe=Math.max(0,J);return{rect:{x:Ee,y:qe,width:Math.min(X.width,Z+oe)-Ee,height:Math.min(X.height,J+le)-qe},layout:[{offset:ge,stride:be}]}})(v,h,g,x,A)),z)for(let X=0;X<V.length;X+=4){const Z=V[X];V[X]=V[X+2],V[X+2]=Z}return V}finally{k.close()}}))}let Ls,vo;function ea(v,h,g,x){return v.addEventListener(h,g,x),{unsubscribe:()=>{v.removeEventListener(h,g,x)}}}function Zf(v){return v*Math.PI/180}function Do(v){return v/Math.PI*180}const Ll={touchstart:!0,touchmove:!0,touchmoveWindow:!0,touchend:!0,touchcancel:!0},Ya={dblclick:!0,click:!0,mouseover:!0,mouseout:!0,mousedown:!0,mousemove:!0,mousemoveWindow:!0,mouseup:!0,mouseupWindow:!0,contextmenu:!0,wheel:!0},Ge="AbortError";function he(){return new Error(Ge)}const fe={MAX_PARALLEL_IMAGE_REQUESTS:16,MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:8,MAX_TILE_CACHE_ZOOM_LEVELS:5,REGISTERED_PROTOCOLS:{},WORKER_URL:""};function we(v){return fe.REGISTERED_PROTOCOLS[v.substring(0,v.indexOf("://"))]}const Ne="global-dispatcher";class Be extends Error{constructor(h,g,x,A){super(`AJAXError: ${g} (${h}): ${x}`),this.status=h,this.statusText=g,this.url=x,this.body=A}}const We=()=>ii(self)?self.worker&&self.worker.referrer:(window.location.protocol==="blob:"?window.parent:window).location.href,it=function(v,h){if(/:\/\//.test(v.url)&&!/^https?:|^file:/.test(v.url)){const x=we(v.url);if(x)return x(v,h);if(ii(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:v,targetMapId:Ne},h)}if(!(/^file:/.test(g=v.url)||/^file:/.test(We())&&!/^\w+:/.test(g))){if(fetch&&Request&&AbortController&&Object.prototype.hasOwnProperty.call(Request.prototype,"signal"))return(function(x,A){return o(this,void 0,void 0,(function*(){const k=new Request(x.url,{method:x.method||"GET",body:x.body,credentials:x.credentials,headers:x.headers,cache:x.cache,referrer:We(),signal:A.signal});let L,z;x.type!=="json"||k.headers.has("Accept")||k.headers.set("Accept","application/json");try{L=yield fetch(k)}catch(X){throw new Be(0,X.message,x.url,new Blob)}if(!L.ok){const X=yield L.blob();throw new Be(L.status,L.statusText,x.url,X)}z=x.type==="arrayBuffer"||x.type==="image"?L.arrayBuffer():x.type==="json"?L.json():L.text();const V=yield z;if(A.signal.aborted)throw he();return{data:V,cacheControl:L.headers.get("Cache-Control"),expires:L.headers.get("Expires")}}))})(v,h);if(ii(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:v,mustQueue:!0,targetMapId:Ne},h)}var g;return(function(x,A){return new Promise(((k,L)=>{var z;const V=new XMLHttpRequest;V.open(x.method||"GET",x.url,!0),x.type!=="arrayBuffer"&&x.type!=="image"||(V.responseType="arraybuffer");for(const X in x.headers)V.setRequestHeader(X,x.headers[X]);x.type==="json"&&(V.responseType="text",!((z=x.headers)===null||z===void 0)&&z.Accept||V.setRequestHeader("Accept","application/json")),V.withCredentials=x.credentials==="include",V.onerror=()=>{L(new Error(V.statusText))},V.onload=()=>{if(!A.signal.aborted)if((V.status>=200&&V.status<300||V.status===0)&&V.response!==null){let X=V.response;if(x.type==="json")try{X=JSON.parse(V.response)}catch(Z){return void L(Z)}k({data:X,cacheControl:V.getResponseHeader("Cache-Control"),expires:V.getResponseHeader("Expires")})}else{const X=new Blob([V.response],{type:V.getResponseHeader("Content-Type")});L(new Be(V.status,V.statusText,x.url,X))}},A.signal.addEventListener("abort",(()=>{V.abort(),L(he())})),V.send(x.body)}))})(v,h)};function Ke(v){if(!v||v.indexOf("://")<=0||v.indexOf("data:image/")===0||v.indexOf("blob:")===0)return!0;const h=new URL(v),g=window.location;return h.protocol===g.protocol&&h.host===g.host}function yt(v,h,g){g[v]&&g[v].indexOf(h)!==-1||(g[v]=g[v]||[],g[v].push(h))}function kt(v,h,g){if(g&&g[v]){const x=g[v].indexOf(h);x!==-1&&g[v].splice(x,1)}}class St{constructor(h,g={}){Kt(this,g),this.type=h}}class rr extends St{constructor(h,g={}){super("error",Kt({error:h},g))}}class pr{on(h,g){return this._listeners=this._listeners||{},yt(h,g,this._listeners),{unsubscribe:()=>{this.off(h,g)}}}off(h,g){return kt(h,g,this._listeners),kt(h,g,this._oneTimeListeners),this}once(h,g){return g?(this._oneTimeListeners=this._oneTimeListeners||{},yt(h,g,this._oneTimeListeners),this):new Promise((x=>this.once(h,x)))}fire(h,g){typeof h=="string"&&(h=new St(h,g||{}));const x=h.type;if(this.listens(x)){h.target=this;const A=this._listeners&&this._listeners[x]?this._listeners[x].slice():[];for(const z of A)z.call(this,h);const k=this._oneTimeListeners&&this._oneTimeListeners[x]?this._oneTimeListeners[x].slice():[];for(const z of k)kt(x,z,this._oneTimeListeners),z.call(this,h);const L=this._eventedParent;L&&(Kt(h,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),L.fire(h))}else h instanceof rr&&console.error(h.error);return this}listens(h){return this._listeners&&this._listeners[h]&&this._listeners[h].length>0||this._oneTimeListeners&&this._oneTimeListeners[h]&&this._oneTimeListeners[h].length>0||this._eventedParent&&this._eventedParent.listens(h)}setEventedParent(h,g){return this._eventedParent=h,this._eventedParentData=g,this}}var Qe={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},centerAltitude:{type:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},roll:{type:"number",default:0,units:"degrees"},state:{type:"state",default:{}},light:{type:"light"},sky:{type:"sky"},projection:{type:"projection"},terrain:{type:"terrain"},sources:{required:!0,type:"sources"},sprite:{type:"sprite"},glyphs:{type:"string"},"font-faces":{type:"array",value:"fontFaces"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{},custom:{}},default:"mapbox"},redFactor:{type:"number",default:1},blueFactor:{type:"number",default:1},greenFactor:{type:"number",default:1},baseShift:{type:"number",default:0},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{required:!0,type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},"color-relief":{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_color-relief","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image",{"!":"icon-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"padding",default:[2],units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},"viewport-glyph":{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-variable-anchor-offset":{type:"variableAnchorOffsetCollection",requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field",{"!":"text-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_color-relief":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},sky:{"sky-color":{type:"color","property-type":"data-constant",default:"#88C6FC",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-ground-blend":{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-fog-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"sky-horizon-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"atmosphere-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},terrain:{source:{type:"string",required:!0},exaggeration:{type:"number",minimum:0,default:1}},projection:{type:{type:"projectionDefinition",default:"mercator","property-type":"data-constant",transition:!1,expression:{interpolated:!0,parameters:["zoom"]}}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_color-relief","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"numberArray",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-altitude":{type:"numberArray",default:45,minimum:0,maximum:90,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"colorArray",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"colorArray",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-method":{type:"enum",values:{standard:{},basic:{},combined:{},igor:{},multidirectional:{}},default:"standard",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},"paint_color-relief":{"color-relief-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"color-relief-color":{type:"color",transition:!1,expression:{interpolated:!0,parameters:["elevation"]},"property-type":"color-ramp"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}};const Kr=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function pi(v,h){const g={};for(const x in v)x!=="ref"&&(g[x]=v[x]);return Kr.forEach((x=>{x in h&&(g[x]=h[x])})),g}function or(v,h){if(Array.isArray(v)){if(!Array.isArray(h)||v.length!==h.length)return!1;for(let g=0;g<v.length;g++)if(!or(v[g],h[g]))return!1;return!0}if(typeof v=="object"&&v!==null&&h!==null){if(typeof h!="object"||Object.keys(v).length!==Object.keys(h).length)return!1;for(const g in v)if(!or(v[g],h[g]))return!1;return!0}return v===h}function ui(v,h){v.push(h)}function zn(v,h,g){ui(g,{command:"addSource",args:[v,h[v]]})}function Mn(v,h,g){ui(h,{command:"removeSource",args:[v]}),g[v]=!0}function jn(v,h,g,x){Mn(v,g,x),zn(v,h,g)}function fa(v,h,g){let x;for(x in v[g])if(Object.prototype.hasOwnProperty.call(v[g],x)&&x!=="data"&&!or(v[g][x],h[g][x]))return!1;for(x in h[g])if(Object.prototype.hasOwnProperty.call(h[g],x)&&x!=="data"&&!or(v[g][x],h[g][x]))return!1;return!0}function Vi(v,h,g,x,A,k){v=v||{},h=h||{};for(const L in v)Object.prototype.hasOwnProperty.call(v,L)&&(or(v[L],h[L])||g.push({command:k,args:[x,L,h[L],A]}));for(const L in h)Object.prototype.hasOwnProperty.call(h,L)&&!Object.prototype.hasOwnProperty.call(v,L)&&(or(v[L],h[L])||g.push({command:k,args:[x,L,h[L],A]}))}function $n(v){return v.id}function Ti(v,h){return v[h.id]=h,v}class It{constructor(h,g,x,A){this.message=(h?`${h}: `:"")+x,A&&(this.identifier=A),g!=null&&g.__line__&&(this.line=g.__line__)}}function Os(v,...h){for(const g of h)for(const x in g)v[x]=g[x];return v}class mo extends Error{constructor(h,g){super(g),this.message=g,this.key=h}}class Wn{constructor(h,g=[]){this.parent=h,this.bindings={};for(const[x,A]of g)this.bindings[x]=A}concat(h){return new Wn(this,h)}get(h){if(this.bindings[h])return this.bindings[h];if(this.parent)return this.parent.get(h);throw new Error(`${h} not found in scope.`)}has(h){return!!this.bindings[h]||!!this.parent&&this.parent.has(h)}}const mi={kind:"null"},Lt={kind:"number"},Br={kind:"string"},Ur={kind:"boolean"},ko={kind:"color"},ul={kind:"projectionDefinition"},Ns={kind:"object"},Nr={kind:"value"},wu={kind:"collator"},cl={kind:"formatted"},is={kind:"padding"},Ol={kind:"colorArray"},yo={kind:"numberArray"},mn={kind:"resolvedImage"},Pn={kind:"variableAnchorOffsetCollection"};function _o(v,h){return{kind:"array",itemType:v,N:h}}function Ri(v){if(v.kind==="array"){const h=Ri(v.itemType);return typeof v.N=="number"?`array<${h}, ${v.N}>`:v.itemType.kind==="value"?"array":`array<${h}>`}return v.kind}const hl=[mi,Lt,Br,Ur,ko,ul,cl,Ns,_o(Nr),is,yo,Ol,mn,Pn];function Oh(v,h){if(h.kind==="error")return null;if(v.kind==="array"){if(h.kind==="array"&&(h.N===0&&h.itemType.kind==="value"||!Oh(v.itemType,h.itemType))&&(typeof v.N!="number"||v.N===h.N))return null}else{if(v.kind===h.kind)return null;if(v.kind==="value"){for(const g of hl)if(!Oh(g,h))return null}}return`Expected ${Ri(v)} but found ${Ri(h)} instead.`}function yp(v,h){return h.some((g=>g.kind===v.kind))}function Su(v,h){return h.some((g=>g==="null"?v===null:g==="array"?Array.isArray(v):g==="object"?v&&!Array.isArray(v)&&typeof v=="object":g===typeof v))}function Nl(v,h){return v.kind==="array"&&h.kind==="array"?v.itemType.kind===h.itemType.kind&&typeof v.N=="number":v.kind===h.kind}const qf=.96422,Nh=.82521,fl=4/29,Ca=6/29,Qg=3*Ca*Ca,Tb=Ca*Ca*Ca,Jg=Math.PI/180,Ny=180/Math.PI;function Yf(v){return(v%=360)<0&&(v+=360),v}function ev([v,h,g,x]){let A,k;const L=Kf((.2225045*(v=da(v))+.7168786*(h=da(h))+.0606169*(g=da(g)))/1);v===h&&h===g?A=k=L:(A=Kf((.4360747*v+.3850649*h+.1430804*g)/qf),k=Kf((.0139322*v+.0971045*h+.7141733*g)/Nh));const z=116*L-16;return[z<0?0:z,500*(A-L),200*(L-k),x]}function da(v){return v<=.04045?v/12.92:Math.pow((v+.055)/1.055,2.4)}function Kf(v){return v>Tb?Math.pow(v,1/3):v/Qg+fl}function tv([v,h,g,x]){let A=(v+16)/116,k=isNaN(h)?A:A+h/500,L=isNaN(g)?A:A-g/200;return A=1*Tu(A),k=qf*Tu(k),L=Nh*Tu(L),[Bl(3.1338561*k-1.6168667*A-.4906146*L),Bl(-.9787684*k+1.9161415*A+.033454*L),Bl(.0719453*k-.2289914*A+1.4052427*L),x]}function Bl(v){return(v=v<=.00304?12.92*v:1.055*Math.pow(v,1/2.4)-.055)<0?0:v>1?1:v}function Tu(v){return v>Ca?v*v*v:Qg*(v-fl)}const By=Object.hasOwn||function(v,h){return Object.prototype.hasOwnProperty.call(v,h)};function Bh(v,h){return By(v,h)?v[h]:void 0}function dl(v){return parseInt(v.padEnd(2,v),16)/255}function rv(v,h){return Ba(h?v/100:v,0,1)}function Ba(v,h,g){return Math.min(Math.max(h,v),g)}function ni(v){return!v.some(Number.isNaN)}const Au={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};function Ka(v,h,g){return v+g*(h-v)}function Rc(v,h,g){return v.map(((x,A)=>Ka(x,h[A],g)))}class Zr{constructor(h,g,x,A=1,k=!0){this.r=h,this.g=g,this.b=x,this.a=A,k||(this.r*=A,this.g*=A,this.b*=A,A||this.overwriteGetter("rgb",[h,g,x,A]))}static parse(h){if(h instanceof Zr)return h;if(typeof h!="string")return;const g=(function(x){if((x=x.toLowerCase().trim())==="transparent")return[0,0,0,0];const A=Bh(Au,x);if(A){const[L,z,V]=A;return[L/255,z/255,V/255,1]}if(x.startsWith("#")&&/^#(?:[0-9a-f]{3,4}|[0-9a-f]{6}|[0-9a-f]{8})$/.test(x)){const L=x.length<6?1:2;let z=1;return[dl(x.slice(z,z+=L)),dl(x.slice(z,z+=L)),dl(x.slice(z,z+=L)),dl(x.slice(z,z+L)||"ff")]}if(x.startsWith("rgb")){const L=x.match(/^rgba?\(\s*([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(L){const[z,V,X,Z,J,oe,le,ce,ge,be,Ee,qe]=L,Oe=[Z||" ",le||" ",be].join("");if(Oe==="  "||Oe==="  /"||Oe===",,"||Oe===",,,"){const Ve=[X,oe,ge].join(""),ot=Ve==="%%%"?100:Ve===""?255:0;if(ot){const gt=[Ba(+V/ot,0,1),Ba(+J/ot,0,1),Ba(+ce/ot,0,1),Ee?rv(+Ee,qe):1];if(ni(gt))return gt}}return}}const k=x.match(/^hsla?\(\s*([\de.+-]+)(?:deg)?(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(k){const[L,z,V,X,Z,J,oe,le,ce]=k,ge=[V||" ",Z||" ",oe].join("");if(ge==="  "||ge==="  /"||ge===",,"||ge===",,,"){const be=[+z,Ba(+X,0,100),Ba(+J,0,100),le?rv(+le,ce):1];if(ni(be))return(function([Ee,qe,Oe,Ve]){function ot(gt){const Et=(gt+Ee/30)%12,Wt=qe*Math.min(Oe,1-Oe);return Oe-Wt*Math.max(-1,Math.min(Et-3,9-Et,1))}return Ee=Yf(Ee),qe/=100,Oe/=100,[ot(0),ot(8),ot(4),Ve]})(be)}}})(h);return g?new Zr(...g,!1):void 0}get rgb(){const{r:h,g,b:x,a:A}=this,k=A||1/0;return this.overwriteGetter("rgb",[h/k,g/k,x/k,A])}get hcl(){return this.overwriteGetter("hcl",(function(h){const[g,x,A,k]=ev(h),L=Math.sqrt(x*x+A*A);return[Math.round(1e4*L)?Yf(Math.atan2(A,x)*Ny):NaN,L,g,k]})(this.rgb))}get lab(){return this.overwriteGetter("lab",ev(this.rgb))}overwriteGetter(h,g){return Object.defineProperty(this,h,{value:g}),g}toString(){const[h,g,x,A]=this.rgb;return`rgba(${[h,g,x].map((k=>Math.round(255*k))).join(",")},${A})`}static interpolate(h,g,x,A="rgb"){switch(A){case"rgb":{const[k,L,z,V]=Rc(h.rgb,g.rgb,x);return new Zr(k,L,z,V,!1)}case"hcl":{const[k,L,z,V]=h.hcl,[X,Z,J,oe]=g.hcl;let le,ce;if(isNaN(k)||isNaN(X))isNaN(k)?isNaN(X)?le=NaN:(le=X,z!==1&&z!==0||(ce=Z)):(le=k,J!==1&&J!==0||(ce=L));else{let Oe=X-k;X>k&&Oe>180?Oe-=360:X<k&&k-X>180&&(Oe+=360),le=k+x*Oe}const[ge,be,Ee,qe]=(function([Oe,Ve,ot,gt]){return Oe=isNaN(Oe)?0:Oe*Jg,tv([ot,Math.cos(Oe)*Ve,Math.sin(Oe)*Ve,gt])})([le,ce??Ka(L,Z,x),Ka(z,J,x),Ka(V,oe,x)]);return new Zr(ge,be,Ee,qe,!1)}case"lab":{const[k,L,z,V]=tv(Rc(h.lab,g.lab,x));return new Zr(k,L,z,V,!1)}}}}Zr.black=new Zr(0,0,0,1),Zr.white=new Zr(1,1,1,1),Zr.transparent=new Zr(0,0,0,0),Zr.red=new Zr(1,0,0,1);class Lo{constructor(h,g,x){this.sensitivity=h?g?"variant":"case":g?"accent":"base",this.locale=x,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(h,g){return this.collator.compare(h,g)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}const Dc=["bottom","center","top"];class Cu{constructor(h,g,x,A,k,L){this.text=h,this.image=g,this.scale=x,this.fontStack=A,this.textColor=k,this.verticalAlign=L}}class ta{constructor(h){this.sections=h}static fromString(h){return new ta([new Cu(h,null,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some((h=>h.text.length!==0||h.image&&h.image.name.length!==0))}static factory(h){return h instanceof ta?h:ta.fromString(h)}toString(){return this.sections.length===0?"":this.sections.map((h=>h.text)).join("")}}class Rn{constructor(h){this.values=h.slice()}static parse(h){if(h instanceof Rn)return h;if(typeof h=="number")return new Rn([h,h,h,h]);if(Array.isArray(h)&&!(h.length<1||h.length>4)){for(const g of h)if(typeof g!="number")return;switch(h.length){case 1:h=[h[0],h[0],h[0],h[0]];break;case 2:h=[h[0],h[1],h[0],h[1]];break;case 3:h=[h[0],h[1],h[2],h[1]]}return new Rn(h)}}toString(){return JSON.stringify(this.values)}static interpolate(h,g,x){return new Rn(Rc(h.values,g.values,x))}}class ra{constructor(h){this.values=h.slice()}static parse(h){if(h instanceof ra)return h;if(typeof h=="number")return new ra([h]);if(Array.isArray(h)){for(const g of h)if(typeof g!="number")return;return new ra(h)}}toString(){return JSON.stringify(this.values)}static interpolate(h,g,x){return new ra(Rc(h.values,g.values,x))}}class ia{constructor(h){this.values=h.slice()}static parse(h){if(h instanceof ia)return h;if(typeof h=="string"){const x=Zr.parse(h);return x?new ia([x]):void 0}if(!Array.isArray(h))return;const g=[];for(const x of h){if(typeof x!="string")return;const A=Zr.parse(x);if(!A)return;g.push(A)}return new ia(g)}toString(){return JSON.stringify(this.values)}static interpolate(h,g,x,A="rgb"){const k=[];if(h.values.length!=g.values.length)throw new Error(`colorArray: Arrays have mismatched length (${h.values.length} vs. ${g.values.length}), cannot interpolate.`);for(let L=0;L<h.values.length;L++)k.push(Zr.interpolate(h.values[L],g.values[L],x,A));return new ia(k)}}class qi extends Error{constructor(h){super(h),this.name="RuntimeError"}toJSON(){return this.message}}const pl=new Set(["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"]);class En{constructor(h){this.values=h.slice()}static parse(h){if(h instanceof En)return h;if(Array.isArray(h)&&!(h.length<1)&&h.length%2==0){for(let g=0;g<h.length;g+=2){const x=h[g],A=h[g+1];if(typeof x!="string"||!pl.has(x)||!Array.isArray(A)||A.length!==2||typeof A[0]!="number"||typeof A[1]!="number")return}return new En(h)}}toString(){return JSON.stringify(this.values)}static interpolate(h,g,x){const A=h.values,k=g.values;if(A.length!==k.length)throw new qi(`Cannot interpolate values of different length. from: ${h.toString()}, to: ${g.toString()}`);const L=[];for(let z=0;z<A.length;z+=2){if(A[z]!==k[z])throw new qi(`Cannot interpolate values containing mismatched anchors. from[${z}]: ${A[z]}, to[${z}]: ${k[z]}`);L.push(A[z]);const[V,X]=A[z+1],[Z,J]=k[z+1];L.push([Ka(V,Z,x),Ka(X,J,x)])}return new En(L)}}class Qa{constructor(h){this.name=h.name,this.available=h.available}toString(){return this.name}static fromString(h){return h?new Qa({name:h,available:!1}):null}}class pa{constructor(h,g,x){this.from=h,this.to=g,this.transition=x}static interpolate(h,g,x){return new pa(h,g,x)}static parse(h){return h instanceof pa?h:Array.isArray(h)&&h.length===3&&typeof h[0]=="string"&&typeof h[1]=="string"&&typeof h[2]=="number"?new pa(h[0],h[1],h[2]):typeof h=="object"&&typeof h.from=="string"&&typeof h.to=="string"&&typeof h.transition=="number"?new pa(h.from,h.to,h.transition):typeof h=="string"?new pa(h,h,1):void 0}}function ns(v,h,g,x){return typeof v=="number"&&v>=0&&v<=255&&typeof h=="number"&&h>=0&&h<=255&&typeof g=="number"&&g>=0&&g<=255?x===void 0||typeof x=="number"&&x>=0&&x<=1?null:`Invalid rgba value [${[v,h,g,x].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof x=="number"?[v,h,g,x]:[v,h,g]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function Di(v){if(v===null||typeof v=="string"||typeof v=="boolean"||typeof v=="number"||v instanceof pa||v instanceof Zr||v instanceof Lo||v instanceof ta||v instanceof Rn||v instanceof ra||v instanceof ia||v instanceof En||v instanceof Qa)return!0;if(Array.isArray(v)){for(const h of v)if(!Di(h))return!1;return!0}if(typeof v=="object"){for(const h in v)if(!Di(v[h]))return!1;return!0}return!1}function nn(v){if(v===null)return mi;if(typeof v=="string")return Br;if(typeof v=="boolean")return Ur;if(typeof v=="number")return Lt;if(v instanceof Zr)return ko;if(v instanceof pa)return ul;if(v instanceof Lo)return wu;if(v instanceof ta)return cl;if(v instanceof Rn)return is;if(v instanceof ra)return yo;if(v instanceof ia)return Ol;if(v instanceof En)return Pn;if(v instanceof Qa)return mn;if(Array.isArray(v)){const h=v.length;let g;for(const x of v){const A=nn(x);if(g){if(g===A)continue;g=Nr;break}g=A}return _o(g||Nr,h)}return Ns}function Qr(v){const h=typeof v;return v===null?"":h==="string"||h==="number"||h==="boolean"?String(v):v instanceof Zr||v instanceof pa||v instanceof ta||v instanceof Rn||v instanceof ra||v instanceof ia||v instanceof En||v instanceof Qa?v.toString():JSON.stringify(v)}class Mr{constructor(h,g){this.type=h,this.value=g}static parse(h,g){if(h.length!==2)return g.error(`'literal' expression requires exactly one argument, but found ${h.length-1} instead.`);if(!Di(h[1]))return g.error("invalid value");const x=h[1];let A=nn(x);const k=g.expectedType;return A.kind!=="array"||A.N!==0||!k||k.kind!=="array"||typeof k.N=="number"&&k.N!==0||(A=k),new Mr(A,x)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}}const zl={string:Br,number:Lt,boolean:Ur,object:Ns};class Hr{constructor(h,g){this.type=h,this.args=g}static parse(h,g){if(h.length<2)return g.error("Expected at least one argument.");let x,A=1;const k=h[0];if(k==="array"){let z,V;if(h.length>2){const X=h[1];if(typeof X!="string"||!(X in zl)||X==="object")return g.error('The item type argument of "array" must be one of string, number, boolean',1);z=zl[X],A++}else z=Nr;if(h.length>3){if(h[2]!==null&&(typeof h[2]!="number"||h[2]<0||h[2]!==Math.floor(h[2])))return g.error('The length argument to "array" must be a positive integer literal',2);V=h[2],A++}x=_o(z,V)}else{if(!zl[k])throw new Error(`Types doesn't contain name = ${k}`);x=zl[k]}const L=[];for(;A<h.length;A++){const z=g.parse(h[A],A,Nr);if(!z)return null;L.push(z)}return new Hr(x,L)}evaluate(h){for(let g=0;g<this.args.length;g++){const x=this.args[g].evaluate(h);if(!Oh(this.type,nn(x)))return x;if(g===this.args.length-1)throw new qi(`Expected value to be of type ${Ri(this.type)}, but found ${Ri(nn(x))} instead.`)}throw new Error}eachChild(h){this.args.forEach(h)}outputDefined(){return this.args.every((h=>h.outputDefined()))}}const Ma={"to-boolean":Ur,"to-color":ko,"to-number":Lt,"to-string":Br};class Dn{constructor(h,g){this.type=h,this.args=g}static parse(h,g){if(h.length<2)return g.error("Expected at least one argument.");const x=h[0];if(!Ma[x])throw new Error(`Can't parse ${x} as it is not part of the known types`);if((x==="to-boolean"||x==="to-string")&&h.length!==2)return g.error("Expected one argument.");const A=Ma[x],k=[];for(let L=1;L<h.length;L++){const z=g.parse(h[L],L,Nr);if(!z)return null;k.push(z)}return new Dn(A,k)}evaluate(h){switch(this.type.kind){case"boolean":return!!this.args[0].evaluate(h);case"color":{let g,x;for(const A of this.args){if(g=A.evaluate(h),x=null,g instanceof Zr)return g;if(typeof g=="string"){const k=h.parseColor(g);if(k)return k}else if(Array.isArray(g)&&(x=g.length<3||g.length>4?`Invalid rgba value ${JSON.stringify(g)}: expected an array containing either three or four numeric values.`:ns(g[0],g[1],g[2],g[3]),!x))return new Zr(g[0]/255,g[1]/255,g[2]/255,g[3])}throw new qi(x||`Could not parse color from value '${typeof g=="string"?g:JSON.stringify(g)}'`)}case"padding":{let g;for(const x of this.args){g=x.evaluate(h);const A=Rn.parse(g);if(A)return A}throw new qi(`Could not parse padding from value '${typeof g=="string"?g:JSON.stringify(g)}'`)}case"numberArray":{let g;for(const x of this.args){g=x.evaluate(h);const A=ra.parse(g);if(A)return A}throw new qi(`Could not parse numberArray from value '${typeof g=="string"?g:JSON.stringify(g)}'`)}case"colorArray":{let g;for(const x of this.args){g=x.evaluate(h);const A=ia.parse(g);if(A)return A}throw new qi(`Could not parse colorArray from value '${typeof g=="string"?g:JSON.stringify(g)}'`)}case"variableAnchorOffsetCollection":{let g;for(const x of this.args){g=x.evaluate(h);const A=En.parse(g);if(A)return A}throw new qi(`Could not parse variableAnchorOffsetCollection from value '${typeof g=="string"?g:JSON.stringify(g)}'`)}case"number":{let g=null;for(const x of this.args){if(g=x.evaluate(h),g===null)return 0;const A=Number(g);if(!isNaN(A))return A}throw new qi(`Could not convert ${JSON.stringify(g)} to number.`)}case"formatted":return ta.fromString(Qr(this.args[0].evaluate(h)));case"resolvedImage":return Qa.fromString(Qr(this.args[0].evaluate(h)));case"projectionDefinition":return this.args[0].evaluate(h);default:return Qr(this.args[0].evaluate(h))}}eachChild(h){this.args.forEach(h)}outputDefined(){return this.args.every((h=>h.outputDefined()))}}const zh=["Unknown","Point","LineString","Polygon"];class Fl{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache=new Map,this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?zh[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(h){let g=this._parseColorCache.get(h);return g||(g=Zr.parse(h),this._parseColorCache.set(h,g)),g}}class Qf{constructor(h,g,x=[],A,k=new Wn,L=[]){this.registry=h,this.path=x,this.key=x.map((z=>`[${z}]`)).join(""),this.scope=k,this.errors=L,this.expectedType=A,this._isConstant=g}parse(h,g,x,A,k={}){return g?this.concat(g,x,A)._parse(h,k):this._parse(h,k)}_parse(h,g){function x(A,k,L){return L==="assert"?new Hr(k,[A]):L==="coerce"?new Dn(k,[A]):A}if(h!==null&&typeof h!="string"&&typeof h!="boolean"&&typeof h!="number"||(h=["literal",h]),Array.isArray(h)){if(h.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const A=h[0];if(typeof A!="string")return this.error(`Expression name must be a string, but found ${typeof A} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const k=this.registry[A];if(k){let L=k.parse(h,this);if(!L)return null;if(this.expectedType){const z=this.expectedType,V=L.type;if(z.kind!=="string"&&z.kind!=="number"&&z.kind!=="boolean"&&z.kind!=="object"&&z.kind!=="array"||V.kind!=="value"){if(z.kind==="projectionDefinition"&&["string","array"].includes(V.kind)||["color","formatted","resolvedImage"].includes(z.kind)&&["value","string"].includes(V.kind)||["padding","numberArray"].includes(z.kind)&&["value","number","array"].includes(V.kind)||z.kind==="colorArray"&&["value","string","array"].includes(V.kind)||z.kind==="variableAnchorOffsetCollection"&&["value","array"].includes(V.kind))L=x(L,z,g.typeAnnotation||"coerce");else if(this.checkSubtype(z,V))return null}else L=x(L,z,g.typeAnnotation||"assert")}if(!(L instanceof Mr)&&L.type.kind!=="resolvedImage"&&this._isConstant(L)){const z=new Fl;try{L=new Mr(L.type,L.evaluate(z))}catch(V){return this.error(V.message),null}}return L}return this.error(`Unknown expression "${A}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(h===void 0?"'undefined' value invalid. Use null instead.":typeof h=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof h} instead.`)}concat(h,g,x){const A=typeof h=="number"?this.path.concat(h):this.path,k=x?this.scope.concat(x):this.scope;return new Qf(this.registry,this._isConstant,A,g||null,k,this.errors)}error(h,...g){const x=`${this.key}${g.map((A=>`[${A}]`)).join("")}`;this.errors.push(new mo(x,h))}checkSubtype(h,g){const x=Oh(h,g);return x&&this.error(x),x}}class Mu{constructor(h,g){this.type=g.type,this.bindings=[].concat(h),this.result=g}evaluate(h){return this.result.evaluate(h)}eachChild(h){for(const g of this.bindings)h(g[1]);h(this.result)}static parse(h,g){if(h.length<4)return g.error(`Expected at least 3 arguments, but found ${h.length-1} instead.`);const x=[];for(let k=1;k<h.length-1;k+=2){const L=h[k];if(typeof L!="string")return g.error(`Expected string, but found ${typeof L} instead.`,k);if(/[^a-zA-Z0-9_]/.test(L))return g.error("Variable names must contain only alphanumeric characters or '_'.",k);const z=g.parse(h[k+1],k+1);if(!z)return null;x.push([L,z])}const A=g.parse(h[h.length-1],h.length-1,g.expectedType,x);return A?new Mu(x,A):null}outputDefined(){return this.result.outputDefined()}}class kc{constructor(h,g){this.type=g.type,this.name=h,this.boundExpression=g}static parse(h,g){if(h.length!==2||typeof h[1]!="string")return g.error("'var' expression requires exactly one string literal argument.");const x=h[1];return g.scope.has(x)?new kc(x,g.scope.get(x)):g.error(`Unknown variable "${x}". Make sure "${x}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(h){return this.boundExpression.evaluate(h)}eachChild(){}outputDefined(){return!1}}class Lc{constructor(h,g,x){this.type=h,this.index=g,this.input=x}static parse(h,g){if(h.length!==3)return g.error(`Expected 2 arguments, but found ${h.length-1} instead.`);const x=g.parse(h[1],1,Lt),A=g.parse(h[2],2,_o(g.expectedType||Nr));return x&&A?new Lc(A.type.itemType,x,A):null}evaluate(h){const g=this.index.evaluate(h),x=this.input.evaluate(h);if(g<0)throw new qi(`Array index out of bounds: ${g} < 0.`);if(g>=x.length)throw new qi(`Array index out of bounds: ${g} > ${x.length-1}.`);if(g!==Math.floor(g))throw new qi(`Array index must be an integer, but found ${g} instead.`);return x[g]}eachChild(h){h(this.index),h(this.input)}outputDefined(){return!1}}class Oc{constructor(h,g){this.type=Ur,this.needle=h,this.haystack=g}static parse(h,g){if(h.length!==3)return g.error(`Expected 2 arguments, but found ${h.length-1} instead.`);const x=g.parse(h[1],1,Nr),A=g.parse(h[2],2,Nr);return x&&A?yp(x.type,[Ur,Br,Lt,mi,Nr])?new Oc(x,A):g.error(`Expected first argument to be of type boolean, string, number or null, but found ${Ri(x.type)} instead`):null}evaluate(h){const g=this.needle.evaluate(h),x=this.haystack.evaluate(h);if(!x)return!1;if(!Su(g,["boolean","string","number","null"]))throw new qi(`Expected first argument to be of type boolean, string, number or null, but found ${Ri(nn(g))} instead.`);if(!Su(x,["string","array"]))throw new qi(`Expected second argument to be of type array or string, but found ${Ri(nn(x))} instead.`);return x.indexOf(g)>=0}eachChild(h){h(this.needle),h(this.haystack)}outputDefined(){return!0}}class Fh{constructor(h,g,x){this.type=Lt,this.needle=h,this.haystack=g,this.fromIndex=x}static parse(h,g){if(h.length<=2||h.length>=5)return g.error(`Expected 2 or 3 arguments, but found ${h.length-1} instead.`);const x=g.parse(h[1],1,Nr),A=g.parse(h[2],2,Nr);if(!x||!A)return null;if(!yp(x.type,[Ur,Br,Lt,mi,Nr]))return g.error(`Expected first argument to be of type boolean, string, number or null, but found ${Ri(x.type)} instead`);if(h.length===4){const k=g.parse(h[3],3,Lt);return k?new Fh(x,A,k):null}return new Fh(x,A)}evaluate(h){const g=this.needle.evaluate(h),x=this.haystack.evaluate(h);if(!Su(g,["boolean","string","number","null"]))throw new qi(`Expected first argument to be of type boolean, string, number or null, but found ${Ri(nn(g))} instead.`);let A;if(this.fromIndex&&(A=this.fromIndex.evaluate(h)),Su(x,["string"])){const k=x.indexOf(g,A);return k===-1?-1:[...x.slice(0,k)].length}if(Su(x,["array"]))return x.indexOf(g,A);throw new qi(`Expected second argument to be of type array or string, but found ${Ri(nn(x))} instead.`)}eachChild(h){h(this.needle),h(this.haystack),this.fromIndex&&h(this.fromIndex)}outputDefined(){return!1}}class gl{constructor(h,g,x,A,k,L){this.inputType=h,this.type=g,this.input=x,this.cases=A,this.outputs=k,this.otherwise=L}static parse(h,g){if(h.length<5)return g.error(`Expected at least 4 arguments, but found only ${h.length-1}.`);if(h.length%2!=1)return g.error("Expected an even number of arguments.");let x,A;g.expectedType&&g.expectedType.kind!=="value"&&(A=g.expectedType);const k={},L=[];for(let X=2;X<h.length-1;X+=2){let Z=h[X];const J=h[X+1];Array.isArray(Z)||(Z=[Z]);const oe=g.concat(X);if(Z.length===0)return oe.error("Expected at least one branch label.");for(const ce of Z){if(typeof ce!="number"&&typeof ce!="string")return oe.error("Branch labels must be numbers or strings.");if(typeof ce=="number"&&Math.abs(ce)>Number.MAX_SAFE_INTEGER)return oe.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof ce=="number"&&Math.floor(ce)!==ce)return oe.error("Numeric branch labels must be integer values.");if(x){if(oe.checkSubtype(x,nn(ce)))return null}else x=nn(ce);if(k[String(ce)]!==void 0)return oe.error("Branch labels must be unique.");k[String(ce)]=L.length}const le=g.parse(J,X,A);if(!le)return null;A=A||le.type,L.push(le)}const z=g.parse(h[1],1,Nr);if(!z)return null;const V=g.parse(h[h.length-1],h.length-1,A);return V?z.type.kind!=="value"&&g.concat(1).checkSubtype(x,z.type)?null:new gl(x,A,z,k,L,V):null}evaluate(h){const g=this.input.evaluate(h);return(nn(g)===this.inputType&&this.outputs[this.cases[g]]||this.otherwise).evaluate(h)}eachChild(h){h(this.input),this.outputs.forEach(h),h(this.otherwise)}outputDefined(){return this.outputs.every((h=>h.outputDefined()))&&this.otherwise.outputDefined()}}class ga{constructor(h,g,x){this.type=h,this.branches=g,this.otherwise=x}static parse(h,g){if(h.length<4)return g.error(`Expected at least 3 arguments, but found only ${h.length-1}.`);if(h.length%2!=0)return g.error("Expected an odd number of arguments.");let x;g.expectedType&&g.expectedType.kind!=="value"&&(x=g.expectedType);const A=[];for(let L=1;L<h.length-1;L+=2){const z=g.parse(h[L],L,Ur);if(!z)return null;const V=g.parse(h[L+1],L+1,x);if(!V)return null;A.push([z,V]),x=x||V.type}const k=g.parse(h[h.length-1],h.length-1,x);if(!k)return null;if(!x)throw new Error("Can't infer output type");return new ga(x,A,k)}evaluate(h){for(const[g,x]of this.branches)if(g.evaluate(h))return x.evaluate(h);return this.otherwise.evaluate(h)}eachChild(h){for(const[g,x]of this.branches)h(g),h(x);h(this.otherwise)}outputDefined(){return this.branches.every((([h,g])=>g.outputDefined()))&&this.otherwise.outputDefined()}}class Nc{constructor(h,g,x,A){this.type=h,this.input=g,this.beginIndex=x,this.endIndex=A}static parse(h,g){if(h.length<=2||h.length>=5)return g.error(`Expected 2 or 3 arguments, but found ${h.length-1} instead.`);const x=g.parse(h[1],1,Nr),A=g.parse(h[2],2,Lt);if(!x||!A)return null;if(!yp(x.type,[_o(Nr),Br,Nr]))return g.error(`Expected first argument to be of type array or string, but found ${Ri(x.type)} instead`);if(h.length===4){const k=g.parse(h[3],3,Lt);return k?new Nc(x.type,x,A,k):null}return new Nc(x.type,x,A)}evaluate(h){const g=this.input.evaluate(h),x=this.beginIndex.evaluate(h);let A;if(this.endIndex&&(A=this.endIndex.evaluate(h)),Su(g,["string"]))return[...g].slice(x,A).join("");if(Su(g,["array"]))return g.slice(x,A);throw new qi(`Expected first argument to be of type array or string, but found ${Ri(nn(g))} instead.`)}eachChild(h){h(this.input),h(this.beginIndex),this.endIndex&&h(this.endIndex)}outputDefined(){return!1}}function Bc(v,h){const g=v.length-1;let x,A,k=0,L=g,z=0;for(;k<=L;)if(z=Math.floor((k+L)/2),x=v[z],A=v[z+1],x<=h){if(z===g||h<A)return z;k=z+1}else{if(!(x>h))throw new qi("Input is not a number.");L=z-1}return 0}class Eu{constructor(h,g,x){this.type=h,this.input=g,this.labels=[],this.outputs=[];for(const[A,k]of x)this.labels.push(A),this.outputs.push(k)}static parse(h,g){if(h.length-1<4)return g.error(`Expected at least 4 arguments, but found only ${h.length-1}.`);if((h.length-1)%2!=0)return g.error("Expected an even number of arguments.");const x=g.parse(h[1],1,Lt);if(!x)return null;const A=[];let k=null;g.expectedType&&g.expectedType.kind!=="value"&&(k=g.expectedType);for(let L=1;L<h.length;L+=2){const z=L===1?-1/0:h[L],V=h[L+1],X=L,Z=L+1;if(typeof z!="number")return g.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',X);if(A.length&&A[A.length-1][0]>=z)return g.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',X);const J=g.parse(V,Z,k);if(!J)return null;k=k||J.type,A.push([z,J])}return new Eu(k,x,A)}evaluate(h){const g=this.labels,x=this.outputs;if(g.length===1)return x[0].evaluate(h);const A=this.input.evaluate(h);if(A<=g[0])return x[0].evaluate(h);const k=g.length;return A>=g[k-1]?x[k-1].evaluate(h):x[Bc(g,A)].evaluate(h)}eachChild(h){h(this.input);for(const g of this.outputs)h(g)}outputDefined(){return this.outputs.every((h=>h.outputDefined()))}}function va(v){return v&&v.__esModule&&Object.prototype.hasOwnProperty.call(v,"default")?v.default:v}var _p,bp,zy=(function(){if(bp)return _p;function v(h,g,x,A){this.cx=3*h,this.bx=3*(x-h)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*g,this.by=3*(A-g)-this.cy,this.ay=1-this.cy-this.by,this.p1x=h,this.p1y=g,this.p2x=x,this.p2y=A}return bp=1,_p=v,v.prototype={sampleCurveX:function(h){return((this.ax*h+this.bx)*h+this.cx)*h},sampleCurveY:function(h){return((this.ay*h+this.by)*h+this.cy)*h},sampleCurveDerivativeX:function(h){return(3*this.ax*h+2*this.bx)*h+this.cx},solveCurveX:function(h,g){if(g===void 0&&(g=1e-6),h<0)return 0;if(h>1)return 1;for(var x=h,A=0;A<8;A++){var k=this.sampleCurveX(x)-h;if(Math.abs(k)<g)return x;var L=this.sampleCurveDerivativeX(x);if(Math.abs(L)<1e-6)break;x-=k/L}var z=0,V=1;for(x=h,A=0;A<20&&(k=this.sampleCurveX(x),!(Math.abs(k-h)<g));A++)h>k?z=x:V=x,x=.5*(V-z)+z;return x},solve:function(h,g){return this.sampleCurveY(this.solveCurveX(h,g))}},_p})(),Fy=va(zy);class na{constructor(h,g,x,A,k){this.type=h,this.operator=g,this.interpolation=x,this.input=A,this.labels=[],this.outputs=[];for(const[L,z]of k)this.labels.push(L),this.outputs.push(z)}static interpolationFactor(h,g,x,A){let k=0;if(h.name==="exponential")k=Vh(g,h.base,x,A);else if(h.name==="linear")k=Vh(g,1,x,A);else if(h.name==="cubic-bezier"){const L=h.controlPoints;k=new Fy(L[0],L[1],L[2],L[3]).solve(Vh(g,1,x,A))}return k}static parse(h,g){let[x,A,k,...L]=h;if(!Array.isArray(A)||A.length===0)return g.error("Expected an interpolation type expression.",1);if(A[0]==="linear")A={name:"linear"};else if(A[0]==="exponential"){const X=A[1];if(typeof X!="number")return g.error("Exponential interpolation requires a numeric base.",1,1);A={name:"exponential",base:X}}else{if(A[0]!=="cubic-bezier")return g.error(`Unknown interpolation type ${String(A[0])}`,1,0);{const X=A.slice(1);if(X.length!==4||X.some((Z=>typeof Z!="number"||Z<0||Z>1)))return g.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);A={name:"cubic-bezier",controlPoints:X}}}if(h.length-1<4)return g.error(`Expected at least 4 arguments, but found only ${h.length-1}.`);if((h.length-1)%2!=0)return g.error("Expected an even number of arguments.");if(k=g.parse(k,2,Lt),!k)return null;const z=[];let V=null;x!=="interpolate-hcl"&&x!=="interpolate-lab"||g.expectedType==Ol?g.expectedType&&g.expectedType.kind!=="value"&&(V=g.expectedType):V=ko;for(let X=0;X<L.length;X+=2){const Z=L[X],J=L[X+1],oe=X+3,le=X+4;if(typeof Z!="number")return g.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',oe);if(z.length&&z[z.length-1][0]>=Z)return g.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',oe);const ce=g.parse(J,le,V);if(!ce)return null;V=V||ce.type,z.push([Z,ce])}return Nl(V,Lt)||Nl(V,ul)||Nl(V,ko)||Nl(V,is)||Nl(V,yo)||Nl(V,Ol)||Nl(V,Pn)||Nl(V,_o(Lt))?new na(V,x,A,k,z):g.error(`Type ${Ri(V)} is not interpolatable.`)}evaluate(h){const g=this.labels,x=this.outputs;if(g.length===1)return x[0].evaluate(h);const A=this.input.evaluate(h);if(A<=g[0])return x[0].evaluate(h);const k=g.length;if(A>=g[k-1])return x[k-1].evaluate(h);const L=Bc(g,A),z=na.interpolationFactor(this.interpolation,A,g[L],g[L+1]),V=x[L].evaluate(h),X=x[L+1].evaluate(h);switch(this.operator){case"interpolate":switch(this.type.kind){case"number":return Ka(V,X,z);case"color":return Zr.interpolate(V,X,z);case"padding":return Rn.interpolate(V,X,z);case"colorArray":return ia.interpolate(V,X,z);case"numberArray":return ra.interpolate(V,X,z);case"variableAnchorOffsetCollection":return En.interpolate(V,X,z);case"array":return Rc(V,X,z);case"projectionDefinition":return pa.interpolate(V,X,z)}case"interpolate-hcl":switch(this.type.kind){case"color":return Zr.interpolate(V,X,z,"hcl");case"colorArray":return ia.interpolate(V,X,z,"hcl")}case"interpolate-lab":switch(this.type.kind){case"color":return Zr.interpolate(V,X,z,"lab");case"colorArray":return ia.interpolate(V,X,z,"lab")}}}eachChild(h){h(this.input);for(const g of this.outputs)h(g)}outputDefined(){return this.outputs.every((h=>h.outputDefined()))}}function Vh(v,h,g,x){const A=x-g,k=v-g;return A===0?0:h===1?k/A:(Math.pow(h,k)-1)/(Math.pow(h,A)-1)}const as={color:Zr.interpolate,number:Ka,padding:Rn.interpolate,numberArray:ra.interpolate,colorArray:ia.interpolate,variableAnchorOffsetCollection:En.interpolate,array:Rc};class xp{constructor(h,g){this.type=h,this.args=g}static parse(h,g){if(h.length<2)return g.error("Expected at least one argument.");let x=null;const A=g.expectedType;A&&A.kind!=="value"&&(x=A);const k=[];for(const z of h.slice(1)){const V=g.parse(z,1+k.length,x,void 0,{typeAnnotation:"omit"});if(!V)return null;x=x||V.type,k.push(V)}if(!x)throw new Error("No output type");const L=A&&k.some((z=>Oh(A,z.type)));return new xp(L?Nr:x,k)}evaluate(h){let g,x=null,A=0;for(const k of this.args)if(A++,x=k.evaluate(h),x&&x instanceof Qa&&!x.available&&(g||(g=x.name),x=null,A===this.args.length&&(x=g)),x!==null)break;return x}eachChild(h){this.args.forEach(h)}outputDefined(){return this.args.every((h=>h.outputDefined()))}}function Jf(v,h){return v==="=="||v==="!="?h.kind==="boolean"||h.kind==="string"||h.kind==="number"||h.kind==="null"||h.kind==="value":h.kind==="string"||h.kind==="number"||h.kind==="value"}function ed(v,h,g,x){return x.compare(h,g)===0}function Vl(v,h,g){const x=v!=="=="&&v!=="!=";return class f8{constructor(k,L,z){this.type=Ur,this.lhs=k,this.rhs=L,this.collator=z,this.hasUntypedArgument=k.type.kind==="value"||L.type.kind==="value"}static parse(k,L){if(k.length!==3&&k.length!==4)return L.error("Expected two or three arguments.");const z=k[0];let V=L.parse(k[1],1,Nr);if(!V)return null;if(!Jf(z,V.type))return L.concat(1).error(`"${z}" comparisons are not supported for type '${Ri(V.type)}'.`);let X=L.parse(k[2],2,Nr);if(!X)return null;if(!Jf(z,X.type))return L.concat(2).error(`"${z}" comparisons are not supported for type '${Ri(X.type)}'.`);if(V.type.kind!==X.type.kind&&V.type.kind!=="value"&&X.type.kind!=="value")return L.error(`Cannot compare types '${Ri(V.type)}' and '${Ri(X.type)}'.`);x&&(V.type.kind==="value"&&X.type.kind!=="value"?V=new Hr(X.type,[V]):V.type.kind!=="value"&&X.type.kind==="value"&&(X=new Hr(V.type,[X])));let Z=null;if(k.length===4){if(V.type.kind!=="string"&&X.type.kind!=="string"&&V.type.kind!=="value"&&X.type.kind!=="value")return L.error("Cannot use collator to compare non-string types.");if(Z=L.parse(k[3],3,wu),!Z)return null}return new f8(V,X,Z)}evaluate(k){const L=this.lhs.evaluate(k),z=this.rhs.evaluate(k);if(x&&this.hasUntypedArgument){const V=nn(L),X=nn(z);if(V.kind!==X.kind||V.kind!=="string"&&V.kind!=="number")throw new qi(`Expected arguments for "${v}" to be (string, string) or (number, number), but found (${V.kind}, ${X.kind}) instead.`)}if(this.collator&&!x&&this.hasUntypedArgument){const V=nn(L),X=nn(z);if(V.kind!=="string"||X.kind!=="string")return h(k,L,z)}return this.collator?g(k,L,z,this.collator.evaluate(k)):h(k,L,z)}eachChild(k){k(this.lhs),k(this.rhs),this.collator&&k(this.collator)}outputDefined(){return!0}}}const Bs=Vl("==",(function(v,h,g){return h===g}),ed),iv=Vl("!=",(function(v,h,g){return h!==g}),(function(v,h,g,x){return!ed(0,h,g,x)})),wp=Vl("<",(function(v,h,g){return h<g}),(function(v,h,g,x){return x.compare(h,g)<0})),Ab=Vl(">",(function(v,h,g){return h>g}),(function(v,h,g,x){return x.compare(h,g)>0})),nv=Vl("<=",(function(v,h,g){return h<=g}),(function(v,h,g,x){return x.compare(h,g)<=0})),Cb=Vl(">=",(function(v,h,g){return h>=g}),(function(v,h,g,x){return x.compare(h,g)>=0}));class Sp{constructor(h,g,x){this.type=wu,this.locale=x,this.caseSensitive=h,this.diacriticSensitive=g}static parse(h,g){if(h.length!==2)return g.error("Expected one argument.");const x=h[1];if(typeof x!="object"||Array.isArray(x))return g.error("Collator options argument must be an object.");const A=g.parse(x["case-sensitive"]!==void 0&&x["case-sensitive"],1,Ur);if(!A)return null;const k=g.parse(x["diacritic-sensitive"]!==void 0&&x["diacritic-sensitive"],1,Ur);if(!k)return null;let L=null;return x.locale&&(L=g.parse(x.locale,1,Br),!L)?null:new Sp(A,k,L)}evaluate(h){return new Lo(this.caseSensitive.evaluate(h),this.diacriticSensitive.evaluate(h),this.locale?this.locale.evaluate(h):null)}eachChild(h){h(this.caseSensitive),h(this.diacriticSensitive),this.locale&&h(this.locale)}outputDefined(){return!1}}class av{constructor(h,g,x,A,k){this.type=Br,this.number=h,this.locale=g,this.currency=x,this.minFractionDigits=A,this.maxFractionDigits=k}static parse(h,g){if(h.length!==3)return g.error("Expected two arguments.");const x=g.parse(h[1],1,Lt);if(!x)return null;const A=h[2];if(typeof A!="object"||Array.isArray(A))return g.error("NumberFormat options argument must be an object.");let k=null;if(A.locale&&(k=g.parse(A.locale,1,Br),!k))return null;let L=null;if(A.currency&&(L=g.parse(A.currency,1,Br),!L))return null;let z=null;if(A["min-fraction-digits"]&&(z=g.parse(A["min-fraction-digits"],1,Lt),!z))return null;let V=null;return A["max-fraction-digits"]&&(V=g.parse(A["max-fraction-digits"],1,Lt),!V)?null:new av(x,k,L,z,V)}evaluate(h){return new Intl.NumberFormat(this.locale?this.locale.evaluate(h):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(h):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(h):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(h):void 0}).format(this.number.evaluate(h))}eachChild(h){h(this.number),this.locale&&h(this.locale),this.currency&&h(this.currency),this.minFractionDigits&&h(this.minFractionDigits),this.maxFractionDigits&&h(this.maxFractionDigits)}outputDefined(){return!1}}class Tp{constructor(h){this.type=cl,this.sections=h}static parse(h,g){if(h.length<2)return g.error("Expected at least one argument.");const x=h[1];if(!Array.isArray(x)&&typeof x=="object")return g.error("First argument must be an image or text section.");const A=[];let k=!1;for(let L=1;L<=h.length-1;++L){const z=h[L];if(k&&typeof z=="object"&&!Array.isArray(z)){k=!1;let V=null;if(z["font-scale"]&&(V=g.parse(z["font-scale"],1,Lt),!V))return null;let X=null;if(z["text-font"]&&(X=g.parse(z["text-font"],1,_o(Br)),!X))return null;let Z=null;if(z["text-color"]&&(Z=g.parse(z["text-color"],1,ko),!Z))return null;let J=null;if(z["vertical-align"]){if(typeof z["vertical-align"]=="string"&&!Dc.includes(z["vertical-align"]))return g.error(`'vertical-align' must be one of: 'bottom', 'center', 'top' but found '${z["vertical-align"]}' instead.`);if(J=g.parse(z["vertical-align"],1,Br),!J)return null}const oe=A[A.length-1];oe.scale=V,oe.font=X,oe.textColor=Z,oe.verticalAlign=J}else{const V=g.parse(h[L],1,Nr);if(!V)return null;const X=V.type.kind;if(X!=="string"&&X!=="value"&&X!=="null"&&X!=="resolvedImage")return g.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");k=!0,A.push({content:V,scale:null,font:null,textColor:null,verticalAlign:null})}}return new Tp(A)}evaluate(h){return new ta(this.sections.map((g=>{const x=g.content.evaluate(h);return nn(x)===mn?new Cu("",x,null,null,null,g.verticalAlign?g.verticalAlign.evaluate(h):null):new Cu(Qr(x),null,g.scale?g.scale.evaluate(h):null,g.font?g.font.evaluate(h).join(","):null,g.textColor?g.textColor.evaluate(h):null,g.verticalAlign?g.verticalAlign.evaluate(h):null)})))}eachChild(h){for(const g of this.sections)h(g.content),g.scale&&h(g.scale),g.font&&h(g.font),g.textColor&&h(g.textColor),g.verticalAlign&&h(g.verticalAlign)}outputDefined(){return!1}}class Uh{constructor(h){this.type=mn,this.input=h}static parse(h,g){if(h.length!==2)return g.error("Expected two arguments.");const x=g.parse(h[1],1,Br);return x?new Uh(x):g.error("No image name provided.")}evaluate(h){const g=this.input.evaluate(h),x=Qa.fromString(g);return x&&h.availableImages&&(x.available=h.availableImages.indexOf(g)>-1),x}eachChild(h){h(this.input)}outputDefined(){return!1}}class ov{constructor(h){this.type=Lt,this.input=h}static parse(h,g){if(h.length!==2)return g.error(`Expected 1 argument, but found ${h.length-1} instead.`);const x=g.parse(h[1],1);return x?x.type.kind!=="array"&&x.type.kind!=="string"&&x.type.kind!=="value"?g.error(`Expected argument of type string or array, but found ${Ri(x.type)} instead.`):new ov(x):null}evaluate(h){const g=this.input.evaluate(h);if(typeof g=="string")return[...g].length;if(Array.isArray(g))return g.length;throw new qi(`Expected value to be of type string or array, but found ${Ri(nn(g))} instead.`)}eachChild(h){h(this.input)}outputDefined(){return!1}}const Oo=8192;function Hh(v,h){const g=(180+v[0])/360,x=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+v[1]*Math.PI/360)))/360,A=Math.pow(2,h.z);return[Math.round(g*A*Oo),Math.round(x*A*Oo)]}function sv(v,h){const g=Math.pow(2,h.z);return[(A=(v[0]/Oo+h.x)/g,360*A-180),(x=(v[1]/Oo+h.y)/g,360/Math.PI*Math.atan(Math.exp((180-360*x)*Math.PI/180))-90)];var x,A}function zc(v,h){v[0]=Math.min(v[0],h[0]),v[1]=Math.min(v[1],h[1]),v[2]=Math.max(v[2],h[0]),v[3]=Math.max(v[3],h[1])}function jh(v,h){return!(v[0]<=h[0]||v[2]>=h[2]||v[1]<=h[1]||v[3]>=h[3])}function Vy(v,h,g){const x=v[0]-h[0],A=v[1]-h[1],k=v[0]-g[0],L=v[1]-g[1];return x*L-k*A==0&&x*k<=0&&A*L<=0}function td(v,h,g,x){return(A=[x[0]-g[0],x[1]-g[1]])[0]*(k=[h[0]-v[0],h[1]-v[1]])[1]-A[1]*k[0]!=0&&!(!uv(v,h,g,x)||!uv(g,x,v,h));var A,k}function Uy(v,h,g){for(const x of g)for(let A=0;A<x.length-1;++A)if(td(v,h,x[A],x[A+1]))return!0;return!1}function zs(v,h,g=!1){let x=!1;for(const z of h)for(let V=0;V<z.length-1;V++){if(Vy(v,z[V],z[V+1]))return g;(k=z[V])[1]>(A=v)[1]!=(L=z[V+1])[1]>A[1]&&A[0]<(L[0]-k[0])*(A[1]-k[1])/(L[1]-k[1])+k[0]&&(x=!x)}var A,k,L;return x}function Hy(v,h){for(const g of h)if(zs(v,g))return!0;return!1}function lv(v,h){for(const g of v)if(!zs(g,h))return!1;for(let g=0;g<v.length-1;++g)if(Uy(v[g],v[g+1],h))return!1;return!0}function jy(v,h){for(const g of h)if(lv(v,g))return!0;return!1}function uv(v,h,g,x){const A=x[0]-g[0],k=x[1]-g[1],L=(v[0]-g[0])*k-A*(v[1]-g[1]),z=(h[0]-g[0])*k-A*(h[1]-g[1]);return L>0&&z<0||L<0&&z>0}function Ap(v,h,g){const x=[];for(let A=0;A<v.length;A++){const k=[];for(let L=0;L<v[A].length;L++){const z=Hh(v[A][L],g);zc(h,z),k.push(z)}x.push(k)}return x}function $h(v,h,g){const x=[];for(let A=0;A<v.length;A++){const k=Ap(v[A],h,g);x.push(k)}return x}function Wh(v,h,g,x){if(v[0]<g[0]||v[0]>g[2]){const A=.5*x;let k=v[0]-g[0]>A?-x:g[0]-v[0]>A?x:0;k===0&&(k=v[0]-g[2]>A?-x:g[2]-v[0]>A?x:0),v[0]+=k}zc(h,v)}function rd(v,h,g,x){const A=Math.pow(2,x.z)*Oo,k=[x.x*Oo,x.y*Oo],L=[];for(const z of v)for(const V of z){const X=[V.x+k[0],V.y+k[1]];Wh(X,h,g,A),L.push(X)}return L}function id(v,h,g,x){const A=Math.pow(2,x.z)*Oo,k=[x.x*Oo,x.y*Oo],L=[];for(const V of v){const X=[];for(const Z of V){const J=[Z.x+k[0],Z.y+k[1]];zc(h,J),X.push(J)}L.push(X)}if(h[2]-h[0]<=A/2){(z=h)[0]=z[1]=1/0,z[2]=z[3]=-1/0;for(const V of L)for(const X of V)Wh(X,h,g,A)}var z;return L}class Iu{constructor(h,g){this.type=Ur,this.geojson=h,this.geometries=g}static parse(h,g){if(h.length!==2)return g.error(`'within' expression requires exactly one argument, but found ${h.length-1} instead.`);if(Di(h[1])){const x=h[1];if(x.type==="FeatureCollection"){const A=[];for(const k of x.features){const{type:L,coordinates:z}=k.geometry;L==="Polygon"&&A.push(z),L==="MultiPolygon"&&A.push(...z)}if(A.length)return new Iu(x,{type:"MultiPolygon",coordinates:A})}else if(x.type==="Feature"){const A=x.geometry.type;if(A==="Polygon"||A==="MultiPolygon")return new Iu(x,x.geometry)}else if(x.type==="Polygon"||x.type==="MultiPolygon")return new Iu(x,x)}return g.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(h){if(h.geometry()!=null&&h.canonicalID()!=null){if(h.geometryType()==="Point")return(function(g,x){const A=[1/0,1/0,-1/0,-1/0],k=[1/0,1/0,-1/0,-1/0],L=g.canonicalID();if(x.type==="Polygon"){const z=Ap(x.coordinates,k,L),V=rd(g.geometry(),A,k,L);if(!jh(A,k))return!1;for(const X of V)if(!zs(X,z))return!1}if(x.type==="MultiPolygon"){const z=$h(x.coordinates,k,L),V=rd(g.geometry(),A,k,L);if(!jh(A,k))return!1;for(const X of V)if(!Hy(X,z))return!1}return!0})(h,this.geometries);if(h.geometryType()==="LineString")return(function(g,x){const A=[1/0,1/0,-1/0,-1/0],k=[1/0,1/0,-1/0,-1/0],L=g.canonicalID();if(x.type==="Polygon"){const z=Ap(x.coordinates,k,L),V=id(g.geometry(),A,k,L);if(!jh(A,k))return!1;for(const X of V)if(!lv(X,z))return!1}if(x.type==="MultiPolygon"){const z=$h(x.coordinates,k,L),V=id(g.geometry(),A,k,L);if(!jh(A,k))return!1;for(const X of V)if(!jy(X,z))return!1}return!0})(h,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}}let cv=class{constructor(v=[],h=(g,x)=>g<x?-1:g>x?1:0){if(this.data=v,this.length=this.data.length,this.compare=h,this.length>0)for(let g=(this.length>>1)-1;g>=0;g--)this._down(g)}push(v){this.data.push(v),this._up(this.length++)}pop(){if(this.length===0)return;const v=this.data[0],h=this.data.pop();return--this.length>0&&(this.data[0]=h,this._down(0)),v}peek(){return this.data[0]}_up(v){const{data:h,compare:g}=this,x=h[v];for(;v>0;){const A=v-1>>1,k=h[A];if(g(x,k)>=0)break;h[v]=k,v=A}h[v]=x}_down(v){const{data:h,compare:g}=this,x=this.length>>1,A=h[v];for(;v<x;){let k=1+(v<<1);const L=k+1;if(L<this.length&&g(h[L],h[k])<0&&(k=L),g(h[k],A)>=0)break;h[v]=h[k],v=k}h[v]=A}};function Cp(v,h,g=0,x=v.length-1,A=hv){for(;x>g;){if(x-g>600){const V=x-g+1,X=h-g+1,Z=Math.log(V),J=.5*Math.exp(2*Z/3),oe=.5*Math.sqrt(Z*J*(V-J)/V)*(X-V/2<0?-1:1);Cp(v,h,Math.max(g,Math.floor(h-X*J/V+oe)),Math.min(x,Math.floor(h+(V-X)*J/V+oe)),A)}const k=v[h];let L=g,z=x;for(Ul(v,g,h),A(v[x],k)>0&&Ul(v,g,x);L<z;){for(Ul(v,L,z),L++,z--;A(v[L],k)<0;)L++;for(;A(v[z],k)>0;)z--}A(v[g],k)===0?Ul(v,g,z):(z++,Ul(v,z,x)),z<=h&&(g=z+1),h<=z&&(x=z-1)}}function Ul(v,h,g){const x=v[h];v[h]=v[g],v[g]=x}function hv(v,h){return v<h?-1:v>h?1:0}function nd(v,h){if(v.length<=1)return[v];const g=[];let x,A;for(const k of v){const L=Wy(k);L!==0&&(k.area=Math.abs(L),A===void 0&&(A=L<0),A===L<0?(x&&g.push(x),x=[k]):x.push(k))}if(x&&g.push(x),h>1)for(let k=0;k<g.length;k++)g[k].length<=h||(Cp(g[k],h,1,g[k].length-1,$y),g[k]=g[k].slice(0,h));return g}function $y(v,h){return h.area-v.area}function Wy(v){let h=0;for(let g,x,A=0,k=v.length,L=k-1;A<k;L=A++)g=v[A],x=v[L],h+=(x.x-g.x)*(g.y+x.y);return h}const fv=1/298.257223563,Gy=fv*(2-fv),Xy=Math.PI/180;class dv{constructor(h){const g=6378.137*Xy*1e3,x=Math.cos(h*Xy),A=1/(1-Gy*(1-x*x)),k=Math.sqrt(A);this.kx=g*k*x,this.ky=g*k*A*(1-Gy)}distance(h,g){const x=this.wrap(h[0]-g[0])*this.kx,A=(h[1]-g[1])*this.ky;return Math.sqrt(x*x+A*A)}pointOnLine(h,g){let x,A,k,L,z=1/0;for(let V=0;V<h.length-1;V++){let X=h[V][0],Z=h[V][1],J=this.wrap(h[V+1][0]-X)*this.kx,oe=(h[V+1][1]-Z)*this.ky,le=0;J===0&&oe===0||(le=(this.wrap(g[0]-X)*this.kx*J+(g[1]-Z)*this.ky*oe)/(J*J+oe*oe),le>1?(X=h[V+1][0],Z=h[V+1][1]):le>0&&(X+=J/this.kx*le,Z+=oe/this.ky*le)),J=this.wrap(g[0]-X)*this.kx,oe=(g[1]-Z)*this.ky;const ce=J*J+oe*oe;ce<z&&(z=ce,x=X,A=Z,k=V,L=le)}return{point:[x,A],index:k,t:Math.max(0,Math.min(1,L))}}wrap(h){for(;h<-180;)h+=360;for(;h>180;)h-=360;return h}}function Ja(v,h){return h[0]-v[0]}function Pu(v){return v[1]-v[0]+1}function vl(v,h){return v[1]>=v[0]&&v[1]<h}function Mp(v,h){if(v[0]>v[1])return[null,null];const g=Pu(v);if(h){if(g===2)return[v,null];const A=Math.floor(g/2);return[[v[0],v[0]+A],[v[0]+A,v[1]]]}if(g===1)return[v,null];const x=Math.floor(g/2)-1;return[[v[0],v[0]+x],[v[0]+x+1,v[1]]]}function Ep(v,h){if(!vl(h,v.length))return[1/0,1/0,-1/0,-1/0];const g=[1/0,1/0,-1/0,-1/0];for(let x=h[0];x<=h[1];++x)zc(g,v[x]);return g}function yi(v){const h=[1/0,1/0,-1/0,-1/0];for(const g of v)for(const x of g)zc(h,x);return h}function Ip(v){return v[0]!==-1/0&&v[1]!==-1/0&&v[2]!==1/0&&v[3]!==1/0}function pv(v,h,g){if(!Ip(v)||!Ip(h))return NaN;let x=0,A=0;return v[2]<h[0]&&(x=h[0]-v[2]),v[0]>h[2]&&(x=v[0]-h[2]),v[1]>h[3]&&(A=v[1]-h[3]),v[3]<h[1]&&(A=h[1]-v[3]),g.distance([0,0],[x,A])}function os(v,h,g){const x=g.pointOnLine(h,v);return g.distance(v,x.point)}function ad(v,h,g,x,A){const k=Math.min(os(v,[g,x],A),os(h,[g,x],A)),L=Math.min(os(g,[v,h],A),os(x,[v,h],A));return Math.min(k,L)}function od(v,h,g,x,A){if(!vl(h,v.length)||!vl(x,g.length))return 1/0;let k=1/0;for(let L=h[0];L<h[1];++L){const z=v[L],V=v[L+1];for(let X=x[0];X<x[1];++X){const Z=g[X],J=g[X+1];if(td(z,V,Z,J))return 0;k=Math.min(k,ad(z,V,Z,J,A))}}return k}function gv(v,h,g,x,A){if(!vl(h,v.length)||!vl(x,g.length))return NaN;let k=1/0;for(let L=h[0];L<=h[1];++L)for(let z=x[0];z<=x[1];++z)if(k=Math.min(k,A.distance(v[L],g[z])),k===0)return k;return k}function Zy(v,h,g){if(zs(v,h,!0))return 0;let x=1/0;for(const A of h){const k=A[0],L=A[A.length-1];if(k!==L&&(x=Math.min(x,os(v,[L,k],g)),x===0))return x;const z=g.pointOnLine(A,v);if(x=Math.min(x,g.distance(v,z.point)),x===0)return x}return x}function Fc(v,h,g,x){if(!vl(h,v.length))return NaN;for(let k=h[0];k<=h[1];++k)if(zs(v[k],g,!0))return 0;let A=1/0;for(let k=h[0];k<h[1];++k){const L=v[k],z=v[k+1];for(const V of g)for(let X=0,Z=V.length,J=Z-1;X<Z;J=X++){const oe=V[J],le=V[X];if(td(L,z,oe,le))return 0;A=Math.min(A,ad(L,z,oe,le,x))}}return A}function Vc(v,h){for(const g of v)for(const x of g)if(zs(x,h,!0))return!0;return!1}function vv(v,h,g,x=1/0){const A=yi(v),k=yi(h);if(x!==1/0&&pv(A,k,g)>=x)return x;if(jh(A,k)){if(Vc(v,h))return 0}else if(Vc(h,v))return 0;let L=1/0;for(const z of v)for(let V=0,X=z.length,Z=X-1;V<X;Z=V++){const J=z[Z],oe=z[V];for(const le of h)for(let ce=0,ge=le.length,be=ge-1;ce<ge;be=ce++){const Ee=le[be],qe=le[ce];if(td(J,oe,Ee,qe))return 0;L=Math.min(L,ad(J,oe,Ee,qe,g))}}return L}function mv(v,h,g,x,A,k){if(!k)return;const L=pv(Ep(x,k),A,g);L<h&&v.push([L,k,[0,0]])}function ml(v,h,g,x,A,k,L){if(!k||!L)return;const z=pv(Ep(x,k),Ep(A,L),g);z<h&&v.push([z,k,L])}function sd(v,h,g,x,A=1/0){let k=Math.min(x.distance(v[0],g[0][0]),A);if(k===0)return k;const L=new cv([[0,[0,v.length-1],[0,0]]],Ja),z=yi(g);for(;L.length>0;){const V=L.pop();if(V[0]>=k)continue;const X=V[1],Z=h?50:100;if(Pu(X)<=Z){if(!vl(X,v.length))return NaN;if(h){const J=Fc(v,X,g,x);if(isNaN(J)||J===0)return J;k=Math.min(k,J)}else for(let J=X[0];J<=X[1];++J){const oe=Zy(v[J],g,x);if(k=Math.min(k,oe),k===0)return 0}}else{const J=Mp(X,h);mv(L,k,x,v,z,J[0]),mv(L,k,x,v,z,J[1])}}return k}function ld(v,h,g,x,A,k=1/0){let L=Math.min(k,A.distance(v[0],g[0]));if(L===0)return L;const z=new cv([[0,[0,v.length-1],[0,g.length-1]]],Ja);for(;z.length>0;){const V=z.pop();if(V[0]>=L)continue;const X=V[1],Z=V[2],J=h?50:100,oe=x?50:100;if(Pu(X)<=J&&Pu(Z)<=oe){if(!vl(X,v.length)&&vl(Z,g.length))return NaN;let le;if(h&&x)le=od(v,X,g,Z,A),L=Math.min(L,le);else if(h&&!x){const ce=v.slice(X[0],X[1]+1);for(let ge=Z[0];ge<=Z[1];++ge)if(le=os(g[ge],ce,A),L=Math.min(L,le),L===0)return L}else if(!h&&x){const ce=g.slice(Z[0],Z[1]+1);for(let ge=X[0];ge<=X[1];++ge)if(le=os(v[ge],ce,A),L=Math.min(L,le),L===0)return L}else le=gv(v,X,g,Z,A),L=Math.min(L,le)}else{const le=Mp(X,h),ce=Mp(Z,x);ml(z,L,A,v,g,le[0],ce[0]),ml(z,L,A,v,g,le[0],ce[1]),ml(z,L,A,v,g,le[1],ce[0]),ml(z,L,A,v,g,le[1],ce[1])}}return L}function Pp(v){return v.type==="MultiPolygon"?v.coordinates.map((h=>({type:"Polygon",coordinates:h}))):v.type==="MultiLineString"?v.coordinates.map((h=>({type:"LineString",coordinates:h}))):v.type==="MultiPoint"?v.coordinates.map((h=>({type:"Point",coordinates:h}))):[v]}class Uc{constructor(h,g){this.type=Lt,this.geojson=h,this.geometries=g}static parse(h,g){if(h.length!==2)return g.error(`'distance' expression requires exactly one argument, but found ${h.length-1} instead.`);if(Di(h[1])){const x=h[1];if(x.type==="FeatureCollection")return new Uc(x,x.features.map((A=>Pp(A.geometry))).flat());if(x.type==="Feature")return new Uc(x,Pp(x.geometry));if("type"in x&&"coordinates"in x)return new Uc(x,Pp(x))}return g.error("'distance' expression requires valid geojson object that contains polygon geometry type.")}evaluate(h){if(h.geometry()!=null&&h.canonicalID()!=null){if(h.geometryType()==="Point")return(function(g,x){const A=g.geometry(),k=A.flat().map((V=>sv([V.x,V.y],g.canonical)));if(A.length===0)return NaN;const L=new dv(k[0][1]);let z=1/0;for(const V of x){switch(V.type){case"Point":z=Math.min(z,ld(k,!1,[V.coordinates],!1,L,z));break;case"LineString":z=Math.min(z,ld(k,!1,V.coordinates,!0,L,z));break;case"Polygon":z=Math.min(z,sd(k,!1,V.coordinates,L,z))}if(z===0)return z}return z})(h,this.geometries);if(h.geometryType()==="LineString")return(function(g,x){const A=g.geometry(),k=A.flat().map((V=>sv([V.x,V.y],g.canonical)));if(A.length===0)return NaN;const L=new dv(k[0][1]);let z=1/0;for(const V of x){switch(V.type){case"Point":z=Math.min(z,ld(k,!0,[V.coordinates],!1,L,z));break;case"LineString":z=Math.min(z,ld(k,!0,V.coordinates,!0,L,z));break;case"Polygon":z=Math.min(z,sd(k,!0,V.coordinates,L,z))}if(z===0)return z}return z})(h,this.geometries);if(h.geometryType()==="Polygon")return(function(g,x){const A=g.geometry();if(A.length===0||A[0].length===0)return NaN;const k=nd(A,0).map((V=>V.map((X=>X.map((Z=>sv([Z.x,Z.y],g.canonical))))))),L=new dv(k[0][0][0][1]);let z=1/0;for(const V of x)for(const X of k){switch(V.type){case"Point":z=Math.min(z,sd([V.coordinates],!1,X,L,z));break;case"LineString":z=Math.min(z,sd(V.coordinates,!0,X,L,z));break;case"Polygon":z=Math.min(z,vv(X,V.coordinates,L,z))}if(z===0)return z}return z})(h,this.geometries)}return NaN}eachChild(){}outputDefined(){return!0}}class ud{constructor(h){this.type=Nr,this.key=h}static parse(h,g){if(h.length!==2)return g.error(`Expected 1 argument, but found ${h.length-1} instead.`);const x=h[1];return x==null?g.error("Global state property must be defined."):typeof x!="string"?g.error(`Global state property must be string, but found ${typeof h[1]} instead.`):new ud(x)}evaluate(h){var g;const x=(g=h.globals)===null||g===void 0?void 0:g.globalState;return x&&Object.keys(x).length!==0?Bh(x,this.key):null}eachChild(){}outputDefined(){return!1}}const Gh={"==":Bs,"!=":iv,">":Ab,"<":wp,">=":Cb,"<=":nv,array:Hr,at:Lc,boolean:Hr,case:ga,coalesce:xp,collator:Sp,format:Tp,image:Uh,in:Oc,"index-of":Fh,interpolate:na,"interpolate-hcl":na,"interpolate-lab":na,length:ov,let:Mu,literal:Mr,match:gl,number:Hr,"number-format":av,object:Hr,slice:Nc,step:Eu,string:Hr,"to-boolean":Dn,"to-color":Dn,"to-number":Dn,"to-string":Dn,var:kc,within:Iu,distance:Uc,"global-state":ud};class No{constructor(h,g,x,A){this.name=h,this.type=g,this._evaluate=x,this.args=A}evaluate(h){return this._evaluate(h,this.args)}eachChild(h){this.args.forEach(h)}outputDefined(){return!1}static parse(h,g){const x=h[0],A=No.definitions[x];if(!A)return g.error(`Unknown expression "${x}". If you wanted a literal array, use ["literal", [...]].`,0);const k=Array.isArray(A)?A[0]:A.type,L=Array.isArray(A)?[[A[1],A[2]]]:A.overloads,z=L.filter((([X])=>!Array.isArray(X)||X.length===h.length-1));let V=null;for(const[X,Z]of z){V=new Qf(g.registry,eo,g.path,null,g.scope);const J=[];let oe=!1;for(let le=1;le<h.length;le++){const ce=h[le],ge=Array.isArray(X)?X[le-1]:X.type,be=V.parse(ce,1+J.length,ge);if(!be){oe=!0;break}J.push(be)}if(!oe)if(Array.isArray(X)&&X.length!==J.length)V.error(`Expected ${X.length} arguments, but found ${J.length} instead.`);else{for(let le=0;le<J.length;le++){const ce=Array.isArray(X)?X[le]:X.type,ge=J[le];V.concat(le+1).checkSubtype(ce,ge.type)}if(V.errors.length===0)return new No(x,k,Z,J)}}if(z.length===1)g.errors.push(...V.errors);else{const X=(z.length?z:L).map((([J])=>{return oe=J,Array.isArray(oe)?`(${oe.map(Ri).join(", ")})`:`(${Ri(oe.type)}...)`;var oe})).join(" | "),Z=[];for(let J=1;J<h.length;J++){const oe=g.parse(h[J],1+Z.length);if(!oe)return null;Z.push(Ri(oe.type))}g.error(`Expected arguments of type ${X}, but found (${Z.join(", ")}) instead.`)}return null}static register(h,g){No.definitions=g;for(const x in g)h[x]=No}}function yv(v,[h,g,x,A]){h=h.evaluate(v),g=g.evaluate(v),x=x.evaluate(v);const k=A?A.evaluate(v):1,L=ns(h,g,x,k);if(L)throw new qi(L);return new Zr(h/255,g/255,x/255,k,!1)}function Rp(v,h){return v in h}function Bo(v,h){const g=h[v];return g===void 0?null:g}function yl(v){return{type:v}}function eo(v){if(v instanceof kc)return eo(v.boundExpression);if(v instanceof No&&v.name==="error"||v instanceof Sp||v instanceof Iu||v instanceof Uc||v instanceof ud)return!1;const h=v instanceof Dn||v instanceof Hr;let g=!0;return v.eachChild((x=>{g=h?g&&eo(x):g&&x instanceof Mr})),!!g&&Hl(v)&&jc(v,["zoom","heatmap-density","elevation","line-progress","accumulated","is-supported-script"])}function Hl(v){if(v instanceof No&&(v.name==="get"&&v.args.length===1||v.name==="feature-state"||v.name==="has"&&v.args.length===1||v.name==="properties"||v.name==="geometry-type"||v.name==="id"||/^filter-/.test(v.name))||v instanceof Iu||v instanceof Uc)return!1;let h=!0;return v.eachChild((g=>{h&&!Hl(g)&&(h=!1)})),h}function Hc(v){if(v instanceof No&&v.name==="feature-state")return!1;let h=!0;return v.eachChild((g=>{h&&!Hc(g)&&(h=!1)})),h}function jc(v,h){if(v instanceof No&&h.indexOf(v.name)>=0)return!1;let g=!0;return v.eachChild((x=>{g&&!jc(x,h)&&(g=!1)})),g}function cd(v){return{result:"success",value:v}}function Ru(v){return{result:"error",value:v}}function ss(v){return v["property-type"]==="data-driven"||v["property-type"]==="cross-faded-data-driven"}function _v(v){return!!v.expression&&v.expression.parameters.indexOf("zoom")>-1}function Du(v){return!!v.expression&&v.expression.interpolated}function jr(v){return v instanceof Number?"number":v instanceof String?"string":v instanceof Boolean?"boolean":Array.isArray(v)?"array":v===null?"null":typeof v}function Dp(v){return typeof v=="object"&&v!==null&&!Array.isArray(v)&&nn(v)===Ns}function zo(v){return v}function hd(v,h){const g=v.stops&&typeof v.stops[0][0]=="object",x=g||!(g||v.property!==void 0),A=v.type||(Du(h)?"exponential":"interval"),k=(function(Z){switch(Z.type){case"color":return Zr.parse;case"padding":return Rn.parse;case"numberArray":return ra.parse;case"colorArray":return ia.parse;default:return null}})(h);if(k&&((v=Os({},v)).stops&&(v.stops=v.stops.map((Z=>[Z[0],k(Z[1])]))),v.default=k(v.default?v.default:h.default)),v.colorSpace&&(L=v.colorSpace)!=="rgb"&&L!=="hcl"&&L!=="lab")throw new Error(`Unknown color space: "${v.colorSpace}"`);var L;const z=(function(Z){switch(Z){case"exponential":return jl;case"interval":return $c;case"categorical":return qy;case"identity":return bv;default:throw new Error(`Unknown function type "${Z}"`)}})(A);let V,X;if(A==="categorical"){V=Object.create(null);for(const Z of v.stops)V[Z[0]]=Z[1];X=typeof v.stops[0][0]}if(g){const Z={},J=[];for(let ce=0;ce<v.stops.length;ce++){const ge=v.stops[ce],be=ge[0].zoom;Z[be]===void 0&&(Z[be]={zoom:be,type:v.type,property:v.property,default:v.default,stops:[]},J.push(be)),Z[be].stops.push([ge[0].value,ge[1]])}const oe=[];for(const ce of J)oe.push([Z[ce].zoom,hd(Z[ce],h)]);const le={name:"linear"};return{kind:"composite",interpolationType:le,interpolationFactor:na.interpolationFactor.bind(void 0,le),zoomStops:oe.map((ce=>ce[0])),evaluate:({zoom:ce},ge)=>jl({stops:oe,base:v.base},h,ce).evaluate(ce,ge)}}if(x){const Z=A==="exponential"?{name:"exponential",base:v.base!==void 0?v.base:1}:null;return{kind:"camera",interpolationType:Z,interpolationFactor:na.interpolationFactor.bind(void 0,Z),zoomStops:v.stops.map((J=>J[0])),evaluate:({zoom:J})=>z(v,h,J,V,X)}}return{kind:"source",evaluate(Z,J){const oe=J&&J.properties?J.properties[v.property]:void 0;return oe===void 0?Fo(v.default,h.default):z(v,h,oe,V,X)}}}function Fo(v,h,g){return v!==void 0?v:h!==void 0?h:g!==void 0?g:void 0}function qy(v,h,g,x,A){return Fo(typeof g===A?x[g]:void 0,v.default,h.default)}function $c(v,h,g){if(jr(g)!=="number")return Fo(v.default,h.default);const x=v.stops.length;if(x===1||g<=v.stops[0][0])return v.stops[0][1];if(g>=v.stops[x-1][0])return v.stops[x-1][1];const A=Bc(v.stops.map((k=>k[0])),g);return v.stops[A][1]}function jl(v,h,g){const x=v.base!==void 0?v.base:1;if(jr(g)!=="number")return Fo(v.default,h.default);const A=v.stops.length;if(A===1||g<=v.stops[0][0])return v.stops[0][1];if(g>=v.stops[A-1][0])return v.stops[A-1][1];const k=Bc(v.stops.map((Z=>Z[0])),g),L=(function(Z,J,oe,le){const ce=le-oe,ge=Z-oe;return ce===0?0:J===1?ge/ce:(Math.pow(J,ge)-1)/(Math.pow(J,ce)-1)})(g,x,v.stops[k][0],v.stops[k+1][0]),z=v.stops[k][1],V=v.stops[k+1][1],X=as[h.type]||zo;return typeof z.evaluate=="function"?{evaluate(...Z){const J=z.evaluate.apply(void 0,Z),oe=V.evaluate.apply(void 0,Z);if(J!==void 0&&oe!==void 0)return X(J,oe,L,v.colorSpace)}}:X(z,V,L,v.colorSpace)}function bv(v,h,g){switch(h.type){case"color":g=Zr.parse(g);break;case"formatted":g=ta.fromString(g.toString());break;case"resolvedImage":g=Qa.fromString(g.toString());break;case"padding":g=Rn.parse(g);break;case"colorArray":g=ia.parse(g);break;case"numberArray":g=ra.parse(g);break;default:jr(g)===h.type||h.type==="enum"&&h.values[g]||(g=void 0)}return Fo(g,v.default,h.default)}No.register(Gh,{error:[{kind:"error"},[Br],(v,[h])=>{throw new qi(h.evaluate(v))}],typeof:[Br,[Nr],(v,[h])=>Ri(nn(h.evaluate(v)))],"to-rgba":[_o(Lt,4),[ko],(v,[h])=>{const[g,x,A,k]=h.evaluate(v).rgb;return[255*g,255*x,255*A,k]}],rgb:[ko,[Lt,Lt,Lt],yv],rgba:[ko,[Lt,Lt,Lt,Lt],yv],has:{type:Ur,overloads:[[[Br],(v,[h])=>Rp(h.evaluate(v),v.properties())],[[Br,Ns],(v,[h,g])=>Rp(h.evaluate(v),g.evaluate(v))]]},get:{type:Nr,overloads:[[[Br],(v,[h])=>Bo(h.evaluate(v),v.properties())],[[Br,Ns],(v,[h,g])=>Bo(h.evaluate(v),g.evaluate(v))]]},"feature-state":[Nr,[Br],(v,[h])=>Bo(h.evaluate(v),v.featureState||{})],properties:[Ns,[],v=>v.properties()],"geometry-type":[Br,[],v=>v.geometryType()],id:[Nr,[],v=>v.id()],zoom:[Lt,[],v=>v.globals.zoom],"heatmap-density":[Lt,[],v=>v.globals.heatmapDensity||0],elevation:[Lt,[],v=>v.globals.elevation||0],"line-progress":[Lt,[],v=>v.globals.lineProgress||0],accumulated:[Nr,[],v=>v.globals.accumulated===void 0?null:v.globals.accumulated],"+":[Lt,yl(Lt),(v,h)=>{let g=0;for(const x of h)g+=x.evaluate(v);return g}],"*":[Lt,yl(Lt),(v,h)=>{let g=1;for(const x of h)g*=x.evaluate(v);return g}],"-":{type:Lt,overloads:[[[Lt,Lt],(v,[h,g])=>h.evaluate(v)-g.evaluate(v)],[[Lt],(v,[h])=>-h.evaluate(v)]]},"/":[Lt,[Lt,Lt],(v,[h,g])=>h.evaluate(v)/g.evaluate(v)],"%":[Lt,[Lt,Lt],(v,[h,g])=>h.evaluate(v)%g.evaluate(v)],ln2:[Lt,[],()=>Math.LN2],pi:[Lt,[],()=>Math.PI],e:[Lt,[],()=>Math.E],"^":[Lt,[Lt,Lt],(v,[h,g])=>Math.pow(h.evaluate(v),g.evaluate(v))],sqrt:[Lt,[Lt],(v,[h])=>Math.sqrt(h.evaluate(v))],log10:[Lt,[Lt],(v,[h])=>Math.log(h.evaluate(v))/Math.LN10],ln:[Lt,[Lt],(v,[h])=>Math.log(h.evaluate(v))],log2:[Lt,[Lt],(v,[h])=>Math.log(h.evaluate(v))/Math.LN2],sin:[Lt,[Lt],(v,[h])=>Math.sin(h.evaluate(v))],cos:[Lt,[Lt],(v,[h])=>Math.cos(h.evaluate(v))],tan:[Lt,[Lt],(v,[h])=>Math.tan(h.evaluate(v))],asin:[Lt,[Lt],(v,[h])=>Math.asin(h.evaluate(v))],acos:[Lt,[Lt],(v,[h])=>Math.acos(h.evaluate(v))],atan:[Lt,[Lt],(v,[h])=>Math.atan(h.evaluate(v))],min:[Lt,yl(Lt),(v,h)=>Math.min(...h.map((g=>g.evaluate(v))))],max:[Lt,yl(Lt),(v,h)=>Math.max(...h.map((g=>g.evaluate(v))))],abs:[Lt,[Lt],(v,[h])=>Math.abs(h.evaluate(v))],round:[Lt,[Lt],(v,[h])=>{const g=h.evaluate(v);return g<0?-Math.round(-g):Math.round(g)}],floor:[Lt,[Lt],(v,[h])=>Math.floor(h.evaluate(v))],ceil:[Lt,[Lt],(v,[h])=>Math.ceil(h.evaluate(v))],"filter-==":[Ur,[Br,Nr],(v,[h,g])=>v.properties()[h.value]===g.value],"filter-id-==":[Ur,[Nr],(v,[h])=>v.id()===h.value],"filter-type-==":[Ur,[Br],(v,[h])=>v.geometryType()===h.value],"filter-<":[Ur,[Br,Nr],(v,[h,g])=>{const x=v.properties()[h.value],A=g.value;return typeof x==typeof A&&x<A}],"filter-id-<":[Ur,[Nr],(v,[h])=>{const g=v.id(),x=h.value;return typeof g==typeof x&&g<x}],"filter->":[Ur,[Br,Nr],(v,[h,g])=>{const x=v.properties()[h.value],A=g.value;return typeof x==typeof A&&x>A}],"filter-id->":[Ur,[Nr],(v,[h])=>{const g=v.id(),x=h.value;return typeof g==typeof x&&g>x}],"filter-<=":[Ur,[Br,Nr],(v,[h,g])=>{const x=v.properties()[h.value],A=g.value;return typeof x==typeof A&&x<=A}],"filter-id-<=":[Ur,[Nr],(v,[h])=>{const g=v.id(),x=h.value;return typeof g==typeof x&&g<=x}],"filter->=":[Ur,[Br,Nr],(v,[h,g])=>{const x=v.properties()[h.value],A=g.value;return typeof x==typeof A&&x>=A}],"filter-id->=":[Ur,[Nr],(v,[h])=>{const g=v.id(),x=h.value;return typeof g==typeof x&&g>=x}],"filter-has":[Ur,[Nr],(v,[h])=>h.value in v.properties()],"filter-has-id":[Ur,[],v=>v.id()!==null&&v.id()!==void 0],"filter-type-in":[Ur,[_o(Br)],(v,[h])=>h.value.indexOf(v.geometryType())>=0],"filter-id-in":[Ur,[_o(Nr)],(v,[h])=>h.value.indexOf(v.id())>=0],"filter-in-small":[Ur,[Br,_o(Nr)],(v,[h,g])=>g.value.indexOf(v.properties()[h.value])>=0],"filter-in-large":[Ur,[Br,_o(Nr)],(v,[h,g])=>(function(x,A,k,L){for(;k<=L;){const z=k+L>>1;if(A[z]===x)return!0;A[z]>x?L=z-1:k=z+1}return!1})(v.properties()[h.value],g.value,0,g.value.length-1)],all:{type:Ur,overloads:[[[Ur,Ur],(v,[h,g])=>h.evaluate(v)&&g.evaluate(v)],[yl(Ur),(v,h)=>{for(const g of h)if(!g.evaluate(v))return!1;return!0}]]},any:{type:Ur,overloads:[[[Ur,Ur],(v,[h,g])=>h.evaluate(v)||g.evaluate(v)],[yl(Ur),(v,h)=>{for(const g of h)if(g.evaluate(v))return!0;return!1}]]},"!":[Ur,[Ur],(v,[h])=>!h.evaluate(v)],"is-supported-script":[Ur,[Br],(v,[h])=>{const g=v.globals&&v.globals.isSupportedScript;return!g||g(h.evaluate(v))}],upcase:[Br,[Br],(v,[h])=>h.evaluate(v).toUpperCase()],downcase:[Br,[Br],(v,[h])=>h.evaluate(v).toLowerCase()],concat:[Br,yl(Nr),(v,h)=>h.map((g=>Qr(g.evaluate(v)))).join("")],"resolved-locale":[Br,[wu],(v,[h])=>h.evaluate(v).resolvedLocale()]});class kp{constructor(h,g,x){this.expression=h,this._warningHistory={},this._evaluator=new Fl,this._defaultValue=g?(function(A){if(A.type==="color"&&Dp(A.default))return new Zr(0,0,0,0);switch(A.type){case"color":return Zr.parse(A.default)||null;case"padding":return Rn.parse(A.default)||null;case"numberArray":return ra.parse(A.default)||null;case"colorArray":return ia.parse(A.default)||null;case"variableAnchorOffsetCollection":return En.parse(A.default)||null;case"projectionDefinition":return pa.parse(A.default)||null;default:return A.default===void 0?null:A.default}})(g):null,this._enumValues=g&&g.type==="enum"?g.values:null,this._globalState=x}evaluateWithoutErrorHandling(h,g,x,A,k,L){return this._globalState&&(h=ma(h,this._globalState)),this._evaluator.globals=h,this._evaluator.feature=g,this._evaluator.featureState=x,this._evaluator.canonical=A,this._evaluator.availableImages=k||null,this._evaluator.formattedSection=L,this.expression.evaluate(this._evaluator)}evaluate(h,g,x,A,k,L){this._globalState&&(h=ma(h,this._globalState)),this._evaluator.globals=h,this._evaluator.feature=g||null,this._evaluator.featureState=x||null,this._evaluator.canonical=A,this._evaluator.availableImages=k||null,this._evaluator.formattedSection=L||null;try{const z=this.expression.evaluate(this._evaluator);if(z==null||typeof z=="number"&&z!=z)return this._defaultValue;if(this._enumValues&&!(z in this._enumValues))throw new qi(`Expected value to be one of ${Object.keys(this._enumValues).map((V=>JSON.stringify(V))).join(", ")}, but found ${JSON.stringify(z)} instead.`);return z}catch(z){return this._warningHistory[z.message]||(this._warningHistory[z.message]=!0,typeof console<"u"&&console.warn(z.message)),this._defaultValue}}}function Xh(v){return Array.isArray(v)&&v.length>0&&typeof v[0]=="string"&&v[0]in Gh}function fd(v,h,g){const x=new Qf(Gh,eo,[],h?(function(k){const L={color:ko,string:Br,number:Lt,enum:Br,boolean:Ur,formatted:cl,padding:is,numberArray:yo,colorArray:Ol,projectionDefinition:ul,resolvedImage:mn,variableAnchorOffsetCollection:Pn};return k.type==="array"?_o(L[k.value]||Nr,k.length):L[k.type]})(h):void 0),A=x.parse(v,void 0,void 0,void 0,h&&h.type==="string"?{typeAnnotation:"coerce"}:void 0);return A?cd(new kp(A,h,g)):Ru(x.errors)}class to{constructor(h,g,x){this.kind=h,this._styleExpression=g,this.isStateDependent=h!=="constant"&&!Hc(g.expression),this.globalStateRefs=za(g.expression),this._globalState=x}evaluateWithoutErrorHandling(h,g,x,A,k,L){return this._globalState&&(h=ma(h,this._globalState)),this._styleExpression.evaluateWithoutErrorHandling(h,g,x,A,k,L)}evaluate(h,g,x,A,k,L){return this._globalState&&(h=ma(h,this._globalState)),this._styleExpression.evaluate(h,g,x,A,k,L)}}class $l{constructor(h,g,x,A,k){this.kind=h,this.zoomStops=x,this._styleExpression=g,this.isStateDependent=h!=="camera"&&!Hc(g.expression),this.globalStateRefs=za(g.expression),this.interpolationType=A,this._globalState=k}evaluateWithoutErrorHandling(h,g,x,A,k,L){return this._globalState&&(h=ma(h,this._globalState)),this._styleExpression.evaluateWithoutErrorHandling(h,g,x,A,k,L)}evaluate(h,g,x,A,k,L){return this._globalState&&(h=ma(h,this._globalState)),this._styleExpression.evaluate(h,g,x,A,k,L)}interpolationFactor(h,g,x){return this.interpolationType?na.interpolationFactor(this.interpolationType,h,g,x):0}}function ku(v,h,g){const x=fd(v,h,g);if(x.result==="error")return x;const A=x.value.expression,k=Hl(A);if(!k&&!ss(h))return Ru([new mo("","data expressions not supported")]);const L=jc(A,["zoom"]);if(!L&&!_v(h))return Ru([new mo("","zoom expressions not supported")]);const z=Lu(A);return z||L?z instanceof mo?Ru([z]):z instanceof na&&!Du(h)?Ru([new mo("",'"interpolate" expressions cannot be used with this property')]):cd(z?new $l(k?"camera":"composite",x.value,z.labels,z instanceof na?z.interpolation:void 0,g):new to(k?"constant":"source",x.value,g)):Ru([new mo("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class Wc{constructor(h,g){this._parameters=h,this._specification=g,Os(this,hd(this._parameters,this._specification))}static deserialize(h){return new Wc(h._parameters,h._specification)}static serialize(h){return{_parameters:h._parameters,_specification:h._specification}}}function Lu(v){let h=null;if(v instanceof Mu)h=Lu(v.result);else if(v instanceof xp){for(const g of v.args)if(h=Lu(g),h)break}else(v instanceof Eu||v instanceof na)&&v.input instanceof No&&v.input.name==="zoom"&&(h=v);return h instanceof mo||v.eachChild((g=>{const x=Lu(g);x instanceof mo?h=x:!h&&x?h=new mo("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):h&&x&&h!==x&&(h=new mo("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))})),h}function za(v,h=new Set){return v instanceof ud&&h.add(v.key),v.eachChild((g=>{za(g,h)})),h}function ma(v,h){const{zoom:g,heatmapDensity:x,elevation:A,lineProgress:k,isSupportedScript:L,accumulated:z}=v??{};return{zoom:g,heatmapDensity:x,elevation:A,lineProgress:k,isSupportedScript:L,accumulated:z,globalState:h}}function Fs(v){if(v===!0||v===!1)return!0;if(!Array.isArray(v)||v.length===0)return!1;switch(v[0]){case"has":return v.length>=2&&v[1]!=="$id"&&v[1]!=="$type";case"in":return v.length>=3&&(typeof v[1]!="string"||Array.isArray(v[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return v.length!==3||Array.isArray(v[1])||Array.isArray(v[2]);case"any":case"all":for(const h of v.slice(1))if(!Fs(h)&&typeof h!="boolean")return!1;return!0;default:return!0}}const _l={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function bo(v,h){if(v==null)return{filter:()=>!0,needGeometry:!1,getGlobalStateRefs:()=>new Set};Fs(v)||(v=Gc(v));const g=fd(v,_l,h);if(g.result==="error")throw new Error(g.value.map((x=>`${x.key}: ${x.message}`)).join(", "));return{filter:(x,A,k)=>g.value.evaluate(x,A,{},k),needGeometry:xv(v),getGlobalStateRefs:()=>za(g.value.expression)}}function Wl(v,h){return v<h?-1:v>h?1:0}function xv(v){if(!Array.isArray(v))return!1;if(v[0]==="within"||v[0]==="distance")return!0;for(let h=1;h<v.length;h++)if(xv(v[h]))return!0;return!1}function Gc(v){if(!v)return!0;const h=v[0];return v.length<=1?h!=="any":h==="=="?Zh(v[1],v[2],"=="):h==="!="?Oi(Zh(v[1],v[2],"==")):h==="<"||h===">"||h==="<="||h===">="?Zh(v[1],v[2],h):h==="any"?(g=v.slice(1),["any"].concat(g.map(Gc))):h==="all"?["all"].concat(v.slice(1).map(Gc)):h==="none"?["all"].concat(v.slice(1).map(Gc).map(Oi)):h==="in"?dd(v[1],v.slice(2)):h==="!in"?Oi(dd(v[1],v.slice(2))):h==="has"?Gn(v[1]):h!=="!has"||Oi(Gn(v[1]));var g}function Zh(v,h,g){switch(v){case"$type":return[`filter-type-${g}`,h];case"$id":return[`filter-id-${g}`,h];default:return[`filter-${g}`,v,h]}}function dd(v,h){if(h.length===0)return!1;switch(v){case"$type":return["filter-type-in",["literal",h]];case"$id":return["filter-id-in",["literal",h]];default:return h.length>200&&!h.some((g=>typeof g!=typeof h[0]))?["filter-in-large",v,["literal",h.sort(Wl)]]:["filter-in-small",v,["literal",h]]}}function Gn(v){switch(v){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",v]}}function Oi(v){return["!",v]}function ai(v){const h=typeof v;if(h==="number"||h==="boolean"||h==="string"||v==null)return JSON.stringify(v);if(Array.isArray(v)){let A="[";for(const k of v)A+=`${ai(k)},`;return`${A}]`}const g=Object.keys(v).sort();let x="{";for(let A=0;A<g.length;A++)x+=`${JSON.stringify(g[A])}:${ai(v[g[A]])},`;return`${x}}`}function Vs(v){let h="";for(const g of Kr)h+=`/${ai(v[g])}`;return h}function Vo(v){const h=v.value;return h?[new It(v.key,h,"constants have been deprecated as of v8")]:[]}function yn(v){return v instanceof Number||v instanceof String||v instanceof Boolean?v.valueOf():v}function xo(v){if(Array.isArray(v))return v.map(xo);if(v instanceof Object&&!(v instanceof Number||v instanceof String||v instanceof Boolean)){const h={};for(const g in v)h[g]=xo(v[g]);return h}return yn(v)}function Uo(v){const h=v.key,g=v.value,x=v.valueSpec||{},A=v.objectElementValidators||{},k=v.style,L=v.styleSpec,z=v.validateSpec;let V=[];const X=jr(g);if(X!=="object")return[new It(h,g,`object expected, ${X} found`)];for(const Z in g){const J=Z.split(".")[0],oe=Bh(x,J)||x["*"];let le;if(Bh(A,J))le=A[J];else if(Bh(x,J))le=z;else if(A["*"])le=A["*"];else{if(!x["*"]){V.push(new It(h,g[Z],`unknown property "${Z}"`));continue}le=z}V=V.concat(le({key:(h&&`${h}.`)+Z,value:g[Z],valueSpec:oe,style:k,styleSpec:L,object:g,objectKey:Z,validateSpec:z},g))}for(const Z in x)A[Z]||x[Z].required&&x[Z].default===void 0&&g[Z]===void 0&&V.push(new It(h,g,`missing required property "${Z}"`));return V}function Lp(v){const h=v.value,g=v.valueSpec,x=v.style,A=v.styleSpec,k=v.key,L=v.arrayElementValidator||v.validateSpec;if(jr(h)!=="array")return[new It(k,h,`array expected, ${jr(h)} found`)];if(g.length&&h.length!==g.length)return[new It(k,h,`array length ${g.length} expected, length ${h.length} found`)];if(g["min-length"]&&h.length<g["min-length"])return[new It(k,h,`array length at least ${g["min-length"]} expected, length ${h.length} found`)];let z={type:g.value,values:g.values};A.$version<7&&(z.function=g.function),jr(g.value)==="object"&&(z=g.value);let V=[];for(let X=0;X<h.length;X++)V=V.concat(L({array:h,arrayIndex:X,value:h[X],valueSpec:z,validateSpec:v.validateSpec,style:x,styleSpec:A,key:`${k}[${X}]`}));return V}function Gl(v){const h=v.key,g=v.value,x=v.valueSpec;let A=jr(g);return A==="number"&&g!=g&&(A="NaN"),A!=="number"?[new It(h,g,`number expected, ${A} found`)]:"minimum"in x&&g<x.minimum?[new It(h,g,`${g} is less than the minimum value ${x.minimum}`)]:"maximum"in x&&g>x.maximum?[new It(h,g,`${g} is greater than the maximum value ${x.maximum}`)]:[]}function Xl(v){const h=v.valueSpec,g=yn(v.value.type);let x,A,k,L={};const z=g!=="categorical"&&v.value.property===void 0,V=!z,X=jr(v.value.stops)==="array"&&jr(v.value.stops[0])==="array"&&jr(v.value.stops[0][0])==="object",Z=Uo({key:v.key,value:v.value,valueSpec:v.styleSpec.function,validateSpec:v.validateSpec,style:v.style,styleSpec:v.styleSpec,objectElementValidators:{stops:function(le){if(g==="identity")return[new It(le.key,le.value,'identity function may not have a "stops" property')];let ce=[];const ge=le.value;return ce=ce.concat(Lp({key:le.key,value:ge,valueSpec:le.valueSpec,validateSpec:le.validateSpec,style:le.style,styleSpec:le.styleSpec,arrayElementValidator:J})),jr(ge)==="array"&&ge.length===0&&ce.push(new It(le.key,ge,"array must have at least one stop")),ce},default:function(le){return le.validateSpec({key:le.key,value:le.value,valueSpec:h,validateSpec:le.validateSpec,style:le.style,styleSpec:le.styleSpec})}}});return g==="identity"&&z&&Z.push(new It(v.key,v.value,'missing required property "property"')),g==="identity"||v.value.stops||Z.push(new It(v.key,v.value,'missing required property "stops"')),g==="exponential"&&v.valueSpec.expression&&!Du(v.valueSpec)&&Z.push(new It(v.key,v.value,"exponential functions not supported")),v.styleSpec.$version>=8&&(V&&!ss(v.valueSpec)?Z.push(new It(v.key,v.value,"property functions not supported")):z&&!_v(v.valueSpec)&&Z.push(new It(v.key,v.value,"zoom functions not supported"))),g!=="categorical"&&!X||v.value.property!==void 0||Z.push(new It(v.key,v.value,'"property" property is required')),Z;function J(le){let ce=[];const ge=le.value,be=le.key;if(jr(ge)!=="array")return[new It(be,ge,`array expected, ${jr(ge)} found`)];if(ge.length!==2)return[new It(be,ge,`array length 2 expected, length ${ge.length} found`)];if(X){if(jr(ge[0])!=="object")return[new It(be,ge,`object expected, ${jr(ge[0])} found`)];if(ge[0].zoom===void 0)return[new It(be,ge,"object stop key must have zoom")];if(ge[0].value===void 0)return[new It(be,ge,"object stop key must have value")];if(k&&k>yn(ge[0].zoom))return[new It(be,ge[0].zoom,"stop zoom values must appear in ascending order")];yn(ge[0].zoom)!==k&&(k=yn(ge[0].zoom),A=void 0,L={}),ce=ce.concat(Uo({key:`${be}[0]`,value:ge[0],valueSpec:{zoom:{}},validateSpec:le.validateSpec,style:le.style,styleSpec:le.styleSpec,objectElementValidators:{zoom:Gl,value:oe}}))}else ce=ce.concat(oe({key:`${be}[0]`,value:ge[0],validateSpec:le.validateSpec,style:le.style,styleSpec:le.styleSpec},ge));return Xh(xo(ge[1]))?ce.concat([new It(`${be}[1]`,ge[1],"expressions are not allowed in function stops.")]):ce.concat(le.validateSpec({key:`${be}[1]`,value:ge[1],valueSpec:h,validateSpec:le.validateSpec,style:le.style,styleSpec:le.styleSpec}))}function oe(le,ce){const ge=jr(le.value),be=yn(le.value),Ee=le.value!==null?le.value:ce;if(x){if(ge!==x)return[new It(le.key,Ee,`${ge} stop domain type must match previous stop domain type ${x}`)]}else x=ge;if(ge!=="number"&&ge!=="string"&&ge!=="boolean")return[new It(le.key,Ee,"stop domain value must be a number, string, or boolean")];if(ge!=="number"&&g!=="categorical"){let qe=`number expected, ${ge} found`;return ss(h)&&g===void 0&&(qe+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new It(le.key,Ee,qe)]}return g!=="categorical"||ge!=="number"||isFinite(be)&&Math.floor(be)===be?g!=="categorical"&&ge==="number"&&A!==void 0&&be<A?[new It(le.key,Ee,"stop domain values must appear in ascending order")]:(A=be,g==="categorical"&&be in L?[new It(le.key,Ee,"stop domain values must be unique")]:(L[be]=!0,[])):[new It(le.key,Ee,`integer expected, found ${be}`)]}}function Zl(v){const h=(v.expressionContext==="property"?ku:fd)(xo(v.value),v.valueSpec);if(h.result==="error")return h.value.map((x=>new It(`${v.key}${x.key}`,v.value,x.message)));const g=h.value.expression||h.value._styleExpression.expression;if(v.expressionContext==="property"&&v.propertyKey==="text-font"&&!g.outputDefined())return[new It(v.key,v.value,`Invalid data expression for "${v.propertyKey}". Output values must be contained as literals within the expression.`)];if(v.expressionContext==="property"&&v.propertyType==="layout"&&!Hc(g))return[new It(v.key,v.value,'"feature-state" data expressions are not supported with layout properties.')];if(v.expressionContext==="filter"&&!Hc(g))return[new It(v.key,v.value,'"feature-state" data expressions are not supported with filters.')];if(v.expressionContext&&v.expressionContext.indexOf("cluster")===0){if(!jc(g,["zoom","feature-state"]))return[new It(v.key,v.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(v.expressionContext==="cluster-initial"&&!Hl(g))return[new It(v.key,v.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function bl(v){const h=v.key,g=v.value,x=jr(g);return x!=="string"?[new It(h,g,`color expected, ${x} found`)]:Zr.parse(String(g))?[]:[new It(h,g,`color expected, "${g}" found`)]}function Xc(v){const h=v.key,g=v.value,x=v.valueSpec,A=[];return Array.isArray(x.values)?x.values.indexOf(yn(g))===-1&&A.push(new It(h,g,`expected one of [${x.values.join(", ")}], ${JSON.stringify(g)} found`)):Object.keys(x.values).indexOf(yn(g))===-1&&A.push(new It(h,g,`expected one of [${Object.keys(x.values).join(", ")}], ${JSON.stringify(g)} found`)),A}function xl(v){return Fs(xo(v.value))?Zl(Os({},v,{expressionContext:"filter",valueSpec:{value:"boolean"}})):Us(v)}function Us(v){const h=v.value,g=v.key;if(jr(h)!=="array")return[new It(g,h,`array expected, ${jr(h)} found`)];const x=v.styleSpec;let A,k=[];if(h.length<1)return[new It(g,h,"filter array must have at least 1 element")];switch(k=k.concat(Xc({key:`${g}[0]`,value:h[0],valueSpec:x.filter_operator,style:v.style,styleSpec:v.styleSpec})),yn(h[0])){case"<":case"<=":case">":case">=":h.length>=2&&yn(h[1])==="$type"&&k.push(new It(g,h,`"$type" cannot be use with operator "${h[0]}"`));case"==":case"!=":h.length!==3&&k.push(new It(g,h,`filter array for operator "${h[0]}" must have 3 elements`));case"in":case"!in":h.length>=2&&(A=jr(h[1]),A!=="string"&&k.push(new It(`${g}[1]`,h[1],`string expected, ${A} found`)));for(let L=2;L<h.length;L++)A=jr(h[L]),yn(h[1])==="$type"?k=k.concat(Xc({key:`${g}[${L}]`,value:h[L],valueSpec:x.geometry_type,style:v.style,styleSpec:v.styleSpec})):A!=="string"&&A!=="number"&&A!=="boolean"&&k.push(new It(`${g}[${L}]`,h[L],`string, number, or boolean expected, ${A} found`));break;case"any":case"all":case"none":for(let L=1;L<h.length;L++)k=k.concat(Us({key:`${g}[${L}]`,value:h[L],style:v.style,styleSpec:v.styleSpec}));break;case"has":case"!has":A=jr(h[1]),h.length!==2?k.push(new It(g,h,`filter array for "${h[0]}" operator must have 2 elements`)):A!=="string"&&k.push(new It(`${g}[1]`,h[1],`string expected, ${A} found`))}return k}function ql(v,h){const g=v.key,x=v.validateSpec,A=v.style,k=v.styleSpec,L=v.value,z=v.objectKey,V=k[`${h}_${v.layerType}`];if(!V)return[];const X=z.match(/^(.*)-transition$/);if(h==="paint"&&X&&V[X[1]]&&V[X[1]].transition)return x({key:g,value:L,valueSpec:k.transition,style:A,styleSpec:k});const Z=v.valueSpec||V[z];if(!Z)return[new It(g,L,`unknown property "${z}"`)];let J;if(jr(L)==="string"&&ss(Z)&&!Z.tokens&&(J=/^{([^}]+)}$/.exec(L)))return[new It(g,L,`"${z}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(J[1])} }\`.`)];const oe=[];return v.layerType==="symbol"&&(z==="text-field"&&A&&!A.glyphs&&oe.push(new It(g,L,'use of "text-field" requires a style "glyphs" property')),z==="text-font"&&Dp(xo(L))&&yn(L.type)==="identity"&&oe.push(new It(g,L,'"text-font" does not support identity functions'))),oe.concat(x({key:v.key,value:L,valueSpec:Z,style:A,styleSpec:k,expressionContext:"property",propertyType:h,propertyKey:z}))}function Hs(v){return ql(v,"paint")}function pd(v){return ql(v,"layout")}function Ou(v){let h=[];const g=v.value,x=v.key,A=v.style,k=v.styleSpec;if(jr(g)!=="object")return[new It(x,g,`object expected, ${jr(g)} found`)];g.type||g.ref||h.push(new It(x,g,'either "type" or "ref" is required'));let L=yn(g.type);const z=yn(g.ref);if(g.id){const V=yn(g.id);for(let X=0;X<v.arrayIndex;X++){const Z=A.layers[X];yn(Z.id)===V&&h.push(new It(x,g.id,`duplicate layer id "${g.id}", previously used at line ${Z.id.__line__}`))}}if("ref"in g){let V;["type","source","source-layer","filter","layout"].forEach((X=>{X in g&&h.push(new It(x,g[X],`"${X}" is prohibited for ref layers`))})),A.layers.forEach((X=>{yn(X.id)===z&&(V=X)})),V?V.ref?h.push(new It(x,g.ref,"ref cannot reference another ref layer")):L=yn(V.type):h.push(new It(x,g.ref,`ref layer "${z}" not found`))}else if(L!=="background")if(g.source){const V=A.sources&&A.sources[g.source],X=V&&yn(V.type);V?X==="vector"&&L==="raster"?h.push(new It(x,g.source,`layer "${g.id}" requires a raster source`)):X!=="raster-dem"&&L==="hillshade"||X!=="raster-dem"&&L==="color-relief"?h.push(new It(x,g.source,`layer "${g.id}" requires a raster-dem source`)):X==="raster"&&L!=="raster"?h.push(new It(x,g.source,`layer "${g.id}" requires a vector source`)):X!=="vector"||g["source-layer"]?X==="raster-dem"&&L!=="hillshade"&&L!=="color-relief"?h.push(new It(x,g.source,"raster-dem source can only be used with layer type 'hillshade' or 'color-relief'.")):L!=="line"||!g.paint||!g.paint["line-gradient"]||X==="geojson"&&V.lineMetrics||h.push(new It(x,g,`layer "${g.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):h.push(new It(x,g,`layer "${g.id}" must specify a "source-layer"`)):h.push(new It(x,g.source,`source "${g.source}" not found`))}else h.push(new It(x,g,'missing required property "source"'));return h=h.concat(Uo({key:x,value:g,valueSpec:k.layer,style:v.style,styleSpec:v.styleSpec,validateSpec:v.validateSpec,objectElementValidators:{"*":()=>[],type:()=>v.validateSpec({key:`${x}.type`,value:g.type,valueSpec:k.layer.type,style:v.style,styleSpec:v.styleSpec,validateSpec:v.validateSpec,object:g,objectKey:"type"}),filter:xl,layout:V=>Uo({layer:g,key:V.key,value:V.value,style:V.style,styleSpec:V.styleSpec,validateSpec:V.validateSpec,objectElementValidators:{"*":X=>pd(Os({layerType:L},X))}}),paint:V=>Uo({layer:g,key:V.key,value:V.value,style:V.style,styleSpec:V.styleSpec,validateSpec:V.validateSpec,objectElementValidators:{"*":X=>Hs(Os({layerType:L},X))}})}})),h}function ls(v){const h=v.value,g=v.key,x=jr(h);return x!=="string"?[new It(g,h,`string expected, ${x} found`)]:[]}const gd={promoteId:function({key:v,value:h}){if(jr(h)==="string")return ls({key:v,value:h});{const g=[];for(const x in h)g.push(...ls({key:`${v}.${x}`,value:h[x]}));return g}}};function Nu(v){const h=v.value,g=v.key,x=v.styleSpec,A=v.style,k=v.validateSpec;if(!h.type)return[new It(g,h,'"type" is required')];const L=yn(h.type);let z;switch(L){case"vector":case"raster":return z=Uo({key:g,value:h,valueSpec:x[`source_${L.replace("-","_")}`],style:v.style,styleSpec:x,objectElementValidators:gd,validateSpec:k}),z;case"raster-dem":return z=(function(V){var X;const Z=(X=V.sourceName)!==null&&X!==void 0?X:"",J=V.value,oe=V.styleSpec,le=oe.source_raster_dem,ce=V.style;let ge=[];const be=jr(J);if(J===void 0)return ge;if(be!=="object")return ge.push(new It("source_raster_dem",J,`object expected, ${be} found`)),ge;const Ee=yn(J.encoding)==="custom",qe=["redFactor","greenFactor","blueFactor","baseShift"],Oe=V.value.encoding?`"${V.value.encoding}"`:"Default";for(const Ve in J)!Ee&&qe.includes(Ve)?ge.push(new It(Ve,J[Ve],`In "${Z}": "${Ve}" is only valid when "encoding" is set to "custom". ${Oe} encoding found`)):le[Ve]?ge=ge.concat(V.validateSpec({key:Ve,value:J[Ve],valueSpec:le[Ve],validateSpec:V.validateSpec,style:ce,styleSpec:oe})):ge.push(new It(Ve,J[Ve],`unknown property "${Ve}"`));return ge})({sourceName:g,value:h,style:v.style,styleSpec:x,validateSpec:k}),z;case"geojson":if(z=Uo({key:g,value:h,valueSpec:x.source_geojson,style:A,styleSpec:x,validateSpec:k,objectElementValidators:gd}),h.cluster)for(const V in h.clusterProperties){const[X,Z]=h.clusterProperties[V],J=typeof X=="string"?[X,["accumulated"],["get",V]]:X;z.push(...Zl({key:`${g}.${V}.map`,value:Z,expressionContext:"cluster-map"})),z.push(...Zl({key:`${g}.${V}.reduce`,value:J,expressionContext:"cluster-reduce"}))}return z;case"video":return Uo({key:g,value:h,valueSpec:x.source_video,style:A,validateSpec:k,styleSpec:x});case"image":return Uo({key:g,value:h,valueSpec:x.source_image,style:A,validateSpec:k,styleSpec:x});case"canvas":return[new It(g,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Xc({key:`${g}.type`,value:h.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]}})}}function ya(v){const h=v.value,g=v.styleSpec,x=g.light,A=v.style;let k=[];const L=jr(h);if(h===void 0)return k;if(L!=="object")return k=k.concat([new It("light",h,`object expected, ${L} found`)]),k;for(const z in h){const V=z.match(/^(.*)-transition$/);k=k.concat(V&&x[V[1]]&&x[V[1]].transition?v.validateSpec({key:z,value:h[z],valueSpec:g.transition,validateSpec:v.validateSpec,style:A,styleSpec:g}):x[z]?v.validateSpec({key:z,value:h[z],valueSpec:x[z],validateSpec:v.validateSpec,style:A,styleSpec:g}):[new It(z,h[z],`unknown property "${z}"`)])}return k}function vd(v){const h=v.value,g=v.styleSpec,x=g.sky,A=v.style,k=jr(h);if(h===void 0)return[];if(k!=="object")return[new It("sky",h,`object expected, ${k} found`)];let L=[];for(const z in h)L=L.concat(x[z]?v.validateSpec({key:z,value:h[z],valueSpec:x[z],style:A,styleSpec:g}):[new It(z,h[z],`unknown property "${z}"`)]);return L}function wv(v){const h=v.value,g=v.styleSpec,x=g.terrain,A=v.style;let k=[];const L=jr(h);if(h===void 0)return k;if(L!=="object")return k=k.concat([new It("terrain",h,`object expected, ${L} found`)]),k;for(const z in h)k=k.concat(x[z]?v.validateSpec({key:z,value:h[z],valueSpec:x[z],validateSpec:v.validateSpec,style:A,styleSpec:g}):[new It(z,h[z],`unknown property "${z}"`)]);return k}function qh(v){let h=[];const g=v.value,x=v.key;if(Array.isArray(g)){const A=[],k=[];for(const L in g)g[L].id&&A.includes(g[L].id)&&h.push(new It(x,g,`all the sprites' ids must be unique, but ${g[L].id} is duplicated`)),A.push(g[L].id),g[L].url&&k.includes(g[L].url)&&h.push(new It(x,g,`all the sprites' URLs must be unique, but ${g[L].url} is duplicated`)),k.push(g[L].url),h=h.concat(Uo({key:`${x}[${L}]`,value:g[L],valueSpec:{id:{type:"string",required:!0},url:{type:"string",required:!0}},validateSpec:v.validateSpec}));return h}return ls({key:x,value:g})}function Yh(v){return h=v.value,h&&h.constructor===Object?[]:[new It(v.key,v.value,`object expected, ${jr(v.value)} found`)];var h}const wo={"*":()=>[],array:Lp,boolean:function(v){const h=v.value,g=v.key,x=jr(h);return x!=="boolean"?[new It(g,h,`boolean expected, ${x} found`)]:[]},number:Gl,color:bl,constants:Vo,enum:Xc,filter:xl,function:Xl,layer:Ou,object:Uo,source:Nu,light:ya,sky:vd,terrain:wv,projection:function(v){const h=v.value,g=v.styleSpec,x=g.projection,A=v.style,k=jr(h);if(h===void 0)return[];if(k!=="object")return[new It("projection",h,`object expected, ${k} found`)];let L=[];for(const z in h)L=L.concat(x[z]?v.validateSpec({key:z,value:h[z],valueSpec:x[z],style:A,styleSpec:g}):[new It(z,h[z],`unknown property "${z}"`)]);return L},projectionDefinition:function(v){const h=v.key;let g=v.value;g=g instanceof String?g.valueOf():g;const x=jr(g);return x!=="array"||(function(A){return Array.isArray(A)&&A.length===3&&typeof A[0]=="string"&&typeof A[1]=="string"&&typeof A[2]=="number"})(g)||(function(A){return!!["interpolate","step","literal"].includes(A[0])})(g)?["array","string"].includes(x)?[]:[new It(h,g,`projection expected, invalid type "${x}" found`)]:[new It(h,g,`projection expected, invalid array ${JSON.stringify(g)} found`)]},string:ls,formatted:function(v){return ls(v).length===0?[]:Zl(v)},resolvedImage:function(v){return ls(v).length===0?[]:Zl(v)},padding:function(v){const h=v.key,g=v.value;if(jr(g)==="array"){if(g.length<1||g.length>4)return[new It(h,g,`padding requires 1 to 4 values; ${g.length} values found`)];const x={type:"number"};let A=[];for(let k=0;k<g.length;k++)A=A.concat(v.validateSpec({key:`${h}[${k}]`,value:g[k],validateSpec:v.validateSpec,valueSpec:x}));return A}return Gl({key:h,value:g,valueSpec:{}})},numberArray:function(v){const h=v.key,g=v.value;if(jr(g)==="array"){const x={type:"number"};if(g.length<1)return[new It(h,g,"array length at least 1 expected, length 0 found")];let A=[];for(let k=0;k<g.length;k++)A=A.concat(v.validateSpec({key:`${h}[${k}]`,value:g[k],validateSpec:v.validateSpec,valueSpec:x}));return A}return Gl({key:h,value:g,valueSpec:{}})},colorArray:function(v){const h=v.key,g=v.value;if(jr(g)==="array"){if(g.length<1)return[new It(h,g,"array length at least 1 expected, length 0 found")];let x=[];for(let A=0;A<g.length;A++)x=x.concat(bl({key:`${h}[${A}]`,value:g[A]}));return x}return bl({key:h,value:g})},variableAnchorOffsetCollection:function(v){const h=v.key,g=v.value,x=jr(g),A=v.styleSpec;if(x!=="array"||g.length<1||g.length%2!=0)return[new It(h,g,"variableAnchorOffsetCollection requires a non-empty array of even length")];let k=[];for(let L=0;L<g.length;L+=2)k=k.concat(Xc({key:`${h}[${L}]`,value:g[L],valueSpec:A.layout_symbol["text-anchor"]})),k=k.concat(Lp({key:`${h}[${L+1}]`,value:g[L+1],valueSpec:{length:2,value:"number"},validateSpec:v.validateSpec,style:v.style,styleSpec:A}));return k},sprite:qh,state:Yh};function Yi(v){const h=v.value,g=v.valueSpec,x=v.styleSpec;return v.validateSpec=Yi,g.expression&&Dp(yn(h))?Xl(v):g.expression&&Xh(xo(h))?Zl(v):g.type&&wo[g.type]?wo[g.type](v):Uo(Os({},v,{valueSpec:g.type?x[g.type]:g}))}function md(v){const h=v.value,g=v.key,x=ls(v);return x.length||(h.indexOf("{fontstack}")===-1&&x.push(new It(g,h,'"glyphs" url must include a "{fontstack}" token')),h.indexOf("{range}")===-1&&x.push(new It(g,h,'"glyphs" url must include a "{range}" token'))),x}function Fa(v,h=Qe){let g=[];return g=g.concat(Yi({key:"",value:v,valueSpec:h.$root,styleSpec:h,style:v,validateSpec:Yi,objectElementValidators:{glyphs:md,"*":()=>[]}})),v.constants&&(g=g.concat(Vo({key:"constants",value:v.constants}))),Bu(g)}function ro(v){return function(h){return v(Object.assign({},h,{validateSpec:Yi}))}}function Bu(v){return[].concat(v).sort(((h,g)=>h.line-g.line))}function Ea(v){return function(...h){return Bu(v.apply(this,h))}}Fa.source=Ea(ro(Nu)),Fa.sprite=Ea(ro(qh)),Fa.glyphs=Ea(ro(md)),Fa.light=Ea(ro(ya)),Fa.sky=Ea(ro(vd)),Fa.terrain=Ea(ro(wv)),Fa.state=Ea(ro(Yh)),Fa.layer=Ea(ro(Ou)),Fa.filter=Ea(ro(xl)),Fa.paintProperty=Ea(ro(Hs)),Fa.layoutProperty=Ea(ro(pd));const Ho=Fa,Mb=Ho.light,Op=Ho.sky,Eb=Ho.paintProperty,Kh=Ho.layoutProperty;function zu(v,h){let g=!1;if(h&&h.length)for(const x of h)v.fire(new rr(new Error(x.message))),g=!0;return g}class Zc{constructor(h,g,x){const A=this.cells=[];if(h instanceof ArrayBuffer){this.arrayBuffer=h;const L=new Int32Array(this.arrayBuffer);h=L[0],this.d=(g=L[1])+2*(x=L[2]);for(let V=0;V<this.d*this.d;V++){const X=L[3+V],Z=L[3+V+1];A.push(X===Z?null:L.subarray(X,Z))}const z=L[3+A.length+1];this.keys=L.subarray(L[3+A.length],z),this.bboxes=L.subarray(z),this.insert=this._insertReadonly}else{this.d=g+2*x;for(let L=0;L<this.d*this.d;L++)A.push([]);this.keys=[],this.bboxes=[]}this.n=g,this.extent=h,this.padding=x,this.scale=g/h,this.uid=0;const k=x/g*h;this.min=-k,this.max=h+k}insert(h,g,x,A,k){this._forEachCell(g,x,A,k,this._insertCell,this.uid++,void 0,void 0),this.keys.push(h),this.bboxes.push(g),this.bboxes.push(x),this.bboxes.push(A),this.bboxes.push(k)}_insertReadonly(){throw new Error("Cannot insert into a GridIndex created from an ArrayBuffer.")}_insertCell(h,g,x,A,k,L){this.cells[k].push(L)}query(h,g,x,A,k){const L=this.min,z=this.max;if(h<=L&&g<=L&&z<=x&&z<=A&&!k)return Array.prototype.slice.call(this.keys);{const V=[];return this._forEachCell(h,g,x,A,this._queryCell,V,{},k),V}}_queryCell(h,g,x,A,k,L,z,V){const X=this.cells[k];if(X!==null){const Z=this.keys,J=this.bboxes;for(let oe=0;oe<X.length;oe++){const le=X[oe];if(z[le]===void 0){const ce=4*le;(V?V(J[ce+0],J[ce+1],J[ce+2],J[ce+3]):h<=J[ce+2]&&g<=J[ce+3]&&x>=J[ce+0]&&A>=J[ce+1])?(z[le]=!0,L.push(Z[le])):z[le]=!1}}}}_forEachCell(h,g,x,A,k,L,z,V){const X=this._convertToCellCoord(h),Z=this._convertToCellCoord(g),J=this._convertToCellCoord(x),oe=this._convertToCellCoord(A);for(let le=X;le<=J;le++)for(let ce=Z;ce<=oe;ce++){const ge=this.d*ce+le;if((!V||V(this._convertFromCellCoord(le),this._convertFromCellCoord(ce),this._convertFromCellCoord(le+1),this._convertFromCellCoord(ce+1)))&&k.call(this,h,g,x,A,ge,L,z,V))return}}_convertFromCellCoord(h){return(h-this.padding)/this.scale}_convertToCellCoord(h){return Math.max(0,Math.min(this.d-1,Math.floor(h*this.scale)+this.padding))}toArrayBuffer(){if(this.arrayBuffer)return this.arrayBuffer;const h=this.cells,g=3+this.cells.length+1+1;let x=0;for(let L=0;L<this.cells.length;L++)x+=this.cells[L].length;const A=new Int32Array(g+x+this.keys.length+this.bboxes.length);A[0]=this.extent,A[1]=this.n,A[2]=this.padding;let k=g;for(let L=0;L<h.length;L++){const z=h[L];A[3+L]=k,A.set(z,k),k+=z.length}return A[3+h.length]=k,A.set(this.keys,k),k+=this.keys.length,A[3+h.length+1]=k,A.set(this.bboxes,k),k+=this.bboxes.length,A.buffer}static serialize(h,g){const x=h.toArrayBuffer();return g&&g.push(x),{buffer:x}}static deserialize(h){return new Zc(h.buffer)}}const us={};function Zt(v,h,g={}){if(us[v])throw new Error(`${v} is already registered.`);Object.defineProperty(h,"_classRegistryKey",{value:v,writeable:!1}),us[v]={klass:h,omit:g.omit||[],shallow:g.shallow||[]}}Zt("Object",Object),Zt("Set",Set),Zt("TransferableGridIndex",Zc),Zt("Color",Zr),Zt("Error",Error),Zt("AJAXError",Be),Zt("ResolvedImage",Qa),Zt("StylePropertyFunction",Wc),Zt("StyleExpression",kp,{omit:["_evaluator"]}),Zt("ZoomDependentExpression",$l),Zt("ZoomConstantExpression",to),Zt("CompoundExpression",No,{omit:["_evaluate"]});for(const v in Gh)Gh[v]._classRegistryKey||Zt(`Expression_${v}`,Gh[v]);function qc(v){return v&&typeof ArrayBuffer<"u"&&(v instanceof ArrayBuffer||v.constructor&&v.constructor.name==="ArrayBuffer")}function yd(v){return v.$name||v.constructor._classRegistryKey}function Fu(v){return!(function(h){if(h===null||typeof h!="object")return!1;const g=yd(h);return!(!g||g==="Object")})(v)&&(v==null||typeof v=="boolean"||typeof v=="number"||typeof v=="string"||v instanceof Boolean||v instanceof Number||v instanceof String||v instanceof Date||v instanceof RegExp||v instanceof Blob||v instanceof Error||qc(v)||Li(v)||ArrayBuffer.isView(v)||v instanceof ImageData)}function Vu(v,h){if(Fu(v))return(qc(v)||Li(v))&&h&&h.push(v),ArrayBuffer.isView(v)&&h&&h.push(v.buffer),v instanceof ImageData&&h&&h.push(v.data.buffer),v;if(Array.isArray(v)){const k=[];for(const L of v)k.push(Vu(L,h));return k}if(typeof v!="object")throw new Error("can't serialize object of type "+typeof v);const g=yd(v);if(!g)throw new Error(`can't serialize object of unregistered class ${v.constructor.name}`);if(!us[g])throw new Error(`${g} is not registered.`);const{klass:x}=us[g],A=x.serialize?x.serialize(v,h):{};if(x.serialize){if(h&&A===h[h.length-1])throw new Error("statically serialized object won't survive transfer of $name property")}else{for(const k in v){if(!v.hasOwnProperty(k)||us[g].omit.indexOf(k)>=0)continue;const L=v[k];A[k]=us[g].shallow.indexOf(k)>=0?L:Vu(L,h)}v instanceof Error&&(A.message=v.message)}if(A.$name)throw new Error("$name property is reserved for worker serialization logic.");return g!=="Object"&&(A.$name=g),A}function Uu(v){if(Fu(v))return v;if(Array.isArray(v))return v.map(Uu);if(typeof v!="object")throw new Error("can't deserialize object of type "+typeof v);const h=yd(v)||"Object";if(!us[h])throw new Error(`can't deserialize unregistered class ${h}`);const{klass:g}=us[h];if(!g)throw new Error(`can't deserialize unregistered class ${h}`);if(g.deserialize)return g.deserialize(v);const x=Object.create(g.prototype);for(const A of Object.keys(v)){if(A==="$name")continue;const k=v[A];x[A]=us[h].shallow.indexOf(A)>=0?k:Uu(k)}return x}class Yc{constructor(){this.first=!0}update(h,g){const x=Math.floor(h);return this.first?(this.first=!1,this.lastIntegerZoom=x,this.lastIntegerZoomTime=0,this.lastZoom=h,this.lastFloorZoom=x,!0):(this.lastFloorZoom>x?(this.lastIntegerZoom=x+1,this.lastIntegerZoomTime=g):this.lastFloorZoom<x&&(this.lastIntegerZoom=x,this.lastIntegerZoomTime=g),h!==this.lastZoom&&(this.lastZoom=h,this.lastFloorZoom=x,!0))}}const zr={"Latin-1 Supplement":v=>v>=128&&v<=255,"Hangul Jamo":v=>v>=4352&&v<=4607,Khmer:v=>v>=6016&&v<=6143,"General Punctuation":v=>v>=8192&&v<=8303,"Letterlike Symbols":v=>v>=8448&&v<=8527,"Number Forms":v=>v>=8528&&v<=8591,"Miscellaneous Technical":v=>v>=8960&&v<=9215,"Control Pictures":v=>v>=9216&&v<=9279,"Optical Character Recognition":v=>v>=9280&&v<=9311,"Enclosed Alphanumerics":v=>v>=9312&&v<=9471,"Geometric Shapes":v=>v>=9632&&v<=9727,"Miscellaneous Symbols":v=>v>=9728&&v<=9983,"Miscellaneous Symbols and Arrows":v=>v>=11008&&v<=11263,"Ideographic Description Characters":v=>v>=12272&&v<=12287,"CJK Symbols and Punctuation":v=>v>=12288&&v<=12351,Hiragana:v=>v>=12352&&v<=12447,Katakana:v=>v>=12448&&v<=12543,Kanbun:v=>v>=12688&&v<=12703,"CJK Strokes":v=>v>=12736&&v<=12783,"Enclosed CJK Letters and Months":v=>v>=12800&&v<=13055,"CJK Compatibility":v=>v>=13056&&v<=13311,"Yijing Hexagram Symbols":v=>v>=19904&&v<=19967,"CJK Unified Ideographs":v=>v>=19968&&v<=40959,"Hangul Syllables":v=>v>=44032&&v<=55215,"Private Use Area":v=>v>=57344&&v<=63743,"Vertical Forms":v=>v>=65040&&v<=65055,"CJK Compatibility Forms":v=>v>=65072&&v<=65103,"Small Form Variants":v=>v>=65104&&v<=65135,"Halfwidth and Fullwidth Forms":v=>v>=65280&&v<=65519};function wl(v){for(const h of v)if(ju(h.charCodeAt(0)))return!0;return!1}function Sv(v){for(const h of v)if(!Qh(h.charCodeAt(0)))return!1;return!0}function _d(v){const h=v.map((g=>{try{return new RegExp(`\\p{sc=${g}}`,"u").source}catch{return null}})).filter((g=>g));return new RegExp(h.join("|"),"u")}const Hu=_d(["Arab","Dupl","Mong","Ougr","Syrc"]);function Qh(v){return!Hu.test(String.fromCodePoint(v))}const bd=_d(["Bopo","Hani","Hira","Kana","Kits","Nshu","Tang","Yiii"]);function ju(v){return!(v!==746&&v!==747&&(v<4352||!(zr["CJK Compatibility Forms"](v)&&!(v>=65097&&v<=65103)||zr["CJK Compatibility"](v)||zr["CJK Strokes"](v)||!(!zr["CJK Symbols and Punctuation"](v)||v>=12296&&v<=12305||v>=12308&&v<=12319||v===12336)||zr["Enclosed CJK Letters and Months"](v)||zr["Ideographic Description Characters"](v)||zr.Kanbun(v)||zr.Katakana(v)&&v!==12540||!(!zr["Halfwidth and Fullwidth Forms"](v)||v===65288||v===65289||v===65293||v>=65306&&v<=65310||v===65339||v===65341||v===65343||v>=65371&&v<=65503||v===65507||v>=65512&&v<=65519)||!(!zr["Small Form Variants"](v)||v>=65112&&v<=65118||v>=65123&&v<=65126)||zr["Vertical Forms"](v)||zr["Yijing Hexagram Symbols"](v)||new RegExp("\\p{sc=Cans}","u").test(String.fromCodePoint(v))||new RegExp("\\p{sc=Hang}","u").test(String.fromCodePoint(v))||bd.test(String.fromCodePoint(v)))))}function xd(v){return!(ju(v)||(function(h){return!!(zr["Latin-1 Supplement"](h)&&(h===167||h===169||h===174||h===177||h===188||h===189||h===190||h===215||h===247)||zr["General Punctuation"](h)&&(h===8214||h===8224||h===8225||h===8240||h===8241||h===8251||h===8252||h===8258||h===8263||h===8264||h===8265||h===8273)||zr["Letterlike Symbols"](h)||zr["Number Forms"](h)||zr["Miscellaneous Technical"](h)&&(h>=8960&&h<=8967||h>=8972&&h<=8991||h>=8996&&h<=9e3||h===9003||h>=9085&&h<=9114||h>=9150&&h<=9165||h===9167||h>=9169&&h<=9179||h>=9186&&h<=9215)||zr["Control Pictures"](h)&&h!==9251||zr["Optical Character Recognition"](h)||zr["Enclosed Alphanumerics"](h)||zr["Geometric Shapes"](h)||zr["Miscellaneous Symbols"](h)&&!(h>=9754&&h<=9759)||zr["Miscellaneous Symbols and Arrows"](h)&&(h>=11026&&h<=11055||h>=11088&&h<=11097||h>=11192&&h<=11243)||zr["CJK Symbols and Punctuation"](h)||zr.Katakana(h)||zr["Private Use Area"](h)||zr["CJK Compatibility Forms"](h)||zr["Small Form Variants"](h)||zr["Halfwidth and Fullwidth Forms"](h)||h===8734||h===8756||h===8757||h>=9984&&h<=10087||h>=10102&&h<=10131||h===65532||h===65533)})(v))}const Tv=_d(["Adlm","Arab","Armi","Avst","Chrs","Cprt","Egyp","Elym","Gara","Hatr","Hebr","Hung","Khar","Lydi","Mand","Mani","Mend","Merc","Mero","Narb","Nbat","Nkoo","Orkh","Palm","Phli","Phlp","Phnx","Prti","Rohg","Samr","Sarb","Sogo","Syrc","Thaa","Todr","Yezi"]);function $u(v){return Tv.test(String.fromCodePoint(v))}function Av(v,h){return!(!h&&$u(v)||v>=2304&&v<=3583||v>=3840&&v<=4255||zr.Khmer(v))}function Yl(v){for(const h of v)if($u(h.charCodeAt(0)))return!0;return!1}const Sl=new class{constructor(){this.TIMEOUT=5e3,this.applyArabicShaping=null,this.processBidirectionalText=null,this.processStyledBidirectionalText=null,this.pluginStatus="unavailable",this.pluginURL=null,this.loadScriptResolve=()=>{}}setState(v){this.pluginStatus=v.pluginStatus,this.pluginURL=v.pluginURL}getState(){return{pluginStatus:this.pluginStatus,pluginURL:this.pluginURL}}setMethods(v){if(Sl.isParsed())throw new Error("RTL text plugin already registered.");this.applyArabicShaping=v.applyArabicShaping,this.processBidirectionalText=v.processBidirectionalText,this.processStyledBidirectionalText=v.processStyledBidirectionalText,this.loadScriptResolve()}isParsed(){return this.applyArabicShaping!=null&&this.processBidirectionalText!=null&&this.processStyledBidirectionalText!=null}getRTLTextPluginStatus(){return this.pluginStatus}syncState(v,h){return o(this,void 0,void 0,(function*(){if(this.isParsed())return this.getState();if(v.pluginStatus!=="loading")return this.setState(v),v;const g=v.pluginURL,x=new Promise((k=>{this.loadScriptResolve=k}));h(g);const A=new Promise((k=>setTimeout((()=>k()),this.TIMEOUT)));if(yield Promise.race([x,A]),this.isParsed()){const k={pluginStatus:"loaded",pluginURL:g};return this.setState(k),k}throw this.setState({pluginStatus:"error",pluginURL:""}),new Error(`RTL Text Plugin failed to import scripts from ${g}`)}))}};class Ni{constructor(h,g){this.isSupportedScript=Kl,this.zoom=h,g?(this.now=g.now||0,this.fadeDuration=g.fadeDuration||0,this.zoomHistory=g.zoomHistory||new Yc,this.transition=g.transition||{}):(this.now=0,this.fadeDuration=0,this.zoomHistory=new Yc,this.transition={})}crossFadingFactor(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const h=this.zoom,g=h-Math.floor(h),x=this.crossFadingFactor();return h>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:g+(1-g)*x}:{fromScale:.5,toScale:1,t:1-(1-x)*g}}}function Kl(v){return(function(h,g){for(const x of h)if(!Av(x.charCodeAt(0),g))return!1;return!0})(v,Sl.getRTLTextPluginStatus()==="loaded")}class cs{constructor(h,g,x){this.property=h,this.value=g,this.expression=(function(A,k,L){if(Dp(A))return new Wc(A,k);if(Xh(A)){const z=ku(A,k,L);if(z.result==="error")throw new Error(z.value.map((V=>`${V.key}: ${V.message}`)).join(", "));return z.value}{let z=A;return k.type==="color"&&typeof A=="string"?z=Zr.parse(A):k.type!=="padding"||typeof A!="number"&&!Array.isArray(A)?k.type!=="numberArray"||typeof A!="number"&&!Array.isArray(A)?k.type!=="colorArray"||typeof A!="string"&&!Array.isArray(A)?k.type==="variableAnchorOffsetCollection"&&Array.isArray(A)?z=En.parse(A):k.type==="projectionDefinition"&&typeof A=="string"&&(z=pa.parse(A)):z=ia.parse(A):z=ra.parse(A):z=Rn.parse(A),{globalStateRefs:new Set,_globalState:null,kind:"constant",evaluate:()=>z}}})(g===void 0?h.specification.default:g,h.specification,x)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}getGlobalStateRefs(){return this.expression.globalStateRefs||new Set}possiblyEvaluate(h,g,x){return this.property.possiblyEvaluate(this,h,g,x)}}class Wu{constructor(h,g){this.property=h,this.value=new cs(h,void 0,g)}transitioned(h,g){return new Kc(this.property,this.value,g,Kt({},h.transition,this.transition),h.now)}untransitioned(){return new Kc(this.property,this.value,null,{},0)}}class wd{constructor(h,g){this._properties=h,this._values=Object.create(h.defaultTransitionablePropertyValues),this._globalState=g}getValue(h){return Jt(this._values[h].value.value)}setValue(h,g){Object.prototype.hasOwnProperty.call(this._values,h)||(this._values[h]=new Wu(this._values[h].property,this._globalState)),this._values[h].value=new cs(this._values[h].property,g===null?void 0:Jt(g),this._globalState)}getTransition(h){return Jt(this._values[h].transition)}setTransition(h,g){Object.prototype.hasOwnProperty.call(this._values,h)||(this._values[h]=new Wu(this._values[h].property,this._globalState)),this._values[h].transition=Jt(g)||void 0}serialize(){const h={};for(const g of Object.keys(this._values)){const x=this.getValue(g);x!==void 0&&(h[g]=x);const A=this.getTransition(g);A!==void 0&&(h[`${g}-transition`]=A)}return h}transitioned(h,g){const x=new Jh(this._properties);for(const A of Object.keys(this._values))x._values[A]=this._values[A].transitioned(h,g._values[A]);return x}untransitioned(){const h=new Jh(this._properties);for(const g of Object.keys(this._values))h._values[g]=this._values[g].untransitioned();return h}}class Kc{constructor(h,g,x,A,k){this.property=h,this.value=g,this.begin=k+A.delay||0,this.end=this.begin+A.duration||0,h.specification.transition&&(A.delay||A.duration)&&(this.prior=x)}possiblyEvaluate(h,g,x){const A=h.now||0,k=this.value.possiblyEvaluate(h,g,x),L=this.prior;if(L){if(A>this.end)return this.prior=null,k;if(this.value.isDataDriven())return this.prior=null,k;if(A<this.begin)return L.possiblyEvaluate(h,g,x);{const z=(A-this.begin)/(this.end-this.begin);return this.property.interpolate(L.possiblyEvaluate(h,g,x),k,pt(z))}}return k}}class Jh{constructor(h){this._properties=h,this._values=Object.create(h.defaultTransitioningPropertyValues)}possiblyEvaluate(h,g,x){const A=new Sd(this._properties);for(const k of Object.keys(this._values))A._values[k]=this._values[k].possiblyEvaluate(h,g,x);return A}hasTransition(){for(const h of Object.keys(this._values))if(this._values[h].prior)return!0;return!1}}class Qc{constructor(h,g){this._properties=h,this._values=Object.create(h.defaultPropertyValues),this._globalState=g}hasValue(h){return this._values[h].value!==void 0}getValue(h){return Jt(this._values[h].value)}setValue(h,g){this._values[h]=new cs(this._values[h].property,g===null?void 0:Jt(g),this._globalState)}serialize(){const h={};for(const g of Object.keys(this._values)){const x=this.getValue(g);x!==void 0&&(h[g]=x)}return h}possiblyEvaluate(h,g,x){const A=new Sd(this._properties);for(const k of Object.keys(this._values))A._values[k]=this._values[k].possiblyEvaluate(h,g,x);return A}}class js{constructor(h,g,x){this.property=h,this.value=g,this.parameters=x}isConstant(){return this.value.kind==="constant"}constantOr(h){return this.value.kind==="constant"?this.value.value:h}evaluate(h,g,x,A){return this.property.evaluate(this.value,this.parameters,h,g,x,A)}}class Sd{constructor(h){this._properties=h,this._values=Object.create(h.defaultPossiblyEvaluatedValues)}get(h){return this._values[h]}}class tr{constructor(h){this.specification=h}possiblyEvaluate(h,g){if(h.isDataDriven())throw new Error("Value should not be data driven");return h.expression.evaluate(g)}interpolate(h,g,x){const A=as[this.specification.type];return A?A(h,g,x):h}}class gr{constructor(h,g){this.specification=h,this.overrides=g}possiblyEvaluate(h,g,x,A){return new js(this,h.expression.kind==="constant"||h.expression.kind==="camera"?{kind:"constant",value:h.expression.evaluate(g,null,{},x,A)}:h.expression,g)}interpolate(h,g,x){if(h.value.kind!=="constant"||g.value.kind!=="constant")return h;if(h.value.value===void 0||g.value.value===void 0)return new js(this,{kind:"constant",value:void 0},h.parameters);const A=as[this.specification.type];if(A){const k=A(h.value.value,g.value.value,x);return new js(this,{kind:"constant",value:k},h.parameters)}return h}evaluate(h,g,x,A,k,L){return h.kind==="constant"?h.value:h.evaluate(g,x,A,k,L)}}class Jc extends gr{possiblyEvaluate(h,g,x,A){if(h.value===void 0)return new js(this,{kind:"constant",value:void 0},g);if(h.expression.kind==="constant"){const k=h.expression.evaluate(g,null,{},x,A),L=h.property.specification.type==="resolvedImage"&&typeof k!="string"?k.name:k,z=this._calculate(L,L,L,g);return new js(this,{kind:"constant",value:z},g)}if(h.expression.kind==="camera"){const k=this._calculate(h.expression.evaluate({zoom:g.zoom-1}),h.expression.evaluate({zoom:g.zoom}),h.expression.evaluate({zoom:g.zoom+1}),g);return new js(this,{kind:"constant",value:k},g)}return new js(this,h.expression,g)}evaluate(h,g,x,A,k,L){if(h.kind==="source"){const z=h.evaluate(g,x,A,k,L);return this._calculate(z,z,z,g)}return h.kind==="composite"?this._calculate(h.evaluate({zoom:Math.floor(g.zoom)-1},x,A),h.evaluate({zoom:Math.floor(g.zoom)},x,A),h.evaluate({zoom:Math.floor(g.zoom)+1},x,A),g):h.value}_calculate(h,g,x,A){return A.zoom>A.zoomHistory.lastIntegerZoom?{from:h,to:g}:{from:x,to:g}}interpolate(h){return h}}class Np{constructor(h){this.specification=h}possiblyEvaluate(h,g,x,A){if(h.value!==void 0){if(h.expression.kind==="constant"){const k=h.expression.evaluate(g,null,{},x,A);return this._calculate(k,k,k,g)}return this._calculate(h.expression.evaluate(new Ni(Math.floor(g.zoom-1),g)),h.expression.evaluate(new Ni(Math.floor(g.zoom),g)),h.expression.evaluate(new Ni(Math.floor(g.zoom+1),g)),g)}}_calculate(h,g,x,A){return A.zoom>A.zoomHistory.lastIntegerZoom?{from:h,to:g}:{from:x,to:g}}interpolate(h){return h}}class ef{constructor(h){this.specification=h}possiblyEvaluate(h,g,x,A){return!!h.expression.evaluate(g,null,{},x,A)}interpolate(){return!1}}class Ki{constructor(h){this.properties=h,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const g in h){const x=h[g];x.specification.overridable&&this.overridableProperties.push(g);const A=this.defaultPropertyValues[g]=new cs(x,void 0,void 0),k=this.defaultTransitionablePropertyValues[g]=new Wu(x,void 0);this.defaultTransitioningPropertyValues[g]=k.untransitioned(),this.defaultPossiblyEvaluatedValues[g]=A.possiblyEvaluate({})}}}Zt("DataDrivenProperty",gr),Zt("DataConstantProperty",tr),Zt("CrossFadedDataDrivenProperty",Jc),Zt("CrossFadedProperty",Np),Zt("ColorRampProperty",ef);const jo="-transition";class _a extends pr{constructor(h,g,x){if(super(),this.id=h.id,this.type=h.type,this._globalState=x,this._featureFilter={filter:()=>!0,needGeometry:!1,getGlobalStateRefs:()=>new Set},h.type!=="custom"&&(this.metadata=h.metadata,this.minzoom=h.minzoom,this.maxzoom=h.maxzoom,h.type!=="background"&&(this.source=h.source,this.sourceLayer=h["source-layer"],this.filter=h.filter,this._featureFilter=bo(h.filter,x)),g.layout&&(this._unevaluatedLayout=new Qc(g.layout,x)),g.paint)){this._transitionablePaint=new wd(g.paint,x);for(const A in h.paint)this.setPaintProperty(A,h.paint[A],{validate:!1});for(const A in h.layout)this.setLayoutProperty(A,h.layout[A],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new Sd(g.paint)}}setFilter(h){this.filter=h,this._featureFilter=bo(h,this._globalState)}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(h){return h==="visibility"?this.visibility:this._unevaluatedLayout.getValue(h)}getLayoutAffectingGlobalStateRefs(){const h=new Set;if(this._unevaluatedLayout)for(const g in this._unevaluatedLayout._values){const x=this._unevaluatedLayout._values[g];for(const A of x.getGlobalStateRefs())h.add(A)}for(const g of this._featureFilter.getGlobalStateRefs())h.add(g);return h}getPaintAffectingGlobalStateRefs(){var h;const g=new globalThis.Map;if(this._transitionablePaint)for(const x in this._transitionablePaint._values){const A=this._transitionablePaint._values[x].value;for(const k of A.getGlobalStateRefs()){const L=(h=g.get(k))!==null&&h!==void 0?h:[];L.push({name:x,value:A.value}),g.set(k,L)}}return g}setLayoutProperty(h,g,x={}){g!=null&&this._validate(Kh,`layers.${this.id}.layout.${h}`,h,g,x)||(h!=="visibility"?this._unevaluatedLayout.setValue(h,g):this.visibility=g)}getPaintProperty(h){return h.endsWith(jo)?this._transitionablePaint.getTransition(h.slice(0,-11)):this._transitionablePaint.getValue(h)}setPaintProperty(h,g,x={}){if(g!=null&&this._validate(Eb,`layers.${this.id}.paint.${h}`,h,g,x))return!1;if(h.endsWith(jo))return this._transitionablePaint.setTransition(h.slice(0,-11),g||void 0),!1;{const A=this._transitionablePaint._values[h],k=A.property.specification["property-type"]==="cross-faded-data-driven",L=A.value.isDataDriven(),z=A.value;this._transitionablePaint.setValue(h,g),this._handleSpecialPaintPropertyUpdate(h);const V=this._transitionablePaint._values[h].value;return V.isDataDriven()||L||k||this._handleOverridablePaintPropertyUpdate(h,z,V)}}_handleSpecialPaintPropertyUpdate(h){}_handleOverridablePaintPropertyUpdate(h,g,x){return!1}isHidden(h){return!!(this.minzoom&&h<this.minzoom)||!!(this.maxzoom&&h>=this.maxzoom)||this.visibility==="none"}updateTransitions(h){this._transitioningPaint=this._transitionablePaint.transitioned(h,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(h,g){h.getCrossfadeParameters&&(this._crossfadeParameters=h.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(h,void 0,g)),this.paint=this._transitioningPaint.possiblyEvaluate(h,void 0,g)}serialize(){const h={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(h.layout=h.layout||{},h.layout.visibility=this.visibility),Gt(h,((g,x)=>!(g===void 0||x==="layout"&&!Object.keys(g).length||x==="paint"&&!Object.keys(g).length)))}_validate(h,g,x,A,k={}){return(!k||k.validate!==!1)&&zu(this,h.call(Ho,{key:g,layerType:this.type,objectKey:x,value:A,styleSpec:Qe,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const h in this.paint._values){const g=this.paint.get(h);if(g instanceof js&&ss(g.property.specification)&&(g.value.kind==="source"||g.value.kind==="composite")&&g.value.isStateDependent)return!0}return!1}}let Ql;var Yy={get paint(){return Ql=Ql||new Ki({"raster-opacity":new tr(Qe.paint_raster["raster-opacity"]),"raster-hue-rotate":new tr(Qe.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new tr(Qe.paint_raster["raster-brightness-min"]),"raster-brightness-max":new tr(Qe.paint_raster["raster-brightness-max"]),"raster-saturation":new tr(Qe.paint_raster["raster-saturation"]),"raster-contrast":new tr(Qe.paint_raster["raster-contrast"]),"raster-resampling":new tr(Qe.paint_raster["raster-resampling"]),"raster-fade-duration":new tr(Qe.paint_raster["raster-fade-duration"])})}};class Gu extends _a{constructor(h,g){super(h,Yy,g)}}const $o={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class an{constructor(h,g){this._structArray=h,this._pos1=g*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class Qi{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(h,g){return h._trim(),g&&(h.isTransferred=!0,g.push(h.arrayBuffer)),{length:h.length,arrayBuffer:h.arrayBuffer}}static deserialize(h){const g=Object.create(this.prototype);return g.arrayBuffer=h.arrayBuffer,g.length=h.length,g.capacity=h.arrayBuffer.byteLength/g.bytesPerElement,g._refreshViews(),g}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(h){this.reserve(h),this.length=h}reserve(h){if(h>this.capacity){this.capacity=Math.max(h,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const g=this.uint8;this._refreshViews(),g&&this.uint8.set(g)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function Bi(v,h=1){let g=0,x=0;return{members:v.map((A=>{const k=$o[A.type].BYTES_PER_ELEMENT,L=g=kr(g,Math.max(h,k)),z=A.components||1;return x=Math.max(x,k),g+=k*z,{name:A.name,type:A.type,components:z,offset:L}})),size:kr(g,Math.max(x,h)),alignment:h}}function kr(v,h){return Math.ceil(v/h)*h}class Ai extends Qi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(h,g){const x=this.length;return this.resize(x+1),this.emplace(x,h,g)}emplace(h,g,x){const A=2*h;return this.int16[A+0]=g,this.int16[A+1]=x,h}}Ai.prototype.bytesPerElement=4,Zt("StructArrayLayout2i4",Ai);class hn extends Qi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(h,g,x){const A=this.length;return this.resize(A+1),this.emplace(A,h,g,x)}emplace(h,g,x,A){const k=3*h;return this.int16[k+0]=g,this.int16[k+1]=x,this.int16[k+2]=A,h}}hn.prototype.bytesPerElement=6,Zt("StructArrayLayout3i6",hn);class eh extends Qi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(h,g,x,A){const k=this.length;return this.resize(k+1),this.emplace(k,h,g,x,A)}emplace(h,g,x,A,k){const L=4*h;return this.int16[L+0]=g,this.int16[L+1]=x,this.int16[L+2]=A,this.int16[L+3]=k,h}}eh.prototype.bytesPerElement=8,Zt("StructArrayLayout4i8",eh);class Tl extends Qi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(h,g,x,A,k,L){const z=this.length;return this.resize(z+1),this.emplace(z,h,g,x,A,k,L)}emplace(h,g,x,A,k,L,z){const V=6*h;return this.int16[V+0]=g,this.int16[V+1]=x,this.int16[V+2]=A,this.int16[V+3]=k,this.int16[V+4]=L,this.int16[V+5]=z,h}}Tl.prototype.bytesPerElement=12,Zt("StructArrayLayout2i4i12",Tl);class Jl extends Qi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(h,g,x,A,k,L){const z=this.length;return this.resize(z+1),this.emplace(z,h,g,x,A,k,L)}emplace(h,g,x,A,k,L,z){const V=4*h,X=8*h;return this.int16[V+0]=g,this.int16[V+1]=x,this.uint8[X+4]=A,this.uint8[X+5]=k,this.uint8[X+6]=L,this.uint8[X+7]=z,h}}Jl.prototype.bytesPerElement=8,Zt("StructArrayLayout2i4ub8",Jl);class $s extends Qi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(h,g){const x=this.length;return this.resize(x+1),this.emplace(x,h,g)}emplace(h,g,x){const A=2*h;return this.float32[A+0]=g,this.float32[A+1]=x,h}}$s.prototype.bytesPerElement=8,Zt("StructArrayLayout2f8",$s);class Ws extends Qi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(h,g,x,A,k,L,z,V,X,Z){const J=this.length;return this.resize(J+1),this.emplace(J,h,g,x,A,k,L,z,V,X,Z)}emplace(h,g,x,A,k,L,z,V,X,Z,J){const oe=10*h;return this.uint16[oe+0]=g,this.uint16[oe+1]=x,this.uint16[oe+2]=A,this.uint16[oe+3]=k,this.uint16[oe+4]=L,this.uint16[oe+5]=z,this.uint16[oe+6]=V,this.uint16[oe+7]=X,this.uint16[oe+8]=Z,this.uint16[oe+9]=J,h}}Ws.prototype.bytesPerElement=20,Zt("StructArrayLayout10ui20",Ws);class Xu extends Qi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(h,g,x,A,k,L,z,V){const X=this.length;return this.resize(X+1),this.emplace(X,h,g,x,A,k,L,z,V)}emplace(h,g,x,A,k,L,z,V,X){const Z=8*h;return this.uint16[Z+0]=g,this.uint16[Z+1]=x,this.uint16[Z+2]=A,this.uint16[Z+3]=k,this.uint16[Z+4]=L,this.uint16[Z+5]=z,this.uint16[Z+6]=V,this.uint16[Z+7]=X,h}}Xu.prototype.bytesPerElement=16,Zt("StructArrayLayout8ui16",Xu);class Bp extends Qi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(h,g,x,A,k,L,z,V,X,Z,J,oe){const le=this.length;return this.resize(le+1),this.emplace(le,h,g,x,A,k,L,z,V,X,Z,J,oe)}emplace(h,g,x,A,k,L,z,V,X,Z,J,oe,le){const ce=12*h;return this.int16[ce+0]=g,this.int16[ce+1]=x,this.int16[ce+2]=A,this.int16[ce+3]=k,this.uint16[ce+4]=L,this.uint16[ce+5]=z,this.uint16[ce+6]=V,this.uint16[ce+7]=X,this.int16[ce+8]=Z,this.int16[ce+9]=J,this.int16[ce+10]=oe,this.int16[ce+11]=le,h}}Bp.prototype.bytesPerElement=24,Zt("StructArrayLayout4i4ui4i24",Bp);class ji extends Qi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(h,g,x){const A=this.length;return this.resize(A+1),this.emplace(A,h,g,x)}emplace(h,g,x,A){const k=3*h;return this.float32[k+0]=g,this.float32[k+1]=x,this.float32[k+2]=A,h}}ji.prototype.bytesPerElement=12,Zt("StructArrayLayout3f12",ji);class Td extends Qi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(h){const g=this.length;return this.resize(g+1),this.emplace(g,h)}emplace(h,g){return this.uint32[1*h+0]=g,h}}Td.prototype.bytesPerElement=4,Zt("StructArrayLayout1ul4",Td);class Ad extends Qi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(h,g,x,A,k,L,z,V,X){const Z=this.length;return this.resize(Z+1),this.emplace(Z,h,g,x,A,k,L,z,V,X)}emplace(h,g,x,A,k,L,z,V,X,Z){const J=10*h,oe=5*h;return this.int16[J+0]=g,this.int16[J+1]=x,this.int16[J+2]=A,this.int16[J+3]=k,this.int16[J+4]=L,this.int16[J+5]=z,this.uint32[oe+3]=V,this.uint16[J+8]=X,this.uint16[J+9]=Z,h}}Ad.prototype.bytesPerElement=20,Zt("StructArrayLayout6i1ul2ui20",Ad);class Cd extends Qi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(h,g,x,A,k,L){const z=this.length;return this.resize(z+1),this.emplace(z,h,g,x,A,k,L)}emplace(h,g,x,A,k,L,z){const V=6*h;return this.int16[V+0]=g,this.int16[V+1]=x,this.int16[V+2]=A,this.int16[V+3]=k,this.int16[V+4]=L,this.int16[V+5]=z,h}}Cd.prototype.bytesPerElement=12,Zt("StructArrayLayout2i2i2i12",Cd);class zp extends Qi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(h,g,x,A,k){const L=this.length;return this.resize(L+1),this.emplace(L,h,g,x,A,k)}emplace(h,g,x,A,k,L){const z=4*h,V=8*h;return this.float32[z+0]=g,this.float32[z+1]=x,this.float32[z+2]=A,this.int16[V+6]=k,this.int16[V+7]=L,h}}zp.prototype.bytesPerElement=16,Zt("StructArrayLayout2f1f2i16",zp);class I extends Qi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(h,g,x,A,k,L){const z=this.length;return this.resize(z+1),this.emplace(z,h,g,x,A,k,L)}emplace(h,g,x,A,k,L,z){const V=16*h,X=4*h,Z=8*h;return this.uint8[V+0]=g,this.uint8[V+1]=x,this.float32[X+1]=A,this.float32[X+2]=k,this.int16[Z+6]=L,this.int16[Z+7]=z,h}}I.prototype.bytesPerElement=16,Zt("StructArrayLayout2ub2f2i16",I);class u extends Qi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(h,g,x){const A=this.length;return this.resize(A+1),this.emplace(A,h,g,x)}emplace(h,g,x,A){const k=3*h;return this.uint16[k+0]=g,this.uint16[k+1]=x,this.uint16[k+2]=A,h}}u.prototype.bytesPerElement=6,Zt("StructArrayLayout3ui6",u);class m extends Qi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(h,g,x,A,k,L,z,V,X,Z,J,oe,le,ce,ge,be,Ee){const qe=this.length;return this.resize(qe+1),this.emplace(qe,h,g,x,A,k,L,z,V,X,Z,J,oe,le,ce,ge,be,Ee)}emplace(h,g,x,A,k,L,z,V,X,Z,J,oe,le,ce,ge,be,Ee,qe){const Oe=24*h,Ve=12*h,ot=48*h;return this.int16[Oe+0]=g,this.int16[Oe+1]=x,this.uint16[Oe+2]=A,this.uint16[Oe+3]=k,this.uint32[Ve+2]=L,this.uint32[Ve+3]=z,this.uint32[Ve+4]=V,this.uint16[Oe+10]=X,this.uint16[Oe+11]=Z,this.uint16[Oe+12]=J,this.float32[Ve+7]=oe,this.float32[Ve+8]=le,this.uint8[ot+36]=ce,this.uint8[ot+37]=ge,this.uint8[ot+38]=be,this.uint32[Ve+10]=Ee,this.int16[Oe+22]=qe,h}}m.prototype.bytesPerElement=48,Zt("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",m);class w extends Qi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(h,g,x,A,k,L,z,V,X,Z,J,oe,le,ce,ge,be,Ee,qe,Oe,Ve,ot,gt,Et,Wt,Ft,Ht,ur,Ut){const jt=this.length;return this.resize(jt+1),this.emplace(jt,h,g,x,A,k,L,z,V,X,Z,J,oe,le,ce,ge,be,Ee,qe,Oe,Ve,ot,gt,Et,Wt,Ft,Ht,ur,Ut)}emplace(h,g,x,A,k,L,z,V,X,Z,J,oe,le,ce,ge,be,Ee,qe,Oe,Ve,ot,gt,Et,Wt,Ft,Ht,ur,Ut,jt){const Tt=32*h,xr=16*h;return this.int16[Tt+0]=g,this.int16[Tt+1]=x,this.int16[Tt+2]=A,this.int16[Tt+3]=k,this.int16[Tt+4]=L,this.int16[Tt+5]=z,this.int16[Tt+6]=V,this.int16[Tt+7]=X,this.uint16[Tt+8]=Z,this.uint16[Tt+9]=J,this.uint16[Tt+10]=oe,this.uint16[Tt+11]=le,this.uint16[Tt+12]=ce,this.uint16[Tt+13]=ge,this.uint16[Tt+14]=be,this.uint16[Tt+15]=Ee,this.uint16[Tt+16]=qe,this.uint16[Tt+17]=Oe,this.uint16[Tt+18]=Ve,this.uint16[Tt+19]=ot,this.uint16[Tt+20]=gt,this.uint16[Tt+21]=Et,this.uint16[Tt+22]=Wt,this.uint32[xr+12]=Ft,this.float32[xr+13]=Ht,this.float32[xr+14]=ur,this.uint16[Tt+30]=Ut,this.uint16[Tt+31]=jt,h}}w.prototype.bytesPerElement=64,Zt("StructArrayLayout8i15ui1ul2f2ui64",w);class M extends Qi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(h){const g=this.length;return this.resize(g+1),this.emplace(g,h)}emplace(h,g){return this.float32[1*h+0]=g,h}}M.prototype.bytesPerElement=4,Zt("StructArrayLayout1f4",M);class R extends Qi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(h,g,x){const A=this.length;return this.resize(A+1),this.emplace(A,h,g,x)}emplace(h,g,x,A){const k=3*h;return this.uint16[6*h+0]=g,this.float32[k+1]=x,this.float32[k+2]=A,h}}R.prototype.bytesPerElement=12,Zt("StructArrayLayout1ui2f12",R);class N extends Qi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(h,g,x){const A=this.length;return this.resize(A+1),this.emplace(A,h,g,x)}emplace(h,g,x,A){const k=4*h;return this.uint32[2*h+0]=g,this.uint16[k+2]=x,this.uint16[k+3]=A,h}}N.prototype.bytesPerElement=8,Zt("StructArrayLayout1ul2ui8",N);class H extends Qi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(h,g){const x=this.length;return this.resize(x+1),this.emplace(x,h,g)}emplace(h,g,x){const A=2*h;return this.uint16[A+0]=g,this.uint16[A+1]=x,h}}H.prototype.bytesPerElement=4,Zt("StructArrayLayout2ui4",H);class j extends Qi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(h){const g=this.length;return this.resize(g+1),this.emplace(g,h)}emplace(h,g){return this.uint16[1*h+0]=g,h}}j.prototype.bytesPerElement=2,Zt("StructArrayLayout1ui2",j);class Y extends Qi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(h,g,x,A){const k=this.length;return this.resize(k+1),this.emplace(k,h,g,x,A)}emplace(h,g,x,A,k){const L=4*h;return this.float32[L+0]=g,this.float32[L+1]=x,this.float32[L+2]=A,this.float32[L+3]=k,h}}Y.prototype.bytesPerElement=16,Zt("StructArrayLayout4f16",Y);class K extends an{get anchorPointX(){return this._structArray.int16[this._pos2+0]}get anchorPointY(){return this._structArray.int16[this._pos2+1]}get x1(){return this._structArray.int16[this._pos2+2]}get y1(){return this._structArray.int16[this._pos2+3]}get x2(){return this._structArray.int16[this._pos2+4]}get y2(){return this._structArray.int16[this._pos2+5]}get featureIndex(){return this._structArray.uint32[this._pos4+3]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+8]}get bucketIndex(){return this._structArray.uint16[this._pos2+9]}get anchorPoint(){return new l(this.anchorPointX,this.anchorPointY)}}K.prototype.size=20;class ie extends Ad{get(h){return new K(this,h)}}Zt("CollisionBoxArray",ie);class re extends an{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+2]}get numGlyphs(){return this._structArray.uint16[this._pos2+3]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+2]}get lineStartIndex(){return this._structArray.uint32[this._pos4+3]}get lineLength(){return this._structArray.uint32[this._pos4+4]}get segment(){return this._structArray.uint16[this._pos2+10]}get lowerSize(){return this._structArray.uint16[this._pos2+11]}get upperSize(){return this._structArray.uint16[this._pos2+12]}get lineOffsetX(){return this._structArray.float32[this._pos4+7]}get lineOffsetY(){return this._structArray.float32[this._pos4+8]}get writingMode(){return this._structArray.uint8[this._pos1+36]}get placedOrientation(){return this._structArray.uint8[this._pos1+37]}set placedOrientation(h){this._structArray.uint8[this._pos1+37]=h}get hidden(){return this._structArray.uint8[this._pos1+38]}set hidden(h){this._structArray.uint8[this._pos1+38]=h}get crossTileID(){return this._structArray.uint32[this._pos4+10]}set crossTileID(h){this._structArray.uint32[this._pos4+10]=h}get associatedIconIndex(){return this._structArray.int16[this._pos2+22]}}re.prototype.size=48;class ue extends m{get(h){return new re(this,h)}}Zt("PlacedSymbolArray",ue);class pe extends an{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+2]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+3]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+4]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+5]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+6]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+7]}get key(){return this._structArray.uint16[this._pos2+8]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+9]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+10]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+11]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+12]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+13]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+14]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get featureIndex(){return this._structArray.uint16[this._pos2+17]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+18]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+19]}get numIconVertices(){return this._structArray.uint16[this._pos2+20]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+21]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+22]}get crossTileID(){return this._structArray.uint32[this._pos4+12]}set crossTileID(h){this._structArray.uint32[this._pos4+12]=h}get textBoxScale(){return this._structArray.float32[this._pos4+13]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+14]}get textAnchorOffsetStartIndex(){return this._structArray.uint16[this._pos2+30]}get textAnchorOffsetEndIndex(){return this._structArray.uint16[this._pos2+31]}}pe.prototype.size=64;class Se extends w{get(h){return new pe(this,h)}}Zt("SymbolInstanceArray",Se);class Te extends M{getoffsetX(h){return this.float32[1*h+0]}}Zt("GlyphOffsetArray",Te);class Ce extends hn{getx(h){return this.int16[3*h+0]}gety(h){return this.int16[3*h+1]}gettileUnitDistanceFromAnchor(h){return this.int16[3*h+2]}}Zt("SymbolLineVertexArray",Ce);class Ie extends an{get textAnchor(){return this._structArray.uint16[this._pos2+0]}get textOffset0(){return this._structArray.float32[this._pos4+1]}get textOffset1(){return this._structArray.float32[this._pos4+2]}}Ie.prototype.size=12;class ke extends R{get(h){return new Ie(this,h)}}Zt("TextAnchorOffsetArray",ke);class Re extends an{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}}Re.prototype.size=8;class ze extends N{get(h){return new Re(this,h)}}Zt("FeatureIndexArray",ze);class He extends Ai{}class Le extends Ai{}class Xe extends Ai{}class ht extends Tl{}class at extends Jl{}class st extends $s{}class lt extends Ws{}class Ot extends Xu{}class Bt extends Bp{}class Ct extends ji{}class nr extends Td{}class Pr extends Cd{}class gi extends I{}class Mi extends u{}class Ei extends H{}const Ji=Bi([{name:"a_pos",components:2,type:"Int16"}],4),{members:$i}=Ji;class Jr{constructor(h=[]){this._forceNewSegmentOnNextPrepare=!1,this.segments=h}prepareSegment(h,g,x,A){const k=this.segments[this.segments.length-1];return h>Jr.MAX_VERTEX_ARRAY_LENGTH&&dr(`Max vertices per segment is ${Jr.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${h}. Consider using the \`fillLargeMeshArrays\` function if you require meshes with more than ${Jr.MAX_VERTEX_ARRAY_LENGTH} vertices.`),this._forceNewSegmentOnNextPrepare||!k||k.vertexLength+h>Jr.MAX_VERTEX_ARRAY_LENGTH||k.sortKey!==A?this.createNewSegment(g,x,A):k}createNewSegment(h,g,x){const A={vertexOffset:h.length,primitiveOffset:g.length,vertexLength:0,primitiveLength:0,vaos:{}};return x!==void 0&&(A.sortKey=x),this._forceNewSegmentOnNextPrepare=!1,this.segments.push(A),A}getOrCreateLatestSegment(h,g,x){return this.prepareSegment(0,h,g,x)}forceNewSegmentOnNextPrepare(){this._forceNewSegmentOnNextPrepare=!0}get(){return this.segments}destroy(){for(const h of this.segments)for(const g in h.vaos)h.vaos[g].destroy()}static simpleSegment(h,g,x,A){return new Jr([{vertexOffset:h,primitiveOffset:g,vertexLength:x,primitiveLength:A,vaos:{},sortKey:0}])}}function fn(v,h){return 256*(v=qt(Math.floor(v),0,255))+qt(Math.floor(h),0,255)}Jr.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Zt("SegmentVector",Jr);const ba=Bi([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]),kn=Bi([{name:"a_dasharray_from",components:4,type:"Uint16"},{name:"a_dasharray_to",components:4,type:"Uint16"}]);var Ln,Va,eu,Wo={exports:{}},tu={exports:{}},Zu={exports:{}},tf=(function(){if(eu)return Wo.exports;eu=1;var v=(Ln||(Ln=1,tu.exports=function(g,x){var A,k,L,z,V,X,Z,J;for(k=g.length-(A=3&g.length),L=x,V=3432918353,X=461845907,J=0;J<k;)Z=255&g.charCodeAt(J)|(255&g.charCodeAt(++J))<<8|(255&g.charCodeAt(++J))<<16|(255&g.charCodeAt(++J))<<24,++J,L=27492+(65535&(z=5*(65535&(L=(L^=Z=(65535&(Z=(Z=(65535&Z)*V+(((Z>>>16)*V&65535)<<16)&4294967295)<<15|Z>>>17))*X+(((Z>>>16)*X&65535)<<16)&4294967295)<<13|L>>>19))+((5*(L>>>16)&65535)<<16)&4294967295))+((58964+(z>>>16)&65535)<<16);switch(Z=0,A){case 3:Z^=(255&g.charCodeAt(J+2))<<16;case 2:Z^=(255&g.charCodeAt(J+1))<<8;case 1:L^=Z=(65535&(Z=(Z=(65535&(Z^=255&g.charCodeAt(J)))*V+(((Z>>>16)*V&65535)<<16)&4294967295)<<15|Z>>>17))*X+(((Z>>>16)*X&65535)<<16)&4294967295}return L^=g.length,L=2246822507*(65535&(L^=L>>>16))+((2246822507*(L>>>16)&65535)<<16)&4294967295,L=3266489909*(65535&(L^=L>>>13))+((3266489909*(L>>>16)&65535)<<16)&4294967295,(L^=L>>>16)>>>0}),tu.exports),h=(Va||(Va=1,Zu.exports=function(g,x){for(var A,k=g.length,L=x^k,z=0;k>=4;)A=1540483477*(65535&(A=255&g.charCodeAt(z)|(255&g.charCodeAt(++z))<<8|(255&g.charCodeAt(++z))<<16|(255&g.charCodeAt(++z))<<24))+((1540483477*(A>>>16)&65535)<<16),L=1540483477*(65535&L)+((1540483477*(L>>>16)&65535)<<16)^(A=1540483477*(65535&(A^=A>>>24))+((1540483477*(A>>>16)&65535)<<16)),k-=4,++z;switch(k){case 3:L^=(255&g.charCodeAt(z+2))<<16;case 2:L^=(255&g.charCodeAt(z+1))<<8;case 1:L=1540483477*(65535&(L^=255&g.charCodeAt(z)))+((1540483477*(L>>>16)&65535)<<16)}return L=1540483477*(65535&(L^=L>>>13))+((1540483477*(L>>>16)&65535)<<16),(L^=L>>>15)>>>0}),Zu.exports);return Wo.exports=v,Wo.exports.murmur3=v,Wo.exports.murmur2=h,Wo.exports})(),th=c(tf);class Al{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(h,g,x,A){this.ids.push(Go(h)),this.positions.push(g,x,A)}getPositions(h){if(!this.indexed)throw new Error("Trying to get index, but feature positions are not indexed");const g=Go(h);let x=0,A=this.ids.length-1;for(;x<A;){const L=x+A>>1;this.ids[L]>=g?A=L:x=L+1}const k=[];for(;this.ids[x]===g;)k.push({index:this.positions[3*x],start:this.positions[3*x+1],end:this.positions[3*x+2]}),x++;return k}static serialize(h,g){const x=new Float64Array(h.ids),A=new Uint32Array(h.positions);return hs(x,A,0,x.length-1),g&&g.push(x.buffer,A.buffer),{ids:x,positions:A}}static deserialize(h){const g=new Al;return g.ids=h.ids,g.positions=h.positions,g.indexed=!0,g}}function Go(v){const h=+v;return!isNaN(h)&&h<=Number.MAX_SAFE_INTEGER?h:th(String(v))}function hs(v,h,g,x){for(;g<x;){const A=v[g+x>>1];let k=g-1,L=x+1;for(;;){do k++;while(v[k]<A);do L--;while(v[L]>A);if(k>=L)break;Gs(v,k,L),Gs(h,3*k,3*L),Gs(h,3*k+1,3*L+1),Gs(h,3*k+2,3*L+2)}L-g<x-L?(hs(v,h,g,L),g=L+1):(hs(v,h,L+1,x),x=L)}}function Gs(v,h,g){const x=v[h];v[h]=v[g],v[g]=x}Zt("FeaturePositionMap",Al);class So{constructor(h,g){this.gl=h.gl,this.location=g}}class _n extends So{constructor(h,g){super(h,g),this.current=0}set(h){this.current!==h&&(this.current=h,this.gl.uniform1f(this.location,h))}}class Xn extends So{constructor(h,g){super(h,g),this.current=[0,0,0,0]}set(h){h[0]===this.current[0]&&h[1]===this.current[1]&&h[2]===this.current[2]&&h[3]===this.current[3]||(this.current=h,this.gl.uniform4f(this.location,h[0],h[1],h[2],h[3]))}}class To extends So{constructor(h,g){super(h,g),this.current=Zr.transparent}set(h){h.r===this.current.r&&h.g===this.current.g&&h.b===this.current.b&&h.a===this.current.a||(this.current=h,this.gl.uniform4f(this.location,h.r,h.g,h.b,h.a))}}const xa=new Float32Array(16);function Cv(v){return[fn(255*v.r,255*v.g),fn(255*v.b,255*v.a)]}class rf{constructor(h,g,x){this.value=h,this.uniformNames=g.map((A=>`u_${A}`)),this.type=x}setUniform(h,g,x){h.set(x.constantOr(this.value))}getBinding(h,g,x){return this.type==="color"?new To(h,g):new _n(h,g)}}class Xs{constructor(h,g){this.uniformNames=g.map((x=>`u_${x}`)),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(h,g){this.pixelRatioFrom=g.pixelRatio,this.pixelRatioTo=h.pixelRatio,this.patternFrom=g.tlbr,this.patternTo=h.tlbr}setConstantDashPositions(h,g){this.dashTo=[0,h.y,h.height,h.width],this.dashFrom=[0,g.y,g.height,g.width]}setUniform(h,g,x,A){let k=null;A==="u_pattern_to"?k=this.patternTo:A==="u_pattern_from"?k=this.patternFrom:A==="u_dasharray_to"?k=this.dashTo:A==="u_dasharray_from"?k=this.dashFrom:A==="u_pixel_ratio_to"?k=this.pixelRatioTo:A==="u_pixel_ratio_from"&&(k=this.pixelRatioFrom),k!==null&&h.set(k)}getBinding(h,g,x){return x.substr(0,9)==="u_pattern"||x.substr(0,12)==="u_dasharray_"?new Xn(h,g):new _n(h,g)}}class Zs{constructor(h,g,x,A){this.expression=h,this.type=x,this.maxValue=0,this.paintVertexAttributes=g.map((k=>({name:`a_${k}`,type:"Float32",components:x==="color"?2:1,offset:0}))),this.paintVertexArray=new A}populatePaintArray(h,g,x){const A=this.paintVertexArray.length,k=this.expression.evaluate(new Ni(0,x),g,{},x.canonical,[],x.formattedSection);this.paintVertexArray.resize(h),this._setPaintValue(A,h,k)}updatePaintArray(h,g,x,A,k){const L=this.expression.evaluate(new Ni(0,k),x,A);this._setPaintValue(h,g,L)}_setPaintValue(h,g,x){if(this.type==="color"){const A=Cv(x);for(let k=h;k<g;k++)this.paintVertexArray.emplace(k,A[0],A[1])}else{for(let A=h;A<g;A++)this.paintVertexArray.emplace(A,x);this.maxValue=Math.max(this.maxValue,Math.abs(x))}}upload(h){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=h.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Ao{constructor(h,g,x,A,k,L){this.expression=h,this.uniformNames=g.map((z=>`u_${z}_t`)),this.type=x,this.useIntegerZoom=A,this.zoom=k,this.maxValue=0,this.paintVertexAttributes=g.map((z=>({name:`a_${z}`,type:"Float32",components:x==="color"?4:2,offset:0}))),this.paintVertexArray=new L}populatePaintArray(h,g,x){const A=this.expression.evaluate(new Ni(this.zoom,x),g,{},x.canonical,[],x.formattedSection),k=this.expression.evaluate(new Ni(this.zoom+1,x),g,{},x.canonical,[],x.formattedSection),L=this.paintVertexArray.length;this.paintVertexArray.resize(h),this._setPaintValue(L,h,A,k)}updatePaintArray(h,g,x,A,k){const L=this.expression.evaluate(new Ni(this.zoom,k),x,A),z=this.expression.evaluate(new Ni(this.zoom+1,k),x,A);this._setPaintValue(h,g,L,z)}_setPaintValue(h,g,x,A){if(this.type==="color"){const k=Cv(x),L=Cv(A);for(let z=h;z<g;z++)this.paintVertexArray.emplace(z,k[0],k[1],L[0],L[1])}else{for(let k=h;k<g;k++)this.paintVertexArray.emplace(k,x,A);this.maxValue=Math.max(this.maxValue,Math.abs(x),Math.abs(A))}}upload(h){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=h.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(h,g){const x=this.useIntegerZoom?Math.floor(g.zoom):g.zoom,A=qt(this.expression.interpolationFactor(x,this.zoom,this.zoom+1),0,1);h.set(A)}getBinding(h,g,x){return new _n(h,g)}}class ru{constructor(h,g,x,A,k,L){this.expression=h,this.type=g,this.useIntegerZoom=x,this.zoom=A,this.layerId=L,this.zoomInPaintVertexArray=new k,this.zoomOutPaintVertexArray=new k}populatePaintArray(h,g,x){const A=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(h),this.zoomOutPaintVertexArray.resize(h),this._setPaintValues(A,h,this.getPositionIds(g),x)}updatePaintArray(h,g,x,A,k){this._setPaintValues(h,g,this.getPositionIds(x),k)}_setPaintValues(h,g,x,A){const k=this.getPositions(A);if(!k||!x)return;const L=k[x.min],z=k[x.mid],V=k[x.max];if(L&&z&&V)for(let X=h;X<g;X++)this.emplace(this.zoomInPaintVertexArray,X,z,L),this.emplace(this.zoomOutPaintVertexArray,X,z,V)}upload(h){if(this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer){const g=this.getVertexAttributes();this.zoomInPaintVertexBuffer=h.createVertexBuffer(this.zoomInPaintVertexArray,g,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=h.createVertexBuffer(this.zoomOutPaintVertexArray,g,this.expression.isStateDependent)}}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class iu extends ru{getPositions(h){return h.imagePositions}getPositionIds(h){return h.patterns&&h.patterns[this.layerId]}getVertexAttributes(){return ba.members}emplace(h,g,x,A){h.emplace(g,x.tlbr[0],x.tlbr[1],x.tlbr[2],x.tlbr[3],A.tlbr[0],A.tlbr[1],A.tlbr[2],A.tlbr[3],x.pixelRatio,A.pixelRatio)}}class rh extends ru{getPositions(h){return h.dashPositions}getPositionIds(h){return h.dashes&&h.dashes[this.layerId]}getVertexAttributes(){return kn.members}emplace(h,g,x,A){h.emplace(g,0,x.y,x.height,x.width,0,A.y,A.height,A.width)}}class Fp{constructor(h,g,x){this.binders={},this._buffers=[];const A=[];for(const k in h.paint._values){if(!x(k))continue;const L=h.paint.get(k);if(!(L instanceof js&&ss(L.property.specification)))continue;const z=Vp(k,h.type),V=L.value,X=L.property.specification.type,Z=L.property.useIntegerZoom,J=L.property.specification["property-type"],oe=J==="cross-faded"||J==="cross-faded-data-driven";if(V.kind==="constant")this.binders[k]=oe?new Xs(V.value,z):new rf(V.value,z,X),A.push(`/u_${k}`);else if(V.kind==="source"||oe){const le=Md(k,X,"source");this.binders[k]=oe?k==="line-dasharray"?new rh(V,X,Z,g,le,h.id):new iu(V,X,Z,g,le,h.id):new Zs(V,z,X,le),A.push(`/a_${k}`)}else{const le=Md(k,X,"composite");this.binders[k]=new Ao(V,z,X,Z,g,le),A.push(`/z_${k}`)}}this.cacheKey=A.sort().join("")}getMaxValue(h){const g=this.binders[h];return g instanceof Zs||g instanceof Ao?g.maxValue:0}populatePaintArrays(h,g,x){for(const A in this.binders){const k=this.binders[A];(k instanceof Zs||k instanceof Ao||k instanceof ru)&&k.populatePaintArray(h,g,x)}}setConstantPatternPositions(h,g){for(const x in this.binders){const A=this.binders[x];A instanceof Xs&&A.setConstantPatternPositions(h,g)}}setConstantDashPositions(h,g){for(const x in this.binders){const A=this.binders[x];A instanceof Xs&&A.setConstantDashPositions(h,g)}}updatePaintArrays(h,g,x,A,k){let L=!1;for(const z in h){const V=g.getPositions(z);for(const X of V){const Z=x.feature(X.index);for(const J in this.binders){const oe=this.binders[J];if((oe instanceof Zs||oe instanceof Ao||oe instanceof ru)&&oe.expression.isStateDependent===!0){const le=A.paint.get(J);oe.expression=le.value,oe.updatePaintArray(X.start,X.end,Z,h[z],k),L=!0}}}}return L}defines(){const h=[];for(const g in this.binders){const x=this.binders[g];(x instanceof rf||x instanceof Xs)&&h.push(...x.uniformNames.map((A=>`#define HAS_UNIFORM_${A}`)))}return h}getBinderAttributes(){const h=[];for(const g in this.binders){const x=this.binders[g];if(x instanceof Zs||x instanceof Ao)for(let A=0;A<x.paintVertexAttributes.length;A++)h.push(x.paintVertexAttributes[A].name);else if(x instanceof ru){const A=x.getVertexAttributes();for(const k of A)h.push(k.name)}}return h}getBinderUniforms(){const h=[];for(const g in this.binders){const x=this.binders[g];if(x instanceof rf||x instanceof Xs||x instanceof Ao)for(const A of x.uniformNames)h.push(A)}return h}getPaintVertexBuffers(){return this._buffers}getUniforms(h,g){const x=[];for(const A in this.binders){const k=this.binders[A];if(k instanceof rf||k instanceof Xs||k instanceof Ao){for(const L of k.uniformNames)if(g[L]){const z=k.getBinding(h,g[L],L);x.push({name:L,property:A,binding:z})}}}return x}setUniforms(h,g,x,A){for(const{name:k,property:L,binding:z}of g)this.binders[L].setUniform(z,A,x.get(L),k)}updatePaintBuffers(h){this._buffers=[];for(const g in this.binders){const x=this.binders[g];if(h&&x instanceof ru){const A=h.fromScale===2?x.zoomInPaintVertexBuffer:x.zoomOutPaintVertexBuffer;A&&this._buffers.push(A)}else(x instanceof Zs||x instanceof Ao)&&x.paintVertexBuffer&&this._buffers.push(x.paintVertexBuffer)}}upload(h){for(const g in this.binders){const x=this.binders[g];(x instanceof Zs||x instanceof Ao||x instanceof ru)&&x.upload(h)}this.updatePaintBuffers()}destroy(){for(const h in this.binders){const g=this.binders[h];(g instanceof Zs||g instanceof Ao||g instanceof ru)&&g.destroy()}}}class Cl{constructor(h,g,x=()=>!0){this.programConfigurations={};for(const A of h)this.programConfigurations[A.id]=new Fp(A,g,x);this.needsUpload=!1,this._featureMap=new Al,this._bufferOffset=0}populatePaintArrays(h,g,x,A){for(const k in this.programConfigurations)this.programConfigurations[k].populatePaintArrays(h,g,A);g.id!==void 0&&this._featureMap.add(g.id,x,this._bufferOffset,h),this._bufferOffset=h,this.needsUpload=!0}updatePaintArrays(h,g,x,A){for(const k of x)this.needsUpload=this.programConfigurations[k.id].updatePaintArrays(h,this._featureMap,g,k,A)||this.needsUpload}get(h){return this.programConfigurations[h]}upload(h){if(this.needsUpload){for(const g in this.programConfigurations)this.programConfigurations[g].upload(h);this.needsUpload=!1}}destroy(){for(const h in this.programConfigurations)this.programConfigurations[h].destroy()}}function Vp(v,h){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-dasharray":["dasharray_to","dasharray_from"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[v]||[v.replace(`${h}-`,"").replace(/-/g,"_")]}function Md(v,h,g){const x={color:{source:$s,composite:Y},number:{source:M,composite:$s}},A=(function(k){return{"line-pattern":{source:lt,composite:lt},"fill-pattern":{source:lt,composite:lt},"fill-extrusion-pattern":{source:lt,composite:lt},"line-dasharray":{source:Ot,composite:Ot}}[k]})(v);return A&&A[g]||x[h][g]}Zt("ConstantBinder",rf),Zt("CrossFadedConstantBinder",Xs),Zt("SourceExpressionBinder",Zs),Zt("CrossFadedPatternBinder",iu),Zt("CrossFadedDasharrayBinder",rh),Zt("CompositeExpressionBinder",Ao),Zt("ProgramConfiguration",Fp,{omit:["_buffers"]}),Zt("ProgramConfigurationSet",Cl);const ih=Math.pow(2,14)-1,Ib=-ih-1;function nf(v){const h=je/v.extent,g=v.loadGeometry();for(let x=0;x<g.length;x++){const A=g[x];for(let k=0;k<A.length;k++){const L=A[k],z=Math.round(L.x*h),V=Math.round(L.y*h);L.x=qt(z,Ib,ih),L.y=qt(V,Ib,ih),(z<L.x||z>L.x+1||V<L.y||V>L.y+1)&&dr("Geometry exceeds allowed extent, reduce your vector tile buffer size")}}return g}function qs(v,h){return{type:v.type,id:v.id,properties:v.properties,geometry:h?nf(v):[]}}const Pb=-32768;function cS(v,h,g,x,A){v.emplaceBack(Pb+8*h+x,Pb+8*g+A)}class Ky{constructor(h){this.zoom=h.zoom,this.overscaling=h.overscaling,this.layers=h.layers,this.layerIds=this.layers.map((g=>g.id)),this.index=h.index,this.hasDependencies=!1,this.layoutVertexArray=new Le,this.indexArray=new Mi,this.segments=new Jr,this.programConfigurations=new Cl(h.layers,h.zoom),this.stateDependentLayerIds=this.layers.filter((g=>g.isStateDependent())).map((g=>g.id))}populate(h,g,x){const A=this.layers[0],k=[];let L=null,z=!1,V=A.type==="heatmap";if(A.type==="circle"){const Z=A;L=Z.layout.get("circle-sort-key"),z=!L.isConstant(),V=V||Z.paint.get("circle-pitch-alignment")==="map"}const X=V?g.subdivisionGranularity.circle:1;for(const{feature:Z,id:J,index:oe,sourceLayerIndex:le}of h){const ce=this.layers[0]._featureFilter.needGeometry,ge=qs(Z,ce);if(!this.layers[0]._featureFilter.filter(new Ni(this.zoom),ge,x))continue;const be=z?L.evaluate(ge,{},x):void 0,Ee={id:J,properties:Z.properties,type:Z.type,sourceLayerIndex:le,index:oe,geometry:ce?ge.geometry:nf(Z),patterns:{},sortKey:be};k.push(Ee)}z&&k.sort(((Z,J)=>Z.sortKey-J.sortKey));for(const Z of k){const{geometry:J,index:oe,sourceLayerIndex:le}=Z,ce=h[oe].feature;this.addFeature(Z,J,oe,x,X),g.featureIndex.insert(ce,J,oe,le,this.index)}}update(h,g,x){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(h,g,this.stateDependentLayers,{imagePositions:x})}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(h){this.uploaded||(this.layoutVertexBuffer=h.createVertexBuffer(this.layoutVertexArray,$i),this.indexBuffer=h.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(h),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(h,g,x,A,k=1){let L;switch(k){case 1:L=[0,7];break;case 3:L=[0,2,5,7];break;case 5:L=[0,1,3,4,6,7];break;case 7:L=[0,1,2,3,4,5,6,7];break;default:throw new Error(`Invalid circle bucket granularity: ${k}; valid values are 1, 3, 5, 7.`)}const z=L.length;for(const V of g)for(const X of V){const Z=X.x,J=X.y;if(Z<0||Z>=je||J<0||J>=je)continue;const oe=this.segments.prepareSegment(z*z,this.layoutVertexArray,this.indexArray,h.sortKey),le=oe.vertexLength;for(let ce=0;ce<z;ce++)for(let ge=0;ge<z;ge++)cS(this.layoutVertexArray,Z,J,L[ge],L[ce]);for(let ce=0;ce<z-1;ce++)for(let ge=0;ge<z-1;ge++){const be=le+ce*z+ge,Ee=le+(ce+1)*z+ge;this.indexArray.emplaceBack(be,Ee+1,be+1),this.indexArray.emplaceBack(be,Ee,Ee+1)}oe.vertexLength+=z*z,oe.primitiveLength+=(z-1)*(z-1)*2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,h,x,{imagePositions:{},canonical:A})}}function Mv(v,h){for(let g=0;g<v.length;g++)if(Ed(h,v[g]))return!0;for(let g=0;g<h.length;g++)if(Ed(v,h[g]))return!0;return!!Jy(v,h)}function Ev(v,h,g){return!!Ed(v,h)||!!Iv(h,v,g)}function Qy(v,h){if(v.length===1)return Ua(h,v[0]);for(let g=0;g<h.length;g++){const x=h[g];for(let A=0;A<x.length;A++)if(Ed(v,x[A]))return!0}for(let g=0;g<v.length;g++)if(Ua(h,v[g]))return!0;for(let g=0;g<h.length;g++)if(Jy(v,h[g]))return!0;return!1}function hS(v,h,g){if(v.length>1){if(Jy(v,h))return!0;for(let x=0;x<h.length;x++)if(Iv(h[x],v,g))return!0}for(let x=0;x<v.length;x++)if(Iv(v[x],h,g))return!0;return!1}function Jy(v,h){if(v.length===0||h.length===0)return!1;for(let g=0;g<v.length-1;g++){const x=v[g],A=v[g+1];for(let k=0;k<h.length-1;k++)if(fM(x,A,h[k],h[k+1]))return!0}return!1}function fM(v,h,g,x){return $r(v,g,x)!==$r(h,g,x)&&$r(v,h,g)!==$r(v,h,x)}function Iv(v,h,g){const x=g*g;if(h.length===1)return v.distSqr(h[0])<x;for(let A=1;A<h.length;A++)if(aa(v,h[A-1],h[A])<x)return!0;return!1}function aa(v,h,g){const x=h.distSqr(g);if(x===0)return v.distSqr(h);const A=((v.x-h.x)*(g.x-h.x)+(v.y-h.y)*(g.y-h.y))/x;return v.distSqr(A<0?h:A>1?g:g.sub(h)._mult(A)._add(h))}function Ua(v,h){let g,x,A,k=!1;for(let L=0;L<v.length;L++){g=v[L];for(let z=0,V=g.length-1;z<g.length;V=z++)x=g[z],A=g[V],x.y>h.y!=A.y>h.y&&h.x<(A.x-x.x)*(h.y-x.y)/(A.y-x.y)+x.x&&(k=!k)}return k}function Ed(v,h){let g=!1;for(let x=0,A=v.length-1;x<v.length;A=x++){const k=v[x],L=v[A];k.y>h.y!=L.y>h.y&&h.x<(L.x-k.x)*(h.y-k.y)/(L.y-k.y)+k.x&&(g=!g)}return g}function fS(v,h,g){const x=g[0],A=g[2];if(v.x<x.x&&h.x<x.x||v.x>A.x&&h.x>A.x||v.y<x.y&&h.y<x.y||v.y>A.y&&h.y>A.y)return!1;const k=$r(v,h,g[0]);return k!==$r(v,h,g[1])||k!==$r(v,h,g[2])||k!==$r(v,h,g[3])}function Id(v,h,g){const x=h.paint.get(v).value;return x.kind==="constant"?x.value:g.programConfigurations.get(h.id).getMaxValue(v)}function Pv(v){return Math.sqrt(v[0]*v[0]+v[1]*v[1])}function af(v,h,g,x,A){if(!h[0]&&!h[1])return v;const k=l.convert(h)._mult(A);g==="viewport"&&k._rotate(-x);const L=[];for(let z=0;z<v.length;z++)L.push(v[z].sub(k));return L}function dS({queryGeometry:v,size:h},g){return Ev(v,g,h)}function e_({queryGeometry:v,size:h,transform:g,unwrappedTileID:x,getElevation:A},k){return Ev(v,k,h*(g.projectTileCoordinates(k.x,k.y,x,A).signedDistanceFromCamera/g.cameraToCenterDistance))}function pS({queryGeometry:v,size:h,transform:g,unwrappedTileID:x,getElevation:A},k){const L=g.projectTileCoordinates(k.x,k.y,x,A).signedDistanceFromCamera,z=h*(g.cameraToCenterDistance/L);return Ev(v,Dv(k,g,x,A),z)}function dM({queryGeometry:v,size:h,transform:g,unwrappedTileID:x,getElevation:A},k){return Ev(v,Dv(k,g,x,A),h)}function Rv({queryGeometry:v,size:h,transform:g,unwrappedTileID:x,getElevation:A,pitchAlignment:k="map",pitchScale:L="map"},z){const V=k==="map"?L==="map"?dS:e_:L==="map"?pS:dM,X={queryGeometry:v,size:h,transform:g,unwrappedTileID:x,getElevation:A};for(const Z of z)for(const J of Z)if(V(X,J))return!0;return!1}function Dv(v,h,g,x){const A=h.projectTileCoordinates(v.x,v.y,g,x).point;return new l((.5*A.x+.5)*h.width,(.5*-A.y+.5)*h.height)}let Rb,Db;Zt("CircleBucket",Ky,{omit:["layers"]});var gS={get paint(){return Db=Db||new Ki({"circle-radius":new gr(Qe.paint_circle["circle-radius"]),"circle-color":new gr(Qe.paint_circle["circle-color"]),"circle-blur":new gr(Qe.paint_circle["circle-blur"]),"circle-opacity":new gr(Qe.paint_circle["circle-opacity"]),"circle-translate":new tr(Qe.paint_circle["circle-translate"]),"circle-translate-anchor":new tr(Qe.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new tr(Qe.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new tr(Qe.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new gr(Qe.paint_circle["circle-stroke-width"]),"circle-stroke-color":new gr(Qe.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new gr(Qe.paint_circle["circle-stroke-opacity"])})},get layout(){return Rb=Rb||new Ki({"circle-sort-key":new gr(Qe.layout_circle["circle-sort-key"])})}};class kb extends _a{constructor(h,g){super(h,gS,g)}createBucket(h){return new Ky(h)}queryRadius(h){const g=h;return Id("circle-radius",this,g)+Id("circle-stroke-width",this,g)+Pv(this.paint.get("circle-translate"))}queryIntersectsFeature({queryGeometry:h,feature:g,featureState:x,geometry:A,transform:k,pixelsToTileUnits:L,unwrappedTileID:z,getElevation:V}){const X=af(h,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),-k.bearingInRadians,L),Z=this.paint.get("circle-radius").evaluate(g,x)+this.paint.get("circle-stroke-width").evaluate(g,x),J=this.paint.get("circle-pitch-scale"),oe=this.paint.get("circle-pitch-alignment");let le,ce;return oe==="map"?(le=X,ce=Z*L):(le=(function(ge,be,Ee,qe){return ge.map((Oe=>Dv(Oe,be,Ee,qe)))})(X,k,z,V),ce=Z),Rv({queryGeometry:le,size:ce,transform:k,unwrappedTileID:z,getElevation:V,pitchAlignment:oe,pitchScale:J},A)}}class t_ extends Ky{}let r_;Zt("HeatmapBucket",t_,{omit:["layers"]});var vS={get paint(){return r_=r_||new Ki({"heatmap-radius":new gr(Qe.paint_heatmap["heatmap-radius"]),"heatmap-weight":new gr(Qe.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new tr(Qe.paint_heatmap["heatmap-intensity"]),"heatmap-color":new ef(Qe.paint_heatmap["heatmap-color"]),"heatmap-opacity":new tr(Qe.paint_heatmap["heatmap-opacity"])})}};function kv(v,{width:h,height:g},x,A){if(A){if(A instanceof Uint8ClampedArray)A=new Uint8Array(A.buffer);else if(A.length!==h*g*x)throw new RangeError(`mismatched image size. expected: ${A.length} but got: ${h*g*x}`)}else A=new Uint8Array(h*g*x);return v.width=h,v.height=g,v.data=A,v}function Lv(v,{width:h,height:g},x){if(h===v.width&&g===v.height)return;const A=kv({},{width:h,height:g},x);Ov(v,A,{x:0,y:0},{x:0,y:0},{width:Math.min(v.width,h),height:Math.min(v.height,g)},x),v.width=h,v.height=g,v.data=A.data}function Ov(v,h,g,x,A,k){if(A.width===0||A.height===0)return h;if(A.width>v.width||A.height>v.height||g.x>v.width-A.width||g.y>v.height-A.height)throw new RangeError("out of range source coordinates for image copy");if(A.width>h.width||A.height>h.height||x.x>h.width-A.width||x.y>h.height-A.height)throw new RangeError("out of range destination coordinates for image copy");const L=v.data,z=h.data;if(L===z)throw new Error("srcData equals dstData, so image is already copied");for(let V=0;V<A.height;V++){const X=((g.y+V)*v.width+g.x)*k,Z=((x.y+V)*h.width+x.x)*k;for(let J=0;J<A.width*k;J++)z[Z+J]=L[X+J]}return h}class Up{constructor(h,g){kv(this,h,1,g)}resize(h){Lv(this,h,1)}clone(){return new Up({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(h,g,x,A,k){Ov(h,g,x,A,k,1)}}class io{constructor(h,g){kv(this,h,4,g)}resize(h){Lv(this,h,4)}replace(h,g){g?this.data.set(h):this.data=h instanceof Uint8ClampedArray?new Uint8Array(h.buffer):h}clone(){return new io({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(h,g,x,A,k){Ov(h,g,x,A,k,4)}setPixel(h,g,x){const A=4*(h*this.width+g);this.data[A+0]=Math.round(255*x.r/x.a),this.data[A+1]=Math.round(255*x.g/x.a),this.data[A+2]=Math.round(255*x.b/x.a),this.data[A+3]=Math.round(255*x.a)}}function Lb(v){const h={},g=v.resolution||256,x=v.clips?v.clips.length:1,A=v.image||new io({width:g,height:x});if(Math.log(g)/Math.LN2%1!=0)throw new Error(`width is not a power of 2 - ${g}`);const k=(L,z,V)=>{h[v.evaluationKey]=V;const X=v.expression.evaluate(h);A.setPixel(L/4/g,z/4,X)};if(v.clips)for(let L=0,z=0;L<x;++L,z+=4*g)for(let V=0,X=0;V<g;V++,X+=4){const Z=V/(g-1),{start:J,end:oe}=v.clips[L];k(z,X,J*(1-Z)+oe*Z)}else for(let L=0,z=0;L<g;L++,z+=4)k(0,z,L/(g-1));return A}Zt("AlphaImage",Up),Zt("RGBAImage",io);const nu="big-fb";class Ob extends _a{createBucket(h){return new t_(h)}constructor(h,g){super(h,vS,g),this.heatmapFbos=new Map,this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(h){h==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=Lb({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbos.has(nu)&&this.heatmapFbos.delete(nu)}queryRadius(h){return Id("heatmap-radius",this,h)}queryIntersectsFeature({queryGeometry:h,feature:g,featureState:x,geometry:A,transform:k,pixelsToTileUnits:L,unwrappedTileID:z,getElevation:V}){return Rv({queryGeometry:h,size:this.paint.get("heatmap-radius").evaluate(g,x)*L,transform:k,unwrappedTileID:z,getElevation:V},A)}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}}let mS;var yS={get paint(){return mS=mS||new Ki({"hillshade-illumination-direction":new tr(Qe.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-altitude":new tr(Qe.paint_hillshade["hillshade-illumination-altitude"]),"hillshade-illumination-anchor":new tr(Qe.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new tr(Qe.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new tr(Qe.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new tr(Qe.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new tr(Qe.paint_hillshade["hillshade-accent-color"]),"hillshade-method":new tr(Qe.paint_hillshade["hillshade-method"])})}};class nh extends _a{constructor(h,g){super(h,yS,g),this.recalculate({zoom:0,zoomHistory:{}},void 0)}getIlluminationProperties(){let h=this.paint.get("hillshade-illumination-direction").values,g=this.paint.get("hillshade-illumination-altitude").values,x=this.paint.get("hillshade-highlight-color").values,A=this.paint.get("hillshade-shadow-color").values;const k=Math.max(h.length,g.length,x.length,A.length);h=h.concat(Array(k-h.length).fill(h.at(-1))),g=g.concat(Array(k-g.length).fill(g.at(-1))),x=x.concat(Array(k-x.length).fill(x.at(-1))),A=A.concat(Array(k-A.length).fill(A.at(-1)));const L=g.map(Zf);return{directionRadians:h.map(Zf),altitudeRadians:L,shadowColor:A,highlightColor:x}}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}}let i_;var _S={get paint(){return i_=i_||new Ki({"color-relief-opacity":new tr(Qe["paint_color-relief"]["color-relief-opacity"]),"color-relief-color":new ef(Qe["paint_color-relief"]["color-relief-color"])})}};class Hp{constructor(h,g,x,A){this.context=h,this.format=x,this.texture=h.gl.createTexture(),this.update(g,A)}update(h,g,x){const{width:A,height:k}=h,L=!(this.size&&this.size[0]===A&&this.size[1]===k||x),{context:z}=this,{gl:V}=z;if(this.useMipmap=!!(g&&g.useMipmap),V.bindTexture(V.TEXTURE_2D,this.texture),z.pixelStoreUnpackFlipY.set(!1),z.pixelStoreUnpack.set(1),z.pixelStoreUnpackPremultiplyAlpha.set(this.format===V.RGBA&&(!g||g.premultiply!==!1)),L)this.size=[A,k],h instanceof HTMLImageElement||h instanceof HTMLCanvasElement||h instanceof HTMLVideoElement||h instanceof ImageData||Li(h)?V.texImage2D(V.TEXTURE_2D,0,this.format,this.format,V.UNSIGNED_BYTE,h):V.texImage2D(V.TEXTURE_2D,0,this.format,A,k,0,this.format,V.UNSIGNED_BYTE,h.data);else{const{x:X,y:Z}=x||{x:0,y:0};h instanceof HTMLImageElement||h instanceof HTMLCanvasElement||h instanceof HTMLVideoElement||h instanceof ImageData||Li(h)?V.texSubImage2D(V.TEXTURE_2D,0,X,Z,V.RGBA,V.UNSIGNED_BYTE,h):V.texSubImage2D(V.TEXTURE_2D,0,X,Z,A,k,V.RGBA,V.UNSIGNED_BYTE,h.data)}this.useMipmap&&this.isSizePowerOfTwo()&&V.generateMipmap(V.TEXTURE_2D),z.pixelStoreUnpackFlipY.setDefault(),z.pixelStoreUnpack.setDefault(),z.pixelStoreUnpackPremultiplyAlpha.setDefault()}bind(h,g,x){const{context:A}=this,{gl:k}=A;k.bindTexture(k.TEXTURE_2D,this.texture),x!==k.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(x=k.LINEAR),h!==this.filter&&(k.texParameteri(k.TEXTURE_2D,k.TEXTURE_MAG_FILTER,h),k.texParameteri(k.TEXTURE_2D,k.TEXTURE_MIN_FILTER,x||h),this.filter=h),g!==this.wrap&&(k.texParameteri(k.TEXTURE_2D,k.TEXTURE_WRAP_S,g),k.texParameteri(k.TEXTURE_2D,k.TEXTURE_WRAP_T,g),this.wrap=g)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:h}=this.context;h.deleteTexture(this.texture),this.texture=null}}class jp{constructor(h,g,x,A=1,k=1,L=1,z=0){if(this.uid=h,g.height!==g.width)throw new RangeError("DEM tiles must be square");if(x&&!["mapbox","terrarium","custom"].includes(x))return void dr(`"${x}" is not a valid encoding type. Valid types include "mapbox", "terrarium" and "custom".`);this.stride=g.height;const V=this.dim=g.height-2;switch(this.data=new Uint32Array(g.data.buffer),x){case"terrarium":this.redFactor=256,this.greenFactor=1,this.blueFactor=1/256,this.baseShift=32768;break;case"custom":this.redFactor=A,this.greenFactor=k,this.blueFactor=L,this.baseShift=z;break;default:this.redFactor=6553.6,this.greenFactor=25.6,this.blueFactor=.1,this.baseShift=1e4}for(let X=0;X<V;X++)this.data[this._idx(-1,X)]=this.data[this._idx(0,X)],this.data[this._idx(V,X)]=this.data[this._idx(V-1,X)],this.data[this._idx(X,-1)]=this.data[this._idx(X,0)],this.data[this._idx(X,V)]=this.data[this._idx(X,V-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(V,-1)]=this.data[this._idx(V-1,0)],this.data[this._idx(-1,V)]=this.data[this._idx(0,V-1)],this.data[this._idx(V,V)]=this.data[this._idx(V-1,V-1)],this.min=Number.MAX_SAFE_INTEGER,this.max=Number.MIN_SAFE_INTEGER;for(let X=0;X<V;X++)for(let Z=0;Z<V;Z++){const J=this.get(X,Z);J>this.max&&(this.max=J),J<this.min&&(this.min=J)}}get(h,g){const x=new Uint8Array(this.data.buffer),A=4*this._idx(h,g);return this.unpack(x[A],x[A+1],x[A+2])}getUnpackVector(){return[this.redFactor,this.greenFactor,this.blueFactor,this.baseShift]}_idx(h,g){if(h<-1||h>=this.dim+1||g<-1||g>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(g+1)*this.stride+(h+1)}unpack(h,g,x){return h*this.redFactor+g*this.greenFactor+x*this.blueFactor-this.baseShift}pack(h){return bn(h,this.getUnpackVector())}getPixels(){return new io({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(h,g,x){if(this.dim!==h.dim)throw new Error("dem dimension mismatch");let A=g*this.dim,k=g*this.dim+this.dim,L=x*this.dim,z=x*this.dim+this.dim;switch(g){case-1:A=k-1;break;case 1:k=A+1}switch(x){case-1:L=z-1;break;case 1:z=L+1}const V=-g*this.dim,X=-x*this.dim;for(let Z=L;Z<z;Z++)for(let J=A;J<k;J++)this.data[this._idx(J,Z)]=h.data[this._idx(J+V,Z+X)]}}function bn(v,h){const g=h[0],x=h[1],A=h[2],k=h[3],L=Math.min(g,x,A),z=Math.round((v+k)/L);return{r:Math.floor(z*L/g)%256,g:Math.floor(z*L/x)%256,b:Math.floor(z*L/A)%256}}Zt("DEMData",jp);class pM extends _a{constructor(h,g){super(h,_S,g)}_createColorRamp(h){const g={elevationStops:[],colorStops:[]},x=this._transitionablePaint._values["color-relief-color"].value.expression;if(x instanceof to&&x._styleExpression.expression instanceof na){this.colorRampExpression=x;const L=x._styleExpression.expression;g.elevationStops=L.labels,g.colorStops=[];for(const z of g.elevationStops)g.colorStops.push(L.evaluate({globals:{elevation:z}}))}if(g.elevationStops.length<1&&(g.elevationStops=[0],g.colorStops=[Zr.transparent]),g.elevationStops.length<2&&(g.elevationStops.push(g.elevationStops[0]+1),g.colorStops.push(g.colorStops[0])),g.elevationStops.length<=h)return g;const A={elevationStops:[],colorStops:[]},k=(g.elevationStops.length-1)/(h-1);for(let L=0;L<g.elevationStops.length-.5;L+=k)A.elevationStops.push(g.elevationStops[Math.round(L)]),A.colorStops.push(g.colorStops[Math.round(L)]);return dr(`Too many colors in specification of ${this.id} color-relief layer, may not render properly.`),A}_colorRampChanged(){return this.colorRampExpression!=this._transitionablePaint._values["color-relief-color"].value.expression}getColorRampTextures(h,g,x){if(this.colorRampTextures&&!this._colorRampChanged())return this.colorRampTextures;const A=this._createColorRamp(g),k=new io({width:A.colorStops.length,height:1}),L=new io({width:A.colorStops.length,height:1});for(let z=0;z<A.elevationStops.length;z++){const V=bn(A.elevationStops[z],x);L.setPixel(0,z,new Zr(V.r/255,V.g/255,V.b/255,1)),k.setPixel(0,z,A.colorStops[z])}return this.colorRampTextures={elevationTexture:new Hp(h,L,h.gl.RGBA),colorTexture:new Hp(h,k,h.gl.RGBA)},this.colorRampTextures}hasOffscreenPass(){return this.visibility!=="none"&&!!this.colorRampTextures}}const gM=Bi([{name:"a_pos",components:2,type:"Int16"}],4),{members:bS}=gM;function of(v,h,g){const x=g.patternDependencies;let A=!1;for(const k of h){const L=k.paint.get(`${v}-pattern`);L.isConstant()||(A=!0);const z=L.constantOr(null);z&&(A=!0,x[z.to]=!0,x[z.from]=!0)}return A}function qu(v,h,g,x,A){const{zoom:k}=x,L=A.patternDependencies;for(const z of h){const V=z.paint.get(`${v}-pattern`).value;if(V.kind!=="constant"){let X=V.evaluate({zoom:k-1},g,{},A.availableImages),Z=V.evaluate({zoom:k},g,{},A.availableImages),J=V.evaluate({zoom:k+1},g,{},A.availableImages);X=X&&X.name?X.name:X,Z=Z&&Z.name?Z.name:Z,J=J&&J.name?J.name:J,L[X]=!0,L[Z]=!0,L[J]=!0,g.patterns[z.id]={min:X,mid:Z,max:J}}}return g}function Nb(v,h,g,x,A){let k;if(A===(function(L,z,V,X){let Z=0;for(let J=z,oe=V-X;J<V;J+=X)Z+=(L[oe]-L[J])*(L[J+1]+L[oe+1]),oe=J;return Z})(v,h,g,x)>0)for(let L=h;L<g;L+=x)k=Ub(L/x|0,v[L],v[L+1],k);else for(let L=g-x;L>=h;L-=x)k=Ub(L/x|0,v[L],v[L+1],k);return k&&$p(k,k.next)&&(Wp(k),k=k.next),k}function sf(v,h){if(!v)return v;h||(h=v);let g,x=v;do if(g=!1,x.steiner||!$p(x,x.next)&&ci(x.prev,x,x.next)!==0)x=x.next;else{if(Wp(x),x=h=x.prev,x===x.next)break;g=!0}while(g||x!==h);return h}function ah(v,h,g,x,A,k,L){if(!v)return;!L&&k&&(function(V,X,Z,J){let oe=V;do oe.z===0&&(oe.z=a_(oe.x,oe.y,X,Z,J)),oe.prevZ=oe.prev,oe.nextZ=oe.next,oe=oe.next;while(oe!==V);oe.prevZ.nextZ=null,oe.prevZ=null,(function(le){let ce,ge=1;do{let be,Ee=le;le=null;let qe=null;for(ce=0;Ee;){ce++;let Oe=Ee,Ve=0;for(let gt=0;gt<ge&&(Ve++,Oe=Oe.nextZ,Oe);gt++);let ot=ge;for(;Ve>0||ot>0&&Oe;)Ve!==0&&(ot===0||!Oe||Ee.z<=Oe.z)?(be=Ee,Ee=Ee.nextZ,Ve--):(be=Oe,Oe=Oe.nextZ,ot--),qe?qe.nextZ=be:le=be,be.prevZ=qe,qe=be;Ee=Oe}qe.nextZ=null,ge*=2}while(ce>1)})(oe)})(v,x,A,k);let z=v;for(;v.prev!==v.next;){const V=v.prev,X=v.next;if(k?xS(v,x,A,k):Yu(v))h.push(V.i,v.i,X.i),Wp(v),v=X.next,z=X.next;else if((v=X)===z){L?L===1?ah(v=Bb(sf(v),h),h,g,x,A,k,2):L===2&&wS(v,h,g,x,A,k):ah(sf(v),h,g,x,A,k,1);break}}}function Yu(v){const h=v.prev,g=v,x=v.next;if(ci(h,g,x)>=0)return!1;const A=h.x,k=g.x,L=x.x,z=h.y,V=g.y,X=x.y,Z=Math.min(A,k,L),J=Math.min(z,V,X),oe=Math.max(A,k,L),le=Math.max(z,V,X);let ce=x.next;for(;ce!==h;){if(ce.x>=Z&&ce.x<=oe&&ce.y>=J&&ce.y<=le&&Pd(A,z,k,V,L,X,ce.x,ce.y)&&ci(ce.prev,ce,ce.next)>=0)return!1;ce=ce.next}return!0}function xS(v,h,g,x){const A=v.prev,k=v,L=v.next;if(ci(A,k,L)>=0)return!1;const z=A.x,V=k.x,X=L.x,Z=A.y,J=k.y,oe=L.y,le=Math.min(z,V,X),ce=Math.min(Z,J,oe),ge=Math.max(z,V,X),be=Math.max(Z,J,oe),Ee=a_(le,ce,h,g,x),qe=a_(ge,be,h,g,x);let Oe=v.prevZ,Ve=v.nextZ;for(;Oe&&Oe.z>=Ee&&Ve&&Ve.z<=qe;){if(Oe.x>=le&&Oe.x<=ge&&Oe.y>=ce&&Oe.y<=be&&Oe!==A&&Oe!==L&&Pd(z,Z,V,J,X,oe,Oe.x,Oe.y)&&ci(Oe.prev,Oe,Oe.next)>=0||(Oe=Oe.prevZ,Ve.x>=le&&Ve.x<=ge&&Ve.y>=ce&&Ve.y<=be&&Ve!==A&&Ve!==L&&Pd(z,Z,V,J,X,oe,Ve.x,Ve.y)&&ci(Ve.prev,Ve,Ve.next)>=0))return!1;Ve=Ve.nextZ}for(;Oe&&Oe.z>=Ee;){if(Oe.x>=le&&Oe.x<=ge&&Oe.y>=ce&&Oe.y<=be&&Oe!==A&&Oe!==L&&Pd(z,Z,V,J,X,oe,Oe.x,Oe.y)&&ci(Oe.prev,Oe,Oe.next)>=0)return!1;Oe=Oe.prevZ}for(;Ve&&Ve.z<=qe;){if(Ve.x>=le&&Ve.x<=ge&&Ve.y>=ce&&Ve.y<=be&&Ve!==A&&Ve!==L&&Pd(z,Z,V,J,X,oe,Ve.x,Ve.y)&&ci(Ve.prev,Ve,Ve.next)>=0)return!1;Ve=Ve.nextZ}return!0}function Bb(v,h){let g=v;do{const x=g.prev,A=g.next.next;!$p(x,A)&&Vb(x,g,g.next,A)&&Ha(x,A)&&Ha(A,x)&&(h.push(x.i,g.i,A.i),Wp(g),Wp(g.next),g=v=A),g=g.next}while(g!==v);return sf(g)}function wS(v,h,g,x,A,k){let L=v;do{let z=L.next.next;for(;z!==L.prev;){if(L.i!==z.i&&SS(L,z)){let V=Ku(L,z);return L=sf(L,L.next),V=sf(V,V.next),ah(L,h,g,x,A,k,0),void ah(V,h,g,x,A,k,0)}z=z.next}L=L.next}while(L!==v)}function zb(v,h){let g=v.x-h.x;return g===0&&(g=v.y-h.y,g===0)&&(g=(v.next.y-v.y)/(v.next.x-v.x)-(h.next.y-h.y)/(h.next.x-h.x)),g}function Fb(v,h){const g=(function(A,k){let L=k;const z=A.x,V=A.y;let X,Z=-1/0;if($p(A,L))return L;do{if($p(A,L.next))return L.next;if(V<=L.y&&V>=L.next.y&&L.next.y!==L.y){const ge=L.x+(V-L.y)*(L.next.x-L.x)/(L.next.y-L.y);if(ge<=z&&ge>Z&&(Z=ge,X=L.x<L.next.x?L:L.next,ge===z))return X}L=L.next}while(L!==k);if(!X)return null;const J=X,oe=X.x,le=X.y;let ce=1/0;L=X;do{if(z>=L.x&&L.x>=oe&&z!==L.x&&oa(V<le?z:Z,V,oe,le,V<le?Z:z,V,L.x,L.y)){const ge=Math.abs(V-L.y)/(z-L.x);Ha(L,A)&&(ge<ce||ge===ce&&(L.x>X.x||L.x===X.x&&n_(X,L)))&&(X=L,ce=ge)}L=L.next}while(L!==J);return X})(v,h);if(!g)return h;const x=Ku(g,v);return sf(x,x.next),sf(g,g.next)}function n_(v,h){return ci(v.prev,v,h.prev)<0&&ci(h.next,v,v.next)<0}function a_(v,h,g,x,A){return(v=1431655765&((v=858993459&((v=252645135&((v=16711935&((v=(v-g)*A|0)|v<<8))|v<<4))|v<<2))|v<<1))|(h=1431655765&((h=858993459&((h=252645135&((h=16711935&((h=(h-x)*A|0)|h<<8))|h<<4))|h<<2))|h<<1))<<1}function oh(v){let h=v,g=v;do(h.x<g.x||h.x===g.x&&h.y<g.y)&&(g=h),h=h.next;while(h!==v);return g}function oa(v,h,g,x,A,k,L,z){return(A-L)*(h-z)>=(v-L)*(k-z)&&(v-L)*(x-z)>=(g-L)*(h-z)&&(g-L)*(k-z)>=(A-L)*(x-z)}function Pd(v,h,g,x,A,k,L,z){return!(v===L&&h===z)&&oa(v,h,g,x,A,k,L,z)}function SS(v,h){return v.next.i!==h.i&&v.prev.i!==h.i&&!(function(g,x){let A=g;do{if(A.i!==g.i&&A.next.i!==g.i&&A.i!==x.i&&A.next.i!==x.i&&Vb(A,A.next,g,x))return!0;A=A.next}while(A!==g);return!1})(v,h)&&(Ha(v,h)&&Ha(h,v)&&(function(g,x){let A=g,k=!1;const L=(g.x+x.x)/2,z=(g.y+x.y)/2;do A.y>z!=A.next.y>z&&A.next.y!==A.y&&L<(A.next.x-A.x)*(z-A.y)/(A.next.y-A.y)+A.x&&(k=!k),A=A.next;while(A!==g);return k})(v,h)&&(ci(v.prev,v,h.prev)||ci(v,h.prev,h))||$p(v,h)&&ci(v.prev,v,v.next)>0&&ci(h.prev,h,h.next)>0)}function ci(v,h,g){return(h.y-v.y)*(g.x-h.x)-(h.x-v.x)*(g.y-h.y)}function $p(v,h){return v.x===h.x&&v.y===h.y}function Vb(v,h,g,x){const A=dn(ci(v,h,g)),k=dn(ci(v,h,x)),L=dn(ci(g,x,v)),z=dn(ci(g,x,h));return A!==k&&L!==z||!(A!==0||!Nv(v,g,h))||!(k!==0||!Nv(v,x,h))||!(L!==0||!Nv(g,v,x))||!(z!==0||!Nv(g,h,x))}function Nv(v,h,g){return h.x<=Math.max(v.x,g.x)&&h.x>=Math.min(v.x,g.x)&&h.y<=Math.max(v.y,g.y)&&h.y>=Math.min(v.y,g.y)}function dn(v){return v>0?1:v<0?-1:0}function Ha(v,h){return ci(v.prev,v,v.next)<0?ci(v,h,v.next)>=0&&ci(v,v.prev,h)>=0:ci(v,h,v.prev)<0||ci(v,v.next,h)<0}function Ku(v,h){const g=o_(v.i,v.x,v.y),x=o_(h.i,h.x,h.y),A=v.next,k=h.prev;return v.next=h,h.prev=v,g.next=A,A.prev=g,x.next=g,g.prev=x,k.next=x,x.prev=k,x}function Ub(v,h,g,x){const A=o_(v,h,g);return x?(A.next=x.next,A.prev=x,x.next.prev=A,x.next=A):(A.prev=A,A.next=A),A}function Wp(v){v.next.prev=v.prev,v.prev.next=v.next,v.prevZ&&(v.prevZ.nextZ=v.nextZ),v.nextZ&&(v.nextZ.prevZ=v.prevZ)}function o_(v,h,g){return{i:v,x:h,y:g,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}class Gp{constructor(h,g){if(g>h)throw new Error("Min granularity must not be greater than base granularity.");this._baseZoomGranularity=h,this._minGranularity=g}getGranularityForZoomLevel(h){return Math.max(Math.floor(this._baseZoomGranularity/(1<<h)),this._minGranularity,1)}}class Rd{constructor(h){this.fill=h.fill,this.line=h.line,this.tile=h.tile,this.stencil=h.stencil,this.circle=h.circle}}Rd.noSubdivision=new Rd({fill:new Gp(0,0),line:new Gp(0,0),tile:new Gp(0,0),stencil:new Gp(0,0),circle:1}),Zt("SubdivisionGranularityExpression",Gp),Zt("SubdivisionGranularitySetting",Rd);const Ia=-32768,Xo=32767;class TS{constructor(h,g){this._vertexBuffer=[],this._vertexDictionary=new Map,this._used=!1,this._granularity=h,this._granularityCellSize=je/h,this._canonical=g}_getKey(h,g){return(h+=32768)<<16|g+32768}_vertexToIndex(h,g){if(h<-32768||g<-32768||h>32767||g>32767)throw new Error("Vertex coordinates are out of signed 16 bit integer range.");const x=0|Math.round(h),A=0|Math.round(g),k=this._getKey(x,A);if(this._vertexDictionary.has(k))return this._vertexDictionary.get(k);const L=this._vertexBuffer.length/2;return this._vertexDictionary.set(k,L),this._vertexBuffer.push(x,A),L}_subdivideTrianglesScanline(h){if(this._granularity<2)return(function(A,k){const L=[];for(let z=0;z<k.length;z+=3){const V=k[z],X=k[z+1],Z=k[z+2],J=A[2*V],oe=A[2*V+1];(A[2*X]-J)*(A[2*Z+1]-oe)-(A[2*X+1]-oe)*(A[2*Z]-J)>0?(L.push(V),L.push(Z),L.push(X)):(L.push(V),L.push(X),L.push(Z))}return L})(this._vertexBuffer,h);const g=[],x=h.length;for(let A=0;A<x;A+=3){const k=[h[A+0],h[A+1],h[A+2]],L=[this._vertexBuffer[2*h[A+0]+0],this._vertexBuffer[2*h[A+0]+1],this._vertexBuffer[2*h[A+1]+0],this._vertexBuffer[2*h[A+1]+1],this._vertexBuffer[2*h[A+2]+0],this._vertexBuffer[2*h[A+2]+1]];let z=1/0,V=1/0,X=-1/0,Z=-1/0;for(let ge=0;ge<3;ge++){const be=L[2*ge],Ee=L[2*ge+1];z=Math.min(z,be),X=Math.max(X,be),V=Math.min(V,Ee),Z=Math.max(Z,Ee)}if(z===X||V===Z)continue;const J=Math.floor(z/this._granularityCellSize),oe=Math.ceil(X/this._granularityCellSize),le=Math.floor(V/this._granularityCellSize),ce=Math.ceil(Z/this._granularityCellSize);if(J!==oe||le!==ce)for(let ge=le;ge<ce;ge++){const be=this._scanlineGenerateVertexRingForCellRow(ge,L,k);sh(this._vertexBuffer,be,g)}else g.push(...k)}return g}_scanlineGenerateVertexRingForCellRow(h,g,x){const A=h*this._granularityCellSize,k=A+this._granularityCellSize,L=[];for(let z=0;z<3;z++){const V=g[2*z],X=g[2*z+1],Z=g[2*(z+1)%6],J=g[(2*(z+1)+1)%6],oe=g[2*(z+2)%6],le=g[(2*(z+2)+1)%6],ce=Z-V,ge=J-X,be=ce===0,Ee=ge===0,qe=(A-X)/ge,Oe=(k-X)/ge,Ve=Math.min(qe,Oe),ot=Math.max(qe,Oe);if(!Ee&&(Ve>=1||ot<=0)||Ee&&(X<A||X>k)){J>=A&&J<=k&&L.push(x[(z+1)%3]);continue}!Ee&&Ve>0&&L.push(this._vertexToIndex(V+ce*Ve,X+ge*Ve));const gt=V+ce*Math.max(Ve,0),Et=V+ce*Math.min(ot,1);be||this._generateIntraEdgeVertices(L,V,X,Z,J,gt,Et),!Ee&&ot<1&&L.push(this._vertexToIndex(V+ce*ot,X+ge*ot)),(Ee||J>=A&&J<=k)&&L.push(x[(z+1)%3]),!Ee&&(J<=A||J>=k)&&this._generateInterEdgeVertices(L,V,X,Z,J,oe,le,Et,A,k)}return L}_generateIntraEdgeVertices(h,g,x,A,k,L,z){const V=A-g,X=k-x,Z=X===0,J=Z?Math.min(g,A):Math.min(L,z),oe=Z?Math.max(g,A):Math.max(L,z),le=Math.floor(J/this._granularityCellSize)+1,ce=Math.ceil(oe/this._granularityCellSize)-1;if(Z?g<A:L<z)for(let ge=le;ge<=ce;ge++){const be=ge*this._granularityCellSize;h.push(this._vertexToIndex(be,x+X*(be-g)/V))}else for(let ge=ce;ge>=le;ge--){const be=ge*this._granularityCellSize;h.push(this._vertexToIndex(be,x+X*(be-g)/V))}}_generateInterEdgeVertices(h,g,x,A,k,L,z,V,X,Z){const J=k-x,oe=L-A,le=z-k,ce=(X-k)/le,ge=(Z-k)/le,be=Math.min(ce,ge),Ee=Math.max(ce,ge),qe=A+oe*be;let Oe=Math.floor(Math.min(qe,V)/this._granularityCellSize)+1,Ve=Math.ceil(Math.max(qe,V)/this._granularityCellSize)-1,ot=V<qe;const gt=le===0;if(gt&&(z===X||z===Z))return;if(gt||be>=1||Ee<=0){const Wt=x-z,Ft=L+(g-L)*Math.min((X-z)/Wt,(Z-z)/Wt);Oe=Math.floor(Math.min(Ft,V)/this._granularityCellSize)+1,Ve=Math.ceil(Math.max(Ft,V)/this._granularityCellSize)-1,ot=V<Ft}const Et=J>0?Z:X;if(ot)for(let Wt=Oe;Wt<=Ve;Wt++)h.push(this._vertexToIndex(Wt*this._granularityCellSize,Et));else for(let Wt=Ve;Wt>=Oe;Wt--)h.push(this._vertexToIndex(Wt*this._granularityCellSize,Et))}_generateOutline(h){const g=[];for(const x of h){const A=lf(x,this._granularity,!0),k=this._pointArrayToIndices(A),L=[];for(let z=1;z<k.length;z++)L.push(k[z-1]),L.push(k[z]);g.push(L)}return g}_handlePoles(h){let g=!1,x=!1;this._canonical&&(this._canonical.y===0&&(g=!0),this._canonical.y===(1<<this._canonical.z)-1&&(x=!0)),(g||x)&&this._fillPoles(h,g,x)}_ensureNoPoleVertices(){const h=this._vertexBuffer;for(let g=0;g<h.length;g+=2){const x=h[g+1];x===Ia&&(h[g+1]=-32767),x===Xo&&(h[g+1]=32766)}}_generatePoleQuad(h,g,x,A,k,L){A>k!=(L===Ia)?(h.push(g),h.push(x),h.push(this._vertexToIndex(A,L)),h.push(x),h.push(this._vertexToIndex(k,L)),h.push(this._vertexToIndex(A,L))):(h.push(x),h.push(g),h.push(this._vertexToIndex(A,L)),h.push(this._vertexToIndex(k,L)),h.push(x),h.push(this._vertexToIndex(A,L)))}_fillPoles(h,g,x){const A=this._vertexBuffer,k=je,L=h.length;for(let z=2;z<L;z+=3){const V=h[z-2],X=h[z-1],Z=h[z],J=A[2*V],oe=A[2*V+1],le=A[2*X],ce=A[2*X+1],ge=A[2*Z],be=A[2*Z+1];g&&(oe===0&&ce===0&&this._generatePoleQuad(h,V,X,J,le,Ia),ce===0&&be===0&&this._generatePoleQuad(h,X,Z,le,ge,Ia),be===0&&oe===0&&this._generatePoleQuad(h,Z,V,ge,J,Ia)),x&&(oe===k&&ce===k&&this._generatePoleQuad(h,V,X,J,le,Xo),ce===k&&be===k&&this._generatePoleQuad(h,X,Z,le,ge,Xo),be===k&&oe===k&&this._generatePoleQuad(h,Z,V,ge,J,Xo))}}_initializeVertices(h){for(let g=0;g<h.length;g+=2)this._vertexToIndex(h[g],h[g+1])}subdividePolygonInternal(h,g){if(this._used)throw new Error("Subdivision: multiple use not allowed.");this._used=!0;const{flattened:x,holeIndices:A}=(function(z){const V=[],X=[];for(const Z of z)if(Z.length!==0){Z!==z[0]&&V.push(X.length/2);for(let J=0;J<Z.length;J++)X.push(Z[J].x),X.push(Z[J].y)}return{flattened:X,holeIndices:V}})(h);let k;this._initializeVertices(x);try{const z=(function(X,Z,J=2){const oe=Z&&Z.length,le=oe?Z[0]*J:X.length;let ce=Nb(X,0,le,J,!0);const ge=[];if(!ce||ce.next===ce.prev)return ge;let be,Ee,qe;if(oe&&(ce=(function(Oe,Ve,ot,gt){const Et=[];for(let Wt=0,Ft=Ve.length;Wt<Ft;Wt++){const Ht=Nb(Oe,Ve[Wt]*gt,Wt<Ft-1?Ve[Wt+1]*gt:Oe.length,gt,!1);Ht===Ht.next&&(Ht.steiner=!0),Et.push(oh(Ht))}Et.sort(zb);for(let Wt=0;Wt<Et.length;Wt++)ot=Fb(Et[Wt],ot);return ot})(X,Z,ce,J)),X.length>80*J){be=X[0],Ee=X[1];let Oe=be,Ve=Ee;for(let ot=J;ot<le;ot+=J){const gt=X[ot],Et=X[ot+1];gt<be&&(be=gt),Et<Ee&&(Ee=Et),gt>Oe&&(Oe=gt),Et>Ve&&(Ve=Et)}qe=Math.max(Oe-be,Ve-Ee),qe=qe!==0?32767/qe:0}return ah(ce,ge,J,be,Ee,qe,0),ge})(x,A),V=this._convertIndices(x,z);k=this._subdivideTrianglesScanline(V)}catch(z){console.error(z)}let L=[];return g&&(L=this._generateOutline(h)),this._ensureNoPoleVertices(),this._handlePoles(k),{verticesFlattened:this._vertexBuffer,indicesTriangles:k,indicesLineList:L}}_convertIndices(h,g){const x=[];for(let A=0;A<g.length;A++)x.push(this._vertexToIndex(h[2*g[A]],h[2*g[A]+1]));return x}_pointArrayToIndices(h){const g=[];for(let x=0;x<h.length;x++){const A=h[x];g.push(this._vertexToIndex(A.x,A.y))}return g}}function Zo(v,h,g,x=!0){return new TS(g,h).subdividePolygonInternal(v,x)}function lf(v,h,g=!1){if(!v||v.length<1)return[];if(v.length<2)return[];const x=v[0],A=v[v.length-1],k=g&&(x.x!==A.x||x.y!==A.y);if(h<2)return k?[...v,v[0]]:[...v];const L=Math.floor(je/h),z=[];z.push(new l(v[0].x,v[0].y));const V=v.length,X=k?V:V-1;for(let Z=0;Z<X;Z++){const J=v[Z],oe=Z<V-1?v[Z+1]:v[0],le=J.x,ce=J.y,ge=oe.x,be=oe.y,Ee=le!==ge,qe=ce!==be;if(!Ee&&!qe)continue;const Oe=ge-le,Ve=be-ce,ot=Math.abs(Oe),gt=Math.abs(Ve);let Et=le,Wt=ce;for(;;){const Ht=Oe>0?(Math.floor(Et/L)+1)*L:(Math.ceil(Et/L)-1)*L,ur=Ve>0?(Math.floor(Wt/L)+1)*L:(Math.ceil(Wt/L)-1)*L,Ut=Math.abs(Et-Ht),jt=Math.abs(Wt-ur),Tt=Math.abs(Et-ge),xr=Math.abs(Wt-be),Er=Ee?Ut/ot:Number.POSITIVE_INFINITY,vr=qe?jt/gt:Number.POSITIVE_INFINITY;if((Tt<=Ut||!Ee)&&(xr<=jt||!qe))break;if(Er<vr&&Ee||!qe){Et=Ht,Wt+=Ve*Er;const ar=new l(Et,Math.round(Wt));z[z.length-1].x===ar.x&&z[z.length-1].y===ar.y||z.push(ar)}else{Et+=Oe*vr,Wt=ur;const ar=new l(Math.round(Et),Wt);z[z.length-1].x===ar.x&&z[z.length-1].y===ar.y||z.push(ar)}}const Ft=new l(ge,be);z[z.length-1].x===Ft.x&&z[z.length-1].y===Ft.y||z.push(Ft)}return z}function sh(v,h,g){if(h.length===0)throw new Error("Subdivision vertex ring is empty.");let x=0,A=v[2*h[0]];for(let V=1;V<h.length;V++){const X=v[2*h[V]];X<A&&(A=X,x=V)}const k=h.length;let L=x,z=(L+1)%k;for(;;){const V=L-1>=0?L-1:k-1,X=(z+1)%k,Z=v[2*h[V]],J=v[2*h[X]],oe=v[2*h[L]],le=v[2*h[L]+1],ce=v[2*h[z]+1];let ge=!1;if(Z<J)ge=!0;else if(Z>J)ge=!1;else{const be=ce-le,Ee=-(v[2*h[z]]-oe),qe=le<ce?1:-1;((Z-oe)*be+(v[2*h[V]+1]-le)*Ee)*qe>((J-oe)*be+(v[2*h[X]+1]-le)*Ee)*qe&&(ge=!0)}if(ge){const be=h[V],Ee=h[L],qe=h[z];be!==Ee&&be!==qe&&Ee!==qe&&g.push(qe,Ee,be),L--,L<0&&(L=k-1)}else{const be=h[X],Ee=h[L],qe=h[z];be!==Ee&&be!==qe&&Ee!==qe&&g.push(qe,Ee,be),z++,z>=k&&(z=0)}if(V===X)break}}function uf(v,h,g,x,A,k,L,z,V){const X=A.length/2,Z=L&&z&&V;if(X<Jr.MAX_VERTEX_ARRAY_LENGTH){const J=h.prepareSegment(X,g,x),oe=J.vertexLength;for(let ge=0;ge<k.length;ge+=3)x.emplaceBack(oe+k[ge],oe+k[ge+1],oe+k[ge+2]);let le,ce;J.vertexLength+=X,J.primitiveLength+=k.length/3,Z&&(ce=L.prepareSegment(X,g,z),le=ce.vertexLength,ce.vertexLength+=X);for(let ge=0;ge<A.length;ge+=2)v(A[ge],A[ge+1]);if(Z)for(let ge=0;ge<V.length;ge++){const be=V[ge];for(let Ee=1;Ee<be.length;Ee+=2)z.emplaceBack(le+be[Ee-1],le+be[Ee]);ce.primitiveLength+=be.length/2}}else(function(J,oe,le,ce,ge,be){const Ee=[];for(let gt=0;gt<ce.length/2;gt++)Ee.push(-1);const qe={count:0};let Oe=0,Ve=J.getOrCreateLatestSegment(oe,le),ot=Ve.vertexLength;for(let gt=2;gt<ge.length;gt+=3){const Et=ge[gt-2],Wt=ge[gt-1],Ft=ge[gt];let Ht=Ee[Et]<Oe,ur=Ee[Wt]<Oe,Ut=Ee[Ft]<Oe;Ve.vertexLength+((Ht?1:0)+(ur?1:0)+(Ut?1:0))>Jr.MAX_VERTEX_ARRAY_LENGTH&&(Ve=J.createNewSegment(oe,le),Oe=qe.count,Ht=!0,ur=!0,Ut=!0,ot=0);const jt=Ys(Ee,ce,be,qe,Et,Ht,Ve),Tt=Ys(Ee,ce,be,qe,Wt,ur,Ve),xr=Ys(Ee,ce,be,qe,Ft,Ut,Ve);le.emplaceBack(ot+jt-Oe,ot+Tt-Oe,ot+xr-Oe),Ve.primitiveLength++}})(h,g,x,A,k,v),Z&&(function(J,oe,le,ce,ge,be){const Ee=[];for(let gt=0;gt<ce.length/2;gt++)Ee.push(-1);const qe={count:0};let Oe=0,Ve=J.getOrCreateLatestSegment(oe,le),ot=Ve.vertexLength;for(let gt=0;gt<ge.length;gt++){const Et=ge[gt];for(let Wt=1;Wt<ge[gt].length;Wt+=2){const Ft=Et[Wt-1],Ht=Et[Wt];let ur=Ee[Ft]<Oe,Ut=Ee[Ht]<Oe;Ve.vertexLength+((ur?1:0)+(Ut?1:0))>Jr.MAX_VERTEX_ARRAY_LENGTH&&(Ve=J.createNewSegment(oe,le),Oe=qe.count,ur=!0,Ut=!0,ot=0);const jt=Ys(Ee,ce,be,qe,Ft,ur,Ve),Tt=Ys(Ee,ce,be,qe,Ht,Ut,Ve);le.emplaceBack(ot+jt-Oe,ot+Tt-Oe),Ve.primitiveLength++}}})(L,g,z,A,V,v),h.forceNewSegmentOnNextPrepare(),L?.forceNewSegmentOnNextPrepare()}function Ys(v,h,g,x,A,k,L){if(k){const z=x.count;return g(h[2*A],h[2*A+1]),v[A]=x.count,x.count++,L.vertexLength++,z}return v[A]}class Bv{constructor(h){this.zoom=h.zoom,this.overscaling=h.overscaling,this.layers=h.layers,this.layerIds=this.layers.map((g=>g.id)),this.index=h.index,this.hasDependencies=!1,this.patternFeatures=[],this.layoutVertexArray=new Xe,this.indexArray=new Mi,this.indexArray2=new Ei,this.programConfigurations=new Cl(h.layers,h.zoom),this.segments=new Jr,this.segments2=new Jr,this.stateDependentLayerIds=this.layers.filter((g=>g.isStateDependent())).map((g=>g.id))}populate(h,g,x){this.hasDependencies=of("fill",this.layers,g);const A=this.layers[0].layout.get("fill-sort-key"),k=!A.isConstant(),L=[];for(const{feature:z,id:V,index:X,sourceLayerIndex:Z}of h){const J=this.layers[0]._featureFilter.needGeometry,oe=qs(z,J);if(!this.layers[0]._featureFilter.filter(new Ni(this.zoom),oe,x))continue;const le=k?A.evaluate(oe,{},x,g.availableImages):void 0,ce={id:V,properties:z.properties,type:z.type,sourceLayerIndex:Z,index:X,geometry:J?oe.geometry:nf(z),patterns:{},sortKey:le};L.push(ce)}k&&L.sort(((z,V)=>z.sortKey-V.sortKey));for(const z of L){const{geometry:V,index:X,sourceLayerIndex:Z}=z;if(this.hasDependencies){const J=qu("fill",this.layers,z,{zoom:this.zoom},g);this.patternFeatures.push(J)}else this.addFeature(z,V,X,x,{},g.subdivisionGranularity);g.featureIndex.insert(h[X].feature,V,X,Z,this.index)}}update(h,g,x){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(h,g,this.stateDependentLayers,{imagePositions:x})}addFeatures(h,g,x){for(const A of this.patternFeatures)this.addFeature(A,A.geometry,A.index,g,x,h.subdivisionGranularity)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(h){this.uploaded||(this.layoutVertexBuffer=h.createVertexBuffer(this.layoutVertexArray,bS),this.indexBuffer=h.createIndexBuffer(this.indexArray),this.indexBuffer2=h.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(h),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(h,g,x,A,k,L){for(const z of nd(g,500)){const V=Zo(z,A,L.fill.getGranularityForZoomLevel(A.z)),X=this.layoutVertexArray;uf(((Z,J)=>{X.emplaceBack(Z,J)}),this.segments,this.layoutVertexArray,this.indexArray,V.verticesFlattened,V.indicesTriangles,this.segments2,this.indexArray2,V.indicesLineList)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,h,x,{imagePositions:k,canonical:A})}}let s_,Ml;Zt("FillBucket",Bv,{omit:["layers","patternFeatures"]});var AS={get paint(){return Ml=Ml||new Ki({"fill-antialias":new tr(Qe.paint_fill["fill-antialias"]),"fill-opacity":new gr(Qe.paint_fill["fill-opacity"]),"fill-color":new gr(Qe.paint_fill["fill-color"]),"fill-outline-color":new gr(Qe.paint_fill["fill-outline-color"]),"fill-translate":new tr(Qe.paint_fill["fill-translate"]),"fill-translate-anchor":new tr(Qe.paint_fill["fill-translate-anchor"]),"fill-pattern":new Jc(Qe.paint_fill["fill-pattern"])})},get layout(){return s_=s_||new Ki({"fill-sort-key":new gr(Qe.layout_fill["fill-sort-key"])})}};class Xp extends _a{constructor(h,g){super(h,AS,g)}recalculate(h,g){super.recalculate(h,g);const x=this.paint._values["fill-outline-color"];x.value.kind==="constant"&&x.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(h){return new Bv(h)}queryRadius(){return Pv(this.paint.get("fill-translate"))}queryIntersectsFeature({queryGeometry:h,geometry:g,transform:x,pixelsToTileUnits:A}){return Qy(af(h,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),-x.bearingInRadians,A),g)}isTileClipped(){return!0}}const zv=Bi([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4),Fv=Bi([{name:"a_centroid",components:2,type:"Int16"}],4),{members:Zp}=zv;class Dd{constructor(h,g,x,A,k){this.properties={},this.extent=x,this.type=0,this.id=void 0,this._pbf=h,this._geometry=-1,this._keys=A,this._values=k,h.readFields(CS,this,g)}loadGeometry(){const h=this._pbf;h.pos=this._geometry;const g=h.readVarint()+h.pos,x=[];let A,k=1,L=0,z=0,V=0;for(;h.pos<g;){if(L<=0){const X=h.readVarint();k=7&X,L=X>>3}if(L--,k===1||k===2)z+=h.readSVarint(),V+=h.readSVarint(),k===1&&(A&&x.push(A),A=[]),A&&A.push(new l(z,V));else{if(k!==7)throw new Error(`unknown command ${k}`);A&&A.push(A[0].clone())}}return A&&x.push(A),x}bbox(){const h=this._pbf;h.pos=this._geometry;const g=h.readVarint()+h.pos;let x=1,A=0,k=0,L=0,z=1/0,V=-1/0,X=1/0,Z=-1/0;for(;h.pos<g;){if(A<=0){const J=h.readVarint();x=7&J,A=J>>3}if(A--,x===1||x===2)k+=h.readSVarint(),L+=h.readSVarint(),k<z&&(z=k),k>V&&(V=k),L<X&&(X=L),L>Z&&(Z=L);else if(x!==7)throw new Error(`unknown command ${x}`)}return[z,X,V,Z]}toGeoJSON(h,g,x){const A=this.extent*Math.pow(2,x),k=this.extent*h,L=this.extent*g,z=this.loadGeometry();function V(oe){return[360*(oe.x+k)/A-180,360/Math.PI*Math.atan(Math.exp((1-2*(oe.y+L)/A)*Math.PI))-90]}function X(oe){return oe.map(V)}let Z;if(this.type===1){const oe=[];for(const ce of z)oe.push(ce[0]);const le=X(oe);Z=oe.length===1?{type:"Point",coordinates:le[0]}:{type:"MultiPoint",coordinates:le}}else if(this.type===2){const oe=z.map(X);Z=oe.length===1?{type:"LineString",coordinates:oe[0]}:{type:"MultiLineString",coordinates:oe}}else{if(this.type!==3)throw new Error("unknown feature type");{const oe=(function(ce){const ge=ce.length;if(ge<=1)return[ce];const be=[];let Ee,qe;for(let Oe=0;Oe<ge;Oe++){const Ve=Vv(ce[Oe]);Ve!==0&&(qe===void 0&&(qe=Ve<0),qe===Ve<0?(Ee&&be.push(Ee),Ee=[ce[Oe]]):Ee&&Ee.push(ce[Oe]))}return Ee&&be.push(Ee),be})(z),le=[];for(const ce of oe)le.push(ce.map(X));Z=le.length===1?{type:"Polygon",coordinates:le[0]}:{type:"MultiPolygon",coordinates:le}}}const J={type:"Feature",geometry:Z,properties:this.properties};return this.id!=null&&(J.id=this.id),J}}function CS(v,h,g){v===1?h.id=g.readVarint():v===2?(function(x,A){const k=x.readVarint()+x.pos;for(;x.pos<k;){const L=A._keys[x.readVarint()],z=A._values[x.readVarint()];A.properties[L]=z}})(g,h):v===3?h.type=g.readVarint():v===4&&(h._geometry=g.pos)}function Vv(v){let h=0;for(let g,x,A=0,k=v.length,L=k-1;A<k;L=A++)g=v[A],x=v[L],h+=(x.x-g.x)*(g.y+x.y);return h}Dd.types=["Unknown","Point","LineString","Polygon"];class Hb{constructor(h,g){this.version=1,this.name="",this.extent=4096,this.length=0,this._pbf=h,this._keys=[],this._values=[],this._features=[],h.readFields(l_,this,g),this.length=this._features.length}feature(h){if(h<0||h>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[h];const g=this._pbf.readVarint()+this._pbf.pos;return new Dd(this._pbf,g,this.extent,this._keys,this._values)}}function l_(v,h,g){v===15?h.version=g.readVarint():v===1?h.name=g.readString():v===5?h.extent=g.readVarint():v===2?h._features.push(g.pos):v===3?h._keys.push(g.readString()):v===4&&h._values.push((function(x){let A=null;const k=x.readVarint()+x.pos;for(;x.pos<k;){const L=x.readVarint()>>3;A=L===1?x.readString():L===2?x.readFloat():L===3?x.readDouble():L===4?x.readVarint64():L===5?x.readVarint():L===6?x.readSVarint():L===7?x.readBoolean():null}if(A==null)throw new Error("unknown feature value");return A})(g))}class jb{constructor(h,g){this.layers=h.readFields(vM,{},g)}}function vM(v,h,g){if(v===3){const x=new Hb(g,g.readVarint()+g.pos);x.length&&(h[x.name]=x)}}const $b=Math.pow(2,13);function Ci(v,h,g,x,A,k,L,z){v.emplaceBack(h,g,2*Math.floor(x*$b)+L,A*$b*2,k*$b*2,Math.round(z))}class en{constructor(h){this.zoom=h.zoom,this.overscaling=h.overscaling,this.layers=h.layers,this.layerIds=this.layers.map((g=>g.id)),this.index=h.index,this.hasDependencies=!1,this.layoutVertexArray=new ht,this.centroidVertexArray=new He,this.indexArray=new Mi,this.programConfigurations=new Cl(h.layers,h.zoom),this.segments=new Jr,this.stateDependentLayerIds=this.layers.filter((g=>g.isStateDependent())).map((g=>g.id))}populate(h,g,x){this.features=[],this.hasDependencies=of("fill-extrusion",this.layers,g);for(const{feature:A,id:k,index:L,sourceLayerIndex:z}of h){const V=this.layers[0]._featureFilter.needGeometry,X=qs(A,V);if(!this.layers[0]._featureFilter.filter(new Ni(this.zoom),X,x))continue;const Z={id:k,sourceLayerIndex:z,index:L,geometry:V?X.geometry:nf(A),properties:A.properties,type:A.type,patterns:{}};this.hasDependencies?this.features.push(qu("fill-extrusion",this.layers,Z,{zoom:this.zoom},g)):this.addFeature(Z,Z.geometry,L,x,{},g.subdivisionGranularity),g.featureIndex.insert(A,Z.geometry,L,z,this.index,!0)}}addFeatures(h,g,x){for(const A of this.features){const{geometry:k}=A;this.addFeature(A,k,A.index,g,x,h.subdivisionGranularity)}}update(h,g,x){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(h,g,this.stateDependentLayers,{imagePositions:x})}isEmpty(){return this.layoutVertexArray.length===0&&this.centroidVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(h){this.uploaded||(this.layoutVertexBuffer=h.createVertexBuffer(this.layoutVertexArray,Zp),this.centroidVertexBuffer=h.createVertexBuffer(this.centroidVertexArray,Fv.members,!0),this.indexBuffer=h.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(h),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.centroidVertexBuffer.destroy())}addFeature(h,g,x,A,k,L){for(const z of nd(g,500)){const V={x:0,y:0,sampleCount:0},X=this.layoutVertexArray.length;this.processPolygon(V,A,h,z,L);const Z=this.layoutVertexArray.length-X,J=Math.floor(V.x/V.sampleCount),oe=Math.floor(V.y/V.sampleCount);for(let le=0;le<Z;le++)this.centroidVertexArray.emplaceBack(J,oe)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,h,x,{imagePositions:k,canonical:A})}processPolygon(h,g,x,A,k){if(A.length<1||Wi(A[0]))return;for(const J of A)J.length!==0&&_i(h,J);const L={segment:this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray)},z=k.fill.getGranularityForZoomLevel(g.z),V=Dd.types[x.type]==="Polygon";for(const J of A){if(J.length===0||Wi(J))continue;const oe=lf(J,z,V);this._generateSideFaces(oe,L)}if(!V)return;const X=Zo(A,g,z,!1),Z=this.layoutVertexArray;uf(((J,oe)=>{Ci(Z,J,oe,0,0,1,1,0)}),this.segments,this.layoutVertexArray,this.indexArray,X.verticesFlattened,X.indicesTriangles)}_generateSideFaces(h,g){let x=0;for(let A=1;A<h.length;A++){const k=h[A],L=h[A-1];if(xi(k,L))continue;g.segment.vertexLength+4>Jr.MAX_VERTEX_ARRAY_LENGTH&&(g.segment=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const z=k.sub(L)._perp()._unit(),V=L.dist(k);x+V>32768&&(x=0),Ci(this.layoutVertexArray,k.x,k.y,z.x,z.y,0,0,x),Ci(this.layoutVertexArray,k.x,k.y,z.x,z.y,0,1,x),x+=V,Ci(this.layoutVertexArray,L.x,L.y,z.x,z.y,0,0,x),Ci(this.layoutVertexArray,L.x,L.y,z.x,z.y,0,1,x);const X=g.segment.vertexLength;this.indexArray.emplaceBack(X,X+2,X+1),this.indexArray.emplaceBack(X+1,X+2,X+3),g.segment.vertexLength+=4,g.segment.primitiveLength+=2}}}function _i(v,h){for(let g=0;g<h.length;g++){const x=h[g];g===h.length-1&&h[0].x===x.x&&h[0].y===x.y||(v.x+=x.x,v.y+=x.y,v.sampleCount++)}}function xi(v,h){return v.x===h.x&&(v.x<0||v.x>je)||v.y===h.y&&(v.y<0||v.y>je)}function Wi(v){return v.every((h=>h.x<0))||v.every((h=>h.x>je))||v.every((h=>h.y<0))||v.every((h=>h.y>je))}let fs;Zt("FillExtrusionBucket",en,{omit:["layers","features"]});var cf={get paint(){return fs=fs||new Ki({"fill-extrusion-opacity":new tr(Qe["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new gr(Qe["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new tr(Qe["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new tr(Qe["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new Jc(Qe["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new gr(Qe["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new gr(Qe["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new tr(Qe["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})}};class qp extends _a{constructor(h,g){super(h,cf,g)}createBucket(h){return new en(h)}queryRadius(){return Pv(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}queryIntersectsFeature({queryGeometry:h,feature:g,featureState:x,geometry:A,transform:k,pixelsToTileUnits:L,pixelPosMatrix:z}){const V=af(h,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),-k.bearingInRadians,L),X=this.paint.get("fill-extrusion-height").evaluate(g,x),Z=this.paint.get("fill-extrusion-base").evaluate(g,x),J=(function(le,ce){const ge=[];for(const be of le){const Ee=[be.x,be.y,0,1];ye(Ee,Ee,ce),ge.push(new l(Ee[0]/Ee[3],Ee[1]/Ee[3]))}return ge})(V,z),oe=(function(le,ce,ge,be){const Ee=[],qe=[],Oe=be[8]*ce,Ve=be[9]*ce,ot=be[10]*ce,gt=be[11]*ce,Et=be[8]*ge,Wt=be[9]*ge,Ft=be[10]*ge,Ht=be[11]*ge;for(const ur of le){const Ut=[],jt=[];for(const Tt of ur){const xr=Tt.x,Er=Tt.y,vr=be[0]*xr+be[4]*Er+be[12],ar=be[1]*xr+be[5]*Er+be[13],Yr=be[2]*xr+be[6]*Er+be[14],on=be[3]*xr+be[7]*Er+be[15],Fn=Yr+ot,Ra=on+gt,Ko=vr+Et,qn=ar+Wt,xn=Yr+Ft,ki=on+Ht,Nn=new l((vr+Oe)/Ra,(ar+Ve)/Ra);Nn.z=Fn/Ra,Ut.push(Nn);const Vn=new l(Ko/ki,qn/ki);Vn.z=xn/ki,jt.push(Vn)}Ee.push(Ut),qe.push(jt)}return[Ee,qe]})(A,Z,X,z);return(function(le,ce,ge){let be=1/0;Qy(ge,ce)&&(be=Qu(ge,ce[0]));for(let Ee=0;Ee<ce.length;Ee++){const qe=ce[Ee],Oe=le[Ee];for(let Ve=0;Ve<qe.length-1;Ve++){const ot=qe[Ve],gt=[ot,qe[Ve+1],Oe[Ve+1],Oe[Ve],ot];Mv(ge,gt)&&(be=Math.min(be,Qu(ge,gt)))}}return be!==1/0&&be})(oe[0],oe[1],J)}}function kd(v,h){return v.x*h.x+v.y*h.y}function Qu(v,h){if(v.length===1){let g=0;const x=h[g++];let A;for(;!A||x.equals(A);)if(A=h[g++],!A)return 1/0;for(;g<h.length;g++){const k=h[g],L=v[0],z=A.sub(x),V=k.sub(x),X=L.sub(x),Z=kd(z,z),J=kd(z,V),oe=kd(V,V),le=kd(X,z),ce=kd(X,V),ge=Z*oe-J*J,be=(oe*le-J*ce)/ge,Ee=(Z*ce-J*le)/ge,qe=x.z*(1-be-Ee)+A.z*be+k.z*Ee;if(isFinite(qe))return qe}return 1/0}{let g=1/0;for(const x of h)g=Math.min(g,x.z);return g}}const Zn=Bi([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4),{members:hf}=Zn,Ld=Bi([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]),{members:Wb}=Ld,Ks=Math.cos(Math.PI/180*37.5),Od=Math.pow(2,14)/.5;class Nd{constructor(h){this.zoom=h.zoom,this.overscaling=h.overscaling,this.layers=h.layers,this.layerIds=this.layers.map((g=>g.id)),this.index=h.index,this.hasDependencies=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach((g=>{this.gradients[g.id]={}})),this.layoutVertexArray=new at,this.layoutVertexArray2=new st,this.indexArray=new Mi,this.programConfigurations=new Cl(h.layers,h.zoom),this.segments=new Jr,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter((g=>g.isStateDependent())).map((g=>g.id))}populate(h,g,x){this.hasDependencies=of("line",this.layers,g)||this.hasLineDasharray(this.layers);const A=this.layers[0].layout.get("line-sort-key"),k=!A.isConstant(),L=[];for(const{feature:z,id:V,index:X,sourceLayerIndex:Z}of h){const J=this.layers[0]._featureFilter.needGeometry,oe=qs(z,J);if(!this.layers[0]._featureFilter.filter(new Ni(this.zoom),oe,x))continue;const le=k?A.evaluate(oe,{},x):void 0,ce={id:V,properties:z.properties,type:z.type,sourceLayerIndex:Z,index:X,geometry:J?oe.geometry:nf(z),patterns:{},dashes:{},sortKey:le};L.push(ce)}k&&L.sort(((z,V)=>z.sortKey-V.sortKey));for(const z of L){const{geometry:V,index:X,sourceLayerIndex:Z}=z;this.hasDependencies?(of("line",this.layers,g)?qu("line",this.layers,z,{zoom:this.zoom},g):this.hasLineDasharray(this.layers)&&this.addLineDashDependencies(this.layers,z,this.zoom,g),this.patternFeatures.push(z)):this.addFeature(z,V,X,x,{},{},g.subdivisionGranularity),g.featureIndex.insert(h[X].feature,V,X,Z,this.index)}}update(h,g,x,A){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(h,g,this.stateDependentLayers,{imagePositions:x,dashPositions:A})}addFeatures(h,g,x,A){for(const k of this.patternFeatures)this.addFeature(k,k.geometry,k.index,g,x,A,h.subdivisionGranularity)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(h){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=h.createVertexBuffer(this.layoutVertexArray2,Wb)),this.layoutVertexBuffer=h.createVertexBuffer(this.layoutVertexArray,hf),this.indexBuffer=h.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(h),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(h){if(h.properties&&Object.prototype.hasOwnProperty.call(h.properties,"mapbox_clip_start")&&Object.prototype.hasOwnProperty.call(h.properties,"mapbox_clip_end"))return{start:+h.properties.mapbox_clip_start,end:+h.properties.mapbox_clip_end}}addFeature(h,g,x,A,k,L,z){const V=this.layers[0].layout,X=V.get("line-join").evaluate(h,{}),Z=V.get("line-cap"),J=V.get("line-miter-limit"),oe=V.get("line-round-limit");this.lineClips=this.lineFeatureClips(h);for(const le of g)this.addLine(le,h,X,Z,J,oe,A,z);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,h,x,{imagePositions:k,dashPositions:L,canonical:A})}addLine(h,g,x,A,k,L,z,V){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,h=lf(h,z?V.line.getGranularityForZoomLevel(z.z):1),this.lineClips){this.lineClipsArray.push(this.lineClips);for(let Oe=0;Oe<h.length-1;Oe++)this.totalDistance+=h[Oe].dist(h[Oe+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const X=Dd.types[g.type]==="Polygon";let Z=h.length;for(;Z>=2&&h[Z-1].equals(h[Z-2]);)Z--;let J=0;for(;J<Z-1&&h[J].equals(h[J+1]);)J++;if(Z<(X?3:2))return;x==="bevel"&&(k=1.05);const oe=this.overscaling<=16?122880/(512*this.overscaling):0,le=this.segments.prepareSegment(10*Z,this.layoutVertexArray,this.indexArray);let ce,ge,be,Ee,qe;this.e1=this.e2=-1,X&&(ce=h[Z-2],qe=h[J].sub(ce)._unit()._perp());for(let Oe=J;Oe<Z;Oe++){if(be=Oe===Z-1?X?h[J+1]:void 0:h[Oe+1],be&&h[Oe].equals(be))continue;qe&&(Ee=qe),ce&&(ge=ce),ce=h[Oe],qe=be?be.sub(ce)._unit()._perp():Ee,Ee=Ee||qe;let Ve=Ee.add(qe);Ve.x===0&&Ve.y===0||Ve._unit();const ot=Ee.x*qe.x+Ee.y*qe.y,gt=Ve.x*qe.x+Ve.y*qe.y,Et=gt!==0?1/gt:1/0,Wt=2*Math.sqrt(2-2*gt),Ft=gt<Ks&&ge&&be,Ht=Ee.x*qe.y-Ee.y*qe.x>0;if(Ft&&Oe>J){const jt=ce.dist(ge);if(jt>2*oe){const Tt=ce.sub(ce.sub(ge)._mult(oe/jt)._round());this.updateDistance(ge,Tt),this.addCurrentVertex(Tt,Ee,0,0,le),ge=Tt}}const ur=ge&&be;let Ut=ur?x:X?"butt":A;if(ur&&Ut==="round"&&(Et<L?Ut="miter":Et<=2&&(Ut="fakeround")),Ut==="miter"&&Et>k&&(Ut="bevel"),Ut==="bevel"&&(Et>2&&(Ut="flipbevel"),Et<k&&(Ut="miter")),ge&&this.updateDistance(ge,ce),Ut==="miter")Ve._mult(Et),this.addCurrentVertex(ce,Ve,0,0,le);else if(Ut==="flipbevel"){if(Et>100)Ve=qe.mult(-1);else{const jt=Et*Ee.add(qe).mag()/Ee.sub(qe).mag();Ve._perp()._mult(jt*(Ht?-1:1))}this.addCurrentVertex(ce,Ve,0,0,le),this.addCurrentVertex(ce,Ve.mult(-1),0,0,le)}else if(Ut==="bevel"||Ut==="fakeround"){const jt=-Math.sqrt(Et*Et-1),Tt=Ht?jt:0,xr=Ht?0:jt;if(ge&&this.addCurrentVertex(ce,Ee,Tt,xr,le),Ut==="fakeround"){const Er=Math.round(180*Wt/Math.PI/20);for(let vr=1;vr<Er;vr++){let ar=vr/Er;if(ar!==.5){const on=ar-.5;ar+=ar*on*(ar-1)*((1.0904+ot*(ot*(3.55645-1.43519*ot)-3.2452))*on*on+(.848013+ot*(.215638*ot-1.06021)))}const Yr=qe.sub(Ee)._mult(ar)._add(Ee)._unit()._mult(Ht?-1:1);this.addHalfVertex(ce,Yr.x,Yr.y,!1,Ht,0,le)}}be&&this.addCurrentVertex(ce,qe,-Tt,-xr,le)}else if(Ut==="butt")this.addCurrentVertex(ce,Ve,0,0,le);else if(Ut==="square"){const jt=ge?1:-1;this.addCurrentVertex(ce,Ve,jt,jt,le)}else Ut==="round"&&(ge&&(this.addCurrentVertex(ce,Ee,0,0,le),this.addCurrentVertex(ce,Ee,1,1,le,!0)),be&&(this.addCurrentVertex(ce,qe,-1,-1,le,!0),this.addCurrentVertex(ce,qe,0,0,le)));if(Ft&&Oe<Z-1){const jt=ce.dist(be);if(jt>2*oe){const Tt=ce.add(be.sub(ce)._mult(oe/jt)._round());this.updateDistance(ce,Tt),this.addCurrentVertex(Tt,qe,0,0,le),ce=Tt}}}}addCurrentVertex(h,g,x,A,k,L=!1){const z=g.y*A-g.x,V=-g.y-g.x*A;this.addHalfVertex(h,g.x+g.y*x,g.y-g.x*x,L,!1,x,k),this.addHalfVertex(h,z,V,L,!0,-A,k),this.distance>Od/2&&this.totalDistance===0&&(this.distance=0,this.updateScaledDistance(),this.addCurrentVertex(h,g,x,A,k,L))}addHalfVertex({x:h,y:g},x,A,k,L,z,V){const X=.5*(this.lineClips?this.scaledDistance*(Od-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((h<<1)+(k?1:0),(g<<1)+(L?1:0),Math.round(63*x)+128,Math.round(63*A)+128,1+(z===0?0:z<0?-1:1)|(63&X)<<2,X>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);const Z=V.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,Z,this.e2),V.primitiveLength++),L?this.e2=Z:this.e1=Z}updateScaledDistance(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance}updateDistance(h,g){this.distance+=h.dist(g),this.updateScaledDistance()}hasLineDasharray(h){for(const g of h){const x=g.paint.get("line-dasharray");if(x&&!x.isConstant())return!0}return!1}addLineDashDependencies(h,g,x,A){for(const k of h){const L=k.paint.get("line-dasharray");if(!L||L.value.kind==="constant")continue;const z=k.layout.get("line-cap")==="round",V={dasharray:L.value.evaluate({zoom:x-1},g,{}),round:z},X={dasharray:L.value.evaluate({zoom:x},g,{}),round:z},Z={dasharray:L.value.evaluate({zoom:x+1},g,{}),round:z},J=`${V.dasharray.join(",")},${V.round}`,oe=`${X.dasharray.join(",")},${X.round}`,le=`${Z.dasharray.join(",")},${Z.round}`;A.dashDependencies[J]=V,A.dashDependencies[oe]=X,A.dashDependencies[le]=Z,g.dashes[k.id]={min:J,mid:oe,max:le}}}}let qo,u_;Zt("LineBucket",Nd,{omit:["layers","patternFeatures"]});var Uv={get paint(){return u_=u_||new Ki({"line-opacity":new gr(Qe.paint_line["line-opacity"]),"line-color":new gr(Qe.paint_line["line-color"]),"line-translate":new tr(Qe.paint_line["line-translate"]),"line-translate-anchor":new tr(Qe.paint_line["line-translate-anchor"]),"line-width":new gr(Qe.paint_line["line-width"]),"line-gap-width":new gr(Qe.paint_line["line-gap-width"]),"line-offset":new gr(Qe.paint_line["line-offset"]),"line-blur":new gr(Qe.paint_line["line-blur"]),"line-dasharray":new Jc(Qe.paint_line["line-dasharray"]),"line-pattern":new Jc(Qe.paint_line["line-pattern"]),"line-gradient":new ef(Qe.paint_line["line-gradient"])})},get layout(){return qo=qo||new Ki({"line-cap":new tr(Qe.layout_line["line-cap"]),"line-join":new gr(Qe.layout_line["line-join"]),"line-miter-limit":new tr(Qe.layout_line["line-miter-limit"]),"line-round-limit":new tr(Qe.layout_line["line-round-limit"]),"line-sort-key":new gr(Qe.layout_line["line-sort-key"])})}};class MS extends gr{possiblyEvaluate(h,g){return g=new Ni(Math.floor(g.zoom),{now:g.now,fadeDuration:g.fadeDuration,zoomHistory:g.zoomHistory,transition:g.transition}),super.possiblyEvaluate(h,g)}evaluate(h,g,x,A){return g=Kt({},g,{zoom:Math.floor(g.zoom)}),super.evaluate(h,g,x,A)}}let Bd;class c_ extends _a{constructor(h,g){super(h,Uv,g),this.gradientVersion=0,Bd||(Bd=new MS(Uv.paint.properties["line-width"].specification),Bd.useIntegerZoom=!0)}_handleSpecialPaintPropertyUpdate(h){if(h==="line-gradient"){const g=this.gradientExpression();this.stepInterpolant=!!(function(x){return x._styleExpression!==void 0})(g)&&g._styleExpression.expression instanceof Eu,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(h,g){super.recalculate(h,g),this.paint._values["line-floorwidth"]=Bd.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,h)}createBucket(h){return new Nd(h)}queryRadius(h){const g=h,x=lh(Id("line-width",this,g),Id("line-gap-width",this,g)),A=Id("line-offset",this,g);return x/2+Math.abs(A)+Pv(this.paint.get("line-translate"))}queryIntersectsFeature({queryGeometry:h,feature:g,featureState:x,geometry:A,transform:k,pixelsToTileUnits:L}){const z=af(h,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),-k.bearingInRadians,L),V=L/2*lh(this.paint.get("line-width").evaluate(g,x),this.paint.get("line-gap-width").evaluate(g,x)),X=this.paint.get("line-offset").evaluate(g,x);return X&&(A=(function(Z,J){const oe=[];for(let le=0;le<Z.length;le++){const ce=Z[le],ge=[];for(let be=0;be<ce.length;be++){const Ee=ce[be-1],qe=ce[be],Oe=ce[be+1],Ve=be===0?new l(0,0):qe.sub(Ee)._unit()._perp(),ot=be===ce.length-1?new l(0,0):Oe.sub(qe)._unit()._perp(),gt=Ve._add(ot)._unit(),Et=gt.x*ot.x+gt.y*ot.y;Et!==0&&gt._mult(1/Et),ge.push(gt._mult(J)._add(qe))}oe.push(ge)}return oe})(A,X*L)),(function(Z,J,oe){for(let le=0;le<J.length;le++){const ce=J[le];if(Z.length>=3){for(let ge=0;ge<ce.length;ge++)if(Ed(Z,ce[ge]))return!0}if(hS(Z,ce,oe))return!0}return!1})(z,A,V)}isTileClipped(){return!0}}function lh(v,h){return h>0?h+2*v:v}const Pa=Bi([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),ff=Bi([{name:"a_projected_pos",components:3,type:"Float32"}],4);Bi([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const Yp=Bi([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"},{name:"a_box_real",components:2,type:"Int16"}]);Bi([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const Ju=Bi([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),Gb=Bi([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function Xb(v,h,g){return v.sections.forEach((x=>{x.text=(function(A,k,L){const z=k.layout.get("text-transform").evaluate(L,{});return z==="uppercase"?A=A.toLocaleUpperCase():z==="lowercase"&&(A=A.toLocaleLowerCase()),Sl.applyArabicShaping&&(A=Sl.applyArabicShaping(A)),A})(x.text,h,g)})),v}Bi([{name:"triangle",components:3,type:"Uint16"}]),Bi([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),Bi([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Uint16",name:"textAnchorOffsetStartIndex"},{type:"Uint16",name:"textAnchorOffsetEndIndex"}]),Bi([{type:"Float32",name:"offsetX"}]),Bi([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]),Bi([{type:"Uint16",name:"textAnchor"},{type:"Float32",components:2,name:"textOffset"}]);const Kp={"!":"︕","#":"＃",$:"＄","%":"％","&":"＆","(":"︵",")":"︶","*":"＊","+":"＋",",":"︐","-":"︲",".":"・","/":"／",":":"︓",";":"︔","<":"︿","=":"＝",">":"﹀","?":"︖","@":"＠","[":"﹇","\\":"＼","]":"﹈","^":"＾",_:"︳","`":"｀","{":"︷","|":"―","}":"︸","~":"～","¢":"￠","£":"￡","¥":"￥","¦":"￤","¬":"￢","¯":"￣","–":"︲","—":"︱","‘":"﹃","’":"﹄","“":"﹁","”":"﹂","…":"︙","‧":"・","₩":"￦","、":"︑","。":"︒","〈":"︿","〉":"﹀","《":"︽","》":"︾","「":"﹁","」":"﹂","『":"﹃","』":"﹄","【":"︻","】":"︼","〔":"︹","〕":"︺","〖":"︗","〗":"︘","！":"︕","（":"︵","）":"︶","，":"︐","－":"︲","．":"・","：":"︓","；":"︔","＜":"︿","＞":"﹀","？":"︖","［":"﹇","］":"﹈","＿":"︳","｛":"︷","｜":"―","｝":"︸","｟":"︵","｠":"︶","｡":"︒","｢":"﹁","｣":"﹂"};var On=24;const Hv=4294967296,ds=1/Hv,Zb=typeof TextDecoder>"u"?null:new TextDecoder("utf-8");class Co{constructor(h=new Uint8Array(16)){this.buf=ArrayBuffer.isView(h)?h:new Uint8Array(h),this.dataView=new DataView(this.buf.buffer),this.pos=0,this.type=0,this.length=this.buf.length}readFields(h,g,x=this.length){for(;this.pos<x;){const A=this.readVarint(),k=A>>3,L=this.pos;this.type=7&A,h(k,g,this),this.pos===L&&this.skip(A)}return g}readMessage(h,g){return this.readFields(h,g,this.readVarint()+this.pos)}readFixed32(){const h=this.dataView.getUint32(this.pos,!0);return this.pos+=4,h}readSFixed32(){const h=this.dataView.getInt32(this.pos,!0);return this.pos+=4,h}readFixed64(){const h=this.dataView.getUint32(this.pos,!0)+this.dataView.getUint32(this.pos+4,!0)*Hv;return this.pos+=8,h}readSFixed64(){const h=this.dataView.getUint32(this.pos,!0)+this.dataView.getInt32(this.pos+4,!0)*Hv;return this.pos+=8,h}readFloat(){const h=this.dataView.getFloat32(this.pos,!0);return this.pos+=4,h}readDouble(){const h=this.dataView.getFloat64(this.pos,!0);return this.pos+=8,h}readVarint(h){const g=this.buf;let x,A;return A=g[this.pos++],x=127&A,A<128?x:(A=g[this.pos++],x|=(127&A)<<7,A<128?x:(A=g[this.pos++],x|=(127&A)<<14,A<128?x:(A=g[this.pos++],x|=(127&A)<<21,A<128?x:(A=g[this.pos],x|=(15&A)<<28,(function(k,L,z){const V=z.buf;let X,Z;if(Z=V[z.pos++],X=(112&Z)>>4,Z<128||(Z=V[z.pos++],X|=(127&Z)<<3,Z<128)||(Z=V[z.pos++],X|=(127&Z)<<10,Z<128)||(Z=V[z.pos++],X|=(127&Z)<<17,Z<128)||(Z=V[z.pos++],X|=(127&Z)<<24,Z<128)||(Z=V[z.pos++],X|=(1&Z)<<31,Z<128))return zd(k,X,L);throw new Error("Expected varint not more than 10 bytes")})(x,h,this)))))}readVarint64(){return this.readVarint(!0)}readSVarint(){const h=this.readVarint();return h%2==1?(h+1)/-2:h/2}readBoolean(){return!!this.readVarint()}readString(){const h=this.readVarint()+this.pos,g=this.pos;return this.pos=h,h-g>=12&&Zb?Zb.decode(this.buf.subarray(g,h)):(function(x,A,k){let L="",z=A;for(;z<k;){const V=x[z];let X,Z,J,oe=null,le=V>239?4:V>223?3:V>191?2:1;if(z+le>k)break;le===1?V<128&&(oe=V):le===2?(X=x[z+1],(192&X)==128&&(oe=(31&V)<<6|63&X,oe<=127&&(oe=null))):le===3?(X=x[z+1],Z=x[z+2],(192&X)==128&&(192&Z)==128&&(oe=(15&V)<<12|(63&X)<<6|63&Z,(oe<=2047||oe>=55296&&oe<=57343)&&(oe=null))):le===4&&(X=x[z+1],Z=x[z+2],J=x[z+3],(192&X)==128&&(192&Z)==128&&(192&J)==128&&(oe=(15&V)<<18|(63&X)<<12|(63&Z)<<6|63&J,(oe<=65535||oe>=1114112)&&(oe=null))),oe===null?(oe=65533,le=1):oe>65535&&(oe-=65536,L+=String.fromCharCode(oe>>>10&1023|55296),oe=56320|1023&oe),L+=String.fromCharCode(oe),z+=le}return L})(this.buf,g,h)}readBytes(){const h=this.readVarint()+this.pos,g=this.buf.subarray(this.pos,h);return this.pos=h,g}readPackedVarint(h=[],g){const x=this.readPackedEnd();for(;this.pos<x;)h.push(this.readVarint(g));return h}readPackedSVarint(h=[]){const g=this.readPackedEnd();for(;this.pos<g;)h.push(this.readSVarint());return h}readPackedBoolean(h=[]){const g=this.readPackedEnd();for(;this.pos<g;)h.push(this.readBoolean());return h}readPackedFloat(h=[]){const g=this.readPackedEnd();for(;this.pos<g;)h.push(this.readFloat());return h}readPackedDouble(h=[]){const g=this.readPackedEnd();for(;this.pos<g;)h.push(this.readDouble());return h}readPackedFixed32(h=[]){const g=this.readPackedEnd();for(;this.pos<g;)h.push(this.readFixed32());return h}readPackedSFixed32(h=[]){const g=this.readPackedEnd();for(;this.pos<g;)h.push(this.readSFixed32());return h}readPackedFixed64(h=[]){const g=this.readPackedEnd();for(;this.pos<g;)h.push(this.readFixed64());return h}readPackedSFixed64(h=[]){const g=this.readPackedEnd();for(;this.pos<g;)h.push(this.readSFixed64());return h}readPackedEnd(){return this.type===2?this.readVarint()+this.pos:this.pos+1}skip(h){const g=7&h;if(g===0)for(;this.buf[this.pos++]>127;);else if(g===2)this.pos=this.readVarint()+this.pos;else if(g===5)this.pos+=4;else{if(g!==1)throw new Error(`Unimplemented type: ${g}`);this.pos+=8}}writeTag(h,g){this.writeVarint(h<<3|g)}realloc(h){let g=this.length||16;for(;g<this.pos+h;)g*=2;if(g!==this.length){const x=new Uint8Array(g);x.set(this.buf),this.buf=x,this.dataView=new DataView(x.buffer),this.length=g}}finish(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)}writeFixed32(h){this.realloc(4),this.dataView.setInt32(this.pos,h,!0),this.pos+=4}writeSFixed32(h){this.realloc(4),this.dataView.setInt32(this.pos,h,!0),this.pos+=4}writeFixed64(h){this.realloc(8),this.dataView.setInt32(this.pos,-1&h,!0),this.dataView.setInt32(this.pos+4,Math.floor(h*ds),!0),this.pos+=8}writeSFixed64(h){this.realloc(8),this.dataView.setInt32(this.pos,-1&h,!0),this.dataView.setInt32(this.pos+4,Math.floor(h*ds),!0),this.pos+=8}writeVarint(h){(h=+h||0)>268435455||h<0?(function(g,x){let A,k;if(g>=0?(A=g%4294967296|0,k=g/4294967296|0):(A=~(-g%4294967296),k=~(-g/4294967296),4294967295^A?A=A+1|0:(A=0,k=k+1|0)),g>=18446744073709552e3||g<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");x.realloc(10),(function(L,z,V){V.buf[V.pos++]=127&L|128,L>>>=7,V.buf[V.pos++]=127&L|128,L>>>=7,V.buf[V.pos++]=127&L|128,L>>>=7,V.buf[V.pos++]=127&L|128,V.buf[V.pos]=127&(L>>>=7)})(A,0,x),(function(L,z){const V=(7&L)<<4;z.buf[z.pos++]|=V|((L>>>=3)?128:0),L&&(z.buf[z.pos++]=127&L|((L>>>=7)?128:0),L&&(z.buf[z.pos++]=127&L|((L>>>=7)?128:0),L&&(z.buf[z.pos++]=127&L|((L>>>=7)?128:0),L&&(z.buf[z.pos++]=127&L|((L>>>=7)?128:0),L&&(z.buf[z.pos++]=127&L)))))})(k,x)})(h,this):(this.realloc(4),this.buf[this.pos++]=127&h|(h>127?128:0),h<=127||(this.buf[this.pos++]=127&(h>>>=7)|(h>127?128:0),h<=127||(this.buf[this.pos++]=127&(h>>>=7)|(h>127?128:0),h<=127||(this.buf[this.pos++]=h>>>7&127))))}writeSVarint(h){this.writeVarint(h<0?2*-h-1:2*h)}writeBoolean(h){this.writeVarint(+h)}writeString(h){h=String(h),this.realloc(4*h.length),this.pos++;const g=this.pos;this.pos=(function(A,k,L){for(let z,V,X=0;X<k.length;X++){if(z=k.charCodeAt(X),z>55295&&z<57344){if(!V){z>56319||X+1===k.length?(A[L++]=239,A[L++]=191,A[L++]=189):V=z;continue}if(z<56320){A[L++]=239,A[L++]=191,A[L++]=189,V=z;continue}z=V-55296<<10|z-56320|65536,V=null}else V&&(A[L++]=239,A[L++]=191,A[L++]=189,V=null);z<128?A[L++]=z:(z<2048?A[L++]=z>>6|192:(z<65536?A[L++]=z>>12|224:(A[L++]=z>>18|240,A[L++]=z>>12&63|128),A[L++]=z>>6&63|128),A[L++]=63&z|128)}return L})(this.buf,h,this.pos);const x=this.pos-g;x>=128&&qb(g,x,this),this.pos=g-1,this.writeVarint(x),this.pos+=x}writeFloat(h){this.realloc(4),this.dataView.setFloat32(this.pos,h,!0),this.pos+=4}writeDouble(h){this.realloc(8),this.dataView.setFloat64(this.pos,h,!0),this.pos+=8}writeBytes(h){const g=h.length;this.writeVarint(g),this.realloc(g);for(let x=0;x<g;x++)this.buf[this.pos++]=h[x]}writeRawMessage(h,g){this.pos++;const x=this.pos;h(g,this);const A=this.pos-x;A>=128&&qb(x,A,this),this.pos=x-1,this.writeVarint(A),this.pos+=A}writeMessage(h,g,x){this.writeTag(h,2),this.writeRawMessage(g,x)}writePackedVarint(h,g){g.length&&this.writeMessage(h,mM,g)}writePackedSVarint(h,g){g.length&&this.writeMessage(h,df,g)}writePackedBoolean(h,g){g.length&&this.writeMessage(h,Qp,g)}writePackedFloat(h,g){g.length&&this.writeMessage(h,h_,g)}writePackedDouble(h,g){g.length&&this.writeMessage(h,Yb,g)}writePackedFixed32(h,g){g.length&&this.writeMessage(h,ES,g)}writePackedSFixed32(h,g){g.length&&this.writeMessage(h,IS,g)}writePackedFixed64(h,g){g.length&&this.writeMessage(h,PS,g)}writePackedSFixed64(h,g){g.length&&this.writeMessage(h,RS,g)}writeBytesField(h,g){this.writeTag(h,2),this.writeBytes(g)}writeFixed32Field(h,g){this.writeTag(h,5),this.writeFixed32(g)}writeSFixed32Field(h,g){this.writeTag(h,5),this.writeSFixed32(g)}writeFixed64Field(h,g){this.writeTag(h,1),this.writeFixed64(g)}writeSFixed64Field(h,g){this.writeTag(h,1),this.writeSFixed64(g)}writeVarintField(h,g){this.writeTag(h,0),this.writeVarint(g)}writeSVarintField(h,g){this.writeTag(h,0),this.writeSVarint(g)}writeStringField(h,g){this.writeTag(h,2),this.writeString(g)}writeFloatField(h,g){this.writeTag(h,5),this.writeFloat(g)}writeDoubleField(h,g){this.writeTag(h,1),this.writeDouble(g)}writeBooleanField(h,g){this.writeVarintField(h,+g)}}function zd(v,h,g){return g?4294967296*h+(v>>>0):4294967296*(h>>>0)+(v>>>0)}function qb(v,h,g){const x=h<=16383?1:h<=2097151?2:h<=268435455?3:Math.floor(Math.log(h)/(7*Math.LN2));g.realloc(x);for(let A=g.pos-1;A>=v;A--)g.buf[A+x]=g.buf[A]}function mM(v,h){for(let g=0;g<v.length;g++)h.writeVarint(v[g])}function df(v,h){for(let g=0;g<v.length;g++)h.writeSVarint(v[g])}function h_(v,h){for(let g=0;g<v.length;g++)h.writeFloat(v[g])}function Yb(v,h){for(let g=0;g<v.length;g++)h.writeDouble(v[g])}function Qp(v,h){for(let g=0;g<v.length;g++)h.writeBoolean(v[g])}function ES(v,h){for(let g=0;g<v.length;g++)h.writeFixed32(v[g])}function IS(v,h){for(let g=0;g<v.length;g++)h.writeSFixed32(v[g])}function PS(v,h){for(let g=0;g<v.length;g++)h.writeFixed64(v[g])}function RS(v,h){for(let g=0;g<v.length;g++)h.writeSFixed64(v[g])}function f_(v,h,g){v===1&&g.readMessage(Kb,h)}function Kb(v,h,g){if(v===3){const{id:x,bitmap:A,width:k,height:L,left:z,top:V,advance:X}=g.readMessage(yM,{});h.push({id:x,bitmap:new Up({width:k+6,height:L+6},A),metrics:{width:k,height:L,left:z,top:V,advance:X}})}}function yM(v,h,g){v===1?h.id=g.readVarint():v===2?h.bitmap=g.readBytes():v===3?h.width=g.readVarint():v===4?h.height=g.readVarint():v===5?h.left=g.readSVarint():v===6?h.top=g.readSVarint():v===7&&(h.advance=g.readVarint())}function DS(v){let h=0,g=0;for(const L of v)h+=L.w*L.h,g=Math.max(g,L.w);v.sort(((L,z)=>z.h-L.h));const x=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(h/.95)),g),h:1/0}];let A=0,k=0;for(const L of v)for(let z=x.length-1;z>=0;z--){const V=x[z];if(!(L.w>V.w||L.h>V.h)){if(L.x=V.x,L.y=V.y,k=Math.max(k,L.y+L.h),A=Math.max(A,L.x+L.w),L.w===V.w&&L.h===V.h){const X=x.pop();X&&z<x.length&&(x[z]=X)}else L.h===V.h?(V.x+=L.w,V.w-=L.w):L.w===V.w?(V.y+=L.h,V.h-=L.h):(x.push({x:V.x+L.w,y:V.y,w:V.w-L.w,h:L.h}),V.y+=L.h,V.h-=L.h);break}}return{w:A,h:k,fill:h/(A*k)||0}}class Qb{constructor(h,{pixelRatio:g,version:x,stretchX:A,stretchY:k,content:L,textFitWidth:z,textFitHeight:V}){this.paddedRect=h,this.pixelRatio=g,this.stretchX=A,this.stretchY=k,this.content=L,this.version=x,this.textFitWidth=z,this.textFitHeight=V}get tl(){return[this.paddedRect.x+1,this.paddedRect.y+1]}get br(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]}get tlbr(){return this.tl.concat(this.br)}get displaySize(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]}}class Jb{constructor(h,g){const x={},A={};this.haveRenderCallbacks=[];const k=[];this.addImages(h,x,k),this.addImages(g,A,k);const{w:L,h:z}=DS(k),V=new io({width:L||1,height:z||1});for(const X in h){const Z=h[X],J=x[X].paddedRect;io.copy(Z.data,V,{x:0,y:0},{x:J.x+1,y:J.y+1},Z.data)}for(const X in g){const Z=g[X],J=A[X].paddedRect,oe=J.x+1,le=J.y+1,ce=Z.data.width,ge=Z.data.height;io.copy(Z.data,V,{x:0,y:0},{x:oe,y:le},Z.data),io.copy(Z.data,V,{x:0,y:ge-1},{x:oe,y:le-1},{width:ce,height:1}),io.copy(Z.data,V,{x:0,y:0},{x:oe,y:le+ge},{width:ce,height:1}),io.copy(Z.data,V,{x:ce-1,y:0},{x:oe-1,y:le},{width:1,height:ge}),io.copy(Z.data,V,{x:0,y:0},{x:oe+ce,y:le},{width:1,height:ge})}this.image=V,this.iconPositions=x,this.patternPositions=A}addImages(h,g,x){for(const A in h){const k=h[A],L={x:0,y:0,w:k.data.width+2,h:k.data.height+2};x.push(L),g[A]=new Qb(L,k),k.hasRenderCallback&&this.haveRenderCallbacks.push(A)}}patchUpdatedImages(h,g){h.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const x in h.updatedImages)this.patchUpdatedImage(this.iconPositions[x],h.getImage(x),g),this.patchUpdatedImage(this.patternPositions[x],h.getImage(x),g)}patchUpdatedImage(h,g,x){if(!h||!g||h.version===g.version)return;h.version=g.version;const[A,k]=h.tl;x.update(g.data,void 0,{x:A,y:k})}}var uh;Zt("ImagePosition",Qb),Zt("ImageAtlas",Jb),s.ao=void 0,(uh=s.ao||(s.ao={}))[uh.none=0]="none",uh[uh.horizontal=1]="horizontal",uh[uh.vertical=2]="vertical",uh[uh.horizontalOnly=3]="horizontalOnly";class ec{constructor(){this.scale=1,this.fontStack="",this.imageName=null,this.verticalAlign="bottom"}static forText(h,g,x){const A=new ec;return A.scale=h||1,A.fontStack=g,A.verticalAlign=x||"bottom",A}static forImage(h,g){const x=new ec;return x.imageName=h,x.verticalAlign=g||"bottom",x}}class ch{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(h,g){const x=new ch;for(let A=0;A<h.sections.length;A++){const k=h.sections[A];k.image?x.addImageSection(k):x.addTextSection(k,g)}return x}length(){return this.text.length}getSection(h){return this.sections[this.sectionIndex[h]]}getSectionIndex(h){return this.sectionIndex[h]}getCharCode(h){return this.text.charCodeAt(h)}verticalizePunctuation(){this.text=(function(h){let g="";for(let x=0;x<h.length;x++){const A=h.charCodeAt(x+1)||null,k=h.charCodeAt(x-1)||null;g+=A&&xd(A)&&!Kp[h[x+1]]||k&&xd(k)&&!Kp[h[x-1]]||!Kp[h[x]]?h[x]:Kp[h[x]]}return g})(this.text)}trim(){let h=0;for(let x=0;x<this.text.length&&$v[this.text.charCodeAt(x)];x++)h++;let g=this.text.length;for(let x=this.text.length-1;x>=0&&x>=h&&$v[this.text.charCodeAt(x)];x--)g--;this.text=this.text.substring(h,g),this.sectionIndex=this.sectionIndex.slice(h,g)}substring(h,g){const x=new ch;return x.text=this.text.substring(h,g),x.sectionIndex=this.sectionIndex.slice(h,g),x.sections=this.sections,x}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce(((h,g)=>Math.max(h,this.sections[g].scale)),0)}getMaxImageSize(h){let g=0,x=0;for(let A=0;A<this.length();A++){const k=this.getSection(A);if(k.imageName){const L=h[k.imageName];if(!L)continue;const z=L.displaySize;g=Math.max(g,z[0]),x=Math.max(x,z[1])}}return{maxImageWidth:g,maxImageHeight:x}}addTextSection(h,g){this.text+=h.text,this.sections.push(ec.forText(h.scale,h.fontStack||g,h.verticalAlign));const x=this.sections.length-1;for(let A=0;A<h.text.length;++A)this.sectionIndex.push(x)}addImageSection(h){const g=h.image?h.image.name:"";if(g.length===0)return void dr("Can't add FormattedSection with an empty image.");const x=this.getNextImageSectionCharCode();x?(this.text+=String.fromCharCode(x),this.sections.push(ec.forImage(g,h.verticalAlign)),this.sectionIndex.push(this.sections.length-1)):dr("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function jv(v,h,g,x,A,k,L,z,V,X,Z,J,oe,le,ce){const ge=ch.fromFeature(v,A);let be;J===s.ao.vertical&&ge.verticalizePunctuation();const{processBidirectionalText:Ee,processStyledBidirectionalText:qe}=Sl;if(Ee&&ge.sections.length===1){be=[];const ot=Ee(ge.toString(),Ui(ge,X,k,h,x,le));for(const gt of ot){const Et=new ch;Et.text=gt,Et.sections=ge.sections;for(let Wt=0;Wt<gt.length;Wt++)Et.sectionIndex.push(0);be.push(Et)}}else if(qe){be=[];const ot=qe(ge.text,ge.sectionIndex,Ui(ge,X,k,h,x,le));for(const gt of ot){const Et=new ch;Et.text=gt[0],Et.sectionIndex=gt[1],Et.sections=ge.sections,be.push(Et)}}else be=(function(ot,gt){const Et=[],Wt=ot.text;let Ft=0;for(const Ht of gt)Et.push(ot.substring(Ft,Ht)),Ft=Ht;return Ft<Wt.length&&Et.push(ot.substring(Ft,Wt.length)),Et})(ge,Ui(ge,X,k,h,x,le));const Oe=[],Ve={positionedLines:Oe,text:ge.toString(),top:Z[1],bottom:Z[1],left:Z[0],right:Z[0],writingMode:J,iconsInText:!1,verticalizable:!1};return(function(ot,gt,Et,Wt,Ft,Ht,ur,Ut,jt,Tt,xr,Er){let vr=0,ar=0,Yr=0,on=0;const Fn=Ut==="right"?1:Ut==="left"?0:.5,Ra=On/Er;let Ko=0;for(const ki of Ft){ki.trim();const Nn=ki.getMaxScale(),Vn={positionedGlyphs:[],lineOffset:0};ot.positionedLines[Ko]=Vn;const wn=Vn.positionedGlyphs;let Mo=0;if(!ki.length()){ar+=Ht,++Ko;continue}const gs=_M(Wt,ki,Ra);for(let Qo=0;Qo<ki.length();Qo++){const Yn=ki.getSection(Qo),Un=ki.getSectionIndex(Qo),la=ki.getCharCode(Qo),Kn=bM(jt,xr,la);let Hi;if(Yn.imageName){if(ot.iconsInText=!0,Yn.scale=Yn.scale*Ra,Hi=wM(Yn,Kn,Nn,gs,Wt),!Hi)continue;Mo=Math.max(Mo,Hi.imageOffset)}else if(Hi=xM(Yn,la,Kn,gs,gt,Et),!Hi)continue;const{rect:vs,metrics:Ud,baselineOffset:Eo}=Hi;wn.push({glyph:la,imageName:Yn.imageName,x:vr,y:ar+Eo+-17,vertical:Kn,scale:Yn.scale,fontStack:Yn.fontStack,sectionIndex:Un,metrics:Ud,rect:vs}),Kn?(ot.verticalizable=!0,vr+=(Yn.imageName?Ud.advance:On)*Yn.scale+Tt):vr+=Ud.advance*Yn.scale+Tt}wn.length!==0&&(Yr=Math.max(vr-Tt,Yr),p_(wn,0,wn.length-1,Fn)),vr=0,Vn.lineOffset=Math.max(Mo,(Nn-1)*On);const Bn=Ht*Nn+Mo;ar+=Bn,on=Math.max(Bn,on),++Ko}const{horizontalAlign:qn,verticalAlign:xn}=Wv(ur);(function(ki,Nn,Vn,wn,Mo,gs,Bn,Qo,Yn){const Un=(Nn-Vn)*Mo;let la=0;la=gs!==Bn?-Qo*wn- -17:-wn*Yn*Bn+.5*Bn;for(const Kn of ki)for(const Hi of Kn.positionedGlyphs)Hi.x+=Un,Hi.y+=la})(ot.positionedLines,Fn,qn,xn,Yr,on,Ht,ar,Ft.length),ot.top+=-xn*ar,ot.bottom=ot.top+ar,ot.left+=-qn*Yr,ot.right=ot.left+Yr})(Ve,h,g,x,be,L,z,V,J,X,oe,ce),!(function(ot){for(const gt of ot)if(gt.positionedGlyphs.length!==0)return!1;return!0})(Oe)&&Ve}const $v={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},kS={10:!0,32:!0,38:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0},LS={40:!0};function ex(v,h,g,x,A,k){if(h.imageName){const L=x[h.imageName];return L?L.displaySize[0]*h.scale*On/k+A:0}{const L=g[h.fontStack],z=L&&L[v];return z?z.metrics.advance*h.scale+A:0}}function tx(v,h,g,x){const A=Math.pow(v-h,2);return x?v<h?A/2:2*A:A+Math.abs(g)*g}function d_(v,h,g){let x=0;return v===10&&(x-=1e4),g&&(x+=150),v!==40&&v!==65288||(x+=50),h!==41&&h!==65289||(x+=50),x}function rx(v,h,g,x,A,k){let L=null,z=tx(h,g,A,k);for(const V of x){const X=tx(h-V.x,g,A,k)+V.badness;X<=z&&(L=V,z=X)}return{index:v,x:h,priorBreak:L,badness:z}}function ix(v){return v?ix(v.priorBreak).concat(v.index):[]}function Ui(v,h,g,x,A,k){if(!v)return[];const L=[],z=(function(J,oe,le,ce,ge,be){let Ee=0;for(let qe=0;qe<J.length();qe++){const Oe=J.getSection(qe);Ee+=ex(J.getCharCode(qe),Oe,ce,ge,oe,be)}return Ee/Math.max(1,Math.ceil(Ee/le))})(v,h,g,x,A,k),V=v.text.indexOf("​")>=0;let X=0;for(let J=0;J<v.length();J++){const oe=v.getSection(J),le=v.getCharCode(J);if($v[le]||(X+=ex(le,oe,x,A,h,k)),J<v.length()-1){const ce=!((Z=le)<11904)&&(!!zr["CJK Compatibility Forms"](Z)||!!zr["CJK Compatibility"](Z)||!!zr["CJK Strokes"](Z)||!!zr["CJK Symbols and Punctuation"](Z)||!!zr["Enclosed CJK Letters and Months"](Z)||!!zr["Halfwidth and Fullwidth Forms"](Z)||!!zr["Ideographic Description Characters"](Z)||!!zr["Vertical Forms"](Z)||bd.test(String.fromCodePoint(Z)));(kS[le]||ce||oe.imageName||J!==v.length()-2&&LS[v.getCharCode(J+1)])&&L.push(rx(J+1,X,z,L,d_(le,v.getCharCode(J+1),ce&&V),!1))}}var Z;return ix(rx(v.length(),X,z,L,0,!0))}function Wv(v){let h=.5,g=.5;switch(v){case"right":case"top-right":case"bottom-right":h=1;break;case"left":case"top-left":case"bottom-left":h=0}switch(v){case"bottom":case"bottom-right":case"bottom-left":g=1;break;case"top":case"top-right":case"top-left":g=0}return{horizontalAlign:h,verticalAlign:g}}function _M(v,h,g){const x=h.getMaxScale()*On,{maxImageWidth:A,maxImageHeight:k}=h.getMaxImageSize(v),L=Math.max(x,k*g);return{verticalLineContentWidth:Math.max(x,A*g),horizontalLineContentHeight:L}}function nx(v){switch(v){case"top":return 0;case"center":return .5;default:return 1}}function bM(v,h,g){return!(v===s.ao.horizontal||!h&&!ju(g)||h&&($v[g]||(x=g,new RegExp("\\p{sc=Arab}","u").test(String.fromCodePoint(x)))));var x}function xM(v,h,g,x,A,k){const L=k[v.fontStack],z=(function(X,Z,J,oe){if(X&&X.rect)return X;const le=Z[J.fontStack],ce=le&&le[oe];return ce?{rect:null,metrics:ce.metrics}:null})(L&&L[h],A,v,h);if(z===null)return null;let V;if(g)V=x.verticalLineContentWidth-v.scale*On;else{const X=nx(v.verticalAlign);V=(x.horizontalLineContentHeight-v.scale*On)*X}return{rect:z.rect,metrics:z.metrics,baselineOffset:V}}function wM(v,h,g,x,A){const k=A[v.imageName];if(!k)return null;const L=k.paddedRect,z=k.displaySize,V={width:z[0],height:z[1],left:1,top:-3,advance:h?z[1]:z[0]};let X;if(h)X=x.verticalLineContentWidth-z[1]*v.scale;else{const Z=nx(v.verticalAlign);X=(x.horizontalLineContentHeight-z[1]*v.scale)*Z}return{rect:L,metrics:V,baselineOffset:X,imageOffset:(h?z[0]:z[1])*v.scale-On*g}}function p_(v,h,g,x){if(x===0)return;const A=v[g],k=(v[g].x+A.metrics.advance*A.scale)*x;for(let L=h;L<=g;L++)v[L].x-=k}function Jp(v,h,g){const{horizontalAlign:x,verticalAlign:A}=Wv(g),k=h[0]-v.displaySize[0]*x,L=h[1]-v.displaySize[1]*A;return{image:v,top:L,bottom:L+v.displaySize[1],left:k,right:k+v.displaySize[0]}}function g_(v){var h,g;let x=v.left,A=v.top,k=v.right-x,L=v.bottom-A;const z=(h=v.image.textFitWidth)!==null&&h!==void 0?h:"stretchOrShrink",V=(g=v.image.textFitHeight)!==null&&g!==void 0?g:"stretchOrShrink",X=(v.image.content[2]-v.image.content[0])/(v.image.content[3]-v.image.content[1]);if(V==="proportional"){if(z==="stretchOnly"&&k/L<X||z==="proportional"){const Z=Math.ceil(L*X);x*=Z/k,k=Z}}else if(z==="proportional"&&V==="stretchOnly"&&X!==0&&k/L>X){const Z=Math.ceil(k/X);A*=Z/L,L=Z}return{x1:x,y1:A,x2:x+k,y2:A+L}}function Gv(v,h,g,x,A,k){const L=v.image;let z;if(L.content){const be=L.content,Ee=L.pixelRatio||1;z=[be[0]/Ee,be[1]/Ee,L.displaySize[0]-be[2]/Ee,L.displaySize[1]-be[3]/Ee]}const V=h.left*k,X=h.right*k;let Z,J,oe,le;g==="width"||g==="both"?(le=A[0]+V-x[3],J=A[0]+X+x[1]):(le=A[0]+(V+X-L.displaySize[0])/2,J=le+L.displaySize[0]);const ce=h.top*k,ge=h.bottom*k;return g==="height"||g==="both"?(Z=A[1]+ce-x[0],oe=A[1]+ge+x[2]):(Z=A[1]+(ce+ge-L.displaySize[1])/2,oe=Z+L.displaySize[1]),{image:L,top:Z,right:J,bottom:oe,left:le,collisionPadding:z}}const au=128,Yo=32640;function ou(v,h){const{expression:g}=h;if(g.kind==="constant")return{kind:"constant",layoutSize:g.evaluate(new Ni(v+1))};if(g.kind==="source")return{kind:"source"};{const{zoomStops:x,interpolationType:A}=g;let k=0;for(;k<x.length&&x[k]<=v;)k++;k=Math.max(0,k-1);let L=k;for(;L<x.length&&x[L]<v+1;)L++;L=Math.min(x.length-1,L);const z=x[k],V=x[L];return g.kind==="composite"?{kind:"composite",minZoom:z,maxZoom:V,interpolationType:A}:{kind:"camera",minZoom:z,maxZoom:V,minSize:g.evaluate(new Ni(z)),maxSize:g.evaluate(new Ni(V)),interpolationType:A}}}function Fd(v,h,g){let x="never";const A=v.get(h);return A?x=A:v.get(g)&&(x="always"),x}const SM=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function Xv(v,h,g,x,A,k,L,z,V,X,Z,J,oe){const le=z?Math.min(Yo,Math.round(z[0])):0,ce=z?Math.min(Yo,Math.round(z[1])):0;v.emplaceBack(h,g,Math.round(32*x),Math.round(32*A),k,L,(le<<1)+(V?1:0),ce,16*X,16*Z,256*J,256*oe)}function v_(v,h,g){v.emplaceBack(h.x,h.y,g),v.emplaceBack(h.x,h.y,g),v.emplaceBack(h.x,h.y,g),v.emplaceBack(h.x,h.y,g)}function OS(v){for(const h of v.sections)if(Yl(h.text))return!0;return!1}class m_{constructor(h){this.layoutVertexArray=new Bt,this.indexArray=new Mi,this.programConfigurations=h,this.segments=new Jr,this.dynamicLayoutVertexArray=new Ct,this.opacityVertexArray=new nr,this.hasVisibleVertices=!1,this.placedSymbolArray=new ue}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(h,g,x,A){this.isEmpty()||(x&&(this.layoutVertexBuffer=h.createVertexBuffer(this.layoutVertexArray,Pa.members),this.indexBuffer=h.createIndexBuffer(this.indexArray,g),this.dynamicLayoutVertexBuffer=h.createVertexBuffer(this.dynamicLayoutVertexArray,ff.members,!0),this.opacityVertexBuffer=h.createVertexBuffer(this.opacityVertexArray,SM,!0),this.opacityVertexBuffer.itemSize=1),(x||A)&&this.programConfigurations.upload(h))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}Zt("SymbolBuffers",m_);class ax{constructor(h,g,x){this.layoutVertexArray=new h,this.layoutAttributes=g,this.indexArray=new x,this.segments=new Jr,this.collisionVertexArray=new gi}upload(h){this.layoutVertexBuffer=h.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=h.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=h.createVertexBuffer(this.collisionVertexArray,Yp.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())}}Zt("CollisionBuffers",ax);class pf{constructor(h){this.collisionBoxArray=h.collisionBoxArray,this.zoom=h.zoom,this.overscaling=In(globalThis)?Math.min(h.overscaling,128):h.overscaling,this.layers=h.layers,this.layerIds=this.layers.map((L=>L.id)),this.index=h.index,this.pixelRatio=h.pixelRatio,this.sourceLayerIndex=h.sourceLayerIndex,this.hasDependencies=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[];const g=this.layers[0]._unevaluatedLayout._values;this.textSizeData=ou(this.zoom,g["text-size"]),this.iconSizeData=ou(this.zoom,g["icon-size"]);const x=this.layers[0].layout,A=x.get("symbol-sort-key"),k=x.get("symbol-z-order");this.canOverlap=Fd(x,"text-overlap","text-allow-overlap")!=="never"||Fd(x,"icon-overlap","icon-allow-overlap")!=="never"||x.get("text-ignore-placement")||x.get("icon-ignore-placement"),this.sortFeaturesByKey=k!=="viewport-y"&&!A.isConstant(),this.sortFeaturesByY=(k==="viewport-y"||k==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,x.get("symbol-placement")==="point"&&(this.writingModes=x.get("text-writing-mode").map((L=>s.ao[L]))),this.stateDependentLayerIds=this.layers.filter((L=>L.isStateDependent())).map((L=>L.id)),this.sourceID=h.sourceID}createArrays(){this.text=new m_(new Cl(this.layers,this.zoom,(h=>/^text/.test(h)))),this.icon=new m_(new Cl(this.layers,this.zoom,(h=>/^icon/.test(h)))),this.glyphOffsetArray=new Te,this.lineVertexArray=new Ce,this.symbolInstances=new Se,this.textAnchorOffsets=new ke}calculateGlyphDependencies(h,g,x,A,k){for(let L=0;L<h.length;L++)if(g[h.charCodeAt(L)]=!0,(x||A)&&k){const z=Kp[h.charAt(L)];z&&(g[z.charCodeAt(0)]=!0)}}populate(h,g,x){const A=this.layers[0],k=A.layout,L=k.get("text-font"),z=k.get("text-field"),V=k.get("icon-image"),X=(z.value.kind!=="constant"||z.value.value instanceof ta&&!z.value.value.isEmpty()||z.value.value.toString().length>0)&&(L.value.kind!=="constant"||L.value.value.length>0),Z=V.value.kind!=="constant"||!!V.value.value||Object.keys(V.parameters).length>0,J=k.get("symbol-sort-key");if(this.features=[],!X&&!Z)return;const oe=g.iconDependencies,le=g.glyphDependencies,ce=g.availableImages,ge=new Ni(this.zoom);for(const{feature:be,id:Ee,index:qe,sourceLayerIndex:Oe}of h){const Ve=A._featureFilter.needGeometry,ot=qs(be,Ve);if(!A._featureFilter.filter(ge,ot,x))continue;let gt,Et;if(Ve||(ot.geometry=nf(be)),X){const Ft=A.getValueAndResolveTokens("text-field",ot,x,ce),Ht=ta.factory(Ft),ur=this.hasRTLText=this.hasRTLText||OS(Ht);(!ur||Sl.getRTLTextPluginStatus()==="unavailable"||ur&&Sl.isParsed())&&(gt=Xb(Ht,A,ot))}if(Z){const Ft=A.getValueAndResolveTokens("icon-image",ot,x,ce);Et=Ft instanceof Qa?Ft:Qa.fromString(Ft)}if(!gt&&!Et)continue;const Wt=this.sortFeaturesByKey?J.evaluate(ot,{},x):void 0;if(this.features.push({id:Ee,text:gt,icon:Et,index:qe,sourceLayerIndex:Oe,geometry:ot.geometry,properties:be.properties,type:Dd.types[be.type],sortKey:Wt}),Et&&(oe[Et.name]=!0),gt){const Ft=L.evaluate(ot,{},x).join(","),Ht=k.get("text-rotation-alignment")!=="viewport"&&k.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(s.ao.vertical)>=0;for(const ur of gt.sections)if(ur.image)oe[ur.image.name]=!0;else{const Ut=wl(gt.toString()),jt=ur.fontStack||Ft,Tt=le[jt]=le[jt]||{};this.calculateGlyphDependencies(ur.text,Tt,Ht,this.allowVerticalPlacement,Ut)}}}k.get("symbol-placement")==="line"&&(this.features=(function(be){const Ee={},qe={},Oe=[];let Ve=0;function ot(Ft){Oe.push(be[Ft]),Ve++}function gt(Ft,Ht,ur){const Ut=qe[Ft];return delete qe[Ft],qe[Ht]=Ut,Oe[Ut].geometry[0].pop(),Oe[Ut].geometry[0]=Oe[Ut].geometry[0].concat(ur[0]),Ut}function Et(Ft,Ht,ur){const Ut=Ee[Ht];return delete Ee[Ht],Ee[Ft]=Ut,Oe[Ut].geometry[0].shift(),Oe[Ut].geometry[0]=ur[0].concat(Oe[Ut].geometry[0]),Ut}function Wt(Ft,Ht,ur){const Ut=ur?Ht[0][Ht[0].length-1]:Ht[0][0];return`${Ft}:${Ut.x}:${Ut.y}`}for(let Ft=0;Ft<be.length;Ft++){const Ht=be[Ft],ur=Ht.geometry,Ut=Ht.text?Ht.text.toString():null;if(!Ut){ot(Ft);continue}const jt=Wt(Ut,ur),Tt=Wt(Ut,ur,!0);if(jt in qe&&Tt in Ee&&qe[jt]!==Ee[Tt]){const xr=Et(jt,Tt,ur),Er=gt(jt,Tt,Oe[xr].geometry);delete Ee[jt],delete qe[Tt],qe[Wt(Ut,Oe[Er].geometry,!0)]=Er,Oe[xr].geometry=null}else jt in qe?gt(jt,Tt,ur):Tt in Ee?Et(jt,Tt,ur):(ot(Ft),Ee[jt]=Ve-1,qe[Tt]=Ve-1)}return Oe.filter((Ft=>Ft.geometry))})(this.features)),this.sortFeaturesByKey&&this.features.sort(((be,Ee)=>be.sortKey-Ee.sortKey))}update(h,g,x){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(h,g,this.layers,{imagePositions:x}),this.icon.programConfigurations.updatePaintArrays(h,g,this.layers,{imagePositions:x}))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(h){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(h),this.iconCollisionBox.upload(h)),this.text.upload(h,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(h,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(h,g){const x=this.lineVertexArray.length;if(h.segment!==void 0){let A=h.dist(g[h.segment+1]),k=h.dist(g[h.segment]);const L={};for(let z=h.segment+1;z<g.length;z++)L[z]={x:g[z].x,y:g[z].y,tileUnitDistanceFromAnchor:A},z<g.length-1&&(A+=g[z+1].dist(g[z]));for(let z=h.segment||0;z>=0;z--)L[z]={x:g[z].x,y:g[z].y,tileUnitDistanceFromAnchor:k},z>0&&(k+=g[z-1].dist(g[z]));for(let z=0;z<g.length;z++){const V=L[z];this.lineVertexArray.emplaceBack(V.x,V.y,V.tileUnitDistanceFromAnchor)}}return{lineStartIndex:x,lineLength:this.lineVertexArray.length-x}}addSymbols(h,g,x,A,k,L,z,V,X,Z,J,oe){const le=h.indexArray,ce=h.layoutVertexArray,ge=h.segments.prepareSegment(4*g.length,ce,le,this.canOverlap?L.sortKey:void 0),be=this.glyphOffsetArray.length,Ee=ge.vertexLength,qe=this.allowVerticalPlacement&&z===s.ao.vertical?Math.PI/2:0,Oe=L.text&&L.text.sections;for(let Ve=0;Ve<g.length;Ve++){const{tl:ot,tr:gt,bl:Et,br:Wt,tex:Ft,pixelOffsetTL:Ht,pixelOffsetBR:ur,minFontScaleX:Ut,minFontScaleY:jt,glyphOffset:Tt,isSDF:xr,sectionIndex:Er}=g[Ve],vr=ge.vertexLength,ar=Tt[1];Xv(ce,V.x,V.y,ot.x,ar+ot.y,Ft.x,Ft.y,x,xr,Ht.x,Ht.y,Ut,jt),Xv(ce,V.x,V.y,gt.x,ar+gt.y,Ft.x+Ft.w,Ft.y,x,xr,ur.x,Ht.y,Ut,jt),Xv(ce,V.x,V.y,Et.x,ar+Et.y,Ft.x,Ft.y+Ft.h,x,xr,Ht.x,ur.y,Ut,jt),Xv(ce,V.x,V.y,Wt.x,ar+Wt.y,Ft.x+Ft.w,Ft.y+Ft.h,x,xr,ur.x,ur.y,Ut,jt),v_(h.dynamicLayoutVertexArray,V,qe),le.emplaceBack(vr,vr+2,vr+1),le.emplaceBack(vr+1,vr+2,vr+3),ge.vertexLength+=4,ge.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(Tt[0]),Ve!==g.length-1&&Er===g[Ve+1].sectionIndex||h.programConfigurations.populatePaintArrays(ce.length,L,L.index,{imagePositions:{},canonical:oe,formattedSection:Oe&&Oe[Er]})}h.placedSymbolArray.emplaceBack(V.x,V.y,be,this.glyphOffsetArray.length-be,Ee,X,Z,V.segment,x?x[0]:0,x?x[1]:0,A[0],A[1],z,0,!1,0,J)}_addCollisionDebugVertex(h,g,x,A,k,L){return g.emplaceBack(0,0),h.emplaceBack(x.x,x.y,A,k,Math.round(L.x),Math.round(L.y))}addCollisionDebugVertices(h,g,x,A,k,L,z){const V=k.segments.prepareSegment(4,k.layoutVertexArray,k.indexArray),X=V.vertexLength,Z=k.layoutVertexArray,J=k.collisionVertexArray,oe=z.anchorX,le=z.anchorY;this._addCollisionDebugVertex(Z,J,L,oe,le,new l(h,g)),this._addCollisionDebugVertex(Z,J,L,oe,le,new l(x,g)),this._addCollisionDebugVertex(Z,J,L,oe,le,new l(x,A)),this._addCollisionDebugVertex(Z,J,L,oe,le,new l(h,A)),V.vertexLength+=4;const ce=k.indexArray;ce.emplaceBack(X,X+1),ce.emplaceBack(X+1,X+2),ce.emplaceBack(X+2,X+3),ce.emplaceBack(X+3,X),V.primitiveLength+=4}addDebugCollisionBoxes(h,g,x,A){for(let k=h;k<g;k++){const L=this.collisionBoxArray.get(k);this.addCollisionDebugVertices(L.x1,L.y1,L.x2,L.y2,A?this.textCollisionBox:this.iconCollisionBox,L.anchorPoint,x)}}generateCollisionDebugBuffers(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new ax(Pr,Ju.members,Ei),this.iconCollisionBox=new ax(Pr,Ju.members,Ei);for(let h=0;h<this.symbolInstances.length;h++){const g=this.symbolInstances.get(h);this.addDebugCollisionBoxes(g.textBoxStartIndex,g.textBoxEndIndex,g,!0),this.addDebugCollisionBoxes(g.verticalTextBoxStartIndex,g.verticalTextBoxEndIndex,g,!0),this.addDebugCollisionBoxes(g.iconBoxStartIndex,g.iconBoxEndIndex,g,!1),this.addDebugCollisionBoxes(g.verticalIconBoxStartIndex,g.verticalIconBoxEndIndex,g,!1)}}_deserializeCollisionBoxesForSymbol(h,g,x,A,k,L,z,V,X){const Z={};for(let J=g;J<x;J++){const oe=h.get(J);Z.textBox={x1:oe.x1,y1:oe.y1,x2:oe.x2,y2:oe.y2,anchorPointX:oe.anchorPointX,anchorPointY:oe.anchorPointY},Z.textFeatureIndex=oe.featureIndex;break}for(let J=A;J<k;J++){const oe=h.get(J);Z.verticalTextBox={x1:oe.x1,y1:oe.y1,x2:oe.x2,y2:oe.y2,anchorPointX:oe.anchorPointX,anchorPointY:oe.anchorPointY},Z.verticalTextFeatureIndex=oe.featureIndex;break}for(let J=L;J<z;J++){const oe=h.get(J);Z.iconBox={x1:oe.x1,y1:oe.y1,x2:oe.x2,y2:oe.y2,anchorPointX:oe.anchorPointX,anchorPointY:oe.anchorPointY},Z.iconFeatureIndex=oe.featureIndex;break}for(let J=V;J<X;J++){const oe=h.get(J);Z.verticalIconBox={x1:oe.x1,y1:oe.y1,x2:oe.x2,y2:oe.y2,anchorPointX:oe.anchorPointX,anchorPointY:oe.anchorPointY},Z.verticalIconFeatureIndex=oe.featureIndex;break}return Z}deserializeCollisionBoxes(h){this.collisionArrays=[];for(let g=0;g<this.symbolInstances.length;g++){const x=this.symbolInstances.get(g);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(h,x.textBoxStartIndex,x.textBoxEndIndex,x.verticalTextBoxStartIndex,x.verticalTextBoxEndIndex,x.iconBoxStartIndex,x.iconBoxEndIndex,x.verticalIconBoxStartIndex,x.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(h,g){const x=h.placedSymbolArray.get(g),A=x.vertexStartIndex+4*x.numGlyphs;for(let k=x.vertexStartIndex;k<A;k+=4)h.indexArray.emplaceBack(k,k+2,k+1),h.indexArray.emplaceBack(k+1,k+2,k+3)}getSortedSymbolIndexes(h){if(this.sortedAngle===h&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const g=Math.sin(h),x=Math.cos(h),A=[],k=[],L=[];for(let z=0;z<this.symbolInstances.length;++z){L.push(z);const V=this.symbolInstances.get(z);A.push(0|Math.round(g*V.anchorX+x*V.anchorY)),k.push(V.featureIndex)}return L.sort(((z,V)=>A[z]-A[V]||k[V]-k[z])),L}addToSortKeyRanges(h,g){const x=this.sortKeyRanges[this.sortKeyRanges.length-1];x&&x.sortKey===g?x.symbolInstanceEnd=h+1:this.sortKeyRanges.push({sortKey:g,symbolInstanceStart:h,symbolInstanceEnd:h+1})}sortFeatures(h){if(this.sortFeaturesByY&&this.sortedAngle!==h&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(h),this.sortedAngle=h,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const g of this.symbolInstanceIndexes){const x=this.symbolInstances.get(g);this.featureSortOrder.push(x.featureIndex),[x.rightJustifiedTextSymbolIndex,x.centerJustifiedTextSymbolIndex,x.leftJustifiedTextSymbolIndex].forEach(((A,k,L)=>{A>=0&&L.indexOf(A)===k&&this.addIndicesForPlacedSymbol(this.text,A)})),x.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,x.verticalPlacedTextSymbolIndex),x.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,x.placedIconSymbolIndex),x.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,x.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let ox,sx;Zt("SymbolBucket",pf,{omit:["layers","collisionBoxArray","features","compareText"]}),pf.MAX_GLYPHS=65535,pf.addDynamicAttributes=v_;var lx={get paint(){return sx=sx||new Ki({"icon-opacity":new gr(Qe.paint_symbol["icon-opacity"]),"icon-color":new gr(Qe.paint_symbol["icon-color"]),"icon-halo-color":new gr(Qe.paint_symbol["icon-halo-color"]),"icon-halo-width":new gr(Qe.paint_symbol["icon-halo-width"]),"icon-halo-blur":new gr(Qe.paint_symbol["icon-halo-blur"]),"icon-translate":new tr(Qe.paint_symbol["icon-translate"]),"icon-translate-anchor":new tr(Qe.paint_symbol["icon-translate-anchor"]),"text-opacity":new gr(Qe.paint_symbol["text-opacity"]),"text-color":new gr(Qe.paint_symbol["text-color"],{runtimeType:ko,getOverride:v=>v.textColor,hasOverride:v=>!!v.textColor}),"text-halo-color":new gr(Qe.paint_symbol["text-halo-color"]),"text-halo-width":new gr(Qe.paint_symbol["text-halo-width"]),"text-halo-blur":new gr(Qe.paint_symbol["text-halo-blur"]),"text-translate":new tr(Qe.paint_symbol["text-translate"]),"text-translate-anchor":new tr(Qe.paint_symbol["text-translate-anchor"])})},get layout(){return ox=ox||new Ki({"symbol-placement":new tr(Qe.layout_symbol["symbol-placement"]),"symbol-spacing":new tr(Qe.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new tr(Qe.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new gr(Qe.layout_symbol["symbol-sort-key"]),"symbol-z-order":new tr(Qe.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new tr(Qe.layout_symbol["icon-allow-overlap"]),"icon-overlap":new tr(Qe.layout_symbol["icon-overlap"]),"icon-ignore-placement":new tr(Qe.layout_symbol["icon-ignore-placement"]),"icon-optional":new tr(Qe.layout_symbol["icon-optional"]),"icon-rotation-alignment":new tr(Qe.layout_symbol["icon-rotation-alignment"]),"icon-size":new gr(Qe.layout_symbol["icon-size"]),"icon-text-fit":new tr(Qe.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new tr(Qe.layout_symbol["icon-text-fit-padding"]),"icon-image":new gr(Qe.layout_symbol["icon-image"]),"icon-rotate":new gr(Qe.layout_symbol["icon-rotate"]),"icon-padding":new gr(Qe.layout_symbol["icon-padding"]),"icon-keep-upright":new tr(Qe.layout_symbol["icon-keep-upright"]),"icon-offset":new gr(Qe.layout_symbol["icon-offset"]),"icon-anchor":new gr(Qe.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new tr(Qe.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new tr(Qe.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new tr(Qe.layout_symbol["text-rotation-alignment"]),"text-field":new gr(Qe.layout_symbol["text-field"]),"text-font":new gr(Qe.layout_symbol["text-font"]),"text-size":new gr(Qe.layout_symbol["text-size"]),"text-max-width":new gr(Qe.layout_symbol["text-max-width"]),"text-line-height":new tr(Qe.layout_symbol["text-line-height"]),"text-letter-spacing":new gr(Qe.layout_symbol["text-letter-spacing"]),"text-justify":new gr(Qe.layout_symbol["text-justify"]),"text-radial-offset":new gr(Qe.layout_symbol["text-radial-offset"]),"text-variable-anchor":new tr(Qe.layout_symbol["text-variable-anchor"]),"text-variable-anchor-offset":new gr(Qe.layout_symbol["text-variable-anchor-offset"]),"text-anchor":new gr(Qe.layout_symbol["text-anchor"]),"text-max-angle":new tr(Qe.layout_symbol["text-max-angle"]),"text-writing-mode":new tr(Qe.layout_symbol["text-writing-mode"]),"text-rotate":new gr(Qe.layout_symbol["text-rotate"]),"text-padding":new tr(Qe.layout_symbol["text-padding"]),"text-keep-upright":new tr(Qe.layout_symbol["text-keep-upright"]),"text-transform":new gr(Qe.layout_symbol["text-transform"]),"text-offset":new gr(Qe.layout_symbol["text-offset"]),"text-allow-overlap":new tr(Qe.layout_symbol["text-allow-overlap"]),"text-overlap":new tr(Qe.layout_symbol["text-overlap"]),"text-ignore-placement":new tr(Qe.layout_symbol["text-ignore-placement"]),"text-optional":new tr(Qe.layout_symbol["text-optional"])})}};class y_{constructor(h){if(h.property.overrides===void 0)throw new Error("overrides must be provided to instantiate FormatSectionOverride class");this.type=h.property.overrides?h.property.overrides.runtimeType:mi,this.defaultValue=h}evaluate(h){if(h.formattedSection){const g=this.defaultValue.property.overrides;if(g&&g.hasOverride(h.formattedSection))return g.getOverride(h.formattedSection)}return h.feature&&h.featureState?this.defaultValue.evaluate(h.feature,h.featureState):this.defaultValue.property.specification.default}eachChild(h){this.defaultValue.isConstant()||h(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}Zt("FormatSectionOverride",y_,{omit:["defaultValue"]});class eg extends _a{constructor(h,g){super(h,lx,g)}recalculate(h,g){if(super.recalculate(h,g),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")==="map"?"map":"viewport"),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){const x=this.layout.get("text-writing-mode");if(x){const A=[];for(const k of x)A.indexOf(k)<0&&A.push(k);this.layout._values["text-writing-mode"]=A}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()}getValueAndResolveTokens(h,g,x,A){const k=this.layout.get(h).evaluate(g,{},x,A),L=this._unevaluatedLayout._values[h];return L.isDataDriven()||Xh(L.value)||!k?k:(function(z,V){return V.replace(/{([^{}]+)}/g,((X,Z)=>z&&Z in z?String(z[Z]):""))})(g.properties,k)}createBucket(h){return new pf(h)}queryRadius(){return 0}queryIntersectsFeature(){throw new Error("Should take a different path in FeatureIndex")}_setPaintOverrides(){for(const h of lx.paint.overridableProperties){if(!eg.hasPaintOverride(this.layout,h))continue;const g=this.paint.get(h),x=new y_(g),A=new kp(x,g.property.specification);let k=null;k=g.value.kind==="constant"||g.value.kind==="source"?new to("source",A):new $l("composite",A,g.value.zoomStops),this.paint._values[h]=new js(g.property,k,g.parameters)}}_handleOverridablePaintPropertyUpdate(h,g,x){return!(!this.layout||g.isDataDriven()||x.isDataDriven())&&eg.hasPaintOverride(this.layout,h)}static hasPaintOverride(h,g){const x=h.get("text-field"),A=lx.paint.properties[g];let k=!1;const L=z=>{for(const V of z)if(A.overrides&&A.overrides.hasOverride(V))return void(k=!0)};if(x.value.kind==="constant"&&x.value.value instanceof ta)L(x.value.value.sections);else if(x.value.kind==="source"||x.value.kind==="composite"){const z=X=>{k||(X instanceof Mr&&nn(X.value)===cl?L(X.value.sections):X instanceof Tp?L(X.sections):X.eachChild(z))},V=x.value;V._styleExpression&&z(V._styleExpression.expression)}return k}}let NS;var TM={get paint(){return NS=NS||new Ki({"background-color":new tr(Qe.paint_background["background-color"]),"background-pattern":new Np(Qe.paint_background["background-pattern"]),"background-opacity":new tr(Qe.paint_background["background-opacity"])})}};class Zv extends _a{constructor(h,g){super(h,TM,g)}}class AM extends _a{constructor(h,g){super(h,{},g),this.onAdd=x=>{this.implementation.onAdd&&this.implementation.onAdd(x,x.painter.context.gl)},this.onRemove=x=>{this.implementation.onRemove&&this.implementation.onRemove(x,x.painter.context.gl)},this.implementation=h}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){throw new Error("Custom layers cannot be serialized")}}class BS{constructor(h){this._methodToThrottle=h,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._methodToThrottle()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout((()=>{this._triggered=!1,this._methodToThrottle()}),0))}remove(){delete this._channel,this._methodToThrottle=()=>{}}}const bi={once:!0},qv=63710088e-1;class su{constructor(h,g){if(isNaN(h)||isNaN(g))throw new Error(`Invalid LngLat object: (${h}, ${g})`);if(this.lng=+h,this.lat=+g,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new su(_r(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(h){const g=Math.PI/180,x=this.lat*g,A=h.lat*g,k=Math.sin(x)*Math.sin(A)+Math.cos(x)*Math.cos(A)*Math.cos((h.lng-this.lng)*g);return qv*Math.acos(Math.min(k,1))}static convert(h){if(h instanceof su)return h;if(Array.isArray(h)&&(h.length===2||h.length===3))return new su(Number(h[0]),Number(h[1]));if(!Array.isArray(h)&&typeof h=="object"&&h!==null)return new su(Number("lng"in h?h.lng:h.lon),Number(h.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const __=2*Math.PI*qv;function ux(v){return __*Math.cos(v*Math.PI/180)}function b_(v){return(180+v)/360}function tg(v){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+v*Math.PI/360)))/360}function Yv(v,h){return v/ux(h)}function cx(v){return 360/Math.PI*Math.atan(Math.exp((180-360*v)*Math.PI/180))-90}function hx(v,h){return v*ux(cx(h))}class Kv{constructor(h,g,x=0){this.x=+h,this.y=+g,this.z=+x}static fromLngLat(h,g=0){const x=su.convert(h);return new Kv(b_(x.lng),tg(x.lat),Yv(g,x.lat))}toLngLat(){return new su(360*this.x-180,cx(this.y))}toAltitude(){return hx(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/__*(h=cx(this.y),1/Math.cos(h*Math.PI/180));var h}}function zS(v,h,g){var x=2*Math.PI*6378137/256/Math.pow(2,g);return[v*x-2*Math.PI*6378137/2,h*x-2*Math.PI*6378137/2]}class x_{constructor(h,g,x){if(!(function(A,k,L){return!(A<0||A>25||L<0||L>=Math.pow(2,A)||k<0||k>=Math.pow(2,A))})(h,g,x))throw new Error(`x=${g}, y=${x}, z=${h} outside of bounds. 0<=x<${Math.pow(2,h)}, 0<=y<${Math.pow(2,h)} 0<=z<=25 `);this.z=h,this.x=g,this.y=x,this.key=gf(0,h,h,g,x)}equals(h){return this.z===h.z&&this.x===h.x&&this.y===h.y}url(h,g,x){const A=(L=this.y,z=this.z,V=zS(256*(k=this.x),256*(L=Math.pow(2,z)-L-1),z),X=zS(256*(k+1),256*(L+1),z),V[0]+","+V[1]+","+X[0]+","+X[1]);var k,L,z,V,X;const Z=(function(J,oe,le){let ce,ge="";for(let be=J;be>0;be--)ce=1<<be-1,ge+=(oe&ce?1:0)+(le&ce?2:0);return ge})(this.z,this.x,this.y);return h[(this.x+this.y)%h.length].replace(/{prefix}/g,(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(x==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace(/{ratio}/g,g>1?"@2x":"").replace(/{quadkey}/g,Z).replace(/{bbox-epsg-3857}/g,A)}isChildOf(h){const g=this.z-h.z;return g>0&&h.x===this.x>>g&&h.y===this.y>>g}getTilePoint(h){const g=Math.pow(2,this.z);return new l((h.x*g-this.x)*je,(h.y*g-this.y)*je)}toString(){return`${this.z}/${this.x}/${this.y}`}}class fx{constructor(h,g){this.wrap=h,this.canonical=g,this.key=gf(h,g.z,g.z,g.x,g.y)}}class hi{constructor(h,g,x,A,k){if(this.terrainRttPosMatrix32f=null,h<x)throw new Error(`overscaledZ should be >= z; overscaledZ = ${h}; z = ${x}`);this.overscaledZ=h,this.wrap=g,this.canonical=new x_(x,+A,+k),this.key=gf(g,h,x,A,k)}clone(){return new hi(this.overscaledZ,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)}equals(h){return this.overscaledZ===h.overscaledZ&&this.wrap===h.wrap&&this.canonical.equals(h.canonical)}scaledTo(h){if(h>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${h}; overscaledZ = ${this.overscaledZ}`);const g=this.canonical.z-h;return h>this.canonical.z?new hi(h,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new hi(h,this.wrap,h,this.canonical.x>>g,this.canonical.y>>g)}isOverscaled(){return this.overscaledZ>this.canonical.z}calculateScaledKey(h,g){if(h>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${h}; overscaledZ = ${this.overscaledZ}`);const x=this.canonical.z-h;return h>this.canonical.z?gf(this.wrap*+g,h,this.canonical.z,this.canonical.x,this.canonical.y):gf(this.wrap*+g,h,h,this.canonical.x>>x,this.canonical.y>>x)}isChildOf(h){if(h.wrap!==this.wrap||this.overscaledZ-h.overscaledZ<=0)return!1;if(h.overscaledZ===0)return this.overscaledZ>0;const g=this.canonical.z-h.canonical.z;return!(g<0)&&h.canonical.x===this.canonical.x>>g&&h.canonical.y===this.canonical.y>>g}children(h){if(this.overscaledZ>=h)return[new hi(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const g=this.canonical.z+1,x=2*this.canonical.x,A=2*this.canonical.y;return[new hi(g,this.wrap,g,x,A),new hi(g,this.wrap,g,x+1,A),new hi(g,this.wrap,g,x,A+1),new hi(g,this.wrap,g,x+1,A+1)]}isLessThan(h){return this.wrap<h.wrap||!(this.wrap>h.wrap)&&(this.overscaledZ<h.overscaledZ||!(this.overscaledZ>h.overscaledZ)&&(this.canonical.x<h.canonical.x||!(this.canonical.x>h.canonical.x)&&this.canonical.y<h.canonical.y))}wrapped(){return new hi(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(h){return new hi(this.overscaledZ,h,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new fx(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}getTilePoint(h){return this.canonical.getTilePoint(new Kv(h.x-this.wrap,h.y))}}function gf(v,h,g,x,A){(v*=2)<0&&(v=-1*v-1);const k=1<<g;return(k*k*v+k*A+x).toString(36)+g.toString(36)+h.toString(36)}function sa(v,h){return h?v.properties[h]:v.id}Zt("CanonicalTileID",x_),Zt("OverscaledTileID",hi,{omit:["terrainRttPosMatrix32f"]});class Vd{constructor(){this.minX=1/0,this.maxX=-1/0,this.minY=1/0,this.maxY=-1/0}extend(h){return this.minX=Math.min(this.minX,h.x),this.minY=Math.min(this.minY,h.y),this.maxX=Math.max(this.maxX,h.x),this.maxY=Math.max(this.maxY,h.y),this}expandBy(h){return this.minX-=h,this.minY-=h,this.maxX+=h,this.maxY+=h,(this.minX>this.maxX||this.minY>this.maxY)&&(this.minX=1/0,this.maxX=-1/0,this.minY=1/0,this.maxY=-1/0),this}shrinkBy(h){return this.expandBy(-h)}map(h){const g=new Vd;return g.extend(h(new l(this.minX,this.minY))),g.extend(h(new l(this.maxX,this.minY))),g.extend(h(new l(this.minX,this.maxY))),g.extend(h(new l(this.maxX,this.maxY))),g}static fromPoints(h){const g=new Vd;for(const x of h)g.extend(x);return g}contains(h){return h.x>=this.minX&&h.x<=this.maxX&&h.y>=this.minY&&h.y<=this.maxY}empty(){return this.minX>this.maxX}width(){return this.maxX-this.minX}height(){return this.maxY-this.minY}covers(h){return!this.empty()&&!h.empty()&&h.minX>=this.minX&&h.maxX<=this.maxX&&h.minY>=this.minY&&h.maxY<=this.maxY}intersects(h){return!this.empty()&&!h.empty()&&h.minX<=this.maxX&&h.maxX>=this.minX&&h.minY<=this.maxY&&h.maxY>=this.minY}}class dx{constructor(h){this._stringToNumber={},this._numberToString=[];for(let g=0;g<h.length;g++){const x=h[g];this._stringToNumber[x]=g,this._numberToString[g]=x}}encode(h){return this._stringToNumber[h]}decode(h){if(h>=this._numberToString.length)throw new Error(`Out of bounds. Index requested n=${h} can't be >= this._numberToString.length ${this._numberToString.length}`);return this._numberToString[h]}}class FS{constructor(h,g,x,A,k){this.type="Feature",this._vectorTileFeature=h,h._z=g,h._x=x,h._y=A,this.properties=h.properties,this.id=k}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry}set geometry(h){this._geometry=h}toJSON(){const h={geometry:this.geometry};for(const g in this)g!=="_geometry"&&g!=="_vectorTileFeature"&&(h[g]=this[g]);return h}}class w_{constructor(h,g){this.tileID=h,this.x=h.canonical.x,this.y=h.canonical.y,this.z=h.canonical.z,this.grid=new Zc(je,16,0),this.grid3D=new Zc(je,16,0),this.featureIndexArray=new ze,this.promoteId=g}insert(h,g,x,A,k,L){const z=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(x,A,k);const V=L?this.grid3D:this.grid;for(let X=0;X<g.length;X++){const Z=g[X],J=[1/0,1/0,-1/0,-1/0];for(let oe=0;oe<Z.length;oe++){const le=Z[oe];J[0]=Math.min(J[0],le.x),J[1]=Math.min(J[1],le.y),J[2]=Math.max(J[2],le.x),J[3]=Math.max(J[3],le.y)}J[0]<je&&J[1]<je&&J[2]>=0&&J[3]>=0&&V.insert(z,J[0],J[1],J[2],J[3])}}loadVTLayers(){return this.vtLayers||(this.vtLayers=new jb(new Co(this.rawTileData)).layers,this.sourceLayerCoder=new dx(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers}query(h,g,x,A){this.loadVTLayers();const k=h.params,L=je/h.tileSize/h.scale,z=bo(k.filter,k.globalState),V=h.queryGeometry,X=h.queryPadding*L,Z=Vd.fromPoints(V),J=this.grid.query(Z.minX-X,Z.minY-X,Z.maxX+X,Z.maxY+X),oe=Vd.fromPoints(h.cameraQueryGeometry).expandBy(X),le=this.grid3D.query(oe.minX,oe.minY,oe.maxX,oe.maxY,((be,Ee,qe,Oe)=>(function(Ve,ot,gt,Et,Wt){for(const Ht of Ve)if(ot<=Ht.x&&gt<=Ht.y&&Et>=Ht.x&&Wt>=Ht.y)return!0;const Ft=[new l(ot,gt),new l(ot,Wt),new l(Et,Wt),new l(Et,gt)];if(Ve.length>2){for(const Ht of Ft)if(Ed(Ve,Ht))return!0}for(let Ht=0;Ht<Ve.length-1;Ht++)if(fS(Ve[Ht],Ve[Ht+1],Ft))return!0;return!1})(h.cameraQueryGeometry,be-X,Ee-X,qe+X,Oe+X)));for(const be of le)J.push(be);J.sort(T_);const ce={};let ge;for(let be=0;be<J.length;be++){const Ee=J[be];if(Ee===ge)continue;ge=Ee;const qe=this.featureIndexArray.get(Ee);let Oe=null;this.loadMatchingFeature(ce,qe.bucketIndex,qe.sourceLayerIndex,qe.featureIndex,z,k.layers,k.availableImages,g,x,A,((Ve,ot,gt)=>(Oe||(Oe=nf(Ve)),ot.queryIntersectsFeature({queryGeometry:V,feature:Ve,featureState:gt,geometry:Oe,zoom:this.z,transform:h.transform,pixelsToTileUnits:L,pixelPosMatrix:h.pixelPosMatrix,unwrappedTileID:this.tileID.toUnwrapped(),getElevation:h.getElevation}))))}return ce}loadMatchingFeature(h,g,x,A,k,L,z,V,X,Z,J){const oe=this.bucketLayerIDs[g];if(L&&!oe.some((be=>L.has(be))))return;const le=this.sourceLayerCoder.decode(x),ce=this.vtLayers[le].feature(A);if(k.needGeometry){const be=qs(ce,!0);if(!k.filter(new Ni(this.tileID.overscaledZ),be,this.tileID.canonical))return}else if(!k.filter(new Ni(this.tileID.overscaledZ),ce))return;const ge=this.getId(ce,le);for(let be=0;be<oe.length;be++){const Ee=oe[be];if(L&&!L.has(Ee))continue;const qe=V[Ee];if(!qe)continue;let Oe={};ge&&Z&&(Oe=Z.getState(qe.sourceLayer||"_geojsonTileLayer",ge));const Ve=Kt({},X[Ee]);Ve.paint=S_(Ve.paint,qe.paint,ce,Oe,z),Ve.layout=S_(Ve.layout,qe.layout,ce,Oe,z);const ot=!J||J(ce,qe,Oe);if(!ot)continue;const gt=new FS(ce,this.z,this.x,this.y,ge);gt.layer=Ve;let Et=h[Ee];Et===void 0&&(Et=h[Ee]=[]),Et.push({featureIndex:A,feature:gt,intersectionZ:ot})}}lookupSymbolFeatures(h,g,x,A,k,L,z,V){const X={};this.loadVTLayers();const Z=bo(k.filterSpec,k.globalState);for(const J of h)this.loadMatchingFeature(X,x,A,J,Z,L,z,V,g);return X}hasLayer(h){for(const g of this.bucketLayerIDs)for(const x of g)if(h===x)return!0;return!1}getId(h,g){var x;let A=h.id;return this.promoteId&&(A=h.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[g]],typeof A=="boolean"&&(A=Number(A)),A===void 0&&(!((x=h.properties)===null||x===void 0)&&x.cluster)&&this.promoteId&&(A=Number(h.properties.cluster_id))),A}}function S_(v,h,g,x,A){return yr(v,((k,L)=>{const z=h instanceof Sd?h.get(L):null;return z&&z.evaluate?z.evaluate(g,x,A):z}))}function T_(v,h){return h-v}function px(v,h,g,x,A){const k=[];for(let L=0;L<v.length;L++){const z=v[L];let V;for(let X=0;X<z.length-1;X++){let Z=z[X],J=z[X+1];Z.x<h&&J.x<h||(Z.x<h?Z=new l(h,Z.y+(h-Z.x)/(J.x-Z.x)*(J.y-Z.y))._round():J.x<h&&(J=new l(h,Z.y+(h-Z.x)/(J.x-Z.x)*(J.y-Z.y))._round()),Z.y<g&&J.y<g||(Z.y<g?Z=new l(Z.x+(g-Z.y)/(J.y-Z.y)*(J.x-Z.x),g)._round():J.y<g&&(J=new l(Z.x+(g-Z.y)/(J.y-Z.y)*(J.x-Z.x),g)._round()),Z.x>=x&&J.x>=x||(Z.x>=x?Z=new l(x,Z.y+(x-Z.x)/(J.x-Z.x)*(J.y-Z.y))._round():J.x>=x&&(J=new l(x,Z.y+(x-Z.x)/(J.x-Z.x)*(J.y-Z.y))._round()),Z.y>=A&&J.y>=A||(Z.y>=A?Z=new l(Z.x+(A-Z.y)/(J.y-Z.y)*(J.x-Z.x),A)._round():J.y>=A&&(J=new l(Z.x+(A-Z.y)/(J.y-Z.y)*(J.x-Z.x),A)._round()),V&&Z.equals(V[V.length-1])||(V=[Z],k.push(V)),V.push(J)))))}}return k}Zt("FeatureIndex",w_,{omit:["rawTileData","sourceLayerCoder"]});class hh extends l{constructor(h,g,x,A){super(h,g),this.angle=x,A!==void 0&&(this.segment=A)}clone(){return new hh(this.x,this.y,this.angle,this.segment)}}function A_(v,h,g,x,A){if(h.segment===void 0||g===0)return!0;let k=h,L=h.segment+1,z=0;for(;z>-g/2;){if(L--,L<0)return!1;z-=v[L].dist(k),k=v[L]}z+=v[L].dist(v[L+1]),L++;const V=[];let X=0;for(;z<g/2;){const Z=v[L],J=v[L+1];if(!J)return!1;let oe=v[L-1].angleTo(Z)-Z.angleTo(J);for(oe=Math.abs((oe+3*Math.PI)%(2*Math.PI)-Math.PI),V.push({distance:z,angleDelta:oe}),X+=oe;z-V[0].distance>x;)X-=V.shift().angleDelta;if(X>A)return!1;L++,z+=Z.dist(J)}return!0}function C_(v){let h=0;for(let g=0;g<v.length-1;g++)h+=v[g].dist(v[g+1]);return h}function VS(v,h,g){return v?.6*h*g:0}function gx(v,h){return Math.max(v?v.right-v.left:0,h?h.right-h.left:0)}function CM(v,h,g,x,A,k){const L=VS(g,A,k),z=gx(g,x)*k;let V=0;const X=C_(v)/2;for(let Z=0;Z<v.length-1;Z++){const J=v[Z],oe=v[Z+1],le=J.dist(oe);if(V+le>X){const ce=(X-V)/le,ge=as.number(J.x,oe.x,ce),be=as.number(J.y,oe.y,ce),Ee=new hh(ge,be,oe.angleTo(J),Z);return Ee._round(),!L||A_(v,Ee,z,L,h)?Ee:void 0}V+=le}}function US(v,h,g,x,A,k,L,z,V){const X=VS(x,k,L),Z=gx(x,A),J=Z*L,oe=v[0].x===0||v[0].x===V||v[0].y===0||v[0].y===V;return h-J<h/4&&(h=J+h/4),HS(v,oe?h/2*z%h:(Z/2+2*k)*L*z%h,h,X,g,J,oe,!1,V)}function HS(v,h,g,x,A,k,L,z,V){const X=k/2,Z=C_(v);let J=0,oe=h-g,le=[];for(let ce=0;ce<v.length-1;ce++){const ge=v[ce],be=v[ce+1],Ee=ge.dist(be),qe=be.angleTo(ge);for(;oe+g<J+Ee;){oe+=g;const Oe=(oe-J)/Ee,Ve=as.number(ge.x,be.x,Oe),ot=as.number(ge.y,be.y,Oe);if(Ve>=0&&Ve<V&&ot>=0&&ot<V&&oe-X>=0&&oe+X<=Z){const gt=new hh(Ve,ot,qe,ce);gt._round(),x&&!A_(v,gt,k,x,A)||le.push(gt)}}J+=Ee}return z||le.length||L||(le=HS(v,J/2,g,x,A,k,L,!0,V)),le}function jS(v,h,g,x){const A=[],k=v.image,L=k.pixelRatio,z=k.paddedRect.w-2,V=k.paddedRect.h-2;let X={x1:v.left,y1:v.top,x2:v.right,y2:v.bottom};const Z=k.stretchX||[[0,z]],J=k.stretchY||[[0,V]],oe=(Tt,xr)=>Tt+xr[1]-xr[0],le=Z.reduce(oe,0),ce=J.reduce(oe,0),ge=z-le,be=V-ce;let Ee=0,qe=le,Oe=0,Ve=ce,ot=0,gt=ge,Et=0,Wt=be;if(k.content&&x){const Tt=k.content,xr=Tt[2]-Tt[0],Er=Tt[3]-Tt[1];(k.textFitWidth||k.textFitHeight)&&(X=g_(v)),Ee=lu(Z,0,Tt[0]),Oe=lu(J,0,Tt[1]),qe=lu(Z,Tt[0],Tt[2]),Ve=lu(J,Tt[1],Tt[3]),ot=Tt[0]-Ee,Et=Tt[1]-Oe,gt=xr-qe,Wt=Er-Ve}const Ft=X.x1,Ht=X.y1,ur=X.x2-Ft,Ut=X.y2-Ht,jt=(Tt,xr,Er,vr)=>{const ar=Qv(Tt.stretch-Ee,qe,ur,Ft),Yr=rg(Tt.fixed-ot,gt,Tt.stretch,le),on=Qv(xr.stretch-Oe,Ve,Ut,Ht),Fn=rg(xr.fixed-Et,Wt,xr.stretch,ce),Ra=Qv(Er.stretch-Ee,qe,ur,Ft),Ko=rg(Er.fixed-ot,gt,Er.stretch,le),qn=Qv(vr.stretch-Oe,Ve,Ut,Ht),xn=rg(vr.fixed-Et,Wt,vr.stretch,ce),ki=new l(ar,on),Nn=new l(Ra,on),Vn=new l(Ra,qn),wn=new l(ar,qn),Mo=new l(Yr/L,Fn/L),gs=new l(Ko/L,xn/L),Bn=h*Math.PI/180;if(Bn){const Un=Math.sin(Bn),la=Math.cos(Bn),Kn=[la,-Un,Un,la];ki._matMult(Kn),Nn._matMult(Kn),wn._matMult(Kn),Vn._matMult(Kn)}const Qo=Tt.stretch+Tt.fixed,Yn=xr.stretch+xr.fixed;return{tl:ki,tr:Nn,bl:wn,br:Vn,tex:{x:k.paddedRect.x+1+Qo,y:k.paddedRect.y+1+Yn,w:Er.stretch+Er.fixed-Qo,h:vr.stretch+vr.fixed-Yn},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Mo,pixelOffsetBR:gs,minFontScaleX:gt/L/ur,minFontScaleY:Wt/L/Ut,isSDF:g}};if(x&&(k.stretchX||k.stretchY)){const Tt=vx(Z,ge,le),xr=vx(J,be,ce);for(let Er=0;Er<Tt.length-1;Er++){const vr=Tt[Er],ar=Tt[Er+1];for(let Yr=0;Yr<xr.length-1;Yr++)A.push(jt(vr,xr[Yr],ar,xr[Yr+1]))}}else A.push(jt({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:z+1},{fixed:0,stretch:V+1}));return A}function lu(v,h,g){let x=0;for(const A of v)x+=Math.max(h,Math.min(g,A[1]))-Math.max(h,Math.min(g,A[0]));return x}function vx(v,h,g){const x=[{fixed:-1,stretch:0}];for(const[A,k]of v){const L=x[x.length-1];x.push({fixed:A-L.stretch,stretch:L.stretch}),x.push({fixed:A-L.stretch,stretch:L.stretch+(k-A)})}return x.push({fixed:h+1,stretch:g}),x}function Qv(v,h,g,x){return v/h*g+x}function rg(v,h,g,x){return v-h*g/x}Zt("Anchor",hh);class M_{constructor(h,g,x,A,k,L,z,V,X,Z){var J;if(this.boxStartIndex=h.length,X){let oe=L.top,le=L.bottom;const ce=L.collisionPadding;ce&&(oe-=ce[1],le+=ce[3]);let ge=le-oe;ge>0&&(ge=Math.max(10,ge),this.circleDiameter=ge)}else{const oe=!((J=L.image)===null||J===void 0)&&J.content&&(L.image.textFitWidth||L.image.textFitHeight)?g_(L):{x1:L.left,y1:L.top,x2:L.right,y2:L.bottom};oe.y1=oe.y1*z-V[0],oe.y2=oe.y2*z+V[2],oe.x1=oe.x1*z-V[3],oe.x2=oe.x2*z+V[1];const le=L.collisionPadding;if(le&&(oe.x1-=le[0]*z,oe.y1-=le[1]*z,oe.x2+=le[2]*z,oe.y2+=le[3]*z),Z){const ce=new l(oe.x1,oe.y1),ge=new l(oe.x2,oe.y1),be=new l(oe.x1,oe.y2),Ee=new l(oe.x2,oe.y2),qe=Z*Math.PI/180;ce._rotate(qe),ge._rotate(qe),be._rotate(qe),Ee._rotate(qe),oe.x1=Math.min(ce.x,ge.x,be.x,Ee.x),oe.x2=Math.max(ce.x,ge.x,be.x,Ee.x),oe.y1=Math.min(ce.y,ge.y,be.y,Ee.y),oe.y2=Math.max(ce.y,ge.y,be.y,Ee.y)}h.emplaceBack(g.x,g.y,oe.x1,oe.y1,oe.x2,oe.y2,x,A,k)}this.boxEndIndex=h.length}}class MM{constructor(h=[],g=(x,A)=>x<A?-1:x>A?1:0){if(this.data=h,this.length=this.data.length,this.compare=g,this.length>0)for(let x=(this.length>>1)-1;x>=0;x--)this._down(x)}push(h){this.data.push(h),this._up(this.length++)}pop(){if(this.length===0)return;const h=this.data[0],g=this.data.pop();return--this.length>0&&(this.data[0]=g,this._down(0)),h}peek(){return this.data[0]}_up(h){const{data:g,compare:x}=this,A=g[h];for(;h>0;){const k=h-1>>1,L=g[k];if(x(A,L)>=0)break;g[h]=L,h=k}g[h]=A}_down(h){const{data:g,compare:x}=this,A=this.length>>1,k=g[h];for(;h<A;){let L=1+(h<<1);const z=L+1;if(z<this.length&&x(g[z],g[L])<0&&(L=z),x(g[L],k)>=0)break;g[h]=g[L],h=L}g[h]=k}}function $S(v,h=1,g=!1){const x=Vd.fromPoints(v[0]),A=Math.min(x.width(),x.height());let k=A/2;const L=new MM([],mx),{minX:z,minY:V,maxX:X,maxY:Z}=x;if(A===0)return new l(z,V);for(let le=z;le<X;le+=A)for(let ce=V;ce<Z;ce+=A)L.push(new vf(le+k,ce+k,k,v));let J=(function(le){let ce=0,ge=0,be=0;const Ee=le[0];for(let qe=0,Oe=Ee.length,Ve=Oe-1;qe<Oe;Ve=qe++){const ot=Ee[qe],gt=Ee[Ve],Et=ot.x*gt.y-gt.x*ot.y;ge+=(ot.x+gt.x)*Et,be+=(ot.y+gt.y)*Et,ce+=3*Et}return new vf(ge/ce,be/ce,0,le)})(v),oe=L.length;for(;L.length;){const le=L.pop();(le.d>J.d||!J.d)&&(J=le,g&&console.log("found best %d after %d probes",Math.round(1e4*le.d)/1e4,oe)),le.max-J.d<=h||(k=le.h/2,L.push(new vf(le.p.x-k,le.p.y-k,k,v)),L.push(new vf(le.p.x+k,le.p.y-k,k,v)),L.push(new vf(le.p.x-k,le.p.y+k,k,v)),L.push(new vf(le.p.x+k,le.p.y+k,k,v)),oe+=4)}return g&&(console.log(`num probes: ${oe}`),console.log(`best distance: ${J.d}`)),J.p}function mx(v,h){return h.max-v.max}function vf(v,h,g,x){this.p=new l(v,h),this.h=g,this.d=(function(A,k){let L=!1,z=1/0;for(let V=0;V<k.length;V++){const X=k[V];for(let Z=0,J=X.length,oe=J-1;Z<J;oe=Z++){const le=X[Z],ce=X[oe];le.y>A.y!=ce.y>A.y&&A.x<(ce.x-le.x)*(A.y-le.y)/(ce.y-le.y)+le.x&&(L=!L),z=Math.min(z,aa(A,le,ce))}}return(L?1:-1)*Math.sqrt(z)})(this.p,x),this.max=this.d+this.h*Math.SQRT2}var ja;s.aE=void 0,(ja=s.aE||(s.aE={}))[ja.center=1]="center",ja[ja.left=2]="left",ja[ja.right=3]="right",ja[ja.top=4]="top",ja[ja.bottom=5]="bottom",ja[ja["top-left"]=6]="top-left",ja[ja["top-right"]=7]="top-right",ja[ja["bottom-left"]=8]="bottom-left",ja[ja["bottom-right"]=9]="bottom-right";const ps=Number.POSITIVE_INFINITY;function E_(v,h){return h[1]!==ps?(function(g,x,A){let k=0,L=0;switch(x=Math.abs(x),A=Math.abs(A),g){case"top-right":case"top-left":case"top":L=A-7;break;case"bottom-right":case"bottom-left":case"bottom":L=7-A}switch(g){case"top-right":case"bottom-right":case"right":k=-x;break;case"top-left":case"bottom-left":case"left":k=x}return[k,L]})(v,h[0],h[1]):(function(g,x){let A=0,k=0;x<0&&(x=0);const L=x/Math.SQRT2;switch(g){case"top-right":case"top-left":k=L-7;break;case"bottom-right":case"bottom-left":k=7-L;break;case"bottom":k=7-x;break;case"top":k=x-7}switch(g){case"top-right":case"bottom-right":A=-L;break;case"top-left":case"bottom-left":A=L;break;case"left":A=x;break;case"right":A=-x}return[A,k]})(v,h[0])}function yx(v,h,g){var x;const A=v.layout,k=(x=A.get("text-variable-anchor-offset"))===null||x===void 0?void 0:x.evaluate(h,{},g);if(k){const z=k.values,V=[];for(let X=0;X<z.length;X+=2){const Z=V[X]=z[X],J=z[X+1].map((oe=>oe*On));Z.startsWith("top")?J[1]-=7:Z.startsWith("bottom")&&(J[1]+=7),V[X+1]=J}return new En(V)}const L=A.get("text-variable-anchor");if(L){let z;z=v._unevaluatedLayout.getValue("text-radial-offset")!==void 0?[A.get("text-radial-offset").evaluate(h,{},g)*On,ps]:A.get("text-offset").evaluate(h,{},g).map((X=>X*On));const V=[];for(const X of L)V.push(X,E_(X,z));return new En(V)}return null}function I_(v){switch(v){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function WS(v,h,g,x,A,k,L,z,V,X,Z,J){let oe=k.textMaxSize.evaluate(h,{});oe===void 0&&(oe=L);const le=v.layers[0].layout,ce=le.get("icon-offset").evaluate(h,{},Z),ge=Qs(g.horizontal),be=L/24,Ee=v.tilePixelRatio*be,qe=v.tilePixelRatio*oe/24,Oe=v.tilePixelRatio*z,Ve=v.tilePixelRatio*le.get("symbol-spacing"),ot=le.get("text-padding")*v.tilePixelRatio,gt=(function(Er,vr,ar,Yr=1){const on=Er.get("icon-padding").evaluate(vr,{},ar),Fn=on&&on.values;return[Fn[0]*Yr,Fn[1]*Yr,Fn[2]*Yr,Fn[3]*Yr]})(le,h,Z,v.tilePixelRatio),Et=le.get("text-max-angle")/180*Math.PI,Wt=le.get("text-rotation-alignment")!=="viewport"&&le.get("symbol-placement")!=="point",Ft=le.get("icon-rotation-alignment")==="map"&&le.get("symbol-placement")!=="point",Ht=le.get("symbol-placement"),ur=Ve/2,Ut=le.get("icon-text-fit");let jt;x&&Ut!=="none"&&(v.allowVerticalPlacement&&g.vertical&&(jt=Gv(x,g.vertical,Ut,le.get("icon-text-fit-padding"),ce,be)),ge&&(x=Gv(x,ge,Ut,le.get("icon-text-fit-padding"),ce,be)));const Tt=Z?J.line.getGranularityForZoomLevel(Z.z):1,xr=(Er,vr)=>{vr.x<0||vr.x>=je||vr.y<0||vr.y>=je||(function(ar,Yr,on,Fn,Ra,Ko,qn,xn,ki,Nn,Vn,wn,Mo,gs,Bn,Qo,Yn,Un,la,Kn,Hi,vs,Ud,Eo,YS){const mf=ar.addToLineVertexArray(Yr,on);let rc,Hd,ng,fh,d=0,_=0,T=0,D=0,U=-1,G=-1;const ne={};let _e=th("");if(ar.allowVerticalPlacement&&Fn.vertical){const er=xn.layout.get("text-rotate").evaluate(Hi,{},Eo)+90;ng=new M_(ki,Yr,Nn,Vn,wn,Fn.vertical,Mo,gs,Bn,er),qn&&(fh=new M_(ki,Yr,Nn,Vn,wn,qn,Yn,Un,Bn,er))}if(Ra){const er=xn.layout.get("icon-rotate").evaluate(Hi,{}),Ir=xn.layout.get("icon-text-fit")!=="none",ei=jS(Ra,er,Ud,Ir),ti=qn?jS(qn,er,Ud,Ir):void 0;Hd=new M_(ki,Yr,Nn,Vn,wn,Ra,Yn,Un,!1,er),d=4*ei.length;const ms=ar.iconSizeData;let ic=null;ms.kind==="source"?(ic=[au*xn.layout.get("icon-size").evaluate(Hi,{})],ic[0]>Yo&&dr(`${ar.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)):ms.kind==="composite"&&(ic=[au*vs.compositeIconSizes[0].evaluate(Hi,{},Eo),au*vs.compositeIconSizes[1].evaluate(Hi,{},Eo)],(ic[0]>Yo||ic[1]>Yo)&&dr(`${ar.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)),ar.addSymbols(ar.icon,ei,ic,Kn,la,Hi,s.ao.none,Yr,mf.lineStartIndex,mf.lineLength,-1,Eo),U=ar.icon.placedSymbolArray.length-1,ti&&(_=4*ti.length,ar.addSymbols(ar.icon,ti,ic,Kn,la,Hi,s.ao.vertical,Yr,mf.lineStartIndex,mf.lineLength,-1,Eo),G=ar.icon.placedSymbolArray.length-1)}const Ue=Object.keys(Fn.horizontal);for(const er of Ue){const Ir=Fn.horizontal[er];if(!rc){_e=th(Ir.text);const ti=xn.layout.get("text-rotate").evaluate(Hi,{},Eo);rc=new M_(ki,Yr,Nn,Vn,wn,Ir,Mo,gs,Bn,ti)}const ei=Ir.positionedLines.length===1;if(T+=ig(ar,Yr,Ir,Ko,xn,Bn,Hi,Qo,mf,Fn.vertical?s.ao.horizontal:s.ao.horizontalOnly,ei?Ue:[er],ne,U,vs,Eo),ei)break}Fn.vertical&&(D+=ig(ar,Yr,Fn.vertical,Ko,xn,Bn,Hi,Qo,mf,s.ao.vertical,["vertical"],ne,G,vs,Eo));const dt=rc?rc.boxStartIndex:ar.collisionBoxArray.length,At=rc?rc.boxEndIndex:ar.collisionBoxArray.length,Pt=ng?ng.boxStartIndex:ar.collisionBoxArray.length,vt=ng?ng.boxEndIndex:ar.collisionBoxArray.length,bt=Hd?Hd.boxStartIndex:ar.collisionBoxArray.length,fr=Hd?Hd.boxEndIndex:ar.collisionBoxArray.length,Lr=fh?fh.boxStartIndex:ar.collisionBoxArray.length,sn=fh?fh.boxEndIndex:ar.collisionBoxArray.length;let Je=-1;const Ze=(er,Ir)=>er&&er.circleDiameter?Math.max(er.circleDiameter,Ir):Ir;Je=Ze(rc,Je),Je=Ze(ng,Je),Je=Ze(Hd,Je),Je=Ze(fh,Je);const ft=Je>-1?1:0;ft&&(Je*=YS/On),ar.glyphOffsetArray.length>=pf.MAX_GLYPHS&&dr("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),Hi.sortKey!==void 0&&ar.addToSortKeyRanges(ar.symbolInstances.length,Hi.sortKey);const Mt=yx(xn,Hi,Eo),[Ar,zi]=(function(er,Ir){const ei=er.length,ti=Ir?.values;if(ti?.length>0)for(let ms=0;ms<ti.length;ms+=2){const ic=ti[ms+1];er.emplaceBack(s.aE[ti[ms]],ic[0],ic[1])}return[ei,er.length]})(ar.textAnchorOffsets,Mt);ar.symbolInstances.emplaceBack(Yr.x,Yr.y,ne.right>=0?ne.right:-1,ne.center>=0?ne.center:-1,ne.left>=0?ne.left:-1,ne.vertical||-1,U,G,_e,dt,At,Pt,vt,bt,fr,Lr,sn,Nn,T,D,d,_,ft,0,Mo,Je,Ar,zi)})(v,vr,Er,g,x,A,jt,v.layers[0],v.collisionBoxArray,h.index,h.sourceLayerIndex,v.index,Ee,[ot,ot,ot,ot],Wt,V,Oe,gt,Ft,ce,h,k,X,Z,L)};if(Ht==="line")for(const Er of px(h.geometry,0,0,je,je)){const vr=lf(Er,Tt),ar=US(vr,Ve,Et,g.vertical||ge,x,24,qe,v.overscaling,je);for(const Yr of ar)ge&&GS(v,ge.text,ur,Yr)||xr(vr,Yr)}else if(Ht==="line-center"){for(const Er of h.geometry)if(Er.length>1){const vr=lf(Er,Tt),ar=CM(vr,Et,g.vertical||ge,x,24,qe);ar&&xr(vr,ar)}}else if(h.type==="Polygon")for(const Er of nd(h.geometry,0)){const vr=$S(Er,16);xr(lf(Er[0],Tt,!0),new hh(vr.x,vr.y,0))}else if(h.type==="LineString")for(const Er of h.geometry){const vr=lf(Er,Tt);xr(vr,new hh(vr[0].x,vr[0].y,0))}else if(h.type==="Point")for(const Er of h.geometry)for(const vr of Er)xr([vr],new hh(vr.x,vr.y,0))}function ig(v,h,g,x,A,k,L,z,V,X,Z,J,oe,le,ce){const ge=(function(qe,Oe,Ve,ot,gt,Et,Wt,Ft){const Ht=ot.layout.get("text-rotate").evaluate(Et,{})*Math.PI/180,ur=[];for(const Ut of Oe.positionedLines)for(const jt of Ut.positionedGlyphs){if(!jt.rect)continue;const Tt=jt.rect||{};let xr=4,Er=!0,vr=1,ar=0;const Yr=(gt||Ft)&&jt.vertical,on=jt.metrics.advance*jt.scale/2;if(Ft&&Oe.verticalizable&&(ar=Ut.lineOffset/2-(jt.imageName?-(On-jt.metrics.width*jt.scale)/2:(jt.scale-1)*On)),jt.imageName){const Un=Wt[jt.imageName];Er=Un.sdf,vr=Un.pixelRatio,xr=1/vr}const Fn=gt?[jt.x+on,jt.y]:[0,0];let Ra=gt?[0,0]:[jt.x+on+Ve[0],jt.y+Ve[1]-ar],Ko=[0,0];Yr&&(Ko=Ra,Ra=[0,0]);const qn=jt.metrics.isDoubleResolution?2:1,xn=(jt.metrics.left-xr)*jt.scale-on+Ra[0],ki=(-jt.metrics.top-xr)*jt.scale+Ra[1],Nn=xn+Tt.w/qn*jt.scale/vr,Vn=ki+Tt.h/qn*jt.scale/vr,wn=new l(xn,ki),Mo=new l(Nn,ki),gs=new l(xn,Vn),Bn=new l(Nn,Vn);if(Yr){const Un=new l(-on,on- -17),la=-Math.PI/2,Kn=12-on,Hi=new l(22-Kn,-(jt.imageName?Kn:0)),vs=new l(...Ko);wn._rotateAround(la,Un)._add(Hi)._add(vs),Mo._rotateAround(la,Un)._add(Hi)._add(vs),gs._rotateAround(la,Un)._add(Hi)._add(vs),Bn._rotateAround(la,Un)._add(Hi)._add(vs)}if(Ht){const Un=Math.sin(Ht),la=Math.cos(Ht),Kn=[la,-Un,Un,la];wn._matMult(Kn),Mo._matMult(Kn),gs._matMult(Kn),Bn._matMult(Kn)}const Qo=new l(0,0),Yn=new l(0,0);ur.push({tl:wn,tr:Mo,bl:gs,br:Bn,tex:Tt,writingMode:Oe.writingMode,glyphOffset:Fn,sectionIndex:jt.sectionIndex,isSDF:Er,pixelOffsetTL:Qo,pixelOffsetBR:Yn,minFontScaleX:0,minFontScaleY:0})}return ur})(0,g,z,A,k,L,x,v.allowVerticalPlacement),be=v.textSizeData;let Ee=null;be.kind==="source"?(Ee=[au*A.layout.get("text-size").evaluate(L,{})],Ee[0]>Yo&&dr(`${v.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)):be.kind==="composite"&&(Ee=[au*le.compositeTextSizes[0].evaluate(L,{},ce),au*le.compositeTextSizes[1].evaluate(L,{},ce)],(Ee[0]>Yo||Ee[1]>Yo)&&dr(`${v.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)),v.addSymbols(v.text,ge,Ee,z,k,L,X,h,V.lineStartIndex,V.lineLength,oe,ce);for(const qe of Z)J[qe]=v.text.placedSymbolArray.length-1;return 4*ge.length}function Qs(v){for(const h in v)return v[h];return null}function GS(v,h,g,x){const A=v.compareText;if(h in A){const k=A[h];for(let L=k.length-1;L>=0;L--)if(x.dist(k[L])<g)return!0}else A[h]=[];return A[h].push(x),!1}const Jv=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class uu{static from(h){if(!(h instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[g,x]=new Uint8Array(h,0,2);if(g!==219)throw new Error("Data does not appear to be in a KDBush format.");const A=x>>4;if(A!==1)throw new Error(`Got v${A} data when expected v1.`);const k=Jv[15&x];if(!k)throw new Error("Unrecognized array type.");const[L]=new Uint16Array(h,2,1),[z]=new Uint32Array(h,4,1);return new uu(z,L,k,h)}constructor(h,g=64,x=Float64Array,A){if(isNaN(h)||h<0)throw new Error(`Unpexpected numItems value: ${h}.`);this.numItems=+h,this.nodeSize=Math.min(Math.max(+g,2),65535),this.ArrayType=x,this.IndexArrayType=h<65536?Uint16Array:Uint32Array;const k=Jv.indexOf(this.ArrayType),L=2*h*this.ArrayType.BYTES_PER_ELEMENT,z=h*this.IndexArrayType.BYTES_PER_ELEMENT,V=(8-z%8)%8;if(k<0)throw new Error(`Unexpected typed array class: ${x}.`);A&&A instanceof ArrayBuffer?(this.data=A,this.ids=new this.IndexArrayType(this.data,8,h),this.coords=new this.ArrayType(this.data,8+z+V,2*h),this._pos=2*h,this._finished=!0):(this.data=new ArrayBuffer(8+L+z+V),this.ids=new this.IndexArrayType(this.data,8,h),this.coords=new this.ArrayType(this.data,8+z+V,2*h),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+k]),new Uint16Array(this.data,2,1)[0]=g,new Uint32Array(this.data,4,1)[0]=h)}add(h,g){const x=this._pos>>1;return this.ids[x]=x,this.coords[this._pos++]=h,this.coords[this._pos++]=g,x}finish(){const h=this._pos>>1;if(h!==this.numItems)throw new Error(`Added ${h} items when expected ${this.numItems}.`);return _x(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(h,g,x,A){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:k,coords:L,nodeSize:z}=this,V=[0,k.length-1,0],X=[];for(;V.length;){const Z=V.pop()||0,J=V.pop()||0,oe=V.pop()||0;if(J-oe<=z){for(let be=oe;be<=J;be++){const Ee=L[2*be],qe=L[2*be+1];Ee>=h&&Ee<=x&&qe>=g&&qe<=A&&X.push(k[be])}continue}const le=oe+J>>1,ce=L[2*le],ge=L[2*le+1];ce>=h&&ce<=x&&ge>=g&&ge<=A&&X.push(k[le]),(Z===0?h<=ce:g<=ge)&&(V.push(oe),V.push(le-1),V.push(1-Z)),(Z===0?x>=ce:A>=ge)&&(V.push(le+1),V.push(J),V.push(1-Z))}return X}within(h,g,x){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:A,coords:k,nodeSize:L}=this,z=[0,A.length-1,0],V=[],X=x*x;for(;z.length;){const Z=z.pop()||0,J=z.pop()||0,oe=z.pop()||0;if(J-oe<=L){for(let be=oe;be<=J;be++)ZS(k[2*be],k[2*be+1],h,g)<=X&&V.push(A[be]);continue}const le=oe+J>>1,ce=k[2*le],ge=k[2*le+1];ZS(ce,ge,h,g)<=X&&V.push(A[le]),(Z===0?h-x<=ce:g-x<=ge)&&(z.push(oe),z.push(le-1),z.push(1-Z)),(Z===0?h+x>=ce:g+x>=ge)&&(z.push(le+1),z.push(J),z.push(1-Z))}return V}}function _x(v,h,g,x,A,k){if(A-x<=g)return;const L=x+A>>1;XS(v,h,L,x,A,k),_x(v,h,g,x,L-1,1-k),_x(v,h,g,L+1,A,1-k)}function XS(v,h,g,x,A,k){for(;A>x;){if(A-x>600){const X=A-x+1,Z=g-x+1,J=Math.log(X),oe=.5*Math.exp(2*J/3),le=.5*Math.sqrt(J*oe*(X-oe)/X)*(Z-X/2<0?-1:1);XS(v,h,g,Math.max(x,Math.floor(g-Z*oe/X+le)),Math.min(A,Math.floor(g+(X-Z)*oe/X+le)),k)}const L=h[2*g+k];let z=x,V=A;for(tc(v,h,x,g),h[2*A+k]>L&&tc(v,h,x,A);z<V;){for(tc(v,h,z,V),z++,V--;h[2*z+k]<L;)z++;for(;h[2*V+k]>L;)V--}h[2*x+k]===L?tc(v,h,x,V):(V++,tc(v,h,V,A)),V<=g&&(x=V+1),g<=V&&(A=V-1)}}function tc(v,h,g,x){P_(v,g,x),P_(h,2*g,2*x),P_(h,2*g+1,2*x+1)}function P_(v,h,g){const x=v[h];v[h]=v[g],v[g]=x}function ZS(v,h,g,x){const A=v-g,k=h-x;return A*A+k*k}var bx;s.cx=void 0,(bx=s.cx||(s.cx={})).create="create",bx.load="load",bx.fullLoad="fullLoad";let R_=null,em=[];const xx=1e3/60,Sx="loadTime",Tx="fullLoadTime",qS={mark(v){performance.mark(v)},frame(v){const h=v;R_!=null&&em.push(h-R_),R_=h},clearMetrics(){R_=null,em=[],performance.clearMeasures(Sx),performance.clearMeasures(Tx);for(const v in s.cx)performance.clearMarks(s.cx[v])},getPerformanceMetrics(){performance.measure(Sx,s.cx.create,s.cx.load),performance.measure(Tx,s.cx.create,s.cx.fullLoad);const v=performance.getEntriesByName(Sx)[0].duration,h=performance.getEntriesByName(Tx)[0].duration,g=em.length,x=1/(em.reduce(((k,L)=>k+L),0)/g/1e3),A=em.filter((k=>k>xx)).reduce(((k,L)=>k+(L-xx)/xx),0);return{loadTime:v,fullLoadTime:h,fps:x,percentDroppedFrames:A/(g+A)*100,totalFrames:g}}};s.$=je,s.A=B,s.B=function([v,h,g]){return h+=90,h*=Math.PI/180,g*=Math.PI/180,{x:v*Math.cos(h)*Math.sin(g),y:v*Math.sin(h)*Math.sin(g),z:v*Math.cos(g)}},s.C=as,s.D=tr,s.E=pr,s.F=Ni,s.G=Op,s.H=In,s.I=Qb,s.J=class{constructor(v,h){this.target=v,this.mapId=h,this.resolveRejects={},this.tasks={},this.taskQueue=[],this.abortControllers={},this.messageHandlers={},this.invoker=new BS((()=>this.process())),this.subscription=ea(this.target,"message",(g=>this.receive(g)),!1),this.globalScope=ii(self)?v:window}registerMessageHandler(v,h){this.messageHandlers[v]=h}sendAsync(v,h){return new Promise(((g,x)=>{const A=Math.round(1e18*Math.random()).toString(36).substring(0,10),k=h?ea(h.signal,"abort",(()=>{k?.unsubscribe(),delete this.resolveRejects[A];const V={id:A,type:"<cancel>",origin:location.origin,targetMapId:v.targetMapId,sourceMapId:this.mapId};this.target.postMessage(V)}),bi):null;this.resolveRejects[A]={resolve:V=>{k?.unsubscribe(),g(V)},reject:V=>{k?.unsubscribe(),x(V)}};const L=[],z=Object.assign(Object.assign({},v),{id:A,sourceMapId:this.mapId,origin:location.origin,data:Vu(v.data,L)});this.target.postMessage(z,{transfer:L})}))}receive(v){const h=v.data,g=h.id;if(!(h.origin!=="file://"&&location.origin!=="file://"&&h.origin!=="resource://android"&&location.origin!=="resource://android"&&h.origin!==location.origin||h.targetMapId&&this.mapId!==h.targetMapId)){if(h.type==="<cancel>"){delete this.tasks[g];const x=this.abortControllers[g];return delete this.abortControllers[g],void(x&&x.abort())}if(ii(self)||h.mustQueue)return this.tasks[g]=h,this.taskQueue.push(g),void this.invoker.trigger();this.processTask(g,h)}}process(){if(this.taskQueue.length===0)return;const v=this.taskQueue.shift(),h=this.tasks[v];delete this.tasks[v],this.taskQueue.length>0&&this.invoker.trigger(),h&&this.processTask(v,h)}processTask(v,h){return o(this,void 0,void 0,(function*(){if(h.type==="<response>"){const A=this.resolveRejects[v];return delete this.resolveRejects[v],A?void(h.error?A.reject(Uu(h.error)):A.resolve(Uu(h.data))):void 0}if(!this.messageHandlers[h.type])return void this.completeTask(v,new Error(`Could not find a registered handler for ${h.type}, map ID: ${this.mapId}, available handlers: ${Object.keys(this.messageHandlers).join(", ")}`));const g=Uu(h.data),x=new AbortController;this.abortControllers[v]=x;try{const A=yield this.messageHandlers[h.type](h.sourceMapId,g,x);this.completeTask(v,null,A)}catch(A){this.completeTask(v,A)}}))}completeTask(v,h,g){const x=[];delete this.abortControllers[v];const A={id:v,type:"<response>",sourceMapId:this.mapId,origin:location.origin,error:h?Vu(h):null,data:Vu(g,x)};this.target.postMessage(A,{transfer:x})}remove(){this.invoker.remove(),this.subscription.unsubscribe()}},s.K=Ne,s.L=function(){var v=new B(16);return B!=Float32Array&&(v[1]=0,v[2]=0,v[3]=0,v[4]=0,v[6]=0,v[7]=0,v[8]=0,v[9]=0,v[11]=0,v[12]=0,v[13]=0,v[14]=0),v[0]=1,v[5]=1,v[10]=1,v[15]=1,v},s.M=function(v,h,g){var x,A,k,L,z,V,X,Z,J,oe,le,ce,ge=g[0],be=g[1],Ee=g[2];return h===v?(v[12]=h[0]*ge+h[4]*be+h[8]*Ee+h[12],v[13]=h[1]*ge+h[5]*be+h[9]*Ee+h[13],v[14]=h[2]*ge+h[6]*be+h[10]*Ee+h[14],v[15]=h[3]*ge+h[7]*be+h[11]*Ee+h[15]):(A=h[1],k=h[2],L=h[3],z=h[4],V=h[5],X=h[6],Z=h[7],J=h[8],oe=h[9],le=h[10],ce=h[11],v[0]=x=h[0],v[1]=A,v[2]=k,v[3]=L,v[4]=z,v[5]=V,v[6]=X,v[7]=Z,v[8]=J,v[9]=oe,v[10]=le,v[11]=ce,v[12]=x*ge+z*be+J*Ee+h[12],v[13]=A*ge+V*be+oe*Ee+h[13],v[14]=k*ge+X*be+le*Ee+h[14],v[15]=L*ge+Z*be+ce*Ee+h[15]),v},s.N=function(v,h,g){var x=g[0],A=g[1],k=g[2];return v[0]=h[0]*x,v[1]=h[1]*x,v[2]=h[2]*x,v[3]=h[3]*x,v[4]=h[4]*A,v[5]=h[5]*A,v[6]=h[6]*A,v[7]=h[7]*A,v[8]=h[8]*k,v[9]=h[9]*k,v[10]=h[10]*k,v[11]=h[11]*k,v[12]=h[12],v[13]=h[13],v[14]=h[14],v[15]=h[15],v},s.O=function(v,h,g){var x=h[0],A=h[1],k=h[2],L=h[3],z=h[4],V=h[5],X=h[6],Z=h[7],J=h[8],oe=h[9],le=h[10],ce=h[11],ge=h[12],be=h[13],Ee=h[14],qe=h[15],Oe=g[0],Ve=g[1],ot=g[2],gt=g[3];return v[0]=Oe*x+Ve*z+ot*J+gt*ge,v[1]=Oe*A+Ve*V+ot*oe+gt*be,v[2]=Oe*k+Ve*X+ot*le+gt*Ee,v[3]=Oe*L+Ve*Z+ot*ce+gt*qe,v[4]=(Oe=g[4])*x+(Ve=g[5])*z+(ot=g[6])*J+(gt=g[7])*ge,v[5]=Oe*A+Ve*V+ot*oe+gt*be,v[6]=Oe*k+Ve*X+ot*le+gt*Ee,v[7]=Oe*L+Ve*Z+ot*ce+gt*qe,v[8]=(Oe=g[8])*x+(Ve=g[9])*z+(ot=g[10])*J+(gt=g[11])*ge,v[9]=Oe*A+Ve*V+ot*oe+gt*be,v[10]=Oe*k+Ve*X+ot*le+gt*Ee,v[11]=Oe*L+Ve*Z+ot*ce+gt*qe,v[12]=(Oe=g[12])*x+(Ve=g[13])*z+(ot=g[14])*J+(gt=g[15])*ge,v[13]=Oe*A+Ve*V+ot*oe+gt*be,v[14]=Oe*k+Ve*X+ot*le+gt*Ee,v[15]=Oe*L+Ve*Z+ot*ce+gt*qe,v},s.P=l,s.Q=function(v,h){const g={};for(let x=0;x<h.length;x++){const A=h[x];A in v&&(g[A]=v[A])}return g},s.R=io,s.S=su,s.T=Hp,s.U=tg,s.V=b_,s.W=E,s.X=P,s.Y=Na,s.Z=hi,s._=o,s.a=fe,s.a$=ve,s.a0=function(v,h){var g,x,A,k,L;if(!v)return h??{};if(!h)return v;let z=Object.assign({},v);if(h.removeAll&&(z={removeAll:!0}),h.remove){const V=new Set(h.remove);z.add&&(z.add=z.add.filter((Z=>!V.has(Z.id)))),z.update&&(z.update=z.update.filter((Z=>!V.has(Z.id))));const X=new Set(((g=v.add)!==null&&g!==void 0?g:[]).map((Z=>Z.id)));h.remove=h.remove.filter((Z=>!X.has(Z)))}if(h.remove){const V=new Set(z.remove?z.remove.concat(h.remove):h.remove);z.remove=Array.from(V.values())}if(h.add){const V=z.add?z.add.concat(h.add):h.add,X=new Map(V.map((Z=>[Z.id,Z])));z.add=Array.from(X.values())}if(h.update){const V=new Map((x=z.update)===null||x===void 0?void 0:x.map((X=>[X.id,X])));for(const X of h.update){const Z=(A=V.get(X.id))!==null&&A!==void 0?A:{id:X.id};X.newGeometry&&(Z.newGeometry=X.newGeometry),X.addOrUpdateProperties&&(Z.addOrUpdateProperties=((k=Z.addOrUpdateProperties)!==null&&k!==void 0?k:[]).concat(X.addOrUpdateProperties)),X.removeProperties&&(Z.removeProperties=((L=Z.removeProperties)!==null&&L!==void 0?L:[]).concat(X.removeProperties)),X.removeAllProperties&&(Z.removeAllProperties=!0),V.set(X.id,Z)}z.update=Array.from(V.values())}return z.remove&&z.add&&(z.remove=z.remove.filter((V=>z.add.findIndex((X=>X.id===V))===-1))),z},s.a1=Kv,s.a2=Vd,s.a3=25,s.a4=x_,s.a5=v=>{const h=window.document.createElement("video");return h.muted=!0,new Promise((g=>{h.onloadstart=()=>{g(h)};for(const x of v){const A=window.document.createElement("source");Ke(x)||(h.crossOrigin="Anonymous"),A.src=x,h.appendChild(A)}}))},s.a6=It,s.a7=function(){return zt++},s.a8=ie,s.a9=pf,s.aA=function(v){let h=1/0,g=1/0,x=-1/0,A=-1/0;for(const k of v)h=Math.min(h,k.x),g=Math.min(g,k.y),x=Math.max(x,k.x),A=Math.max(A,k.y);return[h,g,x,A]},s.aB=On,s.aC=ct,s.aD=function(v,h,g,x,A=!1){if(!g[0]&&!g[1])return[0,0];const k=A?x==="map"?-v.bearingInRadians:0:x==="viewport"?v.bearingInRadians:0;if(k){const L=Math.sin(k),z=Math.cos(k);g=[g[0]*z-g[1]*L,g[0]*L+g[1]*z]}return[A?g[0]:ct(h,g[0],v.zoom),A?g[1]:ct(h,g[1],v.zoom)]},s.aF=Fd,s.aG=I_,s.aH=Wv,s.aI=uu,s.aJ=Bi,s.aK=Rd,s.aL=He,s.aM=Jr,s.aN=Mi,s.aO=_r,s.aP=Do,s.aQ=hx,s.aR=te,s.aS=ee,s.aT=function(v){var h=new B(3);return h[0]=v[0],h[1]=v[1],h[2]=v[2],h},s.aU=function(v,h,g){return v[0]=h[0]-g[0],v[1]=h[1]-g[1],v[2]=h[2]-g[2],v},s.aV=function(v,h){var g=h[0],x=h[1],A=h[2],k=g*g+x*x+A*A;return k>0&&(k=1/Math.sqrt(k)),v[0]=h[0]*k,v[1]=h[1]*k,v[2]=h[2]*k,v},s.aW=ae,s.aX=function(v,h){return v[0]*h[0]+v[1]*h[1]+v[2]*h[2]},s.aY=function(v,h,g){return v[0]=h[0]*g[0],v[1]=h[1]*g[1],v[2]=h[2]*g[2],v[3]=h[3]*g[3],v},s.aZ=q,s.a_=function(v,h,g){const x=h[0]*g[0]+h[1]*g[1]+h[2]*g[2];return x===0?null:(-(v[0]*g[0]+v[1]*g[1]+v[2]*g[2])-g[3])/x},s.aa=bo,s.ab=qs,s.ac=FS,s.ad=function(v){const h={};if(v.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,((g,x,A,k)=>{const L=A||k;return h[x]=!L||L.toLowerCase(),""})),h["max-age"]){const g=parseInt(h["max-age"],10);isNaN(g)?delete h["max-age"]:h["max-age"]=g}return h},s.ae=Zf,s.af=function(v){return Math.pow(2,v)},s.ag=W,s.ah=qt,s.ai=85.051129,s.aj=Yv,s.ak=function(v){return Math.log(v)/Math.LN2},s.al=function(v){var h=v[0],g=v[1];return h*h+g*g},s.am=function(v){if(!v.length)return new Set;const h=Math.max(...v.map((V=>V.canonical.z)));let g=1/0,x=-1/0,A=1/0,k=-1/0;const L=[];for(const V of v){const{x:X,y:Z,z:J}=V.canonical,oe=Math.pow(2,h-J),le=X*oe,ce=Z*oe;L.push({id:V,x:le,y:ce}),le<g&&(g=le),le>x&&(x=le),ce<A&&(A=ce),ce>k&&(k=ce)}const z=new Set;for(const V of L)V.x!==g&&V.x!==x&&V.y!==A&&V.y!==k||z.add(V.id);return z},s.an=function(v,h){let g=0,x=0;if(v.kind==="constant")x=v.layoutSize;else if(v.kind!=="source"){const{interpolationType:A,minZoom:k,maxZoom:L}=v,z=A?qt(na.interpolationFactor(A,h,k,L),0,1):0;v.kind==="camera"?x=as.number(v.minSize,v.maxSize,z):g=z}return{uSizeT:g,uSize:x}},s.ap=function(v,{uSize:h,uSizeT:g},{lowerSize:x,upperSize:A}){return v.kind==="source"?x/au:v.kind==="composite"?as.number(x/au,A/au,g):h},s.aq=function(v,h){var g=h[0],x=h[1],A=h[2],k=h[3],L=h[4],z=h[5],V=h[6],X=h[7],Z=h[8],J=h[9],oe=h[10],le=h[11],ce=h[12],ge=h[13],be=h[14],Ee=h[15],qe=g*z-x*L,Oe=g*V-A*L,Ve=g*X-k*L,ot=x*V-A*z,gt=x*X-k*z,Et=A*X-k*V,Wt=Z*ge-J*ce,Ft=Z*be-oe*ce,Ht=Z*Ee-le*ce,ur=J*be-oe*ge,Ut=J*Ee-le*ge,jt=oe*Ee-le*be,Tt=qe*jt-Oe*Ut+Ve*ur+ot*Ht-gt*Ft+Et*Wt;return Tt?(v[0]=(z*jt-V*Ut+X*ur)*(Tt=1/Tt),v[1]=(A*Ut-x*jt-k*ur)*Tt,v[2]=(ge*Et-be*gt+Ee*ot)*Tt,v[3]=(oe*gt-J*Et-le*ot)*Tt,v[4]=(V*Ht-L*jt-X*Ft)*Tt,v[5]=(g*jt-A*Ht+k*Ft)*Tt,v[6]=(be*Ve-ce*Et-Ee*Oe)*Tt,v[7]=(Z*Et-oe*Ve+le*Oe)*Tt,v[8]=(L*Ut-z*Ht+X*Wt)*Tt,v[9]=(x*Ht-g*Ut-k*Wt)*Tt,v[10]=(ce*gt-ge*Ve+Ee*qe)*Tt,v[11]=(J*Ve-Z*gt-le*qe)*Tt,v[12]=(z*Ft-L*ur-V*Wt)*Tt,v[13]=(g*ur-x*Ft+A*Wt)*Tt,v[14]=(ge*Oe-ce*ot-be*qe)*Tt,v[15]=(Z*ot-J*Oe+oe*qe)*Tt,v):null},s.ar=De,s.as=function(v){var h=v[0],g=v[1];return Math.sqrt(h*h+g*g)},s.at=function(v){return v[0]=0,v[1]=0,v},s.au=function(v,h,g){return v[0]=h[0]*g,v[1]=h[1]*g,v},s.av=v_,s.aw=ye,s.ax=function(v,h,g,x){const A=h.y-v.y,k=h.x-v.x,L=x.y-g.y,z=x.x-g.x,V=L*k-z*A;if(V===0)return null;const X=(z*(v.y-g.y)-L*(v.x-g.x))/V;return new l(v.x+X*k,v.y+X*A)},s.ay=px,s.az=Mv,s.b=Li,s.b$=class extends So{constructor(v,h){super(v,h),this.current=new Array}set(v){if(v!=this.current){this.current=v;const h=new Float32Array(v);this.gl.uniform1fv(this.location,h)}}},s.b0=function(v,h,g){return v[0]=h[0]*g,v[1]=h[1]*g,v[2]=h[2]*g,v[3]=h[3]*g,v},s.b1=function(v,h){return v[0]*h[0]+v[1]*h[1]+v[2]*h[2]+v[3]},s.b2=fx,s.b3=gf,s.b4=function(v,h,g,x,A){var k=1/Math.tan(h/2);if(v[0]=k/g,v[1]=0,v[2]=0,v[3]=0,v[4]=0,v[5]=k,v[6]=0,v[7]=0,v[8]=0,v[9]=0,v[11]=-1,v[12]=0,v[13]=0,v[15]=0,A!=null&&A!==1/0){var L=1/(x-A);v[10]=(A+x)*L,v[14]=2*A*x*L}else v[10]=-1,v[14]=-2*x;return v},s.b5=function(v){var h=new B(16);return h[0]=v[0],h[1]=v[1],h[2]=v[2],h[3]=v[3],h[4]=v[4],h[5]=v[5],h[6]=v[6],h[7]=v[7],h[8]=v[8],h[9]=v[9],h[10]=v[10],h[11]=v[11],h[12]=v[12],h[13]=v[13],h[14]=v[14],h[15]=v[15],h},s.b6=function(v,h,g){var x=Math.sin(g),A=Math.cos(g),k=h[0],L=h[1],z=h[2],V=h[3],X=h[4],Z=h[5],J=h[6],oe=h[7];return h!==v&&(v[8]=h[8],v[9]=h[9],v[10]=h[10],v[11]=h[11],v[12]=h[12],v[13]=h[13],v[14]=h[14],v[15]=h[15]),v[0]=k*A+X*x,v[1]=L*A+Z*x,v[2]=z*A+J*x,v[3]=V*A+oe*x,v[4]=X*A-k*x,v[5]=Z*A-L*x,v[6]=J*A-z*x,v[7]=oe*A-V*x,v},s.b7=function(v,h,g){var x=Math.sin(g),A=Math.cos(g),k=h[4],L=h[5],z=h[6],V=h[7],X=h[8],Z=h[9],J=h[10],oe=h[11];return h!==v&&(v[0]=h[0],v[1]=h[1],v[2]=h[2],v[3]=h[3],v[12]=h[12],v[13]=h[13],v[14]=h[14],v[15]=h[15]),v[4]=k*A+X*x,v[5]=L*A+Z*x,v[6]=z*A+J*x,v[7]=V*A+oe*x,v[8]=X*A-k*x,v[9]=Z*A-L*x,v[10]=J*A-z*x,v[11]=oe*A-V*x,v},s.b8=function(){const v=new Float32Array(16);return W(v),v},s.b9=function(){const v=new Float64Array(16);return W(v),v},s.bA=function(v,h){const g=xe(v,360),x=xe(h,360),A=x-g,k=x>g?A-360:A+360;return Math.abs(A)<Math.abs(k)?A:k},s.bB=function(v){return v[0]=0,v[1]=0,v[2]=0,v},s.bC=function(v,h,g,x){const A=Math.sqrt(v*v+h*h),k=Math.sqrt(g*g+x*x);v/=A,h/=A,g/=k,x/=k;const L=Math.acos(v*g+h*x);return-h*g+v*x>0?L:-L},s.bD=function(v,h){const g=xe(v,2*Math.PI),x=xe(h,2*Math.PI);return Math.min(Math.abs(g-x),Math.abs(g-x+2*Math.PI),Math.abs(g-x-2*Math.PI))},s.bE=function(){const v={},h=Qe.$version;for(const g in Qe.$root){const x=Qe.$root[g];if(x.required){let A=null;A=g==="version"?h:x.type==="array"?[]:{},A!=null&&(v[g]=A)}}return v},s.bF=Yc,s.bG=We,s.bH=function v(h,g){if(Array.isArray(h)){if(!Array.isArray(g)||h.length!==g.length)return!1;for(let x=0;x<h.length;x++)if(!v(h[x],g[x]))return!1;return!0}if(typeof h=="object"&&h!==null&&g!==null){if(typeof g!="object"||Object.keys(h).length!==Object.keys(g).length)return!1;for(const x in h)if(!v(h[x],g[x]))return!1;return!0}return h===g},s.bI=function(v){v=v.slice();const h=Object.create(null);for(let g=0;g<v.length;g++)h[v[g].id]=v[g];for(let g=0;g<v.length;g++)"ref"in v[g]&&(v[g]=pi(v[g],h[v[g].ref]));return v},s.bJ=function(v,h){if(v.type==="custom")return new AM(v,h);switch(v.type){case"background":return new Zv(v,h);case"circle":return new kb(v,h);case"color-relief":return new pM(v,h);case"fill":return new Xp(v,h);case"fill-extrusion":return new qp(v,h);case"heatmap":return new Ob(v,h);case"hillshade":return new nh(v,h);case"line":return new c_(v,h);case"raster":return new Gu(v,h);case"symbol":return new eg(v,h)}},s.bK=v=>v.type==="raster",s.bL=Jt,s.bM=function(v,h){if(!v)return[{command:"setStyle",args:[h]}];let g=[];try{if(!or(v.version,h.version))return[{command:"setStyle",args:[h]}];or(v.center,h.center)||g.push({command:"setCenter",args:[h.center]}),or(v.state,h.state)||g.push({command:"setGlobalState",args:[h.state]}),or(v.centerAltitude,h.centerAltitude)||g.push({command:"setCenterAltitude",args:[h.centerAltitude]}),or(v.zoom,h.zoom)||g.push({command:"setZoom",args:[h.zoom]}),or(v.bearing,h.bearing)||g.push({command:"setBearing",args:[h.bearing]}),or(v.pitch,h.pitch)||g.push({command:"setPitch",args:[h.pitch]}),or(v.roll,h.roll)||g.push({command:"setRoll",args:[h.roll]}),or(v.sprite,h.sprite)||g.push({command:"setSprite",args:[h.sprite]}),or(v.glyphs,h.glyphs)||g.push({command:"setGlyphs",args:[h.glyphs]}),or(v.transition,h.transition)||g.push({command:"setTransition",args:[h.transition]}),or(v.light,h.light)||g.push({command:"setLight",args:[h.light]}),or(v.terrain,h.terrain)||g.push({command:"setTerrain",args:[h.terrain]}),or(v.sky,h.sky)||g.push({command:"setSky",args:[h.sky]}),or(v.projection,h.projection)||g.push({command:"setProjection",args:[h.projection]});const x={},A=[];(function(L,z,V,X){let Z;for(Z in z=z||{},L=L||{})Object.prototype.hasOwnProperty.call(L,Z)&&(Object.prototype.hasOwnProperty.call(z,Z)||Mn(Z,V,X));for(Z in z)Object.prototype.hasOwnProperty.call(z,Z)&&(Object.prototype.hasOwnProperty.call(L,Z)?or(L[Z],z[Z])||(L[Z].type==="geojson"&&z[Z].type==="geojson"&&fa(L,z,Z)?ui(V,{command:"setGeoJSONSourceData",args:[Z,z[Z].data]}):jn(Z,z,V,X)):zn(Z,z,V))})(v.sources,h.sources,A,x);const k=[];v.layers&&v.layers.forEach((L=>{"source"in L&&x[L.source]?g.push({command:"removeLayer",args:[L.id]}):k.push(L)})),g=g.concat(A),(function(L,z,V){z=z||[];const X=(L=L||[]).map($n),Z=z.map($n),J=L.reduce(Ti,{}),oe=z.reduce(Ti,{}),le=X.slice(),ce=Object.create(null);let ge,be,Ee,qe,Oe;for(let Ve=0,ot=0;Ve<X.length;Ve++)ge=X[Ve],Object.prototype.hasOwnProperty.call(oe,ge)?ot++:(ui(V,{command:"removeLayer",args:[ge]}),le.splice(le.indexOf(ge,ot),1));for(let Ve=0,ot=0;Ve<Z.length;Ve++)ge=Z[Z.length-1-Ve],le[le.length-1-Ve]!==ge&&(Object.prototype.hasOwnProperty.call(J,ge)?(ui(V,{command:"removeLayer",args:[ge]}),le.splice(le.lastIndexOf(ge,le.length-ot),1)):ot++,qe=le[le.length-Ve],ui(V,{command:"addLayer",args:[oe[ge],qe]}),le.splice(le.length-Ve,0,ge),ce[ge]=!0);for(let Ve=0;Ve<Z.length;Ve++)if(ge=Z[Ve],be=J[ge],Ee=oe[ge],!ce[ge]&&!or(be,Ee))if(or(be.source,Ee.source)&&or(be["source-layer"],Ee["source-layer"])&&or(be.type,Ee.type)){for(Oe in Vi(be.layout,Ee.layout,V,ge,null,"setLayoutProperty"),Vi(be.paint,Ee.paint,V,ge,null,"setPaintProperty"),or(be.filter,Ee.filter)||ui(V,{command:"setFilter",args:[ge,Ee.filter]}),or(be.minzoom,Ee.minzoom)&&or(be.maxzoom,Ee.maxzoom)||ui(V,{command:"setLayerZoomRange",args:[ge,Ee.minzoom,Ee.maxzoom]}),be)Object.prototype.hasOwnProperty.call(be,Oe)&&Oe!=="layout"&&Oe!=="paint"&&Oe!=="filter"&&Oe!=="metadata"&&Oe!=="minzoom"&&Oe!=="maxzoom"&&(Oe.indexOf("paint.")===0?Vi(be[Oe],Ee[Oe],V,ge,Oe.slice(6),"setPaintProperty"):or(be[Oe],Ee[Oe])||ui(V,{command:"setLayerProperty",args:[ge,Oe,Ee[Oe]]}));for(Oe in Ee)Object.prototype.hasOwnProperty.call(Ee,Oe)&&!Object.prototype.hasOwnProperty.call(be,Oe)&&Oe!=="layout"&&Oe!=="paint"&&Oe!=="filter"&&Oe!=="metadata"&&Oe!=="minzoom"&&Oe!=="maxzoom"&&(Oe.indexOf("paint.")===0?Vi(be[Oe],Ee[Oe],V,ge,Oe.slice(6),"setPaintProperty"):or(be[Oe],Ee[Oe])||ui(V,{command:"setLayerProperty",args:[ge,Oe,Ee[Oe]]}))}else ui(V,{command:"removeLayer",args:[ge]}),qe=le[le.lastIndexOf(ge)+1],ui(V,{command:"addLayer",args:[Ee,qe]})})(k,h.layers,g)}catch(x){console.warn("Unable to compute style diff:",x),g=[{command:"setStyle",args:[h]}]}return g},s.bN=function(v){const h=[],g=v.id;return g===void 0&&h.push({message:`layers.${g}: missing required property "id"`}),v.render===void 0&&h.push({message:`layers.${g}: missing required method "render"`}),v.renderingMode&&v.renderingMode!=="2d"&&v.renderingMode!=="3d"&&h.push({message:`layers.${g}: property "renderingMode" must be either "2d" or "3d"`}),h},s.bO=yr,s.bP=Gt,s.bQ=class extends So{constructor(v,h){super(v,h),this.current=0}set(v){this.current!==v&&(this.current=v,this.gl.uniform1i(this.location,v))}},s.bR=To,s.bS=class extends So{constructor(v,h){super(v,h),this.current=xa}set(v){if(v[12]!==this.current[12]||v[0]!==this.current[0])return this.current=v,void this.gl.uniformMatrix4fv(this.location,!1,v);for(let h=1;h<16;h++)if(v[h]!==this.current[h]){this.current=v,this.gl.uniformMatrix4fv(this.location,!1,v);break}}},s.bT=Xn,s.bU=class extends So{constructor(v,h){super(v,h),this.current=[0,0,0]}set(v){v[0]===this.current[0]&&v[1]===this.current[1]&&v[2]===this.current[2]||(this.current=v,this.gl.uniform3f(this.location,v[0],v[1],v[2]))}},s.bV=class extends So{constructor(v,h){super(v,h),this.current=[0,0]}set(v){v[0]===this.current[0]&&v[1]===this.current[1]||(this.current=v,this.gl.uniform2f(this.location,v[0],v[1]))}},s.bW=F,s.bX=function(v,h){var g=Math.sin(h),x=Math.cos(h);return v[0]=x,v[1]=g,v[2]=0,v[3]=-g,v[4]=x,v[5]=0,v[6]=0,v[7]=0,v[8]=1,v},s.bY=function(v,h,g){var x=h[0],A=h[1],k=h[2];return v[0]=x*g[0]+A*g[3]+k*g[6],v[1]=x*g[1]+A*g[4]+k*g[7],v[2]=x*g[2]+A*g[5]+k*g[8],v},s.bZ=function(v,h,g,x,A,k,L){var z=1/(h-g),V=1/(x-A),X=1/(k-L);return v[0]=-2*z,v[1]=0,v[2]=0,v[3]=0,v[4]=0,v[5]=-2*V,v[6]=0,v[7]=0,v[8]=0,v[9]=0,v[10]=2*X,v[11]=0,v[12]=(h+g)*z,v[13]=(A+x)*V,v[14]=(L+k)*X,v[15]=1,v},s.b_=class extends So{constructor(v,h){super(v,h),this.current=new Array}set(v){if(v!=this.current){this.current=v;const h=new Float32Array(4*v.length);for(let g=0;g<v.length;g++)h[4*g]=v[g].r,h[4*g+1]=v[g].g,h[4*g+2]=v[g].b,h[4*g+3]=v[g].a;this.gl.uniform4fv(this.location,h)}}},s.ba=function(){return new Float64Array(16)},s.bb=function(v,h,g){const x=new Float64Array(4);return me(x,v,h-90,g),x},s.bc=function(v,h,g,x){var A,k,L,z,V,X=h[0],Z=h[1],J=h[2],oe=h[3],le=g[0],ce=g[1],ge=g[2],be=g[3];return(k=X*le+Z*ce+J*ge+oe*be)<0&&(k=-k,le=-le,ce=-ce,ge=-ge,be=-be),1-k>O?(A=Math.acos(k),L=Math.sin(A),z=Math.sin((1-x)*A)/L,V=Math.sin(x*A)/L):(z=1-x,V=x),v[0]=z*X+V*le,v[1]=z*Z+V*ce,v[2]=z*J+V*ge,v[3]=z*oe+V*be,v},s.bd=function(v){const h=new Float64Array(9);var g,x,A,k,L,z,V,X,Z,J,oe,le,ce,ge,be,Ee,qe,Oe;J=(A=(x=v)[0])*(V=A+A),oe=(k=x[1])*V,ce=(L=x[2])*V,ge=L*(X=k+k),Ee=(z=x[3])*V,qe=z*X,Oe=z*(Z=L+L),(g=h)[0]=1-(le=k*X)-(be=L*Z),g[3]=oe-Oe,g[6]=ce+qe,g[1]=oe+Oe,g[4]=1-J-be,g[7]=ge-Ee,g[2]=ce-qe,g[5]=ge+Ee,g[8]=1-J-le;const Ve=Do(-Math.asin(qt(h[2],-1,1)));let ot,gt;return Math.hypot(h[5],h[8])<.001?(ot=0,gt=-Do(Math.atan2(h[3],h[4]))):(ot=Do(h[5]===0&&h[8]===0?0:Math.atan2(h[5],h[8])),gt=Do(h[1]===0&&h[0]===0?0:Math.atan2(h[1],h[0]))),{roll:ot,pitch:Ve+90,bearing:gt}},s.be=function(v,h){return v.roll==h.roll&&v.pitch==h.pitch&&v.bearing==h.bearing},s.bf=Zr,s.bg=_n,s.bh=Ia,s.bi=Xo,s.bj=Gp,s.bk=$e,s.bl=pt,s.bm=pa,s.bn=function(v,h,g,x,A){return $e(x,A,qt((v-h)/(g-h),0,1))},s.bo=xe,s.bp=function(){return new Float64Array(3)},s.bq=function(v,h,g,x){return v[0]=h[0]+g[0]*x,v[1]=h[1]+g[1]*x,v[2]=h[2]+g[2]*x,v},s.br=me,s.bs=function(v,h,g){var x=g[0],A=g[1],k=g[2],L=g[3],z=h[0],V=h[1],X=h[2],Z=A*X-k*V,J=k*z-x*X,oe=x*V-A*z;return v[0]=z+L*(Z+=Z)+A*(oe+=oe)-k*(J+=J),v[1]=V+L*J+k*Z-x*oe,v[2]=X+L*oe+x*J-A*Z,v},s.bt=function(v,h,g){const x=(A=[v[0],v[1],v[2],h[0],h[1],h[2],g[0],g[1],g[2]])[0]*((Z=A[8])*(L=A[4])-(z=A[5])*(X=A[7]))+A[1]*(-Z*(k=A[3])+z*(V=A[6]))+A[2]*(X*k-L*V);var A,k,L,z,V,X,Z;if(x===0)return null;const J=ae([],[h[0],h[1],h[2]],[g[0],g[1],g[2]]),oe=ae([],[g[0],g[1],g[2]],[v[0],v[1],v[2]]),le=ae([],[v[0],v[1],v[2]],[h[0],h[1],h[2]]),ce=te([],J,-v[3]);return ee(ce,ce,te([],oe,-h[3])),ee(ce,ce,te([],le,-g[3])),te(ce,ce,1/x),ce},s.bu=qv,s.bv=function(){return new Float64Array(4)},s.bw=function(v,h,g,x){var A=[],k=[];return A[0]=h[0]-g[0],A[1]=h[1]-g[1],A[2]=h[2]-g[2],k[0]=A[0]*Math.cos(x)-A[1]*Math.sin(x),k[1]=A[0]*Math.sin(x)+A[1]*Math.cos(x),k[2]=A[2],v[0]=k[0]+g[0],v[1]=k[1]+g[1],v[2]=k[2]+g[2],v},s.bx=function(v,h,g,x){var A=[],k=[];return A[0]=h[0]-g[0],A[1]=h[1]-g[1],A[2]=h[2]-g[2],k[0]=A[0],k[1]=A[1]*Math.cos(x)-A[2]*Math.sin(x),k[2]=A[1]*Math.sin(x)+A[2]*Math.cos(x),v[0]=k[0]+g[0],v[1]=k[1]+g[1],v[2]=k[2]+g[2],v},s.by=function(v,h,g,x){var A=[],k=[];return A[0]=h[0]-g[0],A[1]=h[1]-g[1],A[2]=h[2]-g[2],k[0]=A[2]*Math.sin(x)+A[0]*Math.cos(x),k[1]=A[1],k[2]=A[2]*Math.cos(x)-A[0]*Math.sin(x),v[0]=k[0]+g[0],v[1]=k[1]+g[1],v[2]=k[2]+g[2],v},s.bz=function(v,h,g){var x=Math.sin(g),A=Math.cos(g),k=h[0],L=h[1],z=h[2],V=h[3],X=h[8],Z=h[9],J=h[10],oe=h[11];return h!==v&&(v[4]=h[4],v[5]=h[5],v[6]=h[6],v[7]=h[7],v[12]=h[12],v[13]=h[13],v[14]=h[14],v[15]=h[15]),v[0]=k*A-X*x,v[1]=L*A-Z*x,v[2]=z*A-J*x,v[3]=V*A-oe*x,v[8]=k*x+X*A,v[9]=L*x+Z*A,v[10]=z*x+J*A,v[11]=V*x+oe*A,v},s.c=he,s.c0=class extends zp{},s.c1=Gb,s.c2=class extends u{},s.c3=nu,s.c4=function(v){return v<=1?1:Math.pow(2,Math.ceil(Math.log(v)/Math.LN2))},s.c5=Lb,s.c6=function(v,h,g){var x=h[0],A=h[1],k=h[2],L=g[3]*x+g[7]*A+g[11]*k+g[15];return v[0]=(g[0]*x+g[4]*A+g[8]*k+g[12])/(L=L||1),v[1]=(g[1]*x+g[5]*A+g[9]*k+g[13])/L,v[2]=(g[2]*x+g[6]*A+g[10]*k+g[14])/L,v},s.c7=class extends eh{},s.c8=class extends j{},s.c9=function(v,h){return v[0]===h[0]&&v[1]===h[1]&&v[2]===h[2]&&v[3]===h[3]&&v[4]===h[4]&&v[5]===h[5]&&v[6]===h[6]&&v[7]===h[7]&&v[8]===h[8]&&v[9]===h[9]&&v[10]===h[10]&&v[11]===h[11]&&v[12]===h[12]&&v[13]===h[13]&&v[14]===h[14]&&v[15]===h[15]},s.cA=function(v,h){fe.REGISTERED_PROTOCOLS[v]=h},s.cB=function(v){delete fe.REGISTERED_PROTOCOLS[v]},s.cC=function(v,h){const g={};for(let A=0;A<v.length;A++){const k=h&&h[v[A].id]||Vs(v[A]);h&&(h[v[A].id]=k);let L=g[k];L||(L=g[k]=[]),L.push(v[A])}const x=[];for(const A in g)x.push(g[A]);return x},s.cD=Zt,s.cE=dx,s.cF=w_,s.cG=Jb,s.cH=function(v){v.bucket.createArrays(),v.bucket.tilePixelRatio=je/(512*v.bucket.overscaling),v.bucket.compareText={},v.bucket.iconsNeedLinear=!1;const h=v.bucket.layers[0],g=h.layout,x=h._unevaluatedLayout._values,A={layoutIconSize:x["icon-size"].possiblyEvaluate(new Ni(v.bucket.zoom+1),v.canonical),layoutTextSize:x["text-size"].possiblyEvaluate(new Ni(v.bucket.zoom+1),v.canonical),textMaxSize:x["text-size"].possiblyEvaluate(new Ni(18))};if(v.bucket.textSizeData.kind==="composite"){const{minZoom:X,maxZoom:Z}=v.bucket.textSizeData;A.compositeTextSizes=[x["text-size"].possiblyEvaluate(new Ni(X),v.canonical),x["text-size"].possiblyEvaluate(new Ni(Z),v.canonical)]}if(v.bucket.iconSizeData.kind==="composite"){const{minZoom:X,maxZoom:Z}=v.bucket.iconSizeData;A.compositeIconSizes=[x["icon-size"].possiblyEvaluate(new Ni(X),v.canonical),x["icon-size"].possiblyEvaluate(new Ni(Z),v.canonical)]}const k=g.get("text-line-height")*On,L=g.get("text-rotation-alignment")!=="viewport"&&g.get("symbol-placement")!=="point",z=g.get("text-keep-upright"),V=g.get("text-size");for(const X of v.bucket.features){const Z=g.get("text-font").evaluate(X,{},v.canonical).join(","),J=V.evaluate(X,{},v.canonical),oe=A.layoutTextSize.evaluate(X,{},v.canonical),le=A.layoutIconSize.evaluate(X,{},v.canonical),ce={horizontal:{},vertical:void 0},ge=X.text;let be,Ee=[0,0];if(ge){const Ve=ge.toString(),ot=g.get("text-letter-spacing").evaluate(X,{},v.canonical)*On,gt=Sv(Ve)?ot:0,Et=g.get("text-anchor").evaluate(X,{},v.canonical),Wt=yx(h,X,v.canonical);if(!Wt){const Ut=g.get("text-radial-offset").evaluate(X,{},v.canonical);Ee=Ut?E_(Et,[Ut*On,ps]):g.get("text-offset").evaluate(X,{},v.canonical).map((jt=>jt*On))}let Ft=L?"center":g.get("text-justify").evaluate(X,{},v.canonical);const Ht=g.get("symbol-placement")==="point"?g.get("text-max-width").evaluate(X,{},v.canonical)*On:1/0,ur=()=>{v.bucket.allowVerticalPlacement&&wl(Ve)&&(ce.vertical=jv(ge,v.glyphMap,v.glyphPositions,v.imagePositions,Z,Ht,k,Et,"left",gt,Ee,s.ao.vertical,!0,oe,J))};if(!L&&Wt){const Ut=new Set;if(Ft==="auto")for(let Tt=0;Tt<Wt.values.length;Tt+=2)Ut.add(I_(Wt.values[Tt]));else Ut.add(Ft);let jt=!1;for(const Tt of Ut)if(!ce.horizontal[Tt])if(jt)ce.horizontal[Tt]=ce.horizontal[0];else{const xr=jv(ge,v.glyphMap,v.glyphPositions,v.imagePositions,Z,Ht,k,"center",Tt,gt,Ee,s.ao.horizontal,!1,oe,J);xr&&(ce.horizontal[Tt]=xr,jt=xr.positionedLines.length===1)}ur()}else{Ft==="auto"&&(Ft=I_(Et));const Ut=jv(ge,v.glyphMap,v.glyphPositions,v.imagePositions,Z,Ht,k,Et,Ft,gt,Ee,s.ao.horizontal,!1,oe,J);Ut&&(ce.horizontal[Ft]=Ut),ur(),wl(Ve)&&L&&z&&(ce.vertical=jv(ge,v.glyphMap,v.glyphPositions,v.imagePositions,Z,Ht,k,Et,Ft,gt,Ee,s.ao.vertical,!1,oe,J))}}let qe=!1;if(X.icon&&X.icon.name){const Ve=v.imageMap[X.icon.name];Ve&&(be=Jp(v.imagePositions[X.icon.name],g.get("icon-offset").evaluate(X,{},v.canonical),g.get("icon-anchor").evaluate(X,{},v.canonical)),qe=!!Ve.sdf,v.bucket.sdfIcons===void 0?v.bucket.sdfIcons=qe:v.bucket.sdfIcons!==qe&&dr("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(Ve.pixelRatio!==v.bucket.pixelRatio||g.get("icon-rotate").constantOr(1)!==0)&&(v.bucket.iconsNeedLinear=!0))}const Oe=Qs(ce.horizontal)||ce.vertical;v.bucket.iconsInText=!!Oe&&Oe.iconsInText,(Oe||be)&&WS(v.bucket,X,ce,be,v.imageMap,A,oe,le,Ee,qe,v.canonical,v.subdivisionGranularity)}v.showCollisionBoxes&&v.bucket.generateCollisionDebugBuffers()},s.cI=Bv,s.cJ=en,s.cK=Nd,s.cL=jb,s.cM=Co,s.cN=class{constructor(v){this._marks={start:[v.url,"start"].join("#"),end:[v.url,"end"].join("#"),measure:v.url.toString()},performance.mark(this._marks.start)}finish(){performance.mark(this._marks.end);let v=performance.getEntriesByName(this._marks.measure);return v.length===0&&(performance.measure(this._marks.measure,this._marks.start,this._marks.end),v=performance.getEntriesByName(this._marks.measure),performance.clearMarks(this._marks.start),performance.clearMarks(this._marks.end),performance.clearMeasures(this._marks.measure)),v}},s.cO=function(v,h,g,x,A){return o(this,void 0,void 0,(function*(){if(P())try{return yield Na(v,h,g,x,A)}catch{}return(function(k,L,z,V,X){const Z=k.width,J=k.height;Ls&&vo||(Ls=new OffscreenCanvas(Z,J),vo=Ls.getContext("2d",{willReadFrequently:!0})),Ls.width=Z,Ls.height=J,vo.drawImage(k,0,0,Z,J);const oe=vo.getImageData(L,z,V,X);return vo.clearRect(0,0,Z,J),oe.data})(v,h,g,x,A)}))},s.cP=jp,s.cQ=c,s.cR=Hb,s.cS=Dd,s.cT=fd,s.cU=function(v,h){const g=new Map;if(v!=null)if(v.type==="Feature")g.set(sa(v,h),v);else for(const x of v.features)g.set(sa(x,h),x);return g},s.cV=function(v,h){if(v==null)return!0;if(v.type==="Feature")return sa(v,h)!=null;if(v.type==="FeatureCollection"){const g=new Set;for(const x of v.features){const A=sa(x,h);if(A==null||g.has(A))return!1;g.add(A)}return!0}return!1},s.cW=function(v,h,g){var x,A,k,L;if(h.removeAll&&v.clear(),h.remove)for(const z of h.remove)v.delete(z);if(h.add)for(const z of h.add){const V=sa(z,g);V!=null&&v.set(V,z)}if(h.update)for(const z of h.update){let V=v.get(z.id);if(V==null)continue;const X=!z.removeAllProperties&&(((x=z.removeProperties)===null||x===void 0?void 0:x.length)>0||((A=z.addOrUpdateProperties)===null||A===void 0?void 0:A.length)>0);if((z.newGeometry||z.removeAllProperties||X)&&(V=Object.assign({},V),v.set(z.id,V),X&&(V.properties=Object.assign({},V.properties))),z.newGeometry&&(V.geometry=z.newGeometry),z.removeAllProperties)V.properties={};else if(((k=z.removeProperties)===null||k===void 0?void 0:k.length)>0)for(const Z of z.removeProperties)Object.prototype.hasOwnProperty.call(V.properties,Z)&&delete V.properties[Z];if(((L=z.addOrUpdateProperties)===null||L===void 0?void 0:L.length)>0)for(const{key:Z,value:J}of z.addOrUpdateProperties)V.properties[Z]=J}},s.cX=Sl,s.ca=function(v,h){var g=v[0],x=v[1],A=v[2],k=v[3],L=v[4],z=v[5],V=v[6],X=v[7],Z=v[8],J=v[9],oe=v[10],le=v[11],ce=v[12],ge=v[13],be=v[14],Ee=v[15],qe=h[0],Oe=h[1],Ve=h[2],ot=h[3],gt=h[4],Et=h[5],Wt=h[6],Ft=h[7],Ht=h[8],ur=h[9],Ut=h[10],jt=h[11],Tt=h[12],xr=h[13],Er=h[14],vr=h[15];return Math.abs(g-qe)<=O*Math.max(1,Math.abs(g),Math.abs(qe))&&Math.abs(x-Oe)<=O*Math.max(1,Math.abs(x),Math.abs(Oe))&&Math.abs(A-Ve)<=O*Math.max(1,Math.abs(A),Math.abs(Ve))&&Math.abs(k-ot)<=O*Math.max(1,Math.abs(k),Math.abs(ot))&&Math.abs(L-gt)<=O*Math.max(1,Math.abs(L),Math.abs(gt))&&Math.abs(z-Et)<=O*Math.max(1,Math.abs(z),Math.abs(Et))&&Math.abs(V-Wt)<=O*Math.max(1,Math.abs(V),Math.abs(Wt))&&Math.abs(X-Ft)<=O*Math.max(1,Math.abs(X),Math.abs(Ft))&&Math.abs(Z-Ht)<=O*Math.max(1,Math.abs(Z),Math.abs(Ht))&&Math.abs(J-ur)<=O*Math.max(1,Math.abs(J),Math.abs(ur))&&Math.abs(oe-Ut)<=O*Math.max(1,Math.abs(oe),Math.abs(Ut))&&Math.abs(le-jt)<=O*Math.max(1,Math.abs(le),Math.abs(jt))&&Math.abs(ce-Tt)<=O*Math.max(1,Math.abs(ce),Math.abs(Tt))&&Math.abs(ge-xr)<=O*Math.max(1,Math.abs(ge),Math.abs(xr))&&Math.abs(be-Er)<=O*Math.max(1,Math.abs(be),Math.abs(Er))&&Math.abs(Ee-vr)<=O*Math.max(1,Math.abs(Ee),Math.abs(vr))},s.cb=function(v,h){return v[0]=h[0],v[1]=h[1],v[2]=h[2],v[3]=h[3],v[4]=h[4],v[5]=h[5],v[6]=h[6],v[7]=h[7],v[8]=h[8],v[9]=h[9],v[10]=h[10],v[11]=h[11],v[12]=h[12],v[13]=h[13],v[14]=h[14],v[15]=h[15],v},s.cc=v=>v.type==="symbol",s.cd=v=>v.type==="circle",s.ce=v=>v.type==="heatmap",s.cf=v=>v.type==="line",s.cg=v=>v.type==="fill",s.ch=v=>v.type==="fill-extrusion",s.ci=v=>v.type==="hillshade",s.cj=v=>v.type==="color-relief",s.ck=v=>v.type==="background",s.cl=v=>v.type==="custom",s.cm=_t,s.cn=function(v,h,g){const x=Fe(h.x-g.x,h.y-g.y),A=Fe(v.x-g.x,v.y-g.y);var k,L;return Do(Math.atan2(x[0]*A[1]-x[1]*A[0],(k=x)[0]*(L=A)[0]+k[1]*L[1]))},s.co=Dt,s.cp=function(v,h){return Ya[h]&&(v instanceof MouseEvent||v instanceof WheelEvent)},s.cq=function(v,h){return Ll[h]&&"touches"in v},s.cr=function(v){return Ll[v]||Ya[v]},s.cs=function(v,h,g){var x=h[0],A=h[1];return v[0]=g[0]*x+g[4]*A+g[12],v[1]=g[1]*x+g[5]*A+g[13],v},s.ct=function(v,h){const{x:g,y:x}=Kv.fromLngLat(h);return!(v<0||v>25||x<0||x>=1||g<0||g>=1)},s.cu=function(v,h){return v[0]=h[0],v[1]=0,v[2]=0,v[3]=0,v[4]=0,v[5]=h[1],v[6]=0,v[7]=0,v[8]=0,v[9]=0,v[10]=h[2],v[11]=0,v[12]=0,v[13]=0,v[14]=0,v[15]=1,v},s.cv=class extends hn{},s.cw=qS,s.cy=function(v){return v.message===Ge},s.cz=Be,s.d=Ke,s.e=Kt,s.f=v=>o(void 0,void 0,void 0,(function*(){if(v.byteLength===0)return createImageBitmap(new ImageData(1,1));const h=new Blob([new Uint8Array(v)],{type:"image/png"});try{return createImageBitmap(h)}catch(g){throw new Error(`Could not load image because of ${g.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`)}})),s.g=we,s.h=v=>new Promise(((h,g)=>{const x=new Image;x.onload=()=>{h(x),URL.revokeObjectURL(x.src),x.onload=null,window.requestAnimationFrame((()=>{x.src=Oa}))},x.onerror=()=>g(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const A=new Blob([new Uint8Array(v)],{type:"image/png"});x.src=v.byteLength?URL.createObjectURL(A):Oa})),s.i=ii,s.j=(v,h)=>it(Kt(v,{type:"json"}),h),s.k=rr,s.l=St,s.m=it,s.n=(v,h)=>it(Kt(v,{type:"arrayBuffer"}),h),s.o=function(v){return new Co(v).readFields(f_,[])},s.p=DS,s.q=Up,s.r=Ki,s.s=ea,s.t=wd,s.u=zr,s.v=Qe,s.w=dr,s.x=Mb,s.y=zu,s.z=Ho})),n("worker",["./shared"],(function(s){class o{constructor(he,fe){this.keyCache={},he&&this.replace(he,fe)}replace(he,fe){this._layerConfigs={},this._layers={},this.update(he,[],fe)}update(he,fe,we){for(const Be of he){this._layerConfigs[Be.id]=Be;const We=this._layers[Be.id]=s.bJ(Be,we);We._featureFilter=s.aa(We.filter,we),this.keyCache[Be.id]&&delete this.keyCache[Be.id]}for(const Be of fe)delete this.keyCache[Be],delete this._layerConfigs[Be],delete this._layers[Be];this.familiesBySource={};const Ne=s.cC(Object.values(this._layerConfigs),this.keyCache);for(const Be of Ne){const We=Be.map((rr=>this._layers[rr.id])),it=We[0];if(it.visibility==="none")continue;const Ke=it.source||"";let yt=this.familiesBySource[Ke];yt||(yt=this.familiesBySource[Ke]={});const kt=it.sourceLayer||"_geojsonTileLayer";let St=yt[kt];St||(St=yt[kt]=[]),St.push(We)}}}class l{constructor(he){const fe={},we=[];for(const it in he){const Ke=he[it],yt=fe[it]={};for(const kt in Ke){const St=Ke[+kt];if(!St||St.bitmap.width===0||St.bitmap.height===0)continue;const rr={x:0,y:0,w:St.bitmap.width+2,h:St.bitmap.height+2};we.push(rr),yt[kt]={rect:rr,metrics:St.metrics}}}const{w:Ne,h:Be}=s.p(we),We=new s.q({width:Ne||1,height:Be||1});for(const it in he){const Ke=he[it];for(const yt in Ke){const kt=Ke[+yt];if(!kt||kt.bitmap.width===0||kt.bitmap.height===0)continue;const St=fe[it][yt].rect;s.q.copy(kt.bitmap,We,{x:0,y:0},{x:St.x+1,y:St.y+1},kt.bitmap)}}this.image=We,this.positions=fe}}s.cD("GlyphAtlas",l);class c{constructor(he){this.tileID=new s.Z(he.tileID.overscaledZ,he.tileID.wrap,he.tileID.canonical.z,he.tileID.canonical.x,he.tileID.canonical.y),this.uid=he.uid,this.zoom=he.zoom,this.pixelRatio=he.pixelRatio,this.tileSize=he.tileSize,this.source=he.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=he.showCollisionBoxes,this.collectResourceTiming=!!he.collectResourceTiming,this.returnDependencies=!!he.returnDependencies,this.promoteId=he.promoteId,this.inFlightDependencies=[]}parse(he,fe,we,Ne,Be){return s._(this,void 0,void 0,(function*(){this.status="parsing",this.data=he,this.collisionBoxArray=new s.a8;const We=new s.cE(Object.keys(he.layers).sort()),it=new s.cF(this.tileID,this.promoteId);it.bucketLayerIDs=[];const Ke={},yt={featureIndex:it,iconDependencies:{},patternDependencies:{},glyphDependencies:{},dashDependencies:{},availableImages:we,subdivisionGranularity:Be},kt=fe.familiesBySource[this.source];for(const Ti in kt){const It=he.layers[Ti];if(!It)continue;It.version===1&&s.w(`Vector tile source "${this.source}" layer "${Ti}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const Os=We.encode(Ti),mo=[];for(let Wn=0;Wn<It.length;Wn++){const mi=It.feature(Wn),Lt=it.getId(mi,Ti);mo.push({feature:mi,id:Lt,index:Wn,sourceLayerIndex:Os})}for(const Wn of kt[Ti]){const mi=Wn[0];mi.source!==this.source&&s.w(`layer.source = ${mi.source} does not equal this.source = ${this.source}`),mi.minzoom&&this.zoom<Math.floor(mi.minzoom)||mi.maxzoom&&this.zoom>=mi.maxzoom||mi.visibility!=="none"&&(f(Wn,this.zoom,we),(Ke[mi.id]=mi.createBucket({index:it.bucketLayerIDs.length,layers:Wn,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:Os,sourceID:this.source})).populate(mo,yt,this.tileID.canonical),it.bucketLayerIDs.push(Wn.map((Lt=>Lt.id))))}}const St=s.bO(yt.glyphDependencies,(Ti=>Object.keys(Ti).map(Number)));this.inFlightDependencies.forEach((Ti=>Ti?.abort())),this.inFlightDependencies=[];let rr=Promise.resolve({});if(Object.keys(St).length){const Ti=new AbortController;this.inFlightDependencies.push(Ti),rr=Ne.sendAsync({type:"GG",data:{stacks:St,source:this.source,tileID:this.tileID,type:"glyphs"}},Ti)}const pr=Object.keys(yt.iconDependencies);let Qe=Promise.resolve({});if(pr.length){const Ti=new AbortController;this.inFlightDependencies.push(Ti),Qe=Ne.sendAsync({type:"GI",data:{icons:pr,source:this.source,tileID:this.tileID,type:"icons"}},Ti)}const Kr=Object.keys(yt.patternDependencies);let pi=Promise.resolve({});if(Kr.length){const Ti=new AbortController;this.inFlightDependencies.push(Ti),pi=Ne.sendAsync({type:"GI",data:{icons:Kr,source:this.source,tileID:this.tileID,type:"patterns"}},Ti)}const or=yt.dashDependencies;let ui=Promise.resolve({});if(Object.keys(or).length){const Ti=new AbortController;this.inFlightDependencies.push(Ti),ui=Ne.sendAsync({type:"GDA",data:{dashes:or}},Ti)}const[zn,Mn,jn,fa]=yield Promise.all([rr,Qe,pi,ui]),Vi=new l(zn),$n=new s.cG(Mn,jn);for(const Ti in Ke){const It=Ke[Ti];It instanceof s.a9?(f(It.layers,this.zoom,we),s.cH({bucket:It,glyphMap:zn,glyphPositions:Vi.positions,imageMap:Mn,imagePositions:$n.iconPositions,showCollisionBoxes:this.showCollisionBoxes,canonical:this.tileID.canonical,subdivisionGranularity:yt.subdivisionGranularity})):It.hasDependencies&&(It instanceof s.cI||It instanceof s.cJ||It instanceof s.cK)&&(f(It.layers,this.zoom,we),It.addFeatures(yt,this.tileID.canonical,$n.patternPositions,fa))}return this.status="done",{buckets:Object.values(Ke).filter((Ti=>!Ti.isEmpty())),featureIndex:it,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:Vi.image,imageAtlas:$n,dashPositions:fa,glyphMap:this.returnDependencies?zn:null,iconMap:this.returnDependencies?Mn:null,glyphPositions:this.returnDependencies?Vi.positions:null}}))}}function f(Ge,he,fe){const we=new s.F(he);for(const Ne of Ge)Ne.recalculate(we,fe)}class p{constructor(he,fe,we){this.actor=he,this.layerIndex=fe,this.availableImages=we,this.fetching={},this.loading={},this.loaded={}}loadVectorTile(he,fe){return s._(this,void 0,void 0,(function*(){const we=yield s.n(he.request,fe);try{return{vectorTile:new s.cL(new s.cM(we.data)),rawData:we.data,cacheControl:we.cacheControl,expires:we.expires}}catch(Ne){const Be=new Uint8Array(we.data);let We=`Unable to parse the tile at ${he.request.url}, `;throw We+=Be[0]===31&&Be[1]===139?"please make sure the data is not gzipped and that you have configured the relevant header in the server":`got error: ${Ne.message}`,new Error(We)}}))}loadTile(he){return s._(this,void 0,void 0,(function*(){const fe=he.uid,we=!!(he&&he.request&&he.request.collectResourceTiming)&&new s.cN(he.request),Ne=new c(he);this.loading[fe]=Ne;const Be=new AbortController;Ne.abort=Be;try{const We=yield this.loadVectorTile(he,Be);if(delete this.loading[fe],!We)return null;const it=We.rawData,Ke={};We.expires&&(Ke.expires=We.expires),We.cacheControl&&(Ke.cacheControl=We.cacheControl);const yt={};if(we){const St=we.finish();St&&(yt.resourceTiming=JSON.parse(JSON.stringify(St)))}Ne.vectorTile=We.vectorTile;const kt=Ne.parse(We.vectorTile,this.layerIndex,this.availableImages,this.actor,he.subdivisionGranularity);this.loaded[fe]=Ne,this.fetching[fe]={rawTileData:it,cacheControl:Ke,resourceTiming:yt};try{const St=yield kt;return s.e({rawTileData:it.slice(0)},St,Ke,yt)}finally{delete this.fetching[fe]}}catch(We){throw delete this.loading[fe],Ne.status="done",this.loaded[fe]=Ne,We}}))}reloadTile(he){return s._(this,void 0,void 0,(function*(){const fe=he.uid;if(!this.loaded||!this.loaded[fe])throw new Error("Should not be trying to reload a tile that was never loaded or has been removed");const we=this.loaded[fe];if(we.showCollisionBoxes=he.showCollisionBoxes,we.status==="parsing"){const Ne=yield we.parse(we.vectorTile,this.layerIndex,this.availableImages,this.actor,he.subdivisionGranularity);let Be;if(this.fetching[fe]){const{rawTileData:We,cacheControl:it,resourceTiming:Ke}=this.fetching[fe];delete this.fetching[fe],Be=s.e({rawTileData:We.slice(0)},Ne,it,Ke)}else Be=Ne;return Be}if(we.status==="done"&&we.vectorTile)return we.parse(we.vectorTile,this.layerIndex,this.availableImages,this.actor,he.subdivisionGranularity)}))}abortTile(he){return s._(this,void 0,void 0,(function*(){const fe=this.loading,we=he.uid;fe&&fe[we]&&fe[we].abort&&(fe[we].abort.abort(),delete fe[we])}))}removeTile(he){return s._(this,void 0,void 0,(function*(){this.loaded&&this.loaded[he.uid]&&delete this.loaded[he.uid]}))}}class y{constructor(){this.loaded={}}loadTile(he){return s._(this,void 0,void 0,(function*(){const{uid:fe,encoding:we,rawImageData:Ne,redFactor:Be,greenFactor:We,blueFactor:it,baseShift:Ke}=he,yt=Ne.width+2,kt=Ne.height+2,St=s.b(Ne)?new s.R({width:yt,height:kt},yield s.cO(Ne,-1,-1,yt,kt)):Ne,rr=new s.cP(fe,St,we,Be,We,it,Ke);return this.loaded=this.loaded||{},this.loaded[fe]=rr,rr}))}removeTile(he){const fe=this.loaded,we=he.uid;fe&&fe[we]&&delete fe[we]}}var b,S,C=(function(){if(S)return b;function Ge(fe,we){if(fe.length!==0){he(fe[0],we);for(var Ne=1;Ne<fe.length;Ne++)he(fe[Ne],!we)}}function he(fe,we){for(var Ne=0,Be=0,We=0,it=fe.length,Ke=it-1;We<it;Ke=We++){var yt=(fe[We][0]-fe[Ke][0])*(fe[Ke][1]+fe[We][1]),kt=Ne+yt;Be+=Math.abs(Ne)>=Math.abs(yt)?Ne-kt+yt:yt-kt+Ne,Ne=kt}Ne+Be>=0!=!!we&&fe.reverse()}return S=1,b=function fe(we,Ne){var Be,We=we&&we.type;if(We==="FeatureCollection")for(Be=0;Be<we.features.length;Be++)fe(we.features[Be],Ne);else if(We==="GeometryCollection")for(Be=0;Be<we.geometries.length;Be++)fe(we.geometries[Be],Ne);else if(We==="Feature")fe(we.geometry,Ne);else if(We==="Polygon")Ge(we.coordinates,Ne);else if(We==="MultiPolygon")for(Be=0;Be<we.coordinates.length;Be++)Ge(we.coordinates[Be],Ne);return we}})(),E=s.cQ(C);class P extends s.cS{constructor(he,fe){super(new s.cM,0,fe,[],[]),this.feature=he,this.type=he.type,this.properties=he.tags?he.tags:{},"id"in he&&(typeof he.id=="string"?this.id=parseInt(he.id,10):typeof he.id!="number"||isNaN(he.id)||(this.id=he.id))}loadGeometry(){const he=[],fe=this.feature.type===1?[this.feature.geometry]:this.feature.geometry;for(const we of fe){const Ne=[];for(const Be of we)Ne.push(new s.P(Be[0],Be[1]));he.push(Ne)}return he}}class O extends s.cR{constructor(he,fe){super(new s.cM),this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.version=fe?fe.version:1,this.extent=fe?fe.extent:4096,this.length=he.length,this.features=he}feature(he){return new P(this.features[he],this.extent)}}function B(Ge,he){he.writeVarintField(15,Ge.version||1),he.writeStringField(1,Ge.name||""),he.writeVarintField(5,Ge.extent||4096);const fe={keys:[],values:[],keycache:{},valuecache:{}};for(let Be=0;Be<Ge.length;Be++)fe.feature=Ge.feature(Be),he.writeMessage(2,F,fe);const we=fe.keys;for(const Be of we)he.writeStringField(3,Be);const Ne=fe.values;for(const Be of Ne)he.writeMessage(4,ee,Be)}function F(Ge,he){if(!Ge.feature)return;const fe=Ge.feature;fe.id!==void 0&&he.writeVarintField(1,fe.id),he.writeMessage(2,W,Ge),he.writeVarintField(3,fe.type),he.writeMessage(4,Q,fe)}function W(Ge,he){for(const fe in Ge.feature?.properties){let we=Ge.feature.properties[fe],Ne=Ge.keycache[fe];if(we===null)continue;Ne===void 0&&(Ge.keys.push(fe),Ne=Ge.keys.length-1,Ge.keycache[fe]=Ne),he.writeVarint(Ne),typeof we!="string"&&typeof we!="boolean"&&typeof we!="number"&&(we=JSON.stringify(we));const Be=typeof we+":"+we;let We=Ge.valuecache[Be];We===void 0&&(Ge.values.push(we),We=Ge.values.length-1,Ge.valuecache[Be]=We),he.writeVarint(We)}}function $(Ge,he){return(he<<3)+(7&Ge)}function q(Ge){return Ge<<1^Ge>>31}function Q(Ge,he){const fe=Ge.loadGeometry(),we=Ge.type;let Ne=0,Be=0;for(const We of fe){let it=1;we===1&&(it=We.length),he.writeVarint($(1,it));const Ke=we===3?We.length-1:We.length;for(let yt=0;yt<Ke;yt++){yt===1&&we!==1&&he.writeVarint($(2,Ke-1));const kt=We[yt].x-Ne,St=We[yt].y-Be;he.writeVarint(q(kt)),he.writeVarint(q(St)),Ne+=kt,Be+=St}Ge.type===3&&he.writeVarint($(7,1))}}function ee(Ge,he){const fe=typeof Ge;fe==="string"?he.writeStringField(1,Ge):fe==="boolean"?he.writeBooleanField(7,Ge):fe==="number"&&(Ge%1!=0?he.writeDoubleField(3,Ge):Ge<0?he.writeSVarintField(6,Ge):he.writeVarintField(5,Ge))}const te={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:Ge=>Ge},ae=Math.fround||(de=new Float32Array(1),Ge=>(de[0]=+Ge,de[0]));var de;class ve{constructor(he){this.options=Object.assign(Object.create(te),he),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(he){const{log:fe,minZoom:we,maxZoom:Ne}=this.options;fe&&console.time("total time");const Be=`prepare ${he.length} points`;fe&&console.time(Be),this.points=he;const We=[];for(let Ke=0;Ke<he.length;Ke++){const yt=he[Ke];if(!yt.geometry)continue;const[kt,St]=yt.geometry.coordinates,rr=ae(me(kt)),pr=ae(De(St));We.push(rr,pr,1/0,Ke,-1,1),this.options.reduce&&We.push(0)}let it=this.trees[Ne+1]=this._createTree(We);fe&&console.timeEnd(Be);for(let Ke=Ne;Ke>=we;Ke--){const yt=+Date.now();it=this.trees[Ke]=this._createTree(this._cluster(it,Ke)),fe&&console.log("z%d: %d clusters in %dms",Ke,it.numItems,+Date.now()-yt)}return fe&&console.timeEnd("total time"),this}getClusters(he,fe){let we=((he[0]+180)%360+360)%360-180;const Ne=Math.max(-90,Math.min(90,he[1]));let Be=he[2]===180?180:((he[2]+180)%360+360)%360-180;const We=Math.max(-90,Math.min(90,he[3]));if(he[2]-he[0]>=360)we=-180,Be=180;else if(we>Be){const St=this.getClusters([we,Ne,180,We],fe),rr=this.getClusters([-180,Ne,Be,We],fe);return St.concat(rr)}const it=this.trees[this._limitZoom(fe)],Ke=it.range(me(we),De(We),me(Be),De(Ne)),yt=it.data,kt=[];for(const St of Ke){const rr=this.stride*St;kt.push(yt[rr+5]>1?ye(yt,rr,this.clusterProps):this.points[yt[rr+3]])}return kt}getChildren(he){const fe=this._getOriginId(he),we=this._getOriginZoom(he),Ne="No cluster with the specified id.",Be=this.trees[we];if(!Be)throw new Error(Ne);const We=Be.data;if(fe*this.stride>=We.length)throw new Error(Ne);const it=this.options.radius/(this.options.extent*Math.pow(2,we-1)),Ke=Be.within(We[fe*this.stride],We[fe*this.stride+1],it),yt=[];for(const kt of Ke){const St=kt*this.stride;We[St+4]===he&&yt.push(We[St+5]>1?ye(We,St,this.clusterProps):this.points[We[St+3]])}if(yt.length===0)throw new Error(Ne);return yt}getLeaves(he,fe,we){const Ne=[];return this._appendLeaves(Ne,he,fe=fe||10,we=we||0,0),Ne}getTile(he,fe,we){const Ne=this.trees[this._limitZoom(he)],Be=Math.pow(2,he),{extent:We,radius:it}=this.options,Ke=it/We,yt=(we-Ke)/Be,kt=(we+1+Ke)/Be,St={features:[]};return this._addTileFeatures(Ne.range((fe-Ke)/Be,yt,(fe+1+Ke)/Be,kt),Ne.data,fe,we,Be,St),fe===0&&this._addTileFeatures(Ne.range(1-Ke/Be,yt,1,kt),Ne.data,Be,we,Be,St),fe===Be-1&&this._addTileFeatures(Ne.range(0,yt,Ke/Be,kt),Ne.data,-1,we,Be,St),St.features.length?St:null}getClusterExpansionZoom(he){let fe=this._getOriginZoom(he)-1;for(;fe<=this.options.maxZoom;){const we=this.getChildren(he);if(fe++,we.length!==1)break;he=we[0].properties.cluster_id}return fe}_appendLeaves(he,fe,we,Ne,Be){const We=this.getChildren(fe);for(const it of We){const Ke=it.properties;if(Ke&&Ke.cluster?Be+Ke.point_count<=Ne?Be+=Ke.point_count:Be=this._appendLeaves(he,Ke.cluster_id,we,Ne,Be):Be<Ne?Be++:he.push(it),he.length===we)break}return Be}_createTree(he){const fe=new s.aI(he.length/this.stride|0,this.options.nodeSize,Float32Array);for(let we=0;we<he.length;we+=this.stride)fe.add(he[we],he[we+1]);return fe.finish(),fe.data=he,fe}_addTileFeatures(he,fe,we,Ne,Be,We){for(const it of he){const Ke=it*this.stride,yt=fe[Ke+5]>1;let kt,St,rr;if(yt)kt=Ae(fe,Ke,this.clusterProps),St=fe[Ke],rr=fe[Ke+1];else{const Kr=this.points[fe[Ke+3]];kt=Kr.properties;const[pi,or]=Kr.geometry.coordinates;St=me(pi),rr=De(or)}const pr={type:1,geometry:[[Math.round(this.options.extent*(St*Be-we)),Math.round(this.options.extent*(rr*Be-Ne))]],tags:kt};let Qe;Qe=yt||this.options.generateId?fe[Ke+3]:this.points[fe[Ke+3]].id,Qe!==void 0&&(pr.id=Qe),We.features.push(pr)}}_limitZoom(he){return Math.max(this.options.minZoom,Math.min(Math.floor(+he),this.options.maxZoom+1))}_cluster(he,fe){const{radius:we,extent:Ne,reduce:Be,minPoints:We}=this.options,it=we/(Ne*Math.pow(2,fe)),Ke=he.data,yt=[],kt=this.stride;for(let St=0;St<Ke.length;St+=kt){if(Ke[St+2]<=fe)continue;Ke[St+2]=fe;const rr=Ke[St],pr=Ke[St+1],Qe=he.within(Ke[St],Ke[St+1],it),Kr=Ke[St+5];let pi=Kr;for(const or of Qe){const ui=or*kt;Ke[ui+2]>fe&&(pi+=Ke[ui+5])}if(pi>Kr&&pi>=We){let or,ui=rr*Kr,zn=pr*Kr,Mn=-1;const jn=(St/kt<<5)+(fe+1)+this.points.length;for(const fa of Qe){const Vi=fa*kt;if(Ke[Vi+2]<=fe)continue;Ke[Vi+2]=fe;const $n=Ke[Vi+5];ui+=Ke[Vi]*$n,zn+=Ke[Vi+1]*$n,Ke[Vi+4]=jn,Be&&(or||(or=this._map(Ke,St,!0),Mn=this.clusterProps.length,this.clusterProps.push(or)),Be(or,this._map(Ke,Vi)))}Ke[St+4]=jn,yt.push(ui/pi,zn/pi,1/0,jn,-1,pi),Be&&yt.push(Mn)}else{for(let or=0;or<kt;or++)yt.push(Ke[St+or]);if(pi>1)for(const or of Qe){const ui=or*kt;if(!(Ke[ui+2]<=fe)){Ke[ui+2]=fe;for(let zn=0;zn<kt;zn++)yt.push(Ke[ui+zn])}}}}return yt}_getOriginId(he){return he-this.points.length>>5}_getOriginZoom(he){return(he-this.points.length)%32}_map(he,fe,we){if(he[fe+5]>1){const We=this.clusterProps[he[fe+6]];return we?Object.assign({},We):We}const Ne=this.points[he[fe+3]].properties,Be=this.options.map(Ne);return we&&Be===Ne?Object.assign({},Be):Be}}function ye(Ge,he,fe){return{type:"Feature",id:Ge[he+3],properties:Ae(Ge,he,fe),geometry:{type:"Point",coordinates:[(we=Ge[he],360*(we-.5)),Fe(Ge[he+1])]}};var we}function Ae(Ge,he,fe){const we=Ge[he+5],Ne=we>=1e4?`${Math.round(we/1e3)}k`:we>=1e3?Math.round(we/100)/10+"k":we,Be=Ge[he+6],We=Be===-1?{}:Object.assign({},fe[Be]);return Object.assign(We,{cluster:!0,cluster_id:Ge[he+3],point_count:we,point_count_abbreviated:Ne})}function me(Ge){return Ge/360+.5}function De(Ge){const he=Math.sin(Ge*Math.PI/180),fe=.5-.25*Math.log((1+he)/(1-he))/Math.PI;return fe<0?0:fe>1?1:fe}function Fe(Ge){const he=(180-360*Ge)*Math.PI/180;return 360*Math.atan(Math.exp(he))/Math.PI-90}function je(Ge,he,fe,we){let Ne=we;const Be=he+(fe-he>>1);let We,it=fe-he;const Ke=Ge[he],yt=Ge[he+1],kt=Ge[fe],St=Ge[fe+1];for(let rr=he+3;rr<fe;rr+=3){const pr=ct(Ge[rr],Ge[rr+1],Ke,yt,kt,St);if(pr>Ne)We=rr,Ne=pr;else if(pr===Ne){const Qe=Math.abs(rr-Be);Qe<it&&(We=rr,it=Qe)}}Ne>we&&(We-he>3&&je(Ge,he,We,we),Ge[We+2]=Ne,fe-We>3&&je(Ge,We,fe,we))}function ct(Ge,he,fe,we,Ne,Be){let We=Ne-fe,it=Be-we;if(We!==0||it!==0){const Ke=((Ge-fe)*We+(he-we)*it)/(We*We+it*it);Ke>1?(fe=Ne,we=Be):Ke>0&&(fe+=We*Ke,we+=it*Ke)}return We=Ge-fe,it=he-we,We*We+it*it}function xe(Ge,he,fe,we){const Ne={id:Ge??null,type:he,geometry:fe,tags:we,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};if(he==="Point"||he==="MultiPoint"||he==="LineString")$e(Ne,fe);else if(he==="Polygon")$e(Ne,fe[0]);else if(he==="MultiLineString")for(const Be of fe)$e(Ne,Be);else if(he==="MultiPolygon")for(const Be of fe)$e(Ne,Be[0]);return Ne}function $e(Ge,he){for(let fe=0;fe<he.length;fe+=3)Ge.minX=Math.min(Ge.minX,he[fe]),Ge.minY=Math.min(Ge.minY,he[fe+1]),Ge.maxX=Math.max(Ge.maxX,he[fe]),Ge.maxY=Math.max(Ge.maxY,he[fe+1])}function pt(Ge,he,fe,we){if(!he.geometry)return;const Ne=he.geometry.coordinates;if(Ne&&Ne.length===0)return;const Be=he.geometry.type,We=Math.pow(fe.tolerance/((1<<fe.maxZoom)*fe.extent),2);let it=[],Ke=he.id;if(fe.promoteId?Ke=he.properties[fe.promoteId]:fe.generateId&&(Ke=we||0),Be==="Point")_t(Ne,it);else if(Be==="MultiPoint")for(const yt of Ne)_t(yt,it);else if(Be==="LineString")Dt(Ne,it,We,!1);else if(Be==="MultiLineString"){if(fe.lineMetrics){for(const yt of Ne)it=[],Dt(yt,it,We,!1),Ge.push(xe(Ke,"LineString",it,he.properties));return}qt(Ne,it,We,!1)}else if(Be==="Polygon")qt(Ne,it,We,!0);else{if(Be!=="MultiPolygon"){if(Be==="GeometryCollection"){for(const yt of he.geometry.geometries)pt(Ge,{id:Ke,geometry:yt,properties:he.properties},fe,we);return}throw new Error("Input data is not a valid GeoJSON object.")}for(const yt of Ne){const kt=[];qt(yt,kt,We,!0),it.push(kt)}}Ge.push(xe(Ke,Be,it,he.properties))}function _t(Ge,he){he.push(_r(Ge[0]),Kt(Ge[1]),0)}function Dt(Ge,he,fe,we){let Ne,Be,We=0;for(let Ke=0;Ke<Ge.length;Ke++){const yt=_r(Ge[Ke][0]),kt=Kt(Ge[Ke][1]);he.push(yt,kt,0),Ke>0&&(We+=we?(Ne*kt-yt*Be)/2:Math.sqrt(Math.pow(yt-Ne,2)+Math.pow(kt-Be,2))),Ne=yt,Be=kt}const it=he.length-3;he[2]=1,je(he,0,it,fe),he[it+2]=1,he.size=Math.abs(We),he.start=0,he.end=he.size}function qt(Ge,he,fe,we){for(let Ne=0;Ne<Ge.length;Ne++){const Be=[];Dt(Ge[Ne],Be,fe,we),he.push(Be)}}function _r(Ge){return Ge/360+.5}function Kt(Ge){const he=Math.sin(Ge*Math.PI/180),fe=.5-.25*Math.log((1+he)/(1-he))/Math.PI;return fe<0?0:fe>1?1:fe}function zt(Ge,he,fe,we,Ne,Be,We,it){if(we/=he,Be>=(fe/=he)&&We<we)return Ge;if(We<fe||Be>=we)return null;const Ke=[];for(const yt of Ge){const kt=yt.geometry;let St=yt.type;const rr=Ne===0?yt.minX:yt.minY,pr=Ne===0?yt.maxX:yt.maxY;if(rr>=fe&&pr<we){Ke.push(yt);continue}if(pr<fe||rr>=we)continue;let Qe=[];if(St==="Point"||St==="MultiPoint")yr(kt,Qe,fe,we,Ne);else if(St==="LineString")Gt(kt,Qe,fe,we,Ne,!1,it.lineMetrics);else if(St==="MultiLineString")Tr(kt,Qe,fe,we,Ne,!1);else if(St==="Polygon")Tr(kt,Qe,fe,we,Ne,!0);else if(St==="MultiPolygon")for(const Kr of kt){const pi=[];Tr(Kr,pi,fe,we,Ne,!0),pi.length&&Qe.push(pi)}if(Qe.length){if(it.lineMetrics&&St==="LineString"){for(const Kr of Qe)Ke.push(xe(yt.id,St,Kr,yt.tags));continue}St!=="LineString"&&St!=="MultiLineString"||(Qe.length===1?(St="LineString",Qe=Qe[0]):St="MultiLineString"),St!=="Point"&&St!=="MultiPoint"||(St=Qe.length===3?"Point":"MultiPoint"),Ke.push(xe(yt.id,St,Qe,yt.tags))}}return Ke.length?Ke:null}function yr(Ge,he,fe,we,Ne){for(let Be=0;Be<Ge.length;Be+=3){const We=Ge[Be+Ne];We>=fe&&We<=we&&dr(he,Ge[Be],Ge[Be+1],Ge[Be+2])}}function Gt(Ge,he,fe,we,Ne,Be,We){let it=Jt(Ge);const Ke=Ne===0?$r:ii;let yt,kt,St=Ge.start;for(let pi=0;pi<Ge.length-3;pi+=3){const or=Ge[pi],ui=Ge[pi+1],zn=Ge[pi+2],Mn=Ge[pi+3],jn=Ge[pi+4],fa=Ne===0?or:ui,Vi=Ne===0?Mn:jn;let $n=!1;We&&(yt=Math.sqrt(Math.pow(or-Mn,2)+Math.pow(ui-jn,2))),fa<fe?Vi>fe&&(kt=Ke(it,or,ui,Mn,jn,fe),We&&(it.start=St+yt*kt)):fa>we?Vi<we&&(kt=Ke(it,or,ui,Mn,jn,we),We&&(it.start=St+yt*kt)):dr(it,or,ui,zn),Vi<fe&&fa>=fe&&(kt=Ke(it,or,ui,Mn,jn,fe),$n=!0),Vi>we&&fa<=we&&(kt=Ke(it,or,ui,Mn,jn,we),$n=!0),!Be&&$n&&(We&&(it.end=St+yt*kt),he.push(it),it=Jt(Ge)),We&&(St+=yt)}let rr=Ge.length-3;const pr=Ge[rr],Qe=Ge[rr+1],Kr=Ne===0?pr:Qe;Kr>=fe&&Kr<=we&&dr(it,pr,Qe,Ge[rr+2]),rr=it.length-3,Be&&rr>=3&&(it[rr]!==it[0]||it[rr+1]!==it[1])&&dr(it,it[0],it[1],it[2]),it.length&&he.push(it)}function Jt(Ge){const he=[];return he.size=Ge.size,he.start=Ge.start,he.end=Ge.end,he}function Tr(Ge,he,fe,we,Ne,Be){for(const We of Ge)Gt(We,he,fe,we,Ne,Be,!1)}function dr(Ge,he,fe,we){Ge.push(he,fe,we)}function $r(Ge,he,fe,we,Ne,Be){const We=(Be-he)/(we-he);return dr(Ge,Be,fe+(Ne-fe)*We,1),We}function ii(Ge,he,fe,we,Ne,Be){const We=(Be-fe)/(Ne-fe);return dr(Ge,he+(we-he)*We,Be,1),We}function Zi(Ge,he){const fe=[];for(let we=0;we<Ge.length;we++){const Ne=Ge[we],Be=Ne.type;let We;if(Be==="Point"||Be==="MultiPoint"||Be==="LineString")We=In(Ne.geometry,he);else if(Be==="MultiLineString"||Be==="Polygon"){We=[];for(const it of Ne.geometry)We.push(In(it,he))}else if(Be==="MultiPolygon"){We=[];for(const it of Ne.geometry){const Ke=[];for(const yt of it)Ke.push(In(yt,he));We.push(Ke)}}fe.push(xe(Ne.id,Be,We,Ne.tags))}return fe}function In(Ge,he){const fe=[];fe.size=Ge.size,Ge.start!==void 0&&(fe.start=Ge.start,fe.end=Ge.end);for(let we=0;we<Ge.length;we+=3)fe.push(Ge[we]+he,Ge[we+1],Ge[we+2]);return fe}function Li(Ge,he){if(Ge.transformed)return Ge;const fe=1<<Ge.z,we=Ge.x,Ne=Ge.y;for(const Be of Ge.features){const We=Be.geometry,it=Be.type;if(Be.geometry=[],it===1)for(let Ke=0;Ke<We.length;Ke+=2)Be.geometry.push(Oa(We[Ke],We[Ke+1],he,fe,we,Ne));else for(let Ke=0;Ke<We.length;Ke++){const yt=[];for(let kt=0;kt<We[Ke].length;kt+=2)yt.push(Oa(We[Ke][kt],We[Ke][kt+1],he,fe,we,Ne));Be.geometry.push(yt)}}return Ge.transformed=!0,Ge}function Oa(Ge,he,fe,we,Ne,Be){return[Math.round(fe*(Ge*we-Ne)),Math.round(fe*(he*we-Be))]}function Na(Ge,he,fe,we,Ne){const Be=he===Ne.maxZoom?0:Ne.tolerance/((1<<he)*Ne.extent),We={features:[],numPoints:0,numSimplified:0,numFeatures:Ge.length,source:null,x:fe,y:we,z:he,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0};for(const it of Ge)Ls(We,it,Be,Ne);return We}function Ls(Ge,he,fe,we){const Ne=he.geometry,Be=he.type,We=[];if(Ge.minX=Math.min(Ge.minX,he.minX),Ge.minY=Math.min(Ge.minY,he.minY),Ge.maxX=Math.max(Ge.maxX,he.maxX),Ge.maxY=Math.max(Ge.maxY,he.maxY),Be==="Point"||Be==="MultiPoint")for(let it=0;it<Ne.length;it+=3)We.push(Ne[it],Ne[it+1]),Ge.numPoints++,Ge.numSimplified++;else if(Be==="LineString")vo(We,Ne,Ge,fe,!1,!1);else if(Be==="MultiLineString"||Be==="Polygon")for(let it=0;it<Ne.length;it++)vo(We,Ne[it],Ge,fe,Be==="Polygon",it===0);else if(Be==="MultiPolygon")for(let it=0;it<Ne.length;it++){const Ke=Ne[it];for(let yt=0;yt<Ke.length;yt++)vo(We,Ke[yt],Ge,fe,!0,yt===0)}if(We.length){let it=he.tags||null;if(Be==="LineString"&&we.lineMetrics){it={};for(const yt in he.tags)it[yt]=he.tags[yt];it.mapbox_clip_start=Ne.start/Ne.size,it.mapbox_clip_end=Ne.end/Ne.size}const Ke={geometry:We,type:Be==="Polygon"||Be==="MultiPolygon"?3:Be==="LineString"||Be==="MultiLineString"?2:1,tags:it};he.id!==null&&(Ke.id=he.id),Ge.features.push(Ke)}}function vo(Ge,he,fe,we,Ne,Be){const We=we*we;if(we>0&&he.size<(Ne?We:we))return void(fe.numPoints+=he.length/3);const it=[];for(let Ke=0;Ke<he.length;Ke+=3)(we===0||he[Ke+2]>We)&&(fe.numSimplified++,it.push(he[Ke],he[Ke+1])),fe.numPoints++;Ne&&(function(Ke,yt){let kt=0;for(let St=0,rr=Ke.length,pr=rr-2;St<rr;pr=St,St+=2)kt+=(Ke[St]-Ke[pr])*(Ke[St+1]+Ke[pr+1]);if(kt>0===yt)for(let St=0,rr=Ke.length;St<rr/2;St+=2){const pr=Ke[St],Qe=Ke[St+1];Ke[St]=Ke[rr-2-St],Ke[St+1]=Ke[rr-1-St],Ke[rr-2-St]=pr,Ke[rr-1-St]=Qe}})(it,Be),Ge.push(it)}const ea={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0};class Zf{constructor(he,fe){const we=(fe=this.options=(function(Be,We){for(const it in We)Be[it]=We[it];return Be})(Object.create(ea),fe)).debug;if(we&&console.time("preprocess data"),fe.maxZoom<0||fe.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(fe.promoteId&&fe.generateId)throw new Error("promoteId and generateId cannot be used together.");let Ne=(function(Be,We){const it=[];if(Be.type==="FeatureCollection")for(let Ke=0;Ke<Be.features.length;Ke++)pt(it,Be.features[Ke],We,Ke);else pt(it,Be.type==="Feature"?Be:{geometry:Be},We);return it})(he,fe);this.tiles={},this.tileCoords=[],we&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",fe.indexMaxZoom,fe.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),Ne=(function(Be,We){const it=We.buffer/We.extent;let Ke=Be;const yt=zt(Be,1,-1-it,it,0,-1,2,We),kt=zt(Be,1,1-it,2+it,0,-1,2,We);return(yt||kt)&&(Ke=zt(Be,1,-it,1+it,0,-1,2,We)||[],yt&&(Ke=Zi(yt,1).concat(Ke)),kt&&(Ke=Ke.concat(Zi(kt,-1)))),Ke})(Ne,fe),Ne.length&&this.splitTile(Ne,0,0,0),we&&(Ne.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}splitTile(he,fe,we,Ne,Be,We,it){const Ke=[he,fe,we,Ne],yt=this.options,kt=yt.debug;for(;Ke.length;){Ne=Ke.pop(),we=Ke.pop(),fe=Ke.pop(),he=Ke.pop();const St=1<<fe,rr=Do(fe,we,Ne);let pr=this.tiles[rr];if(!pr&&(kt>1&&console.time("creation"),pr=this.tiles[rr]=Na(he,fe,we,Ne,yt),this.tileCoords.push({z:fe,x:we,y:Ne}),kt)){kt>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",fe,we,Ne,pr.numFeatures,pr.numPoints,pr.numSimplified),console.timeEnd("creation"));const $n=`z${fe}`;this.stats[$n]=(this.stats[$n]||0)+1,this.total++}if(pr.source=he,Be==null){if(fe===yt.indexMaxZoom||pr.numPoints<=yt.indexMaxPoints)continue}else{if(fe===yt.maxZoom||fe===Be)continue;if(Be!=null){const $n=Be-fe;if(we!==We>>$n||Ne!==it>>$n)continue}}if(pr.source=null,he.length===0)continue;kt>1&&console.time("clipping");const Qe=.5*yt.buffer/yt.extent,Kr=.5-Qe,pi=.5+Qe,or=1+Qe;let ui=null,zn=null,Mn=null,jn=null,fa=zt(he,St,we-Qe,we+pi,0,pr.minX,pr.maxX,yt),Vi=zt(he,St,we+Kr,we+or,0,pr.minX,pr.maxX,yt);he=null,fa&&(ui=zt(fa,St,Ne-Qe,Ne+pi,1,pr.minY,pr.maxY,yt),zn=zt(fa,St,Ne+Kr,Ne+or,1,pr.minY,pr.maxY,yt),fa=null),Vi&&(Mn=zt(Vi,St,Ne-Qe,Ne+pi,1,pr.minY,pr.maxY,yt),jn=zt(Vi,St,Ne+Kr,Ne+or,1,pr.minY,pr.maxY,yt),Vi=null),kt>1&&console.timeEnd("clipping"),Ke.push(ui||[],fe+1,2*we,2*Ne),Ke.push(zn||[],fe+1,2*we,2*Ne+1),Ke.push(Mn||[],fe+1,2*we+1,2*Ne),Ke.push(jn||[],fe+1,2*we+1,2*Ne+1)}}getTile(he,fe,we){he=+he,fe=+fe,we=+we;const Ne=this.options,{extent:Be,debug:We}=Ne;if(he<0||he>24)return null;const it=1<<he,Ke=Do(he,fe=fe+it&it-1,we);if(this.tiles[Ke])return Li(this.tiles[Ke],Be);We>1&&console.log("drilling down to z%d-%d-%d",he,fe,we);let yt,kt=he,St=fe,rr=we;for(;!yt&&kt>0;)kt--,St>>=1,rr>>=1,yt=this.tiles[Do(kt,St,rr)];return yt&&yt.source?(We>1&&(console.log("found parent tile z%d-%d-%d",kt,St,rr),console.time("drilling down")),this.splitTile(yt.source,kt,St,rr,he,fe,we),We>1&&console.timeEnd("drilling down"),this.tiles[Ke]?Li(this.tiles[Ke],Be):null):null}}function Do(Ge,he,fe){return 32*((1<<Ge)*fe+he)+Ge}class Ll extends p{constructor(){super(...arguments),this._dataUpdateable=new Map}loadVectorTile(he,fe){return s._(this,void 0,void 0,(function*(){const we=he.tileID.canonical;if(!this._geoJSONIndex)throw new Error("Unable to parse the data into a cluster or geojson");const Ne=this._geoJSONIndex.getTile(we.z,we.x,we.y);if(!Ne)return null;const Be=new O(Ne.features,{version:2,extent:s.$});let We=(function(it){const Ke=new s.cM;return(function(yt,kt){for(const St in yt.layers)kt.writeMessage(3,B,yt.layers[St])})(it,Ke),Ke.finish()})(Be);return We.byteOffset===0&&We.byteLength===We.buffer.byteLength||(We=new Uint8Array(We)),{vectorTile:Be,rawData:We.buffer}}))}loadData(he){return s._(this,void 0,void 0,(function*(){var fe;(fe=this._pendingRequest)===null||fe===void 0||fe.abort();const we=!!(he&&he.request&&he.request.collectResourceTiming)&&new s.cN(he.request);this._pendingRequest=new AbortController;try{this._pendingData=this.loadAndProcessGeoJSON(he,this._pendingRequest);const Ne=yield this._pendingData;this._geoJSONIndex=he.cluster?new ve((function({superclusterOptions:We,clusterProperties:it}){if(!it||!We)return We;const Ke={},yt={},kt={accumulated:null,zoom:0},St={properties:null},rr=Object.keys(it);for(const pr of rr){const[Qe,Kr]=it[pr],pi=s.cT(Kr),or=s.cT(typeof Qe=="string"?[Qe,["accumulated"],["get",pr]]:Qe);Ke[pr]=pi.value,yt[pr]=or.value}return We.map=pr=>{St.properties=pr;const Qe={};for(const Kr of rr)Qe[Kr]=Ke[Kr].evaluate(kt,St);return Qe},We.reduce=(pr,Qe)=>{St.properties=Qe;for(const Kr of rr)kt.accumulated=pr[Kr],pr[Kr]=yt[Kr].evaluate(kt,St)},We})(he)).load(Ne.features):(function(We,it){return new Zf(We,it)})(Ne,he.geojsonVtOptions),this.loaded={};const Be={data:Ne};if(we){const We=we.finish();We&&(Be.resourceTiming={},Be.resourceTiming[he.source]=JSON.parse(JSON.stringify(We)))}return Be}catch(Ne){if(delete this._pendingRequest,s.cy(Ne))return{abandoned:!0};throw Ne}}))}getData(){return s._(this,void 0,void 0,(function*(){return this._pendingData}))}reloadTile(he){const fe=this.loaded;return fe&&fe[he.uid]?super.reloadTile(he):this.loadTile(he)}loadAndProcessGeoJSON(he,fe){return s._(this,void 0,void 0,(function*(){let we=yield this.loadGeoJSON(he,fe);if(delete this._pendingRequest,typeof we!="object")throw new Error(`Input data given to '${he.source}' is not a valid GeoJSON object.`);if(E(we,!0),he.filter){const Ne=s.cT(he.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(Ne.result==="error")throw new Error(Ne.value.map((We=>`${We.key}: ${We.message}`)).join(", "));we={type:"FeatureCollection",features:we.features.filter((We=>Ne.value.evaluate({zoom:0},We)))}}return we}))}loadGeoJSON(he,fe){return s._(this,void 0,void 0,(function*(){const{promoteId:we}=he;if(he.request){const Ne=yield s.j(he.request,fe);return this._dataUpdateable=s.cV(Ne.data,we)?s.cU(Ne.data,we):void 0,Ne.data}if(typeof he.data=="string")try{const Ne=JSON.parse(he.data);return this._dataUpdateable=s.cV(Ne,we)?s.cU(Ne,we):void 0,Ne}catch{throw new Error(`Input data given to '${he.source}' is not a valid GeoJSON object.`)}if(!he.dataDiff)throw new Error(`Input data given to '${he.source}' is not a valid GeoJSON object.`);if(!this._dataUpdateable)throw new Error(`Cannot update existing geojson data in ${he.source}`);return s.cW(this._dataUpdateable,he.dataDiff,we),{type:"FeatureCollection",features:Array.from(this._dataUpdateable.values())}}))}removeSource(he){return s._(this,void 0,void 0,(function*(){this._pendingRequest&&this._pendingRequest.abort()}))}getClusterExpansionZoom(he){return this._geoJSONIndex.getClusterExpansionZoom(he.clusterId)}getClusterChildren(he){return this._geoJSONIndex.getChildren(he.clusterId)}getClusterLeaves(he){return this._geoJSONIndex.getLeaves(he.clusterId,he.limit,he.offset)}}class Ya{constructor(he){this.self=he,this.actor=new s.J(he),this.layerIndexes={},this.availableImages={},this.workerSources={},this.demWorkerSources={},this.externalWorkerSourceTypes={},this.globalStates=new Map,this.self.registerWorkerSource=(fe,we)=>{if(this.externalWorkerSourceTypes[fe])throw new Error(`Worker source with name "${fe}" already registered.`);this.externalWorkerSourceTypes[fe]=we},this.self.addProtocol=s.cA,this.self.removeProtocol=s.cB,this.self.registerRTLTextPlugin=fe=>{s.cX.setMethods(fe)},this.actor.registerMessageHandler("LDT",((fe,we)=>this._getDEMWorkerSource(fe,we.source).loadTile(we))),this.actor.registerMessageHandler("RDT",((fe,we)=>s._(this,void 0,void 0,(function*(){this._getDEMWorkerSource(fe,we.source).removeTile(we)})))),this.actor.registerMessageHandler("GCEZ",((fe,we)=>s._(this,void 0,void 0,(function*(){return this._getWorkerSource(fe,we.type,we.source).getClusterExpansionZoom(we)})))),this.actor.registerMessageHandler("GCC",((fe,we)=>s._(this,void 0,void 0,(function*(){return this._getWorkerSource(fe,we.type,we.source).getClusterChildren(we)})))),this.actor.registerMessageHandler("GCL",((fe,we)=>s._(this,void 0,void 0,(function*(){return this._getWorkerSource(fe,we.type,we.source).getClusterLeaves(we)})))),this.actor.registerMessageHandler("LD",((fe,we)=>this._getWorkerSource(fe,we.type,we.source).loadData(we))),this.actor.registerMessageHandler("GD",((fe,we)=>this._getWorkerSource(fe,we.type,we.source).getData())),this.actor.registerMessageHandler("LT",((fe,we)=>this._getWorkerSource(fe,we.type,we.source).loadTile(we))),this.actor.registerMessageHandler("RT",((fe,we)=>this._getWorkerSource(fe,we.type,we.source).reloadTile(we))),this.actor.registerMessageHandler("AT",((fe,we)=>this._getWorkerSource(fe,we.type,we.source).abortTile(we))),this.actor.registerMessageHandler("RMT",((fe,we)=>this._getWorkerSource(fe,we.type,we.source).removeTile(we))),this.actor.registerMessageHandler("RS",((fe,we)=>s._(this,void 0,void 0,(function*(){if(!this.workerSources[fe]||!this.workerSources[fe][we.type]||!this.workerSources[fe][we.type][we.source])return;const Ne=this.workerSources[fe][we.type][we.source];delete this.workerSources[fe][we.type][we.source],Ne.removeSource!==void 0&&Ne.removeSource(we)})))),this.actor.registerMessageHandler("RM",(fe=>s._(this,void 0,void 0,(function*(){delete this.layerIndexes[fe],delete this.availableImages[fe],delete this.workerSources[fe],delete this.demWorkerSources[fe],this.globalStates.delete(fe)})))),this.actor.registerMessageHandler("SR",((fe,we)=>s._(this,void 0,void 0,(function*(){this.referrer=we})))),this.actor.registerMessageHandler("SRPS",((fe,we)=>this._syncRTLPluginState(fe,we))),this.actor.registerMessageHandler("IS",((fe,we)=>s._(this,void 0,void 0,(function*(){this.self.importScripts(we)})))),this.actor.registerMessageHandler("SI",((fe,we)=>this._setImages(fe,we))),this.actor.registerMessageHandler("UL",((fe,we)=>s._(this,void 0,void 0,(function*(){this._getLayerIndex(fe).update(we.layers,we.removedIds,this._getGlobalState(fe))})))),this.actor.registerMessageHandler("UGS",((fe,we)=>s._(this,void 0,void 0,(function*(){const Ne=this._getGlobalState(fe);for(const Be in we)Ne[Be]=we[Be]})))),this.actor.registerMessageHandler("SL",((fe,we)=>s._(this,void 0,void 0,(function*(){this._getLayerIndex(fe).replace(we,this._getGlobalState(fe))}))))}_getGlobalState(he){let fe=this.globalStates.get(he);return fe||(fe={},this.globalStates.set(he,fe)),fe}_setImages(he,fe){return s._(this,void 0,void 0,(function*(){this.availableImages[he]=fe;for(const we in this.workerSources[he]){const Ne=this.workerSources[he][we];for(const Be in Ne)Ne[Be].availableImages=fe}}))}_syncRTLPluginState(he,fe){return s._(this,void 0,void 0,(function*(){return yield s.cX.syncState(fe,this.self.importScripts)}))}_getAvailableImages(he){let fe=this.availableImages[he];return fe||(fe=[]),fe}_getLayerIndex(he){let fe=this.layerIndexes[he];return fe||(fe=this.layerIndexes[he]=new o),fe}_getWorkerSource(he,fe,we){if(this.workerSources[he]||(this.workerSources[he]={}),this.workerSources[he][fe]||(this.workerSources[he][fe]={}),!this.workerSources[he][fe][we]){const Ne={sendAsync:(Be,We)=>(Be.targetMapId=he,this.actor.sendAsync(Be,We))};switch(fe){case"vector":this.workerSources[he][fe][we]=new p(Ne,this._getLayerIndex(he),this._getAvailableImages(he));break;case"geojson":this.workerSources[he][fe][we]=new Ll(Ne,this._getLayerIndex(he),this._getAvailableImages(he));break;default:this.workerSources[he][fe][we]=new this.externalWorkerSourceTypes[fe](Ne,this._getLayerIndex(he),this._getAvailableImages(he))}}return this.workerSources[he][fe][we]}_getDEMWorkerSource(he,fe){return this.demWorkerSources[he]||(this.demWorkerSources[he]={}),this.demWorkerSources[he][fe]||(this.demWorkerSources[he][fe]=new y),this.demWorkerSources[he][fe]}}return s.i(self)&&(self.worker=new Ya(self)),Ya})),n("index",["exports","./shared"],(function(s,o){var l="5.9.0";function c(){var I=new o.A(4);return o.A!=Float32Array&&(I[1]=0,I[2]=0),I[0]=1,I[3]=1,I}let f,p;const y={now:typeof performance<"u"&&performance&&performance.now?performance.now.bind(performance):Date.now.bind(Date),frame(I,u,m){const w=requestAnimationFrame((R=>{M(),u(R)})),{unsubscribe:M}=o.s(I.signal,"abort",(()=>{M(),cancelAnimationFrame(w),m(o.c())}),!1)},frameAsync(I){return new Promise(((u,m)=>{this.frame(I,u,m)}))},getImageData(I,u=0){return this.getImageCanvasContext(I).getImageData(-u,-u,I.width+2*u,I.height+2*u)},getImageCanvasContext(I){const u=window.document.createElement("canvas"),m=u.getContext("2d",{willReadFrequently:!0});if(!m)throw new Error("failed to create canvas 2d context");return u.width=I.width,u.height=I.height,m.drawImage(I,0,0,I.width,I.height),m},resolveURL:I=>(f||(f=document.createElement("a")),f.href=I,f.href),hardwareConcurrency:typeof navigator<"u"&&navigator.hardwareConcurrency||4,get prefersReducedMotion(){return!!matchMedia&&(p==null&&(p=matchMedia("(prefers-reduced-motion: reduce)")),p.matches)}};class b{static testProp(u){if(!b.docStyle)return u[0];for(let m=0;m<u.length;m++)if(u[m]in b.docStyle)return u[m];return u[0]}static create(u,m,w){const M=window.document.createElement(u);return m!==void 0&&(M.className=m),w&&w.appendChild(M),M}static createNS(u,m){return window.document.createElementNS(u,m)}static disableDrag(){b.docStyle&&b.selectProp&&(b.userSelect=b.docStyle[b.selectProp],b.docStyle[b.selectProp]="none")}static enableDrag(){b.docStyle&&b.selectProp&&(b.docStyle[b.selectProp]=b.userSelect)}static setTransform(u,m){u.style[b.transformProp]=m}static addEventListener(u,m,w,M={}){u.addEventListener(m,w,"passive"in M?M:M.capture)}static removeEventListener(u,m,w,M={}){u.removeEventListener(m,w,"passive"in M?M:M.capture)}static suppressClickInternal(u){u.preventDefault(),u.stopPropagation(),window.removeEventListener("click",b.suppressClickInternal,!0)}static suppressClick(){window.addEventListener("click",b.suppressClickInternal,!0),window.setTimeout((()=>{window.removeEventListener("click",b.suppressClickInternal,!0)}),0)}static getScale(u){const m=u.getBoundingClientRect();return{x:m.width/u.offsetWidth||1,y:m.height/u.offsetHeight||1,boundingClientRect:m}}static getPoint(u,m,w){const M=m.boundingClientRect;return new o.P((w.clientX-M.left)/m.x-u.clientLeft,(w.clientY-M.top)/m.y-u.clientTop)}static mousePos(u,m){const w=b.getScale(u);return b.getPoint(u,w,m)}static touchPos(u,m){const w=[],M=b.getScale(u);for(let R=0;R<m.length;R++)w.push(b.getPoint(u,M,m[R]));return w}static mouseButton(u){return u.button}static remove(u){u.parentNode&&u.parentNode.removeChild(u)}static sanitize(u){const m=new DOMParser().parseFromString(u,"text/html").body||document.createElement("body"),w=m.querySelectorAll("script");for(const M of w)M.remove();return b.clean(m),m.innerHTML}static isPossiblyDangerous(u,m){const w=m.replace(/\s+/g,"").toLowerCase();return!(!["src","href","xlink:href"].includes(u)||!w.includes("javascript:")&&!w.includes("data:"))||!!u.startsWith("on")||void 0}static clean(u){const m=u.children;for(const w of m)b.removeAttributes(w),b.clean(w)}static removeAttributes(u){for(const{name:m,value:w}of u.attributes)b.isPossiblyDangerous(m,w)&&u.removeAttribute(m)}}b.docStyle=typeof window<"u"&&window.document&&window.document.documentElement.style,b.selectProp=b.testProp(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]),b.transformProp=b.testProp(["transform","WebkitTransform"]);const S={supported:!1,testSupport:function(I){!P&&E&&(O?B(I):C=I)}};let C,E,P=!1,O=!1;function B(I){const u=I.createTexture();I.bindTexture(I.TEXTURE_2D,u);try{if(I.texImage2D(I.TEXTURE_2D,0,I.RGBA,I.RGBA,I.UNSIGNED_BYTE,E),I.isContextLost())return;S.supported=!0}catch{}I.deleteTexture(u),P=!0}var F;typeof document<"u"&&(E=document.createElement("img"),E.onload=()=>{C&&B(C),C=null,O=!0},E.onerror=()=>{P=!0,C=null},E.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA="),(function(I){let u,m,w,M;I.resetRequestQueue=()=>{u=[],m=0,w=0,M={}},I.addThrottleControl=j=>{const Y=w++;return M[Y]=j,Y},I.removeThrottleControl=j=>{delete M[j],N()},I.getImage=(j,Y,K=!0)=>new Promise(((ie,re)=>{S.supported&&(j.headers||(j.headers={}),j.headers.accept="image/webp,*/*"),o.e(j,{type:"image"}),u.push({abortController:Y,requestParameters:j,supportImageRefresh:K,state:"queued",onError:ue=>{re(ue)},onSuccess:ue=>{ie(ue)}}),N()}));const R=j=>o._(this,void 0,void 0,(function*(){j.state="running";const{requestParameters:Y,supportImageRefresh:K,onError:ie,onSuccess:re,abortController:ue}=j,pe=K===!1&&!o.i(self)&&!o.g(Y.url)&&(!Y.headers||Object.keys(Y.headers).reduce(((Ce,Ie)=>Ce&&Ie==="accept"),!0));m++;const Se=pe?H(Y,ue):o.m(Y,ue);try{const Ce=yield Se;delete j.abortController,j.state="completed",Ce.data instanceof HTMLImageElement||o.b(Ce.data)?re(Ce):Ce.data&&re({data:yield(Te=Ce.data,typeof createImageBitmap=="function"?o.f(Te):o.h(Te)),cacheControl:Ce.cacheControl,expires:Ce.expires})}catch(Ce){delete j.abortController,ie(Ce)}finally{m--,N()}var Te})),N=()=>{const j=(()=>{for(const Y of Object.keys(M))if(M[Y]())return!0;return!1})()?o.a.MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:o.a.MAX_PARALLEL_IMAGE_REQUESTS;for(let Y=m;Y<j&&u.length>0;Y++){const K=u.shift();K.abortController.signal.aborted?Y--:R(K)}},H=(j,Y)=>new Promise(((K,ie)=>{const re=new Image,ue=j.url,pe=j.credentials;pe&&pe==="include"?re.crossOrigin="use-credentials":(pe&&pe==="same-origin"||!o.d(ue))&&(re.crossOrigin="anonymous"),Y.signal.addEventListener("abort",(()=>{re.src="",ie(o.c())})),re.fetchPriority="high",re.onload=()=>{re.onerror=re.onload=null,K({data:re})},re.onerror=()=>{re.onerror=re.onload=null,Y.signal.aborted||ie(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))},re.src=ue}))})(F||(F={})),F.resetRequestQueue();class W{constructor(u){this._transformRequestFn=u??null}transformRequest(u,m){return this._transformRequestFn&&this._transformRequestFn(u,m)||{url:u}}setTransformRequest(u){this._transformRequestFn=u}}function $(I){const u=[];if(typeof I=="string")u.push({id:"default",url:I});else if(I&&I.length>0){const m=[];for(const{id:w,url:M}of I){const R=`${w}${M}`;m.indexOf(R)===-1&&(m.push(R),u.push({id:w,url:M}))}}return u}function q(I,u,m){try{const w=new URL(I);return w.pathname+=`${u}${m}`,w.toString()}catch{throw new Error(`Invalid sprite URL "${I}", must be absolute. Modify style specification directly or use TransformStyleFunction to correct the issue dynamically`)}}function Q(I){const{userImage:u}=I;return!!(u&&u.render&&u.render())&&(I.data.replace(new Uint8Array(u.data.buffer)),!0)}class ee extends o.E{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new o.R({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(u){if(this.loaded!==u&&(this.loaded=u,u)){for(const{ids:m,promiseResolve:w}of this.requestors)w(this._getImagesForIds(m));this.requestors=[]}}getImage(u){const m=this.images[u];if(m&&!m.data&&m.spriteData){const w=m.spriteData;m.data=new o.R({width:w.width,height:w.height},w.context.getImageData(w.x,w.y,w.width,w.height).data),m.spriteData=null}return m}addImage(u,m){if(this.images[u])throw new Error(`Image id ${u} already exist, use updateImage instead`);this._validate(u,m)&&(this.images[u]=m)}_validate(u,m){let w=!0;const M=m.data||m.spriteData;return this._validateStretch(m.stretchX,M&&M.width)||(this.fire(new o.k(new Error(`Image "${u}" has invalid "stretchX" value`))),w=!1),this._validateStretch(m.stretchY,M&&M.height)||(this.fire(new o.k(new Error(`Image "${u}" has invalid "stretchY" value`))),w=!1),this._validateContent(m.content,m)||(this.fire(new o.k(new Error(`Image "${u}" has invalid "content" value`))),w=!1),w}_validateStretch(u,m){if(!u)return!0;let w=0;for(const M of u){if(M[0]<w||M[1]<M[0]||m<M[1])return!1;w=M[1]}return!0}_validateContent(u,m){if(!u)return!0;if(u.length!==4)return!1;const w=m.spriteData,M=w&&w.width||m.data.width,R=w&&w.height||m.data.height;return!(u[0]<0||M<u[0]||u[1]<0||R<u[1]||u[2]<0||M<u[2]||u[3]<0||R<u[3]||u[2]<u[0]||u[3]<u[1])}updateImage(u,m,w=!0){const M=this.getImage(u);if(w&&(M.data.width!==m.data.width||M.data.height!==m.data.height))throw new Error(`size mismatch between old image (${M.data.width}x${M.data.height}) and new image (${m.data.width}x${m.data.height}).`);m.version=M.version+1,this.images[u]=m,this.updatedImages[u]=!0}removeImage(u){const m=this.images[u];delete this.images[u],delete this.patterns[u],m.userImage&&m.userImage.onRemove&&m.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(u){return new Promise(((m,w)=>{let M=!0;if(!this.isLoaded())for(const R of u)this.images[R]||(M=!1);this.isLoaded()||M?m(this._getImagesForIds(u)):this.requestors.push({ids:u,promiseResolve:m})}))}_getImagesForIds(u){const m={};for(const w of u){let M=this.getImage(w);M||(this.fire(new o.l("styleimagemissing",{id:w})),M=this.getImage(w)),M?m[w]={data:M.data.clone(),pixelRatio:M.pixelRatio,sdf:M.sdf,version:M.version,stretchX:M.stretchX,stretchY:M.stretchY,content:M.content,textFitWidth:M.textFitWidth,textFitHeight:M.textFitHeight,hasRenderCallback:!!(M.userImage&&M.userImage.render)}:o.w(`Image "${w}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}return m}getPixelSize(){const{width:u,height:m}=this.atlasImage;return{width:u,height:m}}getPattern(u){const m=this.patterns[u],w=this.getImage(u);if(!w)return null;if(m&&m.position.version===w.version)return m.position;if(m)m.position.version=w.version;else{const M={w:w.data.width+2,h:w.data.height+2,x:0,y:0},R=new o.I(M,w);this.patterns[u]={bin:M,position:R}}return this._updatePatternAtlas(),this.patterns[u].position}bind(u){const m=u.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new o.T(u,this.atlasImage,m.RGBA),this.atlasTexture.bind(m.LINEAR,m.CLAMP_TO_EDGE)}_updatePatternAtlas(){const u=[];for(const R in this.patterns)u.push(this.patterns[R].bin);const{w:m,h:w}=o.p(u),M=this.atlasImage;M.resize({width:m||1,height:w||1});for(const R in this.patterns){const{bin:N}=this.patterns[R],H=N.x+1,j=N.y+1,Y=this.getImage(R).data,K=Y.width,ie=Y.height;o.R.copy(Y,M,{x:0,y:0},{x:H,y:j},{width:K,height:ie}),o.R.copy(Y,M,{x:0,y:ie-1},{x:H,y:j-1},{width:K,height:1}),o.R.copy(Y,M,{x:0,y:0},{x:H,y:j+ie},{width:K,height:1}),o.R.copy(Y,M,{x:K-1,y:0},{x:H-1,y:j},{width:1,height:ie}),o.R.copy(Y,M,{x:0,y:0},{x:H+K,y:j},{width:1,height:ie})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(u){for(const m of u){if(this.callbackDispatchedThisFrame[m])continue;this.callbackDispatchedThisFrame[m]=!0;const w=this.getImage(m);w||o.w(`Image with ID: "${m}" was not found`),Q(w)&&this.updateImage(m,w)}}}const te=1e20;function ae(I,u,m,w,M,R,N,H,j){for(let Y=u;Y<u+w;Y++)de(I,m*R+Y,R,M,N,H,j);for(let Y=m;Y<m+M;Y++)de(I,Y*R+u,1,w,N,H,j)}function de(I,u,m,w,M,R,N){R[0]=0,N[0]=-te,N[1]=te,M[0]=I[u];for(let H=1,j=0,Y=0;H<w;H++){M[H]=I[u+H*m];const K=H*H;do{const ie=R[j];Y=(M[H]-M[ie]+K-ie*ie)/(H-ie)/2}while(Y<=N[j]&&--j>-1);j++,R[j]=H,N[j]=Y,N[j+1]=te}for(let H=0,j=0;H<w;H++){for(;N[j+1]<H;)j++;const Y=R[j],K=H-Y;I[u+H*m]=M[Y]+K*K}}class ve{constructor(u,m,w){this.requestManager=u,this.localIdeographFontFamily=m,this.entries={},this.lang=w}setURL(u){this.url=u}getGlyphs(u){return o._(this,void 0,void 0,(function*(){const m=[];for(const R in u)for(const N of u[R])m.push(this._getAndCacheGlyphsPromise(R,N));const w=yield Promise.all(m),M={};for(const{stack:R,id:N,glyph:H}of w)M[R]||(M[R]={}),M[R][N]=H&&{id:H.id,bitmap:H.bitmap.clone(),metrics:H.metrics};return M}))}_getAndCacheGlyphsPromise(u,m){return o._(this,void 0,void 0,(function*(){let w=this.entries[u];w||(w=this.entries[u]={glyphs:{},requests:{},ranges:{}});let M=w.glyphs[m];if(M!==void 0)return{stack:u,id:m,glyph:M};if(M=this._tinySDF(w,u,m),M)return w.glyphs[m]=M,{stack:u,id:m,glyph:M};const R=Math.floor(m/256);if(256*R>65535)throw new Error("glyphs > 65535 not supported");if(w.ranges[R])return{stack:u,id:m,glyph:M};if(!this.url)throw new Error("glyphsUrl is not set");if(!w.requests[R]){const H=ve.loadGlyphRange(u,R,this.url,this.requestManager);w.requests[R]=H}const N=yield w.requests[R];for(const H in N)this._doesCharSupportLocalGlyph(+H)||(w.glyphs[+H]=N[+H]);return w.ranges[R]=!0,{stack:u,id:m,glyph:N[m]||null}}))}_doesCharSupportLocalGlyph(u){return!!this.localIdeographFontFamily&&(new RegExp("\\p{Ideo}|\\p{sc=Hang}|\\p{sc=Hira}|\\p{sc=Kana}","u").test(String.fromCodePoint(u))||o.u["CJK Unified Ideographs"](u)||o.u["Hangul Syllables"](u)||o.u.Hiragana(u)||o.u.Katakana(u)||o.u["CJK Symbols and Punctuation"](u)||o.u["Halfwidth and Fullwidth Forms"](u))}_tinySDF(u,m,w){const M=this.localIdeographFontFamily;if(!M||!this._doesCharSupportLocalGlyph(w))return;let R=u.tinySDF;if(!R){let H="400";/bold/i.test(m)?H="900":/medium/i.test(m)?H="500":/light/i.test(m)&&(H="200"),R=u.tinySDF=new ve.TinySDF({fontSize:48,buffer:6,radius:16,cutoff:.25,lang:this.lang,fontFamily:M,fontWeight:H})}const N=R.draw(String.fromCharCode(w));return{id:w,bitmap:new o.q({width:N.width||60,height:N.height||60},N.data),metrics:{width:N.glyphWidth/2||24,height:N.glyphHeight/2||24,left:N.glyphLeft/2+.5||0,top:N.glyphTop/2-27.5||-8,advance:N.glyphAdvance/2||24,isDoubleResolution:!0}}}}ve.loadGlyphRange=function(I,u,m,w){return o._(this,void 0,void 0,(function*(){const M=256*u,R=M+255,N=w.transformRequest(m.replace("{fontstack}",I).replace("{range}",`${M}-${R}`),"Glyphs"),H=yield o.n(N,new AbortController);if(!H||!H.data)throw new Error(`Could not load glyph range. range: ${u}, ${M}-${R}`);const j={};for(const Y of o.o(H.data))j[Y.id]=Y;return j}))},ve.TinySDF=class{constructor({fontSize:I=24,buffer:u=3,radius:m=8,cutoff:w=.25,fontFamily:M="sans-serif",fontWeight:R="normal",fontStyle:N="normal",lang:H=null}={}){this.buffer=u,this.cutoff=w,this.radius=m,this.lang=H;const j=this.size=I+4*u,Y=this._createCanvas(j),K=this.ctx=Y.getContext("2d",{willReadFrequently:!0});K.font=`${N} ${R} ${I}px ${M}`,K.textBaseline="alphabetic",K.textAlign="left",K.fillStyle="black",this.gridOuter=new Float64Array(j*j),this.gridInner=new Float64Array(j*j),this.f=new Float64Array(j),this.z=new Float64Array(j+1),this.v=new Uint16Array(j)}_createCanvas(I){const u=document.createElement("canvas");return u.width=u.height=I,u}draw(I){const{width:u,actualBoundingBoxAscent:m,actualBoundingBoxDescent:w,actualBoundingBoxLeft:M,actualBoundingBoxRight:R}=this.ctx.measureText(I),N=Math.ceil(m),H=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(R-M))),j=Math.min(this.size-this.buffer,N+Math.ceil(w)),Y=H+2*this.buffer,K=j+2*this.buffer,ie=Math.max(Y*K,0),re=new Uint8ClampedArray(ie),ue={data:re,width:Y,height:K,glyphWidth:H,glyphHeight:j,glyphTop:N,glyphLeft:0,glyphAdvance:u};if(H===0||j===0)return ue;const{ctx:pe,buffer:Se,gridInner:Te,gridOuter:Ce}=this;this.lang&&(pe.lang=this.lang),pe.clearRect(Se,Se,H,j),pe.fillText(I,Se,Se+N);const Ie=pe.getImageData(Se,Se,H,j);Ce.fill(te,0,ie),Te.fill(0,0,ie);for(let ke=0;ke<j;ke++)for(let Re=0;Re<H;Re++){const ze=Ie.data[4*(ke*H+Re)+3]/255;if(ze===0)continue;const He=(ke+Se)*Y+Re+Se;if(ze===1)Ce[He]=0,Te[He]=te;else{const Le=.5-ze;Ce[He]=Le>0?Le*Le:0,Te[He]=Le<0?Le*Le:0}}ae(Ce,0,0,Y,K,Y,this.f,this.v,this.z),ae(Te,Se,Se,H,j,Y,this.f,this.v,this.z);for(let ke=0;ke<ie;ke++){const Re=Math.sqrt(Ce[ke])-Math.sqrt(Te[ke]);re[ke]=Math.round(255-255*(Re/this.radius+this.cutoff))}return ue}};class ye{constructor(){this.specification=o.v.light.position}possiblyEvaluate(u,m){return o.B(u.expression.evaluate(m))}interpolate(u,m,w){return{x:o.C.number(u.x,m.x,w),y:o.C.number(u.y,m.y,w),z:o.C.number(u.z,m.z,w)}}}let Ae;class me extends o.E{constructor(u){super(),Ae=Ae||new o.r({anchor:new o.D(o.v.light.anchor),position:new ye,color:new o.D(o.v.light.color),intensity:new o.D(o.v.light.intensity)}),this._transitionable=new o.t(Ae,void 0),this.setLight(u),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(u,m={}){if(!this._validate(o.x,u,m))for(const w in u){const M=u[w];w.endsWith("-transition")?this._transitionable.setTransition(w.slice(0,-11),M):this._transitionable.setValue(w,M)}}updateTransitions(u){this._transitioning=this._transitionable.transitioned(u,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(u){this.properties=this._transitioning.possiblyEvaluate(u)}_validate(u,m,w){return(!w||w.validate!==!1)&&o.y(this,u.call(o.z,{value:m,style:{glyphs:!0,sprite:!0},styleSpec:o.v}))}}const De=new o.r({"sky-color":new o.D(o.v.sky["sky-color"]),"horizon-color":new o.D(o.v.sky["horizon-color"]),"fog-color":new o.D(o.v.sky["fog-color"]),"fog-ground-blend":new o.D(o.v.sky["fog-ground-blend"]),"horizon-fog-blend":new o.D(o.v.sky["horizon-fog-blend"]),"sky-horizon-blend":new o.D(o.v.sky["sky-horizon-blend"]),"atmosphere-blend":new o.D(o.v.sky["atmosphere-blend"])});class Fe extends o.E{constructor(u){super(),this._transitionable=new o.t(De,void 0),this.setSky(u),this._transitioning=this._transitionable.untransitioned(),this.recalculate(new o.F(0))}setSky(u,m={}){if(!this._validate(o.G,u,m)){u||(u={"sky-color":"transparent","horizon-color":"transparent","fog-color":"transparent","fog-ground-blend":1,"atmosphere-blend":0});for(const w in u){const M=u[w];w.endsWith("-transition")?this._transitionable.setTransition(w.slice(0,-11),M):this._transitionable.setValue(w,M)}}}getSky(){return this._transitionable.serialize()}updateTransitions(u){this._transitioning=this._transitionable.transitioned(u,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(u){this.properties=this._transitioning.possiblyEvaluate(u)}_validate(u,m,w={}){return w?.validate!==!1&&o.y(this,u.call(o.z,o.e({value:m,style:{glyphs:!0,sprite:!0},styleSpec:o.v})))}calculateFogBlendOpacity(u){return u<60?0:u<70?(u-60)/10:1}}class je{constructor(u,m){this.width=u,this.height=m,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}}getDash(u,m){const w=u.join(",")+String(m);return this.dashEntry[w]||(this.dashEntry[w]=this.addDash(u,m)),this.dashEntry[w]}getDashRanges(u,m,w){const M=[];let R=u.length%2==1?-u[u.length-1]*w:0,N=u[0]*w,H=!0;M.push({left:R,right:N,isDash:H,zeroLength:u[0]===0});let j=u[0];for(let Y=1;Y<u.length;Y++){H=!H;const K=u[Y];R=j*w,j+=K,N=j*w,M.push({left:R,right:N,isDash:H,zeroLength:K===0})}return M}addRoundDash(u,m,w){const M=m/2;for(let R=-w;R<=w;R++){const N=this.width*(this.nextRow+w+R);let H=0,j=u[H];for(let Y=0;Y<this.width;Y++){Y/j.right>1&&(j=u[++H]);const K=Math.abs(Y-j.left),ie=Math.abs(Y-j.right),re=Math.min(K,ie);let ue;const pe=R/w*(M+1);if(j.isDash){const Se=M-Math.abs(pe);ue=Math.sqrt(re*re+Se*Se)}else ue=M-Math.sqrt(re*re+pe*pe);this.data[N+Y]=Math.max(0,Math.min(255,ue+128))}}}addRegularDash(u){for(let H=u.length-1;H>=0;--H){const j=u[H],Y=u[H+1];j.zeroLength?u.splice(H,1):Y&&Y.isDash===j.isDash&&(Y.left=j.left,u.splice(H,1))}const m=u[0],w=u[u.length-1];m.isDash===w.isDash&&(m.left=w.left-this.width,w.right=m.right+this.width);const M=this.width*this.nextRow;let R=0,N=u[R];for(let H=0;H<this.width;H++){H/N.right>1&&(N=u[++R]);const j=Math.abs(H-N.left),Y=Math.abs(H-N.right),K=Math.min(j,Y);this.data[M+H]=Math.max(0,Math.min(255,(N.isDash?K:-K)+128))}}addDash(u,m){const w=m?7:0,M=2*w+1;if(this.nextRow+M>this.height)return o.w("LineAtlas out of space"),null;let R=0;for(let H=0;H<u.length;H++)R+=u[H];if(R!==0){const H=this.width/R,j=this.getDashRanges(u,this.width,H);m?this.addRoundDash(j,H,w):this.addRegularDash(j)}const N={y:this.nextRow+w,height:2*w,width:R};return this.nextRow+=M,this.dirty=!0,N}bind(u){const m=u.gl;this.texture?(m.bindTexture(m.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,m.texSubImage2D(m.TEXTURE_2D,0,0,0,this.width,this.height,m.ALPHA,m.UNSIGNED_BYTE,this.data))):(this.texture=m.createTexture(),m.bindTexture(m.TEXTURE_2D,this.texture),m.texParameteri(m.TEXTURE_2D,m.TEXTURE_WRAP_S,m.REPEAT),m.texParameteri(m.TEXTURE_2D,m.TEXTURE_WRAP_T,m.REPEAT),m.texParameteri(m.TEXTURE_2D,m.TEXTURE_MIN_FILTER,m.LINEAR),m.texParameteri(m.TEXTURE_2D,m.TEXTURE_MAG_FILTER,m.LINEAR),m.texImage2D(m.TEXTURE_2D,0,m.ALPHA,this.width,this.height,0,m.ALPHA,m.UNSIGNED_BYTE,this.data))}}const ct="maplibre_preloaded_worker_pool";class xe{constructor(){this.active={}}acquire(u){if(!this.workers)for(this.workers=[];this.workers.length<xe.workerCount;)this.workers.push(new Worker(o.a.WORKER_URL));return this.active[u]=!0,this.workers.slice()}release(u){delete this.active[u],this.numActive()===0&&(this.workers.forEach((m=>{m.terminate()})),this.workers=null)}isPreloaded(){return!!this.active[ct]}numActive(){return Object.keys(this.active).length}}const $e=Math.floor(y.hardwareConcurrency/2);let pt,_t;function Dt(){return pt||(pt=new xe),pt}xe.workerCount=o.H(globalThis)?Math.max(Math.min($e,3),1):1;class qt{constructor(u,m){this.workerPool=u,this.actors=[],this.currentActor=0,this.id=m;const w=this.workerPool.acquire(m);for(let M=0;M<w.length;M++){const R=new o.J(w[M],m);R.name=`Worker ${M}`,this.actors.push(R)}if(!this.actors.length)throw new Error("No actors found")}broadcast(u,m){const w=[];for(const M of this.actors)w.push(M.sendAsync({type:u,data:m}));return Promise.all(w)}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(u=!0){this.actors.forEach((m=>{m.remove()})),this.actors=[],u&&this.workerPool.release(this.id)}registerMessageHandler(u,m){for(const w of this.actors)w.registerMessageHandler(u,m)}}function _r(){return _t||(_t=new qt(Dt(),o.K),_t.registerMessageHandler("GR",((I,u,m)=>o.m(u,m)))),_t}function Kt(I,u){const m=o.L();return o.M(m,m,[1,1,0]),o.N(m,m,[.5*I.width,.5*I.height,1]),I.calculatePosMatrix?o.O(m,m,I.calculatePosMatrix(u.toUnwrapped())):m}function zt(I,u,m,w,M,R,N){var H;const j=(function(re,ue,pe){if(re)for(const Se of re){const Te=ue[Se];if(Te&&Te.source===pe&&Te.type==="fill-extrusion")return!0}else for(const Se in ue){const Te=ue[Se];if(Te.source===pe&&Te.type==="fill-extrusion")return!0}return!1})((H=M?.layers)!==null&&H!==void 0?H:null,u,I.id),Y=R.maxPitchScaleFactor(),K=I.tilesIn(w,Y,j);K.sort(yr);const ie=[];for(const re of K)ie.push({wrappedTileID:re.tileID.wrapped().key,queryResults:re.tile.queryRenderedFeatures(u,m,I._state,re.queryGeometry,re.cameraQueryGeometry,re.scale,M,R,Y,Kt(I.transform,re.tileID),N?(ue,pe)=>N(re.tileID,ue,pe):void 0)});return(function(re,ue){for(const pe in re)for(const Se of re[pe])Gt(Se,ue);return re})((function(re){const ue={},pe={};for(const Se of re){const Te=Se.queryResults,Ce=Se.wrappedTileID,Ie=pe[Ce]=pe[Ce]||{};for(const ke in Te){const Re=Te[ke],ze=Ie[ke]=Ie[ke]||{},He=ue[ke]=ue[ke]||[];for(const Le of Re)ze[Le.featureIndex]||(ze[Le.featureIndex]=!0,He.push(Le))}}return ue})(ie),I)}function yr(I,u){const m=I.tileID,w=u.tileID;return m.overscaledZ-w.overscaledZ||m.canonical.y-w.canonical.y||m.wrap-w.wrap||m.canonical.x-w.canonical.x}function Gt(I,u){const m=I.feature,w=u.getFeatureState(m.layer["source-layer"],m.id);m.source=m.layer.source,m.layer["source-layer"]&&(m.sourceLayer=m.layer["source-layer"]),m.state=w}function Jt(I,u,m){return o._(this,void 0,void 0,(function*(){let w=I;if(I.url?w=(yield o.j(u.transformRequest(I.url,"Source"),m)).data:yield y.frameAsync(m),!w)return null;const M=o.Q(o.e(w,I),["tiles","minzoom","maxzoom","attribution","bounds","scheme","tileSize","encoding"]);return"vector_layers"in w&&w.vector_layers&&(M.vectorLayerIds=w.vector_layers.map((R=>R.id))),M}))}class Tr{constructor(u,m){u&&(m?this.setSouthWest(u).setNorthEast(m):Array.isArray(u)&&(u.length===4?this.setSouthWest([u[0],u[1]]).setNorthEast([u[2],u[3]]):this.setSouthWest(u[0]).setNorthEast(u[1])))}setNorthEast(u){return this._ne=u instanceof o.S?new o.S(u.lng,u.lat):o.S.convert(u),this}setSouthWest(u){return this._sw=u instanceof o.S?new o.S(u.lng,u.lat):o.S.convert(u),this}extend(u){const m=this._sw,w=this._ne;let M,R;if(u instanceof o.S)M=u,R=u;else{if(!(u instanceof Tr))return Array.isArray(u)?u.length===4||u.every(Array.isArray)?this.extend(Tr.convert(u)):this.extend(o.S.convert(u)):u&&("lng"in u||"lon"in u)&&"lat"in u?this.extend(o.S.convert(u)):this;if(M=u._sw,R=u._ne,!M||!R)return this}return m||w?(m.lng=Math.min(M.lng,m.lng),m.lat=Math.min(M.lat,m.lat),w.lng=Math.max(R.lng,w.lng),w.lat=Math.max(R.lat,w.lat)):(this._sw=new o.S(M.lng,M.lat),this._ne=new o.S(R.lng,R.lat)),this}getCenter(){return new o.S((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new o.S(this.getWest(),this.getNorth())}getSouthEast(){return new o.S(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(u){const{lng:m,lat:w}=o.S.convert(u);let M=this._sw.lng<=m&&m<=this._ne.lng;return this._sw.lng>this._ne.lng&&(M=this._sw.lng>=m&&m>=this._ne.lng),this._sw.lat<=w&&w<=this._ne.lat&&M}static convert(u){return u instanceof Tr?u:u&&new Tr(u)}static fromLngLat(u,m=0){const w=360*m/40075017,M=w/Math.cos(Math.PI/180*u.lat);return new Tr(new o.S(u.lng-M,u.lat-w),new o.S(u.lng+M,u.lat+w))}adjustAntiMeridian(){const u=new o.S(this._sw.lng,this._sw.lat),m=new o.S(this._ne.lng,this._ne.lat);return new Tr(u,u.lng>m.lng?new o.S(m.lng+360,m.lat):m)}}class dr{constructor(u,m,w){this.bounds=Tr.convert(this.validateBounds(u)),this.minzoom=m||0,this.maxzoom=w||24}validateBounds(u){return Array.isArray(u)&&u.length===4?[Math.max(-180,u[0]),Math.max(-90,u[1]),Math.min(180,u[2]),Math.min(90,u[3])]:[-180,-90,180,90]}contains(u){const m=Math.pow(2,u.z),w=Math.floor(o.V(this.bounds.getWest())*m),M=Math.floor(o.U(this.bounds.getNorth())*m),R=Math.ceil(o.V(this.bounds.getEast())*m),N=Math.ceil(o.U(this.bounds.getSouth())*m);return u.x>=w&&u.x<R&&u.y>=M&&u.y<N}}class $r extends o.E{constructor(u,m,w,M){if(super(),this.id=u,this.dispatcher=w,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,o.e(this,o.Q(m,["url","scheme","tileSize","promoteId"])),this._options=o.e({type:"vector"},m),this._collectResourceTiming=m.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(M)}load(){return o._(this,void 0,void 0,(function*(){this._loaded=!1,this.fire(new o.l("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const u=yield Jt(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,this.map.style.sourceCaches[this.id].clearTiles(),u&&(o.e(this,u),u.bounds&&(this.tileBounds=new dr(u.bounds,this.minzoom,this.maxzoom)),this.fire(new o.l("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new o.l("data",{dataType:"source",sourceDataType:"content"})))}catch(u){this._tileJSONRequest=null,this._loaded=!0,this.fire(new o.k(u))}}))}loaded(){return this._loaded}hasTile(u){return!this.tileBounds||this.tileBounds.contains(u.canonical)}onAdd(u){this.map=u,this.load()}setSourceProperty(u){this._tileJSONRequest&&this._tileJSONRequest.abort(),u(),this.load()}setTiles(u){return this.setSourceProperty((()=>{this._options.tiles=u})),this}setUrl(u){return this.setSourceProperty((()=>{this.url=u,this._options.url=u})),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}serialize(){return o.e({},this._options)}loadTile(u){return o._(this,void 0,void 0,(function*(){const m=u.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),w={request:this.map._requestManager.transformRequest(m,"Tile"),uid:u.uid,tileID:u.tileID,zoom:u.tileID.overscaledZ,tileSize:this.tileSize*u.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,subdivisionGranularity:this.map.style.projection.subdivisionGranularity};w.request.collectResourceTiming=this._collectResourceTiming;let M="RT";if(u.actor&&u.state!=="expired"){if(u.state==="loading")return new Promise(((R,N)=>{u.reloadPromise={resolve:R,reject:N}}))}else u.actor=this.dispatcher.getActor(),M="LT";u.abortController=new AbortController;try{const R=yield u.actor.sendAsync({type:M,data:w},u.abortController);if(delete u.abortController,u.aborted)return;this._afterTileLoadWorkerResponse(u,R)}catch(R){if(delete u.abortController,u.aborted)return;if(R&&R.status!==404)throw R;this._afterTileLoadWorkerResponse(u,null)}}))}_afterTileLoadWorkerResponse(u,m){if(m&&m.resourceTiming&&(u.resourceTiming=m.resourceTiming),m&&this.map._refreshExpiredTiles&&u.setExpiryData(m),u.loadVectorData(m,this.map.painter),u.reloadPromise){const w=u.reloadPromise;u.reloadPromise=null,this.loadTile(u).then(w.resolve).catch(w.reject)}}abortTile(u){return o._(this,void 0,void 0,(function*(){u.abortController&&(u.abortController.abort(),delete u.abortController),u.actor&&(yield u.actor.sendAsync({type:"AT",data:{uid:u.uid,type:this.type,source:this.id}}))}))}unloadTile(u){return o._(this,void 0,void 0,(function*(){u.unloadVectorData(),u.actor&&(yield u.actor.sendAsync({type:"RMT",data:{uid:u.uid,type:this.type,source:this.id}}))}))}hasTransition(){return!1}}class ii extends o.E{constructor(u,m,w,M){super(),this.id=u,this.dispatcher=w,this.setEventedParent(M),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=o.e({type:"raster"},m),o.e(this,o.Q(m,["url","scheme","tileSize"]))}load(){return o._(this,arguments,void 0,(function*(u=!1){this._loaded=!1,this.fire(new o.l("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const m=yield Jt(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,m&&(o.e(this,m),m.bounds&&(this.tileBounds=new dr(m.bounds,this.minzoom,this.maxzoom)),this.fire(new o.l("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new o.l("data",{dataType:"source",sourceDataType:"content",sourceDataChanged:u})))}catch(m){this._tileJSONRequest=null,this._loaded=!0,this.fire(new o.k(m))}}))}loaded(){return this._loaded}onAdd(u){this.map=u,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}setSourceProperty(u){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null),u(),this.load(!0)}setTiles(u){return this.setSourceProperty((()=>{this._options.tiles=u})),this}setUrl(u){return this.setSourceProperty((()=>{this.url=u,this._options.url=u})),this}serialize(){return o.e({},this._options)}hasTile(u){return!this.tileBounds||this.tileBounds.contains(u.canonical)}loadTile(u){return o._(this,void 0,void 0,(function*(){const m=u.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);u.abortController=new AbortController;try{const w=yield F.getImage(this.map._requestManager.transformRequest(m,"Tile"),u.abortController,this.map._refreshExpiredTiles);if(delete u.abortController,u.aborted)return void(u.state="unloaded");if(w&&w.data){this.map._refreshExpiredTiles&&(w.cacheControl||w.expires)&&u.setExpiryData({cacheControl:w.cacheControl,expires:w.expires});const M=this.map.painter.context,R=M.gl,N=w.data;u.texture=this.map.painter.getTileTexture(N.width),u.texture?u.texture.update(N,{useMipmap:!0}):(u.texture=new o.T(M,N,R.RGBA,{useMipmap:!0}),u.texture.bind(R.LINEAR,R.CLAMP_TO_EDGE,R.LINEAR_MIPMAP_NEAREST)),u.state="loaded"}}catch(w){if(delete u.abortController,u.aborted)u.state="unloaded";else if(w)throw u.state="errored",w}}))}abortTile(u){return o._(this,void 0,void 0,(function*(){u.abortController&&(u.abortController.abort(),delete u.abortController)}))}unloadTile(u){return o._(this,void 0,void 0,(function*(){u.texture&&this.map.painter.saveTileTexture(u.texture)}))}hasTransition(){return!1}}class Zi extends ii{constructor(u,m,w,M){super(u,m,w,M),this.type="raster-dem",this.maxzoom=22,this._options=o.e({type:"raster-dem"},m),this.encoding=m.encoding||"mapbox",this.redFactor=m.redFactor,this.greenFactor=m.greenFactor,this.blueFactor=m.blueFactor,this.baseShift=m.baseShift}loadTile(u){return o._(this,void 0,void 0,(function*(){const m=u.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),w=this.map._requestManager.transformRequest(m,"Tile");u.neighboringTiles=this._getNeighboringTiles(u.tileID),u.abortController=new AbortController;try{const M=yield F.getImage(w,u.abortController,this.map._refreshExpiredTiles);if(delete u.abortController,u.aborted)return void(u.state="unloaded");if(M&&M.data){const R=M.data;this.map._refreshExpiredTiles&&(M.cacheControl||M.expires)&&u.setExpiryData({cacheControl:M.cacheControl,expires:M.expires});const N=o.b(R)&&o.W()?R:yield this.readImageNow(R),H={type:this.type,uid:u.uid,source:this.id,rawImageData:N,encoding:this.encoding,redFactor:this.redFactor,greenFactor:this.greenFactor,blueFactor:this.blueFactor,baseShift:this.baseShift};if(!u.actor||u.state==="expired"){u.actor=this.dispatcher.getActor();const j=yield u.actor.sendAsync({type:"LDT",data:H});u.dem=j,u.needsHillshadePrepare=!0,u.needsTerrainPrepare=!0,u.state="loaded"}}}catch(M){if(delete u.abortController,u.aborted)u.state="unloaded";else if(M)throw u.state="errored",M}}))}readImageNow(u){return o._(this,void 0,void 0,(function*(){if(typeof VideoFrame<"u"&&o.X()){const m=u.width+2,w=u.height+2;try{return new o.R({width:m,height:w},yield o.Y(u,-1,-1,m,w))}catch{}}return y.getImageData(u,1)}))}_getNeighboringTiles(u){const m=u.canonical,w=Math.pow(2,m.z),M=(m.x-1+w)%w,R=m.x===0?u.wrap-1:u.wrap,N=(m.x+1+w)%w,H=m.x+1===w?u.wrap+1:u.wrap,j={};return j[new o.Z(u.overscaledZ,R,m.z,M,m.y).key]={backfilled:!1},j[new o.Z(u.overscaledZ,H,m.z,N,m.y).key]={backfilled:!1},m.y>0&&(j[new o.Z(u.overscaledZ,R,m.z,M,m.y-1).key]={backfilled:!1},j[new o.Z(u.overscaledZ,u.wrap,m.z,m.x,m.y-1).key]={backfilled:!1},j[new o.Z(u.overscaledZ,H,m.z,N,m.y-1).key]={backfilled:!1}),m.y+1<w&&(j[new o.Z(u.overscaledZ,R,m.z,M,m.y+1).key]={backfilled:!1},j[new o.Z(u.overscaledZ,u.wrap,m.z,m.x,m.y+1).key]={backfilled:!1},j[new o.Z(u.overscaledZ,H,m.z,N,m.y+1).key]={backfilled:!1}),j}unloadTile(u){return o._(this,void 0,void 0,(function*(){u.demTexture&&this.map.painter.saveTileTexture(u.demTexture),u.fbo&&(u.fbo.destroy(),delete u.fbo),u.dem&&delete u.dem,delete u.neighboringTiles,u.state="unloaded",u.actor&&(yield u.actor.sendAsync({type:"RDT",data:{type:this.type,uid:u.uid,source:this.id}}))}))}}class In extends o.E{constructor(u,m,w,M){super(),this.id=u,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._isUpdatingWorker=!1,this._pendingWorkerUpdate={data:m.data},this.actor=w.getActor(),this.setEventedParent(M),this._data=m.data,this._options=o.e({},m),this._collectResourceTiming=m.collectResourceTiming,m.maxzoom!==void 0&&(this.maxzoom=m.maxzoom),m.type&&(this.type=m.type),m.attribution&&(this.attribution=m.attribution),this.promoteId=m.promoteId,m.clusterMaxZoom!==void 0&&this.maxzoom<=m.clusterMaxZoom&&o.w(`The maxzoom value "${this.maxzoom}" is expected to be greater than the clusterMaxZoom value "${m.clusterMaxZoom}".`),this.workerOptions=o.e({source:this.id,cluster:m.cluster||!1,geojsonVtOptions:{buffer:this._pixelsToTileUnits(m.buffer!==void 0?m.buffer:128),tolerance:this._pixelsToTileUnits(m.tolerance!==void 0?m.tolerance:.375),extent:o.$,maxZoom:this.maxzoom,lineMetrics:m.lineMetrics||!1,generateId:m.generateId||!1},superclusterOptions:{maxZoom:this._getClusterMaxZoom(m.clusterMaxZoom),minPoints:Math.max(2,m.clusterMinPoints||2),extent:o.$,radius:this._pixelsToTileUnits(m.clusterRadius||50),log:!1,generateId:m.generateId||!1},clusterProperties:m.clusterProperties,filter:m.filter},m.workerOptions),typeof this.promoteId=="string"&&(this.workerOptions.promoteId=this.promoteId)}_pixelsToTileUnits(u){return u*(o.$/this.tileSize)}_getClusterMaxZoom(u){const m=u?Math.round(u):this.maxzoom-1;return Number.isInteger(u)||u===void 0||o.w(`Integer expected for option 'clusterMaxZoom': provided value "${u}" rounded to "${m}"`),m}load(){return o._(this,void 0,void 0,(function*(){yield this._updateWorkerData()}))}onAdd(u){this.map=u,this.load()}setData(u){return this._data=u,this._pendingWorkerUpdate={data:u},this._updateWorkerData(),this}updateData(u){return this._pendingWorkerUpdate.diff=o.a0(this._pendingWorkerUpdate.diff,u),this._updateWorkerData(),this}getData(){return o._(this,void 0,void 0,(function*(){const u=o.e({type:this.type},this.workerOptions);return this.actor.sendAsync({type:"GD",data:u})}))}getCoordinatesFromGeometry(u){return u.type==="GeometryCollection"?u.geometries.map((m=>m.coordinates)).flat(1/0):u.coordinates.flat(1/0)}getBounds(){return o._(this,void 0,void 0,(function*(){const u=new Tr,m=yield this.getData();let w;switch(m.type){case"FeatureCollection":w=m.features.map((M=>this.getCoordinatesFromGeometry(M.geometry))).flat(1/0);break;case"Feature":w=this.getCoordinatesFromGeometry(m.geometry);break;default:w=this.getCoordinatesFromGeometry(m)}if(w.length==0)return u;for(let M=0;M<w.length-1;M+=2)u.extend([w[M],w[M+1]]);return u}))}setClusterOptions(u){return this.workerOptions.cluster=u.cluster,u&&(u.clusterRadius!==void 0&&(this.workerOptions.superclusterOptions.radius=this._pixelsToTileUnits(u.clusterRadius)),u.clusterMaxZoom!==void 0&&(this.workerOptions.superclusterOptions.maxZoom=this._getClusterMaxZoom(u.clusterMaxZoom))),this._updateWorkerData(),this}getClusterExpansionZoom(u){return this.actor.sendAsync({type:"GCEZ",data:{type:this.type,clusterId:u,source:this.id}})}getClusterChildren(u){return this.actor.sendAsync({type:"GCC",data:{type:this.type,clusterId:u,source:this.id}})}getClusterLeaves(u,m,w){return this.actor.sendAsync({type:"GCL",data:{type:this.type,source:this.id,clusterId:u,limit:m,offset:w}})}_updateWorkerData(){return o._(this,void 0,void 0,(function*(){if(this._isUpdatingWorker)return;const{data:u,diff:m}=this._pendingWorkerUpdate;if(!u&&!m)return void o.w(`No data or diff provided to GeoJSONSource ${this.id}.`);const w=o.e({type:this.type},this.workerOptions);u?(typeof u=="string"?(w.request=this.map._requestManager.transformRequest(y.resolveURL(u),"Source"),w.request.collectResourceTiming=this._collectResourceTiming):w.data=JSON.stringify(u),this._pendingWorkerUpdate.data=void 0):m&&(w.dataDiff=m,this._pendingWorkerUpdate.diff=void 0),this._isUpdatingWorker=!0,this.fire(new o.l("dataloading",{dataType:"source"}));try{const M=yield this.actor.sendAsync({type:"LD",data:w});if(this._isUpdatingWorker=!1,this._removed||M.abandoned)return void this.fire(new o.l("dataabort",{dataType:"source"}));this._data=M.data;let R=null;M.resourceTiming&&M.resourceTiming[this.id]&&(R=M.resourceTiming[this.id].slice(0));const N={dataType:"source"};this._collectResourceTiming&&R&&R.length>0&&o.e(N,{resourceTiming:R}),this.fire(new o.l("data",Object.assign(Object.assign({},N),{sourceDataType:"metadata"}))),this.fire(new o.l("data",Object.assign(Object.assign({},N),{sourceDataType:"content"})))}catch(M){if(this._isUpdatingWorker=!1,this._removed)return void this.fire(new o.l("dataabort",{dataType:"source"}));this.fire(new o.k(M))}finally{(this._pendingWorkerUpdate.data||this._pendingWorkerUpdate.diff)&&this._updateWorkerData()}}))}loaded(){return!this._isUpdatingWorker&&this._pendingWorkerUpdate.data===void 0&&this._pendingWorkerUpdate.diff===void 0}loadTile(u){return o._(this,void 0,void 0,(function*(){const m=u.actor?"RT":"LT";u.actor=this.actor;const w={type:this.type,uid:u.uid,tileID:u.tileID,zoom:u.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,subdivisionGranularity:this.map.style.projection.subdivisionGranularity};u.abortController=new AbortController;const M=yield this.actor.sendAsync({type:m,data:w},u.abortController);delete u.abortController,u.unloadVectorData(),u.aborted||u.loadVectorData(M,this.map.painter,m==="RT")}))}abortTile(u){return o._(this,void 0,void 0,(function*(){u.abortController&&(u.abortController.abort(),delete u.abortController),u.aborted=!0}))}unloadTile(u){return o._(this,void 0,void 0,(function*(){u.unloadVectorData(),yield this.actor.sendAsync({type:"RMT",data:{uid:u.uid,type:this.type,source:this.id}})}))}onRemove(){this._removed=!0,this.actor.sendAsync({type:"RS",data:{type:this.type,source:this.id}})}serialize(){return o.e({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}}class Li extends o.E{constructor(u,m,w,M){super(),this.flippedWindingOrder=!1,this.id=u,this.dispatcher=w,this.coordinates=m.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(M),this.options=m}load(u){return o._(this,void 0,void 0,(function*(){this._loaded=!1,this.fire(new o.l("dataloading",{dataType:"source"})),this.url=this.options.url,this._request=new AbortController;try{const m=yield F.getImage(this.map._requestManager.transformRequest(this.url,"Image"),this._request);this._request=null,this._loaded=!0,m&&m.data&&(this.image=m.data,u&&(this.coordinates=u),this._finishLoading())}catch(m){this._request=null,this._loaded=!0,this.fire(new o.k(m))}}))}loaded(){return this._loaded}updateImage(u){return u.url?(this._request&&(this._request.abort(),this._request=null),this.options.url=u.url,this.load(u.coordinates).finally((()=>{this.texture=null})),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new o.l("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(u){this.map=u,this.load()}onRemove(){this._request&&(this._request.abort(),this._request=null)}setCoordinates(u){this.coordinates=u;const m=u.map(o.a1.fromLngLat);var w;return this.tileID=(function(M){const R=o.a2.fromPoints(M),N=R.width(),H=R.height(),j=Math.max(N,H),Y=Math.max(0,Math.floor(-Math.log(j)/Math.LN2)),K=Math.pow(2,Y);return new o.a4(Y,Math.floor((R.minX+R.maxX)/2*K),Math.floor((R.minY+R.maxY)/2*K))})(m),this.terrainTileRanges=this._getOverlappingTileRanges(m),this.minzoom=this.maxzoom=this.tileID.z,this.tileCoords=m.map((M=>this.tileID.getTilePoint(M)._round())),this.flippedWindingOrder=((w=this.tileCoords)[1].x-w[0].x)*(w[2].y-w[0].y)-(w[1].y-w[0].y)*(w[2].x-w[0].x)<0,this.fire(new o.l("data",{dataType:"source",sourceDataType:"content"})),this}prepare(){if(Object.keys(this.tiles).length===0||!this.image)return;const u=this.map.painter.context,m=u.gl;this.texture||(this.texture=new o.T(u,this.image,m.RGBA),this.texture.bind(m.LINEAR,m.CLAMP_TO_EDGE));let w=!1;for(const M in this.tiles){const R=this.tiles[M];R.state!=="loaded"&&(R.state="loaded",R.texture=this.texture,w=!0)}w&&this.fire(new o.l("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}loadTile(u){return o._(this,void 0,void 0,(function*(){this.tileID&&this.tileID.equals(u.tileID.canonical)?(this.tiles[String(u.tileID.wrap)]=u,u.buckets={}):u.state="errored"}))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}_getOverlappingTileRanges(u){const{minX:m,minY:w,maxX:M,maxY:R}=o.a2.fromPoints(u),N={};for(let H=0;H<=o.a3;H++){const j=Math.pow(2,H),Y=Math.floor(m*j),K=Math.floor(w*j),ie=Math.floor(M*j),re=Math.floor(R*j);N[H]={minTileX:Y,minTileY:K,maxTileX:ie,maxTileY:re}}return N}}class Oa extends Li{constructor(u,m,w,M){super(u,m,w,M),this.roundZoom=!0,this.type="video",this.options=m}load(){return o._(this,void 0,void 0,(function*(){this._loaded=!1;const u=this.options;this.urls=[];for(const m of u.urls)this.urls.push(this.map._requestManager.transformRequest(m,"Source").url);try{const m=yield o.a5(this.urls);if(this._loaded=!0,!m)return;this.video=m,this.video.loop=!0,this.video.addEventListener("playing",(()=>{this.map.triggerRepaint()})),this.map&&this.video.play(),this._finishLoading()}catch(m){this.fire(new o.k(m))}}))}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(u){if(this.video){const m=this.video.seekable;u<m.start(0)||u>m.end(0)?this.fire(new o.k(new o.a6(`sources.${this.id}`,null,`Playback for this video can be set only between the ${m.start(0)} and ${m.end(0)}-second mark.`))):this.video.currentTime=u}}getVideo(){return this.video}onAdd(u){this.map||(this.map=u,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const u=this.map.painter.context,m=u.gl;this.texture?this.video.paused||(this.texture.bind(m.LINEAR,m.CLAMP_TO_EDGE),m.texSubImage2D(m.TEXTURE_2D,0,0,0,m.RGBA,m.UNSIGNED_BYTE,this.video)):(this.texture=new o.T(u,this.video,m.RGBA),this.texture.bind(m.LINEAR,m.CLAMP_TO_EDGE));let w=!1;for(const M in this.tiles){const R=this.tiles[M];R.state!=="loaded"&&(R.state="loaded",R.texture=this.texture,w=!0)}w&&this.fire(new o.l("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}}class Na extends Li{constructor(u,m,w,M){super(u,m,w,M),m.coordinates?Array.isArray(m.coordinates)&&m.coordinates.length===4&&!m.coordinates.some((R=>!Array.isArray(R)||R.length!==2||R.some((N=>typeof N!="number"))))||this.fire(new o.k(new o.a6(`sources.${u}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new o.k(new o.a6(`sources.${u}`,null,'missing required property "coordinates"'))),m.animate&&typeof m.animate!="boolean"&&this.fire(new o.k(new o.a6(`sources.${u}`,null,'optional "animate" property must be a boolean value'))),m.canvas?typeof m.canvas=="string"||m.canvas instanceof HTMLCanvasElement||this.fire(new o.k(new o.a6(`sources.${u}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new o.k(new o.a6(`sources.${u}`,null,'missing required property "canvas"'))),this.options=m,this.animate=m.animate===void 0||m.animate}load(){return o._(this,void 0,void 0,(function*(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new o.k(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}))}getCanvas(){return this.canvas}onAdd(u){this.map=u,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let u=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,u=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,u=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const m=this.map.painter.context,w=m.gl;this.texture?(u||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new o.T(m,this.canvas,w.RGBA,{premultiply:!0});let M=!1;for(const R in this.tiles){const N=this.tiles[R];N.state!=="loaded"&&(N.state="loaded",N.texture=this.texture,M=!0)}M&&this.fire(new o.l("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const u of[this.canvas.width,this.canvas.height])if(isNaN(u)||u<=0)return!0;return!1}}const Ls={},vo=I=>{switch(I){case"geojson":return In;case"image":return Li;case"raster":return ii;case"raster-dem":return Zi;case"vector":return $r;case"video":return Oa;case"canvas":return Na}return Ls[I]},ea="RTLPluginLoaded";class Zf extends o.E{constructor(){super(...arguments),this.status="unavailable",this.url=null,this.dispatcher=_r()}_syncState(u){return this.status=u,this.dispatcher.broadcast("SRPS",{pluginStatus:u,pluginURL:this.url}).catch((m=>{throw this.status="error",m}))}getRTLTextPluginStatus(){return this.status}clearRTLTextPlugin(){this.status="unavailable",this.url=null}setRTLTextPlugin(u){return o._(this,arguments,void 0,(function*(m,w=!1){if(this.url)throw new Error("setRTLTextPlugin cannot be called multiple times.");if(this.url=y.resolveURL(m),!this.url)throw new Error(`requested url ${m} is invalid`);if(this.status==="unavailable"){if(!w)return this._requestImport();this.status="deferred",this._syncState(this.status)}else if(this.status==="requested")return this._requestImport()}))}_requestImport(){return o._(this,void 0,void 0,(function*(){yield this._syncState("loading"),this.status="loaded",this.fire(new o.l(ea))}))}lazyLoad(){this.status==="unavailable"?this.status="requested":this.status==="deferred"&&this._requestImport()}}let Do=null;function Ll(){return Do||(Do=new Zf),Do}var Ya,Ge;(function(I){I[I.Base=0]="Base",I[I.Parent=1]="Parent"})(Ya||(Ya={})),(function(I){I[I.Departing=0]="Departing",I[I.Incoming=1]="Incoming"})(Ge||(Ge={}));class he{constructor(u,m){this.timeAdded=0,this.fadeEndTime=0,this.fadeOpacity=1,this.tileID=u,this.uid=o.a7(),this.uses=0,this.tileSize=m,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.rtt=[],this.rttCoords={},this.expiredRequestCount=0,this.state="loading"}isRenderable(u){return this.hasData()&&(!this.fadeEndTime||this.fadeOpacity>0)&&(u||!this.holdingForSymbolFade())}setCrossFadeLogic({fadingRole:u,fadingDirection:m,fadingParentID:w,fadeEndTime:M}){this.resetFadeLogic(),this.fadingRole=u,this.fadingDirection=m,this.fadingParentID=w,this.fadeEndTime=M}setSelfFadeLogic(u){this.resetFadeLogic(),this.selfFading=!0,this.fadeEndTime=u}resetFadeLogic(){this.fadingRole=null,this.fadingDirection=null,this.fadingParentID=null,this.selfFading=!1,this.timeAdded=y.now(),this.fadeEndTime=0,this.fadeOpacity=1}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}clearTextures(u){this.demTexture&&u.saveTileTexture(this.demTexture),this.demTexture=null}loadVectorData(u,m,w){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",u){u.featureIndex&&(this.latestFeatureIndex=u.featureIndex,u.rawTileData?(this.latestRawTileData=u.rawTileData,this.latestFeatureIndex.rawTileData=u.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=u.collisionBoxArray,this.buckets=(function(M,R){const N={};if(!R)return N;for(const H of M){const j=H.layerIds.map((Y=>R.getLayer(Y))).filter(Boolean);if(j.length!==0){H.layers=j,H.stateDependentLayerIds&&(H.stateDependentLayers=H.stateDependentLayerIds.map((Y=>j.filter((K=>K.id===Y))[0])));for(const Y of j)N[Y.id]=H}}return N})(u.buckets,m?.style),this.hasSymbolBuckets=!1;for(const M in this.buckets){const R=this.buckets[M];if(R instanceof o.a9){if(this.hasSymbolBuckets=!0,!w)break;R.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const M in this.buckets){const R=this.buckets[M];if(R instanceof o.a9&&R.hasRTLText){this.hasRTLText=!0,Ll().lazyLoad();break}}this.queryPadding=0;for(const M in this.buckets){const R=this.buckets[M];this.queryPadding=Math.max(this.queryPadding,m.style.getLayer(M).queryRadius(R))}u.imageAtlas&&(this.imageAtlas=u.imageAtlas),u.glyphAtlasImage&&(this.glyphAtlasImage=u.glyphAtlasImage),this.dashPositions=u.dashPositions}else this.collisionBoxArray=new o.a8}unloadVectorData(){for(const u in this.buckets)this.buckets[u].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.dashPositions&&(this.dashPositions=null),this.latestFeatureIndex=null,this.state="unloaded"}getBucket(u){return this.buckets[u.id]}upload(u){for(const w in this.buckets){const M=this.buckets[w];M.uploadPending()&&M.upload(u)}const m=u.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new o.T(u,this.imageAtlas.image,m.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new o.T(u,this.glyphAtlasImage,m.ALPHA),this.glyphAtlasImage=null)}prepare(u){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(u,this.imageAtlasTexture)}queryRenderedFeatures(u,m,w,M,R,N,H,j,Y,K,ie){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:M,cameraQueryGeometry:R,scale:N,tileSize:this.tileSize,pixelPosMatrix:K,transform:j,params:H,queryPadding:this.queryPadding*Y,getElevation:ie},u,m,w):{}}querySourceFeatures(u,m){const w=this.latestFeatureIndex;if(!w||!w.rawTileData)return;const M=w.loadVTLayers(),R=m&&m.sourceLayer?m.sourceLayer:"",N=M._geojsonTileLayer||M[R];if(!N)return;const H=o.aa(m?.filter,m?.globalState),{z:j,x:Y,y:K}=this.tileID.canonical,ie={z:j,x:Y,y:K};for(let re=0;re<N.length;re++){const ue=N.feature(re);if(H.needGeometry){const Te=o.ab(ue,!0);if(!H.filter(new o.F(this.tileID.overscaledZ),Te,this.tileID.canonical))continue}else if(!H.filter(new o.F(this.tileID.overscaledZ),ue))continue;const pe=w.getId(ue,R),Se=new o.ac(ue,j,Y,K,pe);Se.tile=ie,u.push(Se)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(u){const m=this.expirationTime;if(u.cacheControl){const w=o.ad(u.cacheControl);w["max-age"]&&(this.expirationTime=Date.now()+1e3*w["max-age"])}else u.expires&&(this.expirationTime=new Date(u.expires).getTime());if(this.expirationTime){const w=Date.now();let M=!1;if(this.expirationTime>w)M=!1;else if(m)if(this.expirationTime<m)M=!0;else{const R=this.expirationTime-m;R?this.expirationTime=w+Math.max(R,3e4):M=!0}else M=!0;M?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(u,m){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(u).length===0)return;const w=this.latestFeatureIndex.loadVTLayers();for(const M in this.buckets){if(!m.style.hasLayer(M))continue;const R=this.buckets[M],N=R.layers[0].sourceLayer||"_geojsonTileLayer",H=w[N],j=u[N];if(!H||!j||Object.keys(j).length===0)continue;R.update(j,H,this.imageAtlas&&this.imageAtlas.patternPositions||{},this.dashPositions||{});const Y=m&&m.style&&m.style.getLayer(M);Y&&(this.queryPadding=Math.max(this.queryPadding,Y.queryRadius(R)))}}holdingForSymbolFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<y.now()}clearSymbolFadeHold(){this.symbolFadeHoldUntil=void 0}setSymbolHoldDuration(u){this.symbolFadeHoldUntil=y.now()+u}setDependencies(u,m){const w={};for(const M of m)w[M]=!0;this.dependencies[u]=w}hasDependency(u,m){for(const w of u){const M=this.dependencies[w];if(M){for(const R of m)if(M[R])return!0}}return!1}}class fe{constructor(u,m){this.max=u,this.onRemove=m,this.reset()}reset(){for(const u in this.data)for(const m of this.data[u])m.timeout&&clearTimeout(m.timeout),this.onRemove(m.value);return this.data={},this.order=[],this}add(u,m,w){const M=u.wrapped().key;this.data[M]===void 0&&(this.data[M]=[]);const R={value:m,timeout:void 0};if(w!==void 0&&(R.timeout=setTimeout((()=>{this.remove(u,R)}),w)),this.data[M].push(R),this.order.push(M),this.order.length>this.max){const N=this._getAndRemoveByKey(this.order[0]);N&&this.onRemove(N)}return this}has(u){return u.wrapped().key in this.data}getAndRemove(u){return this.has(u)?this._getAndRemoveByKey(u.wrapped().key):null}_getAndRemoveByKey(u){const m=this.data[u].shift();return m.timeout&&clearTimeout(m.timeout),this.data[u].length===0&&delete this.data[u],this.order.splice(this.order.indexOf(u),1),m.value}getByKey(u){const m=this.data[u];return m?m[0].value:null}get(u){return this.has(u)?this.data[u.wrapped().key][0].value:null}remove(u,m){if(!this.has(u))return this;const w=u.wrapped().key,M=m===void 0?0:this.data[w].indexOf(m),R=this.data[w][M];return this.data[w].splice(M,1),R.timeout&&clearTimeout(R.timeout),this.data[w].length===0&&delete this.data[w],this.onRemove(R.value),this.order.splice(this.order.indexOf(w),1),this}setMaxSize(u){for(this.max=u;this.order.length>this.max;){const m=this._getAndRemoveByKey(this.order[0]);m&&this.onRemove(m)}return this}filter(u){const m=[];for(const w in this.data)for(const M of this.data[w])u(M.value)||m.push(M);for(const w of m)this.remove(w.value.tileID,w)}}class we{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(u,m,w){const M=String(m);if(this.stateChanges[u]=this.stateChanges[u]||{},this.stateChanges[u][M]=this.stateChanges[u][M]||{},o.e(this.stateChanges[u][M],w),this.deletedStates[u]===null){this.deletedStates[u]={};for(const R in this.state[u])R!==M&&(this.deletedStates[u][R]=null)}else if(this.deletedStates[u]&&this.deletedStates[u][M]===null){this.deletedStates[u][M]={};for(const R in this.state[u][M])w[R]||(this.deletedStates[u][M][R]=null)}else for(const R in w)this.deletedStates[u]&&this.deletedStates[u][M]&&this.deletedStates[u][M][R]===null&&delete this.deletedStates[u][M][R]}removeFeatureState(u,m,w){if(this.deletedStates[u]===null)return;const M=String(m);if(this.deletedStates[u]=this.deletedStates[u]||{},w&&m!==void 0)this.deletedStates[u][M]!==null&&(this.deletedStates[u][M]=this.deletedStates[u][M]||{},this.deletedStates[u][M][w]=null);else if(m!==void 0)if(this.stateChanges[u]&&this.stateChanges[u][M])for(w in this.deletedStates[u][M]={},this.stateChanges[u][M])this.deletedStates[u][M][w]=null;else this.deletedStates[u][M]=null;else this.deletedStates[u]=null}getState(u,m){const w=String(m),M=o.e({},(this.state[u]||{})[w],(this.stateChanges[u]||{})[w]);if(this.deletedStates[u]===null)return{};if(this.deletedStates[u]){const R=this.deletedStates[u][m];if(R===null)return{};for(const N in R)delete M[N]}return M}initializeTileState(u,m){u.setFeatureState(this.state,m)}coalesceChanges(u,m){const w={};for(const M in this.stateChanges){this.state[M]=this.state[M]||{};const R={};for(const N in this.stateChanges[M])this.state[M][N]||(this.state[M][N]={}),o.e(this.state[M][N],this.stateChanges[M][N]),R[N]=this.state[M][N];w[M]=R}for(const M in this.deletedStates){this.state[M]=this.state[M]||{};const R={};if(this.deletedStates[M]===null)for(const N in this.state[M])R[N]={},this.state[M][N]={};else for(const N in this.deletedStates[M]){if(this.deletedStates[M][N]===null)this.state[M][N]={};else for(const H of Object.keys(this.deletedStates[M][N]))delete this.state[M][N][H];R[N]=this.state[M][N]}w[M]=w[M]||{},o.e(w[M],R)}if(this.stateChanges={},this.deletedStates={},Object.keys(w).length!==0)for(const M in u)u[M].setFeatureState(w,m)}}const Ne=89.25;function Be(I,u){const m=o.ah(u.lat,-o.ai,o.ai);return new o.P(o.V(u.lng)*I,o.U(m)*I)}function We(I,u){return new o.a1(u.x/I,u.y/I).toLngLat()}function it(I){return I.cameraToCenterDistance*Math.min(.85*Math.tan(o.ae(90-I.pitch)),Math.tan(o.ae(Ne-I.pitch)))}function Ke(I,u){const m=I.canonical,w=u/o.af(m.z),M=m.x+Math.pow(2,m.z)*I.wrap,R=o.ag(new Float64Array(16));return o.M(R,R,[M*w,m.y*w,0]),o.N(R,R,[w/o.$,w/o.$,1]),R}function yt(I,u,m,w,M){const R=o.a1.fromLngLat(I,u),N=M*o.aj(1,I.lat),H=N*Math.cos(o.ae(m)),j=Math.sqrt(N*N-H*H),Y=j*Math.sin(o.ae(-w)),K=j*Math.cos(o.ae(-w));return new o.a1(R.x+Y,R.y+K,R.z+H)}function kt(I,u,m){const w=u.intersectsFrustum(I);if(!m||w===0)return w;const M=u.intersectsPlane(m);return M===0?0:w===2&&M===2?2:1}function St(I,u,m){let w=0;const M=(m-u)/10;for(let R=0;R<10;R++)w+=M*Math.pow(Math.cos(u+(R+.5)/10*(m-u)),I);return w}function rr(I,u){return function(m,w,M,R,N){const H=2*((I-1)/o.ak(Math.cos(o.ae(Ne-N))/Math.cos(o.ae(Ne)))-1),j=Math.acos(M/R),Y=2*St(H-1,0,o.ae(N/2)),K=Math.min(o.ae(Ne),j+o.ae(N/2)),ie=St(H-1,Math.min(K,j-o.ae(N/2)),K),re=Math.atan(w/M),ue=Math.hypot(w,M);let pe=m;return pe+=o.ak(R/ue/Math.max(.5,Math.cos(o.ae(N/2)))),pe+=H*o.ak(Math.cos(re))/2,pe-=o.ak(Math.max(1,ie/Y/u))/2,pe}}const pr=rr(9.314,3);function Qe(I,u){const m=(u.roundZoom?Math.round:Math.floor)(I.zoom+o.ak(I.tileSize/u.tileSize));return Math.max(0,m)}function Kr(I,u){const m=I.getCameraFrustum(),w=I.getClippingPlane(),M=I.screenPointToMercatorCoordinate(I.getCameraPoint()),R=o.a1.fromLngLat(I.center,I.elevation);M.z=R.z+Math.cos(I.pitchInRadians)*I.cameraToCenterDistance/I.worldSize;const N=I.getCoveringTilesDetailsProvider(),H=N.allowVariableZoom(I,u),j=Qe(I,u),Y=u.minzoom||0,K=u.maxzoom!==void 0?u.maxzoom:I.maxZoom,ie=Math.min(Math.max(0,j),K),re=Math.pow(2,ie),ue=[re*M.x,re*M.y,0],pe=[re*R.x,re*R.y,0],Se=Math.hypot(R.x-M.x,R.y-M.y),Te=Math.abs(R.z-M.z),Ce=Math.hypot(Se,Te),Ie=ze=>({zoom:0,x:0,y:0,wrap:ze,fullyVisible:!1}),ke=[],Re=[];if(I.renderWorldCopies&&N.allowWorldCopies())for(let ze=1;ze<=3;ze++)ke.push(Ie(-ze)),ke.push(Ie(ze));for(ke.push(Ie(0));ke.length>0;){const ze=ke.pop(),He=ze.x,Le=ze.y;let Xe=ze.fullyVisible;const ht={x:He,y:Le,z:ze.zoom},at=N.getTileBoundingVolume(ht,ze.wrap,I.elevation,u);if(!Xe){const Bt=kt(m,at,w);if(Bt===0)continue;Xe=Bt===2}const st=N.distanceToTile2d(M.x,M.y,ht,at);let lt=j;H&&(lt=(u.calculateTileZoom||pr)(I.zoom+o.ak(I.tileSize/u.tileSize),st,Te,Ce,I.fov)),lt=(u.roundZoom?Math.round:Math.floor)(lt),lt=Math.max(0,lt);const Ot=Math.min(lt,K);if(ze.wrap=N.getWrap(R,ht,ze.wrap),ze.zoom>=Ot){if(ze.zoom<Y)continue;const Bt=ie-ze.zoom,Ct=ue[0]-.5-(He<<Bt),nr=ue[1]-.5-(Le<<Bt),Pr=u.reparseOverscaled?Math.max(ze.zoom,lt):ze.zoom;Re.push({tileID:new o.Z(ze.zoom===K?Pr:ze.zoom,ze.wrap,ze.zoom,He,Le),distanceSq:o.al([pe[0]-.5-He,pe[1]-.5-Le]),tileDistanceToCamera:Math.sqrt(Ct*Ct+nr*nr)})}else for(let Bt=0;Bt<4;Bt++)ke.push({zoom:ze.zoom+1,x:(He<<1)+Bt%2,y:(Le<<1)+(Bt>>1),wrap:ze.wrap,fullyVisible:Xe})}return Re.sort(((ze,He)=>ze.distanceSq-He.distanceSq)).map((ze=>ze.tileID))}const pi=o.a2.fromPoints([new o.P(0,0),new o.P(o.$,o.$)]);class or extends o.E{constructor(u,m,w){super(),this.id=u,this.dispatcher=w,this.on("data",(M=>this._dataHandler(M))),this.on("dataloading",(()=>{this._sourceErrored=!1})),this.on("error",(()=>{this._sourceErrored=this._source.loaded()})),this._source=((M,R,N,H)=>{const j=new(vo(R.type))(M,R,N,H);if(j.id!==M)throw new Error(`Expected Source id to be ${M} instead of ${j.id}`);return j})(u,m,w,this),this._tiles={},this._cache=new fe(0,(M=>this._unloadTile(M))),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._maxTileCacheZoomLevels=null,this._rasterFadeDuration=0,this._maxFadingAncestorLevels=5,this._state=new we,this._didEmitContent=!1,this._updated=!1}onAdd(u){this.map=u,this._maxTileCacheSize=u?u._maxTileCacheSize:null,this._maxTileCacheZoomLevels=u?u._maxTileCacheZoomLevels:null,this._source&&this._source.onAdd&&this._source.onAdd(u)}onRemove(u){this.clearTiles(),this._source&&this._source.onRemove&&this._source.onRemove(u)}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;if(!(this.used===void 0&&this.usedForTerrain===void 0||this.used||this.usedForTerrain))return!0;if(!this._updated)return!1;for(const u in this._tiles){const m=this._tiles[u];if(m.state!=="loaded"&&m.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const u=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,u&&this.reload(),this.transform&&this.update(this.transform,this.terrain)}_loadTile(u,m,w){return o._(this,void 0,void 0,(function*(){try{yield this._source.loadTile(u),this._tileLoaded(u,m,w)}catch(M){u.state="errored",M.status!==404?this._source.fire(new o.k(M,{tile:u})):this.update(this.transform,this.terrain)}}))}_unloadTile(u){this._source.unloadTile&&this._source.unloadTile(u)}_abortTile(u){this._source.abortTile&&this._source.abortTile(u),this._source.fire(new o.l("dataabort",{tile:u,coord:u.tileID,dataType:"source"}))}serialize(){return this._source.serialize()}prepare(u){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const m in this._tiles){const w=this._tiles[m];w.upload(u),w.prepare(this.map.style.imageManager)}}getIds(){return Object.values(this._tiles).map((u=>u.tileID)).sort(ui).map((u=>u.key))}getRenderableIds(u){const m=[];for(const w in this._tiles)this._isIdRenderable(w,u)&&m.push(this._tiles[w]);return u?m.sort(((w,M)=>{const R=w.tileID,N=M.tileID,H=new o.P(R.canonical.x,R.canonical.y)._rotate(-this.transform.bearingInRadians),j=new o.P(N.canonical.x,N.canonical.y)._rotate(-this.transform.bearingInRadians);return R.overscaledZ-N.overscaledZ||j.y-H.y||j.x-H.x})).map((w=>w.tileID.key)):m.map((w=>w.tileID)).sort(ui).map((w=>w.key))}hasRenderableParent(u){const m=u.overscaledZ-1;if(m>=this._source.minzoom){const w=this._getLoadedTile(u.scaledTo(m));if(w)return this._isIdRenderable(w.tileID.key)}return!1}_isIdRenderable(u,m=!1){var w;return(w=this._tiles[u])===null||w===void 0?void 0:w.isRenderable(m)}reload(u){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const m in this._tiles)u?this._reloadTile(m,"expired"):this._tiles[m].state!=="errored"&&this._reloadTile(m,"reloading")}}_reloadTile(u,m){return o._(this,void 0,void 0,(function*(){const w=this._tiles[u];w&&(w.state!=="loading"&&(w.state=m),yield this._loadTile(w,u,m))}))}_tileLoaded(u,m,w){u.timeAdded=y.now(),w==="expired"&&(u.refreshedUponExpiration=!0),this._setTileReloadTimer(m,u),this.getSource().type==="raster-dem"&&u.dem&&this._backfillDEM(u),this._state.initializeTileState(u,this.map?this.map.painter:null),u.aborted||this._source.fire(new o.l("data",{dataType:"source",tile:u,coord:u.tileID}))}_backfillDEM(u){const m=this.getRenderableIds();for(let M=0;M<m.length;M++){const R=m[M];if(u.neighboringTiles&&u.neighboringTiles[R]){const N=this.getTileByID(R);w(u,N),w(N,u)}}function w(M,R){M.needsHillshadePrepare=!0,M.needsTerrainPrepare=!0;let N=R.tileID.canonical.x-M.tileID.canonical.x;const H=R.tileID.canonical.y-M.tileID.canonical.y,j=Math.pow(2,M.tileID.canonical.z),Y=R.tileID.key;N===0&&H===0||Math.abs(H)>1||(Math.abs(N)>1&&(Math.abs(N+j)===1?N+=j:Math.abs(N-j)===1&&(N-=j)),R.dem&&M.dem&&(M.dem.backfillBorder(R.dem,N,H),M.neighboringTiles&&M.neighboringTiles[Y]&&(M.neighboringTiles[Y].backfilled=!0)))}}getTile(u){return this.getTileByID(u.key)}getTileByID(u){return this._tiles[u]}_retainLoadedChildren(u,m){const w=Object.values(u),M=this._getLoadedDescendents(w),R={};for(const N of w){const H=M[N.key];if(!H?.length){R[N.key]=N;continue}const j=N.overscaledZ+or.maxUnderzooming,Y=H.filter((re=>re.tileID.overscaledZ<=j));if(!Y.length){R[N.key]=N;continue}const K=Math.min(...Y.map((re=>re.tileID.overscaledZ))),ie=Y.filter((re=>re.tileID.overscaledZ===K)).map((re=>re.tileID));for(const re of ie)m[re.key]=re;this._areDescendentsComplete(ie,K,N.overscaledZ)||(R[N.key]=N)}return R}_getLoadedDescendents(u){var m;const w={};for(const M in this._tiles){const R=this._tiles[M];if(R.hasData())for(const N of u)R.tileID.isChildOf(N)&&(w[m=N.key]||(w[m]=[])).push(R)}return w}_areDescendentsComplete(u,m,w){return u.length===1&&u[0].isOverscaled()?u[0].overscaledZ===m:Math.pow(4,m-w)===u.length}_getLoadedTile(u){const m=this._tiles[u.key];return m?.hasData()?m:null}updateCacheSize(u){const m=Math.ceil(u.width/this._source.tileSize)+1,w=Math.ceil(u.height/this._source.tileSize)+1,M=Math.floor(m*w*(this._maxTileCacheZoomLevels===null?o.a.MAX_TILE_CACHE_ZOOM_LEVELS:this._maxTileCacheZoomLevels)),R=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,M):M;this._cache.setMaxSize(R)}handleWrapJump(u){const m=Math.round((u-(this._prevLng===void 0?u:this._prevLng))/360);if(this._prevLng=u,m){const w={};for(const M in this._tiles){const R=this._tiles[M];R.tileID=R.tileID.unwrapTo(R.tileID.wrap+m),w[R.tileID.key]=R}this._tiles=w;for(const M in this._timers)clearTimeout(this._timers[M]),delete this._timers[M];for(const M in this._tiles)this._setTileReloadTimer(M,this._tiles[M])}}update(u,m){if(!this._sourceLoaded||this._paused)return;let w;this.transform=u,this.terrain=m,this.updateCacheSize(u),this.handleWrapJump(this.transform.center.lng),this.used||this.usedForTerrain?this._source.tileID?w=u.getVisibleUnwrappedCoordinates(this._source.tileID).map((j=>new o.Z(j.canonical.z,j.wrap,j.canonical.z,j.canonical.x,j.canonical.y))):(w=Kr(u,{tileSize:this.usedForTerrain?this.tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:!this.usedForTerrain&&this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled,terrain:m,calculateTileZoom:this._source.calculateTileZoom}),this._source.hasTile&&(w=w.filter((j=>this._source.hasTile(j))))):w=[],this.usedForTerrain&&(w=this._addTerrainIdealTiles(w));const M=w.length===0&&!this._updated&&this._didEmitContent;this._updated=!0,M&&this.fire(new o.l("data",{sourceDataType:"idle",dataType:"source",sourceId:this.id}));const R=Qe(u,this._source),N=this._updateRetainedTiles(w,R),H=zn(this._source.type);H&&this._rasterFadeDuration>0&&!m&&this._updateFadingTiles(w,N),H?this._cleanUpRasterTiles(N):this._cleanUpVectorTiles(N)}_cleanUpRasterTiles(u){for(const m in this._tiles)u[m]||this._removeTile(m)}_cleanUpVectorTiles(u){for(const m in this._tiles){const w=this._tiles[m];u[m]?w.clearSymbolFadeHold():w.hasSymbolBuckets?w.holdingForSymbolFade()?w.symbolFadeFinished()&&this._removeTile(m):w.setSymbolHoldDuration(this.map._fadeDuration):this._removeTile(m)}}_addTerrainIdealTiles(u){const m=[];for(const w of u)if(w.canonical.z>this._source.minzoom){const M=w.scaledTo(w.canonical.z-1);m.push(M);const R=w.scaledTo(Math.max(this._source.minzoom,Math.min(w.canonical.z,5)));m.push(R)}return u.concat(m)}releaseSymbolFadeTiles(){for(const u in this._tiles)this._tiles[u].holdingForSymbolFade()&&this._removeTile(u)}_updateRetainedTiles(u,m){var w;const M={},R={},N=Math.max(m-or.maxOverzooming,this._source.minzoom);let H={};for(const j of u){const Y=this._addTile(j);M[j.key]=j,Y.hasData()||(H[j.key]=j)}H=this._retainLoadedChildren(H,M);for(const j in H){const Y=H[j];let K=this._tiles[j],ie=K?.wasRequested();for(let re=Y.overscaledZ-1;re>=N;--re){const ue=Y.scaledTo(re);if(R[ue.key])break;if(R[ue.key]=!0,K=this.getTile(ue),!K&&ie&&(K=this._addTile(ue)),K){const pe=K.hasData();if((pe||!(!((w=this.map)===null||w===void 0)&&w.cancelPendingTileRequestsWhileZooming)||ie)&&(M[ue.key]=ue),ie=K.wasRequested(),pe)break}}}return M}_updateFadingTiles(u,m){const w=y.now(),M=o.am(u);for(const R of u){const N=this._tiles[R.key];N.fadingDirection!==Ge.Departing&&N.fadeOpacity!==0||N.resetFadeLogic(),this._updateFadingAncestor(N,m,w)||this._updateFadingDescendents(N,m,w)||this._updateFadingEdge(N,M,w)||N.resetFadeLogic()}}_updateFadingAncestor(u,m,w){if(!u.hasData())return!1;const{tileID:M,fadingRole:R,fadingDirection:N,fadingParentID:H}=u;if(R===Ya.Base&&N===Ge.Incoming&&H)return m[H.key]=H,!0;const j=Math.max(M.overscaledZ-this._maxFadingAncestorLevels,this._source.minzoom);for(let Y=M.overscaledZ-1;Y>=j;Y--){const K=M.scaledTo(Y),ie=this._getLoadedTile(K);if(ie)return u.setCrossFadeLogic({fadingRole:Ya.Base,fadingDirection:Ge.Incoming,fadingParentID:ie.tileID,fadeEndTime:w+this._rasterFadeDuration}),ie.setCrossFadeLogic({fadingRole:Ya.Parent,fadingDirection:Ge.Departing,fadeEndTime:w+this._rasterFadeDuration}),m[K.key]=K,!0}return!1}_updateFadingDescendents(u,m,w){if(!u.hasData())return!1;const M=u.tileID.children(this._source.maxzoom);let R=this._updateFadingChildren(u,M,m,w);if(R)return!0;for(const N of M){const H=N.children(this._source.maxzoom);this._updateFadingChildren(u,H,m,w)&&(R=!0)}return R}_updateFadingChildren(u,m,w,M){if(m[0].overscaledZ>=this._source.maxzoom)return!1;let R=!1;for(const N of m){const H=this._getLoadedTile(N);if(!H)continue;const{fadingRole:j,fadingDirection:Y,fadingParentID:K}=H;j===Ya.Base&&Y===Ge.Departing&&K||(H.setCrossFadeLogic({fadingRole:Ya.Base,fadingDirection:Ge.Departing,fadingParentID:u.tileID,fadeEndTime:M+this._rasterFadeDuration}),u.setCrossFadeLogic({fadingRole:Ya.Parent,fadingDirection:Ge.Incoming,fadeEndTime:M+this._rasterFadeDuration})),w[N.key]=N,R=!0}return R}_updateFadingEdge(u,m,w){const M=u.tileID;return!!u.selfFading||!u.hasData()&&!!m.has(M)&&(u.setSelfFadeLogic(w+this._rasterFadeDuration),!0)}_addTile(u){let m=this._tiles[u.key];if(m)return m;m=this._cache.getAndRemove(u),m&&(m.resetFadeLogic(),this._setTileReloadTimer(u.key,m),m.tileID=u,this._state.initializeTileState(m,this.map?this.map.painter:null),this._cacheTimers[u.key]&&(clearTimeout(this._cacheTimers[u.key]),delete this._cacheTimers[u.key],this._setTileReloadTimer(u.key,m)));const w=m;return m||(m=new he(u,this._source.tileSize*u.overscaleFactor()),this._loadTile(m,u.key,m.state)),m.uses++,this._tiles[u.key]=m,w||this._source.fire(new o.l("dataloading",{tile:m,coord:m.tileID,dataType:"source"})),m}_setTileReloadTimer(u,m){u in this._timers&&(clearTimeout(this._timers[u]),delete this._timers[u]);const w=m.getExpiryTimeout();w&&(this._timers[u]=setTimeout((()=>{this._reloadTile(u,"expired"),delete this._timers[u]}),w))}refreshTiles(u){for(const m in this._tiles)(this._isIdRenderable(m)||this._tiles[m].state=="errored")&&u.some((w=>w.equals(this._tiles[m].tileID.canonical)))&&this._reloadTile(m,"expired")}_removeTile(u){const m=this._tiles[u];m&&(m.uses--,delete this._tiles[u],this._timers[u]&&(clearTimeout(this._timers[u]),delete this._timers[u]),m.uses>0||(m.hasData()&&m.state!=="reloading"?this._cache.add(m.tileID,m,m.getExpiryTimeout()):(m.aborted=!0,this._abortTile(m),this._unloadTile(m))))}_dataHandler(u){u.dataType==="source"&&(u.sourceDataType!=="metadata"?u.sourceDataType==="content"&&this._sourceLoaded&&!this._paused&&(this.reload(u.sourceDataChanged),this.transform&&this.update(this.transform,this.terrain),this._didEmitContent=!0):this._sourceLoaded=!0)}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const u in this._tiles)this._removeTile(u);this._cache.reset()}tilesIn(u,m,w){const M=[],R=this.transform;if(!R)return M;const N=R.getCoveringTilesDetailsProvider().allowWorldCopies(),H=w?R.getCameraQueryGeometry(u):u,j=ue=>R.screenPointToMercatorCoordinate(ue,this.terrain),Y=this.transformBbox(u,j,!N),K=this.transformBbox(H,j,!N),ie=this.getIds(),re=o.a2.fromPoints(K);for(let ue=0;ue<ie.length;ue++){const pe=this._tiles[ie[ue]];if(pe.holdingForSymbolFade())continue;const Se=N?[pe.tileID]:[pe.tileID.unwrapTo(-1),pe.tileID.unwrapTo(0)],Te=Math.pow(2,R.zoom-pe.tileID.overscaledZ),Ce=m*pe.queryPadding*o.$/pe.tileSize/Te;for(const Ie of Se){const ke=re.map((Re=>Ie.getTilePoint(new o.a1(Re.x,Re.y))));if(ke.expandBy(Ce),ke.intersects(pi)){const Re=Y.map((He=>Ie.getTilePoint(He))),ze=K.map((He=>Ie.getTilePoint(He)));M.push({tile:pe,tileID:N?Ie:Ie.unwrapTo(0),queryGeometry:Re,cameraQueryGeometry:ze,scale:Te})}}}return M}transformBbox(u,m,w){let M=u.map(m);if(w){const R=o.a2.fromPoints(u);R.shrinkBy(.001*Math.min(R.width(),R.height()));const N=R.map(m);o.a2.fromPoints(M).covers(N)||(M=M.map((H=>H.x>.5?new o.a1(H.x-1,H.y,H.z):H)))}return M}getVisibleCoordinates(u){const m=this.getRenderableIds(u).map((w=>this._tiles[w].tileID));return this.transform&&this.transform.populateCache(m),m}hasTransition(){if(this._source.hasTransition())return!0;if(zn(this._source.type)&&this._rasterFadeDuration>0){const u=y.now();for(const m in this._tiles)if(this._tiles[m].fadeEndTime>=u)return!0}return!1}setRasterFadeDuration(u){this._rasterFadeDuration=u}setFeatureState(u,m,w){this._state.updateState(u=u||"_geojsonTileLayer",m,w)}removeFeatureState(u,m,w){this._state.removeFeatureState(u=u||"_geojsonTileLayer",m,w)}getFeatureState(u,m){return this._state.getState(u=u||"_geojsonTileLayer",m)}setDependencies(u,m,w){const M=this._tiles[u];M&&M.setDependencies(m,w)}reloadTilesForDependencies(u,m){for(const w in this._tiles)this._tiles[w].hasDependency(u,m)&&this._reloadTile(w,"reloading");this._cache.filter((w=>!w.hasDependency(u,m)))}}function ui(I,u){const m=Math.abs(2*I.wrap)-+(I.wrap<0),w=Math.abs(2*u.wrap)-+(u.wrap<0);return I.overscaledZ-u.overscaledZ||w-m||u.canonical.y-I.canonical.y||u.canonical.x-I.canonical.x}function zn(I){return I==="raster"||I==="image"||I==="video"}or.maxOverzooming=10,or.maxUnderzooming=3;class Mn{constructor(u,m){this.reset(u,m)}reset(u,m){this.points=u||[],this._distances=[0];for(let w=1;w<this.points.length;w++)this._distances[w]=this._distances[w-1]+this.points[w].dist(this.points[w-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(m||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(u){if(this.points.length===1)return this.points[0];u=o.ah(u,0,1);let m=1,w=this._distances[m];const M=u*this.paddedLength+this.padding;for(;w<M&&m<this._distances.length;)w=this._distances[++m];const R=m-1,N=this._distances[R],H=w-N,j=H>0?(M-N)/H:0;return this.points[R].mult(1-j).add(this.points[m].mult(j))}}function jn(I,u){let m=!0;return I==="always"||I!=="never"&&u!=="never"||(m=!1),m}class fa{constructor(u,m,w){const M=this.boxCells=[],R=this.circleCells=[];this.xCellCount=Math.ceil(u/w),this.yCellCount=Math.ceil(m/w);for(let N=0;N<this.xCellCount*this.yCellCount;N++)M.push([]),R.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=u,this.height=m,this.xScale=this.xCellCount/u,this.yScale=this.yCellCount/m,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(u,m,w,M,R){this._forEachCell(m,w,M,R,this._insertBoxCell,this.boxUid++),this.boxKeys.push(u),this.bboxes.push(m),this.bboxes.push(w),this.bboxes.push(M),this.bboxes.push(R)}insertCircle(u,m,w,M){this._forEachCell(m-M,w-M,m+M,w+M,this._insertCircleCell,this.circleUid++),this.circleKeys.push(u),this.circles.push(m),this.circles.push(w),this.circles.push(M)}_insertBoxCell(u,m,w,M,R,N){this.boxCells[R].push(N)}_insertCircleCell(u,m,w,M,R,N){this.circleCells[R].push(N)}_query(u,m,w,M,R,N,H){if(w<0||u>this.width||M<0||m>this.height)return[];const j=[];if(u<=0&&m<=0&&this.width<=w&&this.height<=M){if(R)return[{key:null,x1:u,y1:m,x2:w,y2:M}];for(let Y=0;Y<this.boxKeys.length;Y++)j.push({key:this.boxKeys[Y],x1:this.bboxes[4*Y],y1:this.bboxes[4*Y+1],x2:this.bboxes[4*Y+2],y2:this.bboxes[4*Y+3]});for(let Y=0;Y<this.circleKeys.length;Y++){const K=this.circles[3*Y],ie=this.circles[3*Y+1],re=this.circles[3*Y+2];j.push({key:this.circleKeys[Y],x1:K-re,y1:ie-re,x2:K+re,y2:ie+re})}}else this._forEachCell(u,m,w,M,this._queryCell,j,{hitTest:R,overlapMode:N,seenUids:{box:{},circle:{}}},H);return j}query(u,m,w,M){return this._query(u,m,w,M,!1,null)}hitTest(u,m,w,M,R,N){return this._query(u,m,w,M,!0,R,N).length>0}hitTestCircle(u,m,w,M,R){const N=u-w,H=u+w,j=m-w,Y=m+w;if(H<0||N>this.width||Y<0||j>this.height)return!1;const K=[];return this._forEachCell(N,j,H,Y,this._queryCellCircle,K,{hitTest:!0,overlapMode:M,circle:{x:u,y:m,radius:w},seenUids:{box:{},circle:{}}},R),K.length>0}_queryCell(u,m,w,M,R,N,H,j){const{seenUids:Y,hitTest:K,overlapMode:ie}=H,re=this.boxCells[R];if(re!==null){const pe=this.bboxes;for(const Se of re)if(!Y.box[Se]){Y.box[Se]=!0;const Te=4*Se,Ce=this.boxKeys[Se];if(u<=pe[Te+2]&&m<=pe[Te+3]&&w>=pe[Te+0]&&M>=pe[Te+1]&&(!j||j(Ce))&&(!K||!jn(ie,Ce.overlapMode))&&(N.push({key:Ce,x1:pe[Te],y1:pe[Te+1],x2:pe[Te+2],y2:pe[Te+3]}),K))return!0}}const ue=this.circleCells[R];if(ue!==null){const pe=this.circles;for(const Se of ue)if(!Y.circle[Se]){Y.circle[Se]=!0;const Te=3*Se,Ce=this.circleKeys[Se];if(this._circleAndRectCollide(pe[Te],pe[Te+1],pe[Te+2],u,m,w,M)&&(!j||j(Ce))&&(!K||!jn(ie,Ce.overlapMode))){const Ie=pe[Te],ke=pe[Te+1],Re=pe[Te+2];if(N.push({key:Ce,x1:Ie-Re,y1:ke-Re,x2:Ie+Re,y2:ke+Re}),K)return!0}}}return!1}_queryCellCircle(u,m,w,M,R,N,H,j){const{circle:Y,seenUids:K,overlapMode:ie}=H,re=this.boxCells[R];if(re!==null){const pe=this.bboxes;for(const Se of re)if(!K.box[Se]){K.box[Se]=!0;const Te=4*Se,Ce=this.boxKeys[Se];if(this._circleAndRectCollide(Y.x,Y.y,Y.radius,pe[Te+0],pe[Te+1],pe[Te+2],pe[Te+3])&&(!j||j(Ce))&&!jn(ie,Ce.overlapMode))return N.push(!0),!0}}const ue=this.circleCells[R];if(ue!==null){const pe=this.circles;for(const Se of ue)if(!K.circle[Se]){K.circle[Se]=!0;const Te=3*Se,Ce=this.circleKeys[Se];if(this._circlesCollide(pe[Te],pe[Te+1],pe[Te+2],Y.x,Y.y,Y.radius)&&(!j||j(Ce))&&!jn(ie,Ce.overlapMode))return N.push(!0),!0}}}_forEachCell(u,m,w,M,R,N,H,j){const Y=this._convertToXCellCoord(u),K=this._convertToYCellCoord(m),ie=this._convertToXCellCoord(w),re=this._convertToYCellCoord(M);for(let ue=Y;ue<=ie;ue++)for(let pe=K;pe<=re;pe++)if(R.call(this,u,m,w,M,this.xCellCount*pe+ue,N,H,j))return}_convertToXCellCoord(u){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(u*this.xScale)))}_convertToYCellCoord(u){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(u*this.yScale)))}_circlesCollide(u,m,w,M,R,N){const H=M-u,j=R-m,Y=w+N;return Y*Y>H*H+j*j}_circleAndRectCollide(u,m,w,M,R,N,H){const j=(N-M)/2,Y=Math.abs(u-(M+j));if(Y>j+w)return!1;const K=(H-R)/2,ie=Math.abs(m-(R+K));if(ie>K+w)return!1;if(Y<=j||ie<=K)return!0;const re=Y-j,ue=ie-K;return re*re+ue*ue<=w*w}}function Vi(I,u,m){const w=o.L();if(!I){const{vecSouth:ie,vecEast:re}=Ti(u),ue=c();ue[0]=re[0],ue[1]=re[1],ue[2]=ie[0],ue[3]=ie[1],M=ue,(K=(N=(R=ue)[0])*(Y=R[3])-(j=R[2])*(H=R[1]))&&(M[0]=Y*(K=1/K),M[1]=-H*K,M[2]=-j*K,M[3]=N*K),w[0]=ue[0],w[1]=ue[1],w[4]=ue[2],w[5]=ue[3]}var M,R,N,H,j,Y,K;return o.N(w,w,[1/m,1/m,1]),w}function $n(I,u,m,w){if(I){const M=o.L();if(!u){const{vecSouth:R,vecEast:N}=Ti(m);M[0]=N[0],M[1]=N[1],M[4]=R[0],M[5]=R[1]}return o.N(M,M,[w,w,1]),M}return m.pixelsToClipSpaceMatrix}function Ti(I){const u=Math.cos(I.rollInRadians),m=Math.sin(I.rollInRadians),w=Math.cos(I.pitchInRadians),M=Math.cos(I.bearingInRadians),R=Math.sin(I.bearingInRadians),N=o.ar();N[0]=-M*w*m-R*u,N[1]=-R*w*m+M*u;const H=o.as(N);H<1e-9?o.at(N):o.au(N,N,1/H);const j=o.ar();j[0]=M*w*u-R*m,j[1]=R*w*u+M*m;const Y=o.as(j);return Y<1e-9?o.at(j):o.au(j,j,1/Y),{vecEast:j,vecSouth:N}}function It(I,u,m,w){let M;w?(M=[I,u,w(I,u),1],o.aw(M,M,m)):(M=[I,u,0,1],mn(M,M,m));const R=M[3];return{point:new o.P(M[0]/R,M[1]/R),signedDistanceFromCamera:R,isOccluded:!1}}function Os(I,u){return .5+I/u*.5}function mo(I,u){return I.x>=-u[0]&&I.x<=u[0]&&I.y>=-u[1]&&I.y<=u[1]}function Wn(I,u,m,w,M,R,N,H,j,Y,K,ie,re){const ue=m?I.textSizeData:I.iconSizeData,pe=o.an(ue,u.transform.zoom),Se=[256/u.width*2+1,256/u.height*2+1],Te=m?I.text.dynamicLayoutVertexArray:I.icon.dynamicLayoutVertexArray;Te.clear();const Ce=I.lineVertexArray,Ie=m?I.text.placedSymbolArray:I.icon.placedSymbolArray,ke=u.transform.width/u.transform.height;let Re=!1;for(let ze=0;ze<Ie.length;ze++){const He=Ie.get(ze);if(He.hidden||He.writingMode===o.ao.vertical&&!Re){yo(He.numGlyphs,Te);continue}Re=!1;const Le=new o.P(He.anchorX,He.anchorY),Xe={getElevation:re,pitchedLabelPlaneMatrix:w,lineVertexArray:Ce,pitchWithMap:R,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},transform:u.transform,tileAnchorPoint:Le,unwrappedTileID:j,width:Y,height:K,translation:ie},ht=Nr(He.anchorX,He.anchorY,Xe);if(!mo(ht.point,Se)){yo(He.numGlyphs,Te);continue}const at=Os(u.transform.cameraToCenterDistance,ht.signedDistanceFromCamera),st=o.ap(ue,pe,He),lt=R?st*u.transform.getPitchedTextCorrection(He.anchorX,He.anchorY,j)/at:st*at,Ot=Br({projectionContext:Xe,pitchedLabelPlaneMatrixInverse:M,symbol:He,fontSize:lt,flip:!1,keepUpright:N,glyphOffsetArray:I.glyphOffsetArray,dynamicLayoutVertexArray:Te,aspectRatio:ke,rotateToLine:H});Re=Ot.useVertical,(Ot.notEnoughRoom||Re||Ot.needsFlipping&&Br({projectionContext:Xe,pitchedLabelPlaneMatrixInverse:M,symbol:He,fontSize:lt,flip:!0,keepUpright:N,glyphOffsetArray:I.glyphOffsetArray,dynamicLayoutVertexArray:Te,aspectRatio:ke,rotateToLine:H}).notEnoughRoom)&&yo(He.numGlyphs,Te)}m?I.text.dynamicLayoutVertexBuffer.updateData(Te):I.icon.dynamicLayoutVertexBuffer.updateData(Te)}function mi(I,u,m,w,M,R,N,H){const j=R.glyphStartIndex+R.numGlyphs,Y=R.lineStartIndex,K=R.lineStartIndex+R.lineLength,ie=u.getoffsetX(R.glyphStartIndex),re=u.getoffsetX(j-1),ue=is(I*ie,m,w,M,R.segment,Y,K,H,N);if(!ue)return null;const pe=is(I*re,m,w,M,R.segment,Y,K,H,N);return pe?H.projectionCache.anyProjectionOccluded?null:{first:ue,last:pe}:null}function Lt(I,u,m,w){return I===o.ao.horizontal&&Math.abs(m.y-u.y)>Math.abs(m.x-u.x)*w?{useVertical:!0}:(I===o.ao.vertical?u.y<m.y:u.x>m.x)?{needsFlipping:!0}:null}function Br(I){const{projectionContext:u,pitchedLabelPlaneMatrixInverse:m,symbol:w,fontSize:M,flip:R,keepUpright:N,glyphOffsetArray:H,dynamicLayoutVertexArray:j,aspectRatio:Y,rotateToLine:K}=I,ie=M/24,re=w.lineOffsetX*ie,ue=w.lineOffsetY*ie;let pe;if(w.numGlyphs>1){const Se=w.glyphStartIndex+w.numGlyphs,Te=w.lineStartIndex,Ce=w.lineStartIndex+w.lineLength,Ie=mi(ie,H,re,ue,R,w,K,u);if(!Ie)return{notEnoughRoom:!0};const ke=Ns(Ie.first.point.x,Ie.first.point.y,u,m),Re=Ns(Ie.last.point.x,Ie.last.point.y,u,m);if(N&&!R){const ze=Lt(w.writingMode,ke,Re,Y);if(ze)return ze}pe=[Ie.first];for(let ze=w.glyphStartIndex+1;ze<Se-1;ze++){const He=is(ie*H.getoffsetX(ze),re,ue,R,w.segment,Te,Ce,u,K);if(!He)return{notEnoughRoom:!0};pe.push(He)}pe.push(Ie.last)}else{if(N&&!R){const Te=ul(u.tileAnchorPoint.x,u.tileAnchorPoint.y,u).point,Ce=w.lineStartIndex+w.segment+1,Ie=new o.P(u.lineVertexArray.getx(Ce),u.lineVertexArray.gety(Ce)),ke=ul(Ie.x,Ie.y,u),Re=ke.signedDistanceFromCamera>0?ke.point:Ur(u.tileAnchorPoint,Ie,Te,1,u),ze=Ns(Te.x,Te.y,u,m),He=Ns(Re.x,Re.y,u,m),Le=Lt(w.writingMode,ze,He,Y);if(Le)return Le}const Se=is(ie*H.getoffsetX(w.glyphStartIndex),re,ue,R,w.segment,w.lineStartIndex,w.lineStartIndex+w.lineLength,u,K);if(!Se||u.projectionCache.anyProjectionOccluded)return{notEnoughRoom:!0};pe=[Se]}for(const Se of pe)o.av(j,Se.point,Se.angle);return{}}function Ur(I,u,m,w,M){const R=I.add(I.sub(u)._unit()),N=ul(R.x,R.y,M).point,H=m.sub(N);return m.add(H._mult(w/H.mag()))}function ko(I,u,m){const w=u.projectionCache;if(w.projections[I])return w.projections[I];const M=new o.P(u.lineVertexArray.getx(I),u.lineVertexArray.gety(I)),R=ul(M.x,M.y,u);if(R.signedDistanceFromCamera>0)return w.projections[I]=R.point,w.anyProjectionOccluded=w.anyProjectionOccluded||R.isOccluded,R.point;const N=I-m.direction;return Ur(m.distanceFromAnchor===0?u.tileAnchorPoint:new o.P(u.lineVertexArray.getx(N),u.lineVertexArray.gety(N)),M,m.previousVertex,m.absOffsetX-m.distanceFromAnchor+1,u)}function ul(I,u,m){const w=I+m.translation[0],M=u+m.translation[1];let R;return m.pitchWithMap?(R=It(w,M,m.pitchedLabelPlaneMatrix,m.getElevation),R.isOccluded=!1):(R=m.transform.projectTileCoordinates(w,M,m.unwrappedTileID,m.getElevation),R.point.x=(.5*R.point.x+.5)*m.width,R.point.y=(.5*-R.point.y+.5)*m.height),R}function Ns(I,u,m,w){if(m.pitchWithMap){const M=[I,u,0,1];return o.aw(M,M,w),m.transform.projectTileCoordinates(M[0]/M[3],M[1]/M[3],m.unwrappedTileID,m.getElevation).point}return{x:I/m.width*2-1,y:1-u/m.height*2}}function Nr(I,u,m){return m.transform.projectTileCoordinates(I,u,m.unwrappedTileID,m.getElevation)}function wu(I,u,m){return I._unit()._perp()._mult(u*m)}function cl(I,u,m,w,M,R,N,H,j){if(H.projectionCache.offsets[I])return H.projectionCache.offsets[I];const Y=m.add(u);if(I+j.direction<w||I+j.direction>=M)return H.projectionCache.offsets[I]=Y,Y;const K=ko(I+j.direction,H,j),ie=wu(K.sub(m),N,j.direction),re=m.add(ie),ue=K.add(ie);return H.projectionCache.offsets[I]=o.ax(R,Y,re,ue)||Y,H.projectionCache.offsets[I]}function is(I,u,m,w,M,R,N,H,j){const Y=w?I-u:I+u;let K=Y>0?1:-1,ie=0;w&&(K*=-1,ie=Math.PI),K<0&&(ie+=Math.PI);let re,ue=K>0?R+M:R+M+1;H.projectionCache.cachedAnchorPoint?re=H.projectionCache.cachedAnchorPoint:(re=ul(H.tileAnchorPoint.x,H.tileAnchorPoint.y,H).point,H.projectionCache.cachedAnchorPoint=re);let pe,Se,Te=re,Ce=re,Ie=0,ke=0;const Re=Math.abs(Y),ze=[];let He;for(;Ie+ke<=Re;){if(ue+=K,ue<R||ue>=N)return null;Ie+=ke,Ce=Te,Se=pe;const ht={absOffsetX:Re,direction:K,distanceFromAnchor:Ie,previousVertex:Ce};if(Te=ko(ue,H,ht),m===0)ze.push(Ce),He=Te.sub(Ce);else{let at;const st=Te.sub(Ce);at=st.mag()===0?wu(ko(ue+K,H,ht).sub(Te),m,K):wu(st,m,K),Se||(Se=Ce.add(at)),pe=cl(ue,at,Te,R,N,Se,m,H,ht),ze.push(Se),He=pe.sub(Se)}ke=He.mag()}const Le=He._mult((Re-Ie)/ke)._add(Se||Ce),Xe=ie+Math.atan2(Te.y-Ce.y,Te.x-Ce.x);return ze.push(Le),{point:Le,angle:j?Xe:0,path:ze}}const Ol=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function yo(I,u){for(let m=0;m<I;m++){const w=u.length;u.resize(w+4),u.float32.set(Ol,3*w)}}function mn(I,u,m){const w=u[0],M=u[1];return I[0]=m[0]*w+m[4]*M+m[12],I[1]=m[1]*w+m[5]*M+m[13],I[3]=m[3]*w+m[7]*M+m[15],I}const Pn=100;class _o{constructor(u,m=new fa(u.width+200,u.height+200,25),w=new fa(u.width+200,u.height+200,25)){this.transform=u,this.grid=m,this.ignoredGrid=w,this.pitchFactor=Math.cos(u.pitch*Math.PI/180)*u.cameraToCenterDistance,this.screenRightBoundary=u.width+Pn,this.screenBottomBoundary=u.height+Pn,this.gridRightBoundary=u.width+200,this.gridBottomBoundary=u.height+200,this.perspectiveRatioCutoff=.6}placeCollisionBox(u,m,w,M,R,N,H,j,Y,K,ie,re){const ue=this.projectAndGetPerspectiveRatio(u.anchorPointX+j[0],u.anchorPointY+j[1],R,K,re),pe=w*ue.perspectiveRatio;let Se;if(N||H)Se=this._projectCollisionBox(u,pe,M,R,N,H,j,ue,K,ie,re);else{const He=ue.x+(ie?ie.x*pe:0),Le=ue.y+(ie?ie.y*pe:0);Se={allPointsOccluded:!1,box:[He+u.x1*pe,Le+u.y1*pe,He+u.x2*pe,Le+u.y2*pe]}}const[Te,Ce,Ie,ke]=Se.box,Re=N?Se.allPointsOccluded:ue.isOccluded;let ze=Re;return ze||(ze=ue.perspectiveRatio<this.perspectiveRatioCutoff),ze||(ze=!this.isInsideGrid(Te,Ce,Ie,ke)),ze||m!=="always"&&this.grid.hitTest(Te,Ce,Ie,ke,m,Y)?{box:[Te,Ce,Ie,ke],placeable:!1,offscreen:!1,occluded:Re}:{box:[Te,Ce,Ie,ke],placeable:!0,offscreen:this.isOffscreen(Te,Ce,Ie,ke),occluded:Re}}placeCollisionCircles(u,m,w,M,R,N,H,j,Y,K,ie,re,ue,pe){const Se=[],Te=new o.P(m.anchorX,m.anchorY),Ce=this.getPerspectiveRatio(Te.x,Te.y,N,pe),Ie=(Y?R*this.transform.getPitchedTextCorrection(m.anchorX,m.anchorY,N)/Ce:R*Ce)/o.aB,ke={getElevation:pe,pitchedLabelPlaneMatrix:H,lineVertexArray:w,pitchWithMap:Y,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},transform:this.transform,tileAnchorPoint:Te,unwrappedTileID:N,width:this.transform.width,height:this.transform.height,translation:ue},Re=mi(Ie,M,m.lineOffsetX*Ie,m.lineOffsetY*Ie,!1,m,!1,ke);let ze=!1,He=!1,Le=!0;if(Re){const Xe=.5*ie*Ce+re,ht=new o.P(-100,-100),at=new o.P(this.screenRightBoundary,this.screenBottomBoundary),st=new Mn,lt=Re.first,Ot=Re.last;let Bt=[];for(let Pr=lt.path.length-1;Pr>=1;Pr--)Bt.push(lt.path[Pr]);for(let Pr=1;Pr<Ot.path.length;Pr++)Bt.push(Ot.path[Pr]);const Ct=2.5*Xe;if(Y){const Pr=this.projectPathToScreenSpace(Bt,ke);Bt=Pr.some((gi=>gi.signedDistanceFromCamera<=0))?[]:Pr.map((gi=>gi.point))}let nr=[];if(Bt.length>0){const Pr=Bt[0].clone(),gi=Bt[0].clone();for(let Mi=1;Mi<Bt.length;Mi++)Pr.x=Math.min(Pr.x,Bt[Mi].x),Pr.y=Math.min(Pr.y,Bt[Mi].y),gi.x=Math.max(gi.x,Bt[Mi].x),gi.y=Math.max(gi.y,Bt[Mi].y);nr=Pr.x>=ht.x&&gi.x<=at.x&&Pr.y>=ht.y&&gi.y<=at.y?[Bt]:gi.x<ht.x||Pr.x>at.x||gi.y<ht.y||Pr.y>at.y?[]:o.ay([Bt],ht.x,ht.y,at.x,at.y)}for(const Pr of nr){st.reset(Pr,.25*Xe);let gi=0;gi=st.length<=.5*Xe?1:Math.ceil(st.paddedLength/Ct)+1;for(let Mi=0;Mi<gi;Mi++){const Ei=Mi/Math.max(gi-1,1),Ji=st.lerp(Ei),$i=Ji.x+Pn,Jr=Ji.y+Pn;Se.push($i,Jr,Xe,0);const fn=$i-Xe,ba=Jr-Xe,kn=$i+Xe,Ln=Jr+Xe;if(Le=Le&&this.isOffscreen(fn,ba,kn,Ln),He=He||this.isInsideGrid(fn,ba,kn,Ln),u!=="always"&&this.grid.hitTestCircle($i,Jr,Xe,u,K)&&(ze=!0,!j))return{circles:[],offscreen:!1,collisionDetected:ze}}}}return{circles:!j&&ze||!He||Ce<this.perspectiveRatioCutoff?[]:Se,offscreen:Le,collisionDetected:ze}}projectPathToScreenSpace(u,m){const w=(function(M,R){const N=o.L();return o.aq(N,R.pitchedLabelPlaneMatrix),M.map((H=>{const j=It(H.x,H.y,N,R.getElevation),Y=R.transform.projectTileCoordinates(j.point.x,j.point.y,R.unwrappedTileID,R.getElevation);return Y.point.x=(.5*Y.point.x+.5)*R.width,Y.point.y=(.5*-Y.point.y+.5)*R.height,Y}))})(u,m);return(function(M){let R=0,N=0,H=0,j=0;for(let Y=0;Y<M.length;Y++)M[Y].isOccluded?(H=Y+1,j=0):(j++,j>N&&(N=j,R=H));return M.slice(R,R+N)})(w)}queryRenderedSymbols(u){if(u.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const m=[],w=new o.a2;for(const ie of u){const re=new o.P(ie.x+Pn,ie.y+Pn);w.extend(re),m.push(re)}const{minX:M,minY:R,maxX:N,maxY:H}=w,j=this.grid.query(M,R,N,H).concat(this.ignoredGrid.query(M,R,N,H)),Y={},K={};for(const ie of j){const re=ie.key;if(Y[re.bucketInstanceId]===void 0&&(Y[re.bucketInstanceId]={}),Y[re.bucketInstanceId][re.featureIndex])continue;const ue=[new o.P(ie.x1,ie.y1),new o.P(ie.x2,ie.y1),new o.P(ie.x2,ie.y2),new o.P(ie.x1,ie.y2)];o.az(m,ue)&&(Y[re.bucketInstanceId][re.featureIndex]=!0,K[re.bucketInstanceId]===void 0&&(K[re.bucketInstanceId]=[]),K[re.bucketInstanceId].push(re.featureIndex))}return K}insertCollisionBox(u,m,w,M,R,N){(w?this.ignoredGrid:this.grid).insert({bucketInstanceId:M,featureIndex:R,collisionGroupID:N,overlapMode:m},u[0],u[1],u[2],u[3])}insertCollisionCircles(u,m,w,M,R,N){const H=w?this.ignoredGrid:this.grid,j={bucketInstanceId:M,featureIndex:R,collisionGroupID:N,overlapMode:m};for(let Y=0;Y<u.length;Y+=4)H.insertCircle(j,u[Y],u[Y+1],u[Y+2])}projectAndGetPerspectiveRatio(u,m,w,M,R){if(R){let N;M?(N=[u,m,M(u,m),1],o.aw(N,N,R)):(N=[u,m,0,1],mn(N,N,R));const H=N[3];return{x:(N[0]/H+1)/2*this.transform.width+Pn,y:(-N[1]/H+1)/2*this.transform.height+Pn,perspectiveRatio:.5+this.transform.cameraToCenterDistance/H*.5,isOccluded:!1,signedDistanceFromCamera:H}}{const N=this.transform.projectTileCoordinates(u,m,w,M);return{x:(N.point.x+1)/2*this.transform.width+Pn,y:(1-N.point.y)/2*this.transform.height+Pn,perspectiveRatio:.5+this.transform.cameraToCenterDistance/N.signedDistanceFromCamera*.5,isOccluded:N.isOccluded,signedDistanceFromCamera:N.signedDistanceFromCamera}}}getPerspectiveRatio(u,m,w,M){const R=this.transform.projectTileCoordinates(u,m,w,M);return .5+this.transform.cameraToCenterDistance/R.signedDistanceFromCamera*.5}isOffscreen(u,m,w,M){return w<Pn||u>=this.screenRightBoundary||M<Pn||m>this.screenBottomBoundary}isInsideGrid(u,m,w,M){return w>=0&&u<this.gridRightBoundary&&M>=0&&m<this.gridBottomBoundary}getViewportMatrix(){const u=o.ag([]);return o.M(u,u,[-100,-100,0]),u}_projectCollisionBox(u,m,w,M,R,N,H,j,Y,K,ie){let re=1,ue=0,pe=0,Se=1;const Te=u.anchorPointX+H[0],Ce=u.anchorPointY+H[1];if(N&&!R){const Bt=this.projectAndGetPerspectiveRatio(Te+1,Ce,M,Y,ie),Ct=Bt.x-j.x,nr=Math.atan((Bt.y-j.y)/Ct)+(Ct<0?Math.PI:0),Pr=Math.sin(nr),gi=Math.cos(nr);re=gi,ue=Pr,pe=-Pr,Se=gi}else if(!N&&R){const Bt=Ti(this.transform);re=Bt.vecEast[0],ue=Bt.vecEast[1],pe=Bt.vecSouth[0],Se=Bt.vecSouth[1]}let Ie=j.x,ke=j.y,Re=m;R&&(Ie=Te,ke=Ce,Re=Math.pow(2,-(this.transform.zoom-w.overscaledZ)),Re*=this.transform.getPitchedTextCorrection(Te,Ce,M),K||(Re*=o.ah(.5+j.signedDistanceFromCamera/this.transform.cameraToCenterDistance*.5,0,4))),K&&(Ie+=re*K.x*Re+pe*K.y*Re,ke+=ue*K.x*Re+Se*K.y*Re);const ze=u.x1*Re,He=u.x2*Re,Le=(ze+He)/2,Xe=u.y1*Re,ht=u.y2*Re,at=(Xe+ht)/2,st=[{offsetX:ze,offsetY:Xe},{offsetX:Le,offsetY:Xe},{offsetX:He,offsetY:Xe},{offsetX:He,offsetY:at},{offsetX:He,offsetY:ht},{offsetX:Le,offsetY:ht},{offsetX:ze,offsetY:ht},{offsetX:ze,offsetY:at}];let lt=[];for(const{offsetX:Bt,offsetY:Ct}of st)lt.push(new o.P(Ie+re*Bt+pe*Ct,ke+ue*Bt+Se*Ct));let Ot=!1;if(R){const Bt=lt.map((Ct=>this.projectAndGetPerspectiveRatio(Ct.x,Ct.y,M,Y,ie)));Ot=Bt.some((Ct=>!Ct.isOccluded)),lt=Bt.map((Ct=>new o.P(Ct.x,Ct.y)))}else Ot=!0;return{box:o.aA(lt),allPointsOccluded:!Ot}}}class Ri{constructor(u,m,w,M){this.opacity=u?Math.max(0,Math.min(1,u.opacity+(u.placed?m:-m))):M&&w?1:0,this.placed=w}isHidden(){return this.opacity===0&&!this.placed}}class hl{constructor(u,m,w,M,R){this.text=new Ri(u?u.text:null,m,w,R),this.icon=new Ri(u?u.icon:null,m,M,R)}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class Oh{constructor(u,m,w){this.text=u,this.icon=m,this.skipFade=w}}class yp{constructor(u,m,w,M,R){this.bucketInstanceId=u,this.featureIndex=m,this.sourceLayerIndex=w,this.bucketIndex=M,this.tileID=R}}class Su{constructor(u){this.crossSourceCollisions=u,this.maxGroupID=0,this.collisionGroups={}}get(u){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[u]){const m=++this.maxGroupID;this.collisionGroups[u]={ID:m,predicate:w=>w.collisionGroupID===m}}return this.collisionGroups[u]}}function Nl(I,u,m,w,M){const{horizontalAlign:R,verticalAlign:N}=o.aH(I);return new o.P(-(R-.5)*u+w[0]*M,-(N-.5)*m+w[1]*M)}class qf{constructor(u,m,w,M,R){this.transform=u.clone(),this.terrain=m,this.collisionIndex=new _o(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=w,this.retainedQueryData={},this.collisionGroups=new Su(M),this.collisionCircleArrays={},this.collisionBoxArrays=new Map,this.prevPlacement=R,R&&(R.prevPlacement=void 0),this.placedOrientations={}}_getTerrainElevationFunc(u){const m=this.terrain;return m?(w,M)=>m.getElevation(u,w,M):null}getBucketParts(u,m,w,M){const R=w.getBucket(m),N=w.latestFeatureIndex;if(!R||!N||m.id!==R.layerIds[0])return;const H=w.collisionBoxArray,j=R.layers[0].layout,Y=R.layers[0].paint,K=Math.pow(2,this.transform.zoom-w.tileID.overscaledZ),ie=w.tileSize/o.$,re=w.tileID.toUnwrapped(),ue=j.get("text-rotation-alignment")==="map",pe=o.aC(w,1,this.transform.zoom),Se=o.aD(this.collisionIndex.transform,w,Y.get("text-translate"),Y.get("text-translate-anchor")),Te=o.aD(this.collisionIndex.transform,w,Y.get("icon-translate"),Y.get("icon-translate-anchor")),Ce=Vi(ue,this.transform,pe);this.retainedQueryData[R.bucketInstanceId]=new yp(R.bucketInstanceId,N,R.sourceLayerIndex,R.index,w.tileID);const Ie={bucket:R,layout:j,translationText:Se,translationIcon:Te,unwrappedTileID:re,pitchedLabelPlaneMatrix:Ce,scale:K,textPixelRatio:ie,holdingForFade:w.holdingForSymbolFade(),collisionBoxArray:H,partiallyEvaluatedTextSize:o.an(R.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(R.sourceID)};if(M)for(const ke of R.sortKeyRanges){const{sortKey:Re,symbolInstanceStart:ze,symbolInstanceEnd:He}=ke;u.push({sortKey:Re,symbolInstanceStart:ze,symbolInstanceEnd:He,parameters:Ie})}else u.push({symbolInstanceStart:0,symbolInstanceEnd:R.symbolInstances.length,parameters:Ie})}attemptAnchorPlacement(u,m,w,M,R,N,H,j,Y,K,ie,re,ue,pe,Se,Te,Ce,Ie,ke,Re){const ze=o.aE[u.textAnchor],He=[u.textOffset0,u.textOffset1],Le=Nl(ze,w,M,He,R),Xe=this.collisionIndex.placeCollisionBox(m,re,j,Y,K,H,N,Te,ie.predicate,ke,Le,Re);if((!Ie||this.collisionIndex.placeCollisionBox(Ie,re,j,Y,K,H,N,Ce,ie.predicate,ke,Le,Re).placeable)&&Xe.placeable){let ht;if(this.prevPlacement&&this.prevPlacement.variableOffsets[ue.crossTileID]&&this.prevPlacement.placements[ue.crossTileID]&&this.prevPlacement.placements[ue.crossTileID].text&&(ht=this.prevPlacement.variableOffsets[ue.crossTileID].anchor),ue.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");return this.variableOffsets[ue.crossTileID]={textOffset:He,width:w,height:M,anchor:ze,textBoxScale:R,prevAnchor:ht},this.markUsedJustification(pe,ze,ue,Se),pe.allowVerticalPlacement&&(this.markUsedOrientation(pe,Se,ue),this.placedOrientations[ue.crossTileID]=Se),{shift:Le,placedGlyphBoxes:Xe}}}placeLayerBucketPart(u,m,w){const{bucket:M,layout:R,translationText:N,translationIcon:H,unwrappedTileID:j,pitchedLabelPlaneMatrix:Y,textPixelRatio:K,holdingForFade:ie,collisionBoxArray:re,partiallyEvaluatedTextSize:ue,collisionGroup:pe}=u.parameters,Se=R.get("text-optional"),Te=R.get("icon-optional"),Ce=o.aF(R,"text-overlap","text-allow-overlap"),Ie=Ce==="always",ke=o.aF(R,"icon-overlap","icon-allow-overlap"),Re=ke==="always",ze=R.get("text-rotation-alignment")==="map",He=R.get("text-pitch-alignment")==="map",Le=R.get("icon-text-fit")!=="none",Xe=R.get("symbol-z-order")==="viewport-y",ht=Ie&&(Re||!M.hasIconData()||Te),at=Re&&(Ie||!M.hasTextData()||Se);!M.collisionArrays&&re&&M.deserializeCollisionBoxes(re);const st=this.retainedQueryData[M.bucketInstanceId].tileID,lt=this._getTerrainElevationFunc(st),Ot=this.transform.getFastPathSimpleProjectionMatrix(st),Bt=(Ct,nr,Pr)=>{var gi,Mi;if(m[Ct.crossTileID])return;if(ie)return void(this.placements[Ct.crossTileID]=new Oh(!1,!1,!1));let Ei=!1,Ji=!1,$i=!0,Jr=null,fn={box:null,placeable:!1,offscreen:null,occluded:!1},ba={placeable:!1},kn=null,Ln=null,Va=null,eu=0,Wo=0,tu=0;nr.textFeatureIndex?eu=nr.textFeatureIndex:Ct.useRuntimeCollisionCircles&&(eu=Ct.featureIndex),nr.verticalTextFeatureIndex&&(Wo=nr.verticalTextFeatureIndex);const Zu=nr.textBox;if(Zu){const Go=_n=>{let Xn=o.ao.horizontal;if(M.allowVerticalPlacement&&!_n&&this.prevPlacement){const To=this.prevPlacement.placedOrientations[Ct.crossTileID];To&&(this.placedOrientations[Ct.crossTileID]=To,Xn=To,this.markUsedOrientation(M,Xn,Ct))}return Xn},hs=(_n,Xn)=>{if(M.allowVerticalPlacement&&Ct.numVerticalGlyphVertices>0&&nr.verticalTextBox){for(const To of M.writingModes)if(To===o.ao.vertical?(fn=Xn(),ba=fn):fn=_n(),fn&&fn.placeable)break}else fn=_n()},Gs=Ct.textAnchorOffsetStartIndex,So=Ct.textAnchorOffsetEndIndex;if(So===Gs){const _n=(Xn,To)=>{const xa=this.collisionIndex.placeCollisionBox(Xn,Ce,K,st,j,He,ze,N,pe.predicate,lt,void 0,Ot);return xa&&xa.placeable&&(this.markUsedOrientation(M,To,Ct),this.placedOrientations[Ct.crossTileID]=To),xa};hs((()=>_n(Zu,o.ao.horizontal)),(()=>{const Xn=nr.verticalTextBox;return M.allowVerticalPlacement&&Ct.numVerticalGlyphVertices>0&&Xn?_n(Xn,o.ao.vertical):{box:null,offscreen:null}})),Go(fn&&fn.placeable)}else{let _n=o.aE[(Mi=(gi=this.prevPlacement)===null||gi===void 0?void 0:gi.variableOffsets[Ct.crossTileID])===null||Mi===void 0?void 0:Mi.anchor];const Xn=(xa,Cv,rf)=>{const Xs=xa.x2-xa.x1,Zs=xa.y2-xa.y1,Ao=Ct.textBoxScale,ru=Le&&ke==="never"?Cv:null;let iu=null,rh=Ce==="never"?1:2,Fp="never";_n&&rh++;for(let Cl=0;Cl<rh;Cl++){for(let Vp=Gs;Vp<So;Vp++){const Md=M.textAnchorOffsets.get(Vp);if(_n&&Md.textAnchor!==_n)continue;const ih=this.attemptAnchorPlacement(Md,xa,Xs,Zs,Ao,ze,He,K,st,j,pe,Fp,Ct,M,rf,N,H,ru,lt);if(ih&&(iu=ih.placedGlyphBoxes,iu&&iu.placeable))return Ei=!0,Jr=ih.shift,iu}_n?_n=null:Fp=Ce}return w&&!iu&&(iu={box:this.collisionIndex.placeCollisionBox(Zu,"always",K,st,j,He,ze,N,pe.predicate,lt,void 0,Ot).box,offscreen:!1,placeable:!1,occluded:!1}),iu};hs((()=>Xn(Zu,nr.iconBox,o.ao.horizontal)),(()=>{const xa=nr.verticalTextBox;return M.allowVerticalPlacement&&(!fn||!fn.placeable)&&Ct.numVerticalGlyphVertices>0&&xa?Xn(xa,nr.verticalIconBox,o.ao.vertical):{box:null,occluded:!0,offscreen:null}})),fn&&(Ei=fn.placeable,$i=fn.offscreen);const To=Go(fn&&fn.placeable);if(!Ei&&this.prevPlacement){const xa=this.prevPlacement.variableOffsets[Ct.crossTileID];xa&&(this.variableOffsets[Ct.crossTileID]=xa,this.markUsedJustification(M,xa.anchor,Ct,To))}}}if(kn=fn,Ei=kn&&kn.placeable,$i=kn&&kn.offscreen,Ct.useRuntimeCollisionCircles&&Ct.centerJustifiedTextSymbolIndex>=0){const Go=M.text.placedSymbolArray.get(Ct.centerJustifiedTextSymbolIndex),hs=o.ap(M.textSizeData,ue,Go),Gs=R.get("text-padding");Ln=this.collisionIndex.placeCollisionCircles(Ce,Go,M.lineVertexArray,M.glyphOffsetArray,hs,j,Y,w,He,pe.predicate,Ct.collisionCircleDiameter,Gs,N,lt),Ln.circles.length&&Ln.collisionDetected&&!w&&o.w("Collisions detected, but collision boxes are not shown"),Ei=Ie||Ln.circles.length>0&&!Ln.collisionDetected,$i=$i&&Ln.offscreen}if(nr.iconFeatureIndex&&(tu=nr.iconFeatureIndex),nr.iconBox){const Go=hs=>this.collisionIndex.placeCollisionBox(hs,ke,K,st,j,He,ze,H,pe.predicate,lt,Le&&Jr?Jr:void 0,Ot);ba&&ba.placeable&&nr.verticalIconBox?(Va=Go(nr.verticalIconBox),Ji=Va.placeable):(Va=Go(nr.iconBox),Ji=Va.placeable),$i=$i&&Va.offscreen}const tf=Se||Ct.numHorizontalGlyphVertices===0&&Ct.numVerticalGlyphVertices===0,th=Te||Ct.numIconVertices===0;tf||th?th?tf||(Ji=Ji&&Ei):Ei=Ji&&Ei:Ji=Ei=Ji&&Ei;const Al=Ji&&Va.placeable;if(Ei&&kn.placeable&&this.collisionIndex.insertCollisionBox(kn.box,Ce,R.get("text-ignore-placement"),M.bucketInstanceId,ba&&ba.placeable&&Wo?Wo:eu,pe.ID),Al&&this.collisionIndex.insertCollisionBox(Va.box,ke,R.get("icon-ignore-placement"),M.bucketInstanceId,tu,pe.ID),Ln&&Ei&&this.collisionIndex.insertCollisionCircles(Ln.circles,Ce,R.get("text-ignore-placement"),M.bucketInstanceId,eu,pe.ID),w&&this.storeCollisionData(M.bucketInstanceId,Pr,nr,kn,Va,Ln),Ct.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");if(M.bucketInstanceId===0)throw new Error("bucket.bucketInstanceId can't be 0");this.placements[Ct.crossTileID]=new Oh((Ei||ht)&&!kn?.occluded,(Ji||at)&&!Va?.occluded,$i||M.justReloaded),m[Ct.crossTileID]=!0};if(Xe){if(u.symbolInstanceStart!==0)throw new Error("bucket.bucketInstanceId should be 0");const Ct=M.getSortedSymbolIndexes(-this.transform.bearingInRadians);for(let nr=Ct.length-1;nr>=0;--nr){const Pr=Ct[nr];Bt(M.symbolInstances.get(Pr),M.collisionArrays[Pr],Pr)}}else for(let Ct=u.symbolInstanceStart;Ct<u.symbolInstanceEnd;Ct++)Bt(M.symbolInstances.get(Ct),M.collisionArrays[Ct],Ct);M.justReloaded=!1}storeCollisionData(u,m,w,M,R,N){if(w.textBox||w.iconBox){let H,j;this.collisionBoxArrays.has(u)?H=this.collisionBoxArrays.get(u):(H=new Map,this.collisionBoxArrays.set(u,H)),H.has(m)?j=H.get(m):(j={text:null,icon:null},H.set(m,j)),w.textBox&&(j.text=M.box),w.iconBox&&(j.icon=R.box)}if(N){let H=this.collisionCircleArrays[u];H===void 0&&(H=this.collisionCircleArrays[u]=[]);for(let j=0;j<N.circles.length;j+=4)H.push(N.circles[j+0]-Pn),H.push(N.circles[j+1]-Pn),H.push(N.circles[j+2]),H.push(N.collisionDetected?1:0)}}markUsedJustification(u,m,w,M){let R;R=M===o.ao.vertical?w.verticalPlacedTextSymbolIndex:{left:w.leftJustifiedTextSymbolIndex,center:w.centerJustifiedTextSymbolIndex,right:w.rightJustifiedTextSymbolIndex}[o.aG(m)];const N=[w.leftJustifiedTextSymbolIndex,w.centerJustifiedTextSymbolIndex,w.rightJustifiedTextSymbolIndex,w.verticalPlacedTextSymbolIndex];for(const H of N)H>=0&&(u.text.placedSymbolArray.get(H).crossTileID=R>=0&&H!==R?0:w.crossTileID)}markUsedOrientation(u,m,w){const M=m===o.ao.horizontal||m===o.ao.horizontalOnly?m:0,R=m===o.ao.vertical?m:0,N=[w.leftJustifiedTextSymbolIndex,w.centerJustifiedTextSymbolIndex,w.rightJustifiedTextSymbolIndex];for(const H of N)u.text.placedSymbolArray.get(H).placedOrientation=M;w.verticalPlacedTextSymbolIndex&&(u.text.placedSymbolArray.get(w.verticalPlacedTextSymbolIndex).placedOrientation=R)}commit(u){this.commitTime=u,this.zoomAtLastRecencyCheck=this.transform.zoom;const m=this.prevPlacement;let w=!1;this.prevZoomAdjustment=m?m.zoomAdjustment(this.transform.zoom):0;const M=m?m.symbolFadeChange(u):1,R=m?m.opacities:{},N=m?m.variableOffsets:{},H=m?m.placedOrientations:{};for(const j in this.placements){const Y=this.placements[j],K=R[j];K?(this.opacities[j]=new hl(K,M,Y.text,Y.icon),w=w||Y.text!==K.text.placed||Y.icon!==K.icon.placed):(this.opacities[j]=new hl(null,M,Y.text,Y.icon,Y.skipFade),w=w||Y.text||Y.icon)}for(const j in R){const Y=R[j];if(!this.opacities[j]){const K=new hl(Y,M,!1,!1);K.isHidden()||(this.opacities[j]=K,w=w||Y.text.placed||Y.icon.placed)}}for(const j in N)this.variableOffsets[j]||!this.opacities[j]||this.opacities[j].isHidden()||(this.variableOffsets[j]=N[j]);for(const j in H)this.placedOrientations[j]||!this.opacities[j]||this.opacities[j].isHidden()||(this.placedOrientations[j]=H[j]);if(m&&m.lastPlacementChangeTime===void 0)throw new Error("Last placement time for previous placement is not defined");w?this.lastPlacementChangeTime=u:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=m?m.lastPlacementChangeTime:u)}updateLayerOpacities(u,m){const w={};for(const M of m){const R=M.getBucket(u);R&&M.latestFeatureIndex&&u.id===R.layerIds[0]&&this.updateBucketOpacities(R,M.tileID,w,M.collisionBoxArray)}}updateBucketOpacities(u,m,w,M){u.hasTextData()&&(u.text.opacityVertexArray.clear(),u.text.hasVisibleVertices=!1),u.hasIconData()&&(u.icon.opacityVertexArray.clear(),u.icon.hasVisibleVertices=!1),u.hasIconCollisionBoxData()&&u.iconCollisionBox.collisionVertexArray.clear(),u.hasTextCollisionBoxData()&&u.textCollisionBox.collisionVertexArray.clear();const R=u.layers[0],N=R.layout,H=new hl(null,0,!1,!1,!0),j=N.get("text-allow-overlap"),Y=N.get("icon-allow-overlap"),K=R._unevaluatedLayout.hasValue("text-variable-anchor")||R._unevaluatedLayout.hasValue("text-variable-anchor-offset"),ie=N.get("text-rotation-alignment")==="map",re=N.get("text-pitch-alignment")==="map",ue=N.get("icon-text-fit")!=="none",pe=new hl(null,0,j&&(Y||!u.hasIconData()||N.get("icon-optional")),Y&&(j||!u.hasTextData()||N.get("text-optional")),!0);!u.collisionArrays&&M&&(u.hasIconCollisionBoxData()||u.hasTextCollisionBoxData())&&u.deserializeCollisionBoxes(M);const Se=(Ce,Ie,ke)=>{for(let Re=0;Re<Ie/4;Re++)Ce.opacityVertexArray.emplaceBack(ke);Ce.hasVisibleVertices=Ce.hasVisibleVertices||ke!==da},Te=this.collisionBoxArrays.get(u.bucketInstanceId);for(let Ce=0;Ce<u.symbolInstances.length;Ce++){const Ie=u.symbolInstances.get(Ce),{numHorizontalGlyphVertices:ke,numVerticalGlyphVertices:Re,crossTileID:ze}=Ie;let He=this.opacities[ze];w[ze]?He=H:He||(He=pe,this.opacities[ze]=He),w[ze]=!0;const Le=Ie.numIconVertices>0,Xe=this.placedOrientations[Ie.crossTileID],ht=Xe===o.ao.vertical,at=Xe===o.ao.horizontal||Xe===o.ao.horizontalOnly;if(ke>0||Re>0){const lt=ev(He.text);Se(u.text,ke,ht?da:lt),Se(u.text,Re,at?da:lt);const Ot=He.text.isHidden();[Ie.rightJustifiedTextSymbolIndex,Ie.centerJustifiedTextSymbolIndex,Ie.leftJustifiedTextSymbolIndex].forEach((nr=>{nr>=0&&(u.text.placedSymbolArray.get(nr).hidden=Ot||ht?1:0)})),Ie.verticalPlacedTextSymbolIndex>=0&&(u.text.placedSymbolArray.get(Ie.verticalPlacedTextSymbolIndex).hidden=Ot||at?1:0);const Bt=this.variableOffsets[Ie.crossTileID];Bt&&this.markUsedJustification(u,Bt.anchor,Ie,Xe);const Ct=this.placedOrientations[Ie.crossTileID];Ct&&(this.markUsedJustification(u,"left",Ie,Ct),this.markUsedOrientation(u,Ct,Ie))}if(Le){const lt=ev(He.icon),Ot=!(ue&&Ie.verticalPlacedIconSymbolIndex&&ht);Ie.placedIconSymbolIndex>=0&&(Se(u.icon,Ie.numIconVertices,Ot?lt:da),u.icon.placedSymbolArray.get(Ie.placedIconSymbolIndex).hidden=He.icon.isHidden()),Ie.verticalPlacedIconSymbolIndex>=0&&(Se(u.icon,Ie.numVerticalIconVertices,Ot?da:lt),u.icon.placedSymbolArray.get(Ie.verticalPlacedIconSymbolIndex).hidden=He.icon.isHidden())}const st=Te&&Te.has(Ce)?Te.get(Ce):{text:null,icon:null};if(u.hasIconCollisionBoxData()||u.hasTextCollisionBoxData()){const lt=u.collisionArrays[Ce];if(lt){let Ot=new o.P(0,0);if(lt.textBox||lt.verticalTextBox){let Bt=!0;if(K){const Ct=this.variableOffsets[ze];Ct?(Ot=Nl(Ct.anchor,Ct.width,Ct.height,Ct.textOffset,Ct.textBoxScale),ie&&Ot._rotate(re?-this.transform.bearingInRadians:this.transform.bearingInRadians)):Bt=!1}if(lt.textBox||lt.verticalTextBox){let Ct;lt.textBox&&(Ct=ht),lt.verticalTextBox&&(Ct=at),Nh(u.textCollisionBox.collisionVertexArray,He.text.placed,!Bt||Ct,st.text,Ot.x,Ot.y)}}if(lt.iconBox||lt.verticalIconBox){const Bt=!!(!at&&lt.verticalIconBox);let Ct;lt.iconBox&&(Ct=Bt),lt.verticalIconBox&&(Ct=!Bt),Nh(u.iconCollisionBox.collisionVertexArray,He.icon.placed,Ct,st.icon,ue?Ot.x:0,ue?Ot.y:0)}}}}if(u.sortFeatures(-this.transform.bearingInRadians),this.retainedQueryData[u.bucketInstanceId]&&(this.retainedQueryData[u.bucketInstanceId].featureSortOrder=u.featureSortOrder),u.hasTextData()&&u.text.opacityVertexBuffer&&u.text.opacityVertexBuffer.updateData(u.text.opacityVertexArray),u.hasIconData()&&u.icon.opacityVertexBuffer&&u.icon.opacityVertexBuffer.updateData(u.icon.opacityVertexArray),u.hasIconCollisionBoxData()&&u.iconCollisionBox.collisionVertexBuffer&&u.iconCollisionBox.collisionVertexBuffer.updateData(u.iconCollisionBox.collisionVertexArray),u.hasTextCollisionBoxData()&&u.textCollisionBox.collisionVertexBuffer&&u.textCollisionBox.collisionVertexBuffer.updateData(u.textCollisionBox.collisionVertexArray),u.text.opacityVertexArray.length!==u.text.layoutVertexArray.length/4)throw new Error(`bucket.text.opacityVertexArray.length (= ${u.text.opacityVertexArray.length}) !== bucket.text.layoutVertexArray.length (= ${u.text.layoutVertexArray.length}) / 4`);if(u.icon.opacityVertexArray.length!==u.icon.layoutVertexArray.length/4)throw new Error(`bucket.icon.opacityVertexArray.length (= ${u.icon.opacityVertexArray.length}) !== bucket.icon.layoutVertexArray.length (= ${u.icon.layoutVertexArray.length}) / 4`);u.bucketInstanceId in this.collisionCircleArrays&&(u.collisionCircleArray=this.collisionCircleArrays[u.bucketInstanceId],delete this.collisionCircleArrays[u.bucketInstanceId])}symbolFadeChange(u){return this.fadeDuration===0?1:(u-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(u){return Math.max(0,(this.transform.zoom-u)/1.5)}hasTransitions(u){return this.stale||u-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(u,m){const w=this.zoomAtLastRecencyCheck===m?1-this.zoomAdjustment(m):1;return this.zoomAtLastRecencyCheck=m,this.commitTime+this.fadeDuration*w>u}setStale(){this.stale=!0}}function Nh(I,u,m,w,M,R){w&&w.length!==0||(w=[0,0,0,0]);const N=w[0]-Pn,H=w[1]-Pn,j=w[2]-Pn,Y=w[3]-Pn;I.emplaceBack(u?1:0,m?1:0,M||0,R||0,N,H),I.emplaceBack(u?1:0,m?1:0,M||0,R||0,j,H),I.emplaceBack(u?1:0,m?1:0,M||0,R||0,j,Y),I.emplaceBack(u?1:0,m?1:0,M||0,R||0,N,Y)}const fl=Math.pow(2,25),Ca=Math.pow(2,24),Qg=Math.pow(2,17),Tb=Math.pow(2,16),Jg=Math.pow(2,9),Ny=Math.pow(2,8),Yf=Math.pow(2,1);function ev(I){if(I.opacity===0&&!I.placed)return 0;if(I.opacity===1&&I.placed)return 4294967295;const u=I.placed?1:0,m=Math.floor(127*I.opacity);return m*fl+u*Ca+m*Qg+u*Tb+m*Jg+u*Ny+m*Yf+u}const da=0;class Kf{constructor(u){this._sortAcrossTiles=u.layout.get("symbol-z-order")!=="viewport-y"&&!u.layout.get("symbol-sort-key").isConstant(),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(u,m,w,M,R){const N=this._bucketParts;for(;this._currentTileIndex<u.length;)if(m.getBucketParts(N,M,u[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,R())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,N.sort(((H,j)=>H.sortKey-j.sortKey)));this._currentPartIndex<N.length;)if(m.placeLayerBucketPart(N[this._currentPartIndex],this._seenCrossTileIDs,w),this._currentPartIndex++,R())return!0;return!1}}class tv{constructor(u,m,w,M,R,N,H,j){this.placement=new qf(u,m,N,H,j),this._currentPlacementIndex=w.length-1,this._forceFullPlacement=M,this._showCollisionBoxes=R,this._done=!1}isDone(){return this._done}continuePlacement(u,m,w){const M=y.now(),R=()=>!this._forceFullPlacement&&y.now()-M>2;for(;this._currentPlacementIndex>=0;){const N=m[u[this._currentPlacementIndex]],H=this.placement.collisionIndex.transform.zoom;if(N.type==="symbol"&&(!N.minzoom||N.minzoom<=H)&&(!N.maxzoom||N.maxzoom>H)){if(this._inProgressLayer||(this._inProgressLayer=new Kf(N)),this._inProgressLayer.continuePlacement(w[N.source],this.placement,this._showCollisionBoxes,N,R))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(u){return this.placement.commit(u),this.placement}}const Bl=512/o.$/2;class Tu{constructor(u,m,w){this.tileID=u,this.bucketInstanceId=w,this._symbolsByKey={};const M=new Map;for(let R=0;R<m.length;R++){const N=m.get(R),H=N.key,j=M.get(H);j?j.push(N):M.set(H,[N])}for(const[R,N]of M){const H={positions:N.map((j=>({x:Math.floor(j.anchorX*Bl),y:Math.floor(j.anchorY*Bl)}))),crossTileIDs:N.map((j=>j.crossTileID))};if(H.positions.length>128){const j=new o.aI(H.positions.length,16,Uint16Array);for(const{x:Y,y:K}of H.positions)j.add(Y,K);j.finish(),delete H.positions,H.index=j}this._symbolsByKey[R]=H}}getScaledCoordinates(u,m){const{x:w,y:M,z:R}=this.tileID.canonical,{x:N,y:H,z:j}=m.canonical,Y=Bl/Math.pow(2,j-R),K=(H*o.$+u.anchorY)*Y,ie=M*o.$*Bl;return{x:Math.floor((N*o.$+u.anchorX)*Y-w*o.$*Bl),y:Math.floor(K-ie)}}findMatches(u,m,w){const M=this.tileID.canonical.z<m.canonical.z?1:Math.pow(2,this.tileID.canonical.z-m.canonical.z);for(let R=0;R<u.length;R++){const N=u.get(R);if(N.crossTileID)continue;const H=this._symbolsByKey[N.key];if(!H)continue;const j=this.getScaledCoordinates(N,m);if(H.index){const Y=H.index.range(j.x-M,j.y-M,j.x+M,j.y+M).sort();for(const K of Y){const ie=H.crossTileIDs[K];if(!w[ie]){w[ie]=!0,N.crossTileID=ie;break}}}else if(H.positions)for(let Y=0;Y<H.positions.length;Y++){const K=H.positions[Y],ie=H.crossTileIDs[Y];if(Math.abs(K.x-j.x)<=M&&Math.abs(K.y-j.y)<=M&&!w[ie]){w[ie]=!0,N.crossTileID=ie;break}}}}getCrossTileIDsLists(){return Object.values(this._symbolsByKey).map((({crossTileIDs:u})=>u))}}class By{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class Bh{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(u){const m=Math.round((u-this.lng)/360);if(m!==0)for(const w in this.indexes){const M=this.indexes[w],R={};for(const N in M){const H=M[N];H.tileID=H.tileID.unwrapTo(H.tileID.wrap+m),R[H.tileID.key]=H}this.indexes[w]=R}this.lng=u}addBucket(u,m,w){if(this.indexes[u.overscaledZ]&&this.indexes[u.overscaledZ][u.key]){if(this.indexes[u.overscaledZ][u.key].bucketInstanceId===m.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(u.overscaledZ,this.indexes[u.overscaledZ][u.key])}for(let R=0;R<m.symbolInstances.length;R++)m.symbolInstances.get(R).crossTileID=0;this.usedCrossTileIDs[u.overscaledZ]||(this.usedCrossTileIDs[u.overscaledZ]={});const M=this.usedCrossTileIDs[u.overscaledZ];for(const R in this.indexes){const N=this.indexes[R];if(Number(R)>u.overscaledZ)for(const H in N){const j=N[H];j.tileID.isChildOf(u)&&j.findMatches(m.symbolInstances,u,M)}else{const H=N[u.scaledTo(Number(R)).key];H&&H.findMatches(m.symbolInstances,u,M)}}for(let R=0;R<m.symbolInstances.length;R++){const N=m.symbolInstances.get(R);N.crossTileID||(N.crossTileID=w.generate(),M[N.crossTileID]=!0)}return this.indexes[u.overscaledZ]===void 0&&(this.indexes[u.overscaledZ]={}),this.indexes[u.overscaledZ][u.key]=new Tu(u,m.symbolInstances,m.bucketInstanceId),!0}removeBucketCrossTileIDs(u,m){for(const w of m.getCrossTileIDsLists())for(const M of w)delete this.usedCrossTileIDs[u][M]}removeStaleBuckets(u){let m=!1;for(const w in this.indexes){const M=this.indexes[w];for(const R in M)u[M[R].bucketInstanceId]||(this.removeBucketCrossTileIDs(w,M[R]),delete M[R],m=!0)}return m}}class dl{constructor(){this.layerIndexes={},this.crossTileIDs=new By,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(u,m,w){let M=this.layerIndexes[u.id];M===void 0&&(M=this.layerIndexes[u.id]=new Bh);let R=!1;const N={};M.handleWrapJump(w);for(const H of m){const j=H.getBucket(u);j&&u.id===j.layerIds[0]&&(j.bucketInstanceId||(j.bucketInstanceId=++this.maxBucketInstanceId),M.addBucket(H.tileID,j,this.crossTileIDs)&&(R=!0),N[j.bucketInstanceId]=!0)}return M.removeStaleBuckets(N)&&(R=!0),R}pruneUnusedLayers(u){const m={};u.forEach((w=>{m[w]=!0}));for(const w in this.layerIndexes)m[w]||delete this.layerIndexes[w]}}var rv="void main() {fragColor=vec4(1.0);}";const Ba={prelude:ni(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
out highp vec4 fragColor;`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}mat3 rotationMatrixFromAxisAngle(vec3 u,float angle) {float c=cos(angle);float s=sin(angle);float c2=1.0-c;return mat3(u.x*u.x*c2+      c,u.x*u.y*c2-u.z*s,u.x*u.z*c2+u.y*s,u.y*u.x*c2+u.z*s,u.y*u.y*c2+    c,u.y*u.z*c2-u.x*s,u.z*u.x*c2-u.y*s,u.z*u.y*c2+u.x*s,u.z*u.z*c2+    c
);}
#ifdef TERRAIN3D
uniform sampler2D u_terrain;uniform float u_terrain_dim;uniform mat4 u_terrain_matrix;uniform vec4 u_terrain_unpack;uniform float u_terrain_exaggeration;uniform highp sampler2D u_depth;
#endif
const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitShifts=vec4(1.)/bitSh;highp float unpack(highp vec4 color) {return dot(color,bitShifts);}highp float depthOpacity(vec3 frag) {
#ifdef TERRAIN3D
highp float d=unpack(texture(u_depth,frag.xy*0.5+0.5))+0.0001-frag.z;return 1.0-max(0.0,min(1.0,-d*500.0));
#else
return 1.0;
#endif
}float calculate_visibility(vec4 pos) {
#ifdef TERRAIN3D
vec3 frag=pos.xyz/pos.w;highp float d=depthOpacity(frag);if (d > 0.95) return 1.0;return (d+depthOpacity(frag+vec3(0.0,0.01,0.0)))/2.0;
#else
return 1.0;
#endif
}float ele(vec2 pos) {
#ifdef TERRAIN3D
vec4 rgb=(texture(u_terrain,pos)*255.0)*u_terrain_unpack;return rgb.r+rgb.g+rgb.b-u_terrain_unpack.a;
#else
return 0.0;
#endif
}float get_elevation(vec2 pos) {
#ifdef TERRAIN3D
#ifdef GLOBE
if ((pos.y <-32767.5) || (pos.y > 32766.5)) {return 0.0;}
#endif
vec2 coord=(u_terrain_matrix*vec4(pos,0.0,1.0)).xy*u_terrain_dim+1.0;vec2 f=fract(coord);vec2 c=(floor(coord)+0.5)/(u_terrain_dim+2.0);float d=1.0/(u_terrain_dim+2.0);float tl=ele(c);float tr=ele(c+vec2(d,0.0));float bl=ele(c+vec2(0.0,d));float br=ele(c+vec2(d,d));float elevation=mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);return elevation*u_terrain_exaggeration;
#else
return 0.0;
#endif
}const float PI=3.141592653589793;uniform mat4 u_projection_matrix;`),projectionMercator:ni("","float projectLineThickness(float tileY) {return 1.0;}float projectCircleRadius(float tileY) {return 1.0;}vec4 projectTile(vec2 p) {vec4 result=u_projection_matrix*vec4(p,0.0,1.0);return result;}vec4 projectTile(vec2 p,vec2 rawPos) {vec4 result=u_projection_matrix*vec4(p,0.0,1.0);if (rawPos.y <-32767.5 || rawPos.y > 32766.5) {result.z=-10000000.0;}return result;}vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_projection_matrix*vec4(posInTile,elevation,1.0);}vec4 projectTileFor3D(vec2 posInTile,float elevation) {return projectTileWithElevation(posInTile,elevation);}"),projectionGlobe:ni("",`#define GLOBE_RADIUS 6371008.8
uniform highp vec4 u_projection_tile_mercator_coords;uniform highp vec4 u_projection_clipping_plane;uniform highp float u_projection_transition;uniform mat4 u_projection_fallback_matrix;vec3 globeRotateVector(vec3 vec,vec2 angles) {vec3 axisRight=vec3(vec.z,0.0,-vec.x);vec3 axisUp=cross(axisRight,vec);axisRight=normalize(axisRight);axisUp=normalize(axisUp);vec2 t=tan(angles);return normalize(vec+axisRight*t.x+axisUp*t.y);}mat3 globeGetRotationMatrix(vec3 spherePos) {vec3 axisRight=vec3(spherePos.z,0.0,-spherePos.x);vec3 axisDown=cross(axisRight,spherePos);axisRight=normalize(axisRight);axisDown=normalize(axisDown);return mat3(axisRight,axisDown,spherePos
);}float circumferenceRatioAtTileY(float tileY) {float mercator_pos_y=u_projection_tile_mercator_coords.y+u_projection_tile_mercator_coords.w*tileY;float spherical_y=2.0*atan(exp(PI-(mercator_pos_y*PI*2.0)))-PI*0.5;return cos(spherical_y);}float projectLineThickness(float tileY) {float thickness=1.0/circumferenceRatioAtTileY(tileY); 
if (u_projection_transition < 0.999) {return mix(1.0,thickness,u_projection_transition);} else {return thickness;}}vec3 projectToSphere(vec2 translatedPos,vec2 rawPos) {vec2 mercator_pos=u_projection_tile_mercator_coords.xy+u_projection_tile_mercator_coords.zw*translatedPos;vec2 spherical;spherical.x=mercator_pos.x*PI*2.0+PI;spherical.y=2.0*atan(exp(PI-(mercator_pos.y*PI*2.0)))-PI*0.5;float len=cos(spherical.y);vec3 pos=vec3(sin(spherical.x)*len,sin(spherical.y),cos(spherical.x)*len
);if (rawPos.y <-32767.5) {pos=vec3(0.0,1.0,0.0);}if (rawPos.y > 32766.5) {pos=vec3(0.0,-1.0,0.0);}return pos;}vec3 projectToSphere(vec2 posInTile) {return projectToSphere(posInTile,vec2(0.0,0.0));}float globeComputeClippingZ(vec3 spherePos) {return (1.0-(dot(spherePos,u_projection_clipping_plane.xyz)+u_projection_clipping_plane.w));}vec4 interpolateProjection(vec2 posInTile,vec3 spherePos,float elevation) {vec3 elevatedPos=spherePos*(1.0+elevation/GLOBE_RADIUS);vec4 globePosition=u_projection_matrix*vec4(elevatedPos,1.0);globePosition.z=globeComputeClippingZ(elevatedPos)*globePosition.w;if (u_projection_transition > 0.999) {return globePosition;}vec4 flatPosition=u_projection_fallback_matrix*vec4(posInTile,elevation,1.0);const float z_globeness_threshold=0.2;vec4 result=globePosition;result.z=mix(0.0,globePosition.z,clamp((u_projection_transition-z_globeness_threshold)/(1.0-z_globeness_threshold),0.0,1.0));result.xyw=mix(flatPosition.xyw,globePosition.xyw,u_projection_transition);if ((posInTile.y <-32767.5) || (posInTile.y > 32766.5)) {result=globePosition;const float poles_hidden_anim_percentage=0.02;result.z=mix(globePosition.z,100.0,pow(max((1.0-u_projection_transition)/poles_hidden_anim_percentage,0.0),8.0));}return result;}vec4 interpolateProjectionFor3D(vec2 posInTile,vec3 spherePos,float elevation) {vec3 elevatedPos=spherePos*(1.0+elevation/GLOBE_RADIUS);vec4 globePosition=u_projection_matrix*vec4(elevatedPos,1.0);if (u_projection_transition > 0.999) {return globePosition;}vec4 fallbackPosition=u_projection_fallback_matrix*vec4(posInTile,elevation,1.0);return mix(fallbackPosition,globePosition,u_projection_transition);}vec4 projectTile(vec2 posInTile) {return interpolateProjection(posInTile,projectToSphere(posInTile),0.0);}vec4 projectTile(vec2 posInTile,vec2 rawPos) {return interpolateProjection(posInTile,projectToSphere(posInTile,rawPos),0.0);}vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return interpolateProjection(posInTile,projectToSphere(posInTile),elevation);}vec4 projectTileFor3D(vec2 posInTile,float elevation) {vec3 spherePos=projectToSphere(posInTile,posInTile);return interpolateProjectionFor3D(posInTile,spherePos,elevation);}`),background:ni(`uniform vec4 u_color;uniform float u_opacity;void main() {fragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"in vec2 a_pos;void main() {gl_Position=projectTile(a_pos);}"),backgroundPattern:ni(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;in vec2 v_pos_a;in vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);fragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;in vec2 a_pos;out vec2 v_pos_a;out vec2 v_pos_b;void main() {gl_Position=projectTile(a_pos);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),circle:ni(`in vec3 v_data;in float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);float antialiased_blur=v_data.z;float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));fragColor=v_visibility*opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);const float epsilon=0.5/255.0;if (fragColor.r < epsilon && fragColor.g < epsilon && fragColor.b < epsilon && fragColor.a < epsilon) {discard;}
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform highp float u_globe_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;uniform vec2 u_translate;in vec2 a_pos;out vec3 v_data;out float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 pos_raw=a_pos+32768.0;vec2 extrude=vec2(mod(pos_raw,8.0)/7.0*2.0-1.0);vec2 circle_center=floor(pos_raw/8.0)+u_translate;float ele=get_elevation(circle_center);v_visibility=calculate_visibility(projectTileWithElevation(circle_center,ele));if (u_pitch_with_map) {
#ifdef GLOBE
vec3 center_vector=projectToSphere(circle_center);
#endif
float angle_scale=u_globe_extrude_scale;vec2 corner_position=circle_center;if (u_scale_with_map) {angle_scale*=(radius+stroke_width);corner_position+=extrude*u_extrude_scale*(radius+stroke_width);} else {
#ifdef GLOBE
vec4 projected_center=interpolateProjection(circle_center,center_vector,ele);
#else
vec4 projected_center=projectTileWithElevation(circle_center,ele);
#endif
corner_position+=extrude*u_extrude_scale*(radius+stroke_width)*(projected_center.w/u_camera_to_center_distance);angle_scale*=(radius+stroke_width)*(projected_center.w/u_camera_to_center_distance);}
#ifdef GLOBE
vec2 angles=extrude*angle_scale;vec3 corner_vector=globeRotateVector(center_vector,angles);gl_Position=interpolateProjection(corner_position,corner_vector,ele);
#else
gl_Position=projectTileWithElevation(corner_position,ele);
#endif
} else {gl_Position=projectTileWithElevation(circle_center,ele);if (gl_Position.z/gl_Position.w > 1.0) {gl_Position.xy=vec2(10000.0);}if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}float antialiasblur=-max(1.0/u_device_pixel_ratio/(radius+stroke_width),blur);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),clippingMask:ni(rv,"in vec2 a_pos;void main() {gl_Position=projectTile(a_pos);}"),heatmap:ni(`uniform highp float u_intensity;in vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);fragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;uniform highp float u_globe_extrude_scale;in vec2 a_pos;out vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 pos_raw=a_pos+32768.0;vec2 unscaled_extrude=vec2(mod(pos_raw,8.0)/7.0*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 circle_center=floor(pos_raw/8.0);
#ifdef GLOBE
vec2 angles=v_extrude*radius*u_globe_extrude_scale;vec3 center_vector=projectToSphere(circle_center);vec3 corner_vector=globeRotateVector(center_vector,angles);gl_Position=interpolateProjection(circle_center+extrude,corner_vector,0.0);
#else
gl_Position=projectTileFor3D(circle_center+extrude,get_elevation(circle_center));
#endif
}`),heatmapTexture:ni(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;in vec2 v_pos;void main() {float t=texture(u_image,v_pos).r;vec4 color=texture(u_color_ramp,vec2(t,0.5));fragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),collisionBox:ni("in float v_placed;in float v_notUsed;void main() {float alpha=0.5;fragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {fragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {fragColor*=.1;}}","in vec2 a_anchor_pos;in vec2 a_placed;in vec2 a_box_real;uniform vec2 u_pixel_extrude_scale;out float v_placed;out float v_notUsed;void main() {gl_Position=projectTileWithElevation(a_anchor_pos,get_elevation(a_anchor_pos));gl_Position.xy=((a_box_real+0.5)*u_pixel_extrude_scale*2.0-1.0)*vec2(1.0,-1.0)*gl_Position.w;if (gl_Position.z/gl_Position.w < 1.1) {gl_Position.z=0.5;}v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:ni("in float v_radius;in vec2 v_extrude;in float v_collision;void main() {float alpha=0.5;float stroke_radius=0.9;float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);fragColor=color*alpha*opacity_t;}","in vec2 a_pos;in float a_radius;in vec2 a_flags;uniform vec2 u_viewport_size;out float v_radius;out vec2 v_extrude;out float v_collision;void main() {float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_collision=collision;gl_Position=vec4((a_pos/u_viewport_size*2.0-1.0)*vec2(1.0,-1.0),0.0,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),colorRelief:ni(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;uniform vec4 u_unpack;uniform sampler2D u_elevation_stops;uniform sampler2D u_color_stops;uniform int u_color_ramp_size;uniform float u_opacity;in vec2 v_pos;float getElevation(vec2 coord) {vec4 data=texture(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack);}float getElevationStop(int stop) {float x=(float(stop)+0.5)/float(u_color_ramp_size);vec4 data=texture(u_elevation_stops,vec2(x,0))*255.0;data.a=-1.0;return dot(data,u_unpack);}void main() {float el=getElevation(v_pos);int r=(u_color_ramp_size-1);int l=0;float el_l=getElevationStop(l);float el_r=getElevationStop(r);while(r-l > 1){int m=(r+l)/2;float el_m=getElevationStop(m);if(el < el_m){r=m;el_r=el_m;}else
{l=m;el_l=el_m;}}float x=(float(l)+(el-el_l)/(el_r-el_l)+0.5)/float(u_color_ramp_size);fragColor=u_opacity*texture(u_color_stops,vec2(x,0));
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform vec2 u_dimension;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=projectTile(a_pos,a_pos);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_pos/8192.0)*scale+epsilon;if (a_pos.y <-32767.5) {v_pos.y=0.0;}if (a_pos.y > 32766.5) {v_pos.y=1.0;}}"),debug:ni("uniform highp vec4 u_color;uniform sampler2D u_overlay;in vec2 v_uv;void main() {vec4 overlay_color=texture(u_overlay,v_uv);fragColor=mix(u_color,overlay_color,overlay_color.a);}","in vec2 a_pos;out vec2 v_uv;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=projectTileWithElevation(a_pos*u_overlay_scale,get_elevation(a_pos));}"),depth:ni(rv,`in vec2 a_pos;void main() {
#ifdef GLOBE
gl_Position=projectTileFor3D(a_pos,0.0);
#else
gl_Position=u_projection_matrix*vec4(a_pos,0.0,1.0);
#endif
}`),fill:ni(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
fragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_fill_translate;in vec2 a_pos;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=projectTile(a_pos+u_fill_translate,a_pos);}`),fillOutline:ni(`in vec2 v_pos;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);fragColor=outline_color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_world;uniform vec2 u_fill_translate;in vec2 a_pos;out vec2 v_pos;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=projectTile(a_pos+u_fill_translate,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
}`),fillOutlinePattern:ni(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;in vec2 v_pos_a;in vec2 v_pos_b;in vec2 v_pos;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);fragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;uniform vec2 u_fill_translate;in vec2 a_pos;out vec2 v_pos_a;out vec2 v_pos_b;out vec2 v_pos;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=projectTile(a_pos+u_fill_translate,a_pos);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
}`),fillPattern:ni(`#ifdef GL_ES
precision highp float;
#endif
uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;in vec2 v_pos_a;in vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);fragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;uniform vec2 u_fill_translate;in vec2 a_pos;out vec2 v_pos_a;out vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=projectTile(a_pos+u_fill_translate,a_pos);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),fillExtrusion:ni(`in vec4 v_color;void main() {fragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp vec3 u_lightpos_globe;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec2 u_fill_translate;in vec2 a_pos;in vec4 a_normal_ed;
#ifdef TERRAIN3D
in vec2 a_centroid;
#endif
out vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float elevation=t > 0.0 ? height : base;vec2 posInTile=a_pos+u_fill_translate;
#ifdef GLOBE
vec3 spherePos=projectToSphere(posInTile,a_pos);gl_Position=interpolateProjectionFor3D(posInTile,spherePos,elevation);
#else
gl_Position=u_projection_matrix*vec4(posInTile,elevation,1.0);
#endif
float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;vec3 normalForLighting=normal/16384.0;float directional=clamp(dot(normalForLighting,u_lightpos),0.0,1.0);
#ifdef GLOBE
mat3 rotMatrix=globeGetRotationMatrix(spherePos);normalForLighting=rotMatrix*normalForLighting;directional=mix(directional,clamp(dot(normalForLighting,u_lightpos_globe),0.0,1.0),u_projection_transition);
#endif
directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),fillExtrusionPattern:ni(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;in vec2 v_pos_a;in vec2 v_pos_b;in vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);fragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec2 u_fill_translate;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp vec3 u_lightpos_globe;uniform lowp float u_lightintensity;in vec2 a_pos;in vec4 a_normal_ed;
#ifdef TERRAIN3D
in vec2 a_centroid;
#endif
#ifdef GLOBE
out vec3 v_sphere_pos;
#endif
out vec2 v_pos_a;out vec2 v_pos_b;out vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float elevation=t > 0.0 ? height : base;vec2 posInTile=a_pos+u_fill_translate;
#ifdef GLOBE
vec3 spherePos=projectToSphere(posInTile,a_pos);vec3 elevatedPos=spherePos*(1.0+elevation/GLOBE_RADIUS);v_sphere_pos=elevatedPos;gl_Position=interpolateProjectionFor3D(posInTile,spherePos,elevation);
#else
gl_Position=u_projection_matrix*vec4(posInTile,elevation,1.0);
#endif
vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,elevation*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),hillshadePrepare:ni(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack);}void main() {vec2 epsilon=1.0/u_dimension;float tileSize=u_dimension.x-2.0;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))*tileSize/pow(2.0,exaggeration+(28.2562-u_zoom));fragColor=clamp(vec4(deriv.x/8.0+0.5,deriv.y/8.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:ni(`uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_latrange;uniform float u_exaggeration;uniform vec4 u_accent;uniform int u_method;uniform float u_altitudes[NUM_ILLUMINATION_SOURCES];uniform float u_azimuths[NUM_ILLUMINATION_SOURCES];uniform vec4 u_shadows[NUM_ILLUMINATION_SOURCES];uniform vec4 u_highlights[NUM_ILLUMINATION_SOURCES];
#define PI 3.141592653589793
#define STANDARD 0
#define COMBINED 1
#define IGOR 2
#define MULTIDIRECTIONAL 3
#define BASIC 4
float get_aspect(vec2 deriv){return deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);}void igor_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;float aspect=get_aspect(deriv);float azimuth=u_azimuths[0]+PI;float slope_stength=atan(length(deriv))*2.0/PI;float aspect_strength=1.0-abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);float shadow_strength=slope_stength*aspect_strength;float highlight_strength=slope_stength*(1.0-aspect_strength);fragColor=u_shadows[0]*shadow_strength+u_highlights[0]*highlight_strength;}void standard_hillshade(vec2 deriv){float azimuth=u_azimuths[0]+PI;float slope=atan(0.625*length(deriv));float aspect=get_aspect(deriv);float intensity=u_exaggeration;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadows[0],u_highlights[0],shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);fragColor=accent_color*(1.0-shade_color.a)+shade_color;}void basic_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;float azimuth=u_azimuths[0]+PI;float cos_az=cos(azimuth);float sin_az=sin(azimuth);float cos_alt=cos(u_altitudes[0]);float sin_alt=sin(u_altitudes[0]);float cang=(sin_alt-(deriv.y*cos_az*cos_alt-deriv.x*sin_az*cos_alt))/sqrt(1.0+dot(deriv,deriv));float shade=clamp(cang,0.0,1.0);if(shade > 0.5){fragColor=u_highlights[0]*(2.0*shade-1.0);}else
{fragColor=u_shadows[0]*(1.0-2.0*shade);}}void multidirectional_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;fragColor=vec4(0,0,0,0);for(int i=0; i < NUM_ILLUMINATION_SOURCES; i++){float cos_alt=cos(u_altitudes[i]);float sin_alt=sin(u_altitudes[i]);float cos_az=-cos(u_azimuths[i]);float sin_az=-sin(u_azimuths[i]);float cang=(sin_alt-(deriv.y*cos_az*cos_alt-deriv.x*sin_az*cos_alt))/sqrt(1.0+dot(deriv,deriv));float shade=clamp(cang,0.0,1.0);if(shade > 0.5){fragColor+=u_highlights[i]*(2.0*shade-1.0)/float(NUM_ILLUMINATION_SOURCES);}else
{fragColor+=u_shadows[i]*(1.0-2.0*shade)/float(NUM_ILLUMINATION_SOURCES);}}}void combined_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;float azimuth=u_azimuths[0]+PI;float cos_az=cos(azimuth);float sin_az=sin(azimuth);float cos_alt=cos(u_altitudes[0]);float sin_alt=sin(u_altitudes[0]);float cang=acos((sin_alt-(deriv.y*cos_az*cos_alt-deriv.x*sin_az*cos_alt))/sqrt(1.0+dot(deriv,deriv)));cang=clamp(cang,0.0,PI/2.0);float shade=cang*atan(length(deriv))*4.0/PI/PI;float highlight=(PI/2.0-cang)*atan(length(deriv))*4.0/PI/PI;fragColor=u_shadows[0]*shade+u_highlights[0]*highlight;}void main() {vec4 pixel=texture(u_image,v_pos);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));vec2 deriv=((pixel.rg*8.0)-4.0)/scaleFactor;if (u_method==BASIC) {basic_hillshade(deriv);} else if (u_method==COMBINED) {combined_hillshade(deriv);} else if (u_method==IGOR) {igor_hillshade(deriv);} else if (u_method==MULTIDIRECTIONAL) {multidirectional_hillshade(deriv);} else if (u_method==STANDARD) {standard_hillshade(deriv);} else {standard_hillshade(deriv);}
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=projectTile(a_pos,a_pos);v_pos=a_pos/8192.0;if (a_pos.y <-32767.5) {v_pos.y=0.0;}if (a_pos.y > 32766.5) {v_pos.y=1.0;}}"),line:ni(`uniform lowp float u_device_pixel_ratio;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);fragColor=color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;uniform vec2 u_translation;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp float v_linesofar;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),lineGradient:ni(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;in highp vec2 v_uv;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture(u_image,v_uv);fragColor=color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;in float a_uv_x;in float a_split_index;uniform vec2 u_translation;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec2 v_uv;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),linePattern:ni(`#ifdef GL_ES
precision highp float;
#endif
uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;in vec2 v_normal;in vec2 v_width2;in float v_linesofar;in float v_gamma_scale;in float v_width;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture(u_image,pos_a),texture(u_image,pos_b),u_fade);fragColor=color*alpha*opacity;
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
in vec2 a_pos_normal;in vec4 a_data;uniform vec2 u_translation;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out float v_linesofar;out float v_gamma_scale;out float v_width;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),lineSDF:ni(`uniform lowp float u_device_pixel_ratio;uniform lowp float u_lineatlas_width;uniform sampler2D u_image;uniform float u_mix;in vec2 v_normal;in vec2 v_width2;in vec2 v_tex_a;in vec2 v_tex_b;in float v_gamma_scale;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define mediump vec4 dasharray_from
#pragma mapbox: define mediump vec4 dasharray_to
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 dasharray_from
#pragma mapbox: initialize mediump vec4 dasharray_to
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture(u_image,v_tex_a).a;float sdfdist_b=texture(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);float sdfgamma=(u_lineatlas_width/256.0)/min(dasharray_from.w,dasharray_to.w);alpha*=smoothstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);fragColor=color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
in vec2 a_pos_normal;in vec4 a_data;uniform vec2 u_translation;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_tileratio;uniform float u_crossfade_from;uniform float u_crossfade_to;uniform float u_lineatlas_height;out vec2 v_normal;out vec2 v_width2;out vec2 v_tex_a;out vec2 v_tex_b;out float v_gamma_scale;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define mediump vec4 dasharray_from
#pragma mapbox: define mediump vec4 dasharray_to
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 dasharray_from
#pragma mapbox: initialize mediump vec4 dasharray_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
float u_patternscale_a_x=u_tileratio/dasharray_from.w/u_crossfade_from;float u_patternscale_a_y=-dasharray_from.z/2.0/u_lineatlas_height;float u_patternscale_b_x=u_tileratio/dasharray_to.w/u_crossfade_to;float u_patternscale_b_y=-dasharray_to.z/2.0/u_lineatlas_height;v_tex_a=vec2(a_linesofar*u_patternscale_a_x/floorwidth,normal.y*u_patternscale_a_y+(float(dasharray_from.y)+0.5)/u_lineatlas_height);v_tex_b=vec2(a_linesofar*u_patternscale_b_x/floorwidth,normal.y*u_patternscale_b_y+(float(dasharray_to.y)+0.5)/u_lineatlas_height);v_width2=vec2(outset,inset);}`),lineGradientSDF:ni(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform sampler2D u_image_dash;uniform float u_mix;uniform lowp float u_lineatlas_width;in vec2 v_normal;in vec2 v_width2;in vec2 v_tex_a;in vec2 v_tex_b;in float v_gamma_scale;in highp vec2 v_uv;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define mediump vec4 dasharray_from
#pragma mapbox: define mediump vec4 dasharray_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 dasharray_from
#pragma mapbox: initialize mediump vec4 dasharray_to
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture(u_image,v_uv);float sdfdist_a=texture(u_image_dash,v_tex_a).a;float sdfdist_b=texture(u_image_dash,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);float sdfgamma=(u_lineatlas_width/256.0)/min(dasharray_from.w,dasharray_to.w);float dash_alpha=smoothstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);fragColor=color*(alpha*dash_alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
in vec2 a_pos_normal;in vec4 a_data;in float a_uv_x;in float a_split_index;uniform vec2 u_translation;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;uniform float u_tileratio;uniform float u_crossfade_from;uniform float u_crossfade_to;uniform float u_lineatlas_height;out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec2 v_uv;out vec2 v_tex_a;out vec2 v_tex_b;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define mediump vec4 dasharray_from
#pragma mapbox: define mediump vec4 dasharray_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 dasharray_from
#pragma mapbox: initialize mediump vec4 dasharray_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;float texel_height=1.0/u_image_height;float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
float u_patternscale_a_x=u_tileratio/dasharray_from.w/u_crossfade_from;float u_patternscale_a_y=-dasharray_from.z/2.0/u_lineatlas_height;float u_patternscale_b_x=u_tileratio/dasharray_to.w/u_crossfade_to;float u_patternscale_b_y=-dasharray_to.z/2.0/u_lineatlas_height;v_tex_a=vec2(a_linesofar*u_patternscale_a_x/floorwidth,normal.y*u_patternscale_a_y+(float(dasharray_from.y)+0.5)/u_lineatlas_height);v_tex_b=vec2(a_linesofar*u_patternscale_b_x/floorwidth,normal.y*u_patternscale_b_y+(float(dasharray_to.y)+0.5)/u_lineatlas_height);v_width2=vec2(outset,inset);}`),raster:ni(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;in vec2 v_pos0;in vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture(u_image0,v_pos0);vec4 color1=texture(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);fragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;uniform vec4 u_coords_top;uniform vec4 u_coords_bottom;in vec2 a_pos;out vec2 v_pos0;out vec2 v_pos1;void main() {vec2 fractionalPos=a_pos/8192.0;vec2 position=mix(mix(u_coords_top.xy,u_coords_top.zw,fractionalPos.x),mix(u_coords_bottom.xy,u_coords_bottom.zw,fractionalPos.x),fractionalPos.y);gl_Position=projectTile(position,position);v_pos0=((fractionalPos-0.5)/u_buffer_scale)+0.5;
#ifdef GLOBE
if (a_pos.y <-32767.5) {v_pos0.y=0.0;}if (a_pos.y > 32766.5) {v_pos0.y=1.0;}
#endif
v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}`),symbolIcon:ni(`uniform sampler2D u_texture;in vec2 v_tex;in float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;fragColor=texture(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`in vec4 a_pos_offset;in vec4 a_data;in vec4 a_pixeloffset;in vec3 a_projected_pos;in float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;out vec2 v_tex;out float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;
#ifdef GLOBE
if(u_pitch_with_map) {float anchor_pos_tile_y=(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w,z,1.0)).y;projectionScaling=mix(projectionScaling,1.0/circumferenceRatioAtTileY(anchor_pos_tile_y)*u_pitched_scale,u_projection_transition);}
#endif
vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}gl_Position=finalPos;v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float visibility=calculate_visibility(projectedPoint);v_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));}`),symbolSDF:ni(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;in vec2 v_data0;in vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float inner_edge=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);inner_edge=inner_edge+gamma*gamma_scale;}lowp float dist=texture(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(inner_edge-gamma_scaled,inner_edge+gamma_scaled,dist);if (u_is_halo) {lowp float halo_edge=(6.0-halo_width/fontScale)/SDF_PX;alpha=min(smoothstep(halo_edge-gamma_scaled,halo_edge+gamma_scaled,dist),1.0-alpha);}fragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`in vec4 a_pos_offset;in vec4 a_data;in vec4 a_pixeloffset;in vec3 a_projected_pos;in float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_translation;uniform float u_pitched_scale;out vec2 v_data0;out vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;
#ifdef GLOBE
if(u_pitch_with_map) {float anchor_pos_tile_y=(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w,z,1.0)).y;projectionScaling=mix(projectionScaling,1.0/circumferenceRatioAtTileY(anchor_pos_tile_y)*u_pitched_scale,u_projection_transition);}
#endif
vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),symbolTextAndIcon:ni(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;in vec4 v_data0;in vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;fragColor=texture(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);fragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`in vec4 a_pos_offset;in vec4 a_data;in vec3 a_projected_pos;in float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;out vec4 v_data0;out vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;
#ifdef GLOBE
if(u_pitch_with_map && !u_is_along_line) {float anchor_pos_tile_y=(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w,z,1.0)).y;projectionScaling=mix(projectionScaling,1.0/circumferenceRatioAtTileY(anchor_pos_tile_y)*u_pitched_scale,u_projection_transition);}
#endif
vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`),terrain:ni("uniform sampler2D u_texture;uniform vec4 u_fog_color;uniform vec4 u_horizon_color;uniform float u_fog_ground_blend;uniform float u_fog_ground_blend_opacity;uniform float u_horizon_fog_blend;uniform bool u_is_globe_mode;in vec2 v_texture_pos;in float v_fog_depth;const float gamma=2.2;vec4 gammaToLinear(vec4 color) {return pow(color,vec4(gamma));}vec4 linearToGamma(vec4 color) {return pow(color,vec4(1.0/gamma));}void main() {vec4 surface_color=texture(u_texture,vec2(v_texture_pos.x,1.0-v_texture_pos.y));if (!u_is_globe_mode && v_fog_depth > u_fog_ground_blend) {vec4 surface_color_linear=gammaToLinear(surface_color);float blend_color=smoothstep(0.0,1.0,max((v_fog_depth-u_horizon_fog_blend)/(1.0-u_horizon_fog_blend),0.0));vec4 fog_horizon_color_linear=mix(gammaToLinear(u_fog_color),gammaToLinear(u_horizon_color),blend_color);float factor_fog=max(v_fog_depth-u_fog_ground_blend,0.0)/(1.0-u_fog_ground_blend);fragColor=linearToGamma(mix(surface_color_linear,fog_horizon_color_linear,pow(factor_fog,2.0)*u_fog_ground_blend_opacity));} else {fragColor=surface_color;}}","in vec3 a_pos3d;uniform mat4 u_fog_matrix;uniform float u_ele_delta;out vec2 v_texture_pos;out float v_fog_depth;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/8192.0;gl_Position=projectTileFor3D(a_pos3d.xy,get_elevation(a_pos3d.xy)-ele_delta);vec4 pos=u_fog_matrix*vec4(a_pos3d.xy,ele,1.0);v_fog_depth=pos.z/pos.w*0.5+0.5;}"),terrainDepth:ni("in float v_depth;const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitMsk=vec4(0.,vec3(1./256.0));highp vec4 pack(highp float value) {highp vec4 comp=fract(value*bitSh);comp-=comp.xxyz*bitMsk;return comp;}void main() {fragColor=pack(v_depth);}","in vec3 a_pos3d;uniform float u_ele_delta;out float v_depth;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;gl_Position=projectTileFor3D(a_pos3d.xy,ele-ele_delta);v_depth=gl_Position.z/gl_Position.w;}"),terrainCoords:ni("precision mediump float;uniform sampler2D u_texture;uniform float u_terrain_coords_id;in vec2 v_texture_pos;void main() {vec4 rgba=texture(u_texture,v_texture_pos);fragColor=vec4(rgba.r,rgba.g,rgba.b,u_terrain_coords_id);}","in vec3 a_pos3d;uniform float u_ele_delta;out vec2 v_texture_pos;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/8192.0;gl_Position=projectTileFor3D(a_pos3d.xy,ele-ele_delta);}"),projectionErrorMeasurement:ni("in vec4 v_output_error_encoded;void main() {fragColor=v_output_error_encoded;}","in vec2 a_pos;uniform highp float u_input;uniform highp float u_output_expected;out vec4 v_output_error_encoded;void main() {float real_output=2.0*atan(exp(PI-(u_input*PI*2.0)))-PI*0.5;float error=real_output-u_output_expected;float abs_error=abs(error)*128.0;v_output_error_encoded.x=min(floor(abs_error*256.0),255.0)/255.0;abs_error-=v_output_error_encoded.x;v_output_error_encoded.y=min(floor(abs_error*65536.0),255.0)/255.0;abs_error-=v_output_error_encoded.x/255.0;v_output_error_encoded.z=min(floor(abs_error*16777216.0),255.0)/255.0;v_output_error_encoded.w=error >=0.0 ? 1.0 : 0.0;gl_Position=vec4(a_pos,0.0,1.0);}"),atmosphere:ni(`in vec3 view_direction;uniform vec3 u_sun_pos;uniform vec3 u_globe_position;uniform float u_globe_radius;uniform float u_atmosphere_blend;/**Shader use from https:*Made some change to adapt to MapLibre Globe geometry*/const float PI=3.141592653589793;const int iSteps=5;const int jSteps=3;/*radius of the planet*/const float EARTH_RADIUS=6371e3;/*radius of the atmosphere*/const float ATMOS_RADIUS=6471e3;vec2 rsi(vec3 r0,vec3 rd,float sr) {float a=dot(rd,rd);float b=2.0*dot(rd,r0);float c=dot(r0,r0)-(sr*sr);float d=(b*b)-4.0*a*c;if (d < 0.0) return vec2(1e5,-1e5);return vec2((-b-sqrt(d))/(2.0*a),(-b+sqrt(d))/(2.0*a));}vec4 atmosphere(vec3 r,vec3 r0,vec3 pSun,float iSun,float rPlanet,float rAtmos,vec3 kRlh,float kMie,float shRlh,float shMie,float g) {pSun=normalize(pSun);r=normalize(r);vec2 p=rsi(r0,r,rAtmos);if (p.x > p.y) {return vec4(0.0,0.0,0.0,1.0);}if (p.x < 0.0) {p.x=0.0;}vec3 pos=r0+r*p.x;vec2 p2=rsi(r0,r,rPlanet);if (p2.x <=p2.y && p2.x > 0.0) {p.y=min(p.y,p2.x);}float iStepSize=(p.y-p.x)/float(iSteps);float iTime=p.x+iStepSize*0.5;vec3 totalRlh=vec3(0,0,0);vec3 totalMie=vec3(0,0,0);float iOdRlh=0.0;float iOdMie=0.0;float mu=dot(r,pSun);float mumu=mu*mu;float gg=g*g;float pRlh=3.0/(16.0*PI)*(1.0+mumu);float pMie=3.0/(8.0*PI)*((1.0-gg)*(mumu+1.0))/(pow(1.0+gg-2.0*mu*g,1.5)*(2.0+gg));for (int i=0; i < iSteps; i++) {vec3 iPos=r0+r*iTime;float iHeight=length(iPos)-rPlanet;float odStepRlh=exp(-iHeight/shRlh)*iStepSize;float odStepMie=exp(-iHeight/shMie)*iStepSize;iOdRlh+=odStepRlh;iOdMie+=odStepMie;float jStepSize=rsi(iPos,pSun,rAtmos).y/float(jSteps);float jTime=jStepSize*0.5;float jOdRlh=0.0;float jOdMie=0.0;for (int j=0; j < jSteps; j++) {vec3 jPos=iPos+pSun*jTime;float jHeight=length(jPos)-rPlanet;jOdRlh+=exp(-jHeight/shRlh)*jStepSize;jOdMie+=exp(-jHeight/shMie)*jStepSize;jTime+=jStepSize;}vec3 attn=exp(-(kMie*(iOdMie+jOdMie)+kRlh*(iOdRlh+jOdRlh)));totalRlh+=odStepRlh*attn;totalMie+=odStepMie*attn;iTime+=iStepSize;}float opacity=exp(-(length(kRlh)*length(totalRlh)+kMie*length(totalMie)));vec3 color=iSun*(pRlh*kRlh*totalRlh+pMie*kMie*totalMie);return vec4(color,opacity);}void main() {vec3 scale_camera_pos=-u_globe_position*EARTH_RADIUS/u_globe_radius;vec4 color=atmosphere(normalize(view_direction),scale_camera_pos,u_sun_pos,22.0,EARTH_RADIUS,ATMOS_RADIUS,vec3(5.5e-6,13.0e-6,22.4e-6),21e-6,8e3,1.2e3,0.758
);color.rgb=1.0-exp(-1.0*color.rgb);color=pow(color,vec4(1.0/2.2));fragColor=vec4(color.rgb,1.0-color.a)*u_atmosphere_blend;}`,"in vec2 a_pos;uniform mat4 u_inv_proj_matrix;out vec3 view_direction;void main() {view_direction=(u_inv_proj_matrix*vec4(a_pos,0.0,1.0)).xyz;gl_Position=vec4(a_pos,0.0,1.0);}"),sky:ni("uniform vec4 u_sky_color;uniform vec4 u_horizon_color;uniform vec2 u_horizon;uniform vec2 u_horizon_normal;uniform float u_sky_horizon_blend;uniform float u_sky_blend;void main() {float x=gl_FragCoord.x;float y=gl_FragCoord.y;float blend=(y-u_horizon.y)*u_horizon_normal.y+(x-u_horizon.x)*u_horizon_normal.x;if (blend > 0.0) {if (blend < u_sky_horizon_blend) {fragColor=mix(u_sky_color,u_horizon_color,pow(1.0-blend/u_sky_horizon_blend,2.0));} else {fragColor=u_sky_color;}}fragColor=mix(fragColor,vec4(vec3(0.0),0.0),u_sky_blend);}","in vec2 a_pos;void main() {gl_Position=vec4(a_pos,1.0,1.0);}")};function ni(I,u){const m=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,w=u.match(/in ([\w]+) ([\w]+)/g),M=I.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),R=u.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),N=R?R.concat(M):M,H={};return{fragmentSource:I=I.replace(m,((j,Y,K,ie,re)=>(H[re]=!0,Y==="define"?`
#ifndef HAS_UNIFORM_u_${re}
in ${K} ${ie} ${re};
#else
uniform ${K} ${ie} u_${re};
#endif
`:`
#ifdef HAS_UNIFORM_u_${re}
    ${K} ${ie} ${re} = u_${re};
#endif
`))),vertexSource:u=u.replace(m,((j,Y,K,ie,re)=>{const ue=ie==="float"?"vec2":"vec4",pe=re.match(/color/)?"color":ue;return H[re]?Y==="define"?`
#ifndef HAS_UNIFORM_u_${re}
uniform lowp float u_${re}_t;
in ${K} ${ue} a_${re};
out ${K} ${ie} ${re};
#else
uniform ${K} ${ie} u_${re};
#endif
`:pe==="vec4"?`
#ifndef HAS_UNIFORM_u_${re}
    ${re} = a_${re};
#else
    ${K} ${ie} ${re} = u_${re};
#endif
`:`
#ifndef HAS_UNIFORM_u_${re}
    ${re} = unpack_mix_${pe}(a_${re}, u_${re}_t);
#else
    ${K} ${ie} ${re} = u_${re};
#endif
`:Y==="define"?`
#ifndef HAS_UNIFORM_u_${re}
uniform lowp float u_${re}_t;
in ${K} ${ue} a_${re};
#else
uniform ${K} ${ie} u_${re};
#endif
`:pe==="vec4"?`
#ifndef HAS_UNIFORM_u_${re}
    ${K} ${ie} ${re} = a_${re};
#else
    ${K} ${ie} ${re} = u_${re};
#endif
`:`
#ifndef HAS_UNIFORM_u_${re}
    ${K} ${ie} ${re} = unpack_mix_${pe}(a_${re}, u_${re}_t);
#else
    ${K} ${ie} ${re} = u_${re};
#endif
`})),staticAttributes:w,staticUniforms:N}}class Au{constructor(u,m,w){this.vertexBuffer=u,this.indexBuffer=m,this.segments=w}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.vertexBuffer=null,this.indexBuffer=null,this.segments=null}}var Ka=o.aJ([{name:"a_pos",type:"Int16",components:2}]);const Rc="#define PROJECTION_MERCATOR",Zr="mercator";class Lo{constructor(){this._cachedMesh=null}get name(){return"mercator"}get useSubdivision(){return!1}get shaderVariantName(){return Zr}get shaderDefine(){return Rc}get shaderPreludeCode(){return Ba.projectionMercator}get vertexShaderPreludeCode(){return Ba.projectionMercator.vertexSource}get subdivisionGranularity(){return o.aK.noSubdivision}get useGlobeControls(){return!1}get transitionState(){return 0}get latitudeErrorCorrectionRadians(){return 0}destroy(){}updateGPUdependent(u){}getMeshFromTileID(u,m,w,M,R){if(this._cachedMesh)return this._cachedMesh;const N=new o.aL;N.emplaceBack(0,0),N.emplaceBack(o.$,0),N.emplaceBack(0,o.$),N.emplaceBack(o.$,o.$);const H=u.createVertexBuffer(N,Ka.members),j=o.aM.simpleSegment(0,0,4,2),Y=new o.aN;Y.emplaceBack(1,0,2),Y.emplaceBack(1,2,3);const K=u.createIndexBuffer(Y);return this._cachedMesh=new Au(H,K,j),this._cachedMesh}recalculate(){}hasTransition(){return!1}setErrorQueryLatitudeDegrees(u){}}class Dc{constructor(u=0,m=0,w=0,M=0){if(isNaN(u)||u<0||isNaN(m)||m<0||isNaN(w)||w<0||isNaN(M)||M<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=u,this.bottom=m,this.left=w,this.right=M}interpolate(u,m,w){return m.top!=null&&u.top!=null&&(this.top=o.C.number(u.top,m.top,w)),m.bottom!=null&&u.bottom!=null&&(this.bottom=o.C.number(u.bottom,m.bottom,w)),m.left!=null&&u.left!=null&&(this.left=o.C.number(u.left,m.left,w)),m.right!=null&&u.right!=null&&(this.right=o.C.number(u.right,m.right,w)),this}getCenter(u,m){const w=o.ah((this.left+u-this.right)/2,0,u),M=o.ah((this.top+m-this.bottom)/2,0,m);return new o.P(w,M)}equals(u){return this.top===u.top&&this.bottom===u.bottom&&this.left===u.left&&this.right===u.right}clone(){return new Dc(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function Cu(I,u){if(!I.renderWorldCopies||I.lngRange)return;const m=u.lng-I.center.lng;u.lng+=m>180?-360:m<-180?360:0}function ta(I){return Math.max(0,Math.floor(I))}class Rn{constructor(u,m,w,M,R,N){this._callbacks=u,this._tileSize=512,this._renderWorldCopies=N===void 0||!!N,this._minZoom=m||0,this._maxZoom=w||22,this._minPitch=M??0,this._maxPitch=R??60,this.setMaxBounds(),this._width=0,this._height=0,this._center=new o.S(0,0),this._elevation=0,this._zoom=0,this._tileZoom=ta(this._zoom),this._scale=o.af(this._zoom),this._bearingInRadians=0,this._fovInRadians=.6435011087932844,this._pitchInRadians=0,this._rollInRadians=0,this._unmodified=!0,this._edgeInsets=new Dc,this._minElevationForCurrentTile=0,this._autoCalculateNearFarZ=!0}apply(u,m,w){this._latRange=u.latRange,this._lngRange=u.lngRange,this._width=u.width,this._height=u.height,this._center=u.center,this._elevation=u.elevation,this._minElevationForCurrentTile=u.minElevationForCurrentTile,this._zoom=u.zoom,this._tileZoom=ta(this._zoom),this._scale=o.af(this._zoom),this._bearingInRadians=u.bearingInRadians,this._fovInRadians=u.fovInRadians,this._pitchInRadians=u.pitchInRadians,this._rollInRadians=u.rollInRadians,this._unmodified=u.unmodified,this._edgeInsets=new Dc(u.padding.top,u.padding.bottom,u.padding.left,u.padding.right),this._minZoom=u.minZoom,this._maxZoom=u.maxZoom,this._minPitch=u.minPitch,this._maxPitch=u.maxPitch,this._renderWorldCopies=u.renderWorldCopies,this._cameraToCenterDistance=u.cameraToCenterDistance,this._nearZ=u.nearZ,this._farZ=u.farZ,this._autoCalculateNearFarZ=!w&&u.autoCalculateNearFarZ,m&&this._constrain(),this._calcMatrices()}get pixelsToClipSpaceMatrix(){return this._pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._clipSpaceToPixelsMatrix}get minElevationForCurrentTile(){return this._minElevationForCurrentTile}setMinElevationForCurrentTile(u){this._minElevationForCurrentTile=u}get tileSize(){return this._tileSize}get tileZoom(){return this._tileZoom}get scale(){return this._scale}get width(){return this._width}get height(){return this._height}get bearingInRadians(){return this._bearingInRadians}get lngRange(){return this._lngRange}get latRange(){return this._latRange}get pixelsToGLUnits(){return this._pixelsToGLUnits}get minZoom(){return this._minZoom}setMinZoom(u){this._minZoom!==u&&(this._minZoom=u,this.setZoom(this.getConstrained(this._center,this.zoom).zoom))}get maxZoom(){return this._maxZoom}setMaxZoom(u){this._maxZoom!==u&&(this._maxZoom=u,this.setZoom(this.getConstrained(this._center,this.zoom).zoom))}get minPitch(){return this._minPitch}setMinPitch(u){this._minPitch!==u&&(this._minPitch=u,this.setPitch(Math.max(this.pitch,u)))}get maxPitch(){return this._maxPitch}setMaxPitch(u){this._maxPitch!==u&&(this._maxPitch=u,this.setPitch(Math.min(this.pitch,u)))}get renderWorldCopies(){return this._renderWorldCopies}setRenderWorldCopies(u){u===void 0?u=!0:u===null&&(u=!1),this._renderWorldCopies=u}get worldSize(){return this._tileSize*this._scale}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new o.P(this._width,this._height)}get bearing(){return this._bearingInRadians/Math.PI*180}setBearing(u){const m=o.aO(u,-180,180)*Math.PI/180;var w,M,R,N,H,j,Y,K,ie;this._bearingInRadians!==m&&(this._unmodified=!1,this._bearingInRadians=m,this._calcMatrices(),this._rotationMatrix=c(),w=this._rotationMatrix,R=-this._bearingInRadians,N=(M=this._rotationMatrix)[0],H=M[1],j=M[2],Y=M[3],K=Math.sin(R),ie=Math.cos(R),w[0]=N*ie+j*K,w[1]=H*ie+Y*K,w[2]=N*-K+j*ie,w[3]=H*-K+Y*ie)}get rotationMatrix(){return this._rotationMatrix}get pitchInRadians(){return this._pitchInRadians}get pitch(){return this._pitchInRadians/Math.PI*180}setPitch(u){const m=o.ah(u,this.minPitch,this.maxPitch)/180*Math.PI;this._pitchInRadians!==m&&(this._unmodified=!1,this._pitchInRadians=m,this._calcMatrices())}get rollInRadians(){return this._rollInRadians}get roll(){return this._rollInRadians/Math.PI*180}setRoll(u){const m=u/180*Math.PI;this._rollInRadians!==m&&(this._unmodified=!1,this._rollInRadians=m,this._calcMatrices())}get fovInRadians(){return this._fovInRadians}get fov(){return o.aP(this._fovInRadians)}setFov(u){u=o.ah(u,.1,150),this.fov!==u&&(this._unmodified=!1,this._fovInRadians=o.ae(u),this._calcMatrices())}get zoom(){return this._zoom}setZoom(u){const m=this.getConstrained(this._center,u).zoom;this._zoom!==m&&(this._unmodified=!1,this._zoom=m,this._tileZoom=Math.max(0,Math.floor(m)),this._scale=o.af(m),this._constrain(),this._calcMatrices())}get center(){return this._center}setCenter(u){u.lat===this._center.lat&&u.lng===this._center.lng||(this._unmodified=!1,this._center=u,this._constrain(),this._calcMatrices())}get elevation(){return this._elevation}setElevation(u){u!==this._elevation&&(this._elevation=u,this._constrain(),this._calcMatrices())}get padding(){return this._edgeInsets.toJSON()}setPadding(u){this._edgeInsets.equals(u)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,u,1),this._calcMatrices())}get centerPoint(){return this._edgeInsets.getCenter(this._width,this._height)}get pixelsPerMeter(){return this._pixelPerMeter}get unmodified(){return this._unmodified}get cameraToCenterDistance(){return this._cameraToCenterDistance}get nearZ(){return this._nearZ}get farZ(){return this._farZ}get autoCalculateNearFarZ(){return this._autoCalculateNearFarZ}overrideNearFarZ(u,m){this._autoCalculateNearFarZ=!1,this._nearZ=u,this._farZ=m,this._calcMatrices()}clearNearFarZOverride(){this._autoCalculateNearFarZ=!0,this._calcMatrices()}isPaddingEqual(u){return this._edgeInsets.equals(u)}interpolatePadding(u,m,w){this._unmodified=!1,this._edgeInsets.interpolate(u,m,w),this._constrain(),this._calcMatrices()}resize(u,m,w=!0){this._width=u,this._height=m,w&&this._constrain(),this._calcMatrices()}getMaxBounds(){return this._latRange&&this._latRange.length===2&&this._lngRange&&this._lngRange.length===2?new Tr([this._lngRange[0],this._latRange[0]],[this._lngRange[1],this._latRange[1]]):null}setMaxBounds(u){u?(this._lngRange=[u.getWest(),u.getEast()],this._latRange=[u.getSouth(),u.getNorth()],this._constrain()):(this._lngRange=null,this._latRange=[-o.ai,o.ai])}getConstrained(u,m){return this._callbacks.getConstrained(u,m)}getCameraQueryGeometry(u,m){if(m.length===1)return[m[0],u];{const{minX:w,minY:M,maxX:R,maxY:N}=o.a2.fromPoints(m).extend(u);return[new o.P(w,M),new o.P(R,M),new o.P(R,N),new o.P(w,N),new o.P(w,M)]}}_constrain(){if(!this.center||!this._width||!this._height||this._constraining)return;this._constraining=!0;const u=this._unmodified,{center:m,zoom:w}=this.getConstrained(this.center,this.zoom);this.setCenter(m),this.setZoom(w),this._unmodified=u,this._constraining=!1}_calcMatrices(){if(this._width&&this._height){this._pixelsToGLUnits=[2/this._width,-2/this._height];let u=o.ag(new Float64Array(16));o.N(u,u,[this._width/2,-this._height/2,1]),o.M(u,u,[1,-1,0]),this._clipSpaceToPixelsMatrix=u,u=o.ag(new Float64Array(16)),o.N(u,u,[1,-1,1]),o.M(u,u,[-1,-1,0]),o.N(u,u,[2/this._width,2/this._height,1]),this._pixelsToClipSpaceMatrix=u,this._cameraToCenterDistance=.5/Math.tan(this.fovInRadians/2)*this._height}this._callbacks.calcMatrices()}calculateCenterFromCameraLngLatAlt(u,m,w,M){const R=w!==void 0?w:this.bearing,N=M=M!==void 0?M:this.pitch,H=o.a1.fromLngLat(u,m),j=-Math.cos(o.ae(N)),Y=Math.sin(o.ae(N)),K=Y*Math.sin(o.ae(R)),ie=-Y*Math.cos(o.ae(R));let re=this.elevation;const ue=m-re;let pe;j*ue>=0||Math.abs(j)<.1?(pe=1e4,re=m+pe*j):pe=-ue/j;let Se,Te,Ce=o.aQ(1,H.y),Ie=0;do{if(Ie+=1,Ie>10)break;Te=pe/Ce,Se=new o.a1(H.x+K*Te,H.y+ie*Te),Ce=1/Se.meterInMercatorCoordinateUnits()}while(Math.abs(pe-Te*Ce)>1e-12);return{center:Se.toLngLat(),elevation:re,zoom:o.ak(this.height/2/Math.tan(this.fovInRadians/2)/Te/this.tileSize)}}recalculateZoomAndCenter(u){if(this.elevation-u==0)return;const m=o.aj(1,this.center.lat)*this.worldSize,w=this.cameraToCenterDistance/m,M=o.a1.fromLngLat(this.center,this.elevation),R=yt(this.center,this.elevation,this.pitch,this.bearing,w);this._elevation=u;const N=this.calculateCenterFromCameraLngLatAlt(R.toLngLat(),o.aQ(R.z,M.y),this.bearing,this.pitch);this._elevation=N.elevation,this._center=N.center,this.setZoom(N.zoom)}getCameraPoint(){const u=Math.tan(this.pitchInRadians)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new o.P(u*Math.sin(this.rollInRadians),u*Math.cos(this.rollInRadians)))}getCameraAltitude(){return Math.cos(this.pitchInRadians)*this._cameraToCenterDistance/this._pixelPerMeter+this.elevation}getCameraLngLat(){const u=o.aj(1,this.center.lat)*this.worldSize;return yt(this.center,this.elevation,this.pitch,this.bearing,this.cameraToCenterDistance/u).toLngLat()}getMercatorTileCoordinates(u){if(!u)return[0,0,1,1];const m=u.canonical.z>=0?1<<u.canonical.z:Math.pow(2,u.canonical.z);return[u.canonical.x/m,u.canonical.y/m,1/m/o.$,1/m/o.$]}}class ra{constructor(u,m){this.min=u,this.max=m,this.center=o.aR([],o.aS([],this.min,this.max),.5)}quadrant(u){const m=[u%2==0,u<2],w=o.aT(this.min),M=o.aT(this.max);for(let R=0;R<m.length;R++)w[R]=m[R]?this.min[R]:this.center[R],M[R]=m[R]?this.center[R]:this.max[R];return M[2]=this.max[2],new ra(w,M)}distanceX(u){return Math.max(Math.min(this.max[0],u[0]),this.min[0])-u[0]}distanceY(u){return Math.max(Math.min(this.max[1],u[1]),this.min[1])-u[1]}intersectsFrustum(u){let m=!0;for(let w=0;w<u.planes.length;w++){const M=this.intersectsPlane(u.planes[w]);if(M===0)return 0;M===1&&(m=!1)}return m?2:u.aabb.min[0]>this.max[0]||u.aabb.min[1]>this.max[1]||u.aabb.min[2]>this.max[2]||u.aabb.max[0]<this.min[0]||u.aabb.max[1]<this.min[1]||u.aabb.max[2]<this.min[2]?0:1}intersectsPlane(u){let m=u[3],w=u[3];for(let M=0;M<3;M++)u[M]>0?(m+=u[M]*this.min[M],w+=u[M]*this.max[M]):(w+=u[M]*this.min[M],m+=u[M]*this.max[M]);return m>=0?2:w<0?0:1}}class ia{distanceToTile2d(u,m,w,M){const R=M.distanceX([u,m]),N=M.distanceY([u,m]);return Math.hypot(R,N)}getWrap(u,m,w){return w}getTileBoundingVolume(u,m,w,M){var R,N;let H=0,j=0;if(M?.terrain){const K=new o.Z(u.z,m,u.z,u.x,u.y),ie=M.terrain.getMinMaxElevation(K);H=(R=ie.minElevation)!==null&&R!==void 0?R:Math.min(0,w),j=(N=ie.maxElevation)!==null&&N!==void 0?N:Math.max(0,w)}const Y=1<<u.z;return new ra([m+u.x/Y,u.y/Y,H],[m+(u.x+1)/Y,(u.y+1)/Y,j])}allowVariableZoom(u,m){const w=u.fov*(Math.abs(Math.cos(u.rollInRadians))*u.height+Math.abs(Math.sin(u.rollInRadians))*u.width)/u.height,M=o.ah(78.5-w/2,0,60);return!!m.terrain||u.pitch>M}allowWorldCopies(){return!0}prepareNextFrame(){}}class qi{constructor(u,m,w){this.points=u,this.planes=m,this.aabb=w}static fromInvProjectionMatrix(u,m=1,w=0,M,R){const N=R?[[6,5,4],[0,1,2],[0,3,7],[2,1,5],[3,2,6],[0,4,5]]:[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]],H=Math.pow(2,w),j=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map((re=>(function(ue,pe,Se,Te){const Ce=o.aw([],ue,pe),Ie=1/Ce[3]/Se*Te;return o.aY(Ce,Ce,[Ie,Ie,1/Ce[3],Ie])})(re,u,m,H)));M&&(function(re,ue,pe,Se){const Te=Se?4:0,Ce=Se?0:4;let Ie=0;const ke=[],Re=[];for(let Le=0;Le<4;Le++){const Xe=o.aU([],re[Le+Ce],re[Le+Te]),ht=o.aZ(Xe);o.aR(Xe,Xe,1/ht),ke.push(ht),Re.push(Xe)}for(let Le=0;Le<4;Le++){const Xe=o.a_(re[Le+Te],Re[Le],pe);Ie=Xe!==null&&Xe>=0?Math.max(Ie,Xe):Math.max(Ie,ke[Le])}const ze=(function(Le,Xe){const ht=o.aU([],Le[Xe[0]],Le[Xe[1]]),at=o.aU([],Le[Xe[2]],Le[Xe[1]]),st=[0,0,0,0];return o.aV(st,o.aW([],ht,at)),st[3]=-o.aX(st,Le[Xe[0]]),st})(re,ue),He=(function(Le,Xe){const ht=o.a$(Le),at=o.b0([],Le,1/ht),st=o.aU([],Xe,o.aR([],at,o.aX(Xe,at))),lt=o.a$(st);if(lt>0){const Ot=Math.sqrt(1-at[3]*at[3]),Bt=o.aR([],at,-at[3]),Ct=o.aS([],Bt,o.aR([],st,Ot/lt));return o.b1(Xe,Ct)}return null})(pe,ze);if(He!==null){const Le=He/o.aX(Re[0],ze);Ie=Math.min(Ie,Le)}for(let Le=0;Le<4;Le++){const Xe=Math.min(Ie,ke[Le]);re[Le+Ce]=[re[Le+Te][0]+Re[Le][0]*Xe,re[Le+Te][1]+Re[Le][1]*Xe,re[Le+Te][2]+Re[Le][2]*Xe,1]}})(j,N[0],M,R);const Y=N.map((re=>{const ue=o.aU([],j[re[0]],j[re[1]]),pe=o.aU([],j[re[2]],j[re[1]]),Se=o.aV([],o.aW([],ue,pe)),Te=-o.aX(Se,j[re[1]]);return Se.concat(Te)})),K=[Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY],ie=[Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY];for(const re of j)for(let ue=0;ue<3;ue++)K[ue]=Math.min(K[ue],re[ue]),ie[ue]=Math.max(ie[ue],re[ue]);return new qi(j,Y,new ra(K,ie))}}class pl{get pixelsToClipSpaceMatrix(){return this._helper.pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._helper.clipSpaceToPixelsMatrix}get pixelsToGLUnits(){return this._helper.pixelsToGLUnits}get centerOffset(){return this._helper.centerOffset}get size(){return this._helper.size}get rotationMatrix(){return this._helper.rotationMatrix}get centerPoint(){return this._helper.centerPoint}get pixelsPerMeter(){return this._helper.pixelsPerMeter}setMinZoom(u){this._helper.setMinZoom(u)}setMaxZoom(u){this._helper.setMaxZoom(u)}setMinPitch(u){this._helper.setMinPitch(u)}setMaxPitch(u){this._helper.setMaxPitch(u)}setRenderWorldCopies(u){this._helper.setRenderWorldCopies(u)}setBearing(u){this._helper.setBearing(u)}setPitch(u){this._helper.setPitch(u)}setRoll(u){this._helper.setRoll(u)}setFov(u){this._helper.setFov(u)}setZoom(u){this._helper.setZoom(u)}setCenter(u){this._helper.setCenter(u)}setElevation(u){this._helper.setElevation(u)}setMinElevationForCurrentTile(u){this._helper.setMinElevationForCurrentTile(u)}setPadding(u){this._helper.setPadding(u)}interpolatePadding(u,m,w){return this._helper.interpolatePadding(u,m,w)}isPaddingEqual(u){return this._helper.isPaddingEqual(u)}resize(u,m,w=!0){this._helper.resize(u,m,w)}getMaxBounds(){return this._helper.getMaxBounds()}setMaxBounds(u){this._helper.setMaxBounds(u)}overrideNearFarZ(u,m){this._helper.overrideNearFarZ(u,m)}clearNearFarZOverride(){this._helper.clearNearFarZOverride()}getCameraQueryGeometry(u){return this._helper.getCameraQueryGeometry(this.getCameraPoint(),u)}get tileSize(){return this._helper.tileSize}get tileZoom(){return this._helper.tileZoom}get scale(){return this._helper.scale}get worldSize(){return this._helper.worldSize}get width(){return this._helper.width}get height(){return this._helper.height}get lngRange(){return this._helper.lngRange}get latRange(){return this._helper.latRange}get minZoom(){return this._helper.minZoom}get maxZoom(){return this._helper.maxZoom}get zoom(){return this._helper.zoom}get center(){return this._helper.center}get minPitch(){return this._helper.minPitch}get maxPitch(){return this._helper.maxPitch}get pitch(){return this._helper.pitch}get pitchInRadians(){return this._helper.pitchInRadians}get roll(){return this._helper.roll}get rollInRadians(){return this._helper.rollInRadians}get bearing(){return this._helper.bearing}get bearingInRadians(){return this._helper.bearingInRadians}get fov(){return this._helper.fov}get fovInRadians(){return this._helper.fovInRadians}get elevation(){return this._helper.elevation}get minElevationForCurrentTile(){return this._helper.minElevationForCurrentTile}get padding(){return this._helper.padding}get unmodified(){return this._helper.unmodified}get renderWorldCopies(){return this._helper.renderWorldCopies}get cameraToCenterDistance(){return this._helper.cameraToCenterDistance}get nearZ(){return this._helper.nearZ}get farZ(){return this._helper.farZ}get autoCalculateNearFarZ(){return this._helper.autoCalculateNearFarZ}setTransitionState(u,m){}constructor(u,m,w,M,R){this._posMatrixCache=new Map,this._alignedPosMatrixCache=new Map,this._fogMatrixCacheF32=new Map,this._helper=new Rn({calcMatrices:()=>{this._calcMatrices()},getConstrained:(N,H)=>this.getConstrained(N,H)},u,m,w,M,R),this._coveringTilesDetailsProvider=new ia}clone(){const u=new pl;return u.apply(this),u}apply(u,m,w){this._helper.apply(u,m,w)}get cameraPosition(){return this._cameraPosition}get projectionMatrix(){return this._projectionMatrix}get modelViewProjectionMatrix(){return this._viewProjMatrix}get inverseProjectionMatrix(){return this._invProjMatrix}get mercatorMatrix(){return this._mercatorMatrix}getVisibleUnwrappedCoordinates(u){const m=[new o.b2(0,u)];if(this._helper._renderWorldCopies){const w=this.screenPointToMercatorCoordinate(new o.P(0,0)),M=this.screenPointToMercatorCoordinate(new o.P(this._helper._width,0)),R=this.screenPointToMercatorCoordinate(new o.P(this._helper._width,this._helper._height)),N=this.screenPointToMercatorCoordinate(new o.P(0,this._helper._height)),H=Math.floor(Math.min(w.x,M.x,R.x,N.x)),j=Math.floor(Math.max(w.x,M.x,R.x,N.x)),Y=1;for(let K=H-Y;K<=j+Y;K++)K!==0&&m.push(new o.b2(K,u))}return m}getCameraFrustum(){return qi.fromInvProjectionMatrix(this._invViewProjMatrix,this.worldSize)}getClippingPlane(){return null}getCoveringTilesDetailsProvider(){return this._coveringTilesDetailsProvider}recalculateZoomAndCenter(u){const m=this.screenPointToLocation(this.centerPoint,u),w=u?u.getElevationForLngLatZoom(m,this._helper._tileZoom):0;this._helper.recalculateZoomAndCenter(w)}setLocationAtPoint(u,m){const w=o.aj(this.elevation,this.center.lat),M=this.screenPointToMercatorCoordinateAtZ(m,w),R=this.screenPointToMercatorCoordinateAtZ(this.centerPoint,w),N=o.a1.fromLngLat(u),H=new o.a1(N.x-(M.x-R.x),N.y-(M.y-R.y));this.setCenter(H?.toLngLat()),this._helper._renderWorldCopies&&this.setCenter(this.center.wrap())}locationToScreenPoint(u,m){return m?this.coordinatePoint(o.a1.fromLngLat(u),m.getElevationForLngLatZoom(u,this._helper._tileZoom),this._pixelMatrix3D):this.coordinatePoint(o.a1.fromLngLat(u))}screenPointToLocation(u,m){var w;return(w=this.screenPointToMercatorCoordinate(u,m))===null||w===void 0?void 0:w.toLngLat()}screenPointToMercatorCoordinate(u,m){if(m){const w=m.pointCoordinate(u);if(w!=null)return w}return this.screenPointToMercatorCoordinateAtZ(u)}screenPointToMercatorCoordinateAtZ(u,m){const w=m||0,M=[u.x,u.y,0,1],R=[u.x,u.y,1,1];o.aw(M,M,this._pixelMatrixInverse),o.aw(R,R,this._pixelMatrixInverse);const N=M[3],H=R[3],j=M[1]/N,Y=R[1]/H,K=M[2]/N,ie=R[2]/H,re=K===ie?0:(w-K)/(ie-K);return new o.a1(o.C.number(M[0]/N,R[0]/H,re)/this.worldSize,o.C.number(j,Y,re)/this.worldSize,w)}coordinatePoint(u,m=0,w=this._pixelMatrix){const M=[u.x*this.worldSize,u.y*this.worldSize,m,1];return o.aw(M,M,w),new o.P(M[0]/M[3],M[1]/M[3])}getBounds(){const u=Math.max(0,this._helper._height/2-it(this));return new Tr().extend(this.screenPointToLocation(new o.P(0,u))).extend(this.screenPointToLocation(new o.P(this._helper._width,u))).extend(this.screenPointToLocation(new o.P(this._helper._width,this._helper._height))).extend(this.screenPointToLocation(new o.P(0,this._helper._height)))}isPointOnMapSurface(u,m){return m?m.pointCoordinate(u)!=null:u.y>this.height/2-it(this)}calculatePosMatrix(u,m=!1,w){var M;const R=(M=u.key)!==null&&M!==void 0?M:o.b3(u.wrap,u.canonical.z,u.canonical.z,u.canonical.x,u.canonical.y),N=m?this._alignedPosMatrixCache:this._posMatrixCache;if(N.has(R)){const Y=N.get(R);return w?Y.f32:Y.f64}const H=Ke(u,this.worldSize);o.O(H,m?this._alignedProjMatrix:this._viewProjMatrix,H);const j={f64:H,f32:new Float32Array(H)};return N.set(R,j),w?j.f32:j.f64}calculateFogMatrix(u){const m=u.key,w=this._fogMatrixCacheF32;if(w.has(m))return w.get(m);const M=Ke(u,this.worldSize);return o.O(M,this._fogMatrix,M),w.set(m,new Float32Array(M)),w.get(m)}getConstrained(u,m){m=o.ah(+m,this.minZoom,this.maxZoom);const w={center:new o.S(u.lng,u.lat),zoom:m};let M=this._helper._lngRange;if(!this._helper._renderWorldCopies&&M===null){const ke=179.9999999999;M=[-ke,ke]}const R=this.tileSize*o.af(w.zoom);let N=0,H=R,j=0,Y=R,K=0,ie=0;const{x:re,y:ue}=this.size;if(this._helper._latRange){const ke=this._helper._latRange;N=o.U(ke[1])*R,H=o.U(ke[0])*R,H-N<ue&&(K=ue/(H-N))}M&&(j=o.aO(o.V(M[0])*R,0,R),Y=o.aO(o.V(M[1])*R,0,R),Y<j&&(Y+=R),Y-j<re&&(ie=re/(Y-j)));const{x:pe,y:Se}=Be(R,u);let Te,Ce;const Ie=Math.max(ie||0,K||0);if(Ie){const ke=new o.P(ie?(Y+j)/2:pe,K?(H+N)/2:Se);return w.center=We(R,ke).wrap(),w.zoom+=o.ak(Ie),w}if(this._helper._latRange){const ke=ue/2;Se-ke<N&&(Ce=N+ke),Se+ke>H&&(Ce=H-ke)}if(M){const ke=(j+Y)/2;let Re=pe;this._helper._renderWorldCopies&&(Re=o.aO(pe,ke-R/2,ke+R/2));const ze=re/2;Re-ze<j&&(Te=j+ze),Re+ze>Y&&(Te=Y-ze)}if(Te!==void 0||Ce!==void 0){const ke=new o.P(Te??pe,Ce??Se);w.center=We(R,ke).wrap()}return w}calculateCenterFromCameraLngLatAlt(u,m,w,M){return this._helper.calculateCenterFromCameraLngLatAlt(u,m,w,M)}_calculateNearFarZIfNeeded(u,m,w){if(!this._helper.autoCalculateNearFarZ)return;const M=Math.min(this.elevation,this.minElevationForCurrentTile,this.getCameraAltitude()-100),R=u-M*this._helper._pixelPerMeter/Math.cos(m),N=M<0?R:u,H=Math.PI/2+this.pitchInRadians,j=o.ae(this.fov)*(Math.abs(Math.cos(o.ae(this.roll)))*this.height+Math.abs(Math.sin(o.ae(this.roll)))*this.width)/this.height*(.5+w.y/this.height),Y=Math.sin(j)*N/Math.sin(o.ah(Math.PI-H-j,.01,Math.PI-.01)),K=it(this),ie=Math.atan(K/this._helper.cameraToCenterDistance),re=o.ae(.75),ue=ie>re?2*ie*(.5+w.y/(2*K)):re,pe=Math.sin(ue)*N/Math.sin(o.ah(Math.PI-H-ue,.01,Math.PI-.01)),Se=Math.min(Y,pe);this._helper._farZ=1.01*(Math.cos(Math.PI/2-m)*Se+N),this._helper._nearZ=this._helper._height/50}_calcMatrices(){if(!this._helper._height)return;const u=this.centerOffset,m=Be(this.worldSize,this.center),w=m.x,M=m.y;this._helper._pixelPerMeter=o.aj(1,this.center.lat)*this.worldSize;const R=o.ae(Math.min(this.pitch,Ne)),N=Math.max(this._helper.cameraToCenterDistance/2,this._helper.cameraToCenterDistance+this._helper._elevation*this._helper._pixelPerMeter/Math.cos(R));let H;this._calculateNearFarZIfNeeded(N,R,u),H=new Float64Array(16),o.b4(H,this.fovInRadians,this._helper._width/this._helper._height,this._helper._nearZ,this._helper._farZ),this._invProjMatrix=new Float64Array(16),o.aq(this._invProjMatrix,H),H[8]=2*-u.x/this._helper._width,H[9]=2*u.y/this._helper._height,this._projectionMatrix=o.b5(H),o.N(H,H,[1,-1,1]),o.M(H,H,[0,0,-this._helper.cameraToCenterDistance]),o.b6(H,H,-this.rollInRadians),o.b7(H,H,this.pitchInRadians),o.b6(H,H,-this.bearingInRadians),o.M(H,H,[-w,-M,0]),this._mercatorMatrix=o.N([],H,[this.worldSize,this.worldSize,this.worldSize]),o.N(H,H,[1,1,this._helper._pixelPerMeter]),this._pixelMatrix=o.O(new Float64Array(16),this.clipSpaceToPixelsMatrix,H),o.M(H,H,[0,0,-this.elevation]),this._viewProjMatrix=H,this._invViewProjMatrix=o.aq([],H);const j=[0,0,-1,1];o.aw(j,j,this._invViewProjMatrix),this._cameraPosition=[j[0]/j[3],j[1]/j[3],j[2]/j[3]],this._fogMatrix=new Float64Array(16),o.b4(this._fogMatrix,this.fovInRadians,this.width/this.height,N,this._helper._farZ),this._fogMatrix[8]=2*-u.x/this.width,this._fogMatrix[9]=2*u.y/this.height,o.N(this._fogMatrix,this._fogMatrix,[1,-1,1]),o.M(this._fogMatrix,this._fogMatrix,[0,0,-this.cameraToCenterDistance]),o.b6(this._fogMatrix,this._fogMatrix,-this.rollInRadians),o.b7(this._fogMatrix,this._fogMatrix,this.pitchInRadians),o.b6(this._fogMatrix,this._fogMatrix,-this.bearingInRadians),o.M(this._fogMatrix,this._fogMatrix,[-w,-M,0]),o.N(this._fogMatrix,this._fogMatrix,[1,1,this._helper._pixelPerMeter]),o.M(this._fogMatrix,this._fogMatrix,[0,0,-this.elevation]),this._pixelMatrix3D=o.O(new Float64Array(16),this.clipSpaceToPixelsMatrix,H);const Y=this._helper._width%2/2,K=this._helper._height%2/2,ie=Math.cos(this.bearingInRadians),re=Math.sin(-this.bearingInRadians),ue=w-Math.round(w)+ie*Y+re*K,pe=M-Math.round(M)+ie*K+re*Y,Se=new Float64Array(H);if(o.M(Se,Se,[ue>.5?ue-1:ue,pe>.5?pe-1:pe,0]),this._alignedProjMatrix=Se,H=o.aq(new Float64Array(16),this._pixelMatrix),!H)throw new Error("failed to invert matrix");this._pixelMatrixInverse=H,this._clearMatrixCaches()}_clearMatrixCaches(){this._posMatrixCache.clear(),this._alignedPosMatrixCache.clear(),this._fogMatrixCacheF32.clear()}maxPitchScaleFactor(){if(!this._pixelMatrixInverse)return 1;const u=this.screenPointToMercatorCoordinate(new o.P(0,0)),m=[u.x*this.worldSize,u.y*this.worldSize,0,1];return o.aw(m,m,this._pixelMatrix)[3]/this._helper.cameraToCenterDistance}getCameraPoint(){return this._helper.getCameraPoint()}getCameraAltitude(){return this._helper.getCameraAltitude()}getCameraLngLat(){const u=o.aj(1,this.center.lat)*this.worldSize;return yt(this.center,this.elevation,this.pitch,this.bearing,this._helper.cameraToCenterDistance/u).toLngLat()}lngLatToCameraDepth(u,m){const w=o.a1.fromLngLat(u),M=[w.x*this.worldSize,w.y*this.worldSize,m,1];return o.aw(M,M,this._viewProjMatrix),M[2]/M[3]}getProjectionData(u){const{overscaledTileID:m,aligned:w,applyTerrainMatrix:M}=u,R=this._helper.getMercatorTileCoordinates(m),N=m?this.calculatePosMatrix(m,w,!0):null;let H;return H=m&&m.terrainRttPosMatrix32f&&M?m.terrainRttPosMatrix32f:N||o.b8(),{mainMatrix:H,tileMercatorCoords:R,clippingPlane:[0,0,0,0],projectionTransition:0,fallbackMatrix:H}}isLocationOccluded(u){return!1}getPixelScale(){return 1}getCircleRadiusCorrection(){return 1}getPitchedTextCorrection(u,m,w){return 1}transformLightDirection(u){return o.aT(u)}getRayDirectionFromPixel(u){throw new Error("Not implemented.")}projectTileCoordinates(u,m,w,M){const R=this.calculatePosMatrix(w);let N;M?(N=[u,m,M(u,m),1],o.aw(N,N,R)):(N=[u,m,0,1],mn(N,N,R));const H=N[3];return{point:new o.P(N[0]/H,N[1]/H),signedDistanceFromCamera:H,isOccluded:!1}}populateCache(u){for(const m of u)this.calculatePosMatrix(m)}getMatrixForModel(u,m){const w=o.a1.fromLngLat(u,m),M=w.meterInMercatorCoordinateUnits(),R=o.b9();return o.M(R,R,[w.x,w.y,w.z]),o.b6(R,R,Math.PI),o.b7(R,R,Math.PI/2),o.N(R,R,[-M,M,M]),R}getProjectionDataForCustomLayer(u=!0){const m=new o.Z(0,0,0,0,0),w=this.getProjectionData({overscaledTileID:m,applyGlobeMatrix:u}),M=Ke(m,this.worldSize);o.O(M,this._viewProjMatrix,M),w.tileMercatorCoords=[0,0,1,1];const R=[o.$,o.$,this.worldSize/this._helper.pixelsPerMeter],N=o.ba();return o.N(N,M,R),w.fallbackMatrix=N,w.mainMatrix=N,w}getFastPathSimpleProjectionMatrix(u){return this.calculatePosMatrix(u)}}function En(){o.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.")}function Qa(I){if(I.useSlerp)if(I.k<1){const u=o.bb(I.startEulerAngles.roll,I.startEulerAngles.pitch,I.startEulerAngles.bearing),m=o.bb(I.endEulerAngles.roll,I.endEulerAngles.pitch,I.endEulerAngles.bearing),w=new Float64Array(4);o.bc(w,u,m,I.k);const M=o.bd(w);I.tr.setRoll(M.roll),I.tr.setPitch(M.pitch),I.tr.setBearing(M.bearing)}else I.tr.setRoll(I.endEulerAngles.roll),I.tr.setPitch(I.endEulerAngles.pitch),I.tr.setBearing(I.endEulerAngles.bearing);else I.tr.setRoll(o.C.number(I.startEulerAngles.roll,I.endEulerAngles.roll,I.k)),I.tr.setPitch(o.C.number(I.startEulerAngles.pitch,I.endEulerAngles.pitch,I.k)),I.tr.setBearing(o.C.number(I.startEulerAngles.bearing,I.endEulerAngles.bearing,I.k))}function pa(I,u,m,w,M){const R=M.padding,N=Be(M.worldSize,m.getNorthWest()),H=Be(M.worldSize,m.getNorthEast()),j=Be(M.worldSize,m.getSouthEast()),Y=Be(M.worldSize,m.getSouthWest()),K=o.ae(-w),ie=N.rotate(K),re=H.rotate(K),ue=j.rotate(K),pe=Y.rotate(K),Se=new o.P(Math.max(ie.x,re.x,pe.x,ue.x),Math.max(ie.y,re.y,pe.y,ue.y)),Te=new o.P(Math.min(ie.x,re.x,pe.x,ue.x),Math.min(ie.y,re.y,pe.y,ue.y)),Ce=Se.sub(Te),Ie=(M.width-(R.left+R.right+u.left+u.right))/Ce.x,ke=(M.height-(R.top+R.bottom+u.top+u.bottom))/Ce.y;if(ke<0||Ie<0)return void En();const Re=Math.min(o.ak(M.scale*Math.min(Ie,ke)),I.maxZoom),ze=o.P.convert(I.offset),He=new o.P((u.left-u.right)/2,(u.top-u.bottom)/2).rotate(o.ae(w)),Le=ze.add(He).mult(M.scale/o.af(Re));return{center:We(M.worldSize,N.add(j).div(2).sub(Le)),zoom:Re,bearing:w}}class ns{get useGlobeControls(){return!1}handlePanInertia(u,m){const w=u.mag(),M=Math.abs(it(m));return{easingOffset:u.mult(Math.min(.75*M/w,1)),easingCenter:m.center}}handleMapControlsRollPitchBearingZoom(u,m){u.bearingDelta&&m.setBearing(m.bearing+u.bearingDelta),u.pitchDelta&&m.setPitch(m.pitch+u.pitchDelta),u.rollDelta&&m.setRoll(m.roll+u.rollDelta),u.zoomDelta&&m.setZoom(m.zoom+u.zoomDelta)}handleMapControlsPan(u,m,w){u.around.distSqr(m.centerPoint)<.01||m.setLocationAtPoint(w,u.around)}cameraForBoxAndBearing(u,m,w,M,R){return pa(u,m,w,M,R)}handleJumpToCenterZoom(u,m){u.zoom!==(m.zoom!==void 0?+m.zoom:u.zoom)&&u.setZoom(+m.zoom),m.center!==void 0&&u.setCenter(o.S.convert(m.center))}handleEaseTo(u,m){const w=u.zoom,M=u.padding,R={roll:u.roll,pitch:u.pitch,bearing:u.bearing},N={roll:m.roll===void 0?u.roll:m.roll,pitch:m.pitch===void 0?u.pitch:m.pitch,bearing:m.bearing===void 0?u.bearing:m.bearing},H=m.zoom!==void 0,j=!u.isPaddingEqual(m.padding);let Y=!1;const K=H?+m.zoom:u.zoom;let ie=u.centerPoint.add(m.offsetAsPoint);const re=u.screenPointToLocation(ie),{center:ue,zoom:pe}=u.getConstrained(o.S.convert(m.center||re),K??w);Cu(u,ue);const Se=Be(u.worldSize,re),Te=Be(u.worldSize,ue).sub(Se),Ce=o.af(pe-w);return Y=pe!==w,{easeFunc:Ie=>{if(Y&&u.setZoom(o.C.number(w,pe,Ie)),o.be(R,N)||Qa({startEulerAngles:R,endEulerAngles:N,tr:u,k:Ie,useSlerp:R.roll!=N.roll}),j&&(u.interpolatePadding(M,m.padding,Ie),ie=u.centerPoint.add(m.offsetAsPoint)),m.around)u.setLocationAtPoint(m.around,m.aroundPoint);else{const ke=o.af(u.zoom-w),Re=pe>w?Math.min(2,Ce):Math.max(.5,Ce),ze=Math.pow(Re,1-Ie),He=We(u.worldSize,Se.add(Te.mult(Ie*ze)).mult(ke));u.setLocationAtPoint(u.renderWorldCopies?He.wrap():He,ie)}},isZooming:Y,elevationCenter:ue}}handleFlyTo(u,m){const w=m.zoom!==void 0,M=u.zoom,R=u.getConstrained(o.S.convert(m.center||m.locationAtOffset),w?+m.zoom:M),N=R.center,H=R.zoom;Cu(u,N);const j=Be(u.worldSize,m.locationAtOffset),Y=Be(u.worldSize,N).sub(j),K=Y.mag(),ie=o.af(H-M);let re;if(m.minZoom!==void 0){const ue=Math.min(+m.minZoom,M,H),pe=u.getConstrained(N,ue).zoom;re=o.af(pe-M)}return{easeFunc:(ue,pe,Se,Te)=>{u.setZoom(ue===1?H:M+o.ak(pe));const Ce=ue===1?N:We(u.worldSize,j.add(Y.mult(Se)).mult(pe));u.setLocationAtPoint(u.renderWorldCopies?Ce.wrap():Ce,Te)},scaleOfZoom:ie,targetCenter:N,scaleOfMinZoom:re,pixelPathLength:K}}}class Di{constructor(u,m,w){this.blendFunction=u,this.blendColor=m,this.mask=w}}Di.Replace=[1,0],Di.disabled=new Di(Di.Replace,o.bf.transparent,[!1,!1,!1,!1]),Di.unblended=new Di(Di.Replace,o.bf.transparent,[!0,!0,!0,!0]),Di.alphaBlended=new Di([1,771],o.bf.transparent,[!0,!0,!0,!0]);const nn=2305;class Qr{constructor(u,m,w){this.enable=u,this.mode=m,this.frontFace=w}}Qr.disabled=new Qr(!1,1029,nn),Qr.backCCW=new Qr(!0,1029,nn),Qr.frontCCW=new Qr(!0,1028,nn);class Mr{constructor(u,m,w){this.func=u,this.mask=m,this.range=w}}Mr.ReadOnly=!1,Mr.ReadWrite=!0,Mr.disabled=new Mr(519,Mr.ReadOnly,[0,1]);const zl=7680;class Hr{constructor(u,m,w,M,R,N){this.test=u,this.ref=m,this.mask=w,this.fail=M,this.depthFail=R,this.pass=N}}Hr.disabled=new Hr({func:519,mask:0},0,0,zl,zl,zl);const Ma=new WeakMap;function Dn(I){var u;if(Ma.has(I))return Ma.get(I);{const m=(u=I.getParameter(I.VERSION))===null||u===void 0?void 0:u.startsWith("WebGL 2.0");return Ma.set(I,m),m}}class zh{get awaitingQuery(){return!!this._readbackQueue}constructor(u){this._readbackWaitFrames=4,this._measureWaitFrames=6,this._texWidth=1,this._texHeight=1,this._measuredError=0,this._updateCount=0,this._lastReadbackFrame=-1e3,this._readbackQueue=null,this._cachedRenderContext=u;const m=u.context,w=m.gl;this._texFormat=w.RGBA,this._texType=w.UNSIGNED_BYTE;const M=new o.aL;M.emplaceBack(-1,-1),M.emplaceBack(2,-1),M.emplaceBack(-1,2);const R=new o.aN;R.emplaceBack(0,1,2),this._fullscreenTriangle=new Au(m.createVertexBuffer(M,Ka.members),m.createIndexBuffer(R),o.aM.simpleSegment(0,0,M.length,R.length)),this._resultBuffer=new Uint8Array(4),m.activeTexture.set(w.TEXTURE1);const N=w.createTexture();w.bindTexture(w.TEXTURE_2D,N),w.texParameteri(w.TEXTURE_2D,w.TEXTURE_WRAP_S,w.CLAMP_TO_EDGE),w.texParameteri(w.TEXTURE_2D,w.TEXTURE_WRAP_T,w.CLAMP_TO_EDGE),w.texParameteri(w.TEXTURE_2D,w.TEXTURE_MIN_FILTER,w.NEAREST),w.texParameteri(w.TEXTURE_2D,w.TEXTURE_MAG_FILTER,w.NEAREST),w.texImage2D(w.TEXTURE_2D,0,this._texFormat,this._texWidth,this._texHeight,0,this._texFormat,this._texType,null),this._fbo=m.createFramebuffer(this._texWidth,this._texHeight,!1,!1),this._fbo.colorAttachment.set(N),Dn(w)&&(this._pbo=w.createBuffer(),w.bindBuffer(w.PIXEL_PACK_BUFFER,this._pbo),w.bufferData(w.PIXEL_PACK_BUFFER,4,w.STREAM_READ),w.bindBuffer(w.PIXEL_PACK_BUFFER,null))}destroy(){const u=this._cachedRenderContext.context.gl;this._fullscreenTriangle.destroy(),this._fbo.destroy(),u.deleteBuffer(this._pbo),this._fullscreenTriangle=null,this._fbo=null,this._pbo=null,this._resultBuffer=null}updateErrorLoop(u,m){const w=this._updateCount;return this._readbackQueue?w>=this._readbackQueue.frameNumberIssued+this._readbackWaitFrames&&this._tryReadback():w>=this._lastReadbackFrame+this._measureWaitFrames&&this._renderErrorTexture(u,m),this._updateCount++,this._measuredError}_bindFramebuffer(){const u=this._cachedRenderContext.context,m=u.gl;u.activeTexture.set(m.TEXTURE1),m.bindTexture(m.TEXTURE_2D,this._fbo.colorAttachment.get()),u.bindFramebuffer.set(this._fbo.framebuffer)}_renderErrorTexture(u,m){const w=this._cachedRenderContext.context,M=w.gl;if(this._bindFramebuffer(),w.viewport.set([0,0,this._texWidth,this._texHeight]),w.clear({color:o.bf.transparent}),this._cachedRenderContext.useProgram("projectionErrorMeasurement").draw(w,M.TRIANGLES,Mr.disabled,Hr.disabled,Di.unblended,Qr.disabled,((R,N)=>({u_input:R,u_output_expected:N}))(u,m),null,null,"$clipping",this._fullscreenTriangle.vertexBuffer,this._fullscreenTriangle.indexBuffer,this._fullscreenTriangle.segments),this._pbo&&Dn(M)){M.bindBuffer(M.PIXEL_PACK_BUFFER,this._pbo),M.readBuffer(M.COLOR_ATTACHMENT0),M.readPixels(0,0,this._texWidth,this._texHeight,this._texFormat,this._texType,0),M.bindBuffer(M.PIXEL_PACK_BUFFER,null);const R=M.fenceSync(M.SYNC_GPU_COMMANDS_COMPLETE,0);M.flush(),this._readbackQueue={frameNumberIssued:this._updateCount,sync:R}}else this._readbackQueue={frameNumberIssued:this._updateCount,sync:null}}_tryReadback(){const u=this._cachedRenderContext.context.gl;if(this._pbo&&this._readbackQueue&&Dn(u)){const m=u.clientWaitSync(this._readbackQueue.sync,0,0);if(m===u.WAIT_FAILED)return o.w("WebGL2 clientWaitSync failed."),this._readbackQueue=null,void(this._lastReadbackFrame=this._updateCount);if(m===u.TIMEOUT_EXPIRED)return;u.bindBuffer(u.PIXEL_PACK_BUFFER,this._pbo),u.getBufferSubData(u.PIXEL_PACK_BUFFER,0,this._resultBuffer,0,4),u.bindBuffer(u.PIXEL_PACK_BUFFER,null)}else this._bindFramebuffer(),u.readPixels(0,0,this._texWidth,this._texHeight,this._texFormat,this._texType,this._resultBuffer);this._readbackQueue=null,this._measuredError=zh._parseRGBA8float(this._resultBuffer),this._lastReadbackFrame=this._updateCount}static _parseRGBA8float(u){let m=0;return m+=u[0]/256,m+=u[1]/65536,m+=u[2]/16777216,u[3]<127&&(m=-m),m/128}}const Fl=o.$/128;function Qf(I,u){const m=I.granularity!==void 0?Math.max(I.granularity,1):1,w=m+(I.generateBorders?2:0),M=m+(I.extendToNorthPole||I.generateBorders?1:0)+(I.extendToSouthPole||I.generateBorders?1:0),R=w+1,N=M+1,H=I.generateBorders?-1:0,j=I.generateBorders||I.extendToNorthPole?-1:0,Y=m+(I.generateBorders?1:0),K=m+(I.generateBorders||I.extendToSouthPole?1:0),ie=R*N,re=w*M*6,ue=R*N>65536;if(ue&&u==="16bit")throw new Error("Granularity is too large and meshes would not fit inside 16 bit vertex indices.");const pe=ue||u==="32bit",Se=new Int16Array(2*ie);let Te=0;for(let ke=j;ke<=K;ke++)for(let Re=H;Re<=Y;Re++){let ze=Re/m*o.$;Re===-1&&(ze=-Fl),Re===m+1&&(ze=o.$+Fl);let He=ke/m*o.$;ke===-1&&(He=I.extendToNorthPole?o.bh:-Fl),ke===m+1&&(He=I.extendToSouthPole?o.bi:o.$+Fl),Se[Te++]=ze,Se[Te++]=He}const Ce=pe?new Uint32Array(re):new Uint16Array(re);let Ie=0;for(let ke=0;ke<M;ke++)for(let Re=0;Re<w;Re++){const ze=Re+1+ke*R,He=Re+(ke+1)*R,Le=Re+1+(ke+1)*R;Ce[Ie++]=Re+ke*R,Ce[Ie++]=He,Ce[Ie++]=ze,Ce[Ie++]=ze,Ce[Ie++]=He,Ce[Ie++]=Le}return{vertices:Se.buffer.slice(0),indices:Ce.buffer.slice(0),uses32bitIndices:pe}}const Mu=new o.aK({fill:new o.bj(128,2),line:new o.bj(512,0),tile:new o.bj(128,32),stencil:new o.bj(128,1),circle:3});class kc{constructor(){this._tileMeshCache={},this._errorCorrectionUsable=0,this._errorMeasurementLastValue=0,this._errorCorrectionPreviousValue=0,this._errorMeasurementLastChangeTime=-1e3}get name(){return"vertical-perspective"}get transitionState(){return 1}get useSubdivision(){return!0}get shaderVariantName(){return"globe"}get shaderDefine(){return"#define GLOBE"}get shaderPreludeCode(){return Ba.projectionGlobe}get vertexShaderPreludeCode(){return Ba.projectionMercator.vertexSource}get subdivisionGranularity(){return Mu}get useGlobeControls(){return!0}get latitudeErrorCorrectionRadians(){return this._errorCorrectionUsable}destroy(){this._errorMeasurement&&this._errorMeasurement.destroy()}updateGPUdependent(u){this._errorMeasurement||(this._errorMeasurement=new zh(u));const m=o.U(this._errorQueryLatitudeDegrees),w=2*Math.atan(Math.exp(Math.PI-m*Math.PI*2))-.5*Math.PI,M=this._errorMeasurement.updateErrorLoop(m,w),R=y.now();M!==this._errorMeasurementLastValue&&(this._errorCorrectionPreviousValue=this._errorCorrectionUsable,this._errorMeasurementLastValue=M,this._errorMeasurementLastChangeTime=R);const N=Math.min(Math.max((R-this._errorMeasurementLastChangeTime)/1e3/.5,0),1);this._errorCorrectionUsable=o.bk(this._errorCorrectionPreviousValue,-this._errorMeasurementLastValue,o.bl(N))}_getMeshKey(u){return`${u.granularity.toString(36)}_${u.generateBorders?"b":""}${u.extendToNorthPole?"n":""}${u.extendToSouthPole?"s":""}`}getMeshFromTileID(u,m,w,M,R){const N=(R==="stencil"?Mu.stencil:Mu.tile).getGranularityForZoomLevel(m.z);return this._getMesh(u,{granularity:N,generateBorders:w,extendToNorthPole:m.y===0&&M,extendToSouthPole:m.y===(1<<m.z)-1&&M})}_getMesh(u,m){const w=this._getMeshKey(m);if(w in this._tileMeshCache)return this._tileMeshCache[w];const M=(function(R,N){const H=Qf(N,"16bit"),j=o.aL.deserialize({arrayBuffer:H.vertices,length:H.vertices.byteLength/2/2}),Y=o.aN.deserialize({arrayBuffer:H.indices,length:H.indices.byteLength/2/3});return new Au(R.createVertexBuffer(j,Ka.members),R.createIndexBuffer(Y),o.aM.simpleSegment(0,0,j.length,Y.length))})(u,m);return this._tileMeshCache[w]=M,M}recalculate(u){}hasTransition(){const u=y.now();let m=!1;return m=m||(u-this._errorMeasurementLastChangeTime)/1e3<.7,m=m||this._errorMeasurement&&this._errorMeasurement.awaitingQuery,m}setErrorQueryLatitudeDegrees(u){this._errorQueryLatitudeDegrees=u}}const Lc=new o.r({type:new o.D(o.v.projection.type)});class Oc extends o.E{constructor(u){super(),this._transitionable=new o.t(Lc,void 0),this.setProjection(u),this._transitioning=this._transitionable.untransitioned(),this.recalculate(new o.F(0)),this._mercatorProjection=new Lo,this._verticalPerspectiveProjection=new kc}get transitionState(){const u=this.properties.get("type");if(typeof u=="string"&&u==="mercator")return 0;if(typeof u=="string"&&u==="vertical-perspective")return 1;if(u instanceof o.bm){if(u.from==="vertical-perspective"&&u.to==="mercator")return 1-u.transition;if(u.from==="mercator"&&u.to==="vertical-perspective")return u.transition}return 1}get useGlobeRendering(){return this.transitionState>0}get latitudeErrorCorrectionRadians(){return this._verticalPerspectiveProjection.latitudeErrorCorrectionRadians}get currentProjection(){return this.useGlobeRendering?this._verticalPerspectiveProjection:this._mercatorProjection}get name(){return"globe"}get useSubdivision(){return this.currentProjection.useSubdivision}get shaderVariantName(){return this.currentProjection.shaderVariantName}get shaderDefine(){return this.currentProjection.shaderDefine}get shaderPreludeCode(){return this.currentProjection.shaderPreludeCode}get vertexShaderPreludeCode(){return this.currentProjection.vertexShaderPreludeCode}get subdivisionGranularity(){return this.currentProjection.subdivisionGranularity}get useGlobeControls(){return this.transitionState>0}destroy(){this._mercatorProjection.destroy(),this._verticalPerspectiveProjection.destroy()}updateGPUdependent(u){this._mercatorProjection.updateGPUdependent(u),this._verticalPerspectiveProjection.updateGPUdependent(u)}getMeshFromTileID(u,m,w,M,R){return this.currentProjection.getMeshFromTileID(u,m,w,M,R)}setProjection(u){this._transitionable.setValue("type",u?.type||"mercator")}updateTransitions(u){this._transitioning=this._transitionable.transitioned(u,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()||this.currentProjection.hasTransition()}recalculate(u){this.properties=this._transitioning.possiblyEvaluate(u)}setErrorQueryLatitudeDegrees(u){this._verticalPerspectiveProjection.setErrorQueryLatitudeDegrees(u),this._mercatorProjection.setErrorQueryLatitudeDegrees(u)}}function Fh(I){const u=Nc(I.worldSize,I.center.lat);return 2*Math.PI*u}function gl(I,u,m,w,M){const R=1/(1<<M),N=u/o.$*R+w*R,H=o.bo((I/o.$*R+m*R)*Math.PI*2+Math.PI,2*Math.PI),j=2*Math.atan(Math.exp(Math.PI-N*Math.PI*2))-.5*Math.PI,Y=Math.cos(j),K=new Float64Array(3);return K[0]=Math.sin(H)*Y,K[1]=Math.sin(j),K[2]=Math.cos(H)*Y,K}function ga(I){return(function(u,m){const w=Math.cos(m),M=new Float64Array(3);return M[0]=Math.sin(u)*w,M[1]=Math.sin(m),M[2]=Math.cos(u)*w,M})(I.lng*Math.PI/180,I.lat*Math.PI/180)}function Nc(I,u){return I/(2*Math.PI)/Math.cos(u*Math.PI/180)}function Bc(I){const u=Math.asin(I[1])/Math.PI*180,m=Math.sqrt(I[0]*I[0]+I[2]*I[2]);if(m>1e-6){const w=I[0]/m,M=Math.acos(I[2]/m),R=(w>0?M:-M)/Math.PI*180;return new o.S(o.aO(R,-180,180),u)}return new o.S(0,u)}function Eu(I){return Math.cos(I*Math.PI/180)}function va(I,u){const m=Eu(I),w=Eu(u);return o.ak(w/m)}function _p(I,u){const m=I.rotate(u.bearingInRadians),w=u.zoom+va(u.center.lat,0),M=o.bk(1/Eu(u.center.lat),1/Eu(Math.min(Math.abs(u.center.lat),60)),o.bn(w,7,3,0,1)),R=360/Fh({worldSize:u.worldSize,center:{lat:u.center.lat}});return new o.S(u.center.lng-m.x*R*M,o.ah(u.center.lat+m.y*R,-o.ai,o.ai))}function bp(I){const u=.5*I,m=Math.sin(u),w=Math.cos(u);return Math.log(m+w)-Math.log(w-m)}function zy(I,u,m,w){const M=I.lat+m*w;if(Math.abs(m)>1){const R=(Math.sign(I.lat+m)!==Math.sign(I.lat)?-Math.abs(I.lat):Math.abs(I.lat))*Math.PI/180,N=Math.abs(I.lat+m)*Math.PI/180,H=bp(R+w*(N-R)),j=bp(R),Y=bp(N);return new o.S(I.lng+u*((H-j)/(Y-j)),M)}return new o.S(I.lng+u*w,M)}class Fy{constructor(u){this._cachePrevious=new Map,this._cache=new Map,this._hadAnyChanges=!1,this._boundingVolumeFactory=u}swapBuffers(){if(!this._hadAnyChanges)return;const u=this._cachePrevious;this._cachePrevious=this._cache,this._cache=u,this._cache.clear(),this._hadAnyChanges=!1}getTileBoundingVolume(u,m,w,M){const R=`${u.z}_${u.x}_${u.y}_${M?.terrain?"t":""}`,N=this._cache.get(R);if(N)return N;const H=this._cachePrevious.get(R);if(H)return this._cache.set(R,H),H;const j=this._boundingVolumeFactory(u,m,w,M);return this._cache.set(R,j),this._hadAnyChanges=!0,j}}class na{constructor(u,m,w,M){this.min=w,this.max=M,this.points=u,this.planes=m}static fromAabb(u,m){const w=[];for(let M=0;M<8;M++)w.push([1&~M?u[0]:m[0],(M>>1&1)==1?m[1]:u[1],(M>>2&1)==1?m[2]:u[2]]);return new na(w,[[-1,0,0,m[0]],[1,0,0,-u[0]],[0,-1,0,m[1]],[0,1,0,-u[1]],[0,0,-1,m[2]],[0,0,1,-u[2]]],u,m)}static fromCenterSizeAngles(u,m,w){const M=o.br([],w[0],w[1],w[2]),R=o.bs([],[m[0],0,0],M),N=o.bs([],[0,m[1],0],M),H=o.bs([],[0,0,m[2]],M),j=[...u],Y=[...u];for(let ie=0;ie<8;ie++)for(let re=0;re<3;re++){const ue=u[re]+R[re]*(1&~ie?-1:1)+N[re]*((ie>>1&1)==1?1:-1)+H[re]*((ie>>2&1)==1?1:-1);j[re]=Math.min(j[re],ue),Y[re]=Math.max(Y[re],ue)}const K=[];for(let ie=0;ie<8;ie++){const re=[...u];o.aS(re,re,o.aR([],R,1&~ie?-1:1)),o.aS(re,re,o.aR([],N,(ie>>1&1)==1?1:-1)),o.aS(re,re,o.aR([],H,(ie>>2&1)==1?1:-1)),K.push(re)}return new na(K,[[...R,-o.aX(R,K[0])],[...N,-o.aX(N,K[0])],[...H,-o.aX(H,K[0])],[-R[0],-R[1],-R[2],-o.aX(R,K[7])],[-N[0],-N[1],-N[2],-o.aX(N,K[7])],[-H[0],-H[1],-H[2],-o.aX(H,K[7])]],j,Y)}intersectsFrustum(u){let m=!0;const w=this.points.length,M=this.planes.length,R=u.planes.length,N=u.points.length;for(let H=0;H<R;H++){const j=u.planes[H];let Y=0;for(let K=0;K<w;K++){const ie=this.points[K];j[0]*ie[0]+j[1]*ie[1]+j[2]*ie[2]+j[3]>=0&&Y++}if(Y===0)return 0;Y<w&&(m=!1)}if(m)return 2;for(let H=0;H<M;H++){const j=this.planes[H];let Y=0;for(let K=0;K<N;K++){const ie=u.points[K];j[0]*ie[0]+j[1]*ie[1]+j[2]*ie[2]+j[3]>=0&&Y++}if(Y===0)return 0}return 1}intersectsPlane(u){const m=this.points.length;let w=0;for(let M=0;M<m;M++){const R=this.points[M];u[0]*R[0]+u[1]*R[1]+u[2]*R[2]+u[3]>=0&&w++}return w===m?2:w===0?0:1}}function Vh(I,u,m){const w=I-u;return w<0?-w:Math.max(0,w-m)}function as(I,u,m,w,M){const R=I-m;let N;return N=R<0?Math.min(-R,1+R-M):R>1?Math.min(Math.max(R-M,0),1-R):0,Math.max(N,Vh(u,w,M))}class xp{constructor(){this._boundingVolumeCache=new Fy(this._computeTileBoundingVolume)}prepareNextFrame(){this._boundingVolumeCache.swapBuffers()}distanceToTile2d(u,m,w,M){const R=1<<w.z,N=1/R,H=w.x/R,j=w.y/R;let Y=2;return Y=Math.min(Y,as(u,m,H,j,N)),Y=Math.min(Y,as(u,m,H+.5,-j-N,N)),Y=Math.min(Y,as(u,m,H+.5,2-j-N,N)),Y}getWrap(u,m,w){const M=1<<m.z,R=1/M,N=m.x/M,H=Vh(u.x,N,R),j=Vh(u.x,N-1,R),Y=Vh(u.x,N+1,R),K=Math.min(H,j,Y);return K===Y?1:K===j?-1:0}allowVariableZoom(u,m){return Qe(u,m)>4}allowWorldCopies(){return!1}getTileBoundingVolume(u,m,w,M){return this._boundingVolumeCache.getTileBoundingVolume(u,m,w,M)}_computeTileBoundingVolume(u,m,w,M){var R,N;let H=0,j=0;if(M?.terrain){const Y=new o.Z(u.z,m,u.z,u.x,u.y),K=M.terrain.getMinMaxElevation(Y);H=(R=K.minElevation)!==null&&R!==void 0?R:Math.min(0,w),j=(N=K.maxElevation)!==null&&N!==void 0?N:Math.max(0,w)}if(H/=o.bu,j/=o.bu,H+=1,j+=1,u.z<=0)return na.fromAabb([-j,-j,-j],[j,j,j]);if(u.z===1)return na.fromAabb([u.x===0?-j:0,u.y===0?0:-j,-j],[u.x===0?0:j,u.y===0?j:0,j]);{const Y=[gl(0,0,u.x,u.y,u.z),gl(o.$,0,u.x,u.y,u.z),gl(o.$,o.$,u.x,u.y,u.z),gl(0,o.$,u.x,u.y,u.z)],K=[];for(const st of Y)K.push(o.aR([],st,j));if(j!==H)for(const st of Y)K.push(o.aR([],st,H));u.y===0&&K.push([0,1,0]),u.y===(1<<u.z)-1&&K.push([0,-1,0]);const ie=[1,1,1],re=[-1,-1,-1];for(const st of K)for(let lt=0;lt<3;lt++)ie[lt]=Math.min(ie[lt],st[lt]),re[lt]=Math.max(re[lt],st[lt]);const ue=gl(o.$/2,o.$/2,u.x,u.y,u.z),pe=o.aW([],[0,1,0],ue);o.aV(pe,pe);const Se=o.aW([],ue,pe);o.aV(Se,Se);const Te=o.aW([],Y[2],Y[1]);o.aV(Te,Te);const Ce=o.aW([],Y[0],Y[3]);o.aV(Ce,Ce),K.push(o.aR([],ue,j)),u.y>=(1<<u.z)/2&&K.push(o.aR([],gl(o.$/2,0,u.x,u.y,u.z),j)),u.y<(1<<u.z)/2&&K.push(o.aR([],gl(o.$/2,o.$,u.x,u.y,u.z),j));const Ie=Jf(ue,K),ke=Jf(Se,K),Re=[-ue[0],-ue[1],-ue[2],Ie.max],ze=[ue[0],ue[1],ue[2],-Ie.min],He=[-Se[0],-Se[1],-Se[2],ke.max],Le=[Se[0],Se[1],Se[2],-ke.min],Xe=[...Te,0],ht=[...Ce,0],at=[];return u.y===0?at.push(o.bt(ht,Xe,Re),o.bt(ht,Xe,ze)):at.push(o.bt(He,Xe,Re),o.bt(He,Xe,ze),o.bt(He,ht,Re),o.bt(He,ht,ze)),u.y===(1<<u.z)-1?at.push(o.bt(ht,Xe,Re),o.bt(ht,Xe,ze)):at.push(o.bt(Le,Xe,Re),o.bt(Le,Xe,ze),o.bt(Le,ht,Re),o.bt(Le,ht,ze)),new na(at,[Re,ze,He,Le,Xe,ht],ie,re)}}}function Jf(I,u){let m=1/0,w=-1/0;for(const M of u){const R=o.aX(I,M);m=Math.min(m,R),w=Math.max(w,R)}return{min:m,max:w}}class ed{get pixelsToClipSpaceMatrix(){return this._helper.pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._helper.clipSpaceToPixelsMatrix}get pixelsToGLUnits(){return this._helper.pixelsToGLUnits}get centerOffset(){return this._helper.centerOffset}get size(){return this._helper.size}get rotationMatrix(){return this._helper.rotationMatrix}get centerPoint(){return this._helper.centerPoint}get pixelsPerMeter(){return this._helper.pixelsPerMeter}setMinZoom(u){this._helper.setMinZoom(u)}setMaxZoom(u){this._helper.setMaxZoom(u)}setMinPitch(u){this._helper.setMinPitch(u)}setMaxPitch(u){this._helper.setMaxPitch(u)}setRenderWorldCopies(u){this._helper.setRenderWorldCopies(u)}setBearing(u){this._helper.setBearing(u)}setPitch(u){this._helper.setPitch(u)}setRoll(u){this._helper.setRoll(u)}setFov(u){this._helper.setFov(u)}setZoom(u){this._helper.setZoom(u)}setCenter(u){this._helper.setCenter(u)}setElevation(u){this._helper.setElevation(u)}setMinElevationForCurrentTile(u){this._helper.setMinElevationForCurrentTile(u)}setPadding(u){this._helper.setPadding(u)}interpolatePadding(u,m,w){return this._helper.interpolatePadding(u,m,w)}isPaddingEqual(u){return this._helper.isPaddingEqual(u)}resize(u,m){this._helper.resize(u,m)}getMaxBounds(){return this._helper.getMaxBounds()}setMaxBounds(u){this._helper.setMaxBounds(u)}overrideNearFarZ(u,m){this._helper.overrideNearFarZ(u,m)}clearNearFarZOverride(){this._helper.clearNearFarZOverride()}getCameraQueryGeometry(u){return this._helper.getCameraQueryGeometry(this.getCameraPoint(),u)}get tileSize(){return this._helper.tileSize}get tileZoom(){return this._helper.tileZoom}get scale(){return this._helper.scale}get worldSize(){return this._helper.worldSize}get width(){return this._helper.width}get height(){return this._helper.height}get lngRange(){return this._helper.lngRange}get latRange(){return this._helper.latRange}get minZoom(){return this._helper.minZoom}get maxZoom(){return this._helper.maxZoom}get zoom(){return this._helper.zoom}get center(){return this._helper.center}get minPitch(){return this._helper.minPitch}get maxPitch(){return this._helper.maxPitch}get pitch(){return this._helper.pitch}get pitchInRadians(){return this._helper.pitchInRadians}get roll(){return this._helper.roll}get rollInRadians(){return this._helper.rollInRadians}get bearing(){return this._helper.bearing}get bearingInRadians(){return this._helper.bearingInRadians}get fov(){return this._helper.fov}get fovInRadians(){return this._helper.fovInRadians}get elevation(){return this._helper.elevation}get minElevationForCurrentTile(){return this._helper.minElevationForCurrentTile}get padding(){return this._helper.padding}get unmodified(){return this._helper.unmodified}get renderWorldCopies(){return this._helper.renderWorldCopies}get nearZ(){return this._helper.nearZ}get farZ(){return this._helper.farZ}get autoCalculateNearFarZ(){return this._helper.autoCalculateNearFarZ}setTransitionState(u){}constructor(){this._cachedClippingPlane=o.bv(),this._projectionMatrix=o.b9(),this._globeViewProjMatrix32f=o.b8(),this._globeViewProjMatrixNoCorrection=o.b9(),this._globeViewProjMatrixNoCorrectionInverted=o.b9(),this._globeProjMatrixInverted=o.b9(),this._cameraPosition=o.bp(),this._globeLatitudeErrorCorrectionRadians=0,this._helper=new Rn({calcMatrices:()=>{this._calcMatrices()},getConstrained:(u,m)=>this.getConstrained(u,m)}),this._coveringTilesDetailsProvider=new xp}clone(){const u=new ed;return u.apply(this),u}apply(u,m){this._globeLatitudeErrorCorrectionRadians=m||0,this._helper.apply(u)}get projectionMatrix(){return this._projectionMatrix}get modelViewProjectionMatrix(){return this._globeViewProjMatrixNoCorrection}get inverseProjectionMatrix(){return this._globeProjMatrixInverted}get cameraPosition(){const u=o.bp();return u[0]=this._cameraPosition[0],u[1]=this._cameraPosition[1],u[2]=this._cameraPosition[2],u}get cameraToCenterDistance(){return this._helper.cameraToCenterDistance}getProjectionData(u){const{overscaledTileID:m,applyGlobeMatrix:w}=u,M=this._helper.getMercatorTileCoordinates(m);return{mainMatrix:this._globeViewProjMatrix32f,tileMercatorCoords:M,clippingPlane:this._cachedClippingPlane,projectionTransition:w?1:0,fallbackMatrix:this._globeViewProjMatrix32f}}_computeClippingPlane(u){const m=this.pitchInRadians,w=this.cameraToCenterDistance/u,M=Math.sin(m)*w,R=Math.cos(m)*w+1,N=1/Math.sqrt(M*M+R*R)*1;let H=-M,j=R;const Y=Math.sqrt(H*H+j*j);H/=Y,j/=Y;const K=[0,H,j];o.bw(K,K,[0,0,0],-this.bearingInRadians),o.bx(K,K,[0,0,0],-1*this.center.lat*Math.PI/180),o.by(K,K,[0,0,0],this.center.lng*Math.PI/180);const ie=1/o.aZ(K);return o.aR(K,K,ie),[...K,-N*ie]}isLocationOccluded(u){return!this.isSurfacePointVisible(ga(u))}transformLightDirection(u){const m=this._helper._center.lng*Math.PI/180,w=this._helper._center.lat*Math.PI/180,M=Math.cos(w),R=[Math.sin(m)*M,Math.sin(w),Math.cos(m)*M],N=[R[2],0,-R[0]],H=[0,0,0];o.aW(H,N,R),o.aV(N,N),o.aV(H,H);const j=[0,0,0];return o.aV(j,[N[0]*u[0]+H[0]*u[1]+R[0]*u[2],N[1]*u[0]+H[1]*u[1]+R[1]*u[2],N[2]*u[0]+H[2]*u[1]+R[2]*u[2]]),j}getPixelScale(){return 1/Math.cos(this._helper._center.lat*Math.PI/180)}getCircleRadiusCorrection(){return Math.cos(this._helper._center.lat*Math.PI/180)}getPitchedTextCorrection(u,m,w){const M=(function(H,j,Y){const K=1/(1<<Y.z);return new o.a1(H/o.$*K+Y.x*K,j/o.$*K+Y.y*K)})(u,m,w.canonical),R=(N=M.y,[o.bo(M.x*Math.PI*2+Math.PI,2*Math.PI),2*Math.atan(Math.exp(Math.PI-N*Math.PI*2))-.5*Math.PI]);var N;return this.getCircleRadiusCorrection()/Math.cos(R[1])}projectTileCoordinates(u,m,w,M){const R=w.canonical,N=gl(u,m,R.x,R.y,R.z),H=1+(M?M(u,m):0)/o.bu,j=[N[0]*H,N[1]*H,N[2]*H,1];o.aw(j,j,this._globeViewProjMatrixNoCorrection);const Y=this._cachedClippingPlane,K=Y[0]*N[0]+Y[1]*N[1]+Y[2]*N[2]+Y[3]<0;return{point:new o.P(j[0]/j[3],j[1]/j[3]),signedDistanceFromCamera:j[3],isOccluded:K}}_calcMatrices(){if(!this._helper._width||!this._helper._height)return;const u=Nc(this.worldSize,this.center.lat),m=o.ba(),w=o.ba();this._helper.autoCalculateNearFarZ&&(this._helper._nearZ=.5,this._helper._farZ=this.cameraToCenterDistance+2*u),o.b4(m,this.fovInRadians,this.width/this.height,this._helper._nearZ,this._helper._farZ);const M=this.centerOffset;m[8]=2*-M.x/this._helper._width,m[9]=2*M.y/this._helper._height,this._projectionMatrix=o.b5(m),this._globeProjMatrixInverted=o.ba(),o.aq(this._globeProjMatrixInverted,m),o.M(m,m,[0,0,-this.cameraToCenterDistance]),o.b6(m,m,this.rollInRadians),o.b7(m,m,-this.pitchInRadians),o.b6(m,m,this.bearingInRadians),o.M(m,m,[0,0,-u]);const R=o.bp();R[0]=u,R[1]=u,R[2]=u,o.b7(w,m,this.center.lat*Math.PI/180),o.bz(w,w,-this.center.lng*Math.PI/180),o.N(w,w,R),this._globeViewProjMatrixNoCorrection=w,o.b7(m,m,this.center.lat*Math.PI/180-this._globeLatitudeErrorCorrectionRadians),o.bz(m,m,-this.center.lng*Math.PI/180),o.N(m,m,R),this._globeViewProjMatrix32f=new Float32Array(m),this._globeViewProjMatrixNoCorrectionInverted=o.ba(),o.aq(this._globeViewProjMatrixNoCorrectionInverted,w);const N=o.bp();this._cameraPosition=o.bp(),this._cameraPosition[2]=this.cameraToCenterDistance/u,o.bw(this._cameraPosition,this._cameraPosition,N,-this.rollInRadians),o.bx(this._cameraPosition,this._cameraPosition,N,this.pitchInRadians),o.bw(this._cameraPosition,this._cameraPosition,N,-this.bearingInRadians),o.aS(this._cameraPosition,this._cameraPosition,[0,0,1]),o.bx(this._cameraPosition,this._cameraPosition,N,-this.center.lat*Math.PI/180),o.by(this._cameraPosition,this._cameraPosition,N,this.center.lng*Math.PI/180),this._cachedClippingPlane=this._computeClippingPlane(u);const H=o.b5(this._globeViewProjMatrixNoCorrectionInverted);o.N(H,H,[1,1,-1]),this._cachedFrustum=qi.fromInvProjectionMatrix(H,1,0,this._cachedClippingPlane,!0)}calculateFogMatrix(u){o.w("calculateFogMatrix is not supported on globe projection.");const m=o.ba();return o.ag(m),m}getVisibleUnwrappedCoordinates(u){return[new o.b2(0,u)]}getCameraFrustum(){return this._cachedFrustum}getClippingPlane(){return this._cachedClippingPlane}getCoveringTilesDetailsProvider(){return this._coveringTilesDetailsProvider}recalculateZoomAndCenter(u){u&&o.w("terrain is not fully supported on vertical perspective projection."),this._helper.recalculateZoomAndCenter(0)}maxPitchScaleFactor(){return 1}getCameraPoint(){return this._helper.getCameraPoint()}getCameraAltitude(){return this._helper.getCameraAltitude()}getCameraLngLat(){return this._helper.getCameraLngLat()}lngLatToCameraDepth(u,m){if(!this._globeViewProjMatrixNoCorrection)return 1;const w=ga(u);o.aR(w,w,1+m/o.bu);const M=o.bv();return o.aw(M,[w[0],w[1],w[2],1],this._globeViewProjMatrixNoCorrection),M[2]/M[3]}populateCache(u){}getBounds(){const u=.5*this.width,m=.5*this.height,w=[new o.P(0,0),new o.P(u,0),new o.P(this.width,0),new o.P(this.width,m),new o.P(this.width,this.height),new o.P(u,this.height),new o.P(0,this.height),new o.P(0,m)],M=[];for(const ie of w)M.push(this.unprojectScreenPoint(ie));let R=0,N=0,H=0,j=0;const Y=this.center;for(const ie of M){const re=o.bA(Y.lng,ie.lng),ue=o.bA(Y.lat,ie.lat);re<N&&(N=re),re>R&&(R=re),ue<j&&(j=ue),ue>H&&(H=ue)}const K=[Y.lng+N,Y.lat+j,Y.lng+R,Y.lat+H];return this.isSurfacePointOnScreen([0,1,0])&&(K[3]=90,K[0]=-180,K[2]=180),this.isSurfacePointOnScreen([0,-1,0])&&(K[1]=-90,K[0]=-180,K[2]=180),new Tr(K)}getConstrained(u,m){const w=o.ah(u.lat,-o.ai,o.ai),M=o.ah(+m,this.minZoom+va(0,w),this.maxZoom);return{center:new o.S(u.lng,w),zoom:M}}calculateCenterFromCameraLngLatAlt(u,m,w,M){return this._helper.calculateCenterFromCameraLngLatAlt(u,m,w,M)}setLocationAtPoint(u,m){const w=ga(this.unprojectScreenPoint(m)),M=ga(u),R=o.bp();o.bB(R);const N=o.bp();o.by(N,w,R,-this.center.lng*Math.PI/180),o.bx(N,N,R,this.center.lat*Math.PI/180);const H=M[0]*M[0]+M[2]*M[2],j=N[0]*N[0];if(H<j)return;const Y=Math.sqrt(H-j),K=-Y,ie=o.bC(M[0],M[2],N[0],Y),re=o.bC(M[0],M[2],N[0],K),ue=o.bp();o.by(ue,M,R,-ie);const pe=o.bC(ue[1],ue[2],N[1],N[2]),Se=o.bp();o.by(Se,M,R,-re);const Te=o.bC(Se[1],Se[2],N[1],N[2]),Ce=.5*Math.PI,Ie=pe>=-Ce&&pe<=Ce,ke=Te>=-Ce&&Te<=Ce;let Re,ze;if(Ie&&ke){const ht=this.center.lng*Math.PI/180,at=this.center.lat*Math.PI/180;o.bD(ie,ht)+o.bD(pe,at)<o.bD(re,ht)+o.bD(Te,at)?(Re=ie,ze=pe):(Re=re,ze=Te)}else if(Ie)Re=ie,ze=pe;else{if(!ke)return;Re=re,ze=Te}const He=Re/Math.PI*180,Le=ze/Math.PI*180,Xe=this.center.lat;this.setCenter(new o.S(He,o.ah(Le,-90,90))),this.setZoom(this.zoom+va(Xe,this.center.lat))}locationToScreenPoint(u,m){const w=ga(u);if(m){const M=m.getElevationForLngLatZoom(u,this._helper._tileZoom);o.aR(w,w,1+M/o.bu)}return this._projectSurfacePointToScreen(w)}_projectSurfacePointToScreen(u){const m=o.bv();return o.aw(m,[...u,1],this._globeViewProjMatrixNoCorrection),m[0]/=m[3],m[1]/=m[3],new o.P((.5*m[0]+.5)*this.width,(.5*-m[1]+.5)*this.height)}screenPointToMercatorCoordinate(u,m){if(m){const w=m.pointCoordinate(u);if(w)return w}return o.a1.fromLngLat(this.unprojectScreenPoint(u))}screenPointToLocation(u,m){var w;return(w=this.screenPointToMercatorCoordinate(u,m))===null||w===void 0?void 0:w.toLngLat()}isPointOnMapSurface(u,m){const w=this._cameraPosition,M=this.getRayDirectionFromPixel(u);return!!this.rayPlanetIntersection(w,M)}getRayDirectionFromPixel(u){const m=o.bv();m[0]=u.x/this.width*2-1,m[1]=-1*(u.y/this.height*2-1),m[2]=1,m[3]=1,o.aw(m,m,this._globeViewProjMatrixNoCorrectionInverted),m[0]/=m[3],m[1]/=m[3],m[2]/=m[3];const w=o.bp();w[0]=m[0]-this._cameraPosition[0],w[1]=m[1]-this._cameraPosition[1],w[2]=m[2]-this._cameraPosition[2];const M=o.bp();return o.aV(M,w),M}isSurfacePointVisible(u){const m=this._cachedClippingPlane;return m[0]*u[0]+m[1]*u[1]+m[2]*u[2]+m[3]>=0}isSurfacePointOnScreen(u){if(!this.isSurfacePointVisible(u))return!1;const m=o.bv();return o.aw(m,[...u,1],this._globeViewProjMatrixNoCorrection),m[0]/=m[3],m[1]/=m[3],m[2]/=m[3],m[0]>-1&&m[0]<1&&m[1]>-1&&m[1]<1&&m[2]>-1&&m[2]<1}rayPlanetIntersection(u,m){const w=o.aX(u,m),M=o.bp(),R=o.bp();o.aR(R,m,w),o.aU(M,u,R);const N=1-o.aX(M,M);if(N<0)return null;const H=o.aX(u,u)-1,j=-w+(w<0?1:-1)*Math.sqrt(N),Y=H/j,K=j;return{tMin:Math.min(Y,K),tMax:Math.max(Y,K)}}unprojectScreenPoint(u){const m=this._cameraPosition,w=this.getRayDirectionFromPixel(u),M=this.rayPlanetIntersection(m,w);if(M){const K=o.bp();o.aS(K,m,[w[0]*M.tMin,w[1]*M.tMin,w[2]*M.tMin]);const ie=o.bp();return o.aV(ie,K),Bc(ie)}const R=this._cachedClippingPlane,N=R[0]*w[0]+R[1]*w[1]+R[2]*w[2],H=-o.b1(R,m)/N,j=o.bp();if(H>0)o.aS(j,m,[w[0]*H,w[1]*H,w[2]*H]);else{const K=o.bp();o.aS(K,m,[2*w[0],2*w[1],2*w[2]]);const ie=o.b1(this._cachedClippingPlane,K);o.aU(j,K,[this._cachedClippingPlane[0]*ie,this._cachedClippingPlane[1]*ie,this._cachedClippingPlane[2]*ie])}const Y=(function(K){const ie=o.bp();return ie[0]=K[0]*-K[3],ie[1]=K[1]*-K[3],ie[2]=K[2]*-K[3],{center:ie,radius:Math.sqrt(1-K[3]*K[3])}})(R);return Bc((function(K,ie,re){const ue=o.bp();o.aU(ue,re,K);const pe=o.bp();return o.bq(pe,K,ue,ie/o.a$(ue)),pe})(Y.center,Y.radius,j))}getMatrixForModel(u,m){const w=o.S.convert(u),M=1/o.bu,R=o.b9();return o.bz(R,R,w.lng/180*Math.PI),o.b7(R,R,-w.lat/180*Math.PI),o.M(R,R,[0,0,1+m/o.bu]),o.b7(R,R,.5*Math.PI),o.N(R,R,[M,M,M]),R}getProjectionDataForCustomLayer(u=!0){const m=this.getProjectionData({overscaledTileID:new o.Z(0,0,0,0,0),applyGlobeMatrix:u});return m.tileMercatorCoords=[0,0,1,1],m}getFastPathSimpleProjectionMatrix(u){}}class Vl{get pixelsToClipSpaceMatrix(){return this._helper.pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._helper.clipSpaceToPixelsMatrix}get pixelsToGLUnits(){return this._helper.pixelsToGLUnits}get centerOffset(){return this._helper.centerOffset}get size(){return this._helper.size}get rotationMatrix(){return this._helper.rotationMatrix}get centerPoint(){return this._helper.centerPoint}get pixelsPerMeter(){return this._helper.pixelsPerMeter}setMinZoom(u){this._helper.setMinZoom(u)}setMaxZoom(u){this._helper.setMaxZoom(u)}setMinPitch(u){this._helper.setMinPitch(u)}setMaxPitch(u){this._helper.setMaxPitch(u)}setRenderWorldCopies(u){this._helper.setRenderWorldCopies(u)}setBearing(u){this._helper.setBearing(u)}setPitch(u){this._helper.setPitch(u)}setRoll(u){this._helper.setRoll(u)}setFov(u){this._helper.setFov(u)}setZoom(u){this._helper.setZoom(u)}setCenter(u){this._helper.setCenter(u)}setElevation(u){this._helper.setElevation(u)}setMinElevationForCurrentTile(u){this._helper.setMinElevationForCurrentTile(u)}setPadding(u){this._helper.setPadding(u)}interpolatePadding(u,m,w){return this._helper.interpolatePadding(u,m,w)}isPaddingEqual(u){return this._helper.isPaddingEqual(u)}resize(u,m,w=!0){this._helper.resize(u,m,w)}getMaxBounds(){return this._helper.getMaxBounds()}setMaxBounds(u){this._helper.setMaxBounds(u)}overrideNearFarZ(u,m){this._helper.overrideNearFarZ(u,m)}clearNearFarZOverride(){this._helper.clearNearFarZOverride()}getCameraQueryGeometry(u){return this._helper.getCameraQueryGeometry(this.getCameraPoint(),u)}get tileSize(){return this._helper.tileSize}get tileZoom(){return this._helper.tileZoom}get scale(){return this._helper.scale}get worldSize(){return this._helper.worldSize}get width(){return this._helper.width}get height(){return this._helper.height}get lngRange(){return this._helper.lngRange}get latRange(){return this._helper.latRange}get minZoom(){return this._helper.minZoom}get maxZoom(){return this._helper.maxZoom}get zoom(){return this._helper.zoom}get center(){return this._helper.center}get minPitch(){return this._helper.minPitch}get maxPitch(){return this._helper.maxPitch}get pitch(){return this._helper.pitch}get pitchInRadians(){return this._helper.pitchInRadians}get roll(){return this._helper.roll}get rollInRadians(){return this._helper.rollInRadians}get bearing(){return this._helper.bearing}get bearingInRadians(){return this._helper.bearingInRadians}get fov(){return this._helper.fov}get fovInRadians(){return this._helper.fovInRadians}get elevation(){return this._helper.elevation}get minElevationForCurrentTile(){return this._helper.minElevationForCurrentTile}get padding(){return this._helper.padding}get unmodified(){return this._helper.unmodified}get renderWorldCopies(){return this._helper.renderWorldCopies}get cameraToCenterDistance(){return this._helper.cameraToCenterDistance}get nearZ(){return this._helper.nearZ}get farZ(){return this._helper.farZ}get autoCalculateNearFarZ(){return this._helper.autoCalculateNearFarZ}get isGlobeRendering(){return this._globeness>0}setTransitionState(u,m){this._globeness=u,this._globeLatitudeErrorCorrectionRadians=m,this._calcMatrices(),this._verticalPerspectiveTransform.getCoveringTilesDetailsProvider().prepareNextFrame(),this._mercatorTransform.getCoveringTilesDetailsProvider().prepareNextFrame()}get currentTransform(){return this.isGlobeRendering?this._verticalPerspectiveTransform:this._mercatorTransform}constructor(){this._globeLatitudeErrorCorrectionRadians=0,this._globeness=1,this._helper=new Rn({calcMatrices:()=>{this._calcMatrices()},getConstrained:(u,m)=>this.getConstrained(u,m)}),this._globeness=1,this._mercatorTransform=new pl,this._verticalPerspectiveTransform=new ed}clone(){const u=new Vl;return u._globeness=this._globeness,u._globeLatitudeErrorCorrectionRadians=this._globeLatitudeErrorCorrectionRadians,u.apply(this),u}apply(u){this._helper.apply(u),this._mercatorTransform.apply(this),this._verticalPerspectiveTransform.apply(this,this._globeLatitudeErrorCorrectionRadians)}get projectionMatrix(){return this.currentTransform.projectionMatrix}get modelViewProjectionMatrix(){return this.currentTransform.modelViewProjectionMatrix}get inverseProjectionMatrix(){return this.currentTransform.inverseProjectionMatrix}get cameraPosition(){return this.currentTransform.cameraPosition}getProjectionData(u){const m=this._mercatorTransform.getProjectionData(u),w=this._verticalPerspectiveTransform.getProjectionData(u);return{mainMatrix:this.isGlobeRendering?w.mainMatrix:m.mainMatrix,clippingPlane:w.clippingPlane,tileMercatorCoords:w.tileMercatorCoords,projectionTransition:u.applyGlobeMatrix?this._globeness:0,fallbackMatrix:m.fallbackMatrix}}isLocationOccluded(u){return this.currentTransform.isLocationOccluded(u)}transformLightDirection(u){return this.currentTransform.transformLightDirection(u)}getPixelScale(){return o.bk(this._mercatorTransform.getPixelScale(),this._verticalPerspectiveTransform.getPixelScale(),this._globeness)}getCircleRadiusCorrection(){return o.bk(this._mercatorTransform.getCircleRadiusCorrection(),this._verticalPerspectiveTransform.getCircleRadiusCorrection(),this._globeness)}getPitchedTextCorrection(u,m,w){const M=this._mercatorTransform.getPitchedTextCorrection(u,m,w),R=this._verticalPerspectiveTransform.getPitchedTextCorrection(u,m,w);return o.bk(M,R,this._globeness)}projectTileCoordinates(u,m,w,M){return this.currentTransform.projectTileCoordinates(u,m,w,M)}_calcMatrices(){this._helper._width&&this._helper._height&&(this._verticalPerspectiveTransform.apply(this,this._globeLatitudeErrorCorrectionRadians),this._helper._nearZ=this._verticalPerspectiveTransform.nearZ,this._helper._farZ=this._verticalPerspectiveTransform.farZ,this._mercatorTransform.apply(this,!0,this.isGlobeRendering),this._helper._nearZ=this._mercatorTransform.nearZ,this._helper._farZ=this._mercatorTransform.farZ)}calculateFogMatrix(u){return this.currentTransform.calculateFogMatrix(u)}getVisibleUnwrappedCoordinates(u){return this.currentTransform.getVisibleUnwrappedCoordinates(u)}getCameraFrustum(){return this.currentTransform.getCameraFrustum()}getClippingPlane(){return this.currentTransform.getClippingPlane()}getCoveringTilesDetailsProvider(){return this.currentTransform.getCoveringTilesDetailsProvider()}recalculateZoomAndCenter(u){this._mercatorTransform.recalculateZoomAndCenter(u),this._verticalPerspectiveTransform.recalculateZoomAndCenter(u)}maxPitchScaleFactor(){return this._mercatorTransform.maxPitchScaleFactor()}getCameraPoint(){return this._helper.getCameraPoint()}getCameraAltitude(){return this._helper.getCameraAltitude()}getCameraLngLat(){return this._helper.getCameraLngLat()}lngLatToCameraDepth(u,m){return this.currentTransform.lngLatToCameraDepth(u,m)}populateCache(u){this._mercatorTransform.populateCache(u),this._verticalPerspectiveTransform.populateCache(u)}getBounds(){return this.currentTransform.getBounds()}getConstrained(u,m){return this.currentTransform.getConstrained(u,m)}calculateCenterFromCameraLngLatAlt(u,m,w,M){return this._helper.calculateCenterFromCameraLngLatAlt(u,m,w,M)}setLocationAtPoint(u,m){if(!this.isGlobeRendering)return this._mercatorTransform.setLocationAtPoint(u,m),void this.apply(this._mercatorTransform);this._verticalPerspectiveTransform.setLocationAtPoint(u,m),this.apply(this._verticalPerspectiveTransform)}locationToScreenPoint(u,m){return this.currentTransform.locationToScreenPoint(u,m)}screenPointToMercatorCoordinate(u,m){return this.currentTransform.screenPointToMercatorCoordinate(u,m)}screenPointToLocation(u,m){return this.currentTransform.screenPointToLocation(u,m)}isPointOnMapSurface(u,m){return this.currentTransform.isPointOnMapSurface(u,m)}getRayDirectionFromPixel(u){return this._verticalPerspectiveTransform.getRayDirectionFromPixel(u)}getMatrixForModel(u,m){return this.currentTransform.getMatrixForModel(u,m)}getProjectionDataForCustomLayer(u=!0){const m=this._mercatorTransform.getProjectionDataForCustomLayer(u);if(!this.isGlobeRendering)return m;const w=this._verticalPerspectiveTransform.getProjectionDataForCustomLayer(u);return w.fallbackMatrix=m.mainMatrix,w}getFastPathSimpleProjectionMatrix(u){return this.currentTransform.getFastPathSimpleProjectionMatrix(u)}}class Bs{get useGlobeControls(){return!0}handlePanInertia(u,m){const w=_p(u,m);return Math.abs(w.lng-m.center.lng)>180&&(w.lng=m.center.lng+179.5*Math.sign(w.lng-m.center.lng)),{easingCenter:w,easingOffset:new o.P(0,0)}}handleMapControlsRollPitchBearingZoom(u,m){const w=u.around,M=m.screenPointToLocation(w);u.bearingDelta&&m.setBearing(m.bearing+u.bearingDelta),u.pitchDelta&&m.setPitch(m.pitch+u.pitchDelta),u.rollDelta&&m.setRoll(m.roll+u.rollDelta);const R=m.zoom;u.zoomDelta&&m.setZoom(m.zoom+u.zoomDelta);const N=m.zoom-R;if(N===0)return;const H=o.bA(m.center.lng,M.lng),j=H/(Math.abs(H/180)+1),Y=o.bA(m.center.lat,M.lat),K=m.getRayDirectionFromPixel(w),ie=m.cameraPosition,re=-1*o.aX(ie,K),ue=o.bp();o.aS(ue,ie,[K[0]*re,K[1]*re,K[2]*re]);const pe=o.aZ(ue)-1,Se=Math.exp(.5*-Math.max(pe-.3,0)),Te=Nc(m.worldSize,m.center.lat)/Math.min(m.width,m.height),Ce=o.bn(Te,.9,.5,1,.25),Ie=(1-o.af(-N))*Math.min(Se,Ce),ke=m.center.lat,Re=m.zoom,ze=new o.S(m.center.lng+j*Ie,o.ah(m.center.lat+Y*Ie,-o.ai,o.ai));m.setLocationAtPoint(M,w);const He=m.center,Le=o.bn(Math.abs(H),45,85,0,1),Xe=o.bn(Te,.75,.35,0,1),ht=Math.pow(Math.max(Le,Xe),.25),at=o.bA(He.lng,ze.lng),st=o.bA(He.lat,ze.lat);m.setCenter(new o.S(He.lng+at*ht,He.lat+st*ht).wrap()),m.setZoom(Re+va(ke,m.center.lat))}handleMapControlsPan(u,m,w){if(!u.panDelta)return;const M=m.center.lat,R=m.zoom;m.setCenter(_p(u.panDelta,m).wrap()),m.setZoom(R+va(M,m.center.lat))}cameraForBoxAndBearing(u,m,w,M,R){const N=pa(u,m,w,M,R),H=m.left/R.width*2-1,j=(R.width-m.right)/R.width*2-1,Y=m.top/R.height*-2+1,K=(R.height-m.bottom)/R.height*-2+1,ie=o.bA(w.getWest(),w.getEast())<0,re=ie?w.getEast():w.getWest(),ue=ie?w.getWest():w.getEast(),pe=Math.max(w.getNorth(),w.getSouth()),Se=Math.min(w.getNorth(),w.getSouth()),Te=re+.5*o.bA(re,ue),Ce=pe+.5*o.bA(pe,Se),Ie=R.clone();Ie.setCenter(N.center),Ie.setBearing(N.bearing),Ie.setPitch(0),Ie.setRoll(0),Ie.setZoom(N.zoom);const ke=Ie.modelViewProjectionMatrix,Re=[ga(w.getNorthWest()),ga(w.getNorthEast()),ga(w.getSouthWest()),ga(w.getSouthEast()),ga(new o.S(ue,Ce)),ga(new o.S(re,Ce)),ga(new o.S(Te,pe)),ga(new o.S(Te,Se))],ze=ga(N.center);let He=Number.POSITIVE_INFINITY;for(const Le of Re)H<0&&(He=Bs.getLesserNonNegativeNonNull(He,Bs.solveVectorScale(Le,ze,ke,"x",H))),j>0&&(He=Bs.getLesserNonNegativeNonNull(He,Bs.solveVectorScale(Le,ze,ke,"x",j))),Y>0&&(He=Bs.getLesserNonNegativeNonNull(He,Bs.solveVectorScale(Le,ze,ke,"y",Y))),K<0&&(He=Bs.getLesserNonNegativeNonNull(He,Bs.solveVectorScale(Le,ze,ke,"y",K)));if(Number.isFinite(He)&&He!==0)return N.zoom=Ie.zoom+o.ak(He),N;En()}handleJumpToCenterZoom(u,m){const w=u.center.lat,M=u.getConstrained(m.center?o.S.convert(m.center):u.center,u.zoom).center;u.setCenter(M.wrap());const R=m.zoom!==void 0?+m.zoom:u.zoom+va(w,M.lat);u.zoom!==R&&u.setZoom(R)}handleEaseTo(u,m){const w=u.zoom,M=u.center,R=u.padding,N={roll:u.roll,pitch:u.pitch,bearing:u.bearing},H={roll:m.roll===void 0?u.roll:m.roll,pitch:m.pitch===void 0?u.pitch:m.pitch,bearing:m.bearing===void 0?u.bearing:m.bearing},j=m.zoom!==void 0,Y=!u.isPaddingEqual(m.padding);let K=!1;const ie=m.center?o.S.convert(m.center):M,re=u.getConstrained(ie,w).center;Cu(u,re);const ue=u.clone();ue.setCenter(re),ue.setZoom(j?+m.zoom:w+va(M.lat,ie.lat)),ue.setBearing(m.bearing);const pe=new o.P(o.ah(u.centerPoint.x+m.offsetAsPoint.x,0,u.width),o.ah(u.centerPoint.y+m.offsetAsPoint.y,0,u.height));ue.setLocationAtPoint(re,pe);const Se=(m.offset&&m.offsetAsPoint.mag())>0?ue.center:re,Te=j?+m.zoom:w+va(M.lat,Se.lat),Ce=w+va(M.lat,0),Ie=Te+va(Se.lat,0),ke=o.bA(M.lng,Se.lng),Re=o.bA(M.lat,Se.lat),ze=o.af(Ie-Ce);return K=Te!==w,{easeFunc:He=>{if(o.be(N,H)||Qa({startEulerAngles:N,endEulerAngles:H,tr:u,k:He,useSlerp:N.roll!=H.roll}),Y&&u.interpolatePadding(R,m.padding,He),m.around)o.w("Easing around a point is not supported under globe projection."),u.setLocationAtPoint(m.around,m.aroundPoint);else{const Le=Ie>Ce?Math.min(2,ze):Math.max(.5,ze),Xe=Math.pow(Le,1-He),ht=zy(M,ke,Re,He*Xe);u.setCenter(ht.wrap())}if(K){const Le=o.C.number(Ce,Ie,He)+va(0,u.center.lat);u.setZoom(Le)}},isZooming:K,elevationCenter:Se}}handleFlyTo(u,m){const w=m.zoom!==void 0,M=u.center,R=u.zoom,N=u.padding,H=!u.isPaddingEqual(m.padding),j=u.getConstrained(o.S.convert(m.center||m.locationAtOffset),R).center,Y=w?+m.zoom:u.zoom+va(u.center.lat,j.lat),K=u.clone();K.setCenter(j),K.setZoom(Y),K.setBearing(m.bearing);const ie=new o.P(o.ah(u.centerPoint.x+m.offsetAsPoint.x,0,u.width),o.ah(u.centerPoint.y+m.offsetAsPoint.y,0,u.height));K.setLocationAtPoint(j,ie);const re=K.center;Cu(u,re);const ue=(function(Re,ze,He){const Le=ga(ze),Xe=ga(He),ht=o.aX(Le,Xe),at=Math.acos(ht),st=Fh(Re);return at/(2*Math.PI)*st})(u,M,re),pe=R+va(M.lat,0),Se=Y+va(re.lat,0),Te=o.af(Se-pe);let Ce;if(typeof m.minZoom=="number"){const Re=+m.minZoom+va(re.lat,0),ze=Math.min(Re,pe,Se)+va(0,re.lat),He=u.getConstrained(re,ze).zoom+va(re.lat,0);Ce=o.af(He-pe)}const Ie=o.bA(M.lng,re.lng),ke=o.bA(M.lat,re.lat);return{easeFunc:(Re,ze,He,Le)=>{const Xe=zy(M,Ie,ke,He);H&&u.interpolatePadding(N,m.padding,Re);const ht=Re===1?re:Xe;u.setCenter(ht.wrap());const at=pe+o.ak(ze);u.setZoom(Re===1?Y:at+va(0,ht.lat))},scaleOfZoom:Te,targetCenter:re,scaleOfMinZoom:Ce,pixelPathLength:ue}}static solveVectorScale(u,m,w,M,R){const N=M==="x"?[w[0],w[4],w[8],w[12]]:[w[1],w[5],w[9],w[13]],H=[w[3],w[7],w[11],w[15]],j=u[0]*N[0]+u[1]*N[1]+u[2]*N[2],Y=u[0]*H[0]+u[1]*H[1]+u[2]*H[2],K=m[0]*N[0]+m[1]*N[1]+m[2]*N[2],ie=m[0]*H[0]+m[1]*H[1]+m[2]*H[2];return K+R*Y===j+R*ie||H[3]*(j-K)+N[3]*(ie-Y)+j*ie==K*Y?null:(K+N[3]-R*ie-R*H[3])/(K-j-R*ie+R*Y)}static getLesserNonNegativeNonNull(u,m){return m!==null&&m>=0&&m<u?m:u}}class iv{constructor(u){this._globe=u,this._mercatorCameraHelper=new ns,this._verticalPerspectiveCameraHelper=new Bs}get useGlobeControls(){return this._globe.useGlobeRendering}get currentHelper(){return this.useGlobeControls?this._verticalPerspectiveCameraHelper:this._mercatorCameraHelper}handlePanInertia(u,m){return this.currentHelper.handlePanInertia(u,m)}handleMapControlsRollPitchBearingZoom(u,m){return this.currentHelper.handleMapControlsRollPitchBearingZoom(u,m)}handleMapControlsPan(u,m,w){this.currentHelper.handleMapControlsPan(u,m,w)}cameraForBoxAndBearing(u,m,w,M,R){return this.currentHelper.cameraForBoxAndBearing(u,m,w,M,R)}handleJumpToCenterZoom(u,m){this.currentHelper.handleJumpToCenterZoom(u,m)}handleEaseTo(u,m){return this.currentHelper.handleEaseTo(u,m)}handleFlyTo(u,m){return this.currentHelper.handleFlyTo(u,m)}}const wp=(I,u)=>o.y(I,u&&u.filter((m=>m.identifier!=="source.canvas"))),Ab=o.bE();class nv extends o.E{constructor(u,m={}){var w,M;super(),this._rtlPluginLoaded=()=>{for(const N in this.sourceCaches){const H=this.sourceCaches[N].getSource().type;H!=="vector"&&H!=="geojson"||this.sourceCaches[N].reload()}},this.map=u,this.dispatcher=new qt(Dt(),u._getMapId()),this.dispatcher.registerMessageHandler("GG",((N,H)=>this.getGlyphs(N,H))),this.dispatcher.registerMessageHandler("GI",((N,H)=>this.getImages(N,H))),this.dispatcher.registerMessageHandler("GDA",((N,H)=>this.getDashes(N,H))),this.imageManager=new ee,this.imageManager.setEventedParent(this);const R=((w=u._container)===null||w===void 0?void 0:w.lang)||typeof document<"u"&&((M=document.documentElement)===null||M===void 0?void 0:M.lang)||void 0;this.glyphManager=new ve(u._requestManager,m.localIdeographFontFamily,R),this.lineAtlas=new je(256,512),this.crossTileSymbolIndex=new dl,this._spritesImagesIds={},this._layers={},this._order=[],this.sourceCaches={},this.zoomHistory=new o.bF,this._loaded=!1,this._availableImages=[],this._globalState={},this._resetUpdates(),this.dispatcher.broadcast("SR",o.bG()),Ll().on(ea,this._rtlPluginLoaded),this.on("data",(N=>{if(N.dataType!=="source"||N.sourceDataType!=="metadata")return;const H=this.sourceCaches[N.sourceId];if(!H)return;const j=H.getSource();if(j&&j.vectorLayerIds)for(const Y in this._layers){const K=this._layers[Y];K.source===j.id&&this._validateLayer(K)}}))}setGlobalStateProperty(u,m){var w,M,R;this._checkLoaded();const N=m===null?(R=(M=(w=this.stylesheet.state)===null||w===void 0?void 0:w[u])===null||M===void 0?void 0:M.default)!==null&&R!==void 0?R:null:m;if(o.bH(N,this._globalState[u]))return this;this._globalState[u]=N,this._applyGlobalStateChanges([u])}getGlobalState(){return this._globalState}setGlobalState(u){this._checkLoaded();const m=[];for(const w in u)!o.bH(this._globalState[w],u[w].default)&&(m.push(w),this._globalState[w]=u[w].default);this._applyGlobalStateChanges(m)}_applyGlobalStateChanges(u){if(u.length===0)return;const m=new Set,w={};for(const M of u){w[M]=this._globalState[M];for(const R in this._layers){const N=this._layers[R],H=N.getLayoutAffectingGlobalStateRefs(),j=N.getPaintAffectingGlobalStateRefs();if(H.has(M)&&m.add(N.source),j.has(M))for(const{name:Y,value:K}of j.get(M))this._updatePaintProperty(N,Y,K)}}this.dispatcher.broadcast("UGS",w);for(const M in this.sourceCaches)m.has(M)&&(this._reloadSource(M),this._changed=!0)}loadURL(u,m={},w){this.fire(new o.l("dataloading",{dataType:"style"})),m.validate=typeof m.validate!="boolean"||m.validate;const M=this.map._requestManager.transformRequest(u,"Style");this._loadStyleRequest=new AbortController;const R=this._loadStyleRequest;o.j(M,this._loadStyleRequest).then((N=>{this._loadStyleRequest=null,this._load(N.data,m,w)})).catch((N=>{this._loadStyleRequest=null,N&&!R.signal.aborted&&this.fire(new o.k(N))}))}loadJSON(u,m={},w){this.fire(new o.l("dataloading",{dataType:"style"})),this._frameRequest=new AbortController,y.frameAsync(this._frameRequest).then((()=>{this._frameRequest=null,m.validate=m.validate!==!1,this._load(u,m,w)})).catch((()=>{}))}loadEmpty(){this.fire(new o.l("dataloading",{dataType:"style"})),this._load(Ab,{validate:!1})}_load(u,m,w){var M,R;let N=m.transformStyle?m.transformStyle(w,u):u;if(!m.validate||!wp(this,o.z(N))){N=Object.assign({},N),this._loaded=!0,this.stylesheet=N;for(const H in N.sources)this.addSource(H,N.sources[H],{validate:!1});N.sprite?this._loadSprite(N.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(N.glyphs),this._createLayers(),this.light=new me(this.stylesheet.light),this._setProjectionInternal(((M=this.stylesheet.projection)===null||M===void 0?void 0:M.type)||"mercator"),this.sky=new Fe(this.stylesheet.sky),this.map.setTerrain((R=this.stylesheet.terrain)!==null&&R!==void 0?R:null),this.fire(new o.l("data",{dataType:"style"})),this.fire(new o.l("style.load"))}}_createLayers(){var u,m,w;const M=o.bI(this.stylesheet.layers);this.setGlobalState((u=this.stylesheet.state)!==null&&u!==void 0?u:null),this.dispatcher.broadcast("SL",M),this._order=M.map((R=>R.id)),this._layers={},this._serializedLayers=null;for(const R of M){const N=o.bJ(R,this._globalState);if(N.setEventedParent(this,{layer:{id:R.id}}),this._layers[R.id]=N,o.bK(N)&&this.sourceCaches[N.source]){const H=(w=(m=R.paint)===null||m===void 0?void 0:m["raster-fade-duration"])!==null&&w!==void 0?w:N.paint.get("raster-fade-duration");this.sourceCaches[N.source].setRasterFadeDuration(H)}}}_loadSprite(u,m=!1,w=void 0){let M;this.imageManager.setLoaded(!1),this._spriteRequest=new AbortController,(function(R,N,H,j){return o._(this,void 0,void 0,(function*(){const Y=$(R),K=H>1?"@2x":"",ie={},re={};for(const{id:ue,url:pe}of Y){const Se=N.transformRequest(q(pe,K,".json"),"SpriteJSON");ie[ue]=o.j(Se,j);const Te=N.transformRequest(q(pe,K,".png"),"SpriteImage");re[ue]=F.getImage(Te,j)}return yield Promise.all([...Object.values(ie),...Object.values(re)]),(function(ue,pe){return o._(this,void 0,void 0,(function*(){const Se={};for(const Te in ue){Se[Te]={};const Ce=y.getImageCanvasContext((yield pe[Te]).data),Ie=(yield ue[Te]).data;for(const ke in Ie){const{width:Re,height:ze,x:He,y:Le,sdf:Xe,pixelRatio:ht,stretchX:at,stretchY:st,content:lt,textFitWidth:Ot,textFitHeight:Bt}=Ie[ke];Se[Te][ke]={data:null,pixelRatio:ht,sdf:Xe,stretchX:at,stretchY:st,content:lt,textFitWidth:Ot,textFitHeight:Bt,spriteData:{width:Re,height:ze,x:He,y:Le,context:Ce}}}}return Se}))})(ie,re)}))})(u,this.map._requestManager,this.map.getPixelRatio(),this._spriteRequest).then((R=>{if(this._spriteRequest=null,R)for(const N in R){this._spritesImagesIds[N]=[];const H=this._spritesImagesIds[N]?this._spritesImagesIds[N].filter((j=>!(j in R))):[];for(const j of H)this.imageManager.removeImage(j),this._changedImages[j]=!0;for(const j in R[N]){const Y=N==="default"?j:`${N}:${j}`;this._spritesImagesIds[N].push(Y),Y in this.imageManager.images?this.imageManager.updateImage(Y,R[N][j],!1):this.imageManager.addImage(Y,R[N][j]),m&&(this._changedImages[Y]=!0)}}})).catch((R=>{this._spriteRequest=null,M=R,this.fire(new o.k(M))})).finally((()=>{this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),m&&(this._changed=!0),this.dispatcher.broadcast("SI",this._availableImages),this.fire(new o.l("data",{dataType:"style"})),w&&w(M)}))}_unloadSprite(){for(const u of Object.values(this._spritesImagesIds).flat())this.imageManager.removeImage(u),this._changedImages[u]=!0;this._spritesImagesIds={},this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new o.l("data",{dataType:"style"}))}_validateLayer(u){const m=this.sourceCaches[u.source];if(!m)return;const w=u.sourceLayer;if(!w)return;const M=m.getSource();(M.type==="geojson"||M.vectorLayerIds&&M.vectorLayerIds.indexOf(w)===-1)&&this.fire(new o.k(new Error(`Source layer "${w}" does not exist on source "${M.id}" as specified by style layer "${u.id}".`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const u in this.sourceCaches)if(!this.sourceCaches[u].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeByIds(u,m=!1){const w=this._serializedAllLayers();if(!u||u.length===0)return Object.values(m?o.bL(w):w);const M=[];for(const R of u)if(w[R]){const N=m?o.bL(w[R]):w[R];M.push(N)}return M}_serializedAllLayers(){let u=this._serializedLayers;if(u)return u;u=this._serializedLayers={};const m=Object.keys(this._layers);for(const w of m){const M=this._layers[w];M.type!=="custom"&&(u[w]=M.serialize())}return u}hasTransitions(){var u,m,w;if(!((u=this.light)===null||u===void 0)&&u.hasTransition()||!((m=this.sky)===null||m===void 0)&&m.hasTransition()||!((w=this.projection)===null||w===void 0)&&w.hasTransition())return!0;for(const M in this.sourceCaches)if(this.sourceCaches[M].hasTransition())return!0;for(const M in this._layers)if(this._layers[M].hasTransition())return!0;return!1}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading.")}update(u){if(!this._loaded)return;const m=this._changed;if(m){const M=Object.keys(this._updatedLayers),R=Object.keys(this._removedLayers);(M.length||R.length)&&this._updateWorkerLayers(M,R);for(const N in this._updatedSources){const H=this._updatedSources[N];if(H==="reload")this._reloadSource(N);else{if(H!=="clear")throw new Error(`Invalid action ${H}`);this._clearSource(N)}}this._updateTilesForChangedImages(),this._updateTilesForChangedGlyphs();for(const N in this._updatedPaintProps)this._layers[N].updateTransitions(u);this.light.updateTransitions(u),this.sky.updateTransitions(u),this._resetUpdates()}const w={};for(const M in this.sourceCaches){const R=this.sourceCaches[M];w[M]=R.used,R.used=!1}for(const M of this._order){const R=this._layers[M];R.recalculate(u,this._availableImages),!R.isHidden(u.zoom)&&R.source&&(this.sourceCaches[R.source].used=!0)}for(const M in w){const R=this.sourceCaches[M];!!w[M]!=!!R.used&&R.fire(new o.l("data",{sourceDataType:"visibility",dataType:"source",sourceId:M}))}this.light.recalculate(u),this.sky.recalculate(u),this.projection.recalculate(u),this.z=u.zoom,m&&this.fire(new o.l("data",{dataType:"style"}))}_updateTilesForChangedImages(){const u=Object.keys(this._changedImages);if(u.length){for(const m in this.sourceCaches)this.sourceCaches[m].reloadTilesForDependencies(["icons","patterns"],u);this._changedImages={}}}_updateTilesForChangedGlyphs(){if(this._glyphsDidChange){for(const u in this.sourceCaches)this.sourceCaches[u].reloadTilesForDependencies(["glyphs"],[""]);this._glyphsDidChange=!1}}_updateWorkerLayers(u,m){this.dispatcher.broadcast("UL",{layers:this._serializeByIds(u,!1),removedIds:m})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={},this._glyphsDidChange=!1}setState(u,m={}){var w;this._checkLoaded();const M=this.serialize();if(u=m.transformStyle?m.transformStyle(M,u):u,((w=m.validate)===null||w===void 0||w)&&wp(this,o.z(u)))return!1;(u=o.bL(u)).layers=o.bI(u.layers);const R=o.bM(M,u),N=this._getOperationsToPerform(R);if(N.unimplemented.length>0)throw new Error(`Unimplemented: ${N.unimplemented.join(", ")}.`);if(N.operations.length===0)return!1;for(const H of N.operations)H();return this.stylesheet=u,this._serializedLayers=null,!0}_getOperationsToPerform(u){const m=[],w=[];for(const M of u)switch(M.command){case"setCenter":case"setZoom":case"setBearing":case"setPitch":case"setRoll":continue;case"addLayer":m.push((()=>this.addLayer.apply(this,M.args)));break;case"removeLayer":m.push((()=>this.removeLayer.apply(this,M.args)));break;case"setPaintProperty":m.push((()=>this.setPaintProperty.apply(this,M.args)));break;case"setLayoutProperty":m.push((()=>this.setLayoutProperty.apply(this,M.args)));break;case"setFilter":m.push((()=>this.setFilter.apply(this,M.args)));break;case"addSource":m.push((()=>this.addSource.apply(this,M.args)));break;case"removeSource":m.push((()=>this.removeSource.apply(this,M.args)));break;case"setLayerZoomRange":m.push((()=>this.setLayerZoomRange.apply(this,M.args)));break;case"setLight":m.push((()=>this.setLight.apply(this,M.args)));break;case"setGeoJSONSourceData":m.push((()=>this.setGeoJSONSourceData.apply(this,M.args)));break;case"setGlyphs":m.push((()=>this.setGlyphs.apply(this,M.args)));break;case"setSprite":m.push((()=>this.setSprite.apply(this,M.args)));break;case"setTerrain":m.push((()=>this.map.setTerrain.apply(this,M.args)));break;case"setSky":m.push((()=>this.setSky.apply(this,M.args)));break;case"setProjection":this.setProjection.apply(this,M.args);break;case"setGlobalState":m.push((()=>this.setGlobalState.apply(this,M.args)));break;case"setTransition":m.push((()=>{}));break;default:w.push(M.command)}return{operations:m,unimplemented:w}}addImage(u,m){if(this.getImage(u))return this.fire(new o.k(new Error(`An image named "${u}" already exists.`)));this.imageManager.addImage(u,m),this._afterImageUpdated(u)}updateImage(u,m){this.imageManager.updateImage(u,m)}getImage(u){return this.imageManager.getImage(u)}removeImage(u){if(!this.getImage(u))return this.fire(new o.k(new Error(`An image named "${u}" does not exist.`)));this.imageManager.removeImage(u),this._afterImageUpdated(u)}_afterImageUpdated(u){this._availableImages=this.imageManager.listImages(),this._changedImages[u]=!0,this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new o.l("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this.imageManager.listImages()}addSource(u,m,w={}){if(this._checkLoaded(),this.sourceCaches[u]!==void 0)throw new Error(`Source "${u}" already exists.`);if(!m.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(m).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(m.type)>=0&&this._validate(o.z.source,`sources.${u}`,m,null,w))return;this.map&&this.map._collectResourceTiming&&(m.collectResourceTiming=!0);const M=this.sourceCaches[u]=new or(u,m,this.dispatcher);M.style=this,M.setEventedParent(this,(()=>({isSourceLoaded:M.loaded(),source:M.serialize(),sourceId:u}))),M.onAdd(this.map),this._changed=!0}removeSource(u){if(this._checkLoaded(),this.sourceCaches[u]===void 0)throw new Error("There is no source with this ID");for(const w in this._layers)if(this._layers[w].source===u)return this.fire(new o.k(new Error(`Source "${u}" cannot be removed while layer "${w}" is using it.`)));const m=this.sourceCaches[u];delete this.sourceCaches[u],delete this._updatedSources[u],m.fire(new o.l("data",{sourceDataType:"metadata",dataType:"source",sourceId:u})),m.setEventedParent(null),m.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(u,m){if(this._checkLoaded(),this.sourceCaches[u]===void 0)throw new Error(`There is no source with this ID=${u}`);const w=this.sourceCaches[u].getSource();if(w.type!=="geojson")throw new Error(`geojsonSource.type is ${w.type}, which is !== 'geojson`);w.setData(m),this._changed=!0}getSource(u){return this.sourceCaches[u]&&this.sourceCaches[u].getSource()}addLayer(u,m,w={}){this._checkLoaded();const M=u.id;if(this.getLayer(M))return void this.fire(new o.k(new Error(`Layer "${M}" already exists on this map.`)));let R;if(u.type==="custom"){if(wp(this,o.bN(u)))return;R=o.bJ(u,this._globalState)}else{if("source"in u&&typeof u.source=="object"&&(this.addSource(M,u.source),u=o.bL(u),u=o.e(u,{source:M})),this._validate(o.z.layer,`layers.${M}`,u,{arrayIndex:-1},w))return;R=o.bJ(u,this._globalState),this._validateLayer(R),R.setEventedParent(this,{layer:{id:M}})}const N=m?this._order.indexOf(m):this._order.length;if(m&&N===-1)this.fire(new o.k(new Error(`Cannot add layer "${M}" before non-existing layer "${m}".`)));else{if(this._order.splice(N,0,M),this._layerOrderChanged=!0,this._layers[M]=R,this._removedLayers[M]&&R.source&&R.type!=="custom"){const H=this._removedLayers[M];delete this._removedLayers[M],H.type!==R.type?this._updatedSources[R.source]="clear":(this._updatedSources[R.source]="reload",this.sourceCaches[R.source].pause())}this._updateLayer(R),R.onAdd&&R.onAdd(this.map)}}moveLayer(u,m){if(this._checkLoaded(),this._changed=!0,!this._layers[u])return void this.fire(new o.k(new Error(`The layer '${u}' does not exist in the map's style and cannot be moved.`)));if(u===m)return;const w=this._order.indexOf(u);this._order.splice(w,1);const M=m?this._order.indexOf(m):this._order.length;m&&M===-1?this.fire(new o.k(new Error(`Cannot move layer "${u}" before non-existing layer "${m}".`))):(this._order.splice(M,0,u),this._layerOrderChanged=!0)}removeLayer(u){this._checkLoaded();const m=this._layers[u];if(!m)return void this.fire(new o.k(new Error(`Cannot remove non-existing layer "${u}".`)));m.setEventedParent(null);const w=this._order.indexOf(u);this._order.splice(w,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[u]=m,delete this._layers[u],this._serializedLayers&&delete this._serializedLayers[u],delete this._updatedLayers[u],delete this._updatedPaintProps[u],m.onRemove&&m.onRemove(this.map)}getLayer(u){return this._layers[u]}getLayersOrder(){return[...this._order]}hasLayer(u){return u in this._layers}setLayerZoomRange(u,m,w){this._checkLoaded();const M=this.getLayer(u);M?M.minzoom===m&&M.maxzoom===w||(m!=null&&(M.minzoom=m),w!=null&&(M.maxzoom=w),this._updateLayer(M)):this.fire(new o.k(new Error(`Cannot set the zoom range of non-existing layer "${u}".`)))}setFilter(u,m,w={}){this._checkLoaded();const M=this.getLayer(u);if(M){if(!o.bH(M.filter,m))return m==null?(M.setFilter(void 0),void this._updateLayer(M)):void(this._validate(o.z.filter,`layers.${M.id}.filter`,m,null,w)||(M.setFilter(o.bL(m)),this._updateLayer(M)))}else this.fire(new o.k(new Error(`Cannot filter non-existing layer "${u}".`)))}getFilter(u){return o.bL(this.getLayer(u).filter)}setLayoutProperty(u,m,w,M={}){this._checkLoaded();const R=this.getLayer(u);R?o.bH(R.getLayoutProperty(m),w)||(R.setLayoutProperty(m,w,M),this._updateLayer(R)):this.fire(new o.k(new Error(`Cannot style non-existing layer "${u}".`)))}getLayoutProperty(u,m){const w=this.getLayer(u);if(w)return w.getLayoutProperty(m);this.fire(new o.k(new Error(`Cannot get style of non-existing layer "${u}".`)))}setPaintProperty(u,m,w,M={}){this._checkLoaded();const R=this.getLayer(u);R?o.bH(R.getPaintProperty(m),w)||this._updatePaintProperty(R,m,w,M):this.fire(new o.k(new Error(`Cannot style non-existing layer "${u}".`)))}_updatePaintProperty(u,m,w,M={}){u.setPaintProperty(m,w,M)&&this._updateLayer(u),o.bK(u)&&m==="raster-fade-duration"&&this.sourceCaches[u.source].setRasterFadeDuration(w),this._changed=!0,this._updatedPaintProps[u.id]=!0,this._serializedLayers=null}getPaintProperty(u,m){return this.getLayer(u).getPaintProperty(m)}setFeatureState(u,m){this._checkLoaded();const w=u.source,M=u.sourceLayer,R=this.sourceCaches[w];if(R===void 0)return void this.fire(new o.k(new Error(`The source '${w}' does not exist in the map's style.`)));const N=R.getSource().type;N==="geojson"&&M?this.fire(new o.k(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):N!=="vector"||M?(u.id===void 0&&this.fire(new o.k(new Error("The feature id parameter must be provided."))),R.setFeatureState(M,u.id,m)):this.fire(new o.k(new Error("The sourceLayer parameter must be provided for vector source types.")))}removeFeatureState(u,m){this._checkLoaded();const w=u.source,M=this.sourceCaches[w];if(M===void 0)return void this.fire(new o.k(new Error(`The source '${w}' does not exist in the map's style.`)));const R=M.getSource().type,N=R==="vector"?u.sourceLayer:void 0;R!=="vector"||N?m&&typeof u.id!="string"&&typeof u.id!="number"?this.fire(new o.k(new Error("A feature id is required to remove its specific state property."))):M.removeFeatureState(N,u.id,m):this.fire(new o.k(new Error("The sourceLayer parameter must be provided for vector source types.")))}getFeatureState(u){this._checkLoaded();const m=u.source,w=u.sourceLayer,M=this.sourceCaches[m];if(M!==void 0)return M.getSource().type!=="vector"||w?(u.id===void 0&&this.fire(new o.k(new Error("The feature id parameter must be provided."))),M.getFeatureState(w,u.id)):void this.fire(new o.k(new Error("The sourceLayer parameter must be provided for vector source types.")));this.fire(new o.k(new Error(`The source '${m}' does not exist in the map's style.`)))}getTransition(){return o.e({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){if(!this._loaded)return;const u=o.bO(this.sourceCaches,(R=>R.serialize())),m=this._serializeByIds(this._order,!0),w=this.map.getTerrain()||void 0,M=this.stylesheet;return o.bP({version:M.version,name:M.name,metadata:M.metadata,light:M.light,sky:M.sky,center:M.center,zoom:M.zoom,bearing:M.bearing,pitch:M.pitch,sprite:M.sprite,glyphs:M.glyphs,transition:M.transition,projection:M.projection,sources:u,layers:m,terrain:w},(R=>R!==void 0))}_updateLayer(u){this._updatedLayers[u.id]=!0,u.source&&!this._updatedSources[u.source]&&this.sourceCaches[u.source].getSource().type!=="raster"&&(this._updatedSources[u.source]="reload",this.sourceCaches[u.source].pause()),this._serializedLayers=null,this._changed=!0}_flattenAndSortRenderedFeatures(u){const m=N=>this._layers[N].type==="fill-extrusion",w={},M=[];for(let N=this._order.length-1;N>=0;N--){const H=this._order[N];if(m(H)){w[H]=N;for(const j of u){const Y=j[H];if(Y)for(const K of Y)M.push(K)}}}M.sort(((N,H)=>H.intersectionZ-N.intersectionZ));const R=[];for(let N=this._order.length-1;N>=0;N--){const H=this._order[N];if(m(H))for(let j=M.length-1;j>=0;j--){const Y=M[j].feature;if(w[Y.layer.id]<N)break;R.push(Y),M.pop()}else for(const j of u){const Y=j[H];if(Y)for(const K of Y)R.push(K.feature)}}return R}queryRenderedFeatures(u,m,w){m&&m.filter&&this._validate(o.z.filter,"queryRenderedFeatures.filter",m.filter,null,m);const M={};if(m&&m.layers){if(!(Array.isArray(m.layers)||m.layers instanceof Set))return this.fire(new o.k(new Error("parameters.layers must be an Array or a Set of strings"))),[];for(const Y of m.layers){const K=this._layers[Y];if(!K)return this.fire(new o.k(new Error(`The layer '${Y}' does not exist in the map's style and cannot be queried for features.`))),[];M[K.source]=!0}}const R=[];m.availableImages=this._availableImages;const N=this._serializedAllLayers(),H=m.layers instanceof Set?m.layers:Array.isArray(m.layers)?new Set(m.layers):null,j=Object.assign(Object.assign({},m),{layers:H,globalState:this._globalState});for(const Y in this.sourceCaches)m.layers&&!M[Y]||R.push(zt(this.sourceCaches[Y],this._layers,N,u,j,w,this.map.terrain?(K,ie,re)=>this.map.terrain.getElevation(K,ie,re):void 0));return this.placement&&R.push((function(Y,K,ie,re,ue,pe,Se){const Te={},Ce=pe.queryRenderedSymbols(re),Ie=[];for(const ke of Object.keys(Ce).map(Number))Ie.push(Se[ke]);Ie.sort(yr);for(const ke of Ie){const Re=ke.featureIndex.lookupSymbolFeatures(Ce[ke.bucketInstanceId],K,ke.bucketIndex,ke.sourceLayerIndex,{filterSpec:ue.filter,globalState:ue.globalState},ue.layers,ue.availableImages,Y);for(const ze in Re){const He=Te[ze]=Te[ze]||[],Le=Re[ze];Le.sort(((Xe,ht)=>{const at=ke.featureSortOrder;if(at){const st=at.indexOf(Xe.featureIndex);return at.indexOf(ht.featureIndex)-st}return ht.featureIndex-Xe.featureIndex}));for(const Xe of Le)He.push(Xe)}}return(function(ke,Re,ze){for(const He in ke)for(const Le of ke[He])Gt(Le,ze[Re[He].source]);return ke})(Te,Y,ie)})(this._layers,N,this.sourceCaches,u,j,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(R)}querySourceFeatures(u,m){m?.filter&&this._validate(o.z.filter,"querySourceFeatures.filter",m.filter,null,m);const w=this.sourceCaches[u];return w?(function(M,R){const N=M.getRenderableIds().map((Y=>M.getTileByID(Y))),H=[],j={};for(let Y=0;Y<N.length;Y++){const K=N[Y],ie=K.tileID.canonical.key;j[ie]||(j[ie]=!0,K.querySourceFeatures(H,R))}return H})(w,m?Object.assign(Object.assign({},m),{globalState:this._globalState}):{globalState:this._globalState}):[]}getLight(){return this.light.getLight()}setLight(u,m={}){this._checkLoaded();const w=this.light.getLight();let M=!1;for(const N in u)if(!o.bH(u[N],w[N])){M=!0;break}if(!M)return;const R={now:y.now(),transition:o.e({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(u,m),this.light.updateTransitions(R)}getProjection(){var u;return(u=this.stylesheet)===null||u===void 0?void 0:u.projection}setProjection(u){if(this._checkLoaded(),this.projection){if(this.projection.name===u.type)return;this.projection.destroy(),delete this.projection}this.stylesheet.projection=u,this._setProjectionInternal(u.type)}getSky(){var u;return(u=this.stylesheet)===null||u===void 0?void 0:u.sky}setSky(u,m={}){this._checkLoaded();const w=this.getSky();let M=!1;if(!u&&!w)return;if(u&&!w)M=!0;else if(!u&&w)M=!0;else for(const N in u)if(!o.bH(u[N],w[N])){M=!0;break}if(!M)return;const R={now:y.now(),transition:o.e({duration:300,delay:0},this.stylesheet.transition)};this.stylesheet.sky=u,this.sky.setSky(u,m),this.sky.updateTransitions(R)}_setProjectionInternal(u){const m=(function(w){if(Array.isArray(w)){const M=new Oc({type:w});return{projection:M,transform:new Vl,cameraHelper:new iv(M)}}switch(w){case"mercator":return{projection:new Lo,transform:new pl,cameraHelper:new ns};case"globe":{const M=new Oc({type:["interpolate",["linear"],["zoom"],11,"vertical-perspective",12,"mercator"]});return{projection:M,transform:new Vl,cameraHelper:new iv(M)}}case"vertical-perspective":return{projection:new kc,transform:new ed,cameraHelper:new Bs};default:return o.w(`Unknown projection name: ${w}. Falling back to mercator projection.`),{projection:new Lo,transform:new pl,cameraHelper:new ns}}})(u);this.projection=m.projection,this.map.migrateProjection(m.transform,m.cameraHelper);for(const w in this.sourceCaches)this.sourceCaches[w].reload()}_validate(u,m,w,M,R={}){return(!R||R.validate!==!1)&&wp(this,u.call(o.z,o.e({key:m,style:this.serialize(),value:w,styleSpec:o.v},M)))}_remove(u=!0){this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._loadStyleRequest&&(this._loadStyleRequest.abort(),this._loadStyleRequest=null),this._spriteRequest&&(this._spriteRequest.abort(),this._spriteRequest=null),Ll().off(ea,this._rtlPluginLoaded);for(const m in this._layers)this._layers[m].setEventedParent(null);for(const m in this.sourceCaches){const w=this.sourceCaches[m];w.setEventedParent(null),w.onRemove(this.map)}this.imageManager.setEventedParent(null),this.setEventedParent(null),u&&this.dispatcher.broadcast("RM",void 0),this.dispatcher.remove(u)}_clearSource(u){this.sourceCaches[u].clearTiles()}_reloadSource(u){this.sourceCaches[u].resume(),this.sourceCaches[u].reload()}_updateSources(u){for(const m in this.sourceCaches)this.sourceCaches[m].update(u,this.map.terrain)}_generateCollisionBoxes(){for(const u in this.sourceCaches)this._reloadSource(u)}_updatePlacement(u,m,w,M,R=!1){let N=!1,H=!1;const j={};for(const Y of this._order){const K=this._layers[Y];if(K.type!=="symbol")continue;if(!j[K.source]){const re=this.sourceCaches[K.source];j[K.source]=re.getRenderableIds(!0).map((ue=>re.getTileByID(ue))).sort(((ue,pe)=>pe.tileID.overscaledZ-ue.tileID.overscaledZ||(ue.tileID.isLessThan(pe.tileID)?-1:1)))}const ie=this.crossTileSymbolIndex.addLayer(K,j[K.source],u.center.lng);N=N||ie}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((R=R||this._layerOrderChanged||w===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(y.now(),u.zoom))&&(this.pauseablePlacement=new tv(u,this.map.terrain,this._order,R,m,w,M,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,j),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(y.now()),H=!0),N&&this.pauseablePlacement.placement.setStale()),H||N)for(const Y of this._order){const K=this._layers[Y];K.type==="symbol"&&this.placement.updateLayerOpacities(K,j[K.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(y.now())}_releaseSymbolFadeTiles(){for(const u in this.sourceCaches)this.sourceCaches[u].releaseSymbolFadeTiles()}getImages(u,m){return o._(this,void 0,void 0,(function*(){const w=yield this.imageManager.getImages(m.icons);this._updateTilesForChangedImages();const M=this.sourceCaches[m.source];return M&&M.setDependencies(m.tileID.key,m.type,m.icons),w}))}getGlyphs(u,m){return o._(this,void 0,void 0,(function*(){const w=yield this.glyphManager.getGlyphs(m.stacks),M=this.sourceCaches[m.source];return M&&M.setDependencies(m.tileID.key,m.type,[""]),w}))}getGlyphsUrl(){return this.stylesheet.glyphs||null}setGlyphs(u,m={}){this._checkLoaded(),u&&this._validate(o.z.glyphs,"glyphs",u,null,m)||(this._glyphsDidChange=!0,this.stylesheet.glyphs=u,this.glyphManager.entries={},this.glyphManager.setURL(u))}getDashes(u,m){return o._(this,void 0,void 0,(function*(){const w={};for(const[M,R]of Object.entries(m.dashes))w[M]=this.lineAtlas.getDash(R.dasharray,R.round);return w}))}addSprite(u,m,w={},M){this._checkLoaded();const R=[{id:u,url:m}],N=[...$(this.stylesheet.sprite),...R];this._validate(o.z.sprite,"sprite",N,null,w)||(this.stylesheet.sprite=N,this._loadSprite(R,!0,M))}removeSprite(u){this._checkLoaded();const m=$(this.stylesheet.sprite);if(m.find((w=>w.id===u))){if(this._spritesImagesIds[u])for(const w of this._spritesImagesIds[u])this.imageManager.removeImage(w),this._changedImages[w]=!0;m.splice(m.findIndex((w=>w.id===u)),1),this.stylesheet.sprite=m.length>0?m:void 0,delete this._spritesImagesIds[u],this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new o.l("data",{dataType:"style"}))}else this.fire(new o.k(new Error(`Sprite "${u}" doesn't exists on this map.`)))}getSprite(){return $(this.stylesheet.sprite)}setSprite(u,m={},w){this._checkLoaded(),u&&this._validate(o.z.sprite,"sprite",u,null,m)||(this.stylesheet.sprite=u,u?this._loadSprite(u,!0,w):(this._unloadSprite(),w&&w(null)))}}var Cb=o.aJ([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class Sp{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(u,m,w,M,R,N,H,j,Y){this.context=u;let K=this.boundPaintVertexBuffers.length!==M.length;for(let ie=0;!K&&ie<M.length;ie++)this.boundPaintVertexBuffers[ie]!==M[ie]&&(K=!0);!this.vao||this.boundProgram!==m||this.boundLayoutVertexBuffer!==w||K||this.boundIndexBuffer!==R||this.boundVertexOffset!==N||this.boundDynamicVertexBuffer!==H||this.boundDynamicVertexBuffer2!==j||this.boundDynamicVertexBuffer3!==Y?this.freshBind(m,w,M,R,N,H,j,Y):(u.bindVertexArray.set(this.vao),H&&H.bind(),R&&R.dynamicDraw&&R.bind(),j&&j.bind(),Y&&Y.bind())}freshBind(u,m,w,M,R,N,H,j){const Y=u.numAttributes,K=this.context,ie=K.gl;this.vao&&this.destroy(),this.vao=K.createVertexArray(),K.bindVertexArray.set(this.vao),this.boundProgram=u,this.boundLayoutVertexBuffer=m,this.boundPaintVertexBuffers=w,this.boundIndexBuffer=M,this.boundVertexOffset=R,this.boundDynamicVertexBuffer=N,this.boundDynamicVertexBuffer2=H,this.boundDynamicVertexBuffer3=j,m.enableAttributes(ie,u);for(const re of w)re.enableAttributes(ie,u);N&&N.enableAttributes(ie,u),H&&H.enableAttributes(ie,u),j&&j.enableAttributes(ie,u),m.bind(),m.setVertexAttribPointers(ie,u,R);for(const re of w)re.bind(),re.setVertexAttribPointers(ie,u,R);N&&(N.bind(),N.setVertexAttribPointers(ie,u,R)),M&&M.bind(),H&&(H.bind(),H.setVertexAttribPointers(ie,u,R)),j&&(j.bind(),j.setVertexAttribPointers(ie,u,R)),K.currentNumAttributes=Y}destroy(){this.vao&&(this.context.deleteVertexArray(this.vao),this.vao=null)}}const av=(I,u,m,w,M)=>({u_texture:0,u_ele_delta:I,u_fog_matrix:u,u_fog_color:m?m.properties.get("fog-color"):o.bf.white,u_fog_ground_blend:m?m.properties.get("fog-ground-blend"):1,u_fog_ground_blend_opacity:M?0:m?m.calculateFogBlendOpacity(w):0,u_horizon_color:m?m.properties.get("horizon-color"):o.bf.white,u_horizon_fog_blend:m?m.properties.get("horizon-fog-blend"):1,u_is_globe_mode:M?1:0}),Tp={mainMatrix:"u_projection_matrix",tileMercatorCoords:"u_projection_tile_mercator_coords",clippingPlane:"u_projection_clipping_plane",projectionTransition:"u_projection_transition",fallbackMatrix:"u_projection_fallback_matrix"};function Uh(I){const u=[];for(let m=0;m<I.length;m++){if(I[m]===null)continue;const w=I[m].split(" ");u.push(w.pop())}return u}class ov{constructor(u,m,w,M,R,N,H,j,Y=[]){const K=u.gl;this.program=K.createProgram();const ie=Uh(m.staticAttributes),re=w?w.getBinderAttributes():[],ue=ie.concat(re),pe=Ba.prelude.staticUniforms?Uh(Ba.prelude.staticUniforms):[],Se=H.staticUniforms?Uh(H.staticUniforms):[],Te=m.staticUniforms?Uh(m.staticUniforms):[],Ce=w?w.getBinderUniforms():[],Ie=pe.concat(Se).concat(Te).concat(Ce),ke=[];for(const at of Ie)ke.indexOf(at)<0&&ke.push(at);const Re=w?w.defines():[];Dn(K)&&Re.unshift("#version 300 es"),R&&Re.push("#define OVERDRAW_INSPECTOR;"),N&&Re.push("#define TERRAIN3D;"),j&&Re.push(j),Y&&Re.push(...Y);let ze=Re.concat(Ba.prelude.fragmentSource,H.fragmentSource,m.fragmentSource).join(`
`),He=Re.concat(Ba.prelude.vertexSource,H.vertexSource,m.vertexSource).join(`
`);Dn(K)||(ze=(function(at){return at.replace(/\bin\s/g,"varying ").replace("out highp vec4 fragColor;","").replace(/fragColor/g,"gl_FragColor").replace(/texture\(/g,"texture2D(")})(ze),He=(function(at){return at.replace(/\bin\s/g,"attribute ").replace(/\bout\s/g,"varying ").replace(/texture\(/g,"texture2D(")})(He));const Le=K.createShader(K.FRAGMENT_SHADER);if(K.isContextLost())return void(this.failedToCreate=!0);if(K.shaderSource(Le,ze),K.compileShader(Le),!K.getShaderParameter(Le,K.COMPILE_STATUS))throw new Error(`Could not compile fragment shader: ${K.getShaderInfoLog(Le)}`);K.attachShader(this.program,Le);const Xe=K.createShader(K.VERTEX_SHADER);if(K.isContextLost())return void(this.failedToCreate=!0);if(K.shaderSource(Xe,He),K.compileShader(Xe),!K.getShaderParameter(Xe,K.COMPILE_STATUS))throw new Error(`Could not compile vertex shader: ${K.getShaderInfoLog(Xe)}`);K.attachShader(this.program,Xe),this.attributes={};const ht={};this.numAttributes=ue.length;for(let at=0;at<this.numAttributes;at++)ue[at]&&(K.bindAttribLocation(this.program,at,ue[at]),this.attributes[ue[at]]=at);if(K.linkProgram(this.program),!K.getProgramParameter(this.program,K.LINK_STATUS))throw new Error(`Program failed to link: ${K.getProgramInfoLog(this.program)}`);K.deleteShader(Xe),K.deleteShader(Le);for(let at=0;at<ke.length;at++){const st=ke[at];if(st&&!ht[st]){const lt=K.getUniformLocation(this.program,st);lt&&(ht[st]=lt)}}this.fixedUniforms=M(u,ht),this.terrainUniforms=((at,st)=>({u_depth:new o.bQ(at,st.u_depth),u_terrain:new o.bQ(at,st.u_terrain),u_terrain_dim:new o.bg(at,st.u_terrain_dim),u_terrain_matrix:new o.bS(at,st.u_terrain_matrix),u_terrain_unpack:new o.bT(at,st.u_terrain_unpack),u_terrain_exaggeration:new o.bg(at,st.u_terrain_exaggeration)}))(u,ht),this.projectionUniforms=((at,st)=>({u_projection_matrix:new o.bS(at,st.u_projection_matrix),u_projection_tile_mercator_coords:new o.bT(at,st.u_projection_tile_mercator_coords),u_projection_clipping_plane:new o.bT(at,st.u_projection_clipping_plane),u_projection_transition:new o.bg(at,st.u_projection_transition),u_projection_fallback_matrix:new o.bS(at,st.u_projection_fallback_matrix)}))(u,ht),this.binderUniforms=w?w.getUniforms(u,ht):[]}draw(u,m,w,M,R,N,H,j,Y,K,ie,re,ue,pe,Se,Te,Ce,Ie,ke){const Re=u.gl;if(this.failedToCreate)return;if(u.program.set(this.program),u.setDepthMode(w),u.setStencilMode(M),u.setColorMode(R),u.setCullFace(N),j){u.activeTexture.set(Re.TEXTURE2),Re.bindTexture(Re.TEXTURE_2D,j.depthTexture),u.activeTexture.set(Re.TEXTURE3),Re.bindTexture(Re.TEXTURE_2D,j.texture);for(const He in this.terrainUniforms)this.terrainUniforms[He].set(j[He])}if(Y)for(const He in Y)this.projectionUniforms[Tp[He]].set(Y[He]);if(H)for(const He in this.fixedUniforms)this.fixedUniforms[He].set(H[He]);Te&&Te.setUniforms(u,this.binderUniforms,pe,{zoom:Se});let ze=0;switch(m){case Re.LINES:ze=2;break;case Re.TRIANGLES:ze=3;break;case Re.LINE_STRIP:ze=1}for(const He of ue.get()){const Le=He.vaos||(He.vaos={});(Le[K]||(Le[K]=new Sp)).bind(u,this,ie,Te?Te.getPaintVertexBuffers():[],re,He.vertexOffset,Ce,Ie,ke),Re.drawElements(m,He.primitiveLength*ze,Re.UNSIGNED_SHORT,He.primitiveOffset*ze*2)}}}function Oo(I,u,m){const w=1/o.aC(m,1,u.transform.tileZoom),M=Math.pow(2,m.tileID.overscaledZ),R=m.tileSize*Math.pow(2,u.transform.tileZoom)/M,N=R*(m.tileID.canonical.x+m.tileID.wrap*M),H=R*m.tileID.canonical.y;return{u_image:0,u_texsize:m.imageAtlasTexture.size,u_scale:[w,I.fromScale,I.toScale],u_fade:I.t,u_pixel_coord_upper:[N>>16,H>>16],u_pixel_coord_lower:[65535&N,65535&H]}}const Hh=(I,u,m,w)=>{const M=I.style.light,R=M.properties.get("position"),N=[R.x,R.y,R.z],H=o.bW();M.properties.get("anchor")==="viewport"&&o.bX(H,I.transform.bearingInRadians),o.bY(N,N,H);const j=I.transform.transformLightDirection(N),Y=M.properties.get("color");return{u_lightpos:N,u_lightpos_globe:j,u_lightintensity:M.properties.get("intensity"),u_lightcolor:[Y.r,Y.g,Y.b],u_vertical_gradient:+u,u_opacity:m,u_fill_translate:w}},sv=(I,u,m,w,M,R,N)=>o.e(Hh(I,u,m,w),Oo(R,I,N),{u_height_factor:-Math.pow(2,M.overscaledZ)/N.tileSize/8}),zc=(I,u,m,w)=>o.e(Oo(u,I,m),{u_fill_translate:w}),jh=(I,u)=>({u_world:I,u_fill_translate:u}),Vy=(I,u,m,w,M)=>o.e(zc(I,u,m,M),{u_world:w}),td=(I,u,m,w,M)=>{const R=I.transform;let N,H,j=0;if(m.paint.get("circle-pitch-alignment")==="map"){const Y=o.aC(u,1,R.zoom);N=!0,H=[Y,Y],j=Y/(o.$*Math.pow(2,u.tileID.overscaledZ))*2*Math.PI*M}else N=!1,H=R.pixelsToGLUnits;return{u_camera_to_center_distance:R.cameraToCenterDistance,u_scale_with_map:+(m.paint.get("circle-pitch-scale")==="map"),u_pitch_with_map:+N,u_device_pixel_ratio:I.pixelRatio,u_extrude_scale:H,u_globe_extrude_scale:j,u_translate:w}},Uy=I=>({u_pixel_extrude_scale:[1/I.width,1/I.height]}),zs=I=>({u_viewport_size:[I.width,I.height]}),Hy=(I,u=1)=>({u_color:I,u_overlay:0,u_overlay_scale:u}),lv=(I,u,m,w)=>{const M=o.aC(I,1,u)/(o.$*Math.pow(2,I.tileID.overscaledZ))*2*Math.PI*w;return{u_extrude_scale:o.aC(I,1,u),u_intensity:m,u_globe_extrude_scale:M}},jy=(I,u,m,w)=>{const M=o.L();o.bZ(M,0,I.width,I.height,0,0,1);const R=I.context.gl;return{u_matrix:M,u_world:[R.drawingBufferWidth,R.drawingBufferHeight],u_image:m,u_color_ramp:w,u_opacity:u.paint.get("heatmap-opacity")}},uv=(I,u,m)=>{const w=m.paint.get("hillshade-accent-color");let M;switch(m.paint.get("hillshade-method")){case"basic":M=4;break;case"combined":M=1;break;case"igor":M=2;break;case"multidirectional":M=3;break;default:M=0}const R=m.getIlluminationProperties();for(let N=0;N<R.directionRadians.length;N++)m.paint.get("hillshade-illumination-anchor")==="viewport"&&(R.directionRadians[N]+=I.transform.bearingInRadians);return{u_image:0,u_latrange:$h(0,u.tileID),u_exaggeration:m.paint.get("hillshade-exaggeration"),u_altitudes:R.altitudeRadians,u_azimuths:R.directionRadians,u_accent:w,u_method:M,u_highlights:R.highlightColor,u_shadows:R.shadowColor}},Ap=(I,u)=>{const m=u.stride,w=o.L();return o.bZ(w,0,o.$,-o.$,0,0,1),o.M(w,w,[0,-o.$,0]),{u_matrix:w,u_image:1,u_dimension:[m,m],u_zoom:I.overscaledZ,u_unpack:u.getUnpackVector()}};function $h(I,u){const m=Math.pow(2,u.canonical.z),w=u.canonical.y;return[new o.a1(0,w/m).toLngLat().lat,new o.a1(0,(w+1)/m).toLngLat().lat]}const Wh=(I,u,m=0)=>({u_image:0,u_unpack:u.getUnpackVector(),u_dimension:[u.stride,u.stride],u_elevation_stops:1,u_color_stops:4,u_color_ramp_size:m,u_opacity:I.paint.get("color-relief-opacity")}),rd=(I,u,m,w)=>{const M=I.transform;return{u_translation:hv(I,u,m),u_ratio:w/o.aC(u,1,M.zoom),u_device_pixel_ratio:I.pixelRatio,u_units_to_pixels:[1/M.pixelsToGLUnits[0],1/M.pixelsToGLUnits[1]]}},id=(I,u,m,w,M)=>o.e(rd(I,u,m,w),{u_image:0,u_image_height:M}),Iu=(I,u,m,w,M)=>{const R=I.transform,N=Ul(u,R);return{u_translation:hv(I,u,m),u_texsize:u.imageAtlasTexture.size,u_ratio:w/o.aC(u,1,R.zoom),u_device_pixel_ratio:I.pixelRatio,u_image:0,u_scale:[N,M.fromScale,M.toScale],u_fade:M.t,u_units_to_pixels:[1/R.pixelsToGLUnits[0],1/R.pixelsToGLUnits[1]]}},cv=(I,u,m,w,M)=>{const R=Ul(u,I.transform);return o.e(rd(I,u,m,w),{u_tileratio:R,u_crossfade_from:M.fromScale,u_crossfade_to:M.toScale,u_image:0,u_mix:M.t,u_lineatlas_width:I.lineAtlas.width,u_lineatlas_height:I.lineAtlas.height})},Cp=(I,u,m,w,M,R)=>{const N=Ul(u,I.transform);return o.e(rd(I,u,m,w),{u_image:0,u_image_height:R,u_tileratio:N,u_crossfade_from:M.fromScale,u_crossfade_to:M.toScale,u_image_dash:1,u_mix:M.t,u_lineatlas_width:I.lineAtlas.width,u_lineatlas_height:I.lineAtlas.height})};function Ul(I,u){return 1/o.aC(I,1,u.tileZoom)}function hv(I,u,m){return o.aD(I.transform,u,m.paint.get("line-translate"),m.paint.get("line-translate-anchor"))}const nd=(I,u,m,w,M)=>{return{u_tl_parent:I,u_scale_parent:u,u_buffer_scale:1,u_fade_t:m.mix,u_opacity:m.opacity*w.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:w.paint.get("raster-brightness-min"),u_brightness_high:w.paint.get("raster-brightness-max"),u_saturation_factor:(N=w.paint.get("raster-saturation"),N>0?1-1/(1.001-N):-N),u_contrast_factor:(R=w.paint.get("raster-contrast"),R>0?1/(1-R):1+R),u_spin_weights:$y(w.paint.get("raster-hue-rotate")),u_coords_top:[M[0].x,M[0].y,M[1].x,M[1].y],u_coords_bottom:[M[3].x,M[3].y,M[2].x,M[2].y]};var R,N};function $y(I){I*=Math.PI/180;const u=Math.sin(I),m=Math.cos(I);return[(2*m+1)/3,(-Math.sqrt(3)*u-m+1)/3,(Math.sqrt(3)*u-m+1)/3]}const Wy=(I,u,m,w,M,R,N,H,j,Y,K,ie,re)=>{const ue=N.transform;return{u_is_size_zoom_constant:+(I==="constant"||I==="source"),u_is_size_feature_constant:+(I==="constant"||I==="camera"),u_size_t:u?u.uSizeT:0,u_size:u?u.uSize:0,u_camera_to_center_distance:ue.cameraToCenterDistance,u_pitch:ue.pitch/360*2*Math.PI,u_rotate_symbol:+m,u_aspect_ratio:ue.width/ue.height,u_fade_change:N.options.fadeDuration?N.symbolFadeChange:1,u_label_plane_matrix:H,u_coord_matrix:j,u_is_text:+K,u_pitch_with_map:+w,u_is_along_line:M,u_is_variable_anchor:R,u_texsize:ie,u_texture:0,u_translation:Y,u_pitched_scale:re}},fv=(I,u,m,w,M,R,N,H,j,Y,K,ie,re,ue)=>{const pe=N.transform;return o.e(Wy(I,u,m,w,M,R,N,H,j,Y,K,ie,ue),{u_gamma_scale:w?Math.cos(pe.pitch*Math.PI/180)*pe.cameraToCenterDistance:1,u_device_pixel_ratio:N.pixelRatio,u_is_halo:1})},Gy=(I,u,m,w,M,R,N,H,j,Y,K,ie,re)=>o.e(fv(I,u,m,w,M,R,N,H,j,Y,!0,K,0,re),{u_texsize_icon:ie,u_texture_icon:1}),Xy=(I,u)=>({u_opacity:I,u_color:u}),dv=(I,u,m,w,M)=>o.e((function(R,N,H,j){const Y=H.imageManager.getPattern(R.from.toString()),K=H.imageManager.getPattern(R.to.toString()),{width:ie,height:re}=H.imageManager.getPixelSize(),ue=Math.pow(2,j.tileID.overscaledZ),pe=j.tileSize*Math.pow(2,H.transform.tileZoom)/ue,Se=pe*(j.tileID.canonical.x+j.tileID.wrap*ue),Te=pe*j.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:Y.tl,u_pattern_br_a:Y.br,u_pattern_tl_b:K.tl,u_pattern_br_b:K.br,u_texsize:[ie,re],u_mix:N.t,u_pattern_size_a:Y.displaySize,u_pattern_size_b:K.displaySize,u_scale_a:N.fromScale,u_scale_b:N.toScale,u_tile_units_to_pixels:1/o.aC(j,1,H.transform.tileZoom),u_pixel_coord_upper:[Se>>16,Te>>16],u_pixel_coord_lower:[65535&Se,65535&Te]}})(m,M,u,w),{u_opacity:I}),Ja=(I,u)=>{},Pu={fillExtrusion:(I,u)=>({u_lightpos:new o.bU(I,u.u_lightpos),u_lightpos_globe:new o.bU(I,u.u_lightpos_globe),u_lightintensity:new o.bg(I,u.u_lightintensity),u_lightcolor:new o.bU(I,u.u_lightcolor),u_vertical_gradient:new o.bg(I,u.u_vertical_gradient),u_opacity:new o.bg(I,u.u_opacity),u_fill_translate:new o.bV(I,u.u_fill_translate)}),fillExtrusionPattern:(I,u)=>({u_lightpos:new o.bU(I,u.u_lightpos),u_lightpos_globe:new o.bU(I,u.u_lightpos_globe),u_lightintensity:new o.bg(I,u.u_lightintensity),u_lightcolor:new o.bU(I,u.u_lightcolor),u_vertical_gradient:new o.bg(I,u.u_vertical_gradient),u_height_factor:new o.bg(I,u.u_height_factor),u_opacity:new o.bg(I,u.u_opacity),u_fill_translate:new o.bV(I,u.u_fill_translate),u_image:new o.bQ(I,u.u_image),u_texsize:new o.bV(I,u.u_texsize),u_pixel_coord_upper:new o.bV(I,u.u_pixel_coord_upper),u_pixel_coord_lower:new o.bV(I,u.u_pixel_coord_lower),u_scale:new o.bU(I,u.u_scale),u_fade:new o.bg(I,u.u_fade)}),fill:(I,u)=>({u_fill_translate:new o.bV(I,u.u_fill_translate)}),fillPattern:(I,u)=>({u_image:new o.bQ(I,u.u_image),u_texsize:new o.bV(I,u.u_texsize),u_pixel_coord_upper:new o.bV(I,u.u_pixel_coord_upper),u_pixel_coord_lower:new o.bV(I,u.u_pixel_coord_lower),u_scale:new o.bU(I,u.u_scale),u_fade:new o.bg(I,u.u_fade),u_fill_translate:new o.bV(I,u.u_fill_translate)}),fillOutline:(I,u)=>({u_world:new o.bV(I,u.u_world),u_fill_translate:new o.bV(I,u.u_fill_translate)}),fillOutlinePattern:(I,u)=>({u_world:new o.bV(I,u.u_world),u_image:new o.bQ(I,u.u_image),u_texsize:new o.bV(I,u.u_texsize),u_pixel_coord_upper:new o.bV(I,u.u_pixel_coord_upper),u_pixel_coord_lower:new o.bV(I,u.u_pixel_coord_lower),u_scale:new o.bU(I,u.u_scale),u_fade:new o.bg(I,u.u_fade),u_fill_translate:new o.bV(I,u.u_fill_translate)}),circle:(I,u)=>({u_camera_to_center_distance:new o.bg(I,u.u_camera_to_center_distance),u_scale_with_map:new o.bQ(I,u.u_scale_with_map),u_pitch_with_map:new o.bQ(I,u.u_pitch_with_map),u_extrude_scale:new o.bV(I,u.u_extrude_scale),u_device_pixel_ratio:new o.bg(I,u.u_device_pixel_ratio),u_globe_extrude_scale:new o.bg(I,u.u_globe_extrude_scale),u_translate:new o.bV(I,u.u_translate)}),collisionBox:(I,u)=>({u_pixel_extrude_scale:new o.bV(I,u.u_pixel_extrude_scale)}),collisionCircle:(I,u)=>({u_viewport_size:new o.bV(I,u.u_viewport_size)}),debug:(I,u)=>({u_color:new o.bR(I,u.u_color),u_overlay:new o.bQ(I,u.u_overlay),u_overlay_scale:new o.bg(I,u.u_overlay_scale)}),depth:Ja,clippingMask:Ja,heatmap:(I,u)=>({u_extrude_scale:new o.bg(I,u.u_extrude_scale),u_intensity:new o.bg(I,u.u_intensity),u_globe_extrude_scale:new o.bg(I,u.u_globe_extrude_scale)}),heatmapTexture:(I,u)=>({u_matrix:new o.bS(I,u.u_matrix),u_world:new o.bV(I,u.u_world),u_image:new o.bQ(I,u.u_image),u_color_ramp:new o.bQ(I,u.u_color_ramp),u_opacity:new o.bg(I,u.u_opacity)}),hillshade:(I,u)=>({u_image:new o.bQ(I,u.u_image),u_latrange:new o.bV(I,u.u_latrange),u_exaggeration:new o.bg(I,u.u_exaggeration),u_altitudes:new o.b$(I,u.u_altitudes),u_azimuths:new o.b$(I,u.u_azimuths),u_accent:new o.bR(I,u.u_accent),u_method:new o.bQ(I,u.u_method),u_shadows:new o.b_(I,u.u_shadows),u_highlights:new o.b_(I,u.u_highlights)}),hillshadePrepare:(I,u)=>({u_matrix:new o.bS(I,u.u_matrix),u_image:new o.bQ(I,u.u_image),u_dimension:new o.bV(I,u.u_dimension),u_zoom:new o.bg(I,u.u_zoom),u_unpack:new o.bT(I,u.u_unpack)}),colorRelief:(I,u)=>({u_image:new o.bQ(I,u.u_image),u_unpack:new o.bT(I,u.u_unpack),u_dimension:new o.bV(I,u.u_dimension),u_elevation_stops:new o.bQ(I,u.u_elevation_stops),u_color_stops:new o.bQ(I,u.u_color_stops),u_color_ramp_size:new o.bQ(I,u.u_color_ramp_size),u_opacity:new o.bg(I,u.u_opacity)}),line:(I,u)=>({u_translation:new o.bV(I,u.u_translation),u_ratio:new o.bg(I,u.u_ratio),u_device_pixel_ratio:new o.bg(I,u.u_device_pixel_ratio),u_units_to_pixels:new o.bV(I,u.u_units_to_pixels)}),lineGradient:(I,u)=>({u_translation:new o.bV(I,u.u_translation),u_ratio:new o.bg(I,u.u_ratio),u_device_pixel_ratio:new o.bg(I,u.u_device_pixel_ratio),u_units_to_pixels:new o.bV(I,u.u_units_to_pixels),u_image:new o.bQ(I,u.u_image),u_image_height:new o.bg(I,u.u_image_height)}),linePattern:(I,u)=>({u_translation:new o.bV(I,u.u_translation),u_texsize:new o.bV(I,u.u_texsize),u_ratio:new o.bg(I,u.u_ratio),u_device_pixel_ratio:new o.bg(I,u.u_device_pixel_ratio),u_image:new o.bQ(I,u.u_image),u_units_to_pixels:new o.bV(I,u.u_units_to_pixels),u_scale:new o.bU(I,u.u_scale),u_fade:new o.bg(I,u.u_fade)}),lineSDF:(I,u)=>({u_translation:new o.bV(I,u.u_translation),u_ratio:new o.bg(I,u.u_ratio),u_device_pixel_ratio:new o.bg(I,u.u_device_pixel_ratio),u_units_to_pixels:new o.bV(I,u.u_units_to_pixels),u_image:new o.bQ(I,u.u_image),u_mix:new o.bg(I,u.u_mix),u_tileratio:new o.bg(I,u.u_tileratio),u_crossfade_from:new o.bg(I,u.u_crossfade_from),u_crossfade_to:new o.bg(I,u.u_crossfade_to),u_lineatlas_width:new o.bg(I,u.u_lineatlas_width),u_lineatlas_height:new o.bg(I,u.u_lineatlas_height)}),lineGradientSDF:(I,u)=>({u_translation:new o.bV(I,u.u_translation),u_ratio:new o.bg(I,u.u_ratio),u_device_pixel_ratio:new o.bg(I,u.u_device_pixel_ratio),u_units_to_pixels:new o.bV(I,u.u_units_to_pixels),u_image:new o.bQ(I,u.u_image),u_image_height:new o.bg(I,u.u_image_height),u_tileratio:new o.bg(I,u.u_tileratio),u_crossfade_from:new o.bg(I,u.u_crossfade_from),u_crossfade_to:new o.bg(I,u.u_crossfade_to),u_image_dash:new o.bQ(I,u.u_image_dash),u_mix:new o.bg(I,u.u_mix),u_lineatlas_width:new o.bg(I,u.u_lineatlas_width),u_lineatlas_height:new o.bg(I,u.u_lineatlas_height)}),raster:(I,u)=>({u_tl_parent:new o.bV(I,u.u_tl_parent),u_scale_parent:new o.bg(I,u.u_scale_parent),u_buffer_scale:new o.bg(I,u.u_buffer_scale),u_fade_t:new o.bg(I,u.u_fade_t),u_opacity:new o.bg(I,u.u_opacity),u_image0:new o.bQ(I,u.u_image0),u_image1:new o.bQ(I,u.u_image1),u_brightness_low:new o.bg(I,u.u_brightness_low),u_brightness_high:new o.bg(I,u.u_brightness_high),u_saturation_factor:new o.bg(I,u.u_saturation_factor),u_contrast_factor:new o.bg(I,u.u_contrast_factor),u_spin_weights:new o.bU(I,u.u_spin_weights),u_coords_top:new o.bT(I,u.u_coords_top),u_coords_bottom:new o.bT(I,u.u_coords_bottom)}),symbolIcon:(I,u)=>({u_is_size_zoom_constant:new o.bQ(I,u.u_is_size_zoom_constant),u_is_size_feature_constant:new o.bQ(I,u.u_is_size_feature_constant),u_size_t:new o.bg(I,u.u_size_t),u_size:new o.bg(I,u.u_size),u_camera_to_center_distance:new o.bg(I,u.u_camera_to_center_distance),u_pitch:new o.bg(I,u.u_pitch),u_rotate_symbol:new o.bQ(I,u.u_rotate_symbol),u_aspect_ratio:new o.bg(I,u.u_aspect_ratio),u_fade_change:new o.bg(I,u.u_fade_change),u_label_plane_matrix:new o.bS(I,u.u_label_plane_matrix),u_coord_matrix:new o.bS(I,u.u_coord_matrix),u_is_text:new o.bQ(I,u.u_is_text),u_pitch_with_map:new o.bQ(I,u.u_pitch_with_map),u_is_along_line:new o.bQ(I,u.u_is_along_line),u_is_variable_anchor:new o.bQ(I,u.u_is_variable_anchor),u_texsize:new o.bV(I,u.u_texsize),u_texture:new o.bQ(I,u.u_texture),u_translation:new o.bV(I,u.u_translation),u_pitched_scale:new o.bg(I,u.u_pitched_scale)}),symbolSDF:(I,u)=>({u_is_size_zoom_constant:new o.bQ(I,u.u_is_size_zoom_constant),u_is_size_feature_constant:new o.bQ(I,u.u_is_size_feature_constant),u_size_t:new o.bg(I,u.u_size_t),u_size:new o.bg(I,u.u_size),u_camera_to_center_distance:new o.bg(I,u.u_camera_to_center_distance),u_pitch:new o.bg(I,u.u_pitch),u_rotate_symbol:new o.bQ(I,u.u_rotate_symbol),u_aspect_ratio:new o.bg(I,u.u_aspect_ratio),u_fade_change:new o.bg(I,u.u_fade_change),u_label_plane_matrix:new o.bS(I,u.u_label_plane_matrix),u_coord_matrix:new o.bS(I,u.u_coord_matrix),u_is_text:new o.bQ(I,u.u_is_text),u_pitch_with_map:new o.bQ(I,u.u_pitch_with_map),u_is_along_line:new o.bQ(I,u.u_is_along_line),u_is_variable_anchor:new o.bQ(I,u.u_is_variable_anchor),u_texsize:new o.bV(I,u.u_texsize),u_texture:new o.bQ(I,u.u_texture),u_gamma_scale:new o.bg(I,u.u_gamma_scale),u_device_pixel_ratio:new o.bg(I,u.u_device_pixel_ratio),u_is_halo:new o.bQ(I,u.u_is_halo),u_translation:new o.bV(I,u.u_translation),u_pitched_scale:new o.bg(I,u.u_pitched_scale)}),symbolTextAndIcon:(I,u)=>({u_is_size_zoom_constant:new o.bQ(I,u.u_is_size_zoom_constant),u_is_size_feature_constant:new o.bQ(I,u.u_is_size_feature_constant),u_size_t:new o.bg(I,u.u_size_t),u_size:new o.bg(I,u.u_size),u_camera_to_center_distance:new o.bg(I,u.u_camera_to_center_distance),u_pitch:new o.bg(I,u.u_pitch),u_rotate_symbol:new o.bQ(I,u.u_rotate_symbol),u_aspect_ratio:new o.bg(I,u.u_aspect_ratio),u_fade_change:new o.bg(I,u.u_fade_change),u_label_plane_matrix:new o.bS(I,u.u_label_plane_matrix),u_coord_matrix:new o.bS(I,u.u_coord_matrix),u_is_text:new o.bQ(I,u.u_is_text),u_pitch_with_map:new o.bQ(I,u.u_pitch_with_map),u_is_along_line:new o.bQ(I,u.u_is_along_line),u_is_variable_anchor:new o.bQ(I,u.u_is_variable_anchor),u_texsize:new o.bV(I,u.u_texsize),u_texsize_icon:new o.bV(I,u.u_texsize_icon),u_texture:new o.bQ(I,u.u_texture),u_texture_icon:new o.bQ(I,u.u_texture_icon),u_gamma_scale:new o.bg(I,u.u_gamma_scale),u_device_pixel_ratio:new o.bg(I,u.u_device_pixel_ratio),u_is_halo:new o.bQ(I,u.u_is_halo),u_translation:new o.bV(I,u.u_translation),u_pitched_scale:new o.bg(I,u.u_pitched_scale)}),background:(I,u)=>({u_opacity:new o.bg(I,u.u_opacity),u_color:new o.bR(I,u.u_color)}),backgroundPattern:(I,u)=>({u_opacity:new o.bg(I,u.u_opacity),u_image:new o.bQ(I,u.u_image),u_pattern_tl_a:new o.bV(I,u.u_pattern_tl_a),u_pattern_br_a:new o.bV(I,u.u_pattern_br_a),u_pattern_tl_b:new o.bV(I,u.u_pattern_tl_b),u_pattern_br_b:new o.bV(I,u.u_pattern_br_b),u_texsize:new o.bV(I,u.u_texsize),u_mix:new o.bg(I,u.u_mix),u_pattern_size_a:new o.bV(I,u.u_pattern_size_a),u_pattern_size_b:new o.bV(I,u.u_pattern_size_b),u_scale_a:new o.bg(I,u.u_scale_a),u_scale_b:new o.bg(I,u.u_scale_b),u_pixel_coord_upper:new o.bV(I,u.u_pixel_coord_upper),u_pixel_coord_lower:new o.bV(I,u.u_pixel_coord_lower),u_tile_units_to_pixels:new o.bg(I,u.u_tile_units_to_pixels)}),terrain:(I,u)=>({u_texture:new o.bQ(I,u.u_texture),u_ele_delta:new o.bg(I,u.u_ele_delta),u_fog_matrix:new o.bS(I,u.u_fog_matrix),u_fog_color:new o.bR(I,u.u_fog_color),u_fog_ground_blend:new o.bg(I,u.u_fog_ground_blend),u_fog_ground_blend_opacity:new o.bg(I,u.u_fog_ground_blend_opacity),u_horizon_color:new o.bR(I,u.u_horizon_color),u_horizon_fog_blend:new o.bg(I,u.u_horizon_fog_blend),u_is_globe_mode:new o.bg(I,u.u_is_globe_mode)}),terrainDepth:(I,u)=>({u_ele_delta:new o.bg(I,u.u_ele_delta)}),terrainCoords:(I,u)=>({u_texture:new o.bQ(I,u.u_texture),u_terrain_coords_id:new o.bg(I,u.u_terrain_coords_id),u_ele_delta:new o.bg(I,u.u_ele_delta)}),projectionErrorMeasurement:(I,u)=>({u_input:new o.bg(I,u.u_input),u_output_expected:new o.bg(I,u.u_output_expected)}),atmosphere:(I,u)=>({u_sun_pos:new o.bU(I,u.u_sun_pos),u_atmosphere_blend:new o.bg(I,u.u_atmosphere_blend),u_globe_position:new o.bU(I,u.u_globe_position),u_globe_radius:new o.bg(I,u.u_globe_radius),u_inv_proj_matrix:new o.bS(I,u.u_inv_proj_matrix)}),sky:(I,u)=>({u_sky_color:new o.bR(I,u.u_sky_color),u_horizon_color:new o.bR(I,u.u_horizon_color),u_horizon:new o.bV(I,u.u_horizon),u_horizon_normal:new o.bV(I,u.u_horizon_normal),u_sky_horizon_blend:new o.bg(I,u.u_sky_horizon_blend),u_sky_blend:new o.bg(I,u.u_sky_blend)})};class vl{constructor(u,m,w){this.context=u;const M=u.gl;this.buffer=M.createBuffer(),this.dynamicDraw=!!w,this.context.unbindVAO(),u.bindElementBuffer.set(this.buffer),M.bufferData(M.ELEMENT_ARRAY_BUFFER,m.arrayBuffer,this.dynamicDraw?M.DYNAMIC_DRAW:M.STATIC_DRAW),this.dynamicDraw||delete m.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(u){const m=this.context.gl;if(!this.dynamicDraw)throw new Error("Attempted to update data while not in dynamic mode.");this.context.unbindVAO(),this.bind(),m.bufferSubData(m.ELEMENT_ARRAY_BUFFER,0,u.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const Mp={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class Ep{constructor(u,m,w,M){this.length=m.length,this.attributes=w,this.itemSize=m.bytesPerElement,this.dynamicDraw=M,this.context=u;const R=u.gl;this.buffer=R.createBuffer(),u.bindVertexBuffer.set(this.buffer),R.bufferData(R.ARRAY_BUFFER,m.arrayBuffer,this.dynamicDraw?R.DYNAMIC_DRAW:R.STATIC_DRAW),this.dynamicDraw||delete m.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(u){if(u.length!==this.length)throw new Error(`Length of new data is ${u.length}, which doesn't match current length of ${this.length}`);const m=this.context.gl;this.bind(),m.bufferSubData(m.ARRAY_BUFFER,0,u.arrayBuffer)}enableAttributes(u,m){for(let w=0;w<this.attributes.length;w++){const M=m.attributes[this.attributes[w].name];M!==void 0&&u.enableVertexAttribArray(M)}}setVertexAttribPointers(u,m,w){for(let M=0;M<this.attributes.length;M++){const R=this.attributes[M],N=m.attributes[R.name];N!==void 0&&u.vertexAttribPointer(N,R.components,u[Mp[R.type]],!1,this.itemSize,R.offset+this.itemSize*(w||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class yi{constructor(u){this.gl=u.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(u){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class Ip extends yi{getDefault(){return o.bf.transparent}set(u){const m=this.current;(u.r!==m.r||u.g!==m.g||u.b!==m.b||u.a!==m.a||this.dirty)&&(this.gl.clearColor(u.r,u.g,u.b,u.a),this.current=u,this.dirty=!1)}}class pv extends yi{getDefault(){return 1}set(u){(u!==this.current||this.dirty)&&(this.gl.clearDepth(u),this.current=u,this.dirty=!1)}}class os extends yi{getDefault(){return 0}set(u){(u!==this.current||this.dirty)&&(this.gl.clearStencil(u),this.current=u,this.dirty=!1)}}class ad extends yi{getDefault(){return[!0,!0,!0,!0]}set(u){const m=this.current;(u[0]!==m[0]||u[1]!==m[1]||u[2]!==m[2]||u[3]!==m[3]||this.dirty)&&(this.gl.colorMask(u[0],u[1],u[2],u[3]),this.current=u,this.dirty=!1)}}class od extends yi{getDefault(){return!0}set(u){(u!==this.current||this.dirty)&&(this.gl.depthMask(u),this.current=u,this.dirty=!1)}}class gv extends yi{getDefault(){return 255}set(u){(u!==this.current||this.dirty)&&(this.gl.stencilMask(u),this.current=u,this.dirty=!1)}}class Zy extends yi{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(u){const m=this.current;(u.func!==m.func||u.ref!==m.ref||u.mask!==m.mask||this.dirty)&&(this.gl.stencilFunc(u.func,u.ref,u.mask),this.current=u,this.dirty=!1)}}class Fc extends yi{getDefault(){const u=this.gl;return[u.KEEP,u.KEEP,u.KEEP]}set(u){const m=this.current;(u[0]!==m[0]||u[1]!==m[1]||u[2]!==m[2]||this.dirty)&&(this.gl.stencilOp(u[0],u[1],u[2]),this.current=u,this.dirty=!1)}}class Vc extends yi{getDefault(){return!1}set(u){if(u===this.current&&!this.dirty)return;const m=this.gl;u?m.enable(m.STENCIL_TEST):m.disable(m.STENCIL_TEST),this.current=u,this.dirty=!1}}class vv extends yi{getDefault(){return[0,1]}set(u){const m=this.current;(u[0]!==m[0]||u[1]!==m[1]||this.dirty)&&(this.gl.depthRange(u[0],u[1]),this.current=u,this.dirty=!1)}}class mv extends yi{getDefault(){return!1}set(u){if(u===this.current&&!this.dirty)return;const m=this.gl;u?m.enable(m.DEPTH_TEST):m.disable(m.DEPTH_TEST),this.current=u,this.dirty=!1}}class ml extends yi{getDefault(){return this.gl.LESS}set(u){(u!==this.current||this.dirty)&&(this.gl.depthFunc(u),this.current=u,this.dirty=!1)}}class sd extends yi{getDefault(){return!1}set(u){if(u===this.current&&!this.dirty)return;const m=this.gl;u?m.enable(m.BLEND):m.disable(m.BLEND),this.current=u,this.dirty=!1}}class ld extends yi{getDefault(){const u=this.gl;return[u.ONE,u.ZERO]}set(u){const m=this.current;(u[0]!==m[0]||u[1]!==m[1]||this.dirty)&&(this.gl.blendFunc(u[0],u[1]),this.current=u,this.dirty=!1)}}class Pp extends yi{getDefault(){return o.bf.transparent}set(u){const m=this.current;(u.r!==m.r||u.g!==m.g||u.b!==m.b||u.a!==m.a||this.dirty)&&(this.gl.blendColor(u.r,u.g,u.b,u.a),this.current=u,this.dirty=!1)}}class Uc extends yi{getDefault(){return this.gl.FUNC_ADD}set(u){(u!==this.current||this.dirty)&&(this.gl.blendEquation(u),this.current=u,this.dirty=!1)}}class ud extends yi{getDefault(){return!1}set(u){if(u===this.current&&!this.dirty)return;const m=this.gl;u?m.enable(m.CULL_FACE):m.disable(m.CULL_FACE),this.current=u,this.dirty=!1}}class Gh extends yi{getDefault(){return this.gl.BACK}set(u){(u!==this.current||this.dirty)&&(this.gl.cullFace(u),this.current=u,this.dirty=!1)}}class No extends yi{getDefault(){return this.gl.CCW}set(u){(u!==this.current||this.dirty)&&(this.gl.frontFace(u),this.current=u,this.dirty=!1)}}class yv extends yi{getDefault(){return null}set(u){(u!==this.current||this.dirty)&&(this.gl.useProgram(u),this.current=u,this.dirty=!1)}}class Rp extends yi{getDefault(){return this.gl.TEXTURE0}set(u){(u!==this.current||this.dirty)&&(this.gl.activeTexture(u),this.current=u,this.dirty=!1)}}class Bo extends yi{getDefault(){const u=this.gl;return[0,0,u.drawingBufferWidth,u.drawingBufferHeight]}set(u){const m=this.current;(u[0]!==m[0]||u[1]!==m[1]||u[2]!==m[2]||u[3]!==m[3]||this.dirty)&&(this.gl.viewport(u[0],u[1],u[2],u[3]),this.current=u,this.dirty=!1)}}class yl extends yi{getDefault(){return null}set(u){if(u===this.current&&!this.dirty)return;const m=this.gl;m.bindFramebuffer(m.FRAMEBUFFER,u),this.current=u,this.dirty=!1}}class eo extends yi{getDefault(){return null}set(u){if(u===this.current&&!this.dirty)return;const m=this.gl;m.bindRenderbuffer(m.RENDERBUFFER,u),this.current=u,this.dirty=!1}}class Hl extends yi{getDefault(){return null}set(u){if(u===this.current&&!this.dirty)return;const m=this.gl;m.bindTexture(m.TEXTURE_2D,u),this.current=u,this.dirty=!1}}class Hc extends yi{getDefault(){return null}set(u){if(u===this.current&&!this.dirty)return;const m=this.gl;m.bindBuffer(m.ARRAY_BUFFER,u),this.current=u,this.dirty=!1}}class jc extends yi{getDefault(){return null}set(u){const m=this.gl;m.bindBuffer(m.ELEMENT_ARRAY_BUFFER,u),this.current=u,this.dirty=!1}}class cd extends yi{getDefault(){return null}set(u){var m;if(u===this.current&&!this.dirty)return;const w=this.gl;Dn(w)?w.bindVertexArray(u):(m=w.getExtension("OES_vertex_array_object"))===null||m===void 0||m.bindVertexArrayOES(u),this.current=u,this.dirty=!1}}class Ru extends yi{getDefault(){return 4}set(u){if(u===this.current&&!this.dirty)return;const m=this.gl;m.pixelStorei(m.UNPACK_ALIGNMENT,u),this.current=u,this.dirty=!1}}class ss extends yi{getDefault(){return!1}set(u){if(u===this.current&&!this.dirty)return;const m=this.gl;m.pixelStorei(m.UNPACK_PREMULTIPLY_ALPHA_WEBGL,u),this.current=u,this.dirty=!1}}class _v extends yi{getDefault(){return!1}set(u){if(u===this.current&&!this.dirty)return;const m=this.gl;m.pixelStorei(m.UNPACK_FLIP_Y_WEBGL,u),this.current=u,this.dirty=!1}}class Du extends yi{constructor(u,m){super(u),this.context=u,this.parent=m}getDefault(){return null}}class jr extends Du{setDirty(){this.dirty=!0}set(u){if(u===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const m=this.gl;m.framebufferTexture2D(m.FRAMEBUFFER,m.COLOR_ATTACHMENT0,m.TEXTURE_2D,u,0),this.current=u,this.dirty=!1}}class Dp extends Du{set(u){if(u===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const m=this.gl;m.framebufferRenderbuffer(m.FRAMEBUFFER,m.DEPTH_ATTACHMENT,m.RENDERBUFFER,u),this.current=u,this.dirty=!1}}class zo extends Du{set(u){if(u===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const m=this.gl;m.framebufferRenderbuffer(m.FRAMEBUFFER,m.DEPTH_STENCIL_ATTACHMENT,m.RENDERBUFFER,u),this.current=u,this.dirty=!1}}const hd="Framebuffer is not complete";class Fo{constructor(u,m,w,M,R){this.context=u,this.width=m,this.height=w;const N=u.gl,H=this.framebuffer=N.createFramebuffer();if(this.colorAttachment=new jr(u,H),M)this.depthAttachment=R?new zo(u,H):new Dp(u,H);else if(R)throw new Error("Stencil cannot be set without depth");if(N.checkFramebufferStatus(N.FRAMEBUFFER)!==N.FRAMEBUFFER_COMPLETE)throw new Error(hd)}destroy(){const u=this.context.gl,m=this.colorAttachment.get();if(m&&u.deleteTexture(m),this.depthAttachment){const w=this.depthAttachment.get();w&&u.deleteRenderbuffer(w)}u.deleteFramebuffer(this.framebuffer)}}class qy{constructor(u){var m,w;if(this.gl=u,this.clearColor=new Ip(this),this.clearDepth=new pv(this),this.clearStencil=new os(this),this.colorMask=new ad(this),this.depthMask=new od(this),this.stencilMask=new gv(this),this.stencilFunc=new Zy(this),this.stencilOp=new Fc(this),this.stencilTest=new Vc(this),this.depthRange=new vv(this),this.depthTest=new mv(this),this.depthFunc=new ml(this),this.blend=new sd(this),this.blendFunc=new ld(this),this.blendColor=new Pp(this),this.blendEquation=new Uc(this),this.cullFace=new ud(this),this.cullFaceSide=new Gh(this),this.frontFace=new No(this),this.program=new yv(this),this.activeTexture=new Rp(this),this.viewport=new Bo(this),this.bindFramebuffer=new yl(this),this.bindRenderbuffer=new eo(this),this.bindTexture=new Hl(this),this.bindVertexBuffer=new Hc(this),this.bindElementBuffer=new jc(this),this.bindVertexArray=new cd(this),this.pixelStoreUnpack=new Ru(this),this.pixelStoreUnpackPremultiplyAlpha=new ss(this),this.pixelStoreUnpackFlipY=new _v(this),this.extTextureFilterAnisotropic=u.getExtension("EXT_texture_filter_anisotropic")||u.getExtension("MOZ_EXT_texture_filter_anisotropic")||u.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=u.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.maxTextureSize=u.getParameter(u.MAX_TEXTURE_SIZE),Dn(u)){this.HALF_FLOAT=u.HALF_FLOAT;const M=u.getExtension("EXT_color_buffer_half_float");this.RGBA16F=(m=u.RGBA16F)!==null&&m!==void 0?m:M?.RGBA16F_EXT,this.RGB16F=(w=u.RGB16F)!==null&&w!==void 0?w:M?.RGB16F_EXT,u.getExtension("EXT_color_buffer_float")}else{u.getExtension("EXT_color_buffer_half_float"),u.getExtension("OES_texture_half_float_linear");const M=u.getExtension("OES_texture_half_float");this.HALF_FLOAT=M?.HALF_FLOAT_OES}}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArray.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(u,m){return new vl(this,u,m)}createVertexBuffer(u,m,w){return new Ep(this,u,m,w)}createRenderbuffer(u,m,w){const M=this.gl,R=M.createRenderbuffer();return this.bindRenderbuffer.set(R),M.renderbufferStorage(M.RENDERBUFFER,u,m,w),this.bindRenderbuffer.set(null),R}createFramebuffer(u,m,w,M){return new Fo(this,u,m,w,M)}clear({color:u,depth:m,stencil:w}){const M=this.gl;let R=0;u&&(R|=M.COLOR_BUFFER_BIT,this.clearColor.set(u),this.colorMask.set([!0,!0,!0,!0])),m!==void 0&&(R|=M.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(m),this.depthMask.set(!0)),w!==void 0&&(R|=M.STENCIL_BUFFER_BIT,this.clearStencil.set(w),this.stencilMask.set(255)),M.clear(R)}setCullFace(u){u.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(u.mode),this.frontFace.set(u.frontFace))}setDepthMode(u){u.func!==this.gl.ALWAYS||u.mask?(this.depthTest.set(!0),this.depthFunc.set(u.func),this.depthMask.set(u.mask),this.depthRange.set(u.range)):this.depthTest.set(!1)}setStencilMode(u){u.test.func!==this.gl.ALWAYS||u.mask?(this.stencilTest.set(!0),this.stencilMask.set(u.mask),this.stencilOp.set([u.fail,u.depthFail,u.pass]),this.stencilFunc.set({func:u.test.func,ref:u.ref,mask:u.test.mask})):this.stencilTest.set(!1)}setColorMode(u){o.bH(u.blendFunction,Di.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(u.blendFunction),this.blendColor.set(u.blendColor)),this.colorMask.set(u.mask)}createVertexArray(){var u;return Dn(this.gl)?this.gl.createVertexArray():(u=this.gl.getExtension("OES_vertex_array_object"))===null||u===void 0?void 0:u.createVertexArrayOES()}deleteVertexArray(u){var m;return Dn(this.gl)?this.gl.deleteVertexArray(u):(m=this.gl.getExtension("OES_vertex_array_object"))===null||m===void 0?void 0:m.deleteVertexArrayOES(u)}unbindVAO(){this.bindVertexArray.set(null)}}let $c;function jl(I,u,m,w,M){const R=I.context,N=I.transform,H=R.gl,j=I.useProgram("collisionBox"),Y=[];let K=0,ie=0;for(let Ce=0;Ce<w.length;Ce++){const Ie=w[Ce],ke=u.getTile(Ie).getBucket(m);if(!ke)continue;const Re=M?ke.textCollisionBox:ke.iconCollisionBox,ze=ke.collisionCircleArray;ze.length>0&&(Y.push({circleArray:ze,circleOffset:ie,coord:Ie}),K+=ze.length/4,ie=K),Re&&j.draw(R,H.LINES,Mr.disabled,Hr.disabled,I.colorModeForRenderPass(),Qr.disabled,Uy(I.transform),I.style.map.terrain&&I.style.map.terrain.getTerrainData(Ie),N.getProjectionData({overscaledTileID:Ie,applyGlobeMatrix:!0,applyTerrainMatrix:!0}),m.id,Re.layoutVertexBuffer,Re.indexBuffer,Re.segments,null,I.transform.zoom,null,null,Re.collisionVertexBuffer)}if(!M||!Y.length)return;const re=I.useProgram("collisionCircle"),ue=new o.c0;ue.resize(4*K),ue._trim();let pe=0;for(const Ce of Y)for(let Ie=0;Ie<Ce.circleArray.length/4;Ie++){const ke=4*Ie,Re=Ce.circleArray[ke+0],ze=Ce.circleArray[ke+1],He=Ce.circleArray[ke+2],Le=Ce.circleArray[ke+3];ue.emplace(pe++,Re,ze,He,Le,0),ue.emplace(pe++,Re,ze,He,Le,1),ue.emplace(pe++,Re,ze,He,Le,2),ue.emplace(pe++,Re,ze,He,Le,3)}(!$c||$c.length<2*K)&&($c=(function(Ce){const Ie=2*Ce,ke=new o.c2;ke.resize(Ie),ke._trim();for(let Re=0;Re<Ie;Re++){const ze=6*Re;ke.uint16[ze+0]=4*Re+0,ke.uint16[ze+1]=4*Re+1,ke.uint16[ze+2]=4*Re+2,ke.uint16[ze+3]=4*Re+2,ke.uint16[ze+4]=4*Re+3,ke.uint16[ze+5]=4*Re+0}return ke})(K));const Se=R.createIndexBuffer($c,!0),Te=R.createVertexBuffer(ue,o.c1.members,!0);for(const Ce of Y){const Ie=zs(I.transform);re.draw(R,H.TRIANGLES,Mr.disabled,Hr.disabled,I.colorModeForRenderPass(),Qr.disabled,Ie,I.style.map.terrain&&I.style.map.terrain.getTerrainData(Ce.coord),null,m.id,Te,Se,o.aM.simpleSegment(0,2*Ce.circleOffset,Ce.circleArray.length,Ce.circleArray.length/2),null,I.transform.zoom,null,null,null)}Te.destroy(),Se.destroy()}const bv=o.ag(new Float32Array(16));function kp(I,u,m,w,M,R){const{horizontalAlign:N,verticalAlign:H}=o.aH(I);return new o.P((-(N-.5)*u/M+w[0])*R,(-(H-.5)*m/M+w[1])*R)}function Xh(I,u,m,w,M,R){const N=u.tileAnchorPoint.add(new o.P(u.translation[0],u.translation[1]));if(u.pitchWithMap){let H=w.mult(R);m||(H=H.rotate(-M));const j=N.add(H);return It(j.x,j.y,u.pitchedLabelPlaneMatrix,u.getElevation).point}if(m){const H=ul(u.tileAnchorPoint.x+1,u.tileAnchorPoint.y,u).point.sub(I),j=Math.atan(H.y/H.x)+(H.x<0?Math.PI:0);return I.add(w.rotate(j))}return I.add(w)}function fd(I,u,m,w,M,R,N,H,j,Y,K,ie){const re=I.text.placedSymbolArray,ue=I.text.dynamicLayoutVertexArray,pe=I.icon.dynamicLayoutVertexArray,Se={};ue.clear();for(let Te=0;Te<re.length;Te++){const Ce=re.get(Te),Ie=Ce.hidden||!Ce.crossTileID||I.allowVerticalPlacement&&!Ce.placedOrientation?null:w[Ce.crossTileID];if(Ie){const ke=new o.P(Ce.anchorX,Ce.anchorY),Re={getElevation:ie,width:M.width,height:M.height,pitchedLabelPlaneMatrix:R,pitchWithMap:m,transform:M,tileAnchorPoint:ke,translation:Y,unwrappedTileID:K},ze=m?Nr(ke.x,ke.y,Re):ul(ke.x,ke.y,Re),He=Os(M.cameraToCenterDistance,ze.signedDistanceFromCamera);let Le=o.ap(I.textSizeData,H,Ce)*He/o.aB;m&&(Le*=I.tilePixelRatio/N);const{width:Xe,height:ht,anchor:at,textOffset:st,textBoxScale:lt}=Ie,Ot=kp(at,Xe,ht,st,lt,Le),Bt=M.getPitchedTextCorrection(ke.x+Y[0],ke.y+Y[1],K),Ct=Xh(ze.point,Re,u,Ot,-M.bearingInRadians,Bt),nr=I.allowVerticalPlacement&&Ce.placedOrientation===o.ao.vertical?Math.PI/2:0;for(let Pr=0;Pr<Ce.numGlyphs;Pr++)o.av(ue,Ct,nr);j&&Ce.associatedIconIndex>=0&&(Se[Ce.associatedIconIndex]={shiftedAnchor:Ct,angle:nr})}else yo(Ce.numGlyphs,ue)}if(j){pe.clear();const Te=I.icon.placedSymbolArray;for(let Ce=0;Ce<Te.length;Ce++){const Ie=Te.get(Ce);if(Ie.hidden)yo(Ie.numGlyphs,pe);else{const ke=Se[Ce];if(ke)for(let Re=0;Re<Ie.numGlyphs;Re++)o.av(pe,ke.shiftedAnchor,ke.angle);else yo(Ie.numGlyphs,pe)}}I.icon.dynamicLayoutVertexBuffer.updateData(pe)}I.text.dynamicLayoutVertexBuffer.updateData(ue)}function to(I,u,m){return m.iconsInText&&u?"symbolTextAndIcon":I?"symbolSDF":"symbolIcon"}function $l(I,u,m,w,M,R,N,H,j,Y,K,ie,re){const ue=I.context,pe=ue.gl,Se=I.transform,Te=H==="map",Ce=j==="map",Ie=H!=="viewport"&&m.layout.get("symbol-placement")!=="point",ke=Te&&!Ce&&!Ie,Re=!m.layout.get("symbol-sort-key").isConstant();let ze=!1;const He=I.getDepthModeForSublayer(0,Mr.ReadOnly),Le=m._unevaluatedLayout.hasValue("text-variable-anchor")||m._unevaluatedLayout.hasValue("text-variable-anchor-offset"),Xe=[],ht=Se.getCircleRadiusCorrection();for(const at of w){const st=u.getTile(at),lt=st.getBucket(m);if(!lt)continue;const Ot=M?lt.text:lt.icon;if(!Ot||!Ot.segments.get().length||!Ot.hasVisibleVertices)continue;const Bt=Ot.programConfigurations.get(m.id),Ct=M||lt.sdfIcons,nr=M?lt.textSizeData:lt.iconSizeData,Pr=Ce||Se.pitch!==0,gi=I.useProgram(to(Ct,M,lt),Bt),Mi=o.an(nr,Se.zoom),Ei=I.style.map.terrain&&I.style.map.terrain.getTerrainData(at);let Ji,$i,Jr,fn,ba=[0,0],kn=null;if(M)$i=st.glyphAtlasTexture,Jr=pe.LINEAR,Ji=st.glyphAtlasTexture.size,lt.iconsInText&&(ba=st.imageAtlasTexture.size,kn=st.imageAtlasTexture,fn=Pr||I.options.rotating||I.options.zooming||nr.kind==="composite"||nr.kind==="camera"?pe.LINEAR:pe.NEAREST);else{const _n=m.layout.get("icon-size").constantOr(0)!==1||lt.iconsNeedLinear;$i=st.imageAtlasTexture,Jr=Ct||I.options.rotating||I.options.zooming||_n||Pr?pe.LINEAR:pe.NEAREST,Ji=st.imageAtlasTexture.size}const Ln=o.aC(st,1,I.transform.zoom),Va=Vi(Te,I.transform,Ln),eu=o.L();o.aq(eu,Va);const Wo=$n(Ce,Te,I.transform,Ln),tu=o.aD(Se,st,R,N),Zu=Se.getProjectionData({overscaledTileID:at,applyGlobeMatrix:!re,applyTerrainMatrix:!0}),tf=Le&&lt.hasTextData(),th=m.layout.get("icon-text-fit")!=="none"&&tf&&lt.hasIconData();if(Ie){const _n=I.style.map.terrain?(To,xa)=>I.style.map.terrain.getElevation(at,To,xa):null,Xn=m.layout.get("text-rotation-alignment")==="map";Wn(lt,I,M,Va,eu,Ce,Y,Xn,at.toUnwrapped(),Se.width,Se.height,tu,_n)}const Al=M&&Le||th,Go=Ie||Al?bv:Ce?Va:I.transform.clipSpaceToPixelsMatrix,hs=Ct&&m.paint.get(M?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let Gs;Gs=Ct?lt.iconsInText?Gy(nr.kind,Mi,ke,Ce,Ie,Al,I,Go,Wo,tu,Ji,ba,ht):fv(nr.kind,Mi,ke,Ce,Ie,Al,I,Go,Wo,tu,M,Ji,0,ht):Wy(nr.kind,Mi,ke,Ce,Ie,Al,I,Go,Wo,tu,M,Ji,ht);const So={program:gi,buffers:Ot,uniformValues:Gs,projectionData:Zu,atlasTexture:$i,atlasTextureIcon:kn,atlasInterpolation:Jr,atlasInterpolationIcon:fn,isSDF:Ct,hasHalo:hs};if(Re&&lt.canOverlap){ze=!0;const _n=Ot.segments.get();for(const Xn of _n)Xe.push({segments:new o.aM([Xn]),sortKey:Xn.sortKey,state:So,terrainData:Ei})}else Xe.push({segments:Ot.segments,sortKey:0,state:So,terrainData:Ei})}ze&&Xe.sort(((at,st)=>at.sortKey-st.sortKey));for(const at of Xe){const st=at.state;if(ue.activeTexture.set(pe.TEXTURE0),st.atlasTexture.bind(st.atlasInterpolation,pe.CLAMP_TO_EDGE),st.atlasTextureIcon&&(ue.activeTexture.set(pe.TEXTURE1),st.atlasTextureIcon&&st.atlasTextureIcon.bind(st.atlasInterpolationIcon,pe.CLAMP_TO_EDGE)),st.isSDF){const lt=st.uniformValues;st.hasHalo&&(lt.u_is_halo=1,ku(st.buffers,at.segments,m,I,st.program,He,K,ie,lt,st.projectionData,at.terrainData)),lt.u_is_halo=0}ku(st.buffers,at.segments,m,I,st.program,He,K,ie,st.uniformValues,st.projectionData,at.terrainData)}}function ku(I,u,m,w,M,R,N,H,j,Y,K){const ie=w.context;M.draw(ie,ie.gl.TRIANGLES,R,N,H,Qr.backCCW,j,K,Y,m.id,I.layoutVertexBuffer,I.indexBuffer,u,m.paint,w.transform.zoom,I.programConfigurations.get(m.id),I.dynamicLayoutVertexBuffer,I.opacityVertexBuffer)}function Wc(I,u,m,w,M){const R=I.context,N=R.gl,H=Hr.disabled,j=new Di([N.ONE,N.ONE],o.bf.transparent,[!0,!0,!0,!0]),Y=u.getBucket(m);if(!Y)return;const K=w.key;let ie=m.heatmapFbos.get(K);ie||(ie=za(R,u.tileSize,u.tileSize),m.heatmapFbos.set(K,ie)),R.bindFramebuffer.set(ie.framebuffer),R.viewport.set([0,0,u.tileSize,u.tileSize]),R.clear({color:o.bf.transparent});const re=Y.programConfigurations.get(m.id),ue=I.useProgram("heatmap",re,!M),pe=I.transform.getProjectionData({overscaledTileID:u.tileID,applyGlobeMatrix:!0,applyTerrainMatrix:!0}),Se=I.style.map.terrain.getTerrainData(w);ue.draw(R,N.TRIANGLES,Mr.disabled,H,j,Qr.disabled,lv(u,I.transform.zoom,m.paint.get("heatmap-intensity"),1),Se,pe,m.id,Y.layoutVertexBuffer,Y.indexBuffer,Y.segments,m.paint,I.transform.zoom,re)}function Lu(I,u,m,w,M){const R=I.context,N=R.gl,H=I.transform;R.setColorMode(I.colorModeForRenderPass());const j=ma(R,u),Y=m.key,K=u.heatmapFbos.get(Y);if(!K)return;R.activeTexture.set(N.TEXTURE0),N.bindTexture(N.TEXTURE_2D,K.colorAttachment.get()),R.activeTexture.set(N.TEXTURE1),j.bind(N.LINEAR,N.CLAMP_TO_EDGE);const ie=H.getProjectionData({overscaledTileID:m,applyTerrainMatrix:M,applyGlobeMatrix:!w});I.useProgram("heatmapTexture").draw(R,N.TRIANGLES,Mr.disabled,Hr.disabled,I.colorModeForRenderPass(),Qr.disabled,jy(I,u,0,1),null,ie,u.id,I.rasterBoundsBuffer,I.quadTriangleIndexBuffer,I.rasterBoundsSegments,u.paint,H.zoom),K.destroy(),u.heatmapFbos.delete(Y)}function za(I,u,m){var w,M;const R=I.gl,N=R.createTexture();R.bindTexture(R.TEXTURE_2D,N),R.texParameteri(R.TEXTURE_2D,R.TEXTURE_WRAP_S,R.CLAMP_TO_EDGE),R.texParameteri(R.TEXTURE_2D,R.TEXTURE_WRAP_T,R.CLAMP_TO_EDGE),R.texParameteri(R.TEXTURE_2D,R.TEXTURE_MIN_FILTER,R.LINEAR),R.texParameteri(R.TEXTURE_2D,R.TEXTURE_MAG_FILTER,R.LINEAR);const H=(w=I.HALF_FLOAT)!==null&&w!==void 0?w:R.UNSIGNED_BYTE,j=(M=I.RGBA16F)!==null&&M!==void 0?M:R.RGBA;R.texImage2D(R.TEXTURE_2D,0,j,u,m,0,R.RGBA,H,null);const Y=I.createFramebuffer(u,m,!1,!1);return Y.colorAttachment.set(N),Y}function ma(I,u){return u.colorRampTexture||(u.colorRampTexture=new o.T(I,u.colorRamp,I.gl.RGBA)),u.colorRampTexture}function Fs(I,u,m,w,M,R,N,H){let j=256;if(M.stepInterpolant){const Y=u.getSource().maxzoom,K=N.canonical.z===Y?Math.ceil(1<<I.transform.maxZoom-N.canonical.z):1;j=o.ah(o.c4(R.maxLineLength/o.$*1024*K),256,m.maxTextureSize)}return H.gradient=o.c5({expression:M.gradientExpression(),evaluationKey:"lineProgress",resolution:j,image:H.gradient||void 0,clips:R.lineClipsArray}),H.texture?H.texture.update(H.gradient):H.texture=new o.T(m,H.gradient,w.RGBA),H.version=M.gradientVersion,H.texture}function _l(I,u,m,w,M){I.activeTexture.set(u.TEXTURE0),m.imageAtlasTexture.bind(u.LINEAR,u.CLAMP_TO_EDGE),w.updatePaintBuffers(M)}function bo(I,u,m,w,M,R){(M||I.lineAtlas.dirty)&&(u.activeTexture.set(m.TEXTURE0),I.lineAtlas.bind(u)),w.updatePaintBuffers(R)}function Wl(I,u,m,w,M,R,N){const H=R.gradients[M.id];let j=H.texture;M.gradientVersion!==H.version&&(j=Fs(I,u,m,w,M,R,N,H)),m.activeTexture.set(w.TEXTURE0),j.bind(M.stepInterpolant?w.NEAREST:w.LINEAR,w.CLAMP_TO_EDGE)}function xv(I,u,m,w,M,R,N,H,j){const Y=R.gradients[M.id];let K=Y.texture;M.gradientVersion!==Y.version&&(K=Fs(I,u,m,w,M,R,N,Y)),m.activeTexture.set(w.TEXTURE0),K.bind(M.stepInterpolant?w.NEAREST:w.LINEAR,w.CLAMP_TO_EDGE),m.activeTexture.set(w.TEXTURE1),I.lineAtlas.bind(m),H.updatePaintBuffers(j)}function Gc(I,u,m,w,M){if(!m||!w||!w.imageAtlas)return;const R=w.imageAtlas.patternPositions;let N=R[m.to.toString()],H=R[m.from.toString()];if(!N&&H&&(N=H),!H&&N&&(H=N),!N||!H){const j=M.getPaintProperty(u);N=R[j],H=R[j]}N&&H&&I.setConstantPatternPositions(N,H)}function Zh(I,u,m,w,M,R,N,H){const j=I.context.gl,Y="fill-pattern",K=m.paint.get(Y),ie=K&&K.constantOr(1),re=m.getCrossfadeParameters();let ue,pe,Se,Te,Ce;const Ie=I.transform,ke=m.paint.get("fill-translate"),Re=m.paint.get("fill-translate-anchor");N?(pe=ie&&!m.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",ue=j.LINES):(pe=ie?"fillPattern":"fill",ue=j.TRIANGLES);const ze=K.constantOr(null);for(const He of w){const Le=u.getTile(He);if(ie&&!Le.patternsLoaded())continue;const Xe=Le.getBucket(m);if(!Xe)continue;const ht=Xe.programConfigurations.get(m.id),at=I.useProgram(pe,ht),st=I.style.map.terrain&&I.style.map.terrain.getTerrainData(He);ie&&(I.context.activeTexture.set(j.TEXTURE0),Le.imageAtlasTexture.bind(j.LINEAR,j.CLAMP_TO_EDGE),ht.updatePaintBuffers(re)),Gc(ht,Y,ze,Le,m);const lt=Ie.getProjectionData({overscaledTileID:He,applyGlobeMatrix:!H,applyTerrainMatrix:!0}),Ot=o.aD(Ie,Le,ke,Re);if(N){Te=Xe.indexBuffer2,Ce=Xe.segments2;const Ct=[j.drawingBufferWidth,j.drawingBufferHeight];Se=pe==="fillOutlinePattern"&&ie?Vy(I,re,Le,Ct,Ot):jh(Ct,Ot)}else Te=Xe.indexBuffer,Ce=Xe.segments,Se=ie?zc(I,re,Le,Ot):{u_fill_translate:Ot};const Bt=I.stencilModeForClipping(He);at.draw(I.context,ue,M,Bt,R,Qr.backCCW,Se,st,lt,m.id,Xe.layoutVertexBuffer,Te,Ce,m.paint,I.transform.zoom,ht)}}function dd(I,u,m,w,M,R,N,H){const j=I.context,Y=j.gl,K="fill-extrusion-pattern",ie=m.paint.get(K),re=ie.constantOr(1),ue=m.getCrossfadeParameters(),pe=m.paint.get("fill-extrusion-opacity"),Se=ie.constantOr(null),Te=I.transform;for(const Ce of w){const Ie=u.getTile(Ce),ke=Ie.getBucket(m);if(!ke)continue;const Re=I.style.map.terrain&&I.style.map.terrain.getTerrainData(Ce),ze=ke.programConfigurations.get(m.id),He=I.useProgram(re?"fillExtrusionPattern":"fillExtrusion",ze);re&&(I.context.activeTexture.set(Y.TEXTURE0),Ie.imageAtlasTexture.bind(Y.LINEAR,Y.CLAMP_TO_EDGE),ze.updatePaintBuffers(ue));const Le=Te.getProjectionData({overscaledTileID:Ce,applyGlobeMatrix:!H,applyTerrainMatrix:!0});Gc(ze,K,Se,Ie,m);const Xe=o.aD(Te,Ie,m.paint.get("fill-extrusion-translate"),m.paint.get("fill-extrusion-translate-anchor")),ht=m.paint.get("fill-extrusion-vertical-gradient"),at=re?sv(I,ht,pe,Xe,Ce,ue,Ie):Hh(I,ht,pe,Xe);He.draw(j,j.gl.TRIANGLES,M,R,N,Qr.backCCW,at,Re,Le,m.id,ke.layoutVertexBuffer,ke.indexBuffer,ke.segments,m.paint,I.transform.zoom,ze,I.style.map.terrain&&ke.centroidVertexBuffer)}}function Gn(I,u,m,w,M,R,N,H,j){var Y;const K=I.style.projection,ie=I.context,re=I.transform,ue=ie.gl,pe=[`#define NUM_ILLUMINATION_SOURCES ${m.paint.get("hillshade-highlight-color").values.length}`],Se=I.useProgram("hillshade",null,!1,pe),Te=!I.options.moving;for(const Ce of w){const Ie=u.getTile(Ce),ke=Ie.fbo;if(!ke)continue;const Re=K.getMeshFromTileID(ie,Ce.canonical,H,!0,"raster"),ze=(Y=I.style.map.terrain)===null||Y===void 0?void 0:Y.getTerrainData(Ce);ie.activeTexture.set(ue.TEXTURE0),ue.bindTexture(ue.TEXTURE_2D,ke.colorAttachment.get());const He=re.getProjectionData({overscaledTileID:Ce,aligned:Te,applyGlobeMatrix:!j,applyTerrainMatrix:!0});Se.draw(ie,ue.TRIANGLES,R,M[Ce.overscaledZ],N,Qr.backCCW,uv(I,Ie,m),ze,He,m.id,Re.vertexBuffer,Re.indexBuffer,Re.segments)}}function Oi(I,u,m,w,M,R,N,H,j){var Y;const K=I.style.projection,ie=I.context,re=I.transform,ue=ie.gl,pe=I.useProgram("colorRelief"),Se=!I.options.moving;let Te=!0,Ce=0;for(const Ie of w){const ke=u.getTile(Ie),Re=ke.dem;if(Te){const at=ue.getParameter(ue.MAX_TEXTURE_SIZE),{elevationTexture:st,colorTexture:lt}=m.getColorRampTextures(ie,at,Re.getUnpackVector());ie.activeTexture.set(ue.TEXTURE1),st.bind(ue.NEAREST,ue.CLAMP_TO_EDGE),ie.activeTexture.set(ue.TEXTURE4),lt.bind(ue.LINEAR,ue.CLAMP_TO_EDGE),Te=!1,Ce=st.size[0]}if(!Re||!Re.data)continue;const ze=Re.stride,He=Re.getPixels();if(ie.activeTexture.set(ue.TEXTURE0),ie.pixelStoreUnpackPremultiplyAlpha.set(!1),ke.demTexture=ke.demTexture||I.getTileTexture(ze),ke.demTexture){const at=ke.demTexture;at.update(He,{premultiply:!1}),at.bind(ue.LINEAR,ue.CLAMP_TO_EDGE)}else ke.demTexture=new o.T(ie,He,ue.RGBA,{premultiply:!1}),ke.demTexture.bind(ue.LINEAR,ue.CLAMP_TO_EDGE);const Le=K.getMeshFromTileID(ie,Ie.canonical,H,!0,"raster"),Xe=(Y=I.style.map.terrain)===null||Y===void 0?void 0:Y.getTerrainData(Ie),ht=re.getProjectionData({overscaledTileID:Ie,aligned:Se,applyGlobeMatrix:!j,applyTerrainMatrix:!0});pe.draw(ie,ue.TRIANGLES,R,M[Ie.overscaledZ],N,Qr.backCCW,Wh(m,ke.dem,Ce),Xe,ht,m.id,Le.vertexBuffer,Le.indexBuffer,Le.segments)}}const ai=[new o.P(0,0),new o.P(o.$,0),new o.P(o.$,o.$),new o.P(0,o.$)];function Vs(I,u,m,w,M,R,N,H,j=!1,Y=!1){const K=w[w.length-1].overscaledZ,ie=I.context,re=ie.gl,ue=I.useProgram("raster"),pe=I.transform,Se=I.style.projection,Te=I.colorModeForRenderPass(),Ce=!I.options.moving,Ie=m.paint.get("raster-opacity"),ke=m.paint.get("raster-resampling"),Re=m.paint.get("raster-fade-duration"),ze=!!I.style.map.terrain;for(const He of w){const Le=I.getDepthModeForSublayer(He.overscaledZ-K,Ie===1?Mr.ReadWrite:Mr.ReadOnly,re.LESS),Xe=u.getTile(He),ht=ke==="nearest"?re.NEAREST:re.LINEAR;ie.activeTexture.set(re.TEXTURE0),Xe.texture.bind(ht,re.CLAMP_TO_EDGE,re.LINEAR_MIPMAP_NEAREST),ie.activeTexture.set(re.TEXTURE1);const{parentTile:at,parentScaleBy:st,parentTopLeft:lt,fadeValues:Ot}=Vo(Xe,u,Re,ze);Xe.fadeOpacity=Ot.tileOpacity,at?(at.fadeOpacity=Ot.parentTileOpacity,at.texture.bind(ht,re.CLAMP_TO_EDGE,re.LINEAR_MIPMAP_NEAREST)):Xe.texture.bind(ht,re.CLAMP_TO_EDGE,re.LINEAR_MIPMAP_NEAREST),Xe.texture.useMipmap&&ie.extTextureFilterAnisotropic&&I.transform.pitch>20&&re.texParameterf(re.TEXTURE_2D,ie.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,ie.extTextureFilterAnisotropicMax);const Bt=I.style.map.terrain&&I.style.map.terrain.getTerrainData(He),Ct=pe.getProjectionData({overscaledTileID:He,aligned:Ce,applyGlobeMatrix:!Y,applyTerrainMatrix:!0}),nr=nd(lt,st,Ot.fadeMix,m,H),Pr=Se.getMeshFromTileID(ie,He.canonical,R,N,"raster");ue.draw(ie,re.TRIANGLES,Le,M?M[He.overscaledZ]:Hr.disabled,Te,j?Qr.frontCCW:Qr.backCCW,nr,Bt,Ct,m.id,Pr.vertexBuffer,Pr.indexBuffer,Pr.segments)}}function Vo(I,u,m,w){const M={parentTile:null,parentScaleBy:1,parentTopLeft:[0,0],fadeValues:{tileOpacity:1,parentTileOpacity:1,fadeMix:{opacity:1,mix:0}}};if(m===0||w)return M;if(I.fadingParentID){const R=u._getLoadedTile(I.fadingParentID);if(!R)return M;const N=Math.pow(2,R.tileID.overscaledZ-I.tileID.overscaledZ),H=[I.tileID.canonical.x*N%1,I.tileID.canonical.y*N%1],j=(function(Y,K,ie){const re=y.now(),ue=(re-K.timeAdded)/ie,pe=Y.fadingDirection===Ge.Incoming,Se=o.ah((re-Y.timeAdded)/ie,0,1),Te=o.ah(1-ue,0,1),Ce=pe?Se:Te;return{tileOpacity:Ce,parentTileOpacity:pe?Te:Se,fadeMix:{opacity:1,mix:1-Ce}}})(I,R,m);return{parentTile:R,parentScaleBy:N,parentTopLeft:H,fadeValues:j}}if(I.selfFading){const R=(function(N,H){const j=y.now(),Y=o.ah((j-N.timeAdded)/H,0,1);return{tileOpacity:Y,fadeMix:{opacity:Y,mix:0}}})(I,m);return{parentTile:null,parentScaleBy:1,parentTopLeft:[0,0],fadeValues:R}}return M}const yn=new o.bf(1,0,0,1),xo=new o.bf(0,1,0,1),Uo=new o.bf(0,0,1,1),Lp=new o.bf(1,0,1,1),Gl=new o.bf(0,1,1,1);function Xl(I,u,m,w){bl(I,0,u+m/2,I.transform.width,m,w)}function Zl(I,u,m,w){bl(I,u-m/2,0,m,I.transform.height,w)}function bl(I,u,m,w,M,R){const N=I.context,H=N.gl;H.enable(H.SCISSOR_TEST),H.scissor(u*I.pixelRatio,m*I.pixelRatio,w*I.pixelRatio,M*I.pixelRatio),N.clear({color:R}),H.disable(H.SCISSOR_TEST)}function Xc(I,u,m){const w=I.context,M=w.gl,R=I.useProgram("debug"),N=Mr.disabled,H=Hr.disabled,j=I.colorModeForRenderPass(),Y="$debug",K=I.style.map.terrain&&I.style.map.terrain.getTerrainData(m);w.activeTexture.set(M.TEXTURE0);const ie=u.getTileByID(m.key).latestRawTileData,re=Math.floor((ie&&ie.byteLength||0)/1024),ue=u.getTile(m).tileSize,pe=512/Math.min(ue,512)*(m.overscaledZ/I.transform.zoom)*.5;let Se=m.canonical.toString();m.overscaledZ!==m.canonical.z&&(Se+=` => ${m.overscaledZ}`),(function(Ce,Ie){Ce.initDebugOverlayCanvas();const ke=Ce.debugOverlayCanvas,Re=Ce.context.gl,ze=Ce.debugOverlayCanvas.getContext("2d");ze.clearRect(0,0,ke.width,ke.height),ze.shadowColor="white",ze.shadowBlur=2,ze.lineWidth=1.5,ze.strokeStyle="white",ze.textBaseline="top",ze.font="bold 36px Open Sans, sans-serif",ze.fillText(Ie,5,5),ze.strokeText(Ie,5,5),Ce.debugOverlayTexture.update(ke),Ce.debugOverlayTexture.bind(Re.LINEAR,Re.CLAMP_TO_EDGE)})(I,`${Se} ${re}kB`);const Te=I.transform.getProjectionData({overscaledTileID:m,applyGlobeMatrix:!0,applyTerrainMatrix:!0});R.draw(w,M.TRIANGLES,N,H,Di.alphaBlended,Qr.disabled,Hy(o.bf.transparent,pe),null,Te,Y,I.debugBuffer,I.quadTriangleIndexBuffer,I.debugSegments),R.draw(w,M.LINE_STRIP,N,H,j,Qr.disabled,Hy(o.bf.red),K,Te,Y,I.debugBuffer,I.tileBorderIndexBuffer,I.debugSegments)}function xl(I,u,m,w){const{isRenderingGlobe:M}=w,R=I.context,N=R.gl,H=I.transform,j=I.colorModeForRenderPass(),Y=I.getDepthModeFor3D(),K=I.useProgram("terrain");R.bindFramebuffer.set(null),R.viewport.set([0,0,I.width,I.height]);for(const ie of m){const re=u.getTerrainMesh(ie.tileID),ue=I.renderToTexture.getTexture(ie),pe=u.getTerrainData(ie.tileID);R.activeTexture.set(N.TEXTURE0),N.bindTexture(N.TEXTURE_2D,ue.texture);const Se=u.getMeshFrameDelta(H.zoom),Te=H.calculateFogMatrix(ie.tileID.toUnwrapped()),Ce=av(Se,Te,I.style.sky,H.pitch,M),Ie=H.getProjectionData({overscaledTileID:ie.tileID,applyTerrainMatrix:!1,applyGlobeMatrix:!0});K.draw(R,N.TRIANGLES,Y,Hr.disabled,j,Qr.backCCW,Ce,pe,Ie,"terrain",re.vertexBuffer,re.indexBuffer,re.segments)}}function Us(I,u){if(!u.mesh){const m=new o.aL;m.emplaceBack(-1,-1),m.emplaceBack(1,-1),m.emplaceBack(1,1),m.emplaceBack(-1,1);const w=new o.aN;w.emplaceBack(0,1,2),w.emplaceBack(0,2,3),u.mesh=new Au(I.createVertexBuffer(m,Ka.members),I.createIndexBuffer(w),o.aM.simpleSegment(0,0,m.length,w.length))}return u.mesh}class ql{constructor(u,m){this.context=new qy(u),this.transform=m,this._tileTextures={},this.terrainFacilitator={dirty:!0,matrix:o.ag(new Float64Array(16)),renderTime:0},this.setup(),this.numSublayers=or.maxUnderzooming+or.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new dl}resize(u,m,w){if(this.width=Math.floor(u*w),this.height=Math.floor(m*w),this.pixelRatio=w,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const M of this.style._order)this.style._layers[M].resize()}setup(){const u=this.context,m=new o.aL;m.emplaceBack(0,0),m.emplaceBack(o.$,0),m.emplaceBack(0,o.$),m.emplaceBack(o.$,o.$),this.tileExtentBuffer=u.createVertexBuffer(m,Ka.members),this.tileExtentSegments=o.aM.simpleSegment(0,0,4,2);const w=new o.aL;w.emplaceBack(0,0),w.emplaceBack(o.$,0),w.emplaceBack(0,o.$),w.emplaceBack(o.$,o.$),this.debugBuffer=u.createVertexBuffer(w,Ka.members),this.debugSegments=o.aM.simpleSegment(0,0,4,5);const M=new o.c7;M.emplaceBack(0,0,0,0),M.emplaceBack(o.$,0,o.$,0),M.emplaceBack(0,o.$,0,o.$),M.emplaceBack(o.$,o.$,o.$,o.$),this.rasterBoundsBuffer=u.createVertexBuffer(M,Cb.members),this.rasterBoundsSegments=o.aM.simpleSegment(0,0,4,2);const R=new o.aL;R.emplaceBack(0,0),R.emplaceBack(o.$,0),R.emplaceBack(0,o.$),R.emplaceBack(o.$,o.$),this.rasterBoundsBufferPosOnly=u.createVertexBuffer(R,Ka.members),this.rasterBoundsSegmentsPosOnly=o.aM.simpleSegment(0,0,4,5);const N=new o.aL;N.emplaceBack(0,0),N.emplaceBack(1,0),N.emplaceBack(0,1),N.emplaceBack(1,1),this.viewportBuffer=u.createVertexBuffer(N,Ka.members),this.viewportSegments=o.aM.simpleSegment(0,0,4,2);const H=new o.c8;H.emplaceBack(0),H.emplaceBack(1),H.emplaceBack(3),H.emplaceBack(2),H.emplaceBack(0),this.tileBorderIndexBuffer=u.createIndexBuffer(H);const j=new o.aN;j.emplaceBack(1,0,2),j.emplaceBack(1,2,3),this.quadTriangleIndexBuffer=u.createIndexBuffer(j);const Y=this.context.gl;this.stencilClearMode=new Hr({func:Y.ALWAYS,mask:0},0,255,Y.ZERO,Y.ZERO,Y.ZERO),this.tileExtentMesh=new Au(this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}clearStencil(){const u=this.context,m=u.gl;this.nextStencilID=1,this.currentStencilSource=void 0;const w=o.L();o.bZ(w,0,this.width,this.height,0,0,1),o.N(w,w,[m.drawingBufferWidth,m.drawingBufferHeight,0]);const M={mainMatrix:w,tileMercatorCoords:[0,0,1,1],clippingPlane:[0,0,0,0],projectionTransition:0,fallbackMatrix:w};this.useProgram("clippingMask",null,!0).draw(u,m.TRIANGLES,Mr.disabled,this.stencilClearMode,Di.disabled,Qr.disabled,null,null,M,"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}_renderTileClippingMasks(u,m,w){if(this.currentStencilSource===u.source||!u.isTileClipped()||!m||!m.length)return;this.currentStencilSource=u.source,this.nextStencilID+m.length>256&&this.clearStencil();const M=this.context;M.setColorMode(Di.disabled),M.setDepthMode(Mr.disabled);const R={};for(const N of m)R[N.key]=this.nextStencilID++;this._renderTileMasks(R,m,w,!0),this._renderTileMasks(R,m,w,!1),this._tileClippingMaskIDs=R}_renderTileMasks(u,m,w,M){const R=this.context,N=R.gl,H=this.style.projection,j=this.transform,Y=this.useProgram("clippingMask");for(const K of m){const ie=u[K.key],re=this.style.map.terrain&&this.style.map.terrain.getTerrainData(K),ue=H.getMeshFromTileID(this.context,K.canonical,M,!0,"stencil"),pe=j.getProjectionData({overscaledTileID:K,applyGlobeMatrix:!w,applyTerrainMatrix:!0});Y.draw(R,N.TRIANGLES,Mr.disabled,new Hr({func:N.ALWAYS,mask:0},ie,255,N.KEEP,N.KEEP,N.REPLACE),Di.disabled,w?Qr.disabled:Qr.backCCW,null,re,pe,"$clipping",ue.vertexBuffer,ue.indexBuffer,ue.segments)}}_renderTilesDepthBuffer(){const u=this.context,m=u.gl,w=this.style.projection,M=this.transform,R=this.useProgram("depth"),N=this.getDepthModeFor3D(),H=Kr(M,{tileSize:M.tileSize});for(const j of H){const Y=this.style.map.terrain&&this.style.map.terrain.getTerrainData(j),K=w.getMeshFromTileID(this.context,j.canonical,!0,!0,"raster"),ie=M.getProjectionData({overscaledTileID:j,applyGlobeMatrix:!0,applyTerrainMatrix:!0});R.draw(u,m.TRIANGLES,N,Hr.disabled,Di.disabled,Qr.backCCW,null,Y,ie,"$clipping",K.vertexBuffer,K.indexBuffer,K.segments)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const u=this.nextStencilID++,m=this.context.gl;return new Hr({func:m.NOTEQUAL,mask:255},u,255,m.KEEP,m.KEEP,m.REPLACE)}stencilModeForClipping(u){const m=this.context.gl;return new Hr({func:m.EQUAL,mask:255},this._tileClippingMaskIDs[u.key],0,m.KEEP,m.KEEP,m.REPLACE)}getStencilConfigForOverlapAndUpdateStencilID(u){const m=this.context.gl,w=u.sort(((N,H)=>H.overscaledZ-N.overscaledZ)),M=w[w.length-1].overscaledZ,R=w[0].overscaledZ-M+1;if(R>1){this.currentStencilSource=void 0,this.nextStencilID+R>256&&this.clearStencil();const N={};for(let H=0;H<R;H++)N[H+M]=new Hr({func:m.GEQUAL,mask:255},H+this.nextStencilID,255,m.KEEP,m.KEEP,m.REPLACE);return this.nextStencilID+=R,[N,w]}return[{[M]:Hr.disabled},w]}stencilConfigForOverlapTwoPass(u){const m=this.context.gl,w=u.sort(((N,H)=>H.overscaledZ-N.overscaledZ)),M=w[w.length-1].overscaledZ,R=w[0].overscaledZ-M+1;if(this.clearStencil(),R>1){const N={},H={};for(let j=0;j<R;j++)N[j+M]=new Hr({func:m.GREATER,mask:255},R+1+j,255,m.KEEP,m.KEEP,m.REPLACE),H[j+M]=new Hr({func:m.GREATER,mask:255},1+j,255,m.KEEP,m.KEEP,m.REPLACE);return this.nextStencilID=2*R+1,[N,H,w]}return this.nextStencilID=3,[{[M]:new Hr({func:m.GREATER,mask:255},2,255,m.KEEP,m.KEEP,m.REPLACE)},{[M]:new Hr({func:m.GREATER,mask:255},1,255,m.KEEP,m.KEEP,m.REPLACE)},w]}colorModeForRenderPass(){const u=this.context.gl;return this._showOverdrawInspector?new Di([u.CONSTANT_COLOR,u.ONE],new o.bf(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?Di.unblended:Di.alphaBlended}getDepthModeForSublayer(u,m,w){if(!this.opaquePassEnabledForLayer())return Mr.disabled;const M=1-((1+this.currentLayer)*this.numSublayers+u)*this.depthEpsilon;return new Mr(w||this.context.gl.LEQUAL,m,[M,M])}getDepthModeFor3D(){return new Mr(this.context.gl.LEQUAL,Mr.ReadWrite,this.depthRangeFor3D)}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(u,m){var w,M;this.style=u,this.options=m,this.lineAtlas=u.lineAtlas,this.imageManager=u.imageManager,this.glyphManager=u.glyphManager,this.symbolFadeChange=u.placement.symbolFadeChange(y.now()),this.imageManager.beginFrame();const R=this.style._order,N=this.style.sourceCaches,H={},j={},Y={},K={isRenderingToTexture:!1,isRenderingGlobe:((w=u.projection)===null||w===void 0?void 0:w.transitionState)>0};for(const re in N){const ue=N[re];ue.used&&ue.prepare(this.context),H[re]=ue.getVisibleCoordinates(!1),j[re]=H[re].slice().reverse(),Y[re]=ue.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let re=0;re<R.length;re++)if(this.style._layers[R[re]].is3D()){this.opaquePassCutoff=re;break}this.maybeDrawDepthAndCoords(!1),this.renderToTexture&&(this.renderToTexture.prepareForRender(this.style,this.transform.zoom),this.opaquePassCutoff=0),this.renderPass="offscreen";for(const re of R){const ue=this.style._layers[re];if(!ue.hasOffscreenPass()||ue.isHidden(this.transform.zoom))continue;const pe=j[ue.source];(ue.type==="custom"||pe.length)&&this.renderLayer(this,N[ue.source],ue,pe,K)}if((M=this.style.projection)===null||M===void 0||M.updateGPUdependent({context:this.context,useProgram:re=>this.useProgram(re)}),this.context.viewport.set([0,0,this.width,this.height]),this.context.bindFramebuffer.set(null),this.context.clear({color:m.showOverdrawInspector?o.bf.black:o.bf.transparent,depth:1}),this.clearStencil(),this.style.sky&&(function(re,ue){const pe=re.context,Se=pe.gl,Te=((He,Le,Xe)=>{const ht=Math.cos(Le.rollInRadians),at=Math.sin(Le.rollInRadians),st=it(Le),lt=Le.getProjectionData({overscaledTileID:null,applyGlobeMatrix:!0,applyTerrainMatrix:!0}).projectionTransition;return{u_sky_color:He.properties.get("sky-color"),u_horizon_color:He.properties.get("horizon-color"),u_horizon:[(Le.width/2-st*at)*Xe,(Le.height/2+st*ht)*Xe],u_horizon_normal:[-at,ht],u_sky_horizon_blend:He.properties.get("sky-horizon-blend")*Le.height/2*Xe,u_sky_blend:lt}})(ue,re.style.map.transform,re.pixelRatio),Ce=new Mr(Se.LEQUAL,Mr.ReadWrite,[0,1]),Ie=Hr.disabled,ke=re.colorModeForRenderPass(),Re=re.useProgram("sky"),ze=Us(pe,ue);Re.draw(pe,Se.TRIANGLES,Ce,Ie,ke,Qr.disabled,Te,null,void 0,"sky",ze.vertexBuffer,ze.indexBuffer,ze.segments)})(this,this.style.sky),this._showOverdrawInspector=m.showOverdrawInspector,this.depthRangeFor3D=[0,1-(u._order.length+2)*this.numSublayers*this.depthEpsilon],!this.renderToTexture)for(this.renderPass="opaque",this.currentLayer=R.length-1;this.currentLayer>=0;this.currentLayer--){const re=this.style._layers[R[this.currentLayer]],ue=N[re.source],pe=H[re.source];this._renderTileClippingMasks(re,pe,!1),this.renderLayer(this,ue,re,pe,K)}this.renderPass="translucent";let ie=!1;for(this.currentLayer=0;this.currentLayer<R.length;this.currentLayer++){const re=this.style._layers[R[this.currentLayer]],ue=N[re.source];if(this.renderToTexture&&this.renderToTexture.renderLayer(re,K))continue;this.opaquePassEnabledForLayer()||ie||(ie=!0,K.isRenderingGlobe&&!this.style.map.terrain&&this._renderTilesDepthBuffer());const pe=(re.type==="symbol"?Y:j)[re.source];this._renderTileClippingMasks(re,H[re.source],!!this.renderToTexture),this.renderLayer(this,ue,re,pe,K)}if(K.isRenderingGlobe&&(function(re,ue,pe){const Se=re.context,Te=Se.gl,Ce=re.useProgram("atmosphere"),Ie=new Mr(Te.LEQUAL,Mr.ReadOnly,[0,1]),ke=re.transform,Re=(function(lt,Ot){const Bt=lt.properties.get("position"),Ct=[-Bt.x,-Bt.y,-Bt.z],nr=o.ag(new Float64Array(16));return lt.properties.get("anchor")==="map"&&(o.b6(nr,nr,Ot.rollInRadians),o.b7(nr,nr,-Ot.pitchInRadians),o.b6(nr,nr,Ot.bearingInRadians),o.b7(nr,nr,Ot.center.lat*Math.PI/180),o.bz(nr,nr,-Ot.center.lng*Math.PI/180)),o.c6(Ct,Ct,nr),Ct})(pe,re.transform),ze=ke.getProjectionData({overscaledTileID:null,applyGlobeMatrix:!0,applyTerrainMatrix:!0}),He=ue.properties.get("atmosphere-blend")*ze.projectionTransition;if(He===0)return;const Le=Nc(ke.worldSize,ke.center.lat),Xe=ke.inverseProjectionMatrix,ht=new Float64Array(4);ht[3]=1,o.aw(ht,ht,ke.modelViewProjectionMatrix),ht[0]/=ht[3],ht[1]/=ht[3],ht[2]/=ht[3],ht[3]=1,o.aw(ht,ht,Xe),ht[0]/=ht[3],ht[1]/=ht[3],ht[2]/=ht[3],ht[3]=1;const at=((lt,Ot,Bt,Ct,nr)=>({u_sun_pos:lt,u_atmosphere_blend:Ot,u_globe_position:Bt,u_globe_radius:Ct,u_inv_proj_matrix:nr}))(Re,He,[ht[0],ht[1],ht[2]],Le,Xe),st=Us(Se,ue);Ce.draw(Se,Te.TRIANGLES,Ie,Hr.disabled,Di.alphaBlended,Qr.disabled,at,null,null,"atmosphere",st.vertexBuffer,st.indexBuffer,st.segments)})(this,this.style.sky,this.style.light),this.options.showTileBoundaries){const re=(function(ue,pe){let Se=null;const Te=Object.values(ue._layers).flatMap((Re=>Re.source&&!Re.isHidden(pe)?[ue.sourceCaches[Re.source]]:[])),Ce=Te.filter((Re=>Re.getSource().type==="vector")),Ie=Te.filter((Re=>Re.getSource().type!=="vector")),ke=Re=>{(!Se||Se.getSource().maxzoom<Re.getSource().maxzoom)&&(Se=Re)};return Ce.forEach((Re=>ke(Re))),Se||Ie.forEach((Re=>ke(Re))),Se})(this.style,this.transform.zoom);re&&(function(ue,pe,Se){for(let Te=0;Te<Se.length;Te++)Xc(ue,pe,Se[Te])})(this,re,re.getVisibleCoordinates())}this.options.showPadding&&(function(re){const ue=re.transform.padding;Xl(re,re.transform.height-(ue.top||0),3,yn),Xl(re,ue.bottom||0,3,xo),Zl(re,ue.left||0,3,Uo),Zl(re,re.transform.width-(ue.right||0),3,Lp);const pe=re.transform.centerPoint;(function(Se,Te,Ce,Ie){bl(Se,Te-1,Ce-10,2,20,Ie),bl(Se,Te-10,Ce-1,20,2,Ie)})(re,pe.x,re.transform.height-pe.y,Gl)})(this),this.context.setDefault()}maybeDrawDepthAndCoords(u){if(!this.style||!this.style.map||!this.style.map.terrain)return;const m=this.terrainFacilitator.matrix,w=this.transform.modelViewProjectionMatrix;let M=this.terrainFacilitator.dirty;M||(M=u?!o.c9(m,w):!o.ca(m,w)),M||(M=this.style.map.terrain.sourceCache.anyTilesAfterTime(this.terrainFacilitator.renderTime)),M&&(o.cb(m,w),this.terrainFacilitator.renderTime=Date.now(),this.terrainFacilitator.dirty=!1,(function(R,N){const H=R.context,j=H.gl,Y=R.transform,K=Di.unblended,ie=new Mr(j.LEQUAL,Mr.ReadWrite,[0,1]),re=N.sourceCache.getRenderableTiles(),ue=R.useProgram("terrainDepth");H.bindFramebuffer.set(N.getFramebuffer("depth").framebuffer),H.viewport.set([0,0,R.width/devicePixelRatio,R.height/devicePixelRatio]),H.clear({color:o.bf.transparent,depth:1});for(const pe of re){const Se=N.getTerrainMesh(pe.tileID),Te=N.getTerrainData(pe.tileID),Ce=Y.getProjectionData({overscaledTileID:pe.tileID,applyTerrainMatrix:!1,applyGlobeMatrix:!0}),Ie={u_ele_delta:N.getMeshFrameDelta(Y.zoom)};ue.draw(H,j.TRIANGLES,ie,Hr.disabled,K,Qr.backCCW,Ie,Te,Ce,"terrain",Se.vertexBuffer,Se.indexBuffer,Se.segments)}H.bindFramebuffer.set(null),H.viewport.set([0,0,R.width,R.height])})(this,this.style.map.terrain),(function(R,N){const H=R.context,j=H.gl,Y=R.transform,K=Di.unblended,ie=new Mr(j.LEQUAL,Mr.ReadWrite,[0,1]),re=N.getCoordsTexture(),ue=N.sourceCache.getRenderableTiles(),pe=R.useProgram("terrainCoords");H.bindFramebuffer.set(N.getFramebuffer("coords").framebuffer),H.viewport.set([0,0,R.width/devicePixelRatio,R.height/devicePixelRatio]),H.clear({color:o.bf.transparent,depth:1}),N.coordsIndex=[];for(const Se of ue){const Te=N.getTerrainMesh(Se.tileID),Ce=N.getTerrainData(Se.tileID);H.activeTexture.set(j.TEXTURE0),j.bindTexture(j.TEXTURE_2D,re.texture);const Ie={u_terrain_coords_id:(255-N.coordsIndex.length)/255,u_texture:0,u_ele_delta:N.getMeshFrameDelta(Y.zoom)},ke=Y.getProjectionData({overscaledTileID:Se.tileID,applyTerrainMatrix:!1,applyGlobeMatrix:!0});pe.draw(H,j.TRIANGLES,ie,Hr.disabled,K,Qr.backCCW,Ie,Ce,ke,"terrain",Te.vertexBuffer,Te.indexBuffer,Te.segments),N.coordsIndex.push(Se.tileID.key)}H.bindFramebuffer.set(null),H.viewport.set([0,0,R.width,R.height])})(this,this.style.map.terrain))}renderLayer(u,m,w,M,R){w.isHidden(this.transform.zoom)||(w.type==="background"||w.type==="custom"||(M||[]).length)&&(this.id=w.id,o.cc(w)?(function(N,H,j,Y,K,ie){if(N.renderPass!=="translucent")return;const{isRenderingToTexture:re}=ie,ue=Hr.disabled,pe=N.colorModeForRenderPass();(j._unevaluatedLayout.hasValue("text-variable-anchor")||j._unevaluatedLayout.hasValue("text-variable-anchor-offset"))&&(function(Se,Te,Ce,Ie,ke,Re,ze,He,Le){const Xe=Te.transform,ht=Te.style.map.terrain,at=ke==="map",st=Re==="map";for(const lt of Se){const Ot=Ie.getTile(lt),Bt=Ot.getBucket(Ce);if(!Bt||!Bt.text||!Bt.text.segments.get().length)continue;const Ct=o.an(Bt.textSizeData,Xe.zoom),nr=o.aC(Ot,1,Te.transform.zoom),Pr=Vi(at,Te.transform,nr),gi=Ce.layout.get("icon-text-fit")!=="none"&&Bt.hasIconData();if(Ct){const Mi=Math.pow(2,Xe.zoom-Ot.tileID.overscaledZ),Ei=ht?(Ji,$i)=>ht.getElevation(lt,Ji,$i):null;fd(Bt,at,st,Le,Xe,Pr,Mi,Ct,gi,o.aD(Xe,Ot,ze,He),lt.toUnwrapped(),Ei)}}})(Y,N,j,H,j.layout.get("text-rotation-alignment"),j.layout.get("text-pitch-alignment"),j.paint.get("text-translate"),j.paint.get("text-translate-anchor"),K),j.paint.get("icon-opacity").constantOr(1)!==0&&$l(N,H,j,Y,!1,j.paint.get("icon-translate"),j.paint.get("icon-translate-anchor"),j.layout.get("icon-rotation-alignment"),j.layout.get("icon-pitch-alignment"),j.layout.get("icon-keep-upright"),ue,pe,re),j.paint.get("text-opacity").constantOr(1)!==0&&$l(N,H,j,Y,!0,j.paint.get("text-translate"),j.paint.get("text-translate-anchor"),j.layout.get("text-rotation-alignment"),j.layout.get("text-pitch-alignment"),j.layout.get("text-keep-upright"),ue,pe,re),H.map.showCollisionBoxes&&(jl(N,H,j,Y,!0),jl(N,H,j,Y,!1))})(u,m,w,M,this.style.placement.variableOffsets,R):o.cd(w)?(function(N,H,j,Y,K){if(N.renderPass!=="translucent")return;const{isRenderingToTexture:ie}=K,re=j.paint.get("circle-opacity"),ue=j.paint.get("circle-stroke-width"),pe=j.paint.get("circle-stroke-opacity"),Se=!j.layout.get("circle-sort-key").isConstant();if(re.constantOr(1)===0&&(ue.constantOr(1)===0||pe.constantOr(1)===0))return;const Te=N.context,Ce=Te.gl,Ie=N.transform,ke=N.getDepthModeForSublayer(0,Mr.ReadOnly),Re=Hr.disabled,ze=N.colorModeForRenderPass(),He=[],Le=Ie.getCircleRadiusCorrection();for(let Xe=0;Xe<Y.length;Xe++){const ht=Y[Xe],at=H.getTile(ht),st=at.getBucket(j);if(!st)continue;const lt=j.paint.get("circle-translate"),Ot=j.paint.get("circle-translate-anchor"),Bt=o.aD(Ie,at,lt,Ot),Ct=st.programConfigurations.get(j.id),nr=N.useProgram("circle",Ct),Pr=st.layoutVertexBuffer,gi=st.indexBuffer,Mi=N.style.map.terrain&&N.style.map.terrain.getTerrainData(ht),Ei={programConfiguration:Ct,program:nr,layoutVertexBuffer:Pr,indexBuffer:gi,uniformValues:td(N,at,j,Bt,Le),terrainData:Mi,projectionData:Ie.getProjectionData({overscaledTileID:ht,applyGlobeMatrix:!ie,applyTerrainMatrix:!0})};if(Se){const Ji=st.segments.get();for(const $i of Ji)He.push({segments:new o.aM([$i]),sortKey:$i.sortKey,state:Ei})}else He.push({segments:st.segments,sortKey:0,state:Ei})}Se&&He.sort(((Xe,ht)=>Xe.sortKey-ht.sortKey));for(const Xe of He){const{programConfiguration:ht,program:at,layoutVertexBuffer:st,indexBuffer:lt,uniformValues:Ot,terrainData:Bt,projectionData:Ct}=Xe.state;at.draw(Te,Ce.TRIANGLES,ke,Re,ze,Qr.backCCW,Ot,Bt,Ct,j.id,st,lt,Xe.segments,j.paint,N.transform.zoom,ht)}})(u,m,w,M,R):o.ce(w)?(function(N,H,j,Y,K){if(j.paint.get("heatmap-opacity")===0)return;const ie=N.context,{isRenderingToTexture:re,isRenderingGlobe:ue}=K;if(N.style.map.terrain){for(const pe of Y){const Se=H.getTile(pe);H.hasRenderableParent(pe)||(N.renderPass==="offscreen"?Wc(N,Se,j,pe,ue):N.renderPass==="translucent"&&Lu(N,j,pe,re,ue))}ie.viewport.set([0,0,N.width,N.height])}else N.renderPass==="offscreen"?(function(pe,Se,Te,Ce){const Ie=pe.context,ke=Ie.gl,Re=pe.transform,ze=Hr.disabled,He=new Di([ke.ONE,ke.ONE],o.bf.transparent,[!0,!0,!0,!0]);(function(Le,Xe,ht){const at=Le.gl;Le.activeTexture.set(at.TEXTURE1),Le.viewport.set([0,0,Xe.width/4,Xe.height/4]);let st=ht.heatmapFbos.get(o.c3);st?(at.bindTexture(at.TEXTURE_2D,st.colorAttachment.get()),Le.bindFramebuffer.set(st.framebuffer)):(st=za(Le,Xe.width/4,Xe.height/4),ht.heatmapFbos.set(o.c3,st))})(Ie,pe,Te),Ie.clear({color:o.bf.transparent});for(let Le=0;Le<Ce.length;Le++){const Xe=Ce[Le];if(Se.hasRenderableParent(Xe))continue;const ht=Se.getTile(Xe),at=ht.getBucket(Te);if(!at)continue;const st=at.programConfigurations.get(Te.id),lt=pe.useProgram("heatmap",st),Ot=Re.getProjectionData({overscaledTileID:Xe,applyGlobeMatrix:!0,applyTerrainMatrix:!1}),Bt=Re.getCircleRadiusCorrection();lt.draw(Ie,ke.TRIANGLES,Mr.disabled,ze,He,Qr.backCCW,lv(ht,Re.zoom,Te.paint.get("heatmap-intensity"),Bt),null,Ot,Te.id,at.layoutVertexBuffer,at.indexBuffer,at.segments,Te.paint,Re.zoom,st)}Ie.viewport.set([0,0,pe.width,pe.height])})(N,H,j,Y):N.renderPass==="translucent"&&(function(pe,Se){const Te=pe.context,Ce=Te.gl;Te.setColorMode(pe.colorModeForRenderPass());const Ie=Se.heatmapFbos.get(o.c3);Ie&&(Te.activeTexture.set(Ce.TEXTURE0),Ce.bindTexture(Ce.TEXTURE_2D,Ie.colorAttachment.get()),Te.activeTexture.set(Ce.TEXTURE1),ma(Te,Se).bind(Ce.LINEAR,Ce.CLAMP_TO_EDGE),pe.useProgram("heatmapTexture").draw(Te,Ce.TRIANGLES,Mr.disabled,Hr.disabled,pe.colorModeForRenderPass(),Qr.disabled,jy(pe,Se,0,1),null,null,Se.id,pe.viewportBuffer,pe.quadTriangleIndexBuffer,pe.viewportSegments,Se.paint,pe.transform.zoom))})(N,j)})(u,m,w,M,R):o.cf(w)?(function(N,H,j,Y,K){if(N.renderPass!=="translucent")return;const{isRenderingToTexture:ie}=K,re=j.paint.get("line-opacity"),ue=j.paint.get("line-width");if(re.constantOr(1)===0||ue.constantOr(1)===0)return;const pe=N.getDepthModeForSublayer(0,Mr.ReadOnly),Se=N.colorModeForRenderPass(),Te=j.paint.get("line-dasharray"),Ce=Te.constantOr(1),Ie=j.paint.get("line-pattern"),ke=Ie.constantOr(1),Re=j.paint.get("line-gradient"),ze=j.getCrossfadeParameters();let He;He=ke?"linePattern":Ce&&Re?"lineGradientSDF":Ce?"lineSDF":Re?"lineGradient":"line";const Le=N.context,Xe=Le.gl,ht=N.transform;let at=!0;for(const st of Y){const lt=H.getTile(st);if(ke&&!lt.patternsLoaded())continue;const Ot=lt.getBucket(j);if(!Ot)continue;const Bt=Ot.programConfigurations.get(j.id),Ct=N.context.program.get(),nr=N.useProgram(He,Bt),Pr=at||nr.program!==Ct,gi=N.style.map.terrain&&N.style.map.terrain.getTerrainData(st),Mi=Ie.constantOr(null),Ei=Te&&Te.constantOr(null);if(Mi&&lt.imageAtlas){const ba=lt.imageAtlas,kn=ba.patternPositions[Mi.to.toString()],Ln=ba.patternPositions[Mi.from.toString()];kn&&Ln&&Bt.setConstantPatternPositions(kn,Ln)}else if(Ei){const ba=j.layout.get("line-cap")==="round",kn=N.lineAtlas.getDash(Ei.to,ba),Ln=N.lineAtlas.getDash(Ei.from,ba);Bt.setConstantDashPositions(kn,Ln)}const Ji=ht.getProjectionData({overscaledTileID:st,applyGlobeMatrix:!ie,applyTerrainMatrix:!0}),$i=ht.getPixelScale();let Jr;ke?(Jr=Iu(N,lt,j,$i,ze),_l(Le,Xe,lt,Bt,ze)):Ce&&Re?(Jr=Cp(N,lt,j,$i,ze,Ot.lineClipsArray.length),xv(N,H,Le,Xe,j,Ot,st,Bt,ze)):Ce?(Jr=cv(N,lt,j,$i,ze),bo(N,Le,Xe,Bt,Pr,ze)):Re?(Jr=id(N,lt,j,$i,Ot.lineClipsArray.length),Wl(N,H,Le,Xe,j,Ot,st)):Jr=rd(N,lt,j,$i);const fn=N.stencilModeForClipping(st);nr.draw(Le,Xe.TRIANGLES,pe,fn,Se,Qr.disabled,Jr,gi,Ji,j.id,Ot.layoutVertexBuffer,Ot.indexBuffer,Ot.segments,j.paint,N.transform.zoom,Bt,Ot.layoutVertexBuffer2),at=!1}})(u,m,w,M,R):o.cg(w)?(function(N,H,j,Y,K){const ie=j.paint.get("fill-color"),re=j.paint.get("fill-opacity");if(re.constantOr(1)===0)return;const{isRenderingToTexture:ue}=K,pe=N.colorModeForRenderPass(),Se=j.paint.get("fill-pattern"),Te=N.opaquePassEnabledForLayer()&&!Se.constantOr(1)&&ie.constantOr(o.bf.transparent).a===1&&re.constantOr(0)===1?"opaque":"translucent";if(N.renderPass===Te){const Ce=N.getDepthModeForSublayer(1,N.renderPass==="opaque"?Mr.ReadWrite:Mr.ReadOnly);Zh(N,H,j,Y,Ce,pe,!1,ue)}if(N.renderPass==="translucent"&&j.paint.get("fill-antialias")){const Ce=N.getDepthModeForSublayer(j.getPaintProperty("fill-outline-color")?2:0,Mr.ReadOnly);Zh(N,H,j,Y,Ce,pe,!0,ue)}})(u,m,w,M,R):o.ch(w)?(function(N,H,j,Y,K){const ie=j.paint.get("fill-extrusion-opacity");if(ie===0)return;const{isRenderingToTexture:re}=K;if(N.renderPass==="translucent"){const ue=new Mr(N.context.gl.LEQUAL,Mr.ReadWrite,N.depthRangeFor3D);if(ie!==1||j.paint.get("fill-extrusion-pattern").constantOr(1))dd(N,H,j,Y,ue,Hr.disabled,Di.disabled,re),dd(N,H,j,Y,ue,N.stencilModeFor3D(),N.colorModeForRenderPass(),re);else{const pe=N.colorModeForRenderPass();dd(N,H,j,Y,ue,Hr.disabled,pe,re)}}})(u,m,w,M,R):o.ci(w)?(function(N,H,j,Y,K){if(N.renderPass!=="offscreen"&&N.renderPass!=="translucent")return;const{isRenderingToTexture:ie}=K,re=N.context,ue=N.style.projection.useSubdivision,pe=N.getDepthModeForSublayer(0,Mr.ReadOnly),Se=N.colorModeForRenderPass();if(N.renderPass==="offscreen")(function(Te,Ce,Ie,ke,Re,ze,He){const Le=Te.context,Xe=Le.gl;for(const ht of Ie){const at=Ce.getTile(ht),st=at.dem;if(!st||!st.data||!at.needsHillshadePrepare)continue;const lt=st.dim,Ot=st.stride,Bt=st.getPixels();if(Le.activeTexture.set(Xe.TEXTURE1),Le.pixelStoreUnpackPremultiplyAlpha.set(!1),at.demTexture=at.demTexture||Te.getTileTexture(Ot),at.demTexture){const nr=at.demTexture;nr.update(Bt,{premultiply:!1}),nr.bind(Xe.NEAREST,Xe.CLAMP_TO_EDGE)}else at.demTexture=new o.T(Le,Bt,Xe.RGBA,{premultiply:!1}),at.demTexture.bind(Xe.NEAREST,Xe.CLAMP_TO_EDGE);Le.activeTexture.set(Xe.TEXTURE0);let Ct=at.fbo;if(!Ct){const nr=new o.T(Le,{width:lt,height:lt,data:null},Xe.RGBA);nr.bind(Xe.LINEAR,Xe.CLAMP_TO_EDGE),Ct=at.fbo=Le.createFramebuffer(lt,lt,!0,!1),Ct.colorAttachment.set(nr.texture)}Le.bindFramebuffer.set(Ct.framebuffer),Le.viewport.set([0,0,lt,lt]),Te.useProgram("hillshadePrepare").draw(Le,Xe.TRIANGLES,Re,ze,He,Qr.disabled,Ap(at.tileID,st),null,null,ke.id,Te.rasterBoundsBuffer,Te.quadTriangleIndexBuffer,Te.rasterBoundsSegments),at.needsHillshadePrepare=!1}})(N,H,Y,j,pe,Hr.disabled,Se),re.viewport.set([0,0,N.width,N.height]);else if(N.renderPass==="translucent")if(ue){const[Te,Ce,Ie]=N.stencilConfigForOverlapTwoPass(Y);Gn(N,H,j,Ie,Te,pe,Se,!1,ie),Gn(N,H,j,Ie,Ce,pe,Se,!0,ie)}else{const[Te,Ce]=N.getStencilConfigForOverlapAndUpdateStencilID(Y);Gn(N,H,j,Ce,Te,pe,Se,!1,ie)}})(u,m,w,M,R):o.cj(w)?(function(N,H,j,Y,K){if(N.renderPass!=="translucent"||!Y.length)return;const{isRenderingToTexture:ie}=K,re=N.style.projection.useSubdivision,ue=N.getDepthModeForSublayer(0,Mr.ReadOnly),pe=N.colorModeForRenderPass();if(re){const[Se,Te,Ce]=N.stencilConfigForOverlapTwoPass(Y);Oi(N,H,j,Ce,Se,ue,pe,!1,ie),Oi(N,H,j,Ce,Te,ue,pe,!0,ie)}else{const[Se,Te]=N.getStencilConfigForOverlapAndUpdateStencilID(Y);Oi(N,H,j,Te,Se,ue,pe,!1,ie)}})(u,m,w,M,R):o.bK(w)?(function(N,H,j,Y,K){if(N.renderPass!=="translucent"||j.paint.get("raster-opacity")===0||!Y.length)return;const{isRenderingToTexture:ie}=K,re=H.getSource(),ue=N.style.projection.useSubdivision;if(re instanceof Li)Vs(N,H,j,Y,null,!1,!1,re.tileCoords,re.flippedWindingOrder,ie);else if(ue){const[pe,Se,Te]=N.stencilConfigForOverlapTwoPass(Y);Vs(N,H,j,Te,pe,!1,!0,ai,!1,ie),Vs(N,H,j,Te,Se,!0,!0,ai,!1,ie)}else{const[pe,Se]=N.getStencilConfigForOverlapAndUpdateStencilID(Y);Vs(N,H,j,Se,pe,!1,!0,ai,!1,ie)}})(u,m,w,M,R):o.ck(w)?(function(N,H,j,Y,K){const ie=j.paint.get("background-color"),re=j.paint.get("background-opacity");if(re===0)return;const{isRenderingToTexture:ue}=K,pe=N.context,Se=pe.gl,Te=N.style.projection,Ce=N.transform,Ie=Ce.tileSize,ke=j.paint.get("background-pattern");if(N.isPatternMissing(ke))return;const Re=!ke&&ie.a===1&&re===1&&N.opaquePassEnabledForLayer()?"opaque":"translucent";if(N.renderPass!==Re)return;const ze=Hr.disabled,He=N.getDepthModeForSublayer(0,Re==="opaque"?Mr.ReadWrite:Mr.ReadOnly),Le=N.colorModeForRenderPass(),Xe=N.useProgram(ke?"backgroundPattern":"background"),ht=Y||Kr(Ce,{tileSize:Ie,terrain:N.style.map.terrain});ke&&(pe.activeTexture.set(Se.TEXTURE0),N.imageManager.bind(N.context));const at=j.getCrossfadeParameters();for(const st of ht){const lt=Ce.getProjectionData({overscaledTileID:st,applyGlobeMatrix:!ue,applyTerrainMatrix:!0}),Ot=ke?dv(re,N,ke,{tileID:st,tileSize:Ie},at):Xy(re,ie),Bt=N.style.map.terrain&&N.style.map.terrain.getTerrainData(st),Ct=Te.getMeshFromTileID(pe,st.canonical,!1,!0,"raster");Xe.draw(pe,Se.TRIANGLES,He,ze,Le,Qr.backCCW,Ot,Bt,lt,j.id,Ct.vertexBuffer,Ct.indexBuffer,Ct.segments)}})(u,0,w,M,R):o.cl(w)&&(function(N,H,j,Y){const{isRenderingGlobe:K}=Y,ie=N.context,re=j.implementation,ue=N.style.projection,pe=N.transform,Se=pe.getProjectionDataForCustomLayer(K),Te={farZ:pe.farZ,nearZ:pe.nearZ,fov:pe.fov*Math.PI/180,modelViewProjectionMatrix:pe.modelViewProjectionMatrix,projectionMatrix:pe.projectionMatrix,shaderData:{variantName:ue.shaderVariantName,vertexShaderPrelude:`const float PI = 3.141592653589793;
uniform mat4 u_projection_matrix;
${ue.shaderPreludeCode.vertexSource}`,define:ue.shaderDefine},defaultProjectionData:Se},Ce=re.renderingMode?re.renderingMode:"2d";if(N.renderPass==="offscreen"){const Ie=re.prerender;Ie&&(N.setCustomLayerDefaults(),ie.setColorMode(N.colorModeForRenderPass()),Ie.call(re,ie.gl,Te),ie.setDirty(),N.setBaseState())}else if(N.renderPass==="translucent"){N.setCustomLayerDefaults(),ie.setColorMode(N.colorModeForRenderPass()),ie.setStencilMode(Hr.disabled);const Ie=Ce==="3d"?N.getDepthModeFor3D():N.getDepthModeForSublayer(0,Mr.ReadOnly);ie.setDepthMode(Ie),re.render(ie.gl,Te),ie.setDirty(),N.setBaseState(),ie.bindFramebuffer.set(null)}})(u,0,w,R))}saveTileTexture(u){const m=this._tileTextures[u.size[0]];m?m.push(u):this._tileTextures[u.size[0]]=[u]}getTileTexture(u){const m=this._tileTextures[u];return m&&m.length>0?m.pop():null}isPatternMissing(u){if(!u)return!1;if(!u.from||!u.to)return!0;const m=this.imageManager.getPattern(u.from.toString()),w=this.imageManager.getPattern(u.to.toString());return!m||!w}useProgram(u,m,w=!1,M=[]){this.cache=this.cache||{};const R=!!this.style.map.terrain,N=this.style.projection,H=w?Ba.projectionMercator:N.shaderPreludeCode,j=w?Rc:N.shaderDefine,Y=u+(m?m.cacheKey:"")+`/${w?Zr:N.shaderVariantName}`+(this._showOverdrawInspector?"/overdraw":"")+(R?"/terrain":"")+(M?`/${M.join("/")}`:"");return this.cache[Y]||(this.cache[Y]=new ov(this.context,Ba[u],m,Pu[u],this._showOverdrawInspector,R,H,j,M)),this.cache[Y]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const u=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(u.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new o.T(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this.debugOverlayTexture&&this.debugOverlayTexture.destroy()}overLimit(){const{drawingBufferWidth:u,drawingBufferHeight:m}=this.context.gl;return this.width!==u||this.height!==m}}function Hs(I,u){let m,w=!1,M=null,R=null;const N=()=>{M=null,w&&(I.apply(R,m),M=setTimeout(N,u),w=!1)};return(...H)=>(w=!0,R=this,m=H,M||N(),M)}class pd{constructor(u){this._getCurrentHash=()=>{const m=window.location.hash.replace("#","");if(this._hashName){let w;return m.split("&").map((M=>M.split("="))).forEach((M=>{M[0]===this._hashName&&(w=M)})),(w&&w[1]||"").split("/")}return m.split("/")},this._onHashChange=()=>{const m=this._getCurrentHash();if(!this._isValidHash(m))return!1;const w=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(m[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+m[2],+m[1]],zoom:+m[0],bearing:w,pitch:+(m[4]||0)}),!0},this._updateHashUnthrottled=()=>{const m=window.location.href.replace(/(#.*)?$/,this.getHashString());window.history.replaceState(window.history.state,null,m)},this._removeHash=()=>{const m=this._getCurrentHash();if(m.length===0)return;const w=m.join("/");let M=w;M.split("&").length>0&&(M=M.split("&")[0]),this._hashName&&(M=`${this._hashName}=${w}`);let R=window.location.hash.replace(M,"");R.startsWith("#&")?R=R.slice(0,1)+R.slice(2):R==="#"&&(R="");let N=window.location.href.replace(/(#.+)?$/,R);N=N.replace("&&","&"),window.history.replaceState(window.history.state,null,N)},this._updateHash=Hs(this._updateHashUnthrottled,300),this._hashName=u&&encodeURIComponent(u)}addTo(u){return this._map=u,addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),this._removeHash(),delete this._map,this}getHashString(u){const m=this._map.getCenter(),w=Math.round(100*this._map.getZoom())/100,M=Math.ceil((w*Math.LN2+Math.log(512/360/.5))/Math.LN10),R=Math.pow(10,M),N=Math.round(m.lng*R)/R,H=Math.round(m.lat*R)/R,j=this._map.getBearing(),Y=this._map.getPitch();let K="";if(K+=u?`/${N}/${H}/${w}`:`${w}/${H}/${N}`,(j||Y)&&(K+="/"+Math.round(10*j)/10),Y&&(K+=`/${Math.round(Y)}`),this._hashName){const ie=this._hashName;let re=!1;const ue=window.location.hash.slice(1).split("&").map((pe=>{const Se=pe.split("=")[0];return Se===ie?(re=!0,`${Se}=${K}`):pe})).filter((pe=>pe));return re||ue.push(`${ie}=${K}`),`#${ue.join("&")}`}return`#${K}`}_isValidHash(u){if(u.length<3||u.some(isNaN))return!1;try{new o.S(+u[2],+u[1])}catch{return!1}const m=+u[0],w=+(u[3]||0),M=+(u[4]||0);return m>=this._map.getMinZoom()&&m<=this._map.getMaxZoom()&&w>=-180&&w<=180&&M>=this._map.getMinPitch()&&M<=this._map.getMaxPitch()}}const Ou={linearity:.3,easing:o.cm(0,0,.3,1)},ls=o.e({deceleration:2500,maxSpeed:1400},Ou),gd=o.e({deceleration:20,maxSpeed:1400},Ou),Nu=o.e({deceleration:1e3,maxSpeed:360},Ou),ya=o.e({deceleration:1e3,maxSpeed:90},Ou),vd=o.e({deceleration:1e3,maxSpeed:360},Ou);class wv{constructor(u){this._map=u,this.clear()}clear(){this._inertiaBuffer=[]}record(u){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:y.now(),settings:u})}_drainInertiaBuffer(){const u=this._inertiaBuffer,m=y.now();for(;u.length>0&&m-u[0].time>160;)u.shift()}_onMoveEnd(u){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const m={zoom:0,bearing:0,pitch:0,roll:0,pan:new o.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:R}of this._inertiaBuffer)m.zoom+=R.zoomDelta||0,m.bearing+=R.bearingDelta||0,m.pitch+=R.pitchDelta||0,m.roll+=R.rollDelta||0,R.panDelta&&m.pan._add(R.panDelta),R.around&&(m.around=R.around),R.pinchAround&&(m.pinchAround=R.pinchAround);const w=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,M={};if(m.pan.mag()){const R=Yh(m.pan.mag(),w,o.e({},ls,u||{})),N=m.pan.mult(R.amount/m.pan.mag()),H=this._map.cameraHelper.handlePanInertia(N,this._map.transform);M.center=H.easingCenter,M.offset=H.easingOffset,qh(M,R)}if(m.zoom){const R=Yh(m.zoom,w,gd);M.zoom=this._map.transform.zoom+R.amount,qh(M,R)}if(m.bearing){const R=Yh(m.bearing,w,Nu);M.bearing=this._map.transform.bearing+o.ah(R.amount,-179,179),qh(M,R)}if(m.pitch){const R=Yh(m.pitch,w,ya);M.pitch=this._map.transform.pitch+R.amount,qh(M,R)}if(m.roll){const R=Yh(m.roll,w,vd);M.roll=this._map.transform.roll+o.ah(R.amount,-179,179),qh(M,R)}if(M.zoom||M.bearing){const R=m.pinchAround===void 0?m.around:m.pinchAround;M.around=R?this._map.unproject(R):this._map.getCenter()}return this.clear(),o.e(M,{noMoveStart:!0})}}function qh(I,u){(!I.duration||I.duration<u.duration)&&(I.duration=u.duration,I.easing=u.easing)}function Yh(I,u,m){const{maxSpeed:w,linearity:M,deceleration:R}=m,N=o.ah(I*M/(u/1e3),-w,w),H=Math.abs(N)/(R*M);return{easing:m.easing,duration:1e3*H,amount:N*(H/2)}}class wo extends o.l{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(u,m,w,M={}){w=w instanceof MouseEvent?w:new MouseEvent(u,w);const R=b.mousePos(m.getCanvas(),w),N=m.unproject(R);super(u,o.e({point:R,lngLat:N,originalEvent:w},M)),this._defaultPrevented=!1,this.target=m}}class Yi extends o.l{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(u,m,w){const M=u==="touchend"?w.changedTouches:w.touches,R=b.touchPos(m.getCanvasContainer(),M),N=R.map((j=>m.unproject(j))),H=R.reduce(((j,Y,K,ie)=>j.add(Y.div(ie.length))),new o.P(0,0));super(u,{points:R,point:H,lngLats:N,lngLat:m.unproject(H),originalEvent:w}),this._defaultPrevented=!1}}class md extends o.l{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(u,m,w){super(u,{originalEvent:w}),this._defaultPrevented=!1}}class Fa{constructor(u,m){this._map=u,this._clickTolerance=m.clickTolerance}reset(){delete this._mousedownPos}wheel(u){return this._firePreventable(new md(u.type,this._map,u))}mousedown(u,m){return this._mousedownPos=m,this._firePreventable(new wo(u.type,this._map,u))}mouseup(u){this._map.fire(new wo(u.type,this._map,u))}click(u,m){this._mousedownPos&&this._mousedownPos.dist(m)>=this._clickTolerance||this._map.fire(new wo(u.type,this._map,u))}dblclick(u){return this._firePreventable(new wo(u.type,this._map,u))}mouseover(u){this._map.fire(new wo(u.type,this._map,u))}mouseout(u){this._map.fire(new wo(u.type,this._map,u))}touchstart(u){return this._firePreventable(new Yi(u.type,this._map,u))}touchmove(u){this._map.fire(new Yi(u.type,this._map,u))}touchend(u){this._map.fire(new Yi(u.type,this._map,u))}touchcancel(u){this._map.fire(new Yi(u.type,this._map,u))}_firePreventable(u){if(this._map.fire(u),u.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class ro{constructor(u){this._map=u}reset(){this._delayContextMenu=!1,this._ignoreContextMenu=!0,delete this._contextMenuEvent}mousemove(u){this._map.fire(new wo(u.type,this._map,u))}mousedown(){this._delayContextMenu=!0,this._ignoreContextMenu=!1}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new wo("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(u){this._delayContextMenu?this._contextMenuEvent=u:this._ignoreContextMenu||this._map.fire(new wo(u.type,this._map,u)),this._map.listens("contextmenu")&&u.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Bu{constructor(u){this._map=u}get transform(){return this._map._requestedCameraState||this._map.transform}get center(){return{lng:this.transform.center.lng,lat:this.transform.center.lat}}get zoom(){return this.transform.zoom}get pitch(){return this.transform.pitch}get bearing(){return this.transform.bearing}unproject(u){return this.transform.screenPointToLocation(o.P.convert(u),this._map.terrain)}}class Ea{constructor(u,m){this._map=u,this._tr=new Bu(u),this._el=u.getCanvasContainer(),this._container=u.getContainer(),this._clickTolerance=m.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(u,m){this.isEnabled()&&u.shiftKey&&u.button===0&&(b.disableDrag(),this._startPos=this._lastPos=m,this._active=!0)}mousemoveWindow(u,m){if(!this._active)return;const w=m;if(this._lastPos.equals(w)||!this._box&&w.dist(this._startPos)<this._clickTolerance)return;const M=this._startPos;this._lastPos=w,this._box||(this._box=b.create("div","maplibregl-boxzoom",this._container),this._container.classList.add("maplibregl-crosshair"),this._fireEvent("boxzoomstart",u));const R=Math.min(M.x,w.x),N=Math.max(M.x,w.x),H=Math.min(M.y,w.y),j=Math.max(M.y,w.y);b.setTransform(this._box,`translate(${R}px,${H}px)`),this._box.style.width=N-R+"px",this._box.style.height=j-H+"px"}mouseupWindow(u,m){if(!this._active||u.button!==0)return;const w=this._startPos,M=m;if(this.reset(),b.suppressClick(),w.x!==M.x||w.y!==M.y)return this._map.fire(new o.l("boxzoomend",{originalEvent:u})),{cameraAnimation:R=>R.fitScreenCoordinates(w,M,this._tr.bearing,{linear:!0})};this._fireEvent("boxzoomcancel",u)}keydown(u){this._active&&u.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",u))}reset(){this._active=!1,this._container.classList.remove("maplibregl-crosshair"),this._box&&(b.remove(this._box),this._box=null),b.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(u,m){return this._map.fire(new o.l(u,{originalEvent:m}))}}function Ho(I,u){if(I.length!==u.length)throw new Error(`The number of touches and points are not equal - touches ${I.length}, points ${u.length}`);const m={};for(let w=0;w<I.length;w++)m[I[w].identifier]=u[w];return m}class Mb{constructor(u){this.reset(),this.numTouches=u.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(u,m,w){(this.centroid||w.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=u.timeStamp),w.length===this.numTouches&&(this.centroid=(function(M){const R=new o.P(0,0);for(const N of M)R._add(N);return R.div(M.length)})(m),this.touches=Ho(w,m)))}touchmove(u,m,w){if(this.aborted||!this.centroid)return;const M=Ho(w,m);for(const R in this.touches){const N=M[R];(!N||N.dist(this.touches[R])>30)&&(this.aborted=!0)}}touchend(u,m,w){if((!this.centroid||u.timeStamp-this.startTime>500)&&(this.aborted=!0),w.length===0){const M=!this.aborted&&this.centroid;if(this.reset(),M)return M}}}class Op{constructor(u){this.singleTap=new Mb(u),this.numTaps=u.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(u,m,w){this.singleTap.touchstart(u,m,w)}touchmove(u,m,w){this.singleTap.touchmove(u,m,w)}touchend(u,m,w){const M=this.singleTap.touchend(u,m,w);if(M){const R=u.timeStamp-this.lastTime<500,N=!this.lastTap||this.lastTap.dist(M)<30;if(R&&N||this.reset(),this.count++,this.lastTime=u.timeStamp,this.lastTap=M,this.count===this.numTaps)return this.reset(),M}}}class Eb{constructor(u){this._tr=new Bu(u),this._zoomIn=new Op({numTouches:1,numTaps:2}),this._zoomOut=new Op({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(u,m,w){this._zoomIn.touchstart(u,m,w),this._zoomOut.touchstart(u,m,w)}touchmove(u,m,w){this._zoomIn.touchmove(u,m,w),this._zoomOut.touchmove(u,m,w)}touchend(u,m,w){const M=this._zoomIn.touchend(u,m,w),R=this._zoomOut.touchend(u,m,w),N=this._tr;return M?(this._active=!0,u.preventDefault(),setTimeout((()=>this.reset()),0),{cameraAnimation:H=>H.easeTo({duration:300,zoom:N.zoom+1,around:N.unproject(M)},{originalEvent:u})}):R?(this._active=!0,u.preventDefault(),setTimeout((()=>this.reset()),0),{cameraAnimation:H=>H.easeTo({duration:300,zoom:N.zoom-1,around:N.unproject(R)},{originalEvent:u})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Kh{constructor(u){this._enabled=!!u.enable,this._moveStateManager=u.moveStateManager,this._clickTolerance=u.clickTolerance||1,this._moveFunction=u.move,this._activateOnStart=!!u.activateOnStart,u.assignEvents(this),this.reset()}reset(u){this._active=!1,this._moved=!1,delete this._lastPoint,this._moveStateManager.endMove(u)}_move(...u){const m=this._moveFunction(...u);if(m.bearingDelta||m.pitchDelta||m.rollDelta||m.around||m.panDelta)return this._active=!0,m}dragStart(u,m){this.isEnabled()&&!this._lastPoint&&this._moveStateManager.isValidStartEvent(u)&&(this._moveStateManager.startMove(u),this._lastPoint=Array.isArray(m)?m[0]:m,this._activateOnStart&&this._lastPoint&&(this._active=!0))}dragMove(u,m){if(!this.isEnabled())return;const w=this._lastPoint;if(!w)return;if(u.preventDefault(),!this._moveStateManager.isValidMoveEvent(u))return void this.reset(u);const M=Array.isArray(m)?m[0]:m;return!this._moved&&M.dist(w)<this._clickTolerance?void 0:(this._moved=!0,this._lastPoint=M,this._move(w,M))}dragEnd(u){this.isEnabled()&&this._lastPoint&&this._moveStateManager.isValidEndEvent(u)&&(this._moved&&b.suppressClick(),this.reset(u))}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}getClickTolerance(){return this._clickTolerance}}const zu=0,Zc=2,us={[zu]:1,[Zc]:2};class Zt{constructor(u){this._correctEvent=u.checkCorrectEvent}startMove(u){const m=b.mouseButton(u);this._eventButton=m}endMove(u){delete this._eventButton}isValidStartEvent(u){return this._correctEvent(u)}isValidMoveEvent(u){return!(function(m,w){const M=us[w];return m.buttons===void 0||(m.buttons&M)!==M})(u,this._eventButton)}isValidEndEvent(u){return b.mouseButton(u)===this._eventButton}}class qc{constructor(){this._firstTouch=void 0}_isOneFingerTouch(u){return u.targetTouches.length===1}_isSameTouchEvent(u){return u.targetTouches[0].identifier===this._firstTouch}startMove(u){this._firstTouch=u.targetTouches[0].identifier}endMove(u){delete this._firstTouch}isValidStartEvent(u){return this._isOneFingerTouch(u)}isValidMoveEvent(u){return this._isOneFingerTouch(u)&&this._isSameTouchEvent(u)}isValidEndEvent(u){return this._isOneFingerTouch(u)&&this._isSameTouchEvent(u)}}class yd{constructor(u=new Zt({checkCorrectEvent:()=>!0}),m=new qc){this.mouseMoveStateManager=u,this.oneFingerTouchMoveStateManager=m}_executeRelevantHandler(u,m,w){return u instanceof MouseEvent?m(u):typeof TouchEvent<"u"&&u instanceof TouchEvent?w(u):void 0}startMove(u){this._executeRelevantHandler(u,(m=>this.mouseMoveStateManager.startMove(m)),(m=>this.oneFingerTouchMoveStateManager.startMove(m)))}endMove(u){this._executeRelevantHandler(u,(m=>this.mouseMoveStateManager.endMove(m)),(m=>this.oneFingerTouchMoveStateManager.endMove(m)))}isValidStartEvent(u){return this._executeRelevantHandler(u,(m=>this.mouseMoveStateManager.isValidStartEvent(m)),(m=>this.oneFingerTouchMoveStateManager.isValidStartEvent(m)))}isValidMoveEvent(u){return this._executeRelevantHandler(u,(m=>this.mouseMoveStateManager.isValidMoveEvent(m)),(m=>this.oneFingerTouchMoveStateManager.isValidMoveEvent(m)))}isValidEndEvent(u){return this._executeRelevantHandler(u,(m=>this.mouseMoveStateManager.isValidEndEvent(m)),(m=>this.oneFingerTouchMoveStateManager.isValidEndEvent(m)))}}const Fu=I=>{I.mousedown=I.dragStart,I.mousemoveWindow=I.dragMove,I.mouseup=I.dragEnd,I.contextmenu=u=>{u.preventDefault()}};class Vu{constructor(u,m){this._clickTolerance=u.clickTolerance||1,this._map=m,this.reset()}reset(){this._active=!1,this._touches={},this._sum=new o.P(0,0)}_shouldBePrevented(u){return u<(this._map.cooperativeGestures.isEnabled()?2:1)}touchstart(u,m,w){return this._calculateTransform(u,m,w)}touchmove(u,m,w){if(this._active){if(!this._shouldBePrevented(w.length))return u.preventDefault(),this._calculateTransform(u,m,w);this._map.cooperativeGestures.notifyGestureBlocked("touch_pan",u)}}touchend(u,m,w){this._calculateTransform(u,m,w),this._active&&this._shouldBePrevented(w.length)&&this.reset()}touchcancel(){this.reset()}_calculateTransform(u,m,w){w.length>0&&(this._active=!0);const M=Ho(w,m),R=new o.P(0,0),N=new o.P(0,0);let H=0;for(const Y in M){const K=M[Y],ie=this._touches[Y];ie&&(R._add(K),N._add(K.sub(ie)),H++,M[Y]=K)}if(this._touches=M,this._shouldBePrevented(H)||!N.mag())return;const j=N.div(H);return this._sum._add(j),this._sum.mag()<this._clickTolerance?void 0:{around:R.div(H),panDelta:j}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Uu{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}touchstart(u,m,w){this._firstTwoTouches||w.length<2||(this._firstTwoTouches=[w[0].identifier,w[1].identifier],this._start([m[0],m[1]]))}touchmove(u,m,w){if(!this._firstTwoTouches)return;u.preventDefault();const[M,R]=this._firstTwoTouches,N=Yc(w,m,M),H=Yc(w,m,R);if(!N||!H)return;const j=this._aroundCenter?null:N.add(H).div(2);return this._move([N,H],j,u)}touchend(u,m,w){if(!this._firstTwoTouches)return;const[M,R]=this._firstTwoTouches,N=Yc(w,m,M),H=Yc(w,m,R);N&&H||(this._active&&b.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(u){this._enabled=!0,this._aroundCenter=!!u&&u.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}}function Yc(I,u,m){for(let w=0;w<I.length;w++)if(I[w].identifier===m)return u[w]}function zr(I,u){return Math.log(I/u)/Math.LN2}class wl extends Uu{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(u){this._startDistance=this._distance=u[0].dist(u[1])}_move(u,m){const w=this._distance;if(this._distance=u[0].dist(u[1]),this._active||!(Math.abs(zr(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:zr(this._distance,w),pinchAround:m}}}function Sv(I,u){return 180*I.angleWith(u)/Math.PI}class _d extends Uu{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(u){this._startVector=this._vector=u[0].sub(u[1]),this._minDiameter=u[0].dist(u[1])}_move(u,m,w){const M=this._vector;if(this._vector=u[0].sub(u[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:Sv(this._vector,M),pinchAround:m}}_isBelowThreshold(u){this._minDiameter=Math.min(this._minDiameter,u.mag());const m=25/(Math.PI*this._minDiameter)*360,w=Sv(u,this._startVector);return Math.abs(w)<m}}function Hu(I){return Math.abs(I.y)>Math.abs(I.x)}class Qh extends Uu{constructor(u){super(),this._currentTouchCount=0,this._map=u}reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}touchstart(u,m,w){super.touchstart(u,m,w),this._currentTouchCount=w.length}_start(u){this._lastPoints=u,Hu(u[0].sub(u[1]))&&(this._valid=!1)}_move(u,m,w){if(this._map.cooperativeGestures.isEnabled()&&this._currentTouchCount<3)return;const M=u[0].sub(this._lastPoints[0]),R=u[1].sub(this._lastPoints[1]);return this._valid=this.gestureBeginsVertically(M,R,w.timeStamp),this._valid?(this._lastPoints=u,this._active=!0,{pitchDelta:(M.y+R.y)/2*-.5}):void 0}gestureBeginsVertically(u,m,w){if(this._valid!==void 0)return this._valid;const M=u.mag()>=2,R=m.mag()>=2;if(!M&&!R)return;if(!M||!R)return this._firstMove===void 0&&(this._firstMove=w),w-this._firstMove<100&&void 0;const N=u.y>0==m.y>0;return Hu(u)&&Hu(m)&&N}}const bd={panStep:100,bearingStep:15,pitchStep:10};class ju{constructor(u){this._tr=new Bu(u);const m=bd;this._panStep=m.panStep,this._bearingStep=m.bearingStep,this._pitchStep=m.pitchStep,this._rotationDisabled=!1}reset(){this._active=!1}keydown(u){if(u.altKey||u.ctrlKey||u.metaKey)return;let m=0,w=0,M=0,R=0,N=0;switch(u.keyCode){case 61:case 107:case 171:case 187:m=1;break;case 189:case 109:case 173:m=-1;break;case 37:u.shiftKey?w=-1:(u.preventDefault(),R=-1);break;case 39:u.shiftKey?w=1:(u.preventDefault(),R=1);break;case 38:u.shiftKey?M=1:(u.preventDefault(),N=-1);break;case 40:u.shiftKey?M=-1:(u.preventDefault(),N=1);break;default:return}return this._rotationDisabled&&(w=0,M=0),{cameraAnimation:H=>{const j=this._tr;H.easeTo({duration:300,easeId:"keyboardHandler",easing:xd,zoom:m?Math.round(j.zoom)+m*(u.shiftKey?2:1):j.zoom,bearing:j.bearing+w*this._bearingStep,pitch:j.pitch+M*this._pitchStep,offset:[-R*this._panStep,-N*this._panStep],center:j.center},{originalEvent:u})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function xd(I){return I*(2-I)}const Tv=4.000244140625,$u=1/450;class Av{constructor(u,m){this._onTimeout=w=>{this._type="wheel",this._delta-=this._lastValue,this._active||this._start(w)},this._map=u,this._tr=new Bu(u),this._triggerRenderFrame=m,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=$u}setZoomRate(u){this._defaultZoomRate=u}setWheelZoomRate(u){this._wheelZoomRate=u}isEnabled(){return!!this._enabled}isActive(){return!!this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(u){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!u&&u.around==="center")}disable(){this.isEnabled()&&(this._enabled=!1)}_shouldBePrevented(u){return!!this._map.cooperativeGestures.isEnabled()&&!(u.ctrlKey||this._map.cooperativeGestures.isBypassed(u))}wheel(u){if(!this.isEnabled())return;if(this._shouldBePrevented(u))return void this._map.cooperativeGestures.notifyGestureBlocked("wheel_zoom",u);let m=u.deltaMode===WheelEvent.DOM_DELTA_LINE?40*u.deltaY:u.deltaY;const w=y.now(),M=w-(this._lastWheelEventTime||0);this._lastWheelEventTime=w,m!==0&&m%Tv==0?this._type="wheel":m!==0&&Math.abs(m)<4?this._type="trackpad":M>400?(this._type=null,this._lastValue=m,this._timeout=setTimeout(this._onTimeout,40,u)):this._type||(this._type=Math.abs(M*m)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,m+=this._lastValue)),u.shiftKey&&m&&(m/=4),this._type&&(this._lastWheelEvent=u,this._delta-=m,this._active||this._start(u)),u.preventDefault()}_start(u){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const m=b.mousePos(this._map.getCanvas(),u),w=this._tr;this._aroundPoint=this._aroundCenter?w.transform.locationToScreenPoint(o.S.convert(w.center)):m,this._frameId||(this._frameId=!0,this._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const u=this._tr.transform;if(typeof this._lastExpectedZoom=="number"){const H=u.zoom-this._lastExpectedZoom;typeof this._startZoom=="number"&&(this._startZoom+=H),typeof this._targetZoom=="number"&&(this._targetZoom+=H)}if(this._delta!==0){const H=this._type==="wheel"&&Math.abs(this._delta)>Tv?this._wheelZoomRate:this._defaultZoomRate;let j=2/(1+Math.exp(-Math.abs(this._delta*H)));this._delta<0&&j!==0&&(j=1/j);const Y=typeof this._targetZoom!="number"?u.scale:o.af(this._targetZoom);this._targetZoom=u.getConstrained(u.getCameraLngLat(),o.ak(Y*j)).zoom,this._type==="wheel"&&(this._startZoom=u.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}const m=typeof this._targetZoom!="number"?u.zoom:this._targetZoom,w=this._startZoom,M=this._easing;let R,N=!1;if(this._type==="wheel"&&w&&M){const H=y.now()-this._lastWheelEventTime,j=Math.min((H+5)/200,1),Y=M(j);R=o.C.number(w,m,Y),j<1?this._frameId||(this._frameId=!0):N=!0}else R=m,N=!0;return this._active=!0,N&&(this._active=!1,this._finishTimeout=setTimeout((()=>{this._zooming=!1,this._triggerRenderFrame(),delete this._targetZoom,delete this._lastExpectedZoom,delete this._finishTimeout}),200)),this._lastExpectedZoom=R,{noInertia:!0,needsRenderFrame:!N,zoomDelta:R-u.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}_smoothOutEasing(u){let m=o.co;if(this._prevEase){const w=this._prevEase,M=(y.now()-w.start)/w.duration,R=w.easing(M+.01)-w.easing(M),N=.27/Math.sqrt(R*R+1e-4)*.01,H=Math.sqrt(.0729-N*N);m=o.cm(N,H,.25,1)}return this._prevEase={start:y.now(),duration:u,easing:m},m}reset(){this._active=!1,this._zooming=!1,delete this._targetZoom,delete this._lastExpectedZoom,this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout)}}class Yl{constructor(u,m){this._clickZoom=u,this._tapZoom=m}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class Sl{constructor(u){this._tr=new Bu(u),this.reset()}reset(){this._active=!1}dblclick(u,m){return u.preventDefault(),{cameraAnimation:w=>{w.easeTo({duration:300,zoom:this._tr.zoom+(u.shiftKey?-1:1),around:this._tr.unproject(m)},{originalEvent:u})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Ni{constructor(){this._tap=new Op({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,delete this._tapPoint,this._tap.reset()}touchstart(u,m,w){if(!this._swipePoint)if(this._tapTime){const M=m[0],R=u.timeStamp-this._tapTime<500,N=this._tapPoint.dist(M)<30;R&&N?w.length>0&&(this._swipePoint=M,this._swipeTouch=w[0].identifier):this.reset()}else this._tap.touchstart(u,m,w)}touchmove(u,m,w){if(this._tapTime){if(this._swipePoint){if(w[0].identifier!==this._swipeTouch)return;const M=m[0],R=M.y-this._swipePoint.y;return this._swipePoint=M,u.preventDefault(),this._active=!0,{zoomDelta:R/128}}}else this._tap.touchmove(u,m,w)}touchend(u,m,w){if(this._tapTime)this._swipePoint&&w.length===0&&this.reset();else{const M=this._tap.touchend(u,m,w);M&&(this._tapTime=u.timeStamp,this._tapPoint=M)}}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Kl{constructor(u,m,w){this._el=u,this._mousePan=m,this._touchPan=w}enable(u){this._inertiaOptions=u||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("maplibregl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("maplibregl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class cs{constructor(u,m,w,M){this._pitchWithRotate=u.pitchWithRotate,this._rollEnabled=u.rollEnabled,this._mouseRotate=m,this._mousePitch=w,this._mouseRoll=M}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable(),this._rollEnabled&&this._mouseRoll.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable(),this._mouseRoll.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())&&(!this._rollEnabled||this._mouseRoll.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()||this._mouseRoll.isActive()}}class Wu{constructor(u,m,w,M){this._el=u,this._touchZoom=m,this._touchRotate=w,this._tapDragZoom=M,this._rotationDisabled=!1,this._enabled=!0}enable(u){this._touchZoom.enable(u),this._rotationDisabled||this._touchRotate.enable(u),this._tapDragZoom.enable(),this._el.classList.add("maplibregl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("maplibregl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}class wd{constructor(u,m){this._bypassKey=navigator.userAgent.indexOf("Mac")!==-1?"metaKey":"ctrlKey",this._map=u,this._options=m,this._enabled=!1}isActive(){return!1}reset(){}_setupUI(){if(this._container)return;const u=this._map.getCanvasContainer();u.classList.add("maplibregl-cooperative-gestures"),this._container=b.create("div","maplibregl-cooperative-gesture-screen",u);let m=this._map._getUIString("CooperativeGesturesHandler.WindowsHelpText");this._bypassKey==="metaKey"&&(m=this._map._getUIString("CooperativeGesturesHandler.MacHelpText"));const w=this._map._getUIString("CooperativeGesturesHandler.MobileHelpText"),M=document.createElement("div");M.className="maplibregl-desktop-message",M.textContent=m,this._container.appendChild(M);const R=document.createElement("div");R.className="maplibregl-mobile-message",R.textContent=w,this._container.appendChild(R),this._container.setAttribute("aria-hidden","true")}_destroyUI(){this._container&&(b.remove(this._container),this._map.getCanvasContainer().classList.remove("maplibregl-cooperative-gestures")),delete this._container}enable(){this._setupUI(),this._enabled=!0}disable(){this._enabled=!1,this._destroyUI()}isEnabled(){return this._enabled}isBypassed(u){return u[this._bypassKey]}notifyGestureBlocked(u,m){this._enabled&&(this._map.fire(new o.l("cooperativegestureprevented",{gestureType:u,originalEvent:m})),this._container.classList.add("maplibregl-show"),setTimeout((()=>{this._container.classList.remove("maplibregl-show")}),100))}}const Kc=I=>I.zoom||I.drag||I.roll||I.pitch||I.rotate;class Jh extends o.l{}function Qc(I){return I.panDelta&&I.panDelta.mag()||I.zoomDelta||I.bearingDelta||I.pitchDelta||I.rollDelta}class js{constructor(u,m){this.handleWindowEvent=M=>{this.handleEvent(M,`${M.type}Window`)},this.handleEvent=(M,R)=>{if(M.type==="blur")return void this.stop(!0);this._updatingCamera=!0;const N=M.type==="renderFrame"?void 0:M,H={needsRenderFrame:!1},j={},Y={};for(const{handlerName:re,handler:ue,allowed:pe}of this._handlers){if(!ue.isEnabled())continue;let Se;if(this._blockedByActive(Y,pe,re))ue.reset();else if(ue[R||M.type]){if(o.cp(M,R||M.type)){const Te=b.mousePos(this._map.getCanvas(),M);Se=ue[R||M.type](M,Te)}else if(o.cq(M,R||M.type)){const Te=this._getMapTouches(M.touches),Ce=b.touchPos(this._map.getCanvas(),Te);Se=ue[R||M.type](M,Ce,Te)}else o.cr(R||M.type)||(Se=ue[R||M.type](M));this.mergeHandlerResult(H,j,Se,re,N),Se&&Se.needsRenderFrame&&this._triggerRenderFrame()}(Se||ue.isActive())&&(Y[re]=ue)}const K={};for(const re in this._previousActiveHandlers)Y[re]||(K[re]=N);this._previousActiveHandlers=Y,(Object.keys(K).length||Qc(H))&&(this._changes.push([H,j,K]),this._triggerRenderFrame()),(Object.keys(Y).length||Qc(H))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:ie}=H;ie&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],ie(this._map))},this._map=u,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new wv(u),this._bearingSnap=m.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(m);const w=this._el;this._listeners=[[w,"touchstart",{passive:!0}],[w,"touchmove",{passive:!1}],[w,"touchend",void 0],[w,"touchcancel",void 0],[w,"mousedown",void 0],[w,"mousemove",void 0],[w,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[w,"mouseover",void 0],[w,"mouseout",void 0],[w,"dblclick",void 0],[w,"click",void 0],[w,"keydown",{capture:!1}],[w,"keyup",void 0],[w,"wheel",{passive:!1}],[w,"contextmenu",void 0],[window,"blur",void 0]];for(const[M,R,N]of this._listeners)b.addEventListener(M,R,M===document?this.handleWindowEvent:this.handleEvent,N)}destroy(){for(const[u,m,w]of this._listeners)b.removeEventListener(u,m,u===document?this.handleWindowEvent:this.handleEvent,w)}_addDefaultHandlers(u){const m=this._map,w=m.getCanvasContainer();this._add("mapEvent",new Fa(m,u));const M=m.boxZoom=new Ea(m,u);this._add("boxZoom",M),u.interactive&&u.boxZoom&&M.enable();const R=m.cooperativeGestures=new wd(m,u.cooperativeGestures);this._add("cooperativeGestures",R),u.cooperativeGestures&&R.enable();const N=new Eb(m),H=new Sl(m);m.doubleClickZoom=new Yl(H,N),this._add("tapZoom",N),this._add("clickZoom",H),u.interactive&&u.doubleClickZoom&&m.doubleClickZoom.enable();const j=new Ni;this._add("tapDragZoom",j);const Y=m.touchPitch=new Qh(m);this._add("touchPitch",Y),u.interactive&&u.touchPitch&&m.touchPitch.enable(u.touchPitch);const K=()=>m.project(m.getCenter()),ie=(function({enable:Re,clickTolerance:ze,aroundCenter:He=!0,minPixelCenterThreshold:Le=100,rotateDegreesPerPixelMoved:Xe=.8},ht){const at=new Zt({checkCorrectEvent:st=>b.mouseButton(st)===0&&st.ctrlKey||b.mouseButton(st)===2&&!st.ctrlKey});return new Kh({clickTolerance:ze,move:(st,lt)=>{const Ot=ht();if(He&&Math.abs(Ot.y-st.y)>Le)return{bearingDelta:o.cn(new o.P(st.x,lt.y),lt,Ot)};let Bt=(lt.x-st.x)*Xe;return He&&lt.y<Ot.y&&(Bt=-Bt),{bearingDelta:Bt}},moveStateManager:at,enable:Re,assignEvents:Fu})})(u,K),re=(function({enable:Re,clickTolerance:ze,pitchDegreesPerPixelMoved:He=-.5}){const Le=new Zt({checkCorrectEvent:Xe=>b.mouseButton(Xe)===0&&Xe.ctrlKey||b.mouseButton(Xe)===2});return new Kh({clickTolerance:ze,move:(Xe,ht)=>({pitchDelta:(ht.y-Xe.y)*He}),moveStateManager:Le,enable:Re,assignEvents:Fu})})(u),ue=(function({enable:Re,clickTolerance:ze,rollDegreesPerPixelMoved:He=.3},Le){const Xe=new Zt({checkCorrectEvent:ht=>b.mouseButton(ht)===2&&ht.ctrlKey});return new Kh({clickTolerance:ze,move:(ht,at)=>{const st=Le();let lt=(at.x-ht.x)*He;return at.y<st.y&&(lt=-lt),{rollDelta:lt}},moveStateManager:Xe,enable:Re,assignEvents:Fu})})(u,K);m.dragRotate=new cs(u,ie,re,ue),this._add("mouseRotate",ie,["mousePitch"]),this._add("mousePitch",re,["mouseRotate","mouseRoll"]),this._add("mouseRoll",ue,["mousePitch"]),u.interactive&&u.dragRotate&&m.dragRotate.enable();const pe=(function({enable:Re,clickTolerance:ze}){const He=new Zt({checkCorrectEvent:Le=>b.mouseButton(Le)===0&&!Le.ctrlKey});return new Kh({clickTolerance:ze,move:(Le,Xe)=>({around:Xe,panDelta:Xe.sub(Le)}),activateOnStart:!0,moveStateManager:He,enable:Re,assignEvents:Fu})})(u),Se=new Vu(u,m);m.dragPan=new Kl(w,pe,Se),this._add("mousePan",pe),this._add("touchPan",Se,["touchZoom","touchRotate"]),u.interactive&&u.dragPan&&m.dragPan.enable(u.dragPan);const Te=new _d,Ce=new wl;m.touchZoomRotate=new Wu(w,Ce,Te,j),this._add("touchRotate",Te,["touchPan","touchZoom"]),this._add("touchZoom",Ce,["touchPan","touchRotate"]),u.interactive&&u.touchZoomRotate&&m.touchZoomRotate.enable(u.touchZoomRotate);const Ie=m.scrollZoom=new Av(m,(()=>this._triggerRenderFrame()));this._add("scrollZoom",Ie,["mousePan"]),u.interactive&&u.scrollZoom&&m.scrollZoom.enable(u.scrollZoom);const ke=m.keyboard=new ju(m);this._add("keyboard",ke),u.interactive&&u.keyboard&&m.keyboard.enable(),this._add("blockableMapEvent",new ro(m))}_add(u,m,w){this._handlers.push({handlerName:u,handler:m,allowed:w}),this._handlersById[u]=m}stop(u){if(!this._updatingCamera){for(const{handler:m}of this._handlers)m.reset();this._inertia.clear(),this._fireEvents({},{},u),this._changes=[]}}isActive(){for(const{handler:u}of this._handlers)if(u.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!Kc(this._eventsInProgress)||this.isZooming()}_blockedByActive(u,m,w){for(const M in u)if(M!==w&&(!m||m.indexOf(M)<0))return!0;return!1}_getMapTouches(u){const m=[];for(const w of u)this._el.contains(w.target)&&m.push(w);return m}mergeHandlerResult(u,m,w,M,R){if(!w)return;o.e(u,w);const N={handlerName:M,originalEvent:w.originalEvent||R};w.zoomDelta!==void 0&&(m.zoom=N),w.panDelta!==void 0&&(m.drag=N),w.rollDelta!==void 0&&(m.roll=N),w.pitchDelta!==void 0&&(m.pitch=N),w.bearingDelta!==void 0&&(m.rotate=N)}_applyChanges(){const u={},m={},w={};for(const[M,R,N]of this._changes)M.panDelta&&(u.panDelta=(u.panDelta||new o.P(0,0))._add(M.panDelta)),M.zoomDelta&&(u.zoomDelta=(u.zoomDelta||0)+M.zoomDelta),M.bearingDelta&&(u.bearingDelta=(u.bearingDelta||0)+M.bearingDelta),M.pitchDelta&&(u.pitchDelta=(u.pitchDelta||0)+M.pitchDelta),M.rollDelta&&(u.rollDelta=(u.rollDelta||0)+M.rollDelta),M.around!==void 0&&(u.around=M.around),M.pinchAround!==void 0&&(u.pinchAround=M.pinchAround),M.noInertia&&(u.noInertia=M.noInertia),o.e(m,R),o.e(w,N);this._updateMapTransform(u,m,w),this._changes=[]}_updateMapTransform(u,m,w){const M=this._map,R=M._getTransformForUpdate(),N=M.terrain;if(!(Qc(u)||N&&this._terrainMovement))return this._fireEvents(m,w,!0);M._stop(!0);let{panDelta:H,zoomDelta:j,bearingDelta:Y,pitchDelta:K,rollDelta:ie,around:re,pinchAround:ue}=u;ue!==void 0&&(re=ue),re=re||M.transform.centerPoint,N&&!R.isPointOnMapSurface(re)&&(re=R.centerPoint);const pe={panDelta:H,zoomDelta:j,rollDelta:ie,pitchDelta:K,bearingDelta:Y,around:re};this._map.cameraHelper.useGlobeControls&&!R.isPointOnMapSurface(re)&&(re=R.centerPoint);const Se=re.distSqr(R.centerPoint)<.01?R.center:R.screenPointToLocation(H?re.sub(H):re);this._handleMapControls({terrain:N,tr:R,deltasForHelper:pe,preZoomAroundLoc:Se,combinedEventsInProgress:m,panDelta:H}),M._applyUpdatedTransform(R),this._map._update(),u.noInertia||this._inertia.record(u),this._fireEvents(m,w,!0)}_handleMapControls({terrain:u,tr:m,deltasForHelper:w,preZoomAroundLoc:M,combinedEventsInProgress:R,panDelta:N}){const H=this._map.cameraHelper;if(H.handleMapControlsRollPitchBearingZoom(w,m),u)return H.useGlobeControls?(this._terrainMovement||!R.drag&&!R.zoom||(this._terrainMovement=!0,this._map._elevationFreeze=!0),void H.handleMapControlsPan(w,m,M)):this._terrainMovement||!R.drag&&!R.zoom?void(R.drag&&this._terrainMovement&&N?m.setCenter(m.screenPointToLocation(m.centerPoint.sub(N))):H.handleMapControlsPan(w,m,M)):(this._terrainMovement=!0,this._map._elevationFreeze=!0,void H.handleMapControlsPan(w,m,M));H.handleMapControlsPan(w,m,M)}_fireEvents(u,m,w){const M=Kc(this._eventsInProgress),R=Kc(u),N={};for(const ie in u){const{originalEvent:re}=u[ie];this._eventsInProgress[ie]||(N[`${ie}start`]=re),this._eventsInProgress[ie]=u[ie]}!M&&R&&this._fireEvent("movestart",R.originalEvent);for(const ie in N)this._fireEvent(ie,N[ie]);R&&this._fireEvent("move",R.originalEvent);for(const ie in u){const{originalEvent:re}=u[ie];this._fireEvent(ie,re)}const H={};let j;for(const ie in this._eventsInProgress){const{handlerName:re,originalEvent:ue}=this._eventsInProgress[ie];this._handlersById[re].isActive()||(delete this._eventsInProgress[ie],j=m[re]||ue,H[`${ie}end`]=j)}for(const ie in H)this._fireEvent(ie,H[ie]);const Y=Kc(this._eventsInProgress),K=(M||R)&&!Y;if(K&&this._terrainMovement){this._map._elevationFreeze=!1,this._terrainMovement=!1;const ie=this._map._getTransformForUpdate();this._map.getCenterClampedToGround()&&ie.recalculateZoomAndCenter(this._map.terrain),this._map._applyUpdatedTransform(ie)}if(w&&K){this._updatingCamera=!0;const ie=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),re=ue=>ue!==0&&-this._bearingSnap<ue&&ue<this._bearingSnap;!ie||!ie.essential&&y.prefersReducedMotion?(this._map.fire(new o.l("moveend",{originalEvent:j})),re(this._map.getBearing())&&this._map.resetNorth()):(re(ie.bearing||this._map.getBearing())&&(ie.bearing=0),ie.freezeElevation=!0,this._map.easeTo(ie,{originalEvent:j})),this._updatingCamera=!1}}_fireEvent(u,m){this._map.fire(new o.l(u,m?{originalEvent:m}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add((u=>{delete this._frameId,this.handleEvent(new Jh("renderFrame",{timeStamp:u})),this._applyChanges()}))}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}class Sd extends o.E{constructor(u,m,w){super(),this._renderFrameCallback=()=>{const M=Math.min((y.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(M)),M<1&&this._easeFrameId?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},this._moving=!1,this._zooming=!1,this.transform=u,this._bearingSnap=w.bearingSnap,this.cameraHelper=m,this.on("moveend",(()=>{delete this._requestedCameraState}))}migrateProjection(u,m){u.apply(this.transform),this.transform=u,this.cameraHelper=m}getCenter(){return new o.S(this.transform.center.lng,this.transform.center.lat)}setCenter(u,m){return this.jumpTo({center:u},m)}getCenterElevation(){return this.transform.elevation}setCenterElevation(u,m){return this.jumpTo({elevation:u},m),this}getCenterClampedToGround(){return this._centerClampedToGround}setCenterClampedToGround(u){this._centerClampedToGround=u}panBy(u,m,w){return u=o.P.convert(u).mult(-1),this.panTo(this.transform.center,o.e({offset:u},m),w)}panTo(u,m,w){return this.easeTo(o.e({center:u},m),w)}getZoom(){return this.transform.zoom}setZoom(u,m){return this.jumpTo({zoom:u},m),this}zoomTo(u,m,w){return this.easeTo(o.e({zoom:u},m),w)}zoomIn(u,m){return this.zoomTo(this.getZoom()+1,u,m),this}zoomOut(u,m){return this.zoomTo(this.getZoom()-1,u,m),this}getVerticalFieldOfView(){return this.transform.fov}setVerticalFieldOfView(u,m){return u!=this.transform.fov&&(this.transform.setFov(u),this.fire(new o.l("movestart",m)).fire(new o.l("move",m)).fire(new o.l("moveend",m))),this}getBearing(){return this.transform.bearing}setBearing(u,m){return this.jumpTo({bearing:u},m),this}getPadding(){return this.transform.padding}setPadding(u,m){return this.jumpTo({padding:u},m),this}rotateTo(u,m,w){return this.easeTo(o.e({bearing:u},m),w)}resetNorth(u,m){return this.rotateTo(0,o.e({duration:1e3},u),m),this}resetNorthPitch(u,m){return this.easeTo(o.e({bearing:0,pitch:0,roll:0,duration:1e3},u),m),this}snapToNorth(u,m){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(u,m):this}getPitch(){return this.transform.pitch}setPitch(u,m){return this.jumpTo({pitch:u},m),this}getRoll(){return this.transform.roll}setRoll(u,m){return this.jumpTo({roll:u},m),this}cameraForBounds(u,m){u=Tr.convert(u).adjustAntiMeridian();const w=m&&m.bearing||0;return this._cameraForBoxAndBearing(u.getNorthWest(),u.getSouthEast(),w,m)}_cameraForBoxAndBearing(u,m,w,M){const R={top:0,bottom:0,right:0,left:0};if(typeof(M=o.e({padding:R,offset:[0,0],maxZoom:this.transform.maxZoom},M)).padding=="number"){const Y=M.padding;M.padding={top:Y,bottom:Y,right:Y,left:Y}}const N=o.e(R,M.padding);M.padding=N;const H=this.transform,j=new Tr(u,m);return this.cameraHelper.cameraForBoxAndBearing(M,N,j,w,H)}fitBounds(u,m,w){return this._fitInternal(this.cameraForBounds(u,m),m,w)}fitScreenCoordinates(u,m,w,M,R){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.screenPointToLocation(o.P.convert(u)),this.transform.screenPointToLocation(o.P.convert(m)),w,M),M,R)}_fitInternal(u,m,w){return u?(delete(m=o.e(u,m)).padding,m.linear?this.easeTo(m,w):this.flyTo(m,w)):this}jumpTo(u,m){this.stop();const w=this._getTransformForUpdate();let M=!1,R=!1,N=!1;const H=w.zoom;this.cameraHelper.handleJumpToCenterZoom(w,u);const j=w.zoom!==H;return"elevation"in u&&w.elevation!==+u.elevation&&w.setElevation(+u.elevation),"bearing"in u&&w.bearing!==+u.bearing&&(M=!0,w.setBearing(+u.bearing)),"pitch"in u&&w.pitch!==+u.pitch&&(R=!0,w.setPitch(+u.pitch)),"roll"in u&&w.roll!==+u.roll&&(N=!0,w.setRoll(+u.roll)),u.padding==null||w.isPaddingEqual(u.padding)||w.setPadding(u.padding),this._applyUpdatedTransform(w),this.fire(new o.l("movestart",m)).fire(new o.l("move",m)),j&&this.fire(new o.l("zoomstart",m)).fire(new o.l("zoom",m)).fire(new o.l("zoomend",m)),M&&this.fire(new o.l("rotatestart",m)).fire(new o.l("rotate",m)).fire(new o.l("rotateend",m)),R&&this.fire(new o.l("pitchstart",m)).fire(new o.l("pitch",m)).fire(new o.l("pitchend",m)),N&&this.fire(new o.l("rollstart",m)).fire(new o.l("roll",m)).fire(new o.l("rollend",m)),this.fire(new o.l("moveend",m))}calculateCameraOptionsFromTo(u,m,w,M=0){const R=o.a1.fromLngLat(u,m),N=o.a1.fromLngLat(w,M),H=N.x-R.x,j=N.y-R.y,Y=N.z-R.z,K=Math.hypot(H,j,Y);if(K===0)throw new Error("Can't calculate camera options with same From and To");const ie=Math.hypot(H,j),re=o.ak(this.transform.cameraToCenterDistance/K/this.transform.tileSize),ue=180*Math.atan2(H,-j)/Math.PI;let pe=180*Math.acos(ie/K)/Math.PI;return pe=Y<0?90-pe:90+pe,{center:N.toLngLat(),elevation:M,zoom:re,pitch:pe,bearing:ue}}calculateCameraOptionsFromCameraLngLatAltRotation(u,m,w,M,R){const N=this.transform.calculateCenterFromCameraLngLatAlt(u,m,w,M);return{center:N.center,elevation:N.elevation,zoom:N.zoom,bearing:w,pitch:M,roll:R}}easeTo(u,m){this._stop(!1,u.easeId),((u=o.e({offset:[0,0],duration:500,easing:o.co},u)).animate===!1||!u.essential&&y.prefersReducedMotion)&&(u.duration=0);const w=this._getTransformForUpdate(),M=this.getBearing(),R=w.pitch,N=w.roll,H="bearing"in u?this._normalizeBearing(u.bearing,M):M,j="pitch"in u?+u.pitch:R,Y="roll"in u?this._normalizeBearing(u.roll,N):N,K="padding"in u?u.padding:w.padding,ie=o.P.convert(u.offset);let re,ue;u.around&&(re=o.S.convert(u.around),ue=w.locationToScreenPoint(re));const pe={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching,rolling:this._rolling},Se=this.cameraHelper.handleEaseTo(w,{bearing:H,pitch:j,roll:Y,padding:K,around:re,aroundPoint:ue,offsetAsPoint:ie,offset:u.offset,zoom:u.zoom,center:u.center});return this._rotating=this._rotating||M!==H,this._pitching=this._pitching||j!==R,this._rolling=this._rolling||Y!==N,this._padding=!w.isPaddingEqual(K),this._zooming=this._zooming||Se.isZooming,this._easeId=u.easeId,this._prepareEase(m,u.noMoveStart,pe),this.terrain&&this._prepareElevation(Se.elevationCenter),this._ease((Te=>{Se.easeFunc(Te),this.terrain&&!u.freezeElevation&&this._updateElevation(Te),this._applyUpdatedTransform(w),this._fireMoveEvents(m)}),(Te=>{this.terrain&&u.freezeElevation&&this._finalizeElevation(),this._afterEase(m,Te)}),u),this}_prepareEase(u,m,w={}){this._moving=!0,m||w.moving||this.fire(new o.l("movestart",u)),this._zooming&&!w.zooming&&this.fire(new o.l("zoomstart",u)),this._rotating&&!w.rotating&&this.fire(new o.l("rotatestart",u)),this._pitching&&!w.pitching&&this.fire(new o.l("pitchstart",u)),this._rolling&&!w.rolling&&this.fire(new o.l("rollstart",u))}_prepareElevation(u){this._elevationCenter=u,this._elevationStart=this.transform.elevation,this._elevationTarget=this.terrain.getElevationForLngLatZoom(u,this.transform.tileZoom),this._elevationFreeze=!0}_updateElevation(u){this._elevationStart!==void 0&&this._elevationCenter!==void 0||this._prepareElevation(this.transform.center),this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom));const m=this.terrain.getElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);if(u<1&&m!==this._elevationTarget){const w=this._elevationTarget-this._elevationStart;this._elevationStart+=u*(w-(m-(w*u+this._elevationStart))/(1-u)),this._elevationTarget=m}this.transform.setElevation(o.C.number(this._elevationStart,this._elevationTarget,u))}_finalizeElevation(){this._elevationFreeze=!1,this.getCenterClampedToGround()&&this.transform.recalculateZoomAndCenter(this.terrain)}_getTransformForUpdate(){return this.transformCameraUpdate||this.terrain?(this._requestedCameraState||(this._requestedCameraState=this.transform.clone()),this._requestedCameraState):this.transform}_elevateCameraIfInsideTerrain(u){if(!this.terrain&&u.elevation>=0&&u.pitch<=90)return{};const m=u.getCameraLngLat(),w=u.getCameraAltitude(),M=this.terrain?this.terrain.getElevationForLngLatZoom(m,u.zoom):0;if(w<M){const R=this.calculateCameraOptionsFromTo(m,M,u.center,u.elevation);return{pitch:R.pitch,zoom:R.zoom}}return{}}_applyUpdatedTransform(u){const m=[];if(m.push((M=>this._elevateCameraIfInsideTerrain(M))),this.transformCameraUpdate&&m.push((M=>this.transformCameraUpdate(M))),!m.length)return;const w=u.clone();for(const M of m){const R=w.clone(),{center:N,zoom:H,roll:j,pitch:Y,bearing:K,elevation:ie}=M(R);N&&R.setCenter(N),ie!==void 0&&R.setElevation(ie),H!==void 0&&R.setZoom(H),j!==void 0&&R.setRoll(j),Y!==void 0&&R.setPitch(Y),K!==void 0&&R.setBearing(K),w.apply(R)}this.transform.apply(w)}_fireMoveEvents(u){this.fire(new o.l("move",u)),this._zooming&&this.fire(new o.l("zoom",u)),this._rotating&&this.fire(new o.l("rotate",u)),this._pitching&&this.fire(new o.l("pitch",u)),this._rolling&&this.fire(new o.l("roll",u))}_afterEase(u,m){if(this._easeId&&m&&this._easeId===m)return;delete this._easeId;const w=this._zooming,M=this._rotating,R=this._pitching,N=this._rolling;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._rolling=!1,this._padding=!1,w&&this.fire(new o.l("zoomend",u)),M&&this.fire(new o.l("rotateend",u)),R&&this.fire(new o.l("pitchend",u)),N&&this.fire(new o.l("rollend",u)),this.fire(new o.l("moveend",u))}flyTo(u,m){if(!u.essential&&y.prefersReducedMotion){const lt=o.Q(u,["center","zoom","bearing","pitch","roll","elevation"]);return this.jumpTo(lt,m)}this.stop(),u=o.e({offset:[0,0],speed:1.2,curve:1.42,easing:o.co},u);const w=this._getTransformForUpdate(),M=w.bearing,R=w.pitch,N=w.roll,H=w.padding,j="bearing"in u?this._normalizeBearing(u.bearing,M):M,Y="pitch"in u?+u.pitch:R,K="roll"in u?this._normalizeBearing(u.roll,N):N,ie="padding"in u?u.padding:w.padding,re=o.P.convert(u.offset);let ue=w.centerPoint.add(re);const pe=w.screenPointToLocation(ue),Se=this.cameraHelper.handleFlyTo(w,{bearing:j,pitch:Y,roll:K,padding:ie,locationAtOffset:pe,offsetAsPoint:re,center:u.center,minZoom:u.minZoom,zoom:u.zoom});let Te=u.curve;const Ce=Math.max(w.width,w.height),Ie=Ce/Se.scaleOfZoom,ke=Se.pixelPathLength;typeof Se.scaleOfMinZoom=="number"&&(Te=Math.sqrt(Ce/Se.scaleOfMinZoom/ke*2));const Re=Te*Te;function ze(lt){const Ot=(Ie*Ie-Ce*Ce+(lt?-1:1)*Re*Re*ke*ke)/(2*(lt?Ie:Ce)*Re*ke);return Math.log(Math.sqrt(Ot*Ot+1)-Ot)}function He(lt){return(Math.exp(lt)-Math.exp(-lt))/2}function Le(lt){return(Math.exp(lt)+Math.exp(-lt))/2}const Xe=ze(!1);let ht=function(lt){return Le(Xe)/Le(Xe+Te*lt)},at=function(lt){return Ce*((Le(Xe)*(He(Ot=Xe+Te*lt)/Le(Ot))-He(Xe))/Re)/ke;var Ot},st=(ze(!0)-Xe)/Te;if(Math.abs(ke)<2e-6||!isFinite(st)){if(Math.abs(Ce-Ie)<1e-6)return this.easeTo(u,m);const lt=Ie<Ce?-1:1;st=Math.abs(Math.log(Ie/Ce))/Te,at=()=>0,ht=Ot=>Math.exp(lt*Te*Ot)}return u.duration="duration"in u?+u.duration:1e3*st/("screenSpeed"in u?+u.screenSpeed/Te:+u.speed),u.maxDuration&&u.duration>u.maxDuration&&(u.duration=0),this._zooming=!0,this._rotating=M!==j,this._pitching=Y!==R,this._rolling=K!==N,this._padding=!w.isPaddingEqual(ie),this._prepareEase(m,!1),this.terrain&&this._prepareElevation(Se.targetCenter),this._ease((lt=>{const Ot=lt*st,Bt=1/ht(Ot),Ct=at(Ot);this._rotating&&w.setBearing(o.C.number(M,j,lt)),this._pitching&&w.setPitch(o.C.number(R,Y,lt)),this._rolling&&w.setRoll(o.C.number(N,K,lt)),this._padding&&(w.interpolatePadding(H,ie,lt),ue=w.centerPoint.add(re)),Se.easeFunc(lt,Bt,Ct,ue),this.terrain&&!u.freezeElevation&&this._updateElevation(lt),this._applyUpdatedTransform(w),this._fireMoveEvents(m)}),(()=>{this.terrain&&u.freezeElevation&&this._finalizeElevation(),this._afterEase(m)}),u),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(u,m){var w;if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){const M=this._onEaseEnd;delete this._onEaseEnd,M.call(this,m)}return u||(w=this.handlers)===null||w===void 0||w.stop(!1),this}_ease(u,m,w){w.animate===!1||w.duration===0?(u(1),m()):(this._easeStart=y.now(),this._easeOptions=w,this._onEaseFrame=u,this._onEaseEnd=m,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_normalizeBearing(u,m){u=o.aO(u,-180,180);const w=Math.abs(u-m);return Math.abs(u-360-m)<w&&(u-=360),Math.abs(u+360-m)<w&&(u+=360),u}queryTerrainElevation(u){return this.terrain?this.terrain.getElevationForLngLatZoom(o.S.convert(u),this.transform.tileZoom):null}}const tr={compact:!0,customAttribution:'<a href="https://maplibre.org/" target="_blank">MapLibre</a>'};class gr{constructor(u=tr){this._toggleAttribution=()=>{this._container.classList.contains("maplibregl-compact")&&(this._container.classList.contains("maplibregl-compact-show")?(this._container.setAttribute("open",""),this._container.classList.remove("maplibregl-compact-show")):(this._container.classList.add("maplibregl-compact-show"),this._container.removeAttribute("open")))},this._updateData=m=>{!m||m.sourceDataType!=="metadata"&&m.sourceDataType!=="visibility"&&m.dataType!=="style"&&m.type!=="terrain"||this._updateAttributions()},this._updateCompact=()=>{this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact===!1?this._container.setAttribute("open",""):this._container.classList.contains("maplibregl-compact")||this._container.classList.contains("maplibregl-attrib-empty")||(this._container.setAttribute("open",""),this._container.classList.add("maplibregl-compact","maplibregl-compact-show")):(this._container.setAttribute("open",""),this._container.classList.contains("maplibregl-compact")&&this._container.classList.remove("maplibregl-compact","maplibregl-compact-show"))},this._updateCompactMinimize=()=>{this._container.classList.contains("maplibregl-compact")&&this._container.classList.contains("maplibregl-compact-show")&&this._container.classList.remove("maplibregl-compact-show")},this.options=u}getDefaultPosition(){return"bottom-right"}onAdd(u){return this._map=u,this._compact=this.options.compact,this._container=b.create("details","maplibregl-ctrl maplibregl-ctrl-attrib"),this._compactButton=b.create("summary","maplibregl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=b.create("div","maplibregl-ctrl-attrib-inner",this._container),this._updateAttributions(),this._updateCompact(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("terrain",this._updateData),this._map.on("resize",this._updateCompact),this._map.on("drag",this._updateCompactMinimize),this._container}onRemove(){b.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("terrain",this._updateData),this._map.off("resize",this._updateCompact),this._map.off("drag",this._updateCompactMinimize),this._map=void 0,this._compact=void 0,this._attribHTML=void 0}_setElementTitle(u,m){const w=this._map._getUIString(`AttributionControl.${m}`);u.title=w,u.setAttribute("aria-label",w)}_updateAttributions(){if(!this._map.style)return;let u=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?u=u.concat(this.options.customAttribution.map((M=>typeof M!="string"?"":M))):typeof this.options.customAttribution=="string"&&u.push(this.options.customAttribution)),this._map.style.stylesheet){const M=this._map.style.stylesheet;this.styleOwner=M.owner,this.styleId=M.id}const m=this._map.style.sourceCaches;for(const M in m){const R=m[M];if(R.used||R.usedForTerrain){const N=R.getSource();N.attribution&&u.indexOf(N.attribution)<0&&u.push(N.attribution)}}u=u.filter((M=>String(M).trim())),u.sort(((M,R)=>M.length-R.length)),u=u.filter(((M,R)=>{for(let N=R+1;N<u.length;N++)if(u[N].indexOf(M)>=0)return!1;return!0}));const w=u.join(" | ");w!==this._attribHTML&&(this._attribHTML=w,u.length?(this._innerContainer.innerHTML=b.sanitize(w),this._container.classList.remove("maplibregl-attrib-empty")):this._container.classList.add("maplibregl-attrib-empty"),this._updateCompact(),this._editLink=null)}}class Jc{constructor(u={}){this._updateCompact=()=>{const m=this._container.children;if(m.length){const w=m[0];this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact!==!1&&w.classList.add("maplibregl-compact"):w.classList.remove("maplibregl-compact")}},this.options=u}getDefaultPosition(){return"bottom-left"}onAdd(u){this._map=u,this._compact=this.options&&this.options.compact,this._container=b.create("div","maplibregl-ctrl");const m=b.create("a","maplibregl-ctrl-logo");return m.target="_blank",m.rel="noopener nofollow",m.href="https://maplibre.org/",m.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),m.setAttribute("rel","noopener nofollow"),this._container.appendChild(m),this._container.style.display="block",this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){b.remove(this._container),this._map.off("resize",this._updateCompact),this._map=void 0,this._compact=void 0}}class Np{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(u){const m=++this._id;return this._queue.push({callback:u,id:m,cancelled:!1}),m}remove(u){const m=this._currentlyRunning,w=m?this._queue.concat(m):this._queue;for(const M of w)if(M.id===u)return void(M.cancelled=!0)}run(u=0){if(this._currentlyRunning)throw new Error("Attempting to run(), but is already running.");const m=this._currentlyRunning=this._queue;this._queue=[];for(const w of m)if(!w.cancelled&&(w.callback(u),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}var ef=o.aJ([{name:"a_pos3d",type:"Int16",components:3}]);class Ki extends o.E{constructor(u){super(),this._lastTilesetChange=y.now(),this.sourceCache=u,this._tiles={},this._renderableTilesKeys=[],this._sourceTileCache={},this.minzoom=0,this.maxzoom=22,this.deltaZoom=1,this.tileSize=u._source.tileSize*2**this.deltaZoom,u.usedForTerrain=!0,u.tileSize=this.tileSize}destruct(){this.sourceCache.usedForTerrain=!1,this.sourceCache.tileSize=null}update(u,m){this.sourceCache.update(u,m),this._renderableTilesKeys=[];const w={};for(const M of Kr(u,{tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,reparseOverscaled:!1,terrain:m,calculateTileZoom:this.sourceCache._source.calculateTileZoom}))w[M.key]=!0,this._renderableTilesKeys.push(M.key),this._tiles[M.key]||(M.terrainRttPosMatrix32f=new Float64Array(16),o.bZ(M.terrainRttPosMatrix32f,0,o.$,o.$,0,0,1),this._tiles[M.key]=new he(M,this.tileSize),this._lastTilesetChange=y.now());for(const M in this._tiles)w[M]||delete this._tiles[M]}freeRtt(u){for(const m in this._tiles){const w=this._tiles[m];(!u||w.tileID.equals(u)||w.tileID.isChildOf(u)||u.isChildOf(w.tileID))&&(w.rtt=[])}}getRenderableTiles(){return this._renderableTilesKeys.map((u=>this.getTileByID(u)))}getTileByID(u){return this._tiles[u]}getTerrainCoords(u,m){return m?this._getTerrainCoordsForTileRanges(u,m):this._getTerrainCoordsForRegularTile(u)}_getTerrainCoordsForRegularTile(u){const m={};for(const w of this._renderableTilesKeys){const M=this._tiles[w].tileID,R=u.clone(),N=o.ba();if(M.canonical.equals(u.canonical))o.bZ(N,0,o.$,o.$,0,0,1);else if(M.canonical.isChildOf(u.canonical)){const H=M.canonical.z-u.canonical.z,j=M.canonical.x-(M.canonical.x>>H<<H),Y=M.canonical.y-(M.canonical.y>>H<<H),K=o.$>>H;o.bZ(N,0,K,K,0,0,1),o.M(N,N,[-j*K,-Y*K,0])}else{if(!u.canonical.isChildOf(M.canonical))continue;{const H=u.canonical.z-M.canonical.z,j=u.canonical.x-(u.canonical.x>>H<<H),Y=u.canonical.y-(u.canonical.y>>H<<H),K=o.$>>H;o.bZ(N,0,o.$,o.$,0,0,1),o.M(N,N,[j*K,Y*K,0]),o.N(N,N,[1/2**H,1/2**H,0])}}R.terrainRttPosMatrix32f=new Float32Array(N),m[w]=R}return m}_getTerrainCoordsForTileRanges(u,m){const w={};for(const M of this._renderableTilesKeys){const R=this._tiles[M].tileID;if(!this._isWithinTileRanges(R,m))continue;const N=u.clone(),H=o.ba();if(R.canonical.z===u.canonical.z){const j=u.canonical.x-R.canonical.x,Y=u.canonical.y-R.canonical.y;o.bZ(H,0,o.$,o.$,0,0,1),o.M(H,H,[j*o.$,Y*o.$,0])}else if(R.canonical.z>u.canonical.z){const j=R.canonical.z-u.canonical.z,Y=R.canonical.x-(R.canonical.x>>j<<j),K=R.canonical.y-(R.canonical.y>>j<<j),ie=u.canonical.x-(R.canonical.x>>j),re=u.canonical.y-(R.canonical.y>>j),ue=o.$>>j;o.bZ(H,0,ue,ue,0,0,1),o.M(H,H,[-Y*ue+ie*o.$,-K*ue+re*o.$,0])}else{const j=u.canonical.z-R.canonical.z,Y=u.canonical.x-(u.canonical.x>>j<<j),K=u.canonical.y-(u.canonical.y>>j<<j),ie=(u.canonical.x>>j)-R.canonical.x,re=(u.canonical.y>>j)-R.canonical.y,ue=o.$<<j;o.bZ(H,0,ue,ue,0,0,1),o.M(H,H,[Y*o.$+ie*ue,K*o.$+re*ue,0])}N.terrainRttPosMatrix32f=new Float32Array(H),w[M]=N}return w}getSourceTile(u,m){const w=this.sourceCache._source;let M=u.overscaledZ-this.deltaZoom;if(M>w.maxzoom&&(M=w.maxzoom),M<w.minzoom)return null;this._sourceTileCache[u.key]||(this._sourceTileCache[u.key]=u.scaledTo(M).key);let R=this.sourceCache.getTileByID(this._sourceTileCache[u.key]);if((!R||!R.dem)&&m)for(;M>=w.minzoom&&(!R||!R.dem);)R=this.sourceCache.getTileByID(u.scaledTo(M--).key);return R}anyTilesAfterTime(u=Date.now()){return this._lastTilesetChange>=u}_isWithinTileRanges(u,m){return m[u.canonical.z]&&u.canonical.x>=m[u.canonical.z].minTileX&&u.canonical.x<=m[u.canonical.z].maxTileX&&u.canonical.y>=m[u.canonical.z].minTileY&&u.canonical.y<=m[u.canonical.z].maxTileY}}class jo{constructor(u,m,w){this._meshCache={},this.painter=u,this.sourceCache=new Ki(m),this.options=w,this.exaggeration=typeof w.exaggeration=="number"?w.exaggeration:1,this.qualityFactor=2,this.meshSize=128,this._demMatrixCache={},this.coordsIndex=[],this._coordsTextureSize=1024}getDEMElevation(u,m,w,M=o.$){var R;if(!(m>=0&&m<M&&w>=0&&w<M))return 0;const N=this.getTerrainData(u),H=(R=N.tile)===null||R===void 0?void 0:R.dem;if(!H)return 0;const j=o.cs([],[m/M*o.$,w/M*o.$],N.u_terrain_matrix),Y=[j[0]*H.dim,j[1]*H.dim],K=Math.floor(Y[0]),ie=Math.floor(Y[1]),re=Y[0]-K,ue=Y[1]-ie;return H.get(K,ie)*(1-re)*(1-ue)+H.get(K+1,ie)*re*(1-ue)+H.get(K,ie+1)*(1-re)*ue+H.get(K+1,ie+1)*re*ue}getElevationForLngLatZoom(u,m){if(!o.ct(m,u.wrap()))return 0;const{tileID:w,mercatorX:M,mercatorY:R}=this._getOverscaledTileIDFromLngLatZoom(u,m);return this.getElevation(w,M%o.$,R%o.$,o.$)}getElevation(u,m,w,M=o.$){return this.getDEMElevation(u,m,w,M)*this.exaggeration}getTerrainData(u){if(!this._emptyDemTexture){const M=this.painter.context,R=new o.R({width:1,height:1},new Uint8Array(4));this._emptyDepthTexture=new o.T(M,R,M.gl.RGBA,{premultiply:!1}),this._emptyDemUnpack=[0,0,0,0],this._emptyDemTexture=new o.T(M,new o.R({width:1,height:1}),M.gl.RGBA,{premultiply:!1}),this._emptyDemTexture.bind(M.gl.NEAREST,M.gl.CLAMP_TO_EDGE),this._emptyDemMatrix=o.ag([])}const m=this.sourceCache.getSourceTile(u,!0);if(m&&m.dem&&(!m.demTexture||m.needsTerrainPrepare)){const M=this.painter.context;m.demTexture=this.painter.getTileTexture(m.dem.stride),m.demTexture?m.demTexture.update(m.dem.getPixels(),{premultiply:!1}):m.demTexture=new o.T(M,m.dem.getPixels(),M.gl.RGBA,{premultiply:!1}),m.demTexture.bind(M.gl.NEAREST,M.gl.CLAMP_TO_EDGE),m.needsTerrainPrepare=!1}const w=m&&m+m.tileID.key+u.key;if(w&&!this._demMatrixCache[w]){const M=this.sourceCache.sourceCache._source.maxzoom;let R=u.canonical.z-m.tileID.canonical.z;u.overscaledZ>u.canonical.z&&(u.canonical.z>=M?R=u.canonical.z-M:o.w("cannot calculate elevation if elevation maxzoom > source.maxzoom"));const N=u.canonical.x-(u.canonical.x>>R<<R),H=u.canonical.y-(u.canonical.y>>R<<R),j=o.cu(new Float64Array(16),[1/(o.$<<R),1/(o.$<<R),0]);o.M(j,j,[N*o.$,H*o.$,0]),this._demMatrixCache[u.key]={matrix:j,coord:u}}return{u_depth:2,u_terrain:3,u_terrain_dim:m&&m.dem&&m.dem.dim||1,u_terrain_matrix:w?this._demMatrixCache[u.key].matrix:this._emptyDemMatrix,u_terrain_unpack:m&&m.dem&&m.dem.getUnpackVector()||this._emptyDemUnpack,u_terrain_exaggeration:this.exaggeration,texture:(m&&m.demTexture||this._emptyDemTexture).texture,depthTexture:(this._fboDepthTexture||this._emptyDepthTexture).texture,tile:m}}getFramebuffer(u){const m=this.painter,w=m.width/devicePixelRatio,M=m.height/devicePixelRatio;return!this._fbo||this._fbo.width===w&&this._fbo.height===M||(this._fbo.destroy(),this._fboCoordsTexture.destroy(),this._fboDepthTexture.destroy(),delete this._fbo,delete this._fboDepthTexture,delete this._fboCoordsTexture),this._fboCoordsTexture||(this._fboCoordsTexture=new o.T(m.context,{width:w,height:M,data:null},m.context.gl.RGBA,{premultiply:!1}),this._fboCoordsTexture.bind(m.context.gl.NEAREST,m.context.gl.CLAMP_TO_EDGE)),this._fboDepthTexture||(this._fboDepthTexture=new o.T(m.context,{width:w,height:M,data:null},m.context.gl.RGBA,{premultiply:!1}),this._fboDepthTexture.bind(m.context.gl.NEAREST,m.context.gl.CLAMP_TO_EDGE)),this._fbo||(this._fbo=m.context.createFramebuffer(w,M,!0,!1),this._fbo.depthAttachment.set(m.context.createRenderbuffer(m.context.gl.DEPTH_COMPONENT16,w,M))),this._fbo.colorAttachment.set(u==="coords"?this._fboCoordsTexture.texture:this._fboDepthTexture.texture),this._fbo}getCoordsTexture(){const u=this.painter.context;if(this._coordsTexture)return this._coordsTexture;const m=new Uint8Array(this._coordsTextureSize*this._coordsTextureSize*4);for(let R=0,N=0;R<this._coordsTextureSize;R++)for(let H=0;H<this._coordsTextureSize;H++,N+=4)m[N+0]=255&H,m[N+1]=255&R,m[N+2]=H>>8<<4|R>>8,m[N+3]=0;const w=new o.R({width:this._coordsTextureSize,height:this._coordsTextureSize},new Uint8Array(m.buffer)),M=new o.T(u,w,u.gl.RGBA,{premultiply:!1});return M.bind(u.gl.NEAREST,u.gl.CLAMP_TO_EDGE),this._coordsTexture=M,M}pointCoordinate(u){this.painter.maybeDrawDepthAndCoords(!0);const m=new Uint8Array(4),w=this.painter.context,M=w.gl,R=Math.round(u.x*this.painter.pixelRatio/devicePixelRatio),N=Math.round(u.y*this.painter.pixelRatio/devicePixelRatio),H=Math.round(this.painter.height/devicePixelRatio);w.bindFramebuffer.set(this.getFramebuffer("coords").framebuffer),M.readPixels(R,H-N-1,1,1,M.RGBA,M.UNSIGNED_BYTE,m),w.bindFramebuffer.set(null);const j=m[0]+(m[2]>>4<<8),Y=m[1]+((15&m[2])<<8),K=this.coordsIndex[255-m[3]],ie=K&&this.sourceCache.getTileByID(K);if(!ie)return null;const re=this._coordsTextureSize,ue=(1<<ie.tileID.canonical.z)*re;return new o.a1((ie.tileID.canonical.x*re+j)/ue+ie.tileID.wrap,(ie.tileID.canonical.y*re+Y)/ue,this.getElevation(ie.tileID,j,Y,re))}depthAtPoint(u){const m=new Uint8Array(4),w=this.painter.context,M=w.gl;return w.bindFramebuffer.set(this.getFramebuffer("depth").framebuffer),M.readPixels(u.x,this.painter.height/devicePixelRatio-u.y-1,1,1,M.RGBA,M.UNSIGNED_BYTE,m),w.bindFramebuffer.set(null),(m[0]/16777216+m[1]/65536+m[2]/256+m[3])/256}getTerrainMesh(u){var m;const w=((m=this.painter.style.projection)===null||m===void 0?void 0:m.transitionState)>0,M=w&&u.canonical.y===0,R=w&&u.canonical.y===(1<<u.canonical.z)-1,N=`m_${M?"n":""}_${R?"s":""}`;if(this._meshCache[N])return this._meshCache[N];const H=this.painter.context,j=new o.cv,Y=new o.aN,K=this.meshSize,ie=o.$/K,re=K*K;for(let Le=0;Le<=K;Le++)for(let Xe=0;Xe<=K;Xe++)j.emplaceBack(Xe*ie,Le*ie,0);for(let Le=0;Le<re;Le+=K+1)for(let Xe=0;Xe<K;Xe++)Y.emplaceBack(Xe+Le,K+Xe+Le+1,K+Xe+Le+2),Y.emplaceBack(Xe+Le,K+Xe+Le+2,Xe+Le+1);const ue=j.length,pe=ue+(K+1),Se=(K+1)*K,Te=M?o.bh:0,Ce=M?0:1,Ie=R?o.bi:o.$,ke=R?0:1;for(let Le=0;Le<=K;Le++)j.emplaceBack(Le*ie,Te,Ce);for(let Le=0;Le<=K;Le++)j.emplaceBack(Le*ie,Ie,ke);for(let Le=0;Le<K;Le++)Y.emplaceBack(Se+Le,pe+Le,pe+Le+1),Y.emplaceBack(Se+Le,pe+Le+1,Se+Le+1),Y.emplaceBack(0+Le,ue+Le+1,ue+Le),Y.emplaceBack(0+Le,0+Le+1,ue+Le+1);const Re=j.length,ze=Re+2*(K+1);for(const Le of[0,1])for(let Xe=0;Xe<=K;Xe++)for(const ht of[0,1])j.emplaceBack(Le*o.$,Xe*ie,ht);for(let Le=0;Le<2*K;Le+=2)Y.emplaceBack(Re+Le,Re+Le+1,Re+Le+3),Y.emplaceBack(Re+Le,Re+Le+3,Re+Le+2),Y.emplaceBack(ze+Le,ze+Le+3,ze+Le+1),Y.emplaceBack(ze+Le,ze+Le+2,ze+Le+3);const He=new Au(H.createVertexBuffer(j,ef.members),H.createIndexBuffer(Y),o.aM.simpleSegment(0,0,j.length,Y.length));return this._meshCache[N]=He,He}getMeshFrameDelta(u){return 2*Math.PI*o.bu/Math.pow(2,Math.max(u,0))/5}getMinTileElevationForLngLatZoom(u,m){var w;const{tileID:M}=this._getOverscaledTileIDFromLngLatZoom(u,m);return(w=this.getMinMaxElevation(M).minElevation)!==null&&w!==void 0?w:0}getMinMaxElevation(u){const m=this.getTerrainData(u).tile,w={minElevation:null,maxElevation:null};return m&&m.dem&&(w.minElevation=m.dem.min*this.exaggeration,w.maxElevation=m.dem.max*this.exaggeration),w}_getOverscaledTileIDFromLngLatZoom(u,m){const w=o.a1.fromLngLat(u.wrap()),M=(1<<m)*o.$,R=w.x*M,N=w.y*M,H=Math.floor(R/o.$),j=Math.floor(N/o.$);return{tileID:new o.Z(m,0,m,H,j),mercatorX:R,mercatorY:N}}}class _a{constructor(u,m,w){this._context=u,this._size=m,this._tileSize=w,this._objects=[],this._recentlyUsed=[],this._stamp=0}destruct(){for(const u of this._objects)u.texture.destroy(),u.fbo.destroy()}_createObject(u){const m=this._context.createFramebuffer(this._tileSize,this._tileSize,!0,!0),w=new o.T(this._context,{width:this._tileSize,height:this._tileSize,data:null},this._context.gl.RGBA);return w.bind(this._context.gl.LINEAR,this._context.gl.CLAMP_TO_EDGE),this._context.extTextureFilterAnisotropic&&this._context.gl.texParameterf(this._context.gl.TEXTURE_2D,this._context.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,this._context.extTextureFilterAnisotropicMax),m.depthAttachment.set(this._context.createRenderbuffer(this._context.gl.DEPTH_STENCIL,this._tileSize,this._tileSize)),m.colorAttachment.set(w.texture),{id:u,fbo:m,texture:w,stamp:-1,inUse:!1}}getObjectForId(u){return this._objects[u]}useObject(u){u.inUse=!0,this._recentlyUsed=this._recentlyUsed.filter((m=>u.id!==m)),this._recentlyUsed.push(u.id)}stampObject(u){u.stamp=++this._stamp}getOrCreateFreeObject(){for(const m of this._recentlyUsed)if(!this._objects[m].inUse)return this._objects[m];if(this._objects.length>=this._size)throw new Error("No free RenderPool available, call freeAllObjects() required!");const u=this._createObject(this._objects.length);return this._objects.push(u),u}freeObject(u){u.inUse=!1}freeAllObjects(){for(const u of this._objects)this.freeObject(u)}isFull(){return!(this._objects.length<this._size)&&this._objects.some((u=>!u.inUse))===!1}}const Ql={background:!0,fill:!0,line:!0,raster:!0,hillshade:!0,"color-relief":!0};class Yy{constructor(u,m){this.painter=u,this.terrain=m,this.pool=new _a(u.context,30,m.sourceCache.tileSize*m.qualityFactor)}destruct(){this.pool.destruct()}getTexture(u){return this.pool.getObjectForId(u.rtt[this._stacks.length-1].id).texture}prepareForRender(u,m){this._stacks=[],this._prevType=null,this._rttTiles=[],this._renderableTiles=this.terrain.sourceCache.getRenderableTiles(),this._renderableLayerIds=u._order.filter((w=>!u._layers[w].isHidden(m))),this._coordsAscending={};for(const w in u.sourceCaches){this._coordsAscending[w]={};const M=u.sourceCaches[w].getVisibleCoordinates(),R=u.sourceCaches[w].getSource(),N=R instanceof Li?R.terrainTileRanges:null;for(const H of M){const j=this.terrain.sourceCache.getTerrainCoords(H,N);for(const Y in j)this._coordsAscending[w][Y]||(this._coordsAscending[w][Y]=[]),this._coordsAscending[w][Y].push(j[Y])}}this._coordsAscendingStr={};for(const w of u._order){const M=u._layers[w],R=M.source;if(Ql[M.type]&&!this._coordsAscendingStr[R]){this._coordsAscendingStr[R]={};for(const N in this._coordsAscending[R])this._coordsAscendingStr[R][N]=this._coordsAscending[R][N].map((H=>H.key)).sort().join()}}for(const w of this._renderableTiles)for(const M in this._coordsAscendingStr){const R=this._coordsAscendingStr[M][w.tileID.key];R&&R!==w.rttCoords[M]&&(w.rtt=[])}}renderLayer(u,m){if(u.isHidden(this.painter.transform.zoom))return!1;const w=Object.assign(Object.assign({},m),{isRenderingToTexture:!0}),M=u.type,R=this.painter,N=this._renderableLayerIds[this._renderableLayerIds.length-1]===u.id;if(Ql[M]&&(this._prevType&&Ql[this._prevType]||this._stacks.push([]),this._prevType=M,this._stacks[this._stacks.length-1].push(u.id),!N))return!0;if(Ql[this._prevType]||Ql[M]&&N){this._prevType=M;const H=this._stacks.length-1,j=this._stacks[H]||[];for(const Y of this._renderableTiles){if(this.pool.isFull()&&(xl(this.painter,this.terrain,this._rttTiles,w),this._rttTiles=[],this.pool.freeAllObjects()),this._rttTiles.push(Y),Y.rtt[H]){const ie=this.pool.getObjectForId(Y.rtt[H].id);if(ie.stamp===Y.rtt[H].stamp){this.pool.useObject(ie);continue}}const K=this.pool.getOrCreateFreeObject();this.pool.useObject(K),this.pool.stampObject(K),Y.rtt[H]={id:K.id,stamp:K.stamp},R.context.bindFramebuffer.set(K.fbo.framebuffer),R.context.clear({color:o.bf.transparent,stencil:0}),R.currentStencilSource=void 0;for(let ie=0;ie<j.length;ie++){const re=R.style._layers[j[ie]],ue=re.source?this._coordsAscending[re.source][Y.tileID.key]:[Y.tileID];R.context.viewport.set([0,0,K.fbo.width,K.fbo.height]),R._renderTileClippingMasks(re,ue,!0),R.renderLayer(R,R.style.sourceCaches[re.source],re,ue,w),re.source&&(Y.rttCoords[re.source]=this._coordsAscendingStr[re.source][Y.tileID.key])}}return xl(this.painter,this.terrain,this._rttTiles,w),this._rttTiles=[],this.pool.freeAllObjects(),Ql[M]}return!1}}const Gu={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"MapLibre logo","Map.Title":"Map","Marker.Title":"Map marker","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","Popup.Close":"Close popup","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","GlobeControl.Enable":"Enable globe","GlobeControl.Disable":"Disable globe","TerrainControl.Enable":"Enable terrain","TerrainControl.Disable":"Disable terrain","CooperativeGesturesHandler.WindowsHelpText":"Use Ctrl + scroll to zoom the map","CooperativeGesturesHandler.MacHelpText":"Use ⌘ + scroll to zoom the map","CooperativeGesturesHandler.MobileHelpText":"Use two fingers to move the map"},$o=l,an={hash:!1,interactive:!0,bearingSnap:7,attributionControl:tr,maplibreLogo:!1,refreshExpiredTiles:!0,canvasContextAttributes:{antialias:!1,preserveDrawingBuffer:!1,powerPreference:"high-performance",failIfMajorPerformanceCaveat:!1,desynchronized:!1,contextType:void 0},scrollZoom:!0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,trackResize:!0,center:[0,0],elevation:0,zoom:0,bearing:0,pitch:0,roll:0,renderWorldCopies:!0,maxTileCacheSize:null,maxTileCacheZoomLevels:o.a.MAX_TILE_CACHE_ZOOM_LEVELS,transformRequest:null,transformCameraUpdate:null,fadeDuration:300,crossSourceCollisions:!0,clickTolerance:3,localIdeographFontFamily:"sans-serif",pitchWithRotate:!0,rollEnabled:!1,validateStyle:!0,maxCanvasSize:[4096,4096],cancelPendingTileRequestsWhileZooming:!0,centerClampedToGround:!0},Qi={showCompass:!0,showZoom:!0,visualizePitch:!1,visualizeRoll:!0};class Bi{constructor(u,m,w=!1){this.mousedown=R=>{this.startMove(R,b.mousePos(this.element,R)),b.addEventListener(window,"mousemove",this.mousemove),b.addEventListener(window,"mouseup",this.mouseup)},this.mousemove=R=>{this.move(R,b.mousePos(this.element,R))},this.mouseup=R=>{this._rotatePitchHandler.dragEnd(R),this.offTemp()},this.touchstart=R=>{R.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=b.touchPos(this.element,R.targetTouches)[0],this.startMove(R,this._startPos),b.addEventListener(window,"touchmove",this.touchmove,{passive:!1}),b.addEventListener(window,"touchend",this.touchend))},this.touchmove=R=>{R.targetTouches.length!==1?this.reset():(this._lastPos=b.touchPos(this.element,R.targetTouches)[0],this.move(R,this._lastPos))},this.touchend=R=>{R.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),delete this._startPos,delete this._lastPos,this.offTemp()},this.reset=()=>{this._rotatePitchHandler.reset(),delete this._startPos,delete this._lastPos,this.offTemp()},this._clickTolerance=10,this.element=m;const M=new yd;this._rotatePitchHandler=new Kh({clickTolerance:3,move:(R,N)=>{const H=m.getBoundingClientRect(),j=new o.P((H.bottom-H.top)/2,(H.right-H.left)/2);return{bearingDelta:o.cn(new o.P(R.x,N.y),N,j),pitchDelta:w?-.5*(N.y-R.y):void 0}},moveStateManager:M,enable:!0,assignEvents:()=>{}}),this.map=u,b.addEventListener(m,"mousedown",this.mousedown),b.addEventListener(m,"touchstart",this.touchstart,{passive:!1}),b.addEventListener(m,"touchcancel",this.reset)}startMove(u,m){this._rotatePitchHandler.dragStart(u,m),b.disableDrag()}move(u,m){const w=this.map,{bearingDelta:M,pitchDelta:R}=this._rotatePitchHandler.dragMove(u,m)||{};M&&w.setBearing(w.getBearing()+M),R&&w.setPitch(w.getPitch()+R)}off(){const u=this.element;b.removeEventListener(u,"mousedown",this.mousedown),b.removeEventListener(u,"touchstart",this.touchstart,{passive:!1}),b.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),b.removeEventListener(window,"touchend",this.touchend),b.removeEventListener(u,"touchcancel",this.reset),this.offTemp()}offTemp(){b.enableDrag(),b.removeEventListener(window,"mousemove",this.mousemove),b.removeEventListener(window,"mouseup",this.mouseup),b.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),b.removeEventListener(window,"touchend",this.touchend)}}let kr;function Ai(I,u,m,w=!1){if(w||!m.getCoveringTilesDetailsProvider().allowWorldCopies())return I?.wrap();const M=new o.S(I.lng,I.lat);if(I=new o.S(I.lng,I.lat),u){const R=new o.S(I.lng-360,I.lat),N=new o.S(I.lng+360,I.lat),H=m.locationToScreenPoint(I).distSqr(u);m.locationToScreenPoint(R).distSqr(u)<H?I=R:m.locationToScreenPoint(N).distSqr(u)<H&&(I=N)}for(;Math.abs(I.lng-m.center.lng)>180;){const R=m.locationToScreenPoint(I);if(R.x>=0&&R.y>=0&&R.x<=m.width&&R.y<=m.height)break;I.lng>m.center.lng?I.lng-=360:I.lng+=360}return I.lng!==M.lng&&m.isPointOnMapSurface(m.locationToScreenPoint(I))?I:M}const hn={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function eh(I,u,m){const w=I.classList;for(const M in hn)w.remove(`maplibregl-${m}-anchor-${M}`);w.add(`maplibregl-${m}-anchor-${u}`)}class Tl extends o.E{constructor(u){if(super(),this._onKeyPress=m=>{const w=m.code,M=m.charCode||m.keyCode;w!=="Space"&&w!=="Enter"&&M!==32&&M!==13||this.togglePopup()},this._onMapClick=m=>{const w=m.originalEvent.target,M=this._element;this._popup&&(w===M||M.contains(w))&&this.togglePopup()},this._update=m=>{if(!this._map)return;const w=this._map.loaded()&&!this._map.isMoving();(m?.type==="terrain"||m?.type==="render"&&!w)&&this._map.once("render",this._update),this._lngLat=Ai(this._lngLat,this._flatPos,this._map.transform),this._flatPos=this._pos=this._map.project(this._lngLat)._add(this._offset),this._map.terrain&&(this._flatPos=this._map.transform.locationToScreenPoint(this._lngLat)._add(this._offset));let M="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?M=`rotateZ(${this._rotation}deg)`:this._rotationAlignment==="map"&&(M=`rotateZ(${this._rotation-this._map.getBearing()}deg)`);let R="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?R="rotateX(0deg)":this._pitchAlignment==="map"&&(R=`rotateX(${this._map.getPitch()}deg)`),this._subpixelPositioning||m&&m.type!=="moveend"||(this._pos=this._pos.round()),b.setTransform(this._element,`${hn[this._anchor]} translate(${this._pos.x}px, ${this._pos.y}px) ${R} ${M}`),y.frameAsync(new AbortController).then((()=>{this._updateOpacity(m&&m.type==="moveend")})).catch((()=>{}))},this._onMove=m=>{if(!this._isDragging){const w=this._clickTolerance||this._map._clickTolerance;this._isDragging=m.point.dist(this._pointerdownPos)>=w}this._isDragging&&(this._pos=m.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new o.l("dragstart"))),this.fire(new o.l("drag")))},this._onUp=()=>{this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new o.l("dragend")),this._state="inactive"},this._addDragHandler=m=>{this._element.contains(m.originalEvent.target)&&(m.preventDefault(),this._positionDelta=m.point.sub(this._pos).add(this._offset),this._pointerdownPos=m.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},this._anchor=u&&u.anchor||"center",this._color=u&&u.color||"#3FB1CE",this._scale=u&&u.scale||1,this._draggable=u&&u.draggable||!1,this._clickTolerance=u&&u.clickTolerance||0,this._subpixelPositioning=u&&u.subpixelPositioning||!1,this._isDragging=!1,this._state="inactive",this._rotation=u&&u.rotation||0,this._rotationAlignment=u&&u.rotationAlignment||"auto",this._pitchAlignment=u&&u.pitchAlignment&&u.pitchAlignment!=="auto"?u.pitchAlignment:this._rotationAlignment,this.setOpacity(u?.opacity,u?.opacityWhenCovered),u&&u.element)this._element=u.element,this._offset=o.P.convert(u&&u.offset||[0,0]);else{this._defaultMarker=!0,this._element=b.create("div");const m=b.createNS("http://www.w3.org/2000/svg","svg"),w=41,M=27;m.setAttributeNS(null,"display","block"),m.setAttributeNS(null,"height",`${w}px`),m.setAttributeNS(null,"width",`${M}px`),m.setAttributeNS(null,"viewBox",`0 0 ${M} ${w}`);const R=b.createNS("http://www.w3.org/2000/svg","g");R.setAttributeNS(null,"stroke","none"),R.setAttributeNS(null,"stroke-width","1"),R.setAttributeNS(null,"fill","none"),R.setAttributeNS(null,"fill-rule","evenodd");const N=b.createNS("http://www.w3.org/2000/svg","g");N.setAttributeNS(null,"fill-rule","nonzero");const H=b.createNS("http://www.w3.org/2000/svg","g");H.setAttributeNS(null,"transform","translate(3.0, 29.0)"),H.setAttributeNS(null,"fill","#000000");const j=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];for(const Ce of j){const Ie=b.createNS("http://www.w3.org/2000/svg","ellipse");Ie.setAttributeNS(null,"opacity","0.04"),Ie.setAttributeNS(null,"cx","10.5"),Ie.setAttributeNS(null,"cy","5.80029008"),Ie.setAttributeNS(null,"rx",Ce.rx),Ie.setAttributeNS(null,"ry",Ce.ry),H.appendChild(Ie)}const Y=b.createNS("http://www.w3.org/2000/svg","g");Y.setAttributeNS(null,"fill",this._color);const K=b.createNS("http://www.w3.org/2000/svg","path");K.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),Y.appendChild(K);const ie=b.createNS("http://www.w3.org/2000/svg","g");ie.setAttributeNS(null,"opacity","0.25"),ie.setAttributeNS(null,"fill","#000000");const re=b.createNS("http://www.w3.org/2000/svg","path");re.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),ie.appendChild(re);const ue=b.createNS("http://www.w3.org/2000/svg","g");ue.setAttributeNS(null,"transform","translate(6.0, 7.0)"),ue.setAttributeNS(null,"fill","#FFFFFF");const pe=b.createNS("http://www.w3.org/2000/svg","g");pe.setAttributeNS(null,"transform","translate(8.0, 8.0)");const Se=b.createNS("http://www.w3.org/2000/svg","circle");Se.setAttributeNS(null,"fill","#000000"),Se.setAttributeNS(null,"opacity","0.25"),Se.setAttributeNS(null,"cx","5.5"),Se.setAttributeNS(null,"cy","5.5"),Se.setAttributeNS(null,"r","5.4999962");const Te=b.createNS("http://www.w3.org/2000/svg","circle");Te.setAttributeNS(null,"fill","#FFFFFF"),Te.setAttributeNS(null,"cx","5.5"),Te.setAttributeNS(null,"cy","5.5"),Te.setAttributeNS(null,"r","5.4999962"),pe.appendChild(Se),pe.appendChild(Te),N.appendChild(H),N.appendChild(Y),N.appendChild(ie),N.appendChild(ue),N.appendChild(pe),m.appendChild(N),m.setAttributeNS(null,"height",w*this._scale+"px"),m.setAttributeNS(null,"width",M*this._scale+"px"),this._element.appendChild(m),this._offset=o.P.convert(u&&u.offset||[0,-14])}if(this._element.classList.add("maplibregl-marker"),this._element.addEventListener("dragstart",(m=>{m.preventDefault()})),this._element.addEventListener("mousedown",(m=>{m.preventDefault()})),eh(this._element,this._anchor,"marker"),u&&u.className)for(const m of u.className.split(" "))this._element.classList.add(m);this._popup=null}addTo(u){return this.remove(),this._map=u,this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label",u._getUIString("Marker.Title")),this._element.hasAttribute("role")||this._element.setAttribute("role","button"),u.getCanvasContainer().appendChild(this._element),u.on("move",this._update),u.on("moveend",this._update),u.on("terrain",this._update),u.on("projectiontransition",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this}remove(){return this._opacityTimeout&&(clearTimeout(this._opacityTimeout),delete this._opacityTimeout),this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("terrain",this._update),this._map.off("projectiontransition",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),b.remove(this._element),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(u){return this._lngLat=o.S.convert(u),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this}getElement(){return this._element}setPopup(u){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),u){if(!("offset"in u.options)){const M=Math.abs(13.5)/Math.SQRT2;u.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[M,-1*(38.1-13.5+M)],"bottom-right":[-M,-1*(38.1-13.5+M)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=u,this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this}setSubpixelPositioning(u){return this._subpixelPositioning=u,this}getPopup(){return this._popup}togglePopup(){const u=this._popup;return this._element.style.opacity===this._opacityWhenCovered?this:u?(u.isOpen()?u.remove():(u.setLngLat(this._lngLat),u.addTo(this._map)),this):this}_updateOpacity(u=!1){var m,w;const M=(m=this._map)===null||m===void 0?void 0:m.terrain,R=this._map.transform.isLocationOccluded(this._lngLat);if(!M||R){const ue=R?this._opacityWhenCovered:this._opacity;return void(this._element.style.opacity!==ue&&(this._element.style.opacity=ue))}if(u)this._opacityTimeout=null;else{if(this._opacityTimeout)return;this._opacityTimeout=setTimeout((()=>{this._opacityTimeout=null}),100)}const N=this._map,H=N.terrain.depthAtPoint(this._pos),j=N.terrain.getElevationForLngLatZoom(this._lngLat,N.transform.tileZoom);if(N.transform.lngLatToCameraDepth(this._lngLat,j)-H<.006)return void(this._element.style.opacity=this._opacity);const Y=-this._offset.y/N.transform.pixelsPerMeter,K=Math.sin(N.getPitch()*Math.PI/180)*Y,ie=N.terrain.depthAtPoint(new o.P(this._pos.x,this._pos.y-this._offset.y)),re=N.transform.lngLatToCameraDepth(this._lngLat,j+K)-ie>.006;!((w=this._popup)===null||w===void 0)&&w.isOpen()&&re&&this._popup.remove(),this._element.style.opacity=re?this._opacityWhenCovered:this._opacity}getOffset(){return this._offset}setOffset(u){return this._offset=o.P.convert(u),this._update(),this}addClassName(u){this._element.classList.add(u)}removeClassName(u){this._element.classList.remove(u)}toggleClassName(u){return this._element.classList.toggle(u)}setDraggable(u){return this._draggable=!!u,this._map&&(u?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(u){return this._rotation=u||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(u){return this._rotationAlignment=u||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(u){return this._pitchAlignment=u&&u!=="auto"?u:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}setOpacity(u,m){return(this._opacity===void 0||u===void 0&&m===void 0)&&(this._opacity="1",this._opacityWhenCovered="0.2"),u!==void 0&&(this._opacity=u),m!==void 0&&(this._opacityWhenCovered=m),this._map&&this._updateOpacity(!0),this}}const Jl={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0};let $s=0,Ws=!1;const Xu={maxWidth:100,unit:"metric"};function Bp(I,u,m){const w=m&&m.maxWidth||100,M=I._container.clientHeight/2,R=I._container.clientWidth/2,N=I.unproject([R-w/2,M]),H=I.unproject([R+w/2,M]),j=Math.round(I.project(H).x-I.project(N).x),Y=Math.min(w,j,I._container.clientWidth),K=N.distanceTo(H);if(m&&m.unit==="imperial"){const ie=3.2808*K;ie>5280?ji(u,Y,ie/5280,I._getUIString("ScaleControl.Miles")):ji(u,Y,ie,I._getUIString("ScaleControl.Feet"))}else m&&m.unit==="nautical"?ji(u,Y,K/1852,I._getUIString("ScaleControl.NauticalMiles")):K>=1e3?ji(u,Y,K/1e3,I._getUIString("ScaleControl.Kilometers")):ji(u,Y,K,I._getUIString("ScaleControl.Meters"))}function ji(I,u,m,w){const M=(function(R){const N=Math.pow(10,`${Math.floor(R)}`.length-1);let H=R/N;return H=H>=10?10:H>=5?5:H>=3?3:H>=2?2:H>=1?1:(function(j){const Y=Math.pow(10,Math.ceil(-Math.log(j)/Math.LN10));return Math.round(j*Y)/Y})(H),N*H})(m);I.style.width=u*(M/m)+"px",I.innerHTML=`${M}&nbsp;${w}`}const Td={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px",subpixelPositioning:!1,locationOccludedOpacity:void 0},Ad=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function Cd(I){if(I){if(typeof I=="number"){const u=Math.round(Math.abs(I)/Math.SQRT2);return{center:new o.P(0,0),top:new o.P(0,I),"top-left":new o.P(u,u),"top-right":new o.P(-u,u),bottom:new o.P(0,-I),"bottom-left":new o.P(u,-u),"bottom-right":new o.P(-u,-u),left:new o.P(I,0),right:new o.P(-I,0)}}if(I instanceof o.P||Array.isArray(I)){const u=o.P.convert(I);return{center:u,top:u,"top-left":u,"top-right":u,bottom:u,"bottom-left":u,"bottom-right":u,left:u,right:u}}return{center:o.P.convert(I.center||[0,0]),top:o.P.convert(I.top||[0,0]),"top-left":o.P.convert(I["top-left"]||[0,0]),"top-right":o.P.convert(I["top-right"]||[0,0]),bottom:o.P.convert(I.bottom||[0,0]),"bottom-left":o.P.convert(I["bottom-left"]||[0,0]),"bottom-right":o.P.convert(I["bottom-right"]||[0,0]),left:o.P.convert(I.left||[0,0]),right:o.P.convert(I.right||[0,0])}}return Cd(new o.P(0,0))}const zp=l;s.AJAXError=o.cz,s.Event=o.l,s.Evented=o.E,s.LngLat=o.S,s.MercatorCoordinate=o.a1,s.Point=o.P,s.addProtocol=o.cA,s.config=o.a,s.removeProtocol=o.cB,s.AttributionControl=gr,s.BoxZoomHandler=Ea,s.CanvasSource=Na,s.CooperativeGesturesHandler=wd,s.DoubleClickZoomHandler=Yl,s.DragPanHandler=Kl,s.DragRotateHandler=cs,s.EdgeInsets=Dc,s.FullscreenControl=class extends o.E{constructor(I={}){super(),this._onFullscreenChange=()=>{var u;let m=window.document.fullscreenElement||window.document.mozFullScreenElement||window.document.webkitFullscreenElement||window.document.msFullscreenElement;for(;!((u=m?.shadowRoot)===null||u===void 0)&&u.fullscreenElement;)m=m.shadowRoot.fullscreenElement;m===this._container!==this._fullscreen&&this._handleFullscreenChange()},this._onClickFullscreen=()=>{this._isFullscreen()?this._exitFullscreen():this._requestFullscreen()},this._fullscreen=!1,I&&I.container&&(I.container instanceof HTMLElement?this._container=I.container:o.w("Full screen control 'container' must be a DOM element.")),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in document&&(this._fullscreenchange="MSFullscreenChange")}onAdd(I){return this._map=I,this._container||(this._container=this._map.getContainer()),this._controlContainer=b.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),this._controlContainer}onRemove(){b.remove(this._controlContainer),this._map=null,window.document.removeEventListener(this._fullscreenchange,this._onFullscreenChange)}_setupUI(){const I=this._fullscreenButton=b.create("button","maplibregl-ctrl-fullscreen",this._controlContainer);b.create("span","maplibregl-ctrl-icon",I).setAttribute("aria-hidden","true"),I.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),window.document.addEventListener(this._fullscreenchange,this._onFullscreenChange)}_updateTitle(){const I=this._getTitle();this._fullscreenButton.setAttribute("aria-label",I),this._fullscreenButton.title=I}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_handleFullscreenChange(){this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("maplibregl-ctrl-shrink"),this._fullscreenButton.classList.toggle("maplibregl-ctrl-fullscreen"),this._updateTitle(),this._fullscreen?(this.fire(new o.l("fullscreenstart")),this._prevCooperativeGesturesEnabled=this._map.cooperativeGestures.isEnabled(),this._map.cooperativeGestures.disable()):(this.fire(new o.l("fullscreenend")),this._prevCooperativeGesturesEnabled&&this._map.cooperativeGestures.enable())}_exitFullscreen(){window.document.exitFullscreen?window.document.exitFullscreen():window.document.mozCancelFullScreen?window.document.mozCancelFullScreen():window.document.msExitFullscreen?window.document.msExitFullscreen():window.document.webkitCancelFullScreen?window.document.webkitCancelFullScreen():this._togglePseudoFullScreen()}_requestFullscreen(){this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen?this._container.webkitRequestFullscreen():this._togglePseudoFullScreen()}_togglePseudoFullScreen(){this._container.classList.toggle("maplibregl-pseudo-fullscreen"),this._handleFullscreenChange(),this._map.resize()}},s.GeoJSONSource=In,s.GeolocateControl=class extends o.E{constructor(I){super(),this._onSuccess=u=>{if(this._map){if(this._isOutOfMapMaxBounds(u))return this._setErrorState(),this.fire(new o.l("outofmaxbounds",u)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=u,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background");break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(u),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(u),this.options.showUserLocation&&this._dotElement.classList.remove("maplibregl-user-location-dot-stale"),this.fire(new o.l("geolocate",u)),this._finish()}},this._updateCamera=u=>{const m=new o.S(u.coords.longitude,u.coords.latitude),w=u.coords.accuracy,M=this._map.getBearing(),R=o.e({bearing:M},this.options.fitBoundsOptions),N=Tr.fromLngLat(m,w);this._map.fitBounds(N,R,{geolocateSource:!0})},this._updateMarker=u=>{if(u){const m=new o.S(u.coords.longitude,u.coords.latitude);this._accuracyCircleMarker.setLngLat(m).addTo(this._map),this._userLocationDotMarker.setLngLat(m).addTo(this._map),this._accuracy=u.coords.accuracy,this._updateCircleRadiusIfNeeded()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},this._onUpdate=()=>{this._updateCircleRadiusIfNeeded()},this._onError=u=>{if(this._map){if(u.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const m=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=m,this._geolocateButton.setAttribute("aria-label",m),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(u.code===3&&Ws)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("maplibregl-user-location-dot-stale"),this.fire(new o.l("error",u)),this._finish()}},this._finish=()=>{this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},this._setupUI=()=>{this._map&&(this._container.addEventListener("contextmenu",(u=>u.preventDefault())),this._geolocateButton=b.create("button","maplibregl-ctrl-geolocate",this._container),b.create("span","maplibregl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",this._geolocateButton.disabled=!0)},this._finishSetupUI=u=>{if(this._map){if(u===!1){o.w("Geolocation support is not available so the GeolocateControl will be disabled.");const m=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=m,this._geolocateButton.setAttribute("aria-label",m)}else{const m=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.disabled=!1,this._geolocateButton.title=m,this._geolocateButton.setAttribute("aria-label",m)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=b.create("div","maplibregl-user-location-dot"),this._userLocationDotMarker=new Tl({element:this._dotElement}),this._circleElement=b.create("div","maplibregl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Tl({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onUpdate),this._map.on("move",this._onUpdate),this._map.on("rotate",this._onUpdate),this._map.on("pitch",this._onUpdate)),this._geolocateButton.addEventListener("click",(()=>this.trigger())),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",(m=>{const w=m?.[0]instanceof ResizeObserverEntry;m.geolocateSource||this._watchState!=="ACTIVE_LOCK"||w||this._map.isZooming()||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this.fire(new o.l("trackuserlocationend")),this.fire(new o.l("userlocationlostfocus")))}))}},this.options=o.e({},Jl,I)}onAdd(I){return this._map=I,this._container=b.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),(function(){return o._(this,arguments,void 0,(function*(u=!1){if(kr!==void 0&&!u)return kr;if(window.navigator.permissions===void 0)return kr=!!window.navigator.geolocation,kr;try{kr=(yield window.navigator.permissions.query({name:"geolocation"})).state!=="denied"}catch{kr=!!window.navigator.geolocation}return kr}))})().then((u=>this._finishSetupUI(u))),this._container}onRemove(){this._geolocationWatchID!==void 0&&(window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),b.remove(this._container),this._map.off("zoom",this._onUpdate),this._map.off("move",this._onUpdate),this._map.off("rotate",this._onUpdate),this._map.off("pitch",this._onUpdate),this._map=void 0,$s=0,Ws=!1}_isOutOfMapMaxBounds(I){const u=this._map.getMaxBounds(),m=I.coords;return u&&(m.longitude<u.getWest()||m.longitude>u.getEast()||m.latitude<u.getSouth()||m.latitude>u.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"ACTIVE_ERROR":case"BACKGROUND_ERROR":case"OFF":case void 0:break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}}_updateCircleRadiusIfNeeded(){const I=this._userLocationDotMarker.getLngLat();if(!(this.options.showUserLocation&&this.options.showAccuracyCircle&&this._accuracy&&I))return;const u=this._map.project(I),m=this._map.unproject([u.x+100,u.y]),w=I.distanceTo(m)/100,M=2*this._accuracy/w;this._circleElement.style.width=`${M.toFixed(2)}px`,this._circleElement.style.height=`${M.toFixed(2)}px`}trigger(){if(!this._setup)return o.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new o.l("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":$s--,Ws=!1,this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this.fire(new o.l("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new o.l("trackuserlocationstart")),this.fire(new o.l("userlocationfocus"));break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"OFF":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let I;this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),$s++,$s>1?(I={maximumAge:6e5,timeout:0},Ws=!0):(I=this.options.positionOptions,Ws=!1),this._geolocationWatchID=window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,I)}}else window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_clearWatch(){window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},s.GlobeControl=class{constructor(){this._toggleProjection=()=>{var I;const u=(I=this._map.getProjection())===null||I===void 0?void 0:I.type;this._map.setProjection(u!=="mercator"&&u?{type:"mercator"}:{type:"globe"}),this._updateGlobeIcon()},this._updateGlobeIcon=()=>{var I;this._globeButton.classList.remove("maplibregl-ctrl-globe"),this._globeButton.classList.remove("maplibregl-ctrl-globe-enabled"),((I=this._map.getProjection())===null||I===void 0?void 0:I.type)==="globe"?(this._globeButton.classList.add("maplibregl-ctrl-globe-enabled"),this._globeButton.title=this._map._getUIString("GlobeControl.Disable")):(this._globeButton.classList.add("maplibregl-ctrl-globe"),this._globeButton.title=this._map._getUIString("GlobeControl.Enable"))}}onAdd(I){return this._map=I,this._container=b.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._globeButton=b.create("button","maplibregl-ctrl-globe",this._container),b.create("span","maplibregl-ctrl-icon",this._globeButton).setAttribute("aria-hidden","true"),this._globeButton.type="button",this._globeButton.addEventListener("click",this._toggleProjection),this._updateGlobeIcon(),this._map.on("styledata",this._updateGlobeIcon),this._container}onRemove(){b.remove(this._container),this._map.off("styledata",this._updateGlobeIcon),this._globeButton.removeEventListener("click",this._toggleProjection),this._map=void 0}},s.Hash=pd,s.ImageSource=Li,s.KeyboardHandler=ju,s.LngLatBounds=Tr,s.LogoControl=Jc,s.Map=class extends Sd{constructor(I){var u,m;o.cw.mark(o.cx.create);const w=Object.assign(Object.assign(Object.assign({},an),I),{canvasContextAttributes:Object.assign(Object.assign({},an.canvasContextAttributes),I.canvasContextAttributes)});if(w.minZoom!=null&&w.maxZoom!=null&&w.minZoom>w.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(w.minPitch!=null&&w.maxPitch!=null&&w.minPitch>w.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(w.minPitch!=null&&w.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(w.maxPitch!=null&&w.maxPitch>180)throw new Error("maxPitch must be less than or equal to 180");const M=new pl,R=new ns;if(w.minZoom!==void 0&&M.setMinZoom(w.minZoom),w.maxZoom!==void 0&&M.setMaxZoom(w.maxZoom),w.minPitch!==void 0&&M.setMinPitch(w.minPitch),w.maxPitch!==void 0&&M.setMaxPitch(w.maxPitch),w.renderWorldCopies!==void 0&&M.setRenderWorldCopies(w.renderWorldCopies),super(M,R,{bearingSnap:w.bearingSnap}),this._idleTriggered=!1,this._crossFadingFactor=1,this._renderTaskQueue=new Np,this._controls=[],this._mapId=o.a7(),this._contextLost=H=>{H.preventDefault(),this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this.fire(new o.l("webglcontextlost",{originalEvent:H}))},this._contextRestored=H=>{this._setupPainter(),this.resize(),this._update(),this.fire(new o.l("webglcontextrestored",{originalEvent:H}))},this._onMapScroll=H=>{if(H.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},this._onWindowOnline=()=>{this._update()},this._interactive=w.interactive,this._maxTileCacheSize=w.maxTileCacheSize,this._maxTileCacheZoomLevels=w.maxTileCacheZoomLevels,this._canvasContextAttributes=Object.assign({},w.canvasContextAttributes),this._trackResize=w.trackResize===!0,this._bearingSnap=w.bearingSnap,this._centerClampedToGround=w.centerClampedToGround,this._refreshExpiredTiles=w.refreshExpiredTiles===!0,this._fadeDuration=w.fadeDuration,this._crossSourceCollisions=w.crossSourceCollisions===!0,this._collectResourceTiming=w.collectResourceTiming===!0,this._locale=Object.assign(Object.assign({},Gu),w.locale),this._clickTolerance=w.clickTolerance,this._overridePixelRatio=w.pixelRatio,this._maxCanvasSize=w.maxCanvasSize,this.transformCameraUpdate=w.transformCameraUpdate,this.cancelPendingTileRequestsWhileZooming=w.cancelPendingTileRequestsWhileZooming===!0,this._imageQueueHandle=F.addThrottleControl((()=>this.isMoving())),this._requestManager=new W(w.transformRequest),typeof w.container=="string"){if(this._container=document.getElementById(w.container),!this._container)throw new Error(`Container '${w.container}' not found.`)}else{if(!(w.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=w.container}if(w.maxBounds&&this.setMaxBounds(w.maxBounds),this._setupContainer(),this._setupPainter(),this.on("move",(()=>this._update(!1))),this.on("moveend",(()=>this._update(!1))),this.on("zoom",(()=>this._update(!0))),this.on("terrain",(()=>{this.painter.terrainFacilitator.dirty=!0,this._update(!0)})),this.once("idle",(()=>{this._idleTriggered=!0})),typeof window<"u"){addEventListener("online",this._onWindowOnline,!1);let H=!1;const j=Hs((Y=>{this._trackResize&&!this._removed&&(this.resize(Y),this.redraw())}),50);this._resizeObserver=new ResizeObserver((Y=>{H?j(Y):H=!0})),this._resizeObserver.observe(this._container)}this.handlers=new js(this,w),this._hash=w.hash&&new pd(typeof w.hash=="string"&&w.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:w.center,elevation:w.elevation,zoom:w.zoom,bearing:w.bearing,pitch:w.pitch,roll:w.roll}),w.bounds&&(this.resize(),this.fitBounds(w.bounds,o.e({},w.fitBoundsOptions,{duration:0}))));const N=typeof w.style=="string"||((m=(u=w.style)===null||u===void 0?void 0:u.projection)===null||m===void 0?void 0:m.type)!=="globe";this.resize(null,N),this._localIdeographFontFamily=w.localIdeographFontFamily,this._validateStyle=w.validateStyle,w.style&&this.setStyle(w.style,{localIdeographFontFamily:w.localIdeographFontFamily}),w.attributionControl&&this.addControl(new gr(typeof w.attributionControl=="boolean"?void 0:w.attributionControl)),w.maplibreLogo&&this.addControl(new Jc,w.logoPosition),this.on("style.load",(()=>{if(N||this._resizeTransform(),this.transform.unmodified){const H=o.Q(this.style.stylesheet,["center","zoom","bearing","pitch","roll"]);this.jumpTo(H)}})),this.on("data",(H=>{this._update(H.dataType==="style"),this.fire(new o.l(`${H.dataType}data`,H))})),this.on("dataloading",(H=>{this.fire(new o.l(`${H.dataType}dataloading`,H))})),this.on("dataabort",(H=>{this.fire(new o.l("sourcedataabort",H))}))}_getMapId(){return this._mapId}setGlobalStateProperty(I,u){return this.style.setGlobalStateProperty(I,u),this._update(!0)}getGlobalState(){return this.style.getGlobalState()}addControl(I,u){if(u===void 0&&(u=I.getDefaultPosition?I.getDefaultPosition():"top-right"),!I||!I.onAdd)return this.fire(new o.k(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const m=I.onAdd(this);this._controls.push(I);const w=this._controlPositions[u];return u.indexOf("bottom")!==-1?w.insertBefore(m,w.firstChild):w.appendChild(m),this}removeControl(I){if(!I||!I.onRemove)return this.fire(new o.k(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const u=this._controls.indexOf(I);return u>-1&&this._controls.splice(u,1),I.onRemove(this),this}hasControl(I){return this._controls.indexOf(I)>-1}coveringTiles(I){return Kr(this.transform,I)}calculateCameraOptionsFromTo(I,u,m,w){return w==null&&this.terrain&&(w=this.terrain.getElevationForLngLatZoom(m,this.transform.tileZoom)),super.calculateCameraOptionsFromTo(I,u,m,w)}resize(I,u=!0){const[m,w]=this._containerDimensions(),M=this._getClampedPixelRatio(m,w);if(this._resizeCanvas(m,w,M),this.painter.resize(m,w,M),this.painter.overLimit()){const N=this.painter.context.gl;this._maxCanvasSize=[N.drawingBufferWidth,N.drawingBufferHeight];const H=this._getClampedPixelRatio(m,w);this._resizeCanvas(m,w,H),this.painter.resize(m,w,H)}this._resizeTransform(u);const R=!this._moving;return R&&(this.stop(),this.fire(new o.l("movestart",I)).fire(new o.l("move",I))),this.fire(new o.l("resize",I)),R&&this.fire(new o.l("moveend",I)),this}_resizeTransform(I=!0){var u;const[m,w]=this._containerDimensions();this.transform.resize(m,w,I),(u=this._requestedCameraState)===null||u===void 0||u.resize(m,w,I)}_getClampedPixelRatio(I,u){const{0:m,1:w}=this._maxCanvasSize,M=this.getPixelRatio(),R=I*M,N=u*M;return Math.min(R>m?m/R:1,N>w?w/N:1)*M}getPixelRatio(){var I;return(I=this._overridePixelRatio)!==null&&I!==void 0?I:devicePixelRatio}setPixelRatio(I){this._overridePixelRatio=I,this.resize()}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()}setMaxBounds(I){return this.transform.setMaxBounds(Tr.convert(I)),this._update()}setMinZoom(I){if((I=I??-2)>=-2&&I<=this.transform.maxZoom)return this.transform.setMinZoom(I),this._update(),this.getZoom()<I&&this.setZoom(I),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(I){if((I=I??22)>=this.transform.minZoom)return this.transform.setMaxZoom(I),this._update(),this.getZoom()>I&&this.setZoom(I),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(I){if((I=I??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(I>=0&&I<=this.transform.maxPitch)return this.transform.setMinPitch(I),this._update(),this.getPitch()<I&&this.setPitch(I),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(I){if((I=I??60)>180)throw new Error("maxPitch must be less than or equal to 180");if(I>=this.transform.minPitch)return this.transform.setMaxPitch(I),this._update(),this.getPitch()>I&&this.setPitch(I),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(I){return this.transform.setRenderWorldCopies(I),this._update()}project(I){return this.transform.locationToScreenPoint(o.S.convert(I),this.style&&this.terrain)}unproject(I){return this.transform.screenPointToLocation(o.P.convert(I),this.terrain)}isMoving(){var I;return this._moving||((I=this.handlers)===null||I===void 0?void 0:I.isMoving())}isZooming(){var I;return this._zooming||((I=this.handlers)===null||I===void 0?void 0:I.isZooming())}isRotating(){var I;return this._rotating||((I=this.handlers)===null||I===void 0?void 0:I.isRotating())}_createDelegatedListener(I,u,m){if(I==="mouseenter"||I==="mouseover"){let w=!1;return{layers:u,listener:m,delegates:{mousemove:R=>{const N=u.filter((j=>this.getLayer(j))),H=N.length!==0?this.queryRenderedFeatures(R.point,{layers:N}):[];H.length?w||(w=!0,m.call(this,new wo(I,this,R.originalEvent,{features:H}))):w=!1},mouseout:()=>{w=!1}}}}if(I==="mouseleave"||I==="mouseout"){let w=!1;return{layers:u,listener:m,delegates:{mousemove:N=>{const H=u.filter((j=>this.getLayer(j)));(H.length!==0?this.queryRenderedFeatures(N.point,{layers:H}):[]).length?w=!0:w&&(w=!1,m.call(this,new wo(I,this,N.originalEvent)))},mouseout:N=>{w&&(w=!1,m.call(this,new wo(I,this,N.originalEvent)))}}}}{const w=M=>{const R=u.filter((H=>this.getLayer(H))),N=R.length!==0?this.queryRenderedFeatures(M.point,{layers:R}):[];N.length&&(M.features=N,m.call(this,M),delete M.features)};return{layers:u,listener:m,delegates:{[I]:w}}}}_saveDelegatedListener(I,u){this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[I]=this._delegatedListeners[I]||[],this._delegatedListeners[I].push(u)}_removeDelegatedListener(I,u,m){if(!this._delegatedListeners||!this._delegatedListeners[I])return;const w=this._delegatedListeners[I];for(let M=0;M<w.length;M++){const R=w[M];if(R.listener===m&&R.layers.length===u.length&&R.layers.every((N=>u.includes(N)))){for(const N in R.delegates)this.off(N,R.delegates[N]);return void w.splice(M,1)}}}on(I,u,m){if(m===void 0)return super.on(I,u);const w=typeof u=="string"?[u]:u,M=this._createDelegatedListener(I,w,m);this._saveDelegatedListener(I,M);for(const R in M.delegates)this.on(R,M.delegates[R]);return{unsubscribe:()=>{this._removeDelegatedListener(I,w,m)}}}once(I,u,m){if(m===void 0)return super.once(I,u);const w=typeof u=="string"?[u]:u,M=this._createDelegatedListener(I,w,m);for(const R in M.delegates){const N=M.delegates[R];M.delegates[R]=(...H)=>{this._removeDelegatedListener(I,w,m),N(...H)}}this._saveDelegatedListener(I,M);for(const R in M.delegates)this.once(R,M.delegates[R]);return this}off(I,u,m){return m===void 0?super.off(I,u):(this._removeDelegatedListener(I,typeof u=="string"?[u]:u,m),this)}queryRenderedFeatures(I,u){if(!this.style)return[];let m;const w=I instanceof o.P||Array.isArray(I),M=w?I:[[0,0],[this.transform.width,this.transform.height]];if(u=u||(w?{}:I)||{},M instanceof o.P||typeof M[0]=="number")m=[o.P.convert(M)];else{const R=o.P.convert(M[0]),N=o.P.convert(M[1]);m=[R,new o.P(N.x,R.y),N,new o.P(R.x,N.y),R]}return this.style.queryRenderedFeatures(m,u,this.transform)}querySourceFeatures(I,u){return this.style.querySourceFeatures(I,u)}setStyle(I,u){return(u=o.e({},{localIdeographFontFamily:this._localIdeographFontFamily,validate:this._validateStyle},u)).diff!==!1&&u.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&I?(this._diffStyle(I,u),this):(this._localIdeographFontFamily=u.localIdeographFontFamily,this._updateStyle(I,u))}setTransformRequest(I){return this._requestManager.setTransformRequest(I),this}_getUIString(I){const u=this._locale[I];if(u==null)throw new Error(`Missing UI string '${I}'`);return u}_updateStyle(I,u){var m,w;if(u.transformStyle&&this.style&&!this.style._loaded)return void this.style.once("style.load",(()=>this._updateStyle(I,u)));const M=this.style&&u.transformStyle?this.style.serialize():void 0;return this.style&&(this.style.setEventedParent(null),this.style._remove(!I)),I?(this.style=new nv(this,u||{}),this.style.setEventedParent(this,{style:this.style}),typeof I=="string"?this.style.loadURL(I,u,M):this.style.loadJSON(I,u,M),this):((w=(m=this.style)===null||m===void 0?void 0:m.projection)===null||w===void 0||w.destroy(),delete this.style,this)}_lazyInitEmptyStyle(){this.style||(this.style=new nv(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(I,u){if(typeof I=="string"){const m=this._requestManager.transformRequest(I,"Style");o.j(m,new AbortController).then((w=>{this._updateDiff(w.data,u)})).catch((w=>{w&&this.fire(new o.k(w))}))}else typeof I=="object"&&this._updateDiff(I,u)}_updateDiff(I,u){try{this.style.setState(I,u)&&this._update(!0)}catch(m){o.w(`Unable to perform style diff: ${m.message||m.error||m}.  Rebuilding the style from scratch.`),this._updateStyle(I,u)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():o.w("There is no style added to the map.")}addSource(I,u){return this._lazyInitEmptyStyle(),this.style.addSource(I,u),this._update(!0)}isSourceLoaded(I){const u=this.style&&this.style.sourceCaches[I];if(u!==void 0)return u.loaded();this.fire(new o.k(new Error(`There is no source with ID '${I}'`)))}setTerrain(I){if(this.style._checkLoaded(),this._terrainDataCallback&&this.style.off("data",this._terrainDataCallback),I){const u=this.style.sourceCaches[I.source];if(!u)throw new Error(`cannot load terrain, because there exists no source with ID: ${I.source}`);this.terrain===null&&u.reload();for(const m in this.style._layers){const w=this.style._layers[m];w.type==="hillshade"&&w.source===I.source&&o.w("You are using the same source for a hillshade layer and for 3D terrain. Please consider using two separate sources to improve rendering quality."),w.type==="color-relief"&&w.source===I.source&&o.w("You are using the same source for a color-relief layer and for 3D terrain. Please consider using two separate sources to improve rendering quality.")}this.terrain=new jo(this.painter,u,I),this.painter.renderToTexture=new Yy(this.painter,this.terrain),this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this.transform.setElevation(this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this._terrainDataCallback=m=>{var w;m.dataType==="style"?this.terrain.sourceCache.freeRtt():m.dataType==="source"&&m.tile&&(m.sourceId!==I.source||this._elevationFreeze||(this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this._centerClampedToGround&&this.transform.setElevation(this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))),((w=m.source)===null||w===void 0?void 0:w.type)==="image"?this.terrain.sourceCache.freeRtt():this.terrain.sourceCache.freeRtt(m.tile.tileID))},this.style.on("data",this._terrainDataCallback)}else this.terrain&&this.terrain.sourceCache.destruct(),this.terrain=null,this.painter.renderToTexture&&this.painter.renderToTexture.destruct(),this.painter.renderToTexture=null,this.transform.setMinElevationForCurrentTile(0),this._centerClampedToGround&&this.transform.setElevation(0);return this.fire(new o.l("terrain",{terrain:I})),this}getTerrain(){var I,u;return(u=(I=this.terrain)===null||I===void 0?void 0:I.options)!==null&&u!==void 0?u:null}areTilesLoaded(){const I=this.style&&this.style.sourceCaches;for(const u in I){const m=I[u]._tiles;for(const w in m){const M=m[w];if(M.state!=="loaded"&&M.state!=="errored")return!1}}return!0}removeSource(I){return this.style.removeSource(I),this._update(!0)}getSource(I){return this.style.getSource(I)}setSourceTileLodParams(I,u,m){if(m){const w=this.getSource(m);if(!w)throw new Error(`There is no source with ID "${m}", cannot set LOD parameters`);w.calculateTileZoom=rr(Math.max(1,I),Math.max(1,u))}else for(const w in this.style.sourceCaches)this.style.sourceCaches[w].getSource().calculateTileZoom=rr(Math.max(1,I),Math.max(1,u));return this._update(!0),this}refreshTiles(I,u){const m=this.style.sourceCaches[I];if(!m)throw new Error(`There is no source cache with ID "${I}", cannot refresh tile`);u===void 0?m.reload(!0):m.refreshTiles(u.map((w=>new o.a4(w.z,w.x,w.y))))}addImage(I,u,m={}){const{pixelRatio:w=1,sdf:M=!1,stretchX:R,stretchY:N,content:H,textFitWidth:j,textFitHeight:Y}=m;if(this._lazyInitEmptyStyle(),!(u instanceof HTMLImageElement||o.b(u))){if(u.width===void 0||u.height===void 0)return this.fire(new o.k(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{const{width:K,height:ie,data:re}=u,ue=u;return this.style.addImage(I,{data:new o.R({width:K,height:ie},new Uint8Array(re)),pixelRatio:w,stretchX:R,stretchY:N,content:H,textFitWidth:j,textFitHeight:Y,sdf:M,version:0,userImage:ue}),ue.onAdd&&ue.onAdd(this,I),this}}{const{width:K,height:ie,data:re}=y.getImageData(u);this.style.addImage(I,{data:new o.R({width:K,height:ie},re),pixelRatio:w,stretchX:R,stretchY:N,content:H,textFitWidth:j,textFitHeight:Y,sdf:M,version:0})}}updateImage(I,u){const m=this.style.getImage(I);if(!m)return this.fire(new o.k(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const w=u instanceof HTMLImageElement||o.b(u)?y.getImageData(u):u,{width:M,height:R,data:N}=w;if(M===void 0||R===void 0)return this.fire(new o.k(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(M!==m.data.width||R!==m.data.height)return this.fire(new o.k(new Error("The width and height of the updated image must be that same as the previous version of the image")));const H=!(u instanceof HTMLImageElement||o.b(u));return m.data.replace(N,H),this.style.updateImage(I,m),this}getImage(I){return this.style.getImage(I)}hasImage(I){return I?!!this.style.getImage(I):(this.fire(new o.k(new Error("Missing required image id"))),!1)}removeImage(I){this.style.removeImage(I)}loadImage(I){return F.getImage(this._requestManager.transformRequest(I,"Image"),new AbortController)}listImages(){return this.style.listImages()}addLayer(I,u){return this._lazyInitEmptyStyle(),this.style.addLayer(I,u),this._update(!0)}moveLayer(I,u){return this.style.moveLayer(I,u),this._update(!0)}removeLayer(I){return this.style.removeLayer(I),this._update(!0)}getLayer(I){return this.style.getLayer(I)}getLayersOrder(){return this.style.getLayersOrder()}setLayerZoomRange(I,u,m){return this.style.setLayerZoomRange(I,u,m),this._update(!0)}setFilter(I,u,m={}){return this.style.setFilter(I,u,m),this._update(!0)}getFilter(I){return this.style.getFilter(I)}setPaintProperty(I,u,m,w={}){return this.style.setPaintProperty(I,u,m,w),this._update(!0)}getPaintProperty(I,u){return this.style.getPaintProperty(I,u)}setLayoutProperty(I,u,m,w={}){return this.style.setLayoutProperty(I,u,m,w),this._update(!0)}getLayoutProperty(I,u){return this.style.getLayoutProperty(I,u)}setGlyphs(I,u={}){return this._lazyInitEmptyStyle(),this.style.setGlyphs(I,u),this._update(!0)}getGlyphs(){return this.style.getGlyphsUrl()}addSprite(I,u,m={}){return this._lazyInitEmptyStyle(),this.style.addSprite(I,u,m,(w=>{w||this._update(!0)})),this}removeSprite(I){return this._lazyInitEmptyStyle(),this.style.removeSprite(I),this._update(!0)}getSprite(){return this.style.getSprite()}setSprite(I,u={}){return this._lazyInitEmptyStyle(),this.style.setSprite(I,u,(m=>{m||this._update(!0)})),this}setLight(I,u={}){return this._lazyInitEmptyStyle(),this.style.setLight(I,u),this._update(!0)}getLight(){return this.style.getLight()}setSky(I,u={}){return this._lazyInitEmptyStyle(),this.style.setSky(I,u),this._update(!0)}getSky(){return this.style.getSky()}setFeatureState(I,u){return this.style.setFeatureState(I,u),this._update()}removeFeatureState(I,u){return this.style.removeFeatureState(I,u),this._update()}getFeatureState(I){return this.style.getFeatureState(I)}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}_containerDimensions(){let I=0,u=0;return this._container&&(I=this._container.clientWidth||400,u=this._container.clientHeight||300),[I,u]}_setupContainer(){const I=this._container;I.classList.add("maplibregl-map");const u=this._canvasContainer=b.create("div","maplibregl-canvas-container",I);this._interactive&&u.classList.add("maplibregl-interactive"),this._canvas=b.create("canvas","maplibregl-canvas",u),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex",this._interactive?"0":"-1"),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region");const m=this._containerDimensions(),w=this._getClampedPixelRatio(m[0],m[1]);this._resizeCanvas(m[0],m[1],w);const M=this._controlContainer=b.create("div","maplibregl-control-container",I),R=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach((N=>{R[N]=b.create("div",`maplibregl-ctrl-${N} `,M)})),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(I,u,m){this._canvas.width=Math.floor(m*I),this._canvas.height=Math.floor(m*u),this._canvas.style.width=`${I}px`,this._canvas.style.height=`${u}px`}_setupPainter(){const I=Object.assign(Object.assign({},this._canvasContextAttributes),{alpha:!0,depth:!0,stencil:!0,premultipliedAlpha:!0});let u=null;this._canvas.addEventListener("webglcontextcreationerror",(w=>{u={requestedAttributes:I},w&&(u.statusMessage=w.statusMessage,u.type=w.type)}),{once:!0});let m=null;if(m=this._canvasContextAttributes.contextType?this._canvas.getContext(this._canvasContextAttributes.contextType,I):this._canvas.getContext("webgl2",I)||this._canvas.getContext("webgl",I),!m){const w="Failed to initialize WebGL";throw u?(u.message=w,new Error(JSON.stringify(u))):new Error(w)}this.painter=new ql(m,this.transform),S.testSupport(m)}migrateProjection(I,u){super.migrateProjection(I,u),this.painter.transform=I,this.fire(new o.l("projectiontransition",{newProjection:this.style.projection.name}))}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(I){return this.style&&this.style._loaded?(this._styleDirty=this._styleDirty||I,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(I){return this._update(),this._renderTaskQueue.add(I)}_cancelRenderFrame(I){this._renderTaskQueue.remove(I)}_render(I){var u,m,w,M,R;const N=this._idleTriggered?this._fadeDuration:0,H=((u=this.style.projection)===null||u===void 0?void 0:u.transitionState)>0;if(this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(I),this._removed)return;let j=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;const ie=this.transform.zoom,re=y.now();this.style.zoomHistory.update(ie,re);const ue=new o.F(ie,{now:re,fadeDuration:N,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),pe=ue.crossFadingFactor();pe===1&&pe===this._crossFadingFactor||(j=!0,this._crossFadingFactor=pe),this.style.update(ue)}const Y=((m=this.style.projection)===null||m===void 0?void 0:m.transitionState)>0!==H;(w=this.style.projection)===null||w===void 0||w.setErrorQueryLatitudeDegrees(this.transform.center.lat),this.transform.setTransitionState((M=this.style.projection)===null||M===void 0?void 0:M.transitionState,(R=this.style.projection)===null||R===void 0?void 0:R.latitudeErrorCorrectionRadians),this.style&&(this._sourcesDirty||Y)&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this.terrain?(this.terrain.sourceCache.update(this.transform,this.terrain),this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),!this._elevationFreeze&&this._centerClampedToGround&&this.transform.setElevation(this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))):(this.transform.setMinElevationForCurrentTile(0),this._centerClampedToGround&&this.transform.setElevation(0)),this._placementDirty=this.style&&this.style._updatePlacement(this.transform,this.showCollisionBoxes,N,this._crossSourceCollisions,Y),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:N,showPadding:this.showPadding}),this.fire(new o.l("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,o.cw.mark(o.cx.load),this.fire(new o.l("load"))),this.style&&(this.style.hasTransitions()||j)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles();const K=this._sourcesDirty||this._styleDirty||this._placementDirty;return K||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new o.l("idle")),!this._loaded||this._fullyLoaded||K||(this._fullyLoaded=!0,o.cw.mark(o.cx.fullLoad)),this}redraw(){return this.style&&(this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._render(0)),this}remove(){var I;this._hash&&this._hash.remove();for(const m of this._controls)m.onRemove(this);this._controls=[],this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),typeof window<"u"&&removeEventListener("online",this._onWindowOnline,!1),F.removeThrottleControl(this._imageQueueHandle),(I=this._resizeObserver)===null||I===void 0||I.disconnect();const u=this.painter.context.gl.getExtension("WEBGL_lose_context");u?.loseContext&&u.loseContext(),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),b.remove(this._canvasContainer),b.remove(this._controlContainer),this._container.removeEventListener("scroll",this._onMapScroll,!1),this._container.classList.remove("maplibregl-map"),o.cw.clearMetrics(),this._removed=!0,this.fire(new o.l("remove"))}triggerRepaint(){this.style&&!this._frameRequest&&(this._frameRequest=new AbortController,y.frame(this._frameRequest,(I=>{o.cw.frame(I),this._frameRequest=null;try{this._render(I)}catch(u){if(!o.cy(u)&&!(function(m){return m.message===hd})(u))throw u}}),(()=>{})))}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(I){this._showTileBoundaries!==I&&(this._showTileBoundaries=I,this._update())}get showPadding(){return!!this._showPadding}set showPadding(I){this._showPadding!==I&&(this._showPadding=I,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(I){this._showCollisionBoxes!==I&&(this._showCollisionBoxes=I,I?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(I){this._showOverdrawInspector!==I&&(this._showOverdrawInspector=I,this._update())}get repaint(){return!!this._repaint}set repaint(I){this._repaint!==I&&(this._repaint=I,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(I){this._vertices=I,this._update()}get version(){return $o}getCameraTargetElevation(){return this.transform.elevation}getProjection(){return this.style.getProjection()}setProjection(I){return this._lazyInitEmptyStyle(),this.style.setProjection(I),this._update(!0)}},s.MapMouseEvent=wo,s.MapTouchEvent=Yi,s.MapWheelEvent=md,s.Marker=Tl,s.NavigationControl=class{constructor(I){this._updateZoomButtons=()=>{const u=this._map.getZoom(),m=u===this._map.getMaxZoom(),w=u===this._map.getMinZoom();this._zoomInButton.disabled=m,this._zoomOutButton.disabled=w,this._zoomInButton.setAttribute("aria-disabled",m.toString()),this._zoomOutButton.setAttribute("aria-disabled",w.toString())},this._rotateCompassArrow=()=>{this._compassIcon.style.transform=this.options.visualizePitch&&this.options.visualizeRoll?`scale(${1/Math.pow(Math.cos(this._map.transform.pitchInRadians),.5)}) rotateZ(${-this._map.transform.roll}deg) rotateX(${this._map.transform.pitch}deg) rotateZ(${-this._map.transform.bearing}deg)`:this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitchInRadians),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${-this._map.transform.bearing}deg)`:this.options.visualizeRoll?`rotate(${-this._map.transform.bearing-this._map.transform.roll}deg)`:`rotate(${-this._map.transform.bearing}deg)`},this._setButtonTitle=(u,m)=>{const w=this._map._getUIString(`NavigationControl.${m}`);u.title=w,u.setAttribute("aria-label",w)},this.options=o.e({},Qi,I),this._container=b.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._container.addEventListener("contextmenu",(u=>u.preventDefault())),this.options.showZoom&&(this._zoomInButton=this._createButton("maplibregl-ctrl-zoom-in",(u=>this._map.zoomIn({},{originalEvent:u}))),b.create("span","maplibregl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("maplibregl-ctrl-zoom-out",(u=>this._map.zoomOut({},{originalEvent:u}))),b.create("span","maplibregl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(this._compass=this._createButton("maplibregl-ctrl-compass",(u=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:u}):this._map.resetNorth({},{originalEvent:u})})),this._compassIcon=b.create("span","maplibregl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}onAdd(I){return this._map=I,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this.options.visualizeRoll&&this._map.on("roll",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Bi(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){b.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this.options.visualizeRoll&&this._map.off("roll",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(I,u){const m=b.create("button",I,this._container);return m.type="button",m.addEventListener("click",u),m}},s.Popup=class extends o.E{constructor(I){super(),this._updateOpacity=()=>{this.options.locationOccludedOpacity!==void 0&&(this._container.style.opacity=this._map.transform.isLocationOccluded(this.getLngLat())?`${this.options.locationOccludedOpacity}`:"")},this.remove=()=>(this._content&&b.remove(this._content),this._container&&(b.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),this._map._canvasContainer.classList.remove("maplibregl-track-pointer"),delete this._map,this.fire(new o.l("close"))),this),this._onMouseUp=u=>{this._update(u.point)},this._onMouseMove=u=>{this._update(u.point)},this._onDrag=u=>{this._update(u.point)},this._update=u=>{if(!this._map||!this._lngLat&&!this._trackPointer||!this._content)return;if(!this._container){if(this._container=b.create("div","maplibregl-popup",this._map.getContainer()),this._tip=b.create("div","maplibregl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className)for(const N of this.options.className.split(" "))this._container.classList.add(N);this._closeButton&&this._closeButton.setAttribute("aria-label",this._map._getUIString("Popup.Close")),this._trackPointer&&this._container.classList.add("maplibregl-popup-track-pointer")}if(this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._lngLat=Ai(this._lngLat,this._flatPos,this._map.transform,this._trackPointer),this._trackPointer&&!u)return;const m=this._flatPos=this._pos=this._trackPointer&&u?u:this._map.project(this._lngLat);this._map.terrain&&(this._flatPos=this._trackPointer&&u?u:this._map.transform.locationToScreenPoint(this._lngLat));let w=this.options.anchor;const M=Cd(this.options.offset);if(!w){const N=this._container.offsetWidth,H=this._container.offsetHeight;let j;j=m.y+M.bottom.y<H?["top"]:m.y>this._map.transform.height-H?["bottom"]:[],m.x<N/2?j.push("left"):m.x>this._map.transform.width-N/2&&j.push("right"),w=j.length===0?"bottom":j.join("-")}let R=m.add(M[w]);this.options.subpixelPositioning||(R=R.round()),b.setTransform(this._container,`${hn[w]} translate(${R.x}px,${R.y}px)`),eh(this._container,w,"popup"),this._updateOpacity()},this._onClose=()=>{this.remove()},this.options=o.e(Object.create(Td),I)}addTo(I){return this._map&&this.remove(),this._map=I,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")):this._map.on("move",this._update),this.fire(new o.l("open")),this}isOpen(){return!!this._map}getLngLat(){return this._lngLat}setLngLat(I){return this._lngLat=o.S.convert(I),this._pos=null,this._flatPos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.remove("maplibregl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._flatPos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")),this}getElement(){return this._container}setText(I){return this.setDOMContent(document.createTextNode(I))}setHTML(I){const u=document.createDocumentFragment(),m=document.createElement("body");let w;for(m.innerHTML=I;w=m.firstChild,w;)u.appendChild(w);return this.setDOMContent(u)}getMaxWidth(){var I;return(I=this._container)===null||I===void 0?void 0:I.style.maxWidth}setMaxWidth(I){return this.options.maxWidth=I,this._update(),this}setDOMContent(I){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=b.create("div","maplibregl-popup-content",this._container);return this._content.appendChild(I),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(I){return this._container&&this._container.classList.add(I),this}removeClassName(I){return this._container&&this._container.classList.remove(I),this}setOffset(I){return this.options.offset=I,this._update(),this}toggleClassName(I){if(this._container)return this._container.classList.toggle(I)}setSubpixelPositioning(I){this.options.subpixelPositioning=I}_createCloseButton(){this.options.closeButton&&(this._closeButton=b.create("button","maplibregl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const I=this._container.querySelector(Ad);I&&I.focus()}},s.RasterDEMTileSource=Zi,s.RasterTileSource=ii,s.ScaleControl=class{constructor(I){this._onMove=()=>{Bp(this._map,this._container,this.options)},this.setUnit=u=>{this.options.unit=u,Bp(this._map,this._container,this.options)},this.options=Object.assign(Object.assign({},Xu),I)}getDefaultPosition(){return"bottom-left"}onAdd(I){return this._map=I,this._container=b.create("div","maplibregl-ctrl maplibregl-ctrl-scale",I.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){b.remove(this._container),this._map.off("move",this._onMove),this._map=void 0}},s.ScrollZoomHandler=Av,s.Style=nv,s.TerrainControl=class{constructor(I){this._toggleTerrain=()=>{this._map.getTerrain()?this._map.setTerrain(null):this._map.setTerrain(this.options),this._updateTerrainIcon()},this._updateTerrainIcon=()=>{this._terrainButton.classList.remove("maplibregl-ctrl-terrain"),this._terrainButton.classList.remove("maplibregl-ctrl-terrain-enabled"),this._map.terrain?(this._terrainButton.classList.add("maplibregl-ctrl-terrain-enabled"),this._terrainButton.title=this._map._getUIString("TerrainControl.Disable")):(this._terrainButton.classList.add("maplibregl-ctrl-terrain"),this._terrainButton.title=this._map._getUIString("TerrainControl.Enable"))},this.options=I}onAdd(I){return this._map=I,this._container=b.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._terrainButton=b.create("button","maplibregl-ctrl-terrain",this._container),b.create("span","maplibregl-ctrl-icon",this._terrainButton).setAttribute("aria-hidden","true"),this._terrainButton.type="button",this._terrainButton.addEventListener("click",this._toggleTerrain),this._updateTerrainIcon(),this._map.on("terrain",this._updateTerrainIcon),this._container}onRemove(){b.remove(this._container),this._map.off("terrain",this._updateTerrainIcon),this._map=void 0}},s.TwoFingersTouchPitchHandler=Qh,s.TwoFingersTouchRotateHandler=_d,s.TwoFingersTouchZoomHandler=wl,s.TwoFingersTouchZoomRotateHandler=Wu,s.VectorTileSource=$r,s.VideoSource=Oa,s.addSourceType=(I,u)=>o._(void 0,void 0,void 0,(function*(){if(vo(I))throw new Error(`A source type called "${I}" already exists.`);((m,w)=>{Ls[m]=w})(I,u)})),s.clearPrewarmedResources=function(){const I=pt;I&&(I.isPreloaded()&&I.numActive()===1?(I.release(ct),pt=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},s.createTileMesh=Qf,s.getMaxParallelImageRequests=function(){return o.a.MAX_PARALLEL_IMAGE_REQUESTS},s.getRTLTextPluginStatus=function(){return Ll().getRTLTextPluginStatus()},s.getVersion=function(){return zp},s.getWorkerCount=function(){return xe.workerCount},s.getWorkerUrl=function(){return o.a.WORKER_URL},s.importScriptInWorkers=function(I){return _r().broadcast("IS",I)},s.prewarm=function(){Dt().acquire(ct)},s.setMaxParallelImageRequests=function(I){o.a.MAX_PARALLEL_IMAGE_REQUESTS=I},s.setRTLTextPlugin=function(I,u){return Ll().setRTLTextPlugin(I,u)},s.setWorkerCount=function(I){xe.workerCount=I},s.setWorkerUrl=function(I){o.a.WORKER_URL=I}}));var a=t;return a}))})(m2)),m2.exports}var VZ=FZ();const KS=gD(VZ);function Z2(r,e){if(!r)throw new Error(e||"loader assertion failed.")}const mD=!!(typeof process!="object"||String(process)!=="[object process]"||process.browser),WO=typeof process<"u"&&process.version&&/v([0-9]*)/.exec(process.version);WO&&parseFloat(WO[1]);const GO=globalThis,XO=globalThis.process||{},UZ=globalThis.navigator||{};function d8(r){if(typeof window<"u"&&window.process?.type==="renderer"||typeof process<"u"&&process.versions?.electron)return!0;const t=typeof navigator<"u"&&navigator.userAgent;return!!(t&&t.indexOf("Electron")>=0)}function Ty(){return!(typeof process=="object"&&String(process)==="[object process]"&&!process?.browser)||d8()}function HZ(r){return Ty()?d8()?"Electron":(UZ.userAgent||"").indexOf("Edge")>-1?"Edge":globalThis.chrome?"Chrome":globalThis.safari?"Safari":globalThis.mozInnerScreenX?"Firefox":"Unknown":"Node"}const p8="4.1.0";function jZ(r){try{const e=window[r],t="__storage_test__";return e.setItem(t,t),e.removeItem(t),e}catch{return null}}class $Z{constructor(e,t,i="sessionStorage"){this.storage=jZ(i),this.id=e,this.config=t,this._loadConfiguration()}getConfiguration(){return this.config}setConfiguration(e){if(Object.assign(this.config,e),this.storage){const t=JSON.stringify(this.config);this.storage.setItem(this.id,t)}}_loadConfiguration(){let e={};if(this.storage){const t=this.storage.getItem(this.id);e=t?JSON.parse(t):{}}return Object.assign(this.config,e),this}}function WZ(r){let e;return r<10?e=`${r.toFixed(2)}ms`:r<100?e=`${r.toFixed(1)}ms`:r<1e3?e=`${r.toFixed(0)}ms`:e=`${(r/1e3).toFixed(2)}s`,e}function GZ(r,e=8){const t=Math.max(e-r.length,0);return`${" ".repeat(t)}${r}`}var q2;(function(r){r[r.BLACK=30]="BLACK",r[r.RED=31]="RED",r[r.GREEN=32]="GREEN",r[r.YELLOW=33]="YELLOW",r[r.BLUE=34]="BLUE",r[r.MAGENTA=35]="MAGENTA",r[r.CYAN=36]="CYAN",r[r.WHITE=37]="WHITE",r[r.BRIGHT_BLACK=90]="BRIGHT_BLACK",r[r.BRIGHT_RED=91]="BRIGHT_RED",r[r.BRIGHT_GREEN=92]="BRIGHT_GREEN",r[r.BRIGHT_YELLOW=93]="BRIGHT_YELLOW",r[r.BRIGHT_BLUE=94]="BRIGHT_BLUE",r[r.BRIGHT_MAGENTA=95]="BRIGHT_MAGENTA",r[r.BRIGHT_CYAN=96]="BRIGHT_CYAN",r[r.BRIGHT_WHITE=97]="BRIGHT_WHITE"})(q2||(q2={}));const XZ=10;function ZO(r){return typeof r!="string"?r:(r=r.toUpperCase(),q2[r]||q2.WHITE)}function ZZ(r,e,t){return!Ty&&typeof r=="string"&&(e&&(r=`\x1B[${ZO(e)}m${r}\x1B[39m`),t&&(r=`\x1B[${ZO(t)+XZ}m${r}\x1B[49m`)),r}function qZ(r,e=["constructor"]){const t=Object.getPrototypeOf(r),i=Object.getOwnPropertyNames(t),n=r;for(const a of i){const s=n[a];typeof s=="function"&&(e.find(o=>a===o)||(n[a]=s.bind(r)))}}function yD(r,e){if(!r)throw new Error("Assertion failed")}function D_(){let r;if(Ty()&&GO.performance)r=GO?.performance?.now?.();else if("hrtime"in XO){const e=XO?.hrtime?.();r=e[0]*1e3+e[1]/1e6}else r=Date.now();return r}const k_={debug:Ty()&&console.debug||console.log,log:console.log,info:console.info,warn:console.warn,error:console.error},YZ={enabled:!0,level:0};function L_(){}const qO={},YO={once:!0};class Nw{constructor({id:e}={id:""}){this.VERSION=p8,this._startTs=D_(),this._deltaTs=D_(),this.userData={},this.LOG_THROTTLE_TIMEOUT=0,this.id=e,this.userData={},this._storage=new $Z(`__probe-${this.id}__`,YZ),this.timeStamp(`${this.id} started`),qZ(this),Object.seal(this)}set level(e){this.setLevel(e)}get level(){return this.getLevel()}isEnabled(){return this._storage.config.enabled}getLevel(){return this._storage.config.level}getTotal(){return Number((D_()-this._startTs).toPrecision(10))}getDelta(){return Number((D_()-this._deltaTs).toPrecision(10))}set priority(e){this.level=e}get priority(){return this.level}getPriority(){return this.level}enable(e=!0){return this._storage.setConfiguration({enabled:e}),this}setLevel(e){return this._storage.setConfiguration({level:e}),this}get(e){return this._storage.config[e]}set(e,t){this._storage.setConfiguration({[e]:t})}settings(){console.table?console.table(this._storage.config):console.log(this._storage.config)}assert(e,t){if(!e)throw new Error(t||"Assertion failed")}warn(e){return this._getLogFunction(0,e,k_.warn,arguments,YO)}error(e){return this._getLogFunction(0,e,k_.error,arguments)}deprecated(e,t){return this.warn(`\`${e}\` is deprecated and will be removed in a later version. Use \`${t}\` instead`)}removed(e,t){return this.error(`\`${e}\` has been removed. Use \`${t}\` instead`)}probe(e,t){return this._getLogFunction(e,t,k_.log,arguments,{time:!0,once:!0})}log(e,t){return this._getLogFunction(e,t,k_.debug,arguments)}info(e,t){return this._getLogFunction(e,t,console.info,arguments)}once(e,t){return this._getLogFunction(e,t,k_.debug||k_.info,arguments,YO)}table(e,t,i){return t?this._getLogFunction(e,t,console.table||L_,i&&[i],{tag:QZ(t)}):L_}time(e,t){return this._getLogFunction(e,t,console.time?console.time:console.info)}timeEnd(e,t){return this._getLogFunction(e,t,console.timeEnd?console.timeEnd:console.info)}timeStamp(e,t){return this._getLogFunction(e,t,console.timeStamp||L_)}group(e,t,i={collapsed:!1}){const n=KO({logLevel:e,message:t,opts:i}),{collapsed:a}=i;return n.method=(a?console.groupCollapsed:console.group)||console.info,this._getLogFunction(n)}groupCollapsed(e,t,i={}){return this.group(e,t,Object.assign({},i,{collapsed:!0}))}groupEnd(e){return this._getLogFunction(e,"",console.groupEnd||L_)}withGroup(e,t,i){this.group(e,t)();try{i()}finally{this.groupEnd(e)()}}trace(){console.trace&&console.trace()}_shouldLog(e){return this.isEnabled()&&this.getLevel()>=g8(e)}_getLogFunction(e,t,i,n,a){if(this._shouldLog(e)){a=KO({logLevel:e,message:t,args:n,opts:a}),i=i||a.method,yD(i),a.total=this.getTotal(),a.delta=this.getDelta(),this._deltaTs=D_();const s=a.tag||a.message;if(a.once&&s)if(!qO[s])qO[s]=D_();else return L_;return t=KZ(this.id,a.message,a),i.bind(console,t,...a.args)}return L_}}Nw.VERSION=p8;function g8(r){if(!r)return 0;let e;switch(typeof r){case"number":e=r;break;case"object":e=r.logLevel||r.priority||0;break;default:return 0}return yD(Number.isFinite(e)&&e>=0),e}function KO(r){const{logLevel:e,message:t}=r;r.logLevel=g8(e);const i=r.args?Array.from(r.args):[];for(;i.length&&i.shift()!==t;);switch(typeof e){case"string":case"function":t!==void 0&&i.unshift(t),r.message=e;break;case"object":Object.assign(r,e);break}typeof r.message=="function"&&(r.message=r.message());const n=typeof r.message;return yD(n==="string"||n==="object"),Object.assign(r,{args:i},r.opts)}function KZ(r,e,t){if(typeof e=="string"){const i=t.time?GZ(WZ(t.total)):"";e=t.time?`${r}: ${i}  ${e}`:`${r}: ${e}`,e=ZZ(e,t.color,t.background)}return e}function QZ(r){for(const e in r)for(const t in r[e])return t||"untitled";return"empty"}const LM="4.3.3",JZ=LM[0]>="0"&&LM[0]<="9"?`v${LM}`:"";function eq(){const r=new Nw({id:"loaders.gl"});return globalThis.loaders=globalThis.loaders||{},globalThis.loaders.log=r,globalThis.loaders.version=JZ,globalThis.probe=globalThis.probe||{},globalThis.probe.loaders=r,r}const tq=eq();function rq(r,e){return v8(r||{},e)}function v8(r,e,t=0){if(t>3)return e;const i={...r};for(const[n,a]of Object.entries(e))a&&typeof a=="object"&&!Array.isArray(a)?i[n]=v8(i[n]||{},e[n],t+1):i[n]=e[n];return i}const iq="latest";function nq(){return globalThis._loadersgl_?.version||(globalThis._loadersgl_=globalThis._loadersgl_||{},globalThis._loadersgl_.version="4.3.3"),globalThis._loadersgl_.version}const aq=nq();function Vg(r,e){if(!r)throw new Error(e||"loaders.gl assertion failed.")}const qm=typeof process!="object"||String(process)!=="[object process]"||process.browser,oq=typeof window<"u"&&typeof window.orientation<"u",QO=typeof process<"u"&&process.version&&/v([0-9]*)/.exec(process.version);QO&&parseFloat(QO[1]);class sq{name;workerThread;isRunning=!0;result;_resolve=()=>{};_reject=()=>{};constructor(e,t){this.name=e,this.workerThread=t,this.result=new Promise((i,n)=>{this._resolve=i,this._reject=n})}postMessage(e,t){this.workerThread.postMessage({source:"loaders.gl",type:e,payload:t})}done(e){Vg(this.isRunning),this.isRunning=!1,this._resolve(e)}error(e){Vg(this.isRunning),this.isRunning=!1,this._reject(e)}}class OM{terminate(){}}const NM=new Map;function lq(r){Vg(r.source&&!r.url||!r.source&&r.url);let e=NM.get(r.source||r.url);return e||(r.url&&(e=uq(r.url),NM.set(r.url,e)),r.source&&(e=m8(r.source),NM.set(r.source,e))),Vg(e),e}function uq(r){if(!r.startsWith("http"))return r;const e=cq(r);return m8(e)}function m8(r){const e=new Blob([r],{type:"application/javascript"});return URL.createObjectURL(e)}function cq(r){return`try {
  importScripts('${r}');
} catch (error) {
  console.error(error);
  throw error;
}`}function y8(r,e=!0,t){const i=t||new Set;if(r){if(JO(r))i.add(r);else if(JO(r.buffer))i.add(r.buffer);else if(!ArrayBuffer.isView(r)){if(e&&typeof r=="object")for(const n in r)y8(r[n],e,i)}}return t===void 0?Array.from(i):[]}function JO(r){return r?r instanceof ArrayBuffer||typeof MessagePort<"u"&&r instanceof MessagePort||typeof ImageBitmap<"u"&&r instanceof ImageBitmap||typeof OffscreenCanvas<"u"&&r instanceof OffscreenCanvas:!1}const BM=()=>{};class WP{name;source;url;terminated=!1;worker;onMessage;onError;_loadableURL="";static isSupported(){return typeof Worker<"u"&&qm||typeof OM<"u"&&!qm}constructor(e){const{name:t,source:i,url:n}=e;Vg(i||n),this.name=t,this.source=i,this.url=n,this.onMessage=BM,this.onError=a=>console.log(a),this.worker=qm?this._createBrowserWorker():this._createNodeWorker()}destroy(){this.onMessage=BM,this.onError=BM,this.worker.terminate(),this.terminated=!0}get isRunning(){return!!this.onMessage}postMessage(e,t){t=t||y8(e),this.worker.postMessage(e,t)}_getErrorFromErrorEvent(e){let t="Failed to load ";return t+=`worker ${this.name} from ${this.url}. `,e.message&&(t+=`${e.message} in `),e.lineno&&(t+=`:${e.lineno}:${e.colno}`),new Error(t)}_createBrowserWorker(){this._loadableURL=lq({source:this.source,url:this.url});const e=new Worker(this._loadableURL,{name:this.name});return e.onmessage=t=>{t.data?this.onMessage(t.data):this.onError(new Error("No data received"))},e.onerror=t=>{this.onError(this._getErrorFromErrorEvent(t)),this.terminated=!0},e.onmessageerror=t=>console.error(t),e}_createNodeWorker(){let e;if(this.url){const i=this.url.includes(":/")||this.url.startsWith("/")?this.url:`./${this.url}`;e=new OM(i,{eval:!1})}else if(this.source)e=new OM(this.source,{eval:!0});else throw new Error("no worker");return e.on("message",t=>{this.onMessage(t)}),e.on("error",t=>{this.onError(t)}),e.on("exit",t=>{}),e}}class hq{name="unnamed";source;url;maxConcurrency=1;maxMobileConcurrency=1;onDebug=()=>{};reuseWorkers=!0;props={};jobQueue=[];idleQueue=[];count=0;isDestroyed=!1;static isSupported(){return WP.isSupported()}constructor(e){this.source=e.source,this.url=e.url,this.setProps(e)}destroy(){this.idleQueue.forEach(e=>e.destroy()),this.isDestroyed=!0}setProps(e){this.props={...this.props,...e},e.name!==void 0&&(this.name=e.name),e.maxConcurrency!==void 0&&(this.maxConcurrency=e.maxConcurrency),e.maxMobileConcurrency!==void 0&&(this.maxMobileConcurrency=e.maxMobileConcurrency),e.reuseWorkers!==void 0&&(this.reuseWorkers=e.reuseWorkers),e.onDebug!==void 0&&(this.onDebug=e.onDebug)}async startJob(e,t=(n,a,s)=>n.done(s),i=(n,a)=>n.error(a)){const n=new Promise(a=>(this.jobQueue.push({name:e,onMessage:t,onError:i,onStart:a}),this));return this._startQueuedJob(),await n}async _startQueuedJob(){if(!this.jobQueue.length)return;const e=this._getAvailableWorker();if(!e)return;const t=this.jobQueue.shift();if(t){this.onDebug({message:"Starting job",name:t.name,workerThread:e,backlog:this.jobQueue.length});const i=new sq(t.name,e);e.onMessage=n=>t.onMessage(i,n.type,n.payload),e.onError=n=>t.onError(i,n),t.onStart(i);try{await i.result}catch(n){console.error(`Worker exception: ${n}`)}finally{this.returnWorkerToQueue(e)}}}returnWorkerToQueue(e){!qm||this.isDestroyed||!this.reuseWorkers||this.count>this._getMaxConcurrency()?(e.destroy(),this.count--):this.idleQueue.push(e),this.isDestroyed||this._startQueuedJob()}_getAvailableWorker(){if(this.idleQueue.length>0)return this.idleQueue.shift()||null;if(this.count<this._getMaxConcurrency()){this.count++;const e=`${this.name.toLowerCase()} (#${this.count} of ${this.maxConcurrency})`;return new WP({name:e,source:this.source,url:this.url})}return null}_getMaxConcurrency(){return oq?this.maxMobileConcurrency:this.maxConcurrency}}const fq={maxConcurrency:3,maxMobileConcurrency:1,reuseWorkers:!0,onDebug:()=>{}};class xg{props;workerPools=new Map;static _workerFarm;static isSupported(){return WP.isSupported()}static getWorkerFarm(e={}){return xg._workerFarm=xg._workerFarm||new xg({}),xg._workerFarm.setProps(e),xg._workerFarm}constructor(e){this.props={...fq},this.setProps(e),this.workerPools=new Map}destroy(){for(const e of this.workerPools.values())e.destroy();this.workerPools=new Map}setProps(e){this.props={...this.props,...e};for(const t of this.workerPools.values())t.setProps(this._getWorkerPoolProps())}getWorkerPool(e){const{name:t,source:i,url:n}=e;let a=this.workerPools.get(t);return a||(a=new hq({name:t,source:i,url:n}),a.setProps(this._getWorkerPoolProps()),this.workerPools.set(t,a)),a}_getWorkerPoolProps(){return{maxConcurrency:this.props.maxConcurrency,maxMobileConcurrency:this.props.maxMobileConcurrency,reuseWorkers:this.props.reuseWorkers,onDebug:this.props.onDebug}}}function dq(r,e={}){const t=e[r.id]||{},i=qm?`${r.id}-worker.js`:`${r.id}-worker-node.js`;let n=t.workerUrl;if(!n&&r.id==="compression"&&(n=e.workerUrl),e._workerType==="test"&&(qm?n=`modules/${r.module}/dist/${i}`:n=`modules/${r.module}/src/workers/${r.id}-worker-node.ts`),!n){let a=r.version;a==="latest"&&(a=iq);const s=a?`@${a}`:"";n=`https://unpkg.com/@loaders.gl/${r.module}${s}/dist/${i}`}return Vg(n),n}function pq(r,e=aq){Vg(r,"no worker provided");const t=r.version;return!(!e||!t)}function gq(r,e){return!xg.isSupported()||!qm&&!e?._nodeWorkers?!1:r.worker&&e?.worker}async function vq(r,e,t,i,n){const a=r.id,s=dq(r,t),l=xg.getWorkerFarm(t).getWorkerPool({name:a,url:s});t=JSON.parse(JSON.stringify(t)),i=JSON.parse(JSON.stringify(i||{}));const c=await l.startJob("process-on-worker",mq.bind(null,n));return c.postMessage("process",{input:e,options:t,context:i}),await(await c.result).result}async function mq(r,e,t,i){switch(t){case"done":e.done(i);break;case"error":e.error(new Error(i.error));break;case"process":const{id:n,input:a,options:s}=i;try{const o=await r(a,s);e.postMessage("done",{id:n,result:o})}catch(o){const l=o instanceof Error?o.message:"unknown error";e.postMessage("error",{id:n,error:l})}break;default:console.warn(`parse-with-worker unknown message ${t}`)}}function yq(r,e,t){if(t=t||r.byteLength,r.byteLength<t||e.byteLength<t)return!1;const i=new Uint8Array(r),n=new Uint8Array(e);for(let a=0;a<i.length;++a)if(i[a]!==n[a])return!1;return!0}function _q(...r){return bq(r)}function bq(r){const e=r.map(a=>a instanceof ArrayBuffer?new Uint8Array(a):a),t=e.reduce((a,s)=>a+s.byteLength,0),i=new Uint8Array(t);let n=0;for(const a of e)i.set(a,n),n+=a.byteLength;return i.buffer}async function xq(r){const e=[];for await(const t of r)e.push(t);return _q(...e)}function eN(){let r;if(typeof window<"u"&&window.performance)r=window.performance.now();else if(typeof process<"u"&&process.hrtime){const e=process.hrtime();r=e[0]*1e3+e[1]/1e6}else r=Date.now();return r}class tN{constructor(e,t){this.sampleSize=1,this.time=0,this.count=0,this.samples=0,this.lastTiming=0,this.lastSampleTime=0,this.lastSampleCount=0,this._count=0,this._time=0,this._samples=0,this._startTime=0,this._timerPending=!1,this.name=e,this.type=t,this.reset()}reset(){return this.time=0,this.count=0,this.samples=0,this.lastTiming=0,this.lastSampleTime=0,this.lastSampleCount=0,this._count=0,this._time=0,this._samples=0,this._startTime=0,this._timerPending=!1,this}setSampleSize(e){return this.sampleSize=e,this}incrementCount(){return this.addCount(1),this}decrementCount(){return this.subtractCount(1),this}addCount(e){return this._count+=e,this._samples++,this._checkSampling(),this}subtractCount(e){return this._count-=e,this._samples++,this._checkSampling(),this}addTime(e){return this._time+=e,this.lastTiming=e,this._samples++,this._checkSampling(),this}timeStart(){return this._startTime=eN(),this._timerPending=!0,this}timeEnd(){return this._timerPending?(this.addTime(eN()-this._startTime),this._timerPending=!1,this._checkSampling(),this):this}getSampleAverageCount(){return this.sampleSize>0?this.lastSampleCount/this.sampleSize:0}getSampleAverageTime(){return this.sampleSize>0?this.lastSampleTime/this.sampleSize:0}getSampleHz(){return this.lastSampleTime>0?this.sampleSize/(this.lastSampleTime/1e3):0}getAverageCount(){return this.samples>0?this.count/this.samples:0}getAverageTime(){return this.samples>0?this.time/this.samples:0}getHz(){return this.time>0?this.samples/(this.time/1e3):0}_checkSampling(){this._samples===this.sampleSize&&(this.lastSampleTime=this._time,this.lastSampleCount=this._count,this.count+=this._count,this.time+=this._time,this.samples+=this._samples,this._time=0,this._count=0,this._samples=0)}}class fC{constructor(e){this.stats={},this.id=e.id,this.stats={},this._initializeStats(e.stats),Object.seal(this)}get(e,t="count"){return this._getOrCreate({name:e,type:t})}get size(){return Object.keys(this.stats).length}reset(){for(const e of Object.values(this.stats))e.reset();return this}forEach(e){for(const t of Object.values(this.stats))e(t)}getTable(){const e={};return this.forEach(t=>{e[t.name]={time:t.time||0,count:t.count||0,average:t.getAverageTime()||0,hz:t.getHz()||0}}),e}_initializeStats(e=[]){e.forEach(t=>this._getOrCreate(t))}_getOrCreate(e){const{name:t,type:i}=e;let n=this.stats[t];return n||(e instanceof tN?n=e:n=new tN(t,i),this.stats[t]=n),n}}let wq="";const rN={};function Sq(r){for(const e in rN)if(r.startsWith(e)){const t=rN[e];r=r.replace(e,t)}return!r.startsWith("http://")&&!r.startsWith("https://")&&(r=`${wq}${r}`),r}function Tq(r){return r&&typeof r=="object"&&r.isBuffer}function _8(r){if(Tq(r))return r;if(r instanceof ArrayBuffer)return r;if(ArrayBuffer.isView(r))return r.byteOffset===0&&r.byteLength===r.buffer.byteLength?r.buffer:r.buffer.slice(r.byteOffset,r.byteOffset+r.byteLength);if(typeof r=="string"){const e=r;return new TextEncoder().encode(e).buffer}if(r&&typeof r=="object"&&r._toArrayBuffer)return r._toArrayBuffer();throw new Error("toArrayBuffer")}function b8(r){const e=r?r.lastIndexOf("/"):-1;return e>=0?r.substr(e+1):""}function Aq(r){const e=r?r.lastIndexOf("/"):-1;return e>=0?r.substr(0,e):""}const Cq=r=>typeof r=="boolean",C1=r=>typeof r=="function",Bw=r=>r!==null&&typeof r=="object",iN=r=>Bw(r)&&r.constructor==={}.constructor,Mq=r=>!!r&&typeof r[Symbol.iterator]=="function",Eq=r=>r&&typeof r[Symbol.asyncIterator]=="function",Ay=r=>typeof Response<"u"&&r instanceof Response||r&&r.arrayBuffer&&r.text&&r.json,Cy=r=>typeof Blob<"u"&&r instanceof Blob,Iq=r=>r&&typeof r=="object"&&r.isBuffer,Pq=r=>typeof ReadableStream<"u"&&r instanceof ReadableStream||Bw(r)&&C1(r.tee)&&C1(r.cancel)&&C1(r.getReader),Rq=r=>Bw(r)&&C1(r.read)&&C1(r.pipe)&&Cq(r.readable),x8=r=>Pq(r)||Rq(r);class Dq extends Error{constructor(e,t){super(e),this.reason=t.reason,this.url=t.url,this.response=t.response}reason;url;response}const kq=/^data:([-\w.]+\/[-\w.+]+)(;|,)/,Lq=/^([-\w.]+\/[-\w.+]+)/;function nN(r,e){return r.toLowerCase()===e.toLowerCase()}function Oq(r){const e=Lq.exec(r);return e?e[1]:r}function aN(r){const e=kq.exec(r);return e?e[1]:""}const w8=/\?.*/;function Nq(r){const e=r.match(w8);return e&&e[0]}function _D(r){return r.replace(w8,"")}function Bq(r){if(r.length<50)return r;const e=r.slice(r.length-15);return`${r.substr(0,32)}...${e}`}function dC(r){return Ay(r)?r.url:Cy(r)?r.name||"":typeof r=="string"?r:""}function bD(r){if(Ay(r)){const e=r,t=e.headers.get("content-type")||"",i=_D(e.url);return Oq(t)||aN(i)}return Cy(r)?r.type||"":typeof r=="string"?aN(r):""}function zq(r){return Ay(r)?r.headers["content-length"]||-1:Cy(r)?r.size:typeof r=="string"?r.length:r instanceof ArrayBuffer||ArrayBuffer.isView(r)?r.byteLength:-1}async function S8(r){if(Ay(r))return r;const e={},t=zq(r);t>=0&&(e["content-length"]=String(t));const i=dC(r),n=bD(r);n&&(e["content-type"]=n);const a=await Uq(r);a&&(e["x-first-bytes"]=a),typeof r=="string"&&(r=new TextEncoder().encode(r));const s=new Response(r,{headers:e});return Object.defineProperty(s,"url",{value:i}),s}async function Fq(r){if(!r.ok)throw await Vq(r)}async function Vq(r){const e=Bq(r.url);let t=`Failed to fetch resource (${r.status}) ${r.statusText}: ${e}`;t=t.length>100?`${t.slice(0,100)}...`:t;const i={reason:r.statusText,url:r.url,response:r};try{const n=r.headers.get("Content-Type");i.reason=!r.bodyUsed&&n?.includes("application/json")?await r.json():await r.text()}catch{}return new Dq(t,i)}async function Uq(r){if(typeof r=="string")return`data:,${r.slice(0,5)}`;if(r instanceof Blob){const t=r.slice(0,5);return await new Promise(i=>{const n=new FileReader;n.onload=a=>i(a?.target?.result),n.readAsDataURL(t)})}if(r instanceof ArrayBuffer){const t=r.slice(0,5);return`data:base64,${Hq(t)}`}return null}function Hq(r){let e="";const t=new Uint8Array(r);for(let i=0;i<t.byteLength;i++)e+=String.fromCharCode(t[i]);return btoa(e)}function jq(r){return!$q(r)&&!Wq(r)}function $q(r){return r.startsWith("http:")||r.startsWith("https:")}function Wq(r){return r.startsWith("data:")}async function oN(r,e){if(typeof r=="string"){const t=Sq(r);return jq(t)&&globalThis.loaders?.fetchNode?globalThis.loaders?.fetchNode(t,e):await fetch(t,e)}return await S8(r)}const sN=new Nw({id:"loaders.gl"});class Gq{log(){return()=>{}}info(){return()=>{}}warn(){return()=>{}}error(){return()=>{}}}class Xq{console;constructor(){this.console=console}log(...e){return this.console.log.bind(this.console,...e)}info(...e){return this.console.info.bind(this.console,...e)}warn(...e){return this.console.warn.bind(this.console,...e)}error(...e){return this.console.error.bind(this.console,...e)}}const T8={fetch:null,mimeType:void 0,nothrow:!1,log:new Xq,useLocalLibraries:!1,CDN:"https://unpkg.com/@loaders.gl",worker:!0,maxConcurrency:3,maxMobileConcurrency:1,reuseWorkers:mD,_nodeWorkers:!1,_workerType:"",limit:0,_limitMB:0,batchSize:"auto",batchDebounceMs:0,metadata:!1,transforms:[]},Zq={throws:"nothrow",dataType:"(no longer used)",uri:"baseUri",method:"fetch.method",headers:"fetch.headers",body:"fetch.body",mode:"fetch.mode",credentials:"fetch.credentials",cache:"fetch.cache",redirect:"fetch.redirect",referrer:"fetch.referrer",referrerPolicy:"fetch.referrerPolicy",integrity:"fetch.integrity",keepalive:"fetch.keepalive",signal:"fetch.signal"};function A8(){globalThis.loaders=globalThis.loaders||{};const{loaders:r}=globalThis;return r._state||(r._state={}),r._state}function C8(){const r=A8();return r.globalOptions=r.globalOptions||{...T8},r.globalOptions}function qq(r,e,t,i){return t=t||[],t=Array.isArray(t)?t:[t],Yq(r,t),Qq(e,r,i)}function Yq(r,e){lN(r,null,T8,Zq,e);for(const t of e){const i=r&&r[t.id]||{},n=t.options&&t.options[t.id]||{},a=t.deprecatedOptions&&t.deprecatedOptions[t.id]||{};lN(i,t.id,n,a,e)}}function lN(r,e,t,i,n){const a=e||"Top level",s=e?`${e}.`:"";for(const o in r){const l=!e&&Bw(r[o]),c=o==="baseUri"&&!e,f=o==="workerUrl"&&e;if(!(o in t)&&!c&&!f){if(o in i)sN.warn(`${a} loader option '${s}${o}' no longer supported, use '${i[o]}'`)();else if(!l){const p=Kq(o,n);sN.warn(`${a} loader option '${s}${o}' not recognized. ${p}`)()}}}}function Kq(r,e){const t=r.toLowerCase();let i="";for(const n of e)for(const a in n.options){if(r===a)return`Did you mean '${n.id}.${a}'?`;const s=a.toLowerCase();(t.startsWith(s)||s.startsWith(t))&&(i=i||`Did you mean '${n.id}.${a}'?`)}return i}function Qq(r,e,t){const n={...r.options||{}};return Jq(n,t),n.log===null&&(n.log=new Gq),uN(n,C8()),uN(n,e),n}function uN(r,e){for(const t in e)if(t in e){const i=e[t];iN(i)&&iN(r[t])?r[t]={...r[t],...e[t]}:r[t]=e[t]}}function Jq(r,e){e&&!("baseUri"in r)&&(r.baseUri=e)}function xD(r){return r?(Array.isArray(r)&&(r=r[0]),Array.isArray(r?.extensions)):!1}function wD(r){Z2(r,"null loader"),Z2(xD(r),"invalid loader");let e;return Array.isArray(r)&&(e=r[1],r=r[0],r={...r,options:{...r.options,...e}}),(r?.parseTextSync||r?.parseText)&&(r.text=!0),r.text||(r.binary=!0),r}const M8=()=>{const r=A8();return r.loaderRegistry=r.loaderRegistry||[],r.loaderRegistry};function eY(r){const e=M8();r=Array.isArray(r)?r:[r];for(const t of r){const i=wD(t);e.find(n=>i===n)||e.unshift(i)}}function tY(){return M8()}const rY=/\.([^.]+)$/;async function iY(r,e=[],t,i){if(!E8(r))return null;let n=cN(r,e,{...t,nothrow:!0},i);if(n)return n;if(Cy(r)&&(r=await r.slice(0,10).arrayBuffer(),n=cN(r,e,t,i)),!n&&!t?.nothrow)throw new Error(I8(r));return n}function cN(r,e=[],t,i){if(!E8(r))return null;if(e&&!Array.isArray(e))return wD(e);let n=[];e&&(n=n.concat(e)),t?.ignoreRegisteredLoaders||n.push(...tY()),aY(n);const a=nY(r,n,t,i);if(!a&&!t?.nothrow)throw new Error(I8(r));return a}function nY(r,e,t,i){const n=dC(r),a=bD(r),s=_D(n)||i?.url;let o=null,l="";return t?.mimeType&&(o=zM(e,t?.mimeType),l=`match forced by supplied MIME type ${t?.mimeType}`),o=o||oY(e,s),l=l||(o?`matched url ${s}`:""),o=o||zM(e,a),l=l||(o?`matched MIME type ${a}`:""),o=o||lY(e,r),l=l||(o?`matched initial data ${P8(r)}`:""),t?.fallbackMimeType&&(o=o||zM(e,t?.fallbackMimeType),l=l||(o?`matched fallback MIME type ${a}`:"")),l&&tq.log(1,`selectLoader selected ${o?.name}: ${l}.`),o}function E8(r){return!(r instanceof Response&&r.status===204)}function I8(r){const e=dC(r),t=bD(r);let i="No valid loader found (";i+=e?`${b8(e)}, `:"no url provided, ",i+=`MIME type: ${t?`"${t}"`:"not provided"}, `;const n=r?P8(r):"";return i+=n?` first bytes: "${n}"`:"first bytes: not available",i+=")",i}function aY(r){for(const e of r)wD(e)}function oY(r,e){const t=e&&rY.exec(e),i=t&&t[1];return i?sY(r,i):null}function sY(r,e){e=e.toLowerCase();for(const t of r)for(const i of t.extensions)if(i.toLowerCase()===e)return t;return null}function zM(r,e){for(const t of r)if(t.mimeTypes?.some(i=>nN(e,i))||nN(e,`application/x.${t.id}`))return t;return null}function lY(r,e){if(!e)return null;for(const t of r)if(typeof e=="string"){if(uY(e,t))return t}else if(ArrayBuffer.isView(e)){if(hN(e.buffer,e.byteOffset,t))return t}else if(e instanceof ArrayBuffer&&hN(e,0,t))return t;return null}function uY(r,e){return e.testText?e.testText(r):(Array.isArray(e.tests)?e.tests:[e.tests]).some(i=>r.startsWith(i))}function hN(r,e,t){return(Array.isArray(t.tests)?t.tests:[t.tests]).some(n=>cY(r,e,t,n))}function cY(r,e,t,i){if(i instanceof ArrayBuffer)return yq(i,r,i.byteLength);switch(typeof i){case"function":return i(r);case"string":const n=GP(r,e,i.length);return i===n;default:return!1}}function P8(r,e=5){return typeof r=="string"?r.slice(0,e):ArrayBuffer.isView(r)?GP(r.buffer,r.byteOffset,e):r instanceof ArrayBuffer?GP(r,0,e):""}function GP(r,e,t){if(r.byteLength<e+t)return"";const i=new DataView(r);let n="";for(let a=0;a<t;a++)n+=String.fromCharCode(i.getUint8(e+a));return n}const hY=256*1024;function*fY(r,e){const t=e?.chunkSize||hY;let i=0;const n=new TextEncoder;for(;i<r.length;){const a=Math.min(r.length-i,t),s=r.slice(i,i+a);i+=a,yield n.encode(s)}}const dY=256*1024;function*pY(r,e={}){const{chunkSize:t=dY}=e;let i=0;for(;i<r.byteLength;){const n=Math.min(r.byteLength-i,t),a=new ArrayBuffer(n),s=new Uint8Array(r,i,n);new Uint8Array(a).set(s),i+=n,yield a}}const gY=1024*1024;async function*vY(r,e){const t=e?.chunkSize||gY;let i=0;for(;i<r.size;){const n=i+t,a=await r.slice(i,n).arrayBuffer();i=n,yield a}}function fN(r,e){return mD?mY(r,e):yY(r)}async function*mY(r,e){const t=r.getReader();let i;try{for(;;){const n=i||t.read();e?._streamReadAhead&&(i=t.read());const{done:a,value:s}=await n;if(a)return;yield _8(s)}}catch{t.releaseLock()}}async function*yY(r,e){for await(const t of r)yield _8(t)}function _Y(r,e){if(typeof r=="string")return fY(r,e);if(r instanceof ArrayBuffer)return pY(r,e);if(Cy(r))return vY(r,e);if(x8(r))return fN(r,e);if(Ay(r))return fN(r.body,e);throw new Error("makeIterator")}const R8="Cannot convert supplied data type";function bY(r,e,t){if(e.text&&typeof r=="string")return r;if(Iq(r)&&(r=r.buffer),r instanceof ArrayBuffer){const i=r;return e.text&&!e.binary?new TextDecoder("utf8").decode(i):i}if(ArrayBuffer.isView(r)){if(e.text&&!e.binary)return new TextDecoder("utf8").decode(r);let i=r.buffer;const n=r.byteLength||r.length;return(r.byteOffset!==0||n!==i.byteLength)&&(i=i.slice(r.byteOffset,r.byteOffset+n)),i}throw new Error(R8)}async function xY(r,e,t){const i=r instanceof ArrayBuffer||ArrayBuffer.isView(r);if(typeof r=="string"||i)return bY(r,e);if(Cy(r)&&(r=await S8(r)),Ay(r)){const n=r;return await Fq(n),e.binary?await n.arrayBuffer():await n.text()}if(x8(r)&&(r=_Y(r,t)),Mq(r)||Eq(r))return xq(r);throw new Error(R8)}function D8(r,e){const t=C8(),i=r||t;return typeof i.fetch=="function"?i.fetch:Bw(i.fetch)?n=>oN(n,i.fetch):e?.fetch?e?.fetch:oN}function wY(r,e,t){if(t)return t;const i={fetch:D8(e,r),...r};if(i.url){const n=_D(i.url);i.baseUrl=n,i.queryString=Nq(i.url),i.filename=b8(n),i.baseUrl=Aq(n)}return Array.isArray(i.loaders)||(i.loaders=null),i}function SY(r,e){if(r&&!Array.isArray(r))return r;let t;if(r&&(t=Array.isArray(r)?r:[r]),e&&e.loaders){const i=Array.isArray(e.loaders)?e.loaders:[e.loaders];t=t?[...t,...i]:i}return t&&t.length?t:void 0}async function Y2(r,e,t,i){e&&!Array.isArray(e)&&!xD(e)&&(i=void 0,t=e,e=void 0),r=await r,t=t||{};const n=dC(r),s=SY(e,i),o=await iY(r,s,t);return o?(t=qq(t,o,s,n),i=wY({url:n,_parse:Y2,loaders:s},t,i||null),await TY(o,r,t,i)):null}async function TY(r,e,t,i){if(pq(r),t=rq(r.options,t),Ay(e)){const a=e,{ok:s,redirected:o,status:l,statusText:c,type:f,url:p}=a,y=Object.fromEntries(a.headers.entries());i.response={headers:y,ok:s,redirected:o,status:l,statusText:c,type:f,url:p}}e=await xY(e,r,t);const n=r;if(n.parseTextSync&&typeof e=="string")return n.parseTextSync(e,t,i);if(gq(r,t))return await vq(r,e,t,i,Y2);if(n.parseText&&typeof e=="string")return await n.parseText(e,t,i);if(n.parse)return await n.parse(e,t,i);throw Vg(!n.parseSync),new Error(`${r.id} loader - no parser found and worker is disabled`)}async function XP(r,e,t,i){let n,a;!Array.isArray(e)&&!xD(e)?(n=[],a=e):(n=e,a=t);const s=D8(a);let o=r;return typeof r=="string"&&(o=await s(r)),Cy(r)&&(o=await s(r)),Array.isArray(n)?await Y2(o,n,a):await Y2(o,n,a)}const AY="4.3.3",CY=globalThis.loaders?.parseImageNode,ZP=typeof Image<"u",qP=typeof ImageBitmap<"u",MY=!!CY,YP=mD?!0:MY;function EY(r){switch(r){case"auto":return qP||ZP||YP;case"imagebitmap":return qP;case"image":return ZP;case"data":return YP;default:throw new Error(`@loaders.gl/images: image ${r} not supported in this environment`)}}function IY(){if(qP)return"imagebitmap";if(ZP)return"image";if(YP)return"data";throw new Error("Install '@loaders.gl/polyfills' to parse images under Node.js")}function PY(r){const e=DY(r);if(!e)throw new Error("Not an image");return e}function RY(r){switch(PY(r)){case"data":return r;case"image":case"imagebitmap":const e=document.createElement("canvas"),t=e.getContext("2d");if(!t)throw new Error("getImageData");return e.width=r.width,e.height=r.height,t.drawImage(r,0,0),t.getImageData(0,0,r.width,r.height);default:throw new Error("getImageData")}}function DY(r){return typeof ImageBitmap<"u"&&r instanceof ImageBitmap?"imagebitmap":typeof Image<"u"&&r instanceof Image?"image":r&&typeof r=="object"&&r.data&&r.width&&r.height?"data":null}const kY=/^data:image\/svg\+xml/,LY=/\.svg((\?|#).*)?$/;function SD(r){return r&&(kY.test(r)||LY.test(r))}function OY(r,e){if(SD(e)){let i=new TextDecoder().decode(r);try{typeof unescape=="function"&&typeof encodeURIComponent=="function"&&(i=unescape(encodeURIComponent(i)))}catch(a){throw new Error(a.message)}return`data:image/svg+xml;base64,${btoa(i)}`}return k8(r,e)}function k8(r,e){if(SD(e))throw new Error("SVG cannot be parsed directly to imagebitmap");return new Blob([new Uint8Array(r)])}async function L8(r,e,t){const i=OY(r,t),n=self.URL||self.webkitURL,a=typeof i!="string"&&n.createObjectURL(i);try{return await NY(a||i,e)}finally{a&&n.revokeObjectURL(a)}}async function NY(r,e){const t=new Image;return t.src=r,e.image&&e.image.decode&&t.decode?(await t.decode(),t):await new Promise((i,n)=>{try{t.onload=()=>i(t),t.onerror=a=>{const s=a instanceof Error?a.message:"error";n(new Error(s))}}catch(a){n(a)}})}const BY={};let dN=!0;async function zY(r,e,t){let i;SD(t)?i=await L8(r,e,t):i=k8(r,t);const n=e&&e.imagebitmap;return await FY(i,n)}async function FY(r,e=null){if((VY(e)||!dN)&&(e=null),e)try{return await createImageBitmap(r,e)}catch(t){console.warn(t),dN=!1}return await createImageBitmap(r)}function VY(r){for(const e in r||BY)return!1;return!0}function UY(r){return!WY(r,"ftyp",4)||(r[8]&96)===0?null:HY(r)}function HY(r){switch(jY(r,8,12).replace("\0"," ").trim()){case"avif":case"avis":return{extension:"avif",mimeType:"image/avif"};default:return null}}function jY(r,e,t){return String.fromCharCode(...r.slice(e,t))}function $Y(r){return[...r].map(e=>e.charCodeAt(0))}function WY(r,e,t=0){const i=$Y(e);for(let n=0;n<i.length;++n)if(i[n]!==r[n+t])return!1;return!0}const If=!1,M1=!0;function O8(r){const e=zw(r);return XY(e)||YY(e)||ZY(e)||qY(e)||GY(e)}function GY(r){const e=new Uint8Array(r instanceof DataView?r.buffer:r),t=UY(e);return t?{mimeType:t.mimeType,width:0,height:0}:null}function XY(r){const e=zw(r);return e.byteLength>=24&&e.getUint32(0,If)===2303741511?{mimeType:"image/png",width:e.getUint32(16,If),height:e.getUint32(20,If)}:null}function ZY(r){const e=zw(r);return e.byteLength>=10&&e.getUint32(0,If)===1195984440?{mimeType:"image/gif",width:e.getUint16(6,M1),height:e.getUint16(8,M1)}:null}function qY(r){const e=zw(r);return e.byteLength>=14&&e.getUint16(0,If)===16973&&e.getUint32(2,M1)===e.byteLength?{mimeType:"image/bmp",width:e.getUint32(18,M1),height:e.getUint32(22,M1)}:null}function YY(r){const e=zw(r);if(!(e.byteLength>=3&&e.getUint16(0,If)===65496&&e.getUint8(2)===255))return null;const{tableMarkers:i,sofMarkers:n}=KY();let a=2;for(;a+9<e.byteLength;){const s=e.getUint16(a,If);if(n.has(s))return{mimeType:"image/jpeg",height:e.getUint16(a+5,If),width:e.getUint16(a+7,If)};if(!i.has(s))return null;a+=2,a+=e.getUint16(a,If)}return null}function KY(){const r=new Set([65499,65476,65484,65501,65534]);for(let t=65504;t<65520;++t)r.add(t);return{tableMarkers:r,sofMarkers:new Set([65472,65473,65474,65475,65477,65478,65479,65481,65482,65483,65485,65486,65487,65502])}}function zw(r){if(r instanceof DataView)return r;if(ArrayBuffer.isView(r))return new DataView(r.buffer);if(r instanceof ArrayBuffer)return new DataView(r);throw new Error("toDataView")}async function QY(r,e){const{mimeType:t}=O8(r)||{},i=globalThis.loaders?.parseImageNode;return Z2(i),await i(r,t)}async function JY(r,e,t){e=e||{};const n=(e.image||{}).type||"auto",{url:a}=t||{},s=eK(n);let o;switch(s){case"imagebitmap":o=await zY(r,e,a);break;case"image":o=await L8(r,e,a);break;case"data":o=await QY(r);break;default:Z2(!1)}return n==="data"&&(o=RY(o)),o}function eK(r){switch(r){case"auto":case"data":return IY();default:return EY(r),r}}const tK=["png","jpg","jpeg","gif","webp","bmp","ico","svg","avif"],rK=["image/png","image/jpeg","image/gif","image/webp","image/avif","image/bmp","image/vnd.microsoft.icon","image/svg+xml"],iK={image:{type:"auto",decode:!0}},nK={dataType:null,batchType:null,id:"image",module:"images",name:"Images",version:AY,mimeTypes:rK,extensions:tK,parse:JY,tests:[r=>!!O8(new DataView(r))],options:iK},Tn=new Nw({id:"deck"});let KP={};function aK(r){KP=r}function nl(r,e,t,i){Tn.level>0&&KP[r]&&KP[r].call(null,e,t,i)}function oK(r){const e=r[0],t=r[r.length-1];return e==="{"&&t==="}"||e==="["&&t==="]"}const sK={dataType:null,batchType:null,id:"JSON",name:"JSON",module:"",version:"",options:{},extensions:["json","geojson"],mimeTypes:["application/json","application/geo+json"],testText:oK,parseTextSync:JSON.parse};function lK(){const r="9.2.2",e=globalThis.deck&&globalThis.deck.VERSION;if(e&&e!==r)throw new Error(`deck.gl - multiple versions detected: ${e} vs ${r}`);return e||(Tn.log(1,`deck.gl ${r}`)(),globalThis.deck={...globalThis.deck,VERSION:r,version:r,log:Tn,_registerLoggers:aK},eY([sK,[nK,{imagebitmap:{premultiplyAlpha:"none"}}]])),r}const uK=lK();function TD(r,e){if(!r)throw new Error(e||"shadertools: assertion failed.")}const FM={number:{type:"number",validate(r,e){return Number.isFinite(r)&&typeof e=="object"&&(e.max===void 0||r<=e.max)&&(e.min===void 0||r>=e.min)}},array:{type:"array",validate(r,e){return Array.isArray(r)||ArrayBuffer.isView(r)}}};function cK(r){const e={};for(const[t,i]of Object.entries(r))e[t]=hK(i);return e}function hK(r){let e=pN(r);if(e!=="object")return{value:r,...FM[e],type:e};if(typeof r=="object")return r?r.type!==void 0?{...r,...FM[r.type],type:r.type}:r.value===void 0?{type:"object",value:r}:(e=pN(r.value),{...r,...FM[e],type:e}):{type:"object",value:null};throw new Error("props")}function pN(r){return Array.isArray(r)||ArrayBuffer.isView(r)?"array":typeof r}const fK=`#ifdef MODULE_LOGDEPTH
  logdepth_adjustPosition(gl_Position);
#endif
`,dK=`#ifdef MODULE_MATERIAL
  fragColor = material_filterColor(fragColor);
#endif

#ifdef MODULE_LIGHTING
  fragColor = lighting_filterColor(fragColor);
#endif

#ifdef MODULE_FOG
  fragColor = fog_filterColor(fragColor);
#endif

#ifdef MODULE_PICKING
  fragColor = picking_filterHighlightColor(fragColor);
  fragColor = picking_filterPickingColor(fragColor);
#endif

#ifdef MODULE_LOGDEPTH
  logdepth_setFragDepth();
#endif
`,pK={vertex:fK,fragment:dK},gN=/void\s+main\s*\([^)]*\)\s*\{\n?/,vN=/}\n?[^{}]*$/,VM=[],y2="__LUMA_INJECT_DECLARATIONS__";function gK(r){const e={vertex:{},fragment:{}};for(const t in r){let i=r[t];const n=vK(t);typeof i=="string"&&(i={order:0,injection:i}),e[n][t]=i}return e}function vK(r){const e=r.slice(0,2);switch(e){case"vs":return"vertex";case"fs":return"fragment";default:throw new Error(e)}}function K2(r,e,t,i=!1){const n=e==="vertex";for(const a in t){const s=t[a];s.sort((l,c)=>l.order-c.order),VM.length=s.length;for(let l=0,c=s.length;l<c;++l)VM[l]=s[l].injection;const o=`${VM.join(`
`)}
`;switch(a){case"vs:#decl":n&&(r=r.replace(y2,o));break;case"vs:#main-start":n&&(r=r.replace(gN,l=>l+o));break;case"vs:#main-end":n&&(r=r.replace(vN,l=>o+l));break;case"fs:#decl":n||(r=r.replace(y2,o));break;case"fs:#main-start":n||(r=r.replace(gN,l=>l+o));break;case"fs:#main-end":n||(r=r.replace(vN,l=>o+l));break;default:r=r.replace(a,l=>l+o)}}return r=r.replace(y2,""),i&&(r=r.replace(/\}\s*$/,a=>a+pK[e])),r}function Q2(r){r.map(e=>mK(e))}function mK(r){if(r.instance)return;Q2(r.dependencies||[]);const{propTypes:e={},deprecations:t=[],inject:i={}}=r,n={normalizedInjections:gK(i),parsedDeprecations:yK(t)};e&&(n.propValidators=cK(e)),r.instance=n;let a={};e&&(a=Object.entries(e).reduce((s,[o,l])=>{const c=l?.value;return c&&(s[o]=c),s},{})),r.defaultUniforms={...r.defaultUniforms,...a}}function N8(r,e,t){r.deprecations?.forEach(i=>{i.regex?.test(e)&&(i.deprecated?t.deprecated(i.old,i.new)():t.removed(i.old,i.new)())})}function yK(r){return r.forEach(e=>{switch(e.type){case"function":e.regex=new RegExp(`\\b${e.old}\\(`);break;default:e.regex=new RegExp(`${e.type} ${e.old};`)}}),r}function AD(r){Q2(r);const e={},t={};B8({modules:r,level:0,moduleMap:e,moduleDepth:t});const i=Object.keys(t).sort((n,a)=>t[a]-t[n]).map(n=>e[n]);return Q2(i),i}function B8(r){const{modules:e,level:t,moduleMap:i,moduleDepth:n}=r;if(t>=5)throw new Error("Possible loop in shader dependency graph");for(const a of e)i[a.name]=a,(n[a.name]===void 0||n[a.name]<t)&&(n[a.name]=t);for(const a of e)a.dependencies&&B8({modules:a.dependencies,level:t+1,moduleMap:i,moduleDepth:n})}function _K(r){switch(r?.gpu.toLowerCase()){case"apple":return`#define APPLE_GPU
// Apple optimizes away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1
// Intel GPU doesn't have full 32 bits precision in same cases, causes overflow
#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1
`;case"nvidia":return`#define NVIDIA_GPU
// Nvidia optimizes away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
`;case"intel":return`#define INTEL_GPU
// Intel optimizes away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
// Intel's built-in 'tan' function doesn't have acceptable precision
#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1
// Intel GPU doesn't have full 32 bits precision in same cases, causes overflow
#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1
`;case"amd":return`#define AMD_GPU
`;default:return`#define DEFAULT_GPU
// Prevent driver from optimizing away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
// Headless Chrome's software shader 'tan' function doesn't have acceptable precision
#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1
// If the GPU doesn't have full 32 bits precision, will causes overflow
#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1
`}}function bK(r,e){if(Number(r.match(/^#version[ \t]+(\d+)/m)?.[1]||100)!==300)throw new Error("luma.gl v9 only supports GLSL 3.00 shader sources");switch(e){case"vertex":return r=mN(r,xK),r;case"fragment":return r=mN(r,wK),r;default:throw new Error(e)}}const z8=[[/^(#version[ \t]+(100|300[ \t]+es))?[ \t]*\n/,`#version 300 es
`],[/\btexture(2D|2DProj|Cube)Lod(EXT)?\(/g,"textureLod("],[/\btexture(2D|2DProj|Cube)(EXT)?\(/g,"texture("]],xK=[...z8,[QP("attribute"),"in $1"],[QP("varying"),"out $1"]],wK=[...z8,[QP("varying"),"in $1"]];function mN(r,e){for(const[t,i]of e)r=r.replace(t,i);return r}function QP(r){return new RegExp(`\\b${r}[ \\t]+(\\w+[ \\t]+\\w+(\\[\\w+\\])?;)`,"g")}function F8(r,e){let t="";for(const i in r){const n=r[i];if(t+=`void ${n.signature} {
`,n.header&&(t+=`  ${n.header}`),e[i]){const a=e[i];a.sort((s,o)=>s.order-o.order);for(const s of a)t+=`  ${s.injection}
`}n.footer&&(t+=`  ${n.footer}`),t+=`}
`}return t}function V8(r){const e={vertex:{},fragment:{}};for(const t of r){let i,n;typeof t!="string"?(i=t,n=i.hook):(i={},n=t),n=n.trim();const[a,s]=n.split(":"),o=n.replace(/\(.+/,""),l=Object.assign(i,{signature:s});switch(a){case"vs":e.vertex[o]=l;break;case"fs":e.fragment[o]=l;break;default:throw new Error(a)}}return e}function SK(r,e){return{name:TK(r,e),language:"glsl",version:AK(r)}}function TK(r,e="unnamed"){const i=/#define[^\S\r\n]*SHADER_NAME[^\S\r\n]*([A-Za-z0-9_-]+)\s*/.exec(r);return i?i[1]:e}function AK(r){let e=100;const t=r.match(/[^\s]+/g);if(t&&t.length>=2&&t[0]==="#version"){const i=parseInt(t[1],10);Number.isFinite(i)&&(e=i)}if(e!==100&&e!==300)throw new Error(`Invalid GLSL version ${e}`);return e}const U8=`

${y2}
`,CK=`precision highp float;
`;function MK(r){const e=AD(r.modules||[]);return{source:IK(r.platformInfo,{...r,source:r.source,stage:"vertex",modules:e}),getUniforms:H8(e)}}function EK(r){const{vs:e,fs:t}=r,i=AD(r.modules||[]);return{vs:yN(r.platformInfo,{...r,source:e,stage:"vertex",modules:i}),fs:yN(r.platformInfo,{...r,source:t,stage:"fragment",modules:i}),getUniforms:H8(i)}}function IK(r,e){const{source:t,stage:i,modules:n,hookFunctions:a=[],inject:s={},log:o}=e;TD(typeof t=="string","shader source must be a string");const l=t;let c="";const f=V8(a),p={},y={},b={};for(const C in s){const E=typeof s[C]=="string"?{injection:s[C],order:0}:s[C],P=/^(v|f)s:(#)?([\w-]+)$/.exec(C);if(P){const O=P[2],B=P[3];O?B==="decl"?y[C]=[E]:b[C]=[E]:p[C]=[E]}else b[C]=[E]}const S=n;for(const C of S){o&&N8(C,l,o);const E=j8(C,"wgsl");c+=E;const P=C.injections?.[i]||{};for(const O in P){const B=/^(v|f)s:#([\w-]+)$/.exec(O);if(B){const W=B[2]==="decl"?y:b;W[O]=W[O]||[],W[O].push(P[O])}else p[O]=p[O]||[],p[O].push(P[O])}}return c+=U8,c=K2(c,i,y),c+=F8(f[i],p),c+=l,c=K2(c,i,b),c}function yN(r,e){const{source:t,stage:i,language:n="glsl",modules:a,defines:s={},hookFunctions:o=[],inject:l={},prologue:c=!0,log:f}=e;TD(typeof t=="string","shader source must be a string");const p=n==="glsl"?SK(t).version:-1,y=r.shaderLanguageVersion,b=p===100?"#version 100":"#version 300 es",C=t.split(`
`).slice(1).join(`
`),E={};a.forEach($=>{Object.assign(E,$.defines)}),Object.assign(E,s);let P="";switch(n){case"wgsl":break;case"glsl":P=c?`${b}

// ----- PROLOGUE -------------------------
${`#define SHADER_TYPE_${i.toUpperCase()}`}

${_K(r)}
${i==="fragment"?CK:""}

// ----- APPLICATION DEFINES -------------------------

${PK(E)}

`:`${b}
`;break}const O=V8(o),B={},F={},W={};for(const $ in l){const q=typeof l[$]=="string"?{injection:l[$],order:0}:l[$],Q=/^(v|f)s:(#)?([\w-]+)$/.exec($);if(Q){const ee=Q[2],te=Q[3];ee?te==="decl"?F[$]=[q]:W[$]=[q]:B[$]=[q]}else W[$]=[q]}for(const $ of a){f&&N8($,C,f);const q=j8($,i);P+=q;const Q=$.instance?.normalizedInjections[i]||{};for(const ee in Q){const te=/^(v|f)s:#([\w-]+)$/.exec(ee);if(te){const de=te[2]==="decl"?F:W;de[ee]=de[ee]||[],de[ee].push(Q[ee])}else B[ee]=B[ee]||[],B[ee].push(Q[ee])}}return P+="// ----- MAIN SHADER SOURCE -------------------------",P+=U8,P=K2(P,i,F),P+=F8(O[i],B),P+=C,P=K2(P,i,W),n==="glsl"&&p!==y&&(P=bK(P,i)),P.trim()}function H8(r){return function(t){const i={};for(const n of r){const a=n.getUniforms?.(t,i);Object.assign(i,a)}return i}}function PK(r={}){let e="";for(const t in r){const i=r[t];(i||Number.isFinite(i))&&(e+=`#define ${t.toUpperCase()} ${r[t]}
`)}return e}function j8(r,e){let t;switch(e){case"vertex":t=r.vs||"";break;case"fragment":t=r.fs||"";break;case"wgsl":t=r.source||"";break;default:TD(!1)}if(!r.name)throw new Error("Shader module must have a name");const i=r.name.toUpperCase().replace(/[^0-9a-z]/gi,"_");let n=`// ----- MODULE ${r.name} ---------------

`;return e!=="wgsl"&&(n+=`#define MODULE_${i}
`),n+=`${t}
`,n}const RK=/^\s*\#\s*ifdef\s*([a-zA-Z_]+)\s*$/,DK=/^\s*\#\s*endif\s*$/;function kK(r,e){const t=r.split(`
`),i=[];let n=!0,a=null;for(const s of t){const o=s.match(RK),l=s.match(DK);o?(a=o[1],n=!!e?.defines?.[a]):l?n=!0:n&&i.push(s)}return i.join(`
`)}class zm{static defaultShaderAssembler;_hookFunctions=[];_defaultModules=[];static getDefaultShaderAssembler(){return zm.defaultShaderAssembler=zm.defaultShaderAssembler||new zm,zm.defaultShaderAssembler}addDefaultModule(e){this._defaultModules.find(t=>t.name===(typeof e=="string"?e:e.name))||this._defaultModules.push(e)}removeDefaultModule(e){const t=typeof e=="string"?e:e.name;this._defaultModules=this._defaultModules.filter(i=>i.name!==t)}addShaderHook(e,t){t&&(e=Object.assign(t,{hook:e})),this._hookFunctions.push(e)}assembleWGSLShader(e){const t=this._getModuleList(e.modules),i=this._hookFunctions,{source:n,getUniforms:a}=MK({...e,source:e.source,modules:t,hookFunctions:i});return{source:e.platformInfo.shaderLanguage==="wgsl"?kK(n):n,getUniforms:a,modules:t}}assembleGLSLShaderPair(e){const t=this._getModuleList(e.modules),i=this._hookFunctions;return{...EK({...e,vs:e.vs,fs:e.fs,modules:t,hookFunctions:i}),modules:t}}_getModuleList(e=[]){const t=new Array(this._defaultModules.length+e.length),i={};let n=0;for(let a=0,s=this._defaultModules.length;a<s;++a){const o=this._defaultModules[a],l=o.name;t[n++]=o,i[l]=!0}for(let a=0,s=e.length;a<s;++a){const o=e[a],l=o.name;i[l]||(t[n++]=o,i[l]=!0)}return t.length=n,Q2(t),t}}const LK=`out vec4 transform_output;
void main() {
  transform_output = vec4(0);
}`,OK=`#version 300 es
${LK}`;function NK(r){const{input:e,inputChannels:t,output:i}={};if(!e)return OK;if(!t)throw new Error("inputChannels");const n=BK(t),a=zK(e,t);return`#version 300 es
in ${n} ${e};
out vec4 ${i};
void main() {
  ${i} = ${a};
}`}function BK(r){switch(r){case 1:return"float";case 2:return"vec2";case 3:return"vec3";case 4:return"vec4";default:throw new Error(`invalid channels: ${r}`)}}function zK(r,e){switch(e){case 1:return`vec4(${r}, 0.0, 0.0, 1.0)`;case 2:return`vec4(${r}, 0.0, 1.0)`;case 3:return`vec4(${r}, 1.0)`;case 4:return r;default:throw new Error(`invalid channels: ${e}`)}}class FK{stats=new Map;getStats(e){return this.get(e)}get(e){return this.stats.has(e)||this.stats.set(e,new fC({id:e})),this.stats.get(e)}}const $8=new FK,Nt=new Nw({id:"luma.gl"}),UM={};function pC(r="id"){UM[r]=UM[r]||1;const e=UM[r]++;return`${r}-${e}`}let Cn=class{static defaultProps={id:"undefined",handle:void 0,userData:void 0};toString(){return`${this[Symbol.toStringTag]||this.constructor.name}:"${this.id}"`}id;props;userData={};_device;destroyed=!1;allocatedBytes=0;_attachedResources=new Set;constructor(e,t,i){if(!e)throw new Error("no device");this._device=e,this.props=VK(t,i);const n=this.props.id!=="undefined"?this.props.id:pC(this[Symbol.toStringTag]);this.props.id=n,this.id=n,this.userData=this.props.userData||{},this.addStats()}destroy(){this.destroyResource()}delete(){return this.destroy(),this}getProps(){return this.props}attachResource(e){this._attachedResources.add(e)}detachResource(e){this._attachedResources.delete(e)}destroyAttachedResource(e){this._attachedResources.delete(e)&&e.destroy()}destroyAttachedResources(){for(const e of Object.values(this._attachedResources))e.destroy();this._attachedResources=new Set}destroyResource(){this.destroyAttachedResources(),this.removeStats(),this.destroyed=!0}removeStats(){const e=this._device.statsManager.getStats("Resource Counts"),t=this[Symbol.toStringTag];e.get(`${t}s Active`).decrementCount()}trackAllocatedMemory(e,t=this[Symbol.toStringTag]){const i=this._device.statsManager.getStats("Resource Counts");i.get("GPU Memory").addCount(e),i.get(`${t} Memory`).addCount(e),this.allocatedBytes=e}trackDeallocatedMemory(e=this[Symbol.toStringTag]){const t=this._device.statsManager.getStats("Resource Counts");t.get("GPU Memory").subtractCount(this.allocatedBytes),t.get(`${e} Memory`).subtractCount(this.allocatedBytes),this.allocatedBytes=0}addStats(){const e=this._device.statsManager.getStats("Resource Counts"),t=this[Symbol.toStringTag];e.get("Resources Created").incrementCount(),e.get(`${t}s Created`).incrementCount(),e.get(`${t}s Active`).incrementCount()}};function VK(r,e){const t={...e};for(const i in r)r[i]!==void 0&&(t[i]=r[i]);return t}let ua=class _2 extends Cn{static INDEX=16;static VERTEX=32;static UNIFORM=64;static STORAGE=128;static INDIRECT=256;static QUERY_RESOLVE=512;static MAP_READ=1;static MAP_WRITE=2;static COPY_SRC=4;static COPY_DST=8;get[Symbol.toStringTag](){return"Buffer"}usage;indexType;updateTimestamp;constructor(e,t){const i={...t};(t.usage||0)&_2.INDEX&&!t.indexType&&(t.data instanceof Uint32Array?i.indexType="uint32":t.data instanceof Uint16Array&&(i.indexType="uint16")),delete i.data,super(e,i,_2.defaultProps),this.usage=i.usage||0,this.indexType=i.indexType,this.updateTimestamp=e.incrementTimestamp()}clone(e){return this.device.createBuffer({...this.props,...e})}static DEBUG_DATA_MAX_LENGTH=32;debugData=new ArrayBuffer(0);_setDebugData(e,t,i){const n=ArrayBuffer.isView(e)?e.buffer:e,a=Math.min(e?e.byteLength:i,_2.DEBUG_DATA_MAX_LENGTH);n===null?this.debugData=new ArrayBuffer(a):t===0&&i===n.byteLength?this.debugData=n.slice(0,a):this.debugData=n.slice(t,t+a)}static defaultProps={...Cn.defaultProps,usage:0,byteLength:0,byteOffset:0,data:null,indexType:"uint16",onMapped:void 0}};function W8(r){const[e,t,i]=ED[r],n=r.includes("norm"),a=!n&&!r.startsWith("float"),s=r.startsWith("s");return{signedType:e,primitiveType:t,byteLength:i,normalized:n,integer:a,signed:s}}function UK(r){const e=r;switch(e){case"uint8":return"unorm8";case"sint8":return"snorm8";case"uint16":return"unorm16";case"sint16":return"snorm16";default:return e}}function HK(r,e){switch(e){case 1:return r;case 2:return r+r%2;default:return r+(4-r%4)%4}}function CD(r){const e=ArrayBuffer.isView(r)?r.constructor:r;if(e===Uint8ClampedArray)return"uint8";const t=Object.values(ED).find(i=>e===i[4]);if(!t)throw new Error(e.name);return t[0]}function MD(r){const[,,,,e]=ED[r];return e}const ED={uint8:["uint8","u32",1,!1,Uint8Array],sint8:["sint8","i32",1,!1,Int8Array],unorm8:["uint8","f32",1,!0,Uint8Array],snorm8:["sint8","f32",1,!0,Int8Array],uint16:["uint16","u32",2,!1,Uint16Array],sint16:["sint16","i32",2,!1,Int16Array],unorm16:["uint16","u32",2,!0,Uint16Array],snorm16:["sint16","i32",2,!0,Int16Array],float16:["float16","f16",2,!1,Uint16Array],float32:["float32","f32",4,!1,Float32Array],uint32:["uint32","u32",4,!1,Uint32Array],sint32:["sint32","i32",4,!1,Int32Array]};function ID(r){let e;r.endsWith("-webgl")&&(r.replace("-webgl",""),e=!0);const[t,i]=r.split("x"),n=t,a=i?parseInt(i):1,s=W8(n),o={type:n,components:a,byteLength:s.byteLength*a,integer:s.integer,signed:s.signed,normalized:s.normalized};return e&&(o.webglOnly=!0),o}function jK(r,e,t){const i=t?UK(r):r;switch(i){case"unorm8":return e===1?"unorm8":e===3?"unorm8x3-webgl":`${i}x${e}`;case"snorm8":case"uint8":case"sint8":case"uint16":case"sint16":case"unorm16":case"snorm16":case"float16":if(e===1||e===3)throw new Error(`size: ${e}`);return`${i}x${e}`;default:return e===1?i:`${i}x${e}`}}function $K(r,e,t){if(!e||e>4)throw new Error(`size ${e}`);const i=e,n=CD(r);return jK(n,i,t)}function WK(r){let e;switch(r.primitiveType){case"f32":e="float32";break;case"i32":e="sint32";break;case"u32":e="uint32";break;case"f16":return r.components<=2?"float16x2":"float16x4"}return r.components===1?e:`${e}x${r.components}`}const _s="texture-compression-bc",Sn="texture-compression-astc",yf="texture-compression-etc2",GK="texture-compression-etc1-webgl",QS="texture-compression-pvrtc-webgl",HM="texture-compression-atc-webgl",JS="float32-renderable-webgl",jM="float16-renderable-webgl",XK="rgb9e5ufloat-renderable-webgl",$M="snorm8-renderable-webgl",Mx="norm16-renderable-webgl",WM="snorm16-renderable-webgl",eT="float32-filterable",_N="float16-filterable-webgl";function G8(r){const e=YK[r];if(!e)throw new Error(`Unsupported texture format ${r}`);return e}const ZK={r8unorm:{},rg8unorm:{},"rgb8unorm-webgl":{},rgba8unorm:{},"rgba8unorm-srgb":{},r8snorm:{render:$M},rg8snorm:{render:$M},"rgb8snorm-webgl":{},rgba8snorm:{render:$M},r8uint:{},rg8uint:{},rgba8uint:{},r8sint:{},rg8sint:{},rgba8sint:{},bgra8unorm:{},"bgra8unorm-srgb":{},r16unorm:{f:Mx},rg16unorm:{render:Mx},"rgb16unorm-webgl":{f:Mx},rgba16unorm:{render:Mx},r16snorm:{f:WM},rg16snorm:{render:WM},"rgb16snorm-webgl":{f:Mx},rgba16snorm:{render:WM},r16uint:{},rg16uint:{},rgba16uint:{},r16sint:{},rg16sint:{},rgba16sint:{},r16float:{render:jM,filter:"float16-filterable-webgl"},rg16float:{render:jM,filter:_N},rgba16float:{render:jM,filter:_N},r32uint:{},rg32uint:{},rgba32uint:{},r32sint:{},rg32sint:{},rgba32sint:{},r32float:{render:JS,filter:eT},rg32float:{render:!1,filter:eT},"rgb32float-webgl":{render:JS,filter:eT},rgba32float:{render:JS,filter:eT},"rgba4unorm-webgl":{channels:"rgba",bitsPerChannel:[4,4,4,4],packed:!0},"rgb565unorm-webgl":{channels:"rgb",bitsPerChannel:[5,6,5,0],packed:!0},"rgb5a1unorm-webgl":{channels:"rgba",bitsPerChannel:[5,5,5,1],packed:!0},rgb9e5ufloat:{channels:"rgb",packed:!0,render:XK},rg11b10ufloat:{channels:"rgb",bitsPerChannel:[11,11,10,0],packed:!0,p:1,render:JS},rgb10a2unorm:{channels:"rgba",bitsPerChannel:[10,10,10,2],packed:!0,p:1},rgb10a2uint:{channels:"rgba",bitsPerChannel:[10,10,10,2],packed:!0,p:1},stencil8:{attachment:"stencil",bitsPerChannel:[8,0,0,0],dataType:"uint8"},depth16unorm:{attachment:"depth",bitsPerChannel:[16,0,0,0],dataType:"uint16"},depth24plus:{attachment:"depth",bitsPerChannel:[24,0,0,0],dataType:"uint32"},depth32float:{attachment:"depth",bitsPerChannel:[32,0,0,0],dataType:"float32"},"depth24plus-stencil8":{attachment:"depth-stencil",bitsPerChannel:[24,8,0,0],packed:!0},"depth32float-stencil8":{attachment:"depth-stencil",bitsPerChannel:[32,8,0,0],packed:!0}},qK={"bc1-rgb-unorm-webgl":{f:_s},"bc1-rgb-unorm-srgb-webgl":{f:_s},"bc1-rgba-unorm":{f:_s},"bc1-rgba-unorm-srgb":{f:_s},"bc2-rgba-unorm":{f:_s},"bc2-rgba-unorm-srgb":{f:_s},"bc3-rgba-unorm":{f:_s},"bc3-rgba-unorm-srgb":{f:_s},"bc4-r-unorm":{f:_s},"bc4-r-snorm":{f:_s},"bc5-rg-unorm":{f:_s},"bc5-rg-snorm":{f:_s},"bc6h-rgb-ufloat":{f:_s},"bc6h-rgb-float":{f:_s},"bc7-rgba-unorm":{f:_s},"bc7-rgba-unorm-srgb":{f:_s},"etc2-rgb8unorm":{f:yf},"etc2-rgb8unorm-srgb":{f:yf},"etc2-rgb8a1unorm":{f:yf},"etc2-rgb8a1unorm-srgb":{f:yf},"etc2-rgba8unorm":{f:yf},"etc2-rgba8unorm-srgb":{f:yf},"eac-r11unorm":{f:yf},"eac-r11snorm":{f:yf},"eac-rg11unorm":{f:yf},"eac-rg11snorm":{f:yf},"astc-4x4-unorm":{f:Sn},"astc-4x4-unorm-srgb":{f:Sn},"astc-5x4-unorm":{f:Sn},"astc-5x4-unorm-srgb":{f:Sn},"astc-5x5-unorm":{f:Sn},"astc-5x5-unorm-srgb":{f:Sn},"astc-6x5-unorm":{f:Sn},"astc-6x5-unorm-srgb":{f:Sn},"astc-6x6-unorm":{f:Sn},"astc-6x6-unorm-srgb":{f:Sn},"astc-8x5-unorm":{f:Sn},"astc-8x5-unorm-srgb":{f:Sn},"astc-8x6-unorm":{f:Sn},"astc-8x6-unorm-srgb":{f:Sn},"astc-8x8-unorm":{f:Sn},"astc-8x8-unorm-srgb":{f:Sn},"astc-10x5-unorm":{f:Sn},"astc-10x5-unorm-srgb":{f:Sn},"astc-10x6-unorm":{f:Sn},"astc-10x6-unorm-srgb":{f:Sn},"astc-10x8-unorm":{f:Sn},"astc-10x8-unorm-srgb":{f:Sn},"astc-10x10-unorm":{f:Sn},"astc-10x10-unorm-srgb":{f:Sn},"astc-12x10-unorm":{f:Sn},"astc-12x10-unorm-srgb":{f:Sn},"astc-12x12-unorm":{f:Sn},"astc-12x12-unorm-srgb":{f:Sn},"pvrtc-rgb4unorm-webgl":{f:QS},"pvrtc-rgba4unorm-webgl":{f:QS},"pvrtc-rbg2unorm-webgl":{f:QS},"pvrtc-rgba2unorm-webgl":{f:QS},"etc1-rbg-unorm-webgl":{f:GK},"atc-rgb-unorm-webgl":{f:HM},"atc-rgba-unorm-webgl":{f:HM},"atc-rgbai-unorm-webgl":{f:HM}},YK={...ZK,...qK},KK=["bc1","bc2","bc3","bc4","bc5","bc6","bc7","etc1","etc2","eac","atc","astc","pvrtc"],QK=/^(r|rg|rgb|rgba|bgra)([0-9]*)([a-z]*)(-srgb)?(-webgl)?$/;class JK{getInfo(e){return bN(e)}isColor(e){return e.startsWith("rgba")||e.startsWith("bgra")||e.startsWith("rgb")}isDepthStencil(e){return e.startsWith("depth")||e.startsWith("stencil")}isCompressed(e){return KK.some(t=>e.startsWith(t))}getCapabilities(e){const t=G8(e),i={format:e,create:t.f??!0,render:t.render??!0,filter:t.filter??!0,blend:t.blend??!0,store:t.store??!0},n=bN(e),a=e.startsWith("depth")||e.startsWith("stencil"),s=n?.signed,o=n?.integer,l=n?.webgl;return i.render&&=!s,i.filter&&=!a&&!s&&!o&&!l,i}}const S0=new JK;function bN(r){let e=eQ(r);if(S0.isCompressed(r)){e.channels="rgb",e.components=3,e.bytesPerPixel=1,e.srgb=!1,e.compressed=!0;const i=tQ(r);i&&(e.blockWidth=i.blockWidth,e.blockHeight=i.blockHeight)}const t=QK.exec(r);if(t){const[,i,n,a,s,o]=t,l=`${a}${n}`,c=W8(l),f=c.byteLength*8,p=i.length,y=[f,p>=2?f:0,p>=3?f:0,p>=4?f:0];e={format:r,attachment:e.attachment,dataType:c.signedType,components:p,channels:i,integer:c.integer,signed:c.signed,normalized:c.normalized,bitsPerChannel:y,bytesPerPixel:c.byteLength*i.length,packed:e.packed,srgb:e.srgb},o==="-webgl"&&(e.webgl=!0),s==="-srgb"&&(e.srgb=!0)}return r.endsWith("-webgl")&&(e.webgl=!0),r.endsWith("-srgb")&&(e.srgb=!0),e}function eQ(r){const e=G8(r),t=e.bytesPerPixel||1,i=e.bitsPerChannel||[8,8,8,8];return delete e.bitsPerChannel,delete e.bytesPerPixel,delete e.f,delete e.render,delete e.filter,delete e.blend,delete e.store,{...e,format:r,attachment:e.attachment||"color",channels:e.channels||"r",components:e.components||e.channels?.length||1,bytesPerPixel:t,bitsPerChannel:i,dataType:e.dataType||"uint8",srgb:e.srgb??!1,packed:e.packed??!1,webgl:e.webgl??!1,integer:e.integer??!1,signed:e.signed??!1,normalized:e.normalized??!1,compressed:e.compressed??!1}}function tQ(r){const t=/.*-(\d+)x(\d+)-.*/.exec(r);if(t){const[,i,n]=t;return{blockWidth:Number(i),blockHeight:Number(n)}}return null}function rQ(r){return typeof ImageData<"u"&&r instanceof ImageData||typeof ImageBitmap<"u"&&r instanceof ImageBitmap||typeof HTMLImageElement<"u"&&r instanceof HTMLImageElement||typeof HTMLVideoElement<"u"&&r instanceof HTMLVideoElement||typeof VideoFrame<"u"&&r instanceof VideoFrame||typeof HTMLCanvasElement<"u"&&r instanceof HTMLCanvasElement||typeof OffscreenCanvas<"u"&&r instanceof OffscreenCanvas}function iQ(r){if(typeof ImageData<"u"&&r instanceof ImageData||typeof ImageBitmap<"u"&&r instanceof ImageBitmap||typeof HTMLCanvasElement<"u"&&r instanceof HTMLCanvasElement||typeof OffscreenCanvas<"u"&&r instanceof OffscreenCanvas)return{width:r.width,height:r.height};if(typeof HTMLImageElement<"u"&&r instanceof HTMLImageElement)return{width:r.naturalWidth,height:r.naturalHeight};if(typeof HTMLVideoElement<"u"&&r instanceof HTMLVideoElement)return{width:r.videoWidth,height:r.videoHeight};if(typeof VideoFrame<"u"&&r instanceof VideoFrame)return{width:r.displayWidth,height:r.displayHeight};throw new Error("Unknown image type")}class nQ{}class aQ{features;disabledFeatures;constructor(e=[],t){this.features=new Set(e),this.disabledFeatures=t||{}}*[Symbol.iterator](){yield*this.features}has(e){return!this.disabledFeatures?.[e]&&this.features.has(e)}}class ly{static defaultProps={id:null,powerPreference:"high-performance",failIfMajorPerformanceCaveat:!1,createCanvasContext:void 0,webgl:{},onError:(e,t)=>{},onResize:(e,t)=>{const[i,n]=e.getDevicePixelSize();Nt.log(1,`${e} resized => ${i}x${n}px`)()},onPositionChange:(e,t)=>{const[i,n]=e.getPosition();Nt.log(1,`${e} repositioned => ${i},${n}`)()},onVisibilityChange:e=>Nt.log(1,`${e} Visibility changed ${e.isVisible}`)(),onDevicePixelRatioChange:(e,t)=>Nt.log(1,`${e} DPR changed ${t.oldRatio} => ${e.devicePixelRatio}`)(),debug:Nt.get("debug")||void 0,debugShaders:Nt.get("debug-shaders")||void 0,debugFramebuffers:!!Nt.get("debug-framebuffers"),debugFactories:!!Nt.get("debug-factories"),debugWebGL:!!Nt.get("debug-webgl"),debugSpectorJS:void 0,debugSpectorJSUrl:void 0,_reuseDevices:!1,_requestMaxLimits:!0,_cacheShaders:!1,_cachePipelines:!1,_cacheDestroyPolicy:"unused",_initializeFeatures:!0,_disabledFeatures:{"compilation-status-async-webgl":!0},_handle:void 0};get[Symbol.toStringTag](){return"Device"}toString(){return`Device(${this.id})`}id;props;userData={};statsManager=$8;timestamp=0;_reused=!1;_lumaData={};_textureCaps={};constructor(e){this.props={...ly.defaultProps,...e},this.id=this.props.id||pC(this[Symbol.toStringTag].toLowerCase())}getVertexFormatInfo(e){return ID(e)}isVertexFormatSupported(e){return!0}getTextureFormatInfo(e){return S0.getInfo(e)}getTextureFormatCapabilities(e){let t=this._textureCaps[e];if(!t){const i=this._getDeviceTextureFormatCapabilities(e);t=this._getDeviceSpecificTextureFormatCapabilities(i),this._textureCaps[e]=t}return t}getMipLevelCount(e,t,i=1){const n=Math.max(e,t,i);return 1+Math.floor(Math.log2(n))}isExternalImage(e){return rQ(e)}getExternalImageSize(e){return iQ(e)}isTextureFormatSupported(e){return this.getTextureFormatCapabilities(e).create}isTextureFormatFilterable(e){return this.getTextureFormatCapabilities(e).filter}isTextureFormatRenderable(e){return this.getTextureFormatCapabilities(e).render}isTextureFormatCompressed(e){return S0.isCompressed(e)}pushDebugGroup(e){this.commandEncoder.pushDebugGroup(e)}popDebugGroup(){this.commandEncoder?.popDebugGroup()}insertDebugMarker(e){this.commandEncoder?.insertDebugMarker(e)}loseDevice(){return!1}incrementTimestamp(){return this.timestamp++}reportError(e,t,...i){return this.props.onError(e,t)?()=>{}:Nt.error(e.message,t,...i)}debug(){if(this.props.debug)debugger;else Nt.once(0,`'Type luma.log.set({debug: true}) in console to enable debug breakpoints',
or create a device with the 'debug: true' prop.`)()}getDefaultCanvasContext(){if(!this.canvasContext)throw new Error("Device has no default CanvasContext. See props.createCanvasContext");return this.canvasContext}beginRenderPass(e){return this.commandEncoder.beginRenderPass(e)}beginComputePass(e){return this.commandEncoder.beginComputePass(e)}getCanvasContext(){return this.getDefaultCanvasContext()}readPixelsToArrayWebGL(e,t){throw new Error("not implemented")}readPixelsToBufferWebGL(e,t){throw new Error("not implemented")}setParametersWebGL(e){throw new Error("not implemented")}getParametersWebGL(e){throw new Error("not implemented")}withParametersWebGL(e,t){throw new Error("not implemented")}clearWebGL(e){throw new Error("not implemented")}resetWebGL(){throw new Error("not implemented")}static _getCanvasContextProps(e){return e.createCanvasContext===!0?{}:e.createCanvasContext}_getDeviceTextureFormatCapabilities(e){const t=S0.getCapabilities(e),i=a=>(typeof a=="string"?this.features.has(a):a)??!0,n=i(t.create);return{format:e,create:n,render:n&&i(t.render),filter:n&&i(t.filter),blend:n&&i(t.blend),store:n&&i(t.store)}}_normalizeBufferProps(e){(e instanceof ArrayBuffer||ArrayBuffer.isView(e))&&(e={data:e});const t={...e};if((e.usage||0)&ua.INDEX&&(e.indexType||(e.data instanceof Uint32Array?t.indexType="uint32":e.data instanceof Uint16Array&&(t.indexType="uint16")),!t.indexType))throw new Error("indices buffer content must be of type uint16 or uint32");return t}}const oQ="set luma.log.level=1 (or higher) to trace rendering",xN="No matching device found. Ensure `@luma.gl/webgl` and/or `@luma.gl/webgpu` modules are imported.";class J2{static defaultProps={...ly.defaultProps,type:"best-available",adapters:void 0,waitForPageLoad:!0};stats=$8;log=Nt;VERSION="9.2.2";spector;preregisteredAdapters=new Map;constructor(){if(globalThis.luma){if(globalThis.luma.VERSION!==this.VERSION)throw Nt.error(`Found luma.gl ${globalThis.luma.VERSION} while initialzing ${this.VERSION}`)(),Nt.error("'yarn why @luma.gl/core' can help identify the source of the conflict")(),new Error("luma.gl - multiple versions detected: see console log");Nt.error("This version of luma.gl has already been initialized")()}Nt.log(1,`${this.VERSION} - ${oQ}`)(),globalThis.luma=this}async createDevice(e={}){const t={...J2.defaultProps,...e},i=this.selectAdapter(t.type,t.adapters);if(!i)throw new Error(xN);return t.waitForPageLoad&&await i.pageLoaded,await i.create(t)}async attachDevice(e,t){const i=this._getTypeFromHandle(e,t.adapters),n=i&&this.selectAdapter(i,t.adapters);if(!n)throw new Error(xN);return await n?.attach?.(e,t)}registerAdapters(e){for(const t of e)this.preregisteredAdapters.set(t.type,t)}getSupportedAdapters(e=[]){const t=this._getAdapterMap(e);return Array.from(t).map(([,i])=>i).filter(i=>i.isSupported?.()).map(i=>i.type)}getBestAvailableAdapterType(e=[]){const t=["webgpu","webgl","null"],i=this._getAdapterMap(e);for(const n of t)if(i.get(n)?.isSupported?.())return n;return null}selectAdapter(e,t=[]){let i=e;e==="best-available"&&(i=this.getBestAvailableAdapterType(t));const n=this._getAdapterMap(t);return i&&n.get(i)||null}enforceWebGL2(e=!0,t=[]){const n=this._getAdapterMap(t).get("webgl");n||Nt.warn("enforceWebGL2: webgl adapter not found")(),n?.enforceWebGL2?.(e)}setDefaultDeviceProps(e){Object.assign(J2.defaultProps,e)}_getAdapterMap(e=[]){const t=new Map(this.preregisteredAdapters);for(const i of e)t.set(i.type,i);return t}_getTypeFromHandle(e,t=[]){return e instanceof WebGL2RenderingContext?"webgl":typeof GPUDevice<"u"&&e instanceof GPUDevice||e?.queue?"webgpu":e===null?"null":(e instanceof WebGLRenderingContext?Nt.warn("WebGL1 is not supported",e)():Nt.warn("Unknown handle type",e)(),null)}}const JP=new J2;class sQ{get pageLoaded(){return cQ()}}const lQ=Ty()&&typeof document<"u",uQ=()=>lQ&&document.readyState==="complete";let tT=null;function cQ(){return tT||(uQ()||typeof window>"u"?tT=Promise.resolve():tT=new Promise(r=>window.addEventListener("load",()=>r()))),tT}function hQ(){let r,e;return{promise:new Promise((i,n)=>{r=i,e=n}),resolve:r,reject:e}}class Fm{static isHTMLCanvas(e){return typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement}static isOffscreenCanvas(e){return typeof OffscreenCanvas<"u"&&e instanceof OffscreenCanvas}static defaultProps={id:void 0,canvas:null,width:800,height:600,useDevicePixels:!0,autoResize:!0,container:null,visible:!0,alphaMode:"opaque",colorSpace:"srgb",trackPosition:!1};id;props;canvas;htmlCanvas;offscreenCanvas;type;initialized;isInitialized=!1;isVisible=!0;cssWidth;cssHeight;devicePixelRatio;devicePixelWidth;devicePixelHeight;drawingBufferWidth;drawingBufferHeight;_initializedResolvers=hQ();_resizeObserver;_intersectionObserver;_position;destroyed=!1;toString(){return`${this[Symbol.toStringTag]}(${this.id})`}constructor(e){if(this.props={...Fm.defaultProps,...e},e=this.props,this.initialized=this._initializedResolvers.promise,Ty()?e.canvas?typeof e.canvas=="string"?this.canvas=dQ(e.canvas):this.canvas=e.canvas:this.canvas=pQ(e):this.canvas={width:e.width||1,height:e.height||1},Fm.isHTMLCanvas(this.canvas)?(this.id=e.id||this.canvas.id,this.type="html-canvas",this.htmlCanvas=this.canvas):Fm.isOffscreenCanvas(this.canvas)?(this.id=e.id||"offscreen-canvas",this.type="offscreen-canvas",this.offscreenCanvas=this.canvas):(this.id=e.id||"node-canvas-context",this.type="node"),this.cssWidth=this.htmlCanvas?.clientWidth||this.canvas.width,this.cssHeight=this.htmlCanvas?.clientHeight||this.canvas.height,this.devicePixelWidth=this.canvas.width,this.devicePixelHeight=this.canvas.height,this.drawingBufferWidth=this.canvas.width,this.drawingBufferHeight=this.canvas.height,this.devicePixelRatio=globalThis.devicePixelRatio||1,this._position=[0,0],Fm.isHTMLCanvas(this.canvas)){this._intersectionObserver=new IntersectionObserver(t=>this._handleIntersection(t)),this._intersectionObserver.observe(this.canvas),this._resizeObserver=new ResizeObserver(t=>this._handleResize(t));try{this._resizeObserver.observe(this.canvas,{box:"device-pixel-content-box"})}catch{this._resizeObserver.observe(this.canvas,{box:"content-box"})}setTimeout(()=>this._observeDevicePixelRatio(),0),this.props.trackPosition&&this._trackPosition()}}destroy(){this.destroyed=!0}setProps(e){return"useDevicePixels"in e&&(this.props.useDevicePixels=e.useDevicePixels||!1,this._updateDrawingBufferSize()),this}getCSSSize(){return[this.cssWidth,this.cssHeight]}getPosition(){return this._position}getDevicePixelSize(){return[this.devicePixelWidth,this.devicePixelHeight]}getDrawingBufferSize(){return[this.drawingBufferWidth,this.drawingBufferHeight]}getMaxDrawingBufferSize(){const e=this.device.limits.maxTextureDimension2D;return[e,e]}setDrawingBufferSize(e,t){this.canvas.width=e,this.canvas.height=t,this.drawingBufferWidth=e,this.drawingBufferHeight=t}getDevicePixelRatio(){return typeof window<"u"&&window.devicePixelRatio||1}cssToDevicePixels(e,t=!0){const i=this.cssToDeviceRatio(),[n,a]=this.getDrawingBufferSize();return gQ(e,i,n,a,t)}getPixelSize(){return this.getDevicePixelSize()}getAspect(){const[e,t]=this.getDevicePixelSize();return e/t}cssToDeviceRatio(){try{const[e]=this.getDrawingBufferSize(),[t]=this.getCSSSize();return t?e/t:1}catch{return 1}}resize(e){this.setDrawingBufferSize(e.width,e.height)}_setAutoCreatedCanvasId(e){this.htmlCanvas?.id==="lumagl-auto-created-canvas"&&(this.htmlCanvas.id=e)}_handleIntersection(e){const t=e.find(n=>n.target===this.canvas);if(!t)return;const i=t.isIntersecting;this.isVisible!==i&&(this.isVisible=i,this.device.props.onVisibilityChange(this))}_handleResize(e){const t=e.find(l=>l.target===this.canvas);if(!t)return;this.cssWidth=t.contentBoxSize[0].inlineSize,this.cssHeight=t.contentBoxSize[0].blockSize;const i=this.getDevicePixelSize(),n=t.devicePixelContentBoxSize?.[0].inlineSize||t.contentBoxSize[0].inlineSize*devicePixelRatio,a=t.devicePixelContentBoxSize?.[0].blockSize||t.contentBoxSize[0].blockSize*devicePixelRatio,[s,o]=this.getMaxDrawingBufferSize();this.devicePixelWidth=Math.max(1,Math.min(n,s)),this.devicePixelHeight=Math.max(1,Math.min(a,o)),this._updateDrawingBufferSize(),this.device.props.onResize(this,{oldPixelSize:i})}_updateDrawingBufferSize(){if(this.props.autoResize){if(typeof this.props.useDevicePixels=="number"){const e=this.props.useDevicePixels;this.setDrawingBufferSize(this.cssWidth*e,this.cssHeight*e)}else this.props.useDevicePixels?this.setDrawingBufferSize(this.devicePixelWidth,this.devicePixelHeight):this.setDrawingBufferSize(this.cssWidth,this.cssHeight);this._updateDevice()}this._initializedResolvers.resolve(),this.isInitialized=!0,this.updatePosition()}_observeDevicePixelRatio(){const e=this.devicePixelRatio;this.devicePixelRatio=window.devicePixelRatio,this.updatePosition(),this.device.props.onDevicePixelRatioChange(this,{oldRatio:e}),matchMedia(`(resolution: ${this.devicePixelRatio}dppx)`).addEventListener("change",()=>this._observeDevicePixelRatio(),{once:!0})}_trackPosition(e=100){const t=setInterval(()=>{this.destroyed?clearInterval(t):this.updatePosition()},e)}updatePosition(){const e=this.htmlCanvas?.getBoundingClientRect();if(e){const t=[e.left,e.top];if(this._position??=t,t[0]!==this._position[0]||t[1]!==this._position[1]){const n=this._position;this._position=t,this.device.props.onPositionChange?.(this,{oldPosition:n})}}}}function fQ(r){if(typeof r=="string"){const e=document.getElementById(r);if(!e)throw new Error(`${r} is not an HTML element`);return e}return r||document.body}function dQ(r){const e=document.getElementById(r);if(!Fm.isHTMLCanvas(e))throw new Error("Object is not a canvas element");return e}function pQ(r){const{width:e,height:t}=r,i=document.createElement("canvas");i.id=pC("lumagl-auto-created-canvas"),i.width=e||1,i.height=t||1,i.style.width=Number.isFinite(e)?`${e}px`:"100%",i.style.height=Number.isFinite(t)?`${t}px`:"100%",r?.visible||(i.style.visibility="hidden");const n=fQ(r?.container||null);return n.insertBefore(i,n.firstChild),i}function gQ(r,e,t,i,n){const a=r,s=wN(a[0],e,t);let o=SN(a[1],e,i,n),l=wN(a[0]+1,e,t);const c=l===t-1?l:l-1;l=SN(a[1]+1,e,i,n);let f;return n?(l=l===0?l:l+1,f=o,o=l):f=l===i-1?l:l-1,{x:s,y:o,width:Math.max(c-s+1,1),height:Math.max(f-o+1,1)}}function wN(r,e,t){return Math.min(Math.round(r*e),t-1)}function SN(r,e,t,i){return i?Math.max(0,t-1-Math.round(r*e)):Math.min(Math.round(r*e),t-1)}class uy extends Cn{static defaultProps={...Cn.defaultProps,type:"color-sampler",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge",addressModeW:"clamp-to-edge",magFilter:"nearest",minFilter:"nearest",mipmapFilter:"none",lodMinClamp:0,lodMaxClamp:32,compare:"less-equal",maxAnisotropy:1};get[Symbol.toStringTag](){return"Sampler"}constructor(e,t){t=uy.normalizeProps(e,t),super(e,t,uy.defaultProps)}static normalizeProps(e,t){return t}}const vQ={"1d":"1d","2d":"2d","2d-array":"2d",cube:"2d","cube-array":"2d","3d":"3d"};class lo extends Cn{static SAMPLE=4;static STORAGE=8;static RENDER=16;static COPY_SRC=1;static COPY_DST=2;static TEXTURE=4;static RENDER_ATTACHMENT=16;dimension;baseDimension;format;width;height;depth;mipLevels;updateTimestamp;get[Symbol.toStringTag](){return"Texture"}toString(){return`Texture(${this.id},${this.format},${this.width}x${this.height})`}constructor(e,t){if(t=lo.normalizeProps(e,t),super(e,t,lo.defaultProps),this.dimension=this.props.dimension,this.baseDimension=vQ[this.dimension],this.format=this.props.format,this.width=this.props.width,this.height=this.props.height,this.depth=this.props.depth,this.mipLevels=this.props.mipLevels,this.props.width===void 0||this.props.height===void 0)if(e.isExternalImage(t.data)){const i=e.getExternalImageSize(t.data);this.width=i?.width||1,this.height=i?.height||1}else this.width=1,this.height=1,(this.props.width===void 0||this.props.height===void 0)&&Nt.warn(`${this} created with undefined width or height. This is deprecated. Use AsyncTexture instead.`)();this.updateTimestamp=e.incrementTimestamp()}setSampler(e){this.sampler=e instanceof uy?e:this.device.createSampler(e)}clone(e){return this.device.createTexture({...this.props,...e})}static normalizeProps(e,t){const i={...t},{width:n,height:a}=i;return typeof n=="number"&&(i.width=Math.max(1,Math.ceil(n))),typeof a=="number"&&(i.height=Math.max(1,Math.ceil(a))),i}_initializeData(e){this.device.isExternalImage(e)?this.copyExternalImage({image:e,width:this.width,height:this.height,depth:this.depth,mipLevel:0,x:0,y:0,z:0,aspect:"all",colorSpace:"srgb",premultipliedAlpha:!1,flipY:!1}):e&&this.copyImageData({data:e,mipLevel:0,x:0,y:0,z:0,aspect:"all"})}_normalizeCopyImageDataOptions(e){const{width:t,height:i,depth:n}=this,a={...lo.defaultCopyDataOptions,width:t,height:i,depth:n,...e},s=this.device.getTextureFormatInfo(this.format);if(!e.bytesPerRow&&!s.bytesPerPixel)throw new Error(`bytesPerRow must be provided for texture format ${this.format}`);return a.bytesPerRow=e.bytesPerRow||t*(s.bytesPerPixel||4),a.rowsPerImage=e.rowsPerImage||i,a}_normalizeCopyExternalImageOptions(e){const t=this.device.getExternalImageSize(e.image),i={...lo.defaultCopyExternalImageOptions,...t,...e};return i.width=Math.min(i.width,this.width-i.x),i.height=Math.min(i.height,this.height-i.y),i}static defaultProps={...Cn.defaultProps,data:null,dimension:"2d",format:"rgba8unorm",usage:lo.TEXTURE|lo.RENDER_ATTACHMENT|lo.COPY_DST,width:void 0,height:void 0,depth:1,mipLevels:1,samples:void 0,sampler:{},view:void 0};static defaultCopyDataOptions={data:void 0,byteOffset:0,bytesPerRow:void 0,rowsPerImage:void 0,mipLevel:0,x:0,y:0,z:0,aspect:"all"};static defaultCopyExternalImageOptions={image:void 0,sourceX:0,sourceY:0,width:void 0,height:void 0,depth:1,mipLevel:0,x:0,y:0,z:0,aspect:"all",colorSpace:"srgb",premultipliedAlpha:!1,flipY:!1}}class gC extends Cn{get[Symbol.toStringTag](){return"TextureView"}constructor(e,t){super(e,t,gC.defaultProps)}static defaultProps={...Cn.defaultProps,format:void 0,dimension:void 0,aspect:"all",baseMipLevel:0,mipLevelCount:void 0,baseArrayLayer:0,arrayLayerCount:void 0}}function mQ(r,e,t){let i="";const n=e.split(/\r?\n/),a=r.slice().sort((s,o)=>s.lineNum-o.lineNum);switch(t?.showSourceCode||"no"){case"all":let s=0;for(let o=1;o<=n.length;o++)for(i+=X8(n[o-1],o,t);a.length>s&&a[s].lineNum===o;){const l=a[s++];i+=GM(l,n,l.lineNum,{...t,inlineSource:!1})}for(;a.length>s;){const o=a[s++];i+=GM(o,[],0,{...t,inlineSource:!1})}return i;case"issues":case"no":for(const o of r)i+=GM(o,n,o.lineNum,{inlineSource:t?.showSourceCode!=="no"});return i}}function GM(r,e,t,i){if(i?.inlineSource){const a=yQ(e,t),s=r.linePos>0?`${" ".repeat(r.linePos+5)}^^^
`:"";return`
${a}${s}${r.type.toUpperCase()}: ${r.message}

`}const n=r.type==="error"?"red":"#8B4000";return i?.html?`<div class='luma-compiler-log-error' style="color:${n};"><b> ${r.type.toUpperCase()}: ${r.message}</b></div>`:`${r.type.toUpperCase()}: ${r.message}`}function yQ(r,e,t){let i="";for(let n=e-2;n<=e;n++){const a=r[n-1];a!==void 0&&(i+=X8(a,e,t))}return i}function X8(r,e,t){const i=t?.html?bQ(r):r;return`${_Q(String(e),4)}: ${i}${t?.html?"<br/>":`
`}`}function _Q(r,e){let t="";for(let i=r.length;i<e;++i)t+=" ";return t+r}function bQ(r){return r.replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;").replaceAll('"',"&quot;").replaceAll("'","&#039;")}class vC extends Cn{get[Symbol.toStringTag](){return"Shader"}stage;source;compilationStatus="pending";constructor(e,t){t={...t,debugShaders:t.debugShaders||e.props.debugShaders||"errors"},super(e,{id:xQ(t),...t},vC.defaultProps),this.stage=this.props.stage,this.source=this.props.source}getCompilationInfoSync(){return null}getTranslatedSource(){return null}async debugShader(){const e=this.props.debugShaders;switch(e){case"never":return;case"errors":if(this.compilationStatus==="success")return;break}const t=await this.getCompilationInfo();e==="warnings"&&t?.length===0||this._displayShaderLog(t,this.id)}_displayShaderLog(e,t){if(typeof document>"u"||!document?.createElement)return;const i=t,n=`${this.stage} shader "${i}"`;let a=mQ(e,this.source,{showSourceCode:"all",html:!0});const s=this.getTranslatedSource();s&&(a+=`<br /><br /><h1>Translated Source</h1><br /><br /><code style="user-select:text;"><pre>${s}</pre></code>`);const o=document.createElement("Button");o.innerHTML=`
<h1>Compilation error in ${n}</h1><br /><br />
<code style="user-select:text;"><pre>
${a}
</pre></code>`,o.style.top="10px",o.style.left="10px",o.style.position="absolute",o.style.zIndex="9999",o.style.width="100%",o.style.textAlign="left",document.body.appendChild(o),document.getElementsByClassName("luma-compiler-log-error")[0]?.scrollIntoView(),o.onclick=()=>{const c=`data:text/plain,${encodeURIComponent(this.source)}`;navigator.clipboard.writeText(c)}}static defaultProps={...Cn.defaultProps,language:"auto",stage:void 0,source:"",sourceMap:null,entryPoint:"main",debugShaders:void 0}}function xQ(r){return wQ(r.source)||r.id||pC(`unnamed ${r.stage}-shader`)}function wQ(r,e="unnamed"){const i=/#define[\s*]SHADER_NAME[\s*]([A-Za-z0-9_-]+)[\s*]/.exec(r);return i?i[1]:e}class mC extends Cn{get[Symbol.toStringTag](){return"Framebuffer"}width;height;constructor(e,t={}){super(e,t,mC.defaultProps),this.width=this.props.width,this.height=this.props.height}clone(e){const t=this.colorAttachments.map(n=>n.texture.clone(e)),i=this.depthStencilAttachment&&this.depthStencilAttachment.texture.clone(e);return this.device.createFramebuffer({...this.props,colorAttachments:t,depthStencilAttachment:i})}resize(e){let t=!e;if(e){const[i,n]=Array.isArray(e)?e:[e.width,e.height];t=t||n!==this.height||i!==this.width,this.width=i,this.height=n}t&&(Nt.log(2,`Resizing framebuffer ${this.id} to ${this.width}x${this.height}`)(),this.resizeAttachments(this.width,this.height))}autoCreateAttachmentTextures(){if(this.props.colorAttachments.length===0&&!this.props.depthStencilAttachment)throw new Error("Framebuffer has noattachments");this.colorAttachments=this.props.colorAttachments.map((t,i)=>{if(typeof t=="string"){const n=this.createColorTexture(t,i);return this.attachResource(n),n.view}return t instanceof lo?t.view:t});const e=this.props.depthStencilAttachment;if(e)if(typeof e=="string"){const t=this.createDepthStencilTexture(e);this.attachResource(t),this.depthStencilAttachment=t.view}else e instanceof lo?this.depthStencilAttachment=e.view:this.depthStencilAttachment=e}createColorTexture(e,t){return this.device.createTexture({id:`${this.id}-color-attachment-${t}`,usage:lo.RENDER_ATTACHMENT,format:e,width:this.width,height:this.height,sampler:{magFilter:"linear",minFilter:"linear"}})}createDepthStencilTexture(e){return this.device.createTexture({id:`${this.id}-depth-stencil-attachment`,usage:lo.RENDER_ATTACHMENT,format:e,width:this.width,height:this.height})}resizeAttachments(e,t){for(let i=0;i<this.colorAttachments.length;++i)if(this.colorAttachments[i]){const n=this.colorAttachments[i].texture.clone({width:e,height:t});this.destroyAttachedResource(this.colorAttachments[i]),this.colorAttachments[i]=n.view,this.attachResource(n.view)}if(this.depthStencilAttachment){const i=this.depthStencilAttachment.texture.clone({width:e,height:t});this.destroyAttachedResource(this.depthStencilAttachment),this.depthStencilAttachment=i.view,this.attachResource(i)}this.updateAttachments()}static defaultProps={...Cn.defaultProps,width:1,height:1,colorAttachments:[],depthStencilAttachment:null}}class Ym extends Cn{get[Symbol.toStringTag](){return"RenderPipeline"}shaderLayout;bufferLayout;linkStatus="pending";hash="";constructor(e,t){super(e,t,Ym.defaultProps),this.shaderLayout=this.props.shaderLayout,this.bufferLayout=this.props.bufferLayout||[]}static defaultProps={...Cn.defaultProps,vs:null,vertexEntryPoint:"vertexMain",vsConstants:{},fs:null,fragmentEntryPoint:"fragmentMain",fsConstants:{},shaderLayout:null,bufferLayout:[],topology:"triangle-list",colorAttachmentFormats:void 0,depthStencilAttachmentFormat:void 0,parameters:{},bindings:{},uniforms:{}}}class km extends Cn{static defaultClearColor=[0,0,0,1];static defaultClearDepth=1;static defaultClearStencil=0;get[Symbol.toStringTag](){return"RenderPass"}constructor(e,t){t=km.normalizeProps(e,t),super(e,t,km.defaultProps)}static normalizeProps(e,t){return t}static defaultProps={...Cn.defaultProps,framebuffer:null,parameters:void 0,clearColor:km.defaultClearColor,clearColors:void 0,clearDepth:km.defaultClearDepth,clearStencil:km.defaultClearStencil,depthReadOnly:!1,stencilReadOnly:!1,discard:!1,occlusionQuerySet:void 0,timestampQuerySet:void 0,beginTimestampIndex:void 0,endTimestampIndex:void 0}}class eA extends Cn{get[Symbol.toStringTag](){return"ComputePipeline"}hash="";shaderLayout;constructor(e,t){super(e,t,eA.defaultProps),this.shaderLayout=t.shaderLayout}static defaultProps={...Cn.defaultProps,shader:void 0,entryPoint:void 0,constants:{},shaderLayout:void 0}}class PD extends Cn{get[Symbol.toStringTag](){return"CommandEncoder"}constructor(e,t){super(e,t,PD.defaultProps)}static defaultProps={...Cn.defaultProps,measureExecutionTime:void 0}}class RD extends Cn{get[Symbol.toStringTag](){return"CommandBuffer"}constructor(e,t){super(e,t,RD.defaultProps)}static defaultProps={...Cn.defaultProps}}function Z8(r){return CQ[r]}function SQ(r){const[e,t]=AQ[r],i=e==="i32"||e==="u32",n=e!=="u32",a=TQ[e]*t;return{primitiveType:e,components:t,byteLength:a,integer:i,signed:n}}const TQ={f32:4,f16:2,i32:4,u32:4},AQ={f32:["f32",1],"vec2<f32>":["f32",2],"vec3<f32>":["f32",3],"vec4<f32>":["f32",4],f16:["f16",1],"vec2<f16>":["f16",2],"vec3<f16>":["f16",3],"vec4<f16>":["f16",4],i32:["i32",1],"vec2<i32>":["i32",2],"vec3<i32>":["i32",3],"vec4<i32>":["i32",4],u32:["u32",1],"vec2<u32>":["u32",2],"vec3<u32>":["u32",3],"vec4<u32>":["u32",4]},CQ={f32:{type:"f32",components:1},f16:{type:"f16",components:1},i32:{type:"i32",components:1},u32:{type:"u32",components:1},"vec2<f32>":{type:"f32",components:2},"vec3<f32>":{type:"f32",components:3},"vec4<f32>":{type:"f32",components:4},"vec2<f16>":{type:"f16",components:2},"vec3<f16>":{type:"f16",components:3},"vec4<f16>":{type:"f16",components:4},"vec2<i32>":{type:"i32",components:2},"vec3<i32>":{type:"i32",components:3},"vec4<i32>":{type:"i32",components:4},"vec2<u32>":{type:"u32",components:2},"vec3<u32>":{type:"u32",components:3},"vec4<u32>":{type:"u32",components:4},"mat2x2<f32>":{type:"f32",components:4},"mat2x3<f32>":{type:"f32",components:6},"mat2x4<f32>":{type:"f32",components:8},"mat3x2<f32>":{type:"f32",components:6},"mat3x3<f32>":{type:"f32",components:9},"mat3x4<f32>":{type:"f32",components:12},"mat4x2<f32>":{type:"f32",components:8},"mat4x3<f32>":{type:"f32",components:12},"mat4x4<f32>":{type:"f32",components:16},"mat2x2<f16>":{type:"f16",components:4},"mat2x3<f16>":{type:"f16",components:6},"mat2x4<f16>":{type:"f16",components:8},"mat3x2<f16>":{type:"f16",components:6},"mat3x3<f16>":{type:"f16",components:9},"mat3x4<f16>":{type:"f16",components:12},"mat4x2<f16>":{type:"f16",components:8},"mat4x3<f16>":{type:"f16",components:12},"mat4x4<f16>":{type:"f16",components:16},"mat2x2<i32>":{type:"i32",components:4},"mat2x3<i32>":{type:"i32",components:6},"mat2x4<i32>":{type:"i32",components:8},"mat3x2<i32>":{type:"i32",components:6},"mat3x3<i32>":{type:"i32",components:9},"mat3x4<i32>":{type:"i32",components:12},"mat4x2<i32>":{type:"i32",components:8},"mat4x3<i32>":{type:"i32",components:12},"mat4x4<i32>":{type:"i32",components:16},"mat2x2<u32>":{type:"u32",components:4},"mat2x3<u32>":{type:"u32",components:6},"mat2x4<u32>":{type:"u32",components:8},"mat3x2<u32>":{type:"u32",components:6},"mat3x3<u32>":{type:"u32",components:9},"mat3x4<u32>":{type:"u32",components:12},"mat4x2<u32>":{type:"u32",components:8},"mat4x3<u32>":{type:"u32",components:12},"mat4x4<u32>":{type:"u32",components:16}};function q8(r,e){const t={};for(const i of r.attributes){const n=EQ(r,e,i.name);n&&(t[i.name]=n)}return t}function MQ(r,e,t=16){const i=q8(r,e),n=new Array(t).fill(null);for(const a of Object.values(i))n[a.location]=a;return n}function EQ(r,e,t){const i=IQ(r,t),n=PQ(e,t);if(!i)return null;const a=SQ(i.type),s=WK(a),o=n?.vertexFormat||s,l=ID(o);return{attributeName:n?.attributeName||i.name,bufferName:n?.bufferName||i.name,location:i.location,shaderType:i.type,primitiveType:a.primitiveType,shaderComponents:a.components,vertexFormat:o,bufferDataType:l.type,bufferComponents:l.components,normalized:l.normalized,integer:a.integer,stepMode:n?.stepMode||i.stepMode||"vertex",byteOffset:n?.byteOffset||0,byteStride:n?.byteStride||0}}function IQ(r,e){const t=r.attributes.find(i=>i.name===e);return t||Nt.warn(`shader layout attribute "${e}" not present in shader`),t||null}function PQ(r,e){RQ(r);let t=DQ(r,e);return t||(t=kQ(r,e),t)?t:(Nt.warn(`layout for attribute "${e}" not present in buffer layout`),null)}function RQ(r){for(const e of r)(e.attributes&&e.format||!e.attributes&&!e.format)&&Nt.warn(`BufferLayout ${name} must have either 'attributes' or 'format' field`)}function DQ(r,e){for(const t of r)if(t.format&&t.name===e)return{attributeName:t.name,bufferName:e,stepMode:t.stepMode,vertexFormat:t.format,byteOffset:0,byteStride:t.byteStride||0};return null}function kQ(r,e){for(const t of r){let i=t.byteStride;if(typeof t.byteStride!="number")for(const a of t.attributes||[]){const s=ID(a.format);i+=s.byteLength}const n=t.attributes?.find(a=>a.attribute===e);if(n)return{attributeName:n.attribute,bufferName:t.name,stepMode:t.stepMode,vertexFormat:n.format,byteOffset:n.byteOffset,byteStride:i}}return null}class DD extends Cn{static defaultProps={...Cn.defaultProps,shaderLayout:void 0,bufferLayout:[]};get[Symbol.toStringTag](){return"VertexArray"}maxVertexAttributes;attributeInfos;indexBuffer=null;attributes;constructor(e,t){super(e,t,DD.defaultProps),this.maxVertexAttributes=e.limits.maxVertexAttributes,this.attributes=new Array(this.maxVertexAttributes).fill(null),this.attributeInfos=MQ(t.shaderLayout,t.bufferLayout,this.maxVertexAttributes)}setConstantWebGL(e,t){this.device.reportError(new Error("constant attributes not supported"),this)()}}class kD extends Cn{static defaultProps={...Cn.defaultProps,layout:void 0,buffers:{}};get[Symbol.toStringTag](){return"TransformFeedback"}constructor(e,t){super(e,t,kD.defaultProps)}}class LD extends Cn{get[Symbol.toStringTag](){return"QuerySet"}constructor(e,t){super(e,t,LD.defaultProps)}static defaultProps={...Cn.defaultProps,type:void 0,count:void 0}}let rT;function Y8(r){return(!rT||rT.byteLength<r)&&(rT=new ArrayBuffer(r)),rT}function LQ(r,e){const t=Y8(r.BYTES_PER_ELEMENT*e);return new r(t,0,e)}function OQ(r){return ArrayBuffer.isView(r)&&!(r instanceof DataView)}function tA(r){return Array.isArray(r)?r.length===0||typeof r[0]=="number":OQ(r)}const NQ=1024;class BQ{layout={};byteLength;constructor(e,t={}){let i=0;for(const[a,s]of Object.entries(e)){const o=Z8(s),{type:l,components:c}=o,f=c*(t?.[a]??1);i=HK(i,f);const p=i;i+=f,this.layout[a]={type:l,size:f,offset:p}}i+=(4-i%4)%4;const n=i*4;this.byteLength=Math.max(n,NQ)}getData(e){const t=Y8(this.byteLength),i={i32:new Int32Array(t),u32:new Uint32Array(t),f32:new Float32Array(t),f16:new Uint16Array(t)};for(const[n,a]of Object.entries(e)){const s=this.layout[n];if(!s){Nt.warn(`Supplied uniform value ${n} not present in uniform block layout`)();continue}const{type:o,size:l,offset:c}=s,f=i[o];if(l===1){if(typeof a!="number"&&typeof a!="boolean"){Nt.warn(`Supplied value for single component uniform ${n} is not a number: ${a}`)();continue}f[c]=Number(a)}else{if(!tA(a)){Nt.warn(`Supplied value for multi component / array uniform ${n} is not a numeric array: ${a}`)();continue}f.set(a,c)}}return new Uint8Array(t,0,this.byteLength)}has(e){return!!this.layout[e]}get(e){return this.layout[e]}}function zQ(r,e,t=16){if(r!==e)return!1;const i=r,n=e;if(!tA(i))return!1;if(tA(n)&&i.length===n.length){for(let a=0;a<i.length;++a)if(n[a]!==i[a])return!1}return!0}function FQ(r){return tA(r)?r.slice():r}class VQ{name;uniforms={};modifiedUniforms={};modified=!0;bindingLayout={};needsRedraw="initialized";constructor(e){if(this.name=e?.name||"unnamed",e?.name&&e?.shaderLayout){const t=e?.shaderLayout.bindings?.find(n=>n.type==="uniform"&&n.name===e?.name);if(!t)throw new Error(e?.name);const i=t;for(const n of i.uniforms||[])this.bindingLayout[n.name]=n}}setUniforms(e){for(const[t,i]of Object.entries(e))this._setUniform(t,i),this.needsRedraw||this.setNeedsRedraw(`${this.name}.${t}=${i}`)}setNeedsRedraw(e){this.needsRedraw=this.needsRedraw||e}getAllUniforms(){return this.modifiedUniforms={},this.needsRedraw=!1,this.uniforms||{}}_setUniform(e,t){zQ(this.uniforms[e],t)||(this.uniforms[e]=FQ(t),this.modifiedUniforms[e]=!0,this.modified=!0)}}class UQ{uniformBlocks=new Map;uniformBufferLayouts=new Map;uniformBuffers=new Map;constructor(e){for(const[t,i]of Object.entries(e)){const n=t,a=new BQ(i.uniformTypes??{},i.uniformSizes??{});this.uniformBufferLayouts.set(n,a);const s=new VQ({name:t});s.setUniforms(i.defaultUniforms||{}),this.uniformBlocks.set(n,s)}}destroy(){for(const e of this.uniformBuffers.values())e.destroy()}setUniforms(e){for(const[t,i]of Object.entries(e))this.uniformBlocks.get(t)?.setUniforms(i);this.updateUniformBuffers()}getUniformBufferByteLength(e){return this.uniformBufferLayouts.get(e)?.byteLength||0}getUniformBufferData(e){const t=this.uniformBlocks.get(e)?.getAllUniforms()||{};return this.uniformBufferLayouts.get(e)?.getData(t)}createUniformBuffer(e,t,i){i&&this.setUniforms(i);const n=this.getUniformBufferByteLength(t),a=e.createBuffer({usage:ua.UNIFORM|ua.COPY_DST,byteLength:n}),s=this.getUniformBufferData(t);return a.write(s),a}getManagedUniformBuffer(e,t){if(!this.uniformBuffers.get(t)){const i=this.getUniformBufferByteLength(t),n=e.createBuffer({usage:ua.UNIFORM|ua.COPY_DST,byteLength:i});this.uniformBuffers.set(t,n)}return this.uniformBuffers.get(t)}updateUniformBuffers(){let e=!1;for(const t of this.uniformBlocks.keys()){const i=this.updateUniformBuffer(t);e||=i}return e&&Nt.log(3,`UniformStore.updateUniformBuffers(): ${e}`)(),e}updateUniformBuffer(e){const t=this.uniformBlocks.get(e);let i=this.uniformBuffers.get(e),n=!1;if(i&&t?.needsRedraw){n||=t.needsRedraw;const a=this.getUniformBufferData(e);i=this.uniformBuffers.get(e),i?.write(a);const s=this.uniformBlocks.get(e)?.getAllUniforms();Nt.log(4,`Writing to uniform buffer ${String(e)}`,a,s)()}return n}}let yc=class{constructor(e,t){this.name=e,this.attributes=t,this.size=0}get isArray(){return!1}get isStruct(){return!1}get isTemplate(){return!1}get isPointer(){return!1}getTypeName(){return this.name}};class TN{constructor(e,t,i){this.name=e,this.type=t,this.attributes=i,this.offset=0,this.size=0}get isArray(){return this.type.isArray}get isStruct(){return this.type.isStruct}get isTemplate(){return this.type.isTemplate}get align(){return this.type.isStruct?this.type.align:0}get members(){return this.type.isStruct?this.type.members:null}get format(){return this.type.isArray||this.type.isTemplate?this.type.format:null}get count(){return this.type.isArray?this.type.count:0}get stride(){return this.type.isArray?this.type.stride:this.size}}class wg extends yc{constructor(e,t){super(e,t),this.members=[],this.align=0,this.startLine=-1,this.endLine=-1,this.inUse=!1}get isStruct(){return!0}}class Dg extends yc{constructor(e,t){super(e,t),this.count=0,this.stride=0}get isArray(){return!0}getTypeName(){return`array<${this.format.getTypeName()}, ${this.count}>`}}class eR extends yc{constructor(e,t,i){super(e,i),this.format=t}get isPointer(){return!0}getTypeName(){return`&${this.format.getTypeName()}`}}class cy extends yc{constructor(e,t,i,n){super(e,i),this.format=t,this.access=n}get isTemplate(){return!0}getTypeName(){let e=this.name;if(this.format!==null){if(e==="vec2"||e==="vec3"||e==="vec4"||e==="mat2x2"||e==="mat2x3"||e==="mat2x4"||e==="mat3x2"||e==="mat3x3"||e==="mat3x4"||e==="mat4x2"||e==="mat4x3"||e==="mat4x4"){if(this.format.name==="f32")return e+="f",e;if(this.format.name==="i32")return e+="i",e;if(this.format.name==="u32")return e+="u",e;if(this.format.name==="bool")return e+="b",e;if(this.format.name==="f16")return e+="h",e}e+=`<${this.format.name}>`}else if(e==="vec2"||e==="vec3"||e==="vec4")return e;return e}}var yg;(r=>{r[r.Uniform=0]="Uniform",r[r.Storage=1]="Storage",r[r.Texture=2]="Texture",r[r.Sampler=3]="Sampler",r[r.StorageTexture=4]="StorageTexture"})(yg||(yg={}));class iT{constructor(e,t,i,n,a,s,o){this.name=e,this.type=t,this.group=i,this.binding=n,this.attributes=a,this.resourceType=s,this.access=o}get isArray(){return this.type.isArray}get isStruct(){return this.type.isStruct}get isTemplate(){return this.type.isTemplate}get size(){return this.type.size}get align(){return this.type.isStruct?this.type.align:0}get members(){return this.type.isStruct?this.type.members:null}get format(){return this.type.isArray||this.type.isTemplate?this.type.format:null}get count(){return this.type.isArray?this.type.count:0}get stride(){return this.type.isArray?this.type.stride:this.size}}class HQ{constructor(e,t){this.name=e,this.type=t}}class jQ{constructor(e,t,i,n){this.name=e,this.type=t,this.locationType=i,this.location=n,this.interpolation=null}}class AN{constructor(e,t,i,n){this.name=e,this.type=t,this.locationType=i,this.location=n}}class $Q{constructor(e,t,i,n){this.name=e,this.type=t,this.attributes=i,this.id=n}}class WQ{constructor(e,t,i){this.name=e,this.type=t,this.attributes=i}}class GQ{constructor(e,t=null,i){this.stage=null,this.inputs=[],this.outputs=[],this.arguments=[],this.returnType=null,this.resources=[],this.overrides=[],this.startLine=-1,this.endLine=-1,this.inUse=!1,this.calls=new Set,this.name=e,this.stage=t,this.attributes=i}}class XQ{constructor(){this.vertex=[],this.fragment=[],this.compute=[]}}function ZQ(r){var e=(32768&r)>>15,t=(31744&r)>>10,i=1023&r;return t==0?(e?-1:1)*Math.pow(2,-14)*(i/Math.pow(2,10)):t==31?i?NaN:1/0*(e?-1:1):(e?-1:1)*Math.pow(2,t-15)*(1+i/Math.pow(2,10))}const K8=new Float32Array(1),qQ=new Int32Array(K8.buffer),bs=new Uint16Array(1);function YQ(r){K8[0]=r;const e=qQ[0],t=e>>31&1;let i=e>>23&255,n=8388607&e;if(i===255)return bs[0]=t<<15|31744|(n!==0?512:0),bs[0];if(i===0){if(n===0)return bs[0]=t<<15,bs[0];n|=8388608;let a=113;for(;!(8388608&n);)n<<=1,a--;return i=127-a,n&=8388607,i>0?(n=(n>>126-i)+(n>>127-i&1),bs[0]=t<<15|i<<10|n>>13,bs[0]):(bs[0]=t<<15,bs[0])}return i=i-127+15,i>=31?(bs[0]=t<<15|31744,bs[0]):i<=0?i<-10?(bs[0]=t<<15,bs[0]):(n=(8388608|n)>>1-i,bs[0]=t<<15|n>>13,bs[0]):(n>>=13,bs[0]=t<<15|i<<10|n,bs[0])}const OD=new Uint32Array(1),Q8=new Float32Array(OD.buffer,0,1);function CN(r){const e=112+(r>>6&31)<<23|(63&r)<<17;return OD[0]=e,Q8[0]}function KQ(r,e,t,i,n,a,s,o,l){const c=i*(s>>=n)*(a>>=n)+t*s+e*o;switch(l){case"r8unorm":return[tn(r,c,"8unorm",1)[0]];case"r8snorm":return[tn(r,c,"8snorm",1)[0]];case"r8uint":return[tn(r,c,"8uint",1)[0]];case"r8sint":return[tn(r,c,"8sint",1)[0]];case"rg8unorm":{const f=tn(r,c,"8unorm",2);return[f[0],f[1]]}case"rg8snorm":{const f=tn(r,c,"8snorm",2);return[f[0],f[1]]}case"rg8uint":{const f=tn(r,c,"8uint",2);return[f[0],f[1]]}case"rg8sint":{const f=tn(r,c,"8sint",2);return[f[0],f[1]]}case"rgba8unorm-srgb":case"rgba8unorm":{const f=tn(r,c,"8unorm",4);return[f[0],f[1],f[2],f[3]]}case"rgba8snorm":{const f=tn(r,c,"8snorm",4);return[f[0],f[1],f[2],f[3]]}case"rgba8uint":{const f=tn(r,c,"8uint",4);return[f[0],f[1],f[2],f[3]]}case"rgba8sint":{const f=tn(r,c,"8sint",4);return[f[0],f[1],f[2],f[3]]}case"bgra8unorm-srgb":case"bgra8unorm":{const f=tn(r,c,"8unorm",4);return[f[2],f[1],f[0],f[3]]}case"r16uint":return[tn(r,c,"16uint",1)[0]];case"r16sint":return[tn(r,c,"16sint",1)[0]];case"r16float":return[tn(r,c,"16float",1)[0]];case"rg16uint":{const f=tn(r,c,"16uint",2);return[f[0],f[1]]}case"rg16sint":{const f=tn(r,c,"16sint",2);return[f[0],f[1]]}case"rg16float":{const f=tn(r,c,"16float",2);return[f[0],f[1]]}case"rgba16uint":{const f=tn(r,c,"16uint",4);return[f[0],f[1],f[2],f[3]]}case"rgba16sint":{const f=tn(r,c,"16sint",4);return[f[0],f[1],f[2],f[3]]}case"rgba16float":{const f=tn(r,c,"16float",4);return[f[0],f[1],f[2],f[3]]}case"r32uint":return[tn(r,c,"32uint",1)[0]];case"r32sint":return[tn(r,c,"32sint",1)[0]];case"depth16unorm":case"depth24plus":case"depth24plus-stencil8":case"depth32float":case"depth32float-stencil8":case"r32float":return[tn(r,c,"32float",1)[0]];case"rg32uint":{const f=tn(r,c,"32uint",2);return[f[0],f[1]]}case"rg32sint":{const f=tn(r,c,"32sint",2);return[f[0],f[1]]}case"rg32float":{const f=tn(r,c,"32float",2);return[f[0],f[1]]}case"rgba32uint":{const f=tn(r,c,"32uint",4);return[f[0],f[1],f[2],f[3]]}case"rgba32sint":{const f=tn(r,c,"32sint",4);return[f[0],f[1],f[2],f[3]]}case"rgba32float":{const f=tn(r,c,"32float",4);return[f[0],f[1],f[2],f[3]]}case"rg11b10ufloat":{const f=new Uint32Array(r.buffer,c,1)[0],p=(4192256&f)>>11,y=(4290772992&f)>>22;return[CN(2047&f),CN(p),(function(b){const S=112+(b>>5&31)<<23|(31&b)<<18;return OD[0]=S,Q8[0]})(y),1]}}return null}function tn(r,e,t,i){const n=[0,0,0,0];for(let a=0;a<i;++a)switch(t){case"8unorm":n[a]=r[e]/255,e++;break;case"8snorm":n[a]=r[e]/255*2-1,e++;break;case"8uint":n[a]=r[e],e++;break;case"8sint":n[a]=r[e]-127,e++;break;case"16uint":n[a]=r[e]|r[e+1]<<8,e+=2;break;case"16sint":n[a]=(r[e]|r[e+1]<<8)-32768,e+=2;break;case"16float":n[a]=ZQ(r[e]|r[e+1]<<8),e+=2;break;case"32uint":case"32sint":n[a]=r[e]|r[e+1]<<8|r[e+2]<<16|r[e+3]<<24,e+=4;break;case"32float":n[a]=new Float32Array(r.buffer,e,1)[0],e+=4}return n}function ln(r,e,t,i,n){for(let a=0;a<i;++a)switch(t){case"8unorm":r[e]=255*n[a],e++;break;case"8snorm":r[e]=.5*(n[a]+1)*255,e++;break;case"8uint":r[e]=n[a],e++;break;case"8sint":r[e]=n[a]+127,e++;break;case"16uint":new Uint16Array(r.buffer,e,1)[0]=n[a],e+=2;break;case"16sint":new Int16Array(r.buffer,e,1)[0]=n[a],e+=2;break;case"16float":{const s=YQ(n[a]);new Uint16Array(r.buffer,e,1)[0]=s,e+=2;break}case"32uint":new Uint32Array(r.buffer,e,1)[0]=n[a],e+=4;break;case"32sint":new Int32Array(r.buffer,e,1)[0]=n[a],e+=4;break;case"32float":new Float32Array(r.buffer,e,1)[0]=n[a],e+=4}return n}const XM={r8unorm:{bytesPerBlock:1,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r8snorm:{bytesPerBlock:1,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r8uint:{bytesPerBlock:1,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r8sint:{bytesPerBlock:1,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},rg8unorm:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg8snorm:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg8uint:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg8sint:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rgba8unorm:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},"rgba8unorm-srgb":{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba8snorm:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba8uint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba8sint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},bgra8unorm:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},"bgra8unorm-srgb":{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},r16uint:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r16sint:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r16float:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},rg16uint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg16sint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg16float:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rgba16uint:{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba16sint:{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba16float:{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},r32uint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r32sint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r32float:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},rg32uint:{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg32sint:{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg32float:{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rgba32uint:{bytesPerBlock:16,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba32sint:{bytesPerBlock:16,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba32float:{bytesPerBlock:16,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgb10a2uint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgb10a2unorm:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rg11b10ufloat:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},stencil8:{bytesPerBlock:1,blockWidth:1,blockHeight:1,isCompressed:!1,isDepthStencil:!0,hasDepth:!1,hasStencil:!0,channels:1},depth16unorm:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,isDepthStencil:!0,hasDepth:!0,hasStencil:!1,channels:1},depth24plus:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,isDepthStencil:!0,hasDepth:!0,hasStencil:!1,depthOnlyFormat:"depth32float",channels:1},"depth24plus-stencil8":{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,isDepthStencil:!0,hasDepth:!0,hasStencil:!0,depthOnlyFormat:"depth32float",channels:1},depth32float:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,isDepthStencil:!0,hasDepth:!0,hasStencil:!1,channels:1},"depth32float-stencil8":{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,isDepthStencil:!0,hasDepth:!0,hasStencil:!0,stencilOnlyFormat:"depth32float",channels:1},rgb9e5ufloat:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},"bc1-rgba-unorm":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc1-rgba-unorm-srgb":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc2-rgba-unorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc2-rgba-unorm-srgb":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc3-rgba-unorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc3-rgba-unorm-srgb":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc4-r-unorm":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:1},"bc4-r-snorm":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:1},"bc5-rg-unorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:2},"bc5-rg-snorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:2},"bc6h-rgb-ufloat":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc6h-rgb-float":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc7-rgba-unorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc7-rgba-unorm-srgb":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"etc2-rgb8unorm":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"etc2-rgb8unorm-srgb":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"etc2-rgb8a1unorm":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"etc2-rgb8a1unorm-srgb":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"etc2-rgba8unorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"etc2-rgba8unorm-srgb":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"eac-r11unorm":{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!0,channels:1},"eac-r11snorm":{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!0,channels:1},"eac-rg11unorm":{bytesPerBlock:16,blockWidth:1,blockHeight:1,isCompressed:!0,channels:2},"eac-rg11snorm":{bytesPerBlock:16,blockWidth:1,blockHeight:1,isCompressed:!0,channels:2},"astc-4x4-unorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"astc-4x4-unorm-srgb":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"astc-5x4-unorm":{bytesPerBlock:16,blockWidth:5,blockHeight:4,isCompressed:!0,channels:4},"astc-5x4-unorm-srgb":{bytesPerBlock:16,blockWidth:5,blockHeight:4,isCompressed:!0,channels:4},"astc-5x5-unorm":{bytesPerBlock:16,blockWidth:5,blockHeight:5,isCompressed:!0,channels:4},"astc-5x5-unorm-srgb":{bytesPerBlock:16,blockWidth:5,blockHeight:5,isCompressed:!0,channels:4},"astc-6x5-unorm":{bytesPerBlock:16,blockWidth:6,blockHeight:5,isCompressed:!0,channels:4},"astc-6x5-unorm-srgb":{bytesPerBlock:16,blockWidth:6,blockHeight:5,isCompressed:!0,channels:4},"astc-6x6-unorm":{bytesPerBlock:16,blockWidth:6,blockHeight:6,isCompressed:!0,channels:4},"astc-6x6-unorm-srgb":{bytesPerBlock:16,blockWidth:6,blockHeight:6,isCompressed:!0,channels:4},"astc-8x5-unorm":{bytesPerBlock:16,blockWidth:8,blockHeight:5,isCompressed:!0,channels:4},"astc-8x5-unorm-srgb":{bytesPerBlock:16,blockWidth:8,blockHeight:5,isCompressed:!0,channels:4},"astc-8x6-unorm":{bytesPerBlock:16,blockWidth:8,blockHeight:6,isCompressed:!0,channels:4},"astc-8x6-unorm-srgb":{bytesPerBlock:16,blockWidth:8,blockHeight:6,isCompressed:!0,channels:4},"astc-8x8-unorm":{bytesPerBlock:16,blockWidth:8,blockHeight:8,isCompressed:!0,channels:4},"astc-8x8-unorm-srgb":{bytesPerBlock:16,blockWidth:8,blockHeight:8,isCompressed:!0,channels:4},"astc-10x5-unorm":{bytesPerBlock:16,blockWidth:10,blockHeight:5,isCompressed:!0,channels:4},"astc-10x5-unorm-srgb":{bytesPerBlock:16,blockWidth:10,blockHeight:5,isCompressed:!0,channels:4},"astc-10x6-unorm":{bytesPerBlock:16,blockWidth:10,blockHeight:6,isCompressed:!0,channels:4},"astc-10x6-unorm-srgb":{bytesPerBlock:16,blockWidth:10,blockHeight:6,isCompressed:!0,channels:4},"astc-10x8-unorm":{bytesPerBlock:16,blockWidth:10,blockHeight:8,isCompressed:!0,channels:4},"astc-10x8-unorm-srgb":{bytesPerBlock:16,blockWidth:10,blockHeight:8,isCompressed:!0,channels:4},"astc-10x10-unorm":{bytesPerBlock:16,blockWidth:10,blockHeight:10,isCompressed:!0,channels:4},"astc-10x10-unorm-srgb":{bytesPerBlock:16,blockWidth:10,blockHeight:10,isCompressed:!0,channels:4},"astc-12x10-unorm":{bytesPerBlock:16,blockWidth:12,blockHeight:10,isCompressed:!0,channels:4},"astc-12x10-unorm-srgb":{bytesPerBlock:16,blockWidth:12,blockHeight:10,isCompressed:!0,channels:4},"astc-12x12-unorm":{bytesPerBlock:16,blockWidth:12,blockHeight:12,isCompressed:!0,channels:4},"astc-12x12-unorm-srgb":{bytesPerBlock:16,blockWidth:12,blockHeight:12,isCompressed:!0,channels:4}};class Ac{constructor(){this.id=Ac._id++,this.line=0}get isAstNode(){return!0}get astNodeType(){return""}search(e){e(this)}searchBlock(e,t){if(e){t(rA.instance);for(const i of e)i instanceof Array?this.searchBlock(i,t):i.search(t);t(iA.instance)}}constEvaluate(e,t){throw new Error("Cannot evaluate node")}constEvaluateString(e){return this.constEvaluate(e).toString()}}Ac._id=0;class rA extends Ac{}rA.instance=new rA;class iA extends Ac{}iA.instance=new iA;const J8=new Set(["all","all","any","select","arrayLength","abs","acos","acosh","asin","asinh","atan","atanh","atan2","ceil","clamp","cos","cosh","countLeadingZeros","countOneBits","countTrailingZeros","cross","degrees","determinant","distance","dot","dot4U8Packed","dot4I8Packed","exp","exp2","extractBits","faceForward","firstLeadingBit","firstTrailingBit","floor","fma","fract","frexp","insertBits","inverseSqrt","ldexp","length","log","log2","max","min","mix","modf","normalize","pow","quantizeToF16","radians","reflect","refract","reverseBits","round","saturate","sign","sin","sinh","smoothStep","sqrt","step","tan","tanh","transpose","trunc","dpdx","dpdxCoarse","dpdxFine","dpdy","dpdyCoarse","dpdyFine","fwidth","fwidthCoarse","fwidthFine","textureDimensions","textureGather","textureGatherCompare","textureLoad","textureNumLayers","textureNumLevels","textureNumSamples","textureSample","textureSampleBias","textureSampleCompare","textureSampleCompareLevel","textureSampleGrad","textureSampleLevel","textureSampleBaseClampToEdge","textureStore","atomicLoad","atomicStore","atomicAdd","atomicSub","atomicMax","atomicMin","atomicAnd","atomicOr","atomicXor","atomicExchange","atomicCompareExchangeWeak","pack4x8snorm","pack4x8unorm","pack4xI8","pack4xU8","pack4x8Clamp","pack4xU8Clamp","pack2x16snorm","pack2x16unorm","pack2x16float","unpack4x8snorm","unpack4x8unorm","unpack4xI8","unpack4xU8","unpack2x16snorm","unpack2x16unorm","unpack2x16float","storageBarrier","textureBarrier","workgroupBarrier","workgroupUniformLoad","subgroupAdd","subgroupExclusiveAdd","subgroupInclusiveAdd","subgroupAll","subgroupAnd","subgroupAny","subgroupBallot","subgroupBroadcast","subgroupBroadcastFirst","subgroupElect","subgroupMax","subgroupMin","subgroupMul","subgroupExclusiveMul","subgroupInclusiveMul","subgroupOr","subgroupShuffle","subgroupShuffleDown","subgroupShuffleUp","subgroupShuffleXor","subgroupXor","quadBroadcast","quadSwapDiagonal","quadSwapX","quadSwapY"]);class Jn extends Ac{constructor(){super()}}class Q1 extends Jn{constructor(e,t,i,n,a,s){super(),this.calls=new Set,this.name=e,this.args=t,this.returnType=i,this.body=n,this.startLine=a,this.endLine=s}get astNodeType(){return"function"}search(e){if(this.attributes)for(const t of this.attributes)e(t);e(this);for(const t of this.args)e(t);this.searchBlock(this.body,e)}}class QQ extends Jn{constructor(e){super(),this.expression=e}get astNodeType(){return"staticAssert"}search(e){this.expression.search(e)}}class eH extends Jn{constructor(e,t){super(),this.condition=e,this.body=t}get astNodeType(){return"while"}search(e){this.condition.search(e),this.searchBlock(this.body,e)}}class tR extends Jn{constructor(e,t){super(),this.body=e,this.loopId=t}get astNodeType(){return"continuing"}search(e){this.searchBlock(this.body,e)}}class tH extends Jn{constructor(e,t,i,n){super(),this.init=e,this.condition=t,this.increment=i,this.body=n}get astNodeType(){return"for"}search(e){var t,i,n;(t=this.init)===null||t===void 0||t.search(e),(i=this.condition)===null||i===void 0||i.search(e),(n=this.increment)===null||n===void 0||n.search(e),this.searchBlock(this.body,e)}}class ep extends Jn{constructor(e,t,i,n,a){super(),this.attributes=null,this.name=e,this.type=t,this.storage=i,this.access=n,this.value=a}get astNodeType(){return"var"}search(e){var t;e(this),(t=this.value)===null||t===void 0||t.search(e)}}class ND extends Jn{constructor(e,t,i){super(),this.attributes=null,this.name=e,this.type=t,this.value=i}get astNodeType(){return"override"}search(e){var t;(t=this.value)===null||t===void 0||t.search(e)}}class E1 extends Jn{constructor(e,t,i,n,a){super(),this.attributes=null,this.name=e,this.type=t,this.storage=i,this.access=n,this.value=a}get astNodeType(){return"let"}search(e){var t;e(this),(t=this.value)===null||t===void 0||t.search(e)}}class b2 extends Jn{constructor(e,t,i,n,a){super(),this.attributes=null,this.name=e,this.type=t,this.storage=i,this.access=n,this.value=a}get astNodeType(){return"const"}constEvaluate(e,t){return this.value.constEvaluate(e,t)}search(e){var t;e(this),(t=this.value)===null||t===void 0||t.search(e)}}var d0,u1,ut,tt;(r=>{r.increment="++",r.decrement="--"})(d0||(d0={})),(r=>{r.parse=function(e){const t=e;if(t=="parse")throw new Error("Invalid value for IncrementOperator");return r[t]}})(d0||(d0={}));class rH extends Jn{constructor(e,t){super(),this.operator=e,this.variable=t}get astNodeType(){return"increment"}search(e){this.variable.search(e)}}(r=>{r.assign="=",r.addAssign="+=",r.subtractAssin="-=",r.multiplyAssign="*=",r.divideAssign="/=",r.moduloAssign="%=",r.andAssign="&=",r.orAssign="|=",r.xorAssign="^=",r.shiftLeftAssign="<<=",r.shiftRightAssign=">>="})(u1||(u1={})),(r=>{r.parse=function(e){const t=e;if(t=="parse")throw new Error("Invalid value for AssignOperator");return t}})(u1||(u1={}));class iH extends Jn{constructor(e,t,i){super(),this.operator=e,this.variable=t,this.value=i}get astNodeType(){return"assign"}search(e){this.variable.search(e),this.value.search(e)}}class BD extends Jn{constructor(e,t){super(),this.name=e,this.args=t}get astNodeType(){return"call"}isBuiltin(){return J8.has(this.name)}search(e){for(const t of this.args)t.search(e);e(this)}}class nH extends Jn{constructor(e,t){super(),this.body=e,this.continuing=t}get astNodeType(){return"loop"}search(e){var t;this.searchBlock(this.body,e),(t=this.continuing)===null||t===void 0||t.search(e)}}class aH extends Jn{constructor(e,t){super(),this.condition=e,this.cases=t}get astNodeType(){return"switch"}search(e){e(this);for(const t of this.cases)t.search(e)}}class oH extends Jn{constructor(e,t,i,n){super(),this.condition=e,this.body=t,this.elseif=i,this.else=n}get astNodeType(){return"if"}search(e){this.condition.search(e),this.searchBlock(this.body,e),this.searchBlock(this.elseif,e),this.searchBlock(this.else,e)}}class sH extends Jn{constructor(e){super(),this.value=e}get astNodeType(){return"return"}search(e){var t;(t=this.value)===null||t===void 0||t.search(e)}}class JQ extends Jn{constructor(e){super(),this.name=e}get astNodeType(){return"enable"}}class eJ extends Jn{constructor(e){super(),this.extensions=e}get astNodeType(){return"requires"}}class lH extends Jn{constructor(e,t){super(),this.severity=e,this.rule=t}get astNodeType(){return"diagnostic"}}class zD extends Jn{constructor(e,t){super(),this.name=e,this.type=t}get astNodeType(){return"alias"}}class tJ extends Jn{constructor(){super()}get astNodeType(){return"discard"}}class uH extends Jn{constructor(){super(),this.condition=null,this.loopId=-1}get astNodeType(){return"break"}}class cH extends Jn{constructor(){super(),this.loopId=-1}get astNodeType(){return"continue"}}class Rt extends Jn{constructor(e){super(),this.attributes=null,this.name=e}get astNodeType(){return"type"}get isStruct(){return!1}get isArray(){return!1}static maxFormatType(e){let t=e[0];if(t.name==="f32")return t;for(let i=1;i<e.length;++i){const n=Rt._priority.get(t.name);Rt._priority.get(e[i].name)<n&&(t=e[i])}return t.name==="x32"?Rt.i32:t}getTypeName(){return this.name}}Rt.x32=new Rt("x32"),Rt.f32=new Rt("f32"),Rt.i32=new Rt("i32"),Rt.u32=new Rt("u32"),Rt.f16=new Rt("f16"),Rt.bool=new Rt("bool"),Rt.void=new Rt("void"),Rt._priority=new Map([["f32",0],["f16",1],["u32",2],["i32",3],["x32",3]]);class MN extends Rt{constructor(e){super(e)}}class Qd extends Rt{constructor(e,t,i,n){super(e),this.members=t,this.startLine=i,this.endLine=n}get astNodeType(){return"struct"}get isStruct(){return!0}getMemberIndex(e){for(let t=0;t<this.members.length;t++)if(this.members[t].name==e)return t;return-1}search(e){for(const t of this.members)e(t)}}class nt extends Rt{constructor(e,t,i){super(e),this.format=t,this.access=i}get astNodeType(){return"template"}getTypeName(){let e=this.name;if(this.format!==null){if(e==="vec2"||e==="vec3"||e==="vec4"||e==="mat2x2"||e==="mat2x3"||e==="mat2x4"||e==="mat3x2"||e==="mat3x3"||e==="mat3x4"||e==="mat4x2"||e==="mat4x3"||e==="mat4x4"){if(this.format.name==="f32")return e+="f",e;if(this.format.name==="i32")return e+="i",e;if(this.format.name==="u32")return e+="u",e;if(this.format.name==="bool")return e+="b",e;if(this.format.name==="f16")return e+="h",e}e+=`<${this.format.name}>`}else if(e==="vec2"||e==="vec3"||e==="vec4")return e;return e}}nt.vec2f=new nt("vec2",Rt.f32,null),nt.vec3f=new nt("vec3",Rt.f32,null),nt.vec4f=new nt("vec4",Rt.f32,null),nt.vec2i=new nt("vec2",Rt.i32,null),nt.vec3i=new nt("vec3",Rt.i32,null),nt.vec4i=new nt("vec4",Rt.i32,null),nt.vec2u=new nt("vec2",Rt.u32,null),nt.vec3u=new nt("vec3",Rt.u32,null),nt.vec4u=new nt("vec4",Rt.u32,null),nt.vec2h=new nt("vec2",Rt.f16,null),nt.vec3h=new nt("vec3",Rt.f16,null),nt.vec4h=new nt("vec4",Rt.f16,null),nt.vec2b=new nt("vec2",Rt.bool,null),nt.vec3b=new nt("vec3",Rt.bool,null),nt.vec4b=new nt("vec4",Rt.bool,null),nt.mat2x2f=new nt("mat2x2",Rt.f32,null),nt.mat2x3f=new nt("mat2x3",Rt.f32,null),nt.mat2x4f=new nt("mat2x4",Rt.f32,null),nt.mat3x2f=new nt("mat3x2",Rt.f32,null),nt.mat3x3f=new nt("mat3x3",Rt.f32,null),nt.mat3x4f=new nt("mat3x4",Rt.f32,null),nt.mat4x2f=new nt("mat4x2",Rt.f32,null),nt.mat4x3f=new nt("mat4x3",Rt.f32,null),nt.mat4x4f=new nt("mat4x4",Rt.f32,null),nt.mat2x2h=new nt("mat2x2",Rt.f16,null),nt.mat2x3h=new nt("mat2x3",Rt.f16,null),nt.mat2x4h=new nt("mat2x4",Rt.f16,null),nt.mat3x2h=new nt("mat3x2",Rt.f16,null),nt.mat3x3h=new nt("mat3x3",Rt.f16,null),nt.mat3x4h=new nt("mat3x4",Rt.f16,null),nt.mat4x2h=new nt("mat4x2",Rt.f16,null),nt.mat4x3h=new nt("mat4x3",Rt.f16,null),nt.mat4x4h=new nt("mat4x4",Rt.f16,null),nt.mat2x2i=new nt("mat2x2",Rt.i32,null),nt.mat2x3i=new nt("mat2x3",Rt.i32,null),nt.mat2x4i=new nt("mat2x4",Rt.i32,null),nt.mat3x2i=new nt("mat3x2",Rt.i32,null),nt.mat3x3i=new nt("mat3x3",Rt.i32,null),nt.mat3x4i=new nt("mat3x4",Rt.i32,null),nt.mat4x2i=new nt("mat4x2",Rt.i32,null),nt.mat4x3i=new nt("mat4x3",Rt.i32,null),nt.mat4x4i=new nt("mat4x4",Rt.i32,null),nt.mat2x2u=new nt("mat2x2",Rt.u32,null),nt.mat2x3u=new nt("mat2x3",Rt.u32,null),nt.mat2x4u=new nt("mat2x4",Rt.u32,null),nt.mat3x2u=new nt("mat3x2",Rt.u32,null),nt.mat3x3u=new nt("mat3x3",Rt.u32,null),nt.mat3x4u=new nt("mat3x4",Rt.u32,null),nt.mat4x2u=new nt("mat4x2",Rt.u32,null),nt.mat4x3u=new nt("mat4x3",Rt.u32,null),nt.mat4x4u=new nt("mat4x4",Rt.u32,null);class x2 extends Rt{constructor(e,t,i,n){super(e),this.storage=t,this.type=i,this.access=n}get astNodeType(){return"pointer"}}class I1 extends Rt{constructor(e,t,i,n){super(e),this.attributes=t,this.format=i,this.count=n}get astNodeType(){return"array"}get isArray(){return!0}}class c1 extends Rt{constructor(e,t,i){super(e),this.format=t,this.access=i}get astNodeType(){return"sampler"}}class kh extends Ac{constructor(){super(),this.postfix=null}}class hy extends kh{constructor(e){super(),this.value=e}get astNodeType(){return"stringExpr"}toString(){return this.value}constEvaluateString(){return this.value}}class Mf extends kh{constructor(e,t){super(),this.type=e,this.args=t}get astNodeType(){return"createExpr"}search(e){if(e(this),this.args)for(const t of this.args)t.search(e)}constEvaluate(e,t){return t&&(t[0]=this.type),e.evalExpression(this,e.context)}}class FD extends kh{constructor(e,t){super(),this.cachedReturnValue=null,this.name=e,this.args=t}get astNodeType(){return"callExpr"}setCachedReturnValue(e){this.cachedReturnValue=e}get isBuiltin(){return J8.has(this.name)}constEvaluate(e,t){return e.evalExpression(this,e.context)}search(e){for(const t of this.args)t.search(e);e(this)}}class pu extends kh{constructor(e){super(),this.name=e}get astNodeType(){return"varExpr"}search(e){e(this),this.postfix&&this.postfix.search(e)}constEvaluate(e,t){return e.evalExpression(this,e.context)}}class hH extends kh{constructor(e,t){super(),this.name=e,this.initializer=t}get astNodeType(){return"constExpr"}constEvaluate(e,t){if(this.initializer){const i=e.evalExpression(this.initializer,e.context);return i!==null&&this.postfix?i.getSubData(e,this.postfix,e.context):i}return null}search(e){this.initializer.search(e)}}class no extends kh{constructor(e,t){super(),this.value=e,this.type=t}get astNodeType(){return"literalExpr"}constEvaluate(e,t){return t!==void 0&&(t[0]=this.type),this.value}get isScalar(){return this.value instanceof et}get isVector(){return this.value instanceof Pe||this.value instanceof Fr}get scalarValue(){return this.value instanceof et?this.value.value:(console.error("Value is not scalar."),0)}get vectorValue(){return this.value instanceof Pe||this.value instanceof Fr?this.value.data:(console.error("Value is not a vector or matrix."),new Float32Array(0))}}class fH extends kh{constructor(e,t){super(),this.type=e,this.value=t}get astNodeType(){return"bitcastExpr"}search(e){this.value.search(e)}}class L0 extends kh{constructor(e){super(),this.index=e}search(e){this.index.search(e)}}class dH extends kh{constructor(){super()}}class Wa extends dH{constructor(e,t){super(),this.operator=e,this.right=t}get astNodeType(){return"unaryOp"}constEvaluate(e,t){return e.evalExpression(this,e.context)}search(e){this.right.search(e)}}class vh extends dH{constructor(e,t,i){super(),this.operator=e,this.left=t,this.right=i}get astNodeType(){return"binaryOp"}_getPromotedType(e,t){return e.name===t.name?e:e.name==="f32"||t.name==="f32"?Rt.f32:e.name==="u32"||t.name==="u32"?Rt.u32:Rt.i32}constEvaluate(e,t){return e.evalExpression(this,e.context)}search(e){this.left.search(e),this.right.search(e)}}class pH extends Ac{constructor(e){super(),this.body=e}search(e){e(this),this.searchBlock(this.body,e)}}class w2 extends kh{constructor(){super()}get astNodeType(){return"default"}}class gH extends pH{constructor(e,t){super(t),this.selectors=e}get astNodeType(){return"case"}search(e){this.searchBlock(this.body,e)}}class vH extends pH{constructor(e){super(e)}get astNodeType(){return"default"}search(e){this.searchBlock(this.body,e)}}class EN extends Ac{constructor(e,t,i){super(),this.name=e,this.type=t,this.attributes=i}get astNodeType(){return"argument"}}class rJ extends Ac{constructor(e,t){super(),this.condition=e,this.body=t}get astNodeType(){return"elseif"}search(e){this.condition.search(e),this.searchBlock(this.body,e)}}class IN extends Ac{constructor(e,t,i){super(),this.name=e,this.type=t,this.attributes=i}get astNodeType(){return"member"}}class mH extends Ac{constructor(e,t){super(),this.name=e,this.value=t}get astNodeType(){return"attribute"}}class wc{constructor(e,t){this.parent=null,this.typeInfo=e,this.parent=t,this.id=wc._id++}clone(){throw`Clone: Not implemented for ${this.constructor.name}`}setDataValue(e,t,i,n){console.error(`SetDataValue: Not implemented for ${this.constructor.name}`)}getSubData(e,t,i){return console.error(`GetDataValue: Not implemented for ${this.constructor.name}`),null}toString(){return`<${this.typeInfo.getTypeName()}>`}}wc._id=0;class rR extends wc{constructor(){super(new yc("void",null),null)}toString(){return"void"}}rR.void=new rR;class O_ extends wc{constructor(e){super(new eR("pointer",e.typeInfo,null),null),this.reference=e}clone(){return this}setDataValue(e,t,i,n){this.reference.setDataValue(e,t,i,n)}getSubData(e,t,i){return t?this.reference.getSubData(e,t,i):this}toString(){return`&${this.reference.toString()}`}}class et extends wc{constructor(e,t,i=null){super(t,i),e instanceof Int32Array||e instanceof Uint32Array||e instanceof Float32Array?this.data=e:this.typeInfo.name==="x32"?e-Math.floor(e)!==0?this.data=new Float32Array([e]):this.data=e>=0?new Uint32Array([e]):new Int32Array([e]):this.typeInfo.name==="i32"||this.typeInfo.name==="bool"?this.data=new Int32Array([e]):this.typeInfo.name==="u32"?this.data=new Uint32Array([e]):this.typeInfo.name==="f32"||this.typeInfo.name==="f16"?this.data=new Float32Array([e]):console.error("ScalarData2: Invalid type",t)}clone(){if(this.data instanceof Float32Array)return new et(new Float32Array(this.data),this.typeInfo,null);if(this.data instanceof Int32Array)return new et(new Int32Array(this.data),this.typeInfo,null);if(this.data instanceof Uint32Array)return new et(new Uint32Array(this.data),this.typeInfo,null);throw"ScalarData: Invalid data type"}get value(){return this.data[0]}set value(e){this.data[0]=e}setDataValue(e,t,i,n){if(i)return void console.error("SetDataValue: Scalar data does not support postfix",i);if(!(t instanceof et))return void console.error("SetDataValue: Invalid value",t);let a=t.data[0];this.typeInfo.name==="i32"||this.typeInfo.name==="u32"?a=Math.floor(a):this.typeInfo.name==="bool"&&(a=a?1:0),this.data[0]=a}getSubData(e,t,i){return t?(console.error("getSubData: Scalar data does not support postfix",t),null):this}toString(){return`${this.value}`}}function iJ(r,e,t){const i=e.length;return i===2?t==="f32"?new Pe(new Float32Array(e),r.getTypeInfo("vec2f")):t==="i32"||t==="bool"?new Pe(new Int32Array(e),r.getTypeInfo("vec2i")):t==="u32"?new Pe(new Uint32Array(e),r.getTypeInfo("vec2u")):t==="f16"?new Pe(new Float32Array(e),r.getTypeInfo("vec2h")):(console.error(`getSubData: Unknown format ${t}`),null):i===3?t==="f32"?new Pe(new Float32Array(e),r.getTypeInfo("vec3f")):t==="i32"||t==="bool"?new Pe(new Int32Array(e),r.getTypeInfo("vec3i")):t==="u32"?new Pe(new Uint32Array(e),r.getTypeInfo("vec3u")):t==="f16"?new Pe(new Float32Array(e),r.getTypeInfo("vec3h")):(console.error(`getSubData: Unknown format ${t}`),null):i===4?t==="f32"?new Pe(new Float32Array(e),r.getTypeInfo("vec4f")):t==="i32"||t==="bool"?new Pe(new Int32Array(e),r.getTypeInfo("vec4i")):t==="u32"?new Pe(new Uint32Array(e),r.getTypeInfo("vec4u")):t==="f16"?new Pe(new Float32Array(e),r.getTypeInfo("vec4h")):(console.error(`getSubData: Unknown format ${t}`),null):(console.error(`getSubData: Invalid vector size ${e.length}`),null)}class Pe extends wc{constructor(e,t,i=null){if(super(t,i),e instanceof Float32Array||e instanceof Uint32Array||e instanceof Int32Array)this.data=e;else{const n=this.typeInfo.name;n==="vec2f"||n==="vec3f"||n==="vec4f"?this.data=new Float32Array(e):n==="vec2i"||n==="vec3i"||n==="vec4i"?this.data=new Int32Array(e):n==="vec2u"||n==="vec3u"||n==="vec4u"?this.data=new Uint32Array(e):n==="vec2h"||n==="vec3h"||n==="vec4h"?this.data=new Float32Array(e):n==="vec2b"||n==="vec3b"||n==="vec4b"?this.data=new Int32Array(e):n==="vec2"||n==="vec3"||n==="vec4"?this.data=new Float32Array(e):console.error(`VectorData: Invalid type ${n}`)}}clone(){if(this.data instanceof Float32Array)return new Pe(new Float32Array(this.data),this.typeInfo,null);if(this.data instanceof Int32Array)return new Pe(new Int32Array(this.data),this.typeInfo,null);if(this.data instanceof Uint32Array)return new Pe(new Uint32Array(this.data),this.typeInfo,null);throw"VectorData: Invalid data type"}setDataValue(e,t,i,n){i instanceof hy?console.error("TODO: Set vector postfix"):t instanceof Pe?this.data=t.data:console.error("SetDataValue: Invalid value",t)}getSubData(e,t,i){if(t===null)return this;let n=e.getTypeInfo("f32");if(this.typeInfo instanceof cy)n=this.typeInfo.format||n;else{const s=this.typeInfo.name;s==="vec2f"||s==="vec3f"||s==="vec4f"?n=e.getTypeInfo("f32"):s==="vec2i"||s==="vec3i"||s==="vec4i"?n=e.getTypeInfo("i32"):s==="vec2b"||s==="vec3b"||s==="vec4b"?n=e.getTypeInfo("bool"):s==="vec2u"||s==="vec3u"||s==="vec4u"?n=e.getTypeInfo("u32"):s==="vec2h"||s==="vec3h"||s==="vec4h"?n=e.getTypeInfo("f16"):console.error(`GetSubData: Unknown type ${s}`)}let a=this;for(;t!==null&&a!==null;){if(t instanceof L0){const s=t.index;let o=-1;if(s instanceof no){if(!(s.value instanceof et))return console.error(`GetSubData: Invalid array index ${s.value}`),null;o=s.value.value}else{const l=e.evalExpression(s,i);if(!(l instanceof et))return console.error("GetSubData: Unknown index type",s),null;o=l.value}if(o<0||o>=a.data.length)return console.error("GetSubData: Index out of range",o),null;if(a.data instanceof Float32Array){const l=new Float32Array(a.data.buffer,a.data.byteOffset+4*o,1);return new et(l,n)}if(a.data instanceof Int32Array){const l=new Int32Array(a.data.buffer,a.data.byteOffset+4*o,1);return new et(l,n)}if(a.data instanceof Uint32Array){const l=new Uint32Array(a.data.buffer,a.data.byteOffset+4*o,1);return new et(l,n)}throw"GetSubData: Invalid data type"}if(!(t instanceof hy))return console.error("GetSubData: Unknown postfix",t),null;{const s=t.value.toLowerCase();if(s.length===1){let l=0;if(s==="x"||s==="r")l=0;else if(s==="y"||s==="g")l=1;else if(s==="z"||s==="b")l=2;else{if(s!=="w"&&s!=="a")return console.error(`GetSubData: Unknown member ${s}`),null;l=3}if(this.data instanceof Float32Array){let c=new Float32Array(this.data.buffer,this.data.byteOffset+4*l,1);return new et(c,n,this)}if(this.data instanceof Int32Array){let c=new Int32Array(this.data.buffer,this.data.byteOffset+4*l,1);return new et(c,n,this)}if(this.data instanceof Uint32Array){let c=new Uint32Array(this.data.buffer,this.data.byteOffset+4*l,1);return new et(c,n,this)}}const o=[];for(const l of s)l==="x"||l==="r"?o.push(this.data[0]):l==="y"||l==="g"?o.push(this.data[1]):l==="z"||l==="b"?o.push(this.data[2]):l==="w"||l==="a"?o.push(this.data[3]):console.error(`GetDataValue: Unknown member ${l}`);a=iJ(e,o,n.name)}t=t.postfix}return a}toString(){let e=`${this.data[0]}`;for(let t=1;t<this.data.length;++t)e+=`, ${this.data[t]}`;return e}}class Fr extends wc{constructor(e,t,i=null){super(t,i),e instanceof Float32Array?this.data=e:this.data=new Float32Array(e)}clone(){return new Fr(new Float32Array(this.data),this.typeInfo,null)}setDataValue(e,t,i,n){i instanceof hy?console.error("TODO: Set matrix postfix"):t instanceof Fr?this.data=t.data:console.error("SetDataValue: Invalid value",t)}getSubData(e,t,i){if(t===null)return this;const n=this.typeInfo.name;if(e.getTypeInfo("f32"),this.typeInfo instanceof cy)this.typeInfo.format;else if(n.endsWith("f"))e.getTypeInfo("f32");else if(n.endsWith("i"))e.getTypeInfo("i32");else if(n.endsWith("u"))e.getTypeInfo("u32");else{if(!n.endsWith("h"))return console.error(`GetDataValue: Unknown type ${n}`),null;e.getTypeInfo("f16")}if(t instanceof L0){const a=t.index;let s=-1;if(a instanceof no){if(!(a.value instanceof et))return console.error(`GetDataValue: Invalid array index ${a.value}`),null;s=a.value.value}else{const c=e.evalExpression(a,i);if(!(c instanceof et))return console.error("GetDataValue: Unknown index type",a),null;s=c.value}if(s<0||s>=this.data.length)return console.error("GetDataValue: Index out of range",s),null;const o=n.endsWith("h")?"h":"f";let l;if(n==="mat2x2"||n==="mat2x2f"||n==="mat2x2h"||n==="mat3x2"||n==="mat3x2f"||n==="mat3x2h"||n==="mat4x2"||n==="mat4x2f"||n==="mat4x2h")l=new Pe(new Float32Array(this.data.buffer,this.data.byteOffset+2*s*4,2),e.getTypeInfo(`vec2${o}`));else if(n==="mat2x3"||n==="mat2x3f"||n==="mat2x3h"||n==="mat3x3"||n==="mat3x3f"||n==="mat3x3h"||n==="mat4x3"||n==="mat4x3f"||n==="mat4x3h")l=new Pe(new Float32Array(this.data.buffer,this.data.byteOffset+3*s*4,3),e.getTypeInfo(`vec3${o}`));else{if(n!=="mat2x4"&&n!=="mat2x4f"&&n!=="mat2x4h"&&n!=="mat3x4"&&n!=="mat3x4f"&&n!=="mat3x4h"&&n!=="mat4x4"&&n!=="mat4x4f"&&n!=="mat4x4h")return console.error(`GetDataValue: Unknown type ${n}`),null;l=new Pe(new Float32Array(this.data.buffer,this.data.byteOffset+4*s*4,4),e.getTypeInfo(`vec4${o}`))}return t.postfix?l.getSubData(e,t.postfix,i):l}return console.error("GetDataValue: Invalid postfix",t),null}toString(){let e=`${this.data[0]}`;for(let t=1;t<this.data.length;++t)e+=`, ${this.data[t]}`;return e}}class Sa extends wc{constructor(e,t,i=0,n=null){super(t,n),this.buffer=e instanceof ArrayBuffer?e:e.buffer,this.offset=i}clone(){const e=new Uint8Array(new Uint8Array(this.buffer,this.offset,this.typeInfo.size));return new Sa(e.buffer,this.typeInfo,0,null)}setDataValue(e,t,i,n){if(t===null)return void console.log("setDataValue: NULL data.");let a=this.offset,s=this.typeInfo;for(;i;){if(i instanceof L0)if(s instanceof Dg){const o=i.index;if(o instanceof no){if(!(o.value instanceof et))return void console.error(`SetDataValue: Invalid index type ${o.value}`);a+=o.value.value*s.stride}else{const l=e.evalExpression(o,n);if(!(l instanceof et))return void console.error("SetDataValue: Unknown index type",o);a+=l.value*s.stride}s=s.format}else console.error(`SetDataValue: Type ${s.getTypeName()} is not an array`);else{if(!(i instanceof hy))return void console.error("SetDataValue: Unknown postfix type",i);{const o=i.value;if(s instanceof wg){let l=!1;for(const c of s.members)if(c.name===o){a+=c.offset,s=c.type,l=!0;break}if(!l)return void console.error(`SetDataValue: Member ${o} not found`)}else if(s instanceof yc){const l=s.getTypeName();let c=0;if(o==="x"||o==="r")c=0;else if(o==="y"||o==="g")c=1;else if(o==="z"||o==="b")c=2;else{if(o!=="w"&&o!=="a")return void console.error(`SetDataValue: Unknown member ${o}`);c=3}if(!(t instanceof et))return void console.error("SetDataValue: Invalid value",t);const f=t.value;return l==="vec2f"?void(new Float32Array(this.buffer,a,2)[c]=f):l==="vec3f"?void(new Float32Array(this.buffer,a,3)[c]=f):l==="vec4f"?void(new Float32Array(this.buffer,a,4)[c]=f):l==="vec2i"?void(new Int32Array(this.buffer,a,2)[c]=f):l==="vec3i"?void(new Int32Array(this.buffer,a,3)[c]=f):l==="vec4i"?void(new Int32Array(this.buffer,a,4)[c]=f):l==="vec2u"?void(new Uint32Array(this.buffer,a,2)[c]=f):l==="vec3u"?void(new Uint32Array(this.buffer,a,3)[c]=f):l==="vec4u"?void(new Uint32Array(this.buffer,a,4)[c]=f):void console.error(`SetDataValue: Type ${l} is not a struct`)}}}i=i.postfix}this.setData(e,t,s,a,n)}setData(e,t,i,n,a){const s=i.getTypeName();if(s!=="f32"&&s!=="f16")if(s!=="i32"&&s!=="atomic<i32>"&&s!=="x32")if(s!=="u32"&&s!=="atomic<u32>")if(s!=="bool"){if(s==="vec2f"||s==="vec2h"){const o=new Float32Array(this.buffer,n,2);return void(t instanceof Pe?(o[0]=t.data[0],o[1]=t.data[1]):(o[0]=t[0],o[1]=t[1]))}if(s==="vec3f"||s==="vec3h"){const o=new Float32Array(this.buffer,n,3);return void(t instanceof Pe?(o[0]=t.data[0],o[1]=t.data[1],o[2]=t.data[2]):(o[0]=t[0],o[1]=t[1],o[2]=t[2]))}if(s==="vec4f"||s==="vec4h"){const o=new Float32Array(this.buffer,n,4);return void(t instanceof Pe?(o[0]=t.data[0],o[1]=t.data[1],o[2]=t.data[2],o[3]=t.data[3]):(o[0]=t[0],o[1]=t[1],o[2]=t[2],o[3]=t[3]))}if(s==="vec2i"){const o=new Int32Array(this.buffer,n,2);return void(t instanceof Pe?(o[0]=t.data[0],o[1]=t.data[1]):(o[0]=t[0],o[1]=t[1]))}if(s==="vec3i"){const o=new Int32Array(this.buffer,n,3);return void(t instanceof Pe?(o[0]=t.data[0],o[1]=t.data[1],o[2]=t.data[2]):(o[0]=t[0],o[1]=t[1],o[2]=t[2]))}if(s==="vec4i"){const o=new Int32Array(this.buffer,n,4);return void(t instanceof Pe?(o[0]=t.data[0],o[1]=t.data[1],o[2]=t.data[2],o[3]=t.data[3]):(o[0]=t[0],o[1]=t[1],o[2]=t[2],o[3]=t[3]))}if(s==="vec2u"){const o=new Uint32Array(this.buffer,n,2);return void(t instanceof Pe?(o[0]=t.data[0],o[1]=t.data[1]):(o[0]=t[0],o[1]=t[1]))}if(s==="vec3u"){const o=new Uint32Array(this.buffer,n,3);return void(t instanceof Pe?(o[0]=t.data[0],o[1]=t.data[1],o[2]=t.data[2]):(o[0]=t[0],o[1]=t[1],o[2]=t[2]))}if(s==="vec4u"){const o=new Uint32Array(this.buffer,n,4);return void(t instanceof Pe?(o[0]=t.data[0],o[1]=t.data[1],o[2]=t.data[2],o[3]=t.data[3]):(o[0]=t[0],o[1]=t[1],o[2]=t[2],o[3]=t[3]))}if(s==="vec2b"){const o=new Uint32Array(this.buffer,n,2);return void(t instanceof Pe?(o[0]=t.data[0],o[1]=t.data[1]):(o[0]=t[0],o[1]=t[1]))}if(s==="vec3b"){const o=new Uint32Array(this.buffer,n,3);return void(t instanceof Pe?(o[0]=t.data[0],o[1]=t.data[1],o[2]=t.data[2]):(o[0]=t[0],o[1]=t[1],o[2]=t[2]))}if(s==="vec4b"){const o=new Uint32Array(this.buffer,n,4);return void(t instanceof Pe?(o[0]=t.data[0],o[1]=t.data[1],o[2]=t.data[2],o[3]=t.data[3]):(o[0]=t[0],o[1]=t[1],o[2]=t[2],o[3]=t[3]))}if(s==="mat2x2f"||s==="mat2x2h"){const o=new Float32Array(this.buffer,n,4);return void(t instanceof Fr?(o[0]=t.data[0],o[1]=t.data[1],o[2]=t.data[2],o[3]=t.data[3]):(o[0]=t[0],o[1]=t[1],o[2]=t[2],o[3]=t[3]))}if(s==="mat2x3f"||s==="mat2x3h"){const o=new Float32Array(this.buffer,n,6);return void(t instanceof Fr?(o[0]=t.data[0],o[1]=t.data[1],o[2]=t.data[2],o[3]=t.data[3],o[4]=t.data[4],o[5]=t.data[5]):(o[0]=t[0],o[1]=t[1],o[2]=t[2],o[3]=t[3],o[4]=t[4],o[5]=t[5]))}if(s==="mat2x4f"||s==="mat2x4h"){const o=new Float32Array(this.buffer,n,8);return void(t instanceof Fr?(o[0]=t.data[0],o[1]=t.data[1],o[2]=t.data[2],o[3]=t.data[3],o[4]=t.data[4],o[5]=t.data[5],o[6]=t.data[6],o[7]=t.data[7]):(o[0]=t[0],o[1]=t[1],o[2]=t[2],o[3]=t[3],o[4]=t[4],o[5]=t[5],o[6]=t[6],o[7]=t[7]))}if(s==="mat3x2f"||s==="mat3x2h"){const o=new Float32Array(this.buffer,n,6);return void(t instanceof Fr?(o[0]=t.data[0],o[1]=t.data[1],o[2]=t.data[2],o[3]=t.data[3],o[4]=t.data[4],o[5]=t.data[5]):(o[0]=t[0],o[1]=t[1],o[2]=t[2],o[3]=t[3],o[4]=t[4],o[5]=t[5]))}if(s==="mat3x3f"||s==="mat3x3h"){const o=new Float32Array(this.buffer,n,9);return void(t instanceof Fr?(o[0]=t.data[0],o[1]=t.data[1],o[2]=t.data[2],o[3]=t.data[3],o[4]=t.data[4],o[5]=t.data[5],o[6]=t.data[6],o[7]=t.data[7],o[8]=t.data[8]):(o[0]=t[0],o[1]=t[1],o[2]=t[2],o[3]=t[3],o[4]=t[4],o[5]=t[5],o[6]=t[6],o[7]=t[7],o[8]=t[8]))}if(s==="mat3x4f"||s==="mat3x4h"){const o=new Float32Array(this.buffer,n,12);return void(t instanceof Fr?(o[0]=t.data[0],o[1]=t.data[1],o[2]=t.data[2],o[3]=t.data[3],o[4]=t.data[4],o[5]=t.data[5],o[6]=t.data[6],o[7]=t.data[7],o[8]=t.data[8],o[9]=t.data[9],o[10]=t.data[10],o[11]=t.data[11]):(o[0]=t[0],o[1]=t[1],o[2]=t[2],o[3]=t[3],o[4]=t[4],o[5]=t[5],o[6]=t[6],o[7]=t[7],o[8]=t[8],o[9]=t[9],o[10]=t[10],o[11]=t[11]))}if(s==="mat4x2f"||s==="mat4x2h"){const o=new Float32Array(this.buffer,n,8);return void(t instanceof Fr?(o[0]=t.data[0],o[1]=t.data[1],o[2]=t.data[2],o[3]=t.data[3],o[4]=t.data[4],o[5]=t.data[5],o[6]=t.data[6],o[7]=t.data[7]):(o[0]=t[0],o[1]=t[1],o[2]=t[2],o[3]=t[3],o[4]=t[4],o[5]=t[5],o[6]=t[6],o[7]=t[7]))}if(s==="mat4x3f"||s==="mat4x3h"){const o=new Float32Array(this.buffer,n,12);return void(t instanceof Fr?(o[0]=t.data[0],o[1]=t.data[1],o[2]=t.data[2],o[3]=t.data[3],o[4]=t.data[4],o[5]=t.data[5],o[6]=t.data[6],o[7]=t.data[7],o[8]=t.data[8],o[9]=t.data[9],o[10]=t.data[10],o[11]=t.data[11]):(o[0]=t[0],o[1]=t[1],o[2]=t[2],o[3]=t[3],o[4]=t[4],o[5]=t[5],o[6]=t[6],o[7]=t[7],o[8]=t[8],o[9]=t[9],o[10]=t[10],o[11]=t[11]))}if(s==="mat4x4f"||s==="mat4x4h"){const o=new Float32Array(this.buffer,n,16);return void(t instanceof Fr?(o[0]=t.data[0],o[1]=t.data[1],o[2]=t.data[2],o[3]=t.data[3],o[4]=t.data[4],o[5]=t.data[5],o[6]=t.data[6],o[7]=t.data[7],o[8]=t.data[8],o[9]=t.data[9],o[10]=t.data[10],o[11]=t.data[11],o[12]=t.data[12],o[13]=t.data[13],o[14]=t.data[14],o[15]=t.data[15]):(o[0]=t[0],o[1]=t[1],o[2]=t[2],o[3]=t[3],o[4]=t[4],o[5]=t[5],o[6]=t[6],o[7]=t[7],o[8]=t[8],o[9]=t[9],o[10]=t[10],o[11]=t[11],o[12]=t[12],o[13]=t[13],o[14]=t[14],o[15]=t[15]))}if(t instanceof Sa){if(i===t.typeInfo)return void new Uint8Array(this.buffer,n,t.buffer.byteLength).set(new Uint8Array(t.buffer));console.error("SetDataValue: Type mismatch",s,t.typeInfo.getTypeName())}else console.error(`SetData: Unknown type ${s}`)}else t instanceof et&&(new Int32Array(this.buffer,n,1)[0]=t.value);else t instanceof et&&(new Uint32Array(this.buffer,n,1)[0]=t.value);else t instanceof et&&(new Int32Array(this.buffer,n,1)[0]=t.value);else t instanceof et&&(new Float32Array(this.buffer,n,1)[0]=t.value)}getSubData(e,t,i){var n,a,s;if(t===null)return this;let o=this.offset,l=this.typeInfo;for(;t;){if(t instanceof L0){const f=t.index,p=f instanceof kh?e.evalExpression(f,i):f;let y=0;if(p instanceof et?y=p.value:typeof p=="number"?y=p:console.error("GetDataValue: Invalid index type",f),l instanceof Dg)o+=y*l.stride,l=l.format;else{const b=l.getTypeName();b==="mat4x4"||b==="mat4x4f"||b==="mat4x4h"?(o+=16*y,l=e.getTypeInfo("vec4f")):console.error(`getDataValue: Type ${l.getTypeName()} is not an array`)}}else{if(!(t instanceof hy))return console.error("GetDataValue: Unknown postfix type",t),null;{const f=t.value;if(l instanceof wg){let p=!1;for(const y of l.members)if(y.name===f){o+=y.offset,l=y.type,p=!0;break}if(!p)return console.error(`GetDataValue: Member ${f} not found`),null}else if(l instanceof yc){const p=l.getTypeName();if(p==="vec2f"||p==="vec3f"||p==="vec4f"||p==="vec2i"||p==="vec3i"||p==="vec4i"||p==="vec2u"||p==="vec3u"||p==="vec4u"||p==="vec2b"||p==="vec3b"||p==="vec4b"||p==="vec2h"||p==="vec3h"||p==="vec4h"||p==="vec2"||p==="vec3"||p==="vec4"){if(f.length>0&&f.length<5){let y="f";const b=[];for(let S=0;S<f.length;++S){const C=f[S].toLowerCase();let E=0;if(C==="x"||C==="r")E=0;else if(C==="y"||C==="g")E=1;else if(C==="z"||C==="b")E=2;else{if(C!=="w"&&C!=="a")return console.error(`Unknown member ${f}`),null;E=3}if(f.length===1){if(p.endsWith("f"))return this.buffer.byteLength<o+4*E+4?(console.log("Insufficient buffer data"),null):new et(new Float32Array(this.buffer,o+4*E,1),e.getTypeInfo("f32"),this);if(p.endsWith("h"))return new et(new Float32Array(this.buffer,o+4*E,1),e.getTypeInfo("f16"),this);if(p.endsWith("i"))return new et(new Int32Array(this.buffer,o+4*E,1),e.getTypeInfo("i32"),this);if(p.endsWith("b"))return new et(new Int32Array(this.buffer,o+4*E,1),e.getTypeInfo("bool"),this);if(p.endsWith("u"))return new et(new Uint32Array(this.buffer,o+4*E,1),e.getTypeInfo("i32"),this)}if(p==="vec2f")b.push(new Float32Array(this.buffer,o,2)[E]);else if(p==="vec3f"){if(o+12>=this.buffer.byteLength)return console.log("Insufficient buffer data"),null;const P=new Float32Array(this.buffer,o,3);b.push(P[E])}else if(p==="vec4f")b.push(new Float32Array(this.buffer,o,4)[E]);else if(p==="vec2i")y="i",b.push(new Int32Array(this.buffer,o,2)[E]);else if(p==="vec3i")y="i",b.push(new Int32Array(this.buffer,o,3)[E]);else if(p==="vec4i")y="i",b.push(new Int32Array(this.buffer,o,4)[E]);else if(p==="vec2u"){y="u";const P=new Uint32Array(this.buffer,o,2);b.push(P[E])}else p==="vec3u"?(y="u",b.push(new Uint32Array(this.buffer,o,3)[E])):p==="vec4u"&&(y="u",b.push(new Uint32Array(this.buffer,o,4)[E]))}return b.length===2?l=e.getTypeInfo(`vec2${y}`):b.length===3?l=e.getTypeInfo(`vec3${y}`):b.length===4?l=e.getTypeInfo(`vec4${y}`):console.error(`GetDataValue: Invalid vector length ${b.length}`),new Pe(b,l,null)}return console.error(`GetDataValue: Unknown member ${f}`),null}return console.error(`GetDataValue: Type ${p} is not a struct`),null}}}t=t.postfix}const c=l.getTypeName();return c==="f32"?new et(new Float32Array(this.buffer,o,1),l,this):c==="i32"?new et(new Int32Array(this.buffer,o,1),l,this):c==="u32"?new et(new Uint32Array(this.buffer,o,1),l,this):c==="vec2f"?new Pe(new Float32Array(this.buffer,o,2),l,this):c==="vec3f"?new Pe(new Float32Array(this.buffer,o,3),l,this):c==="vec4f"?new Pe(new Float32Array(this.buffer,o,4),l,this):c==="vec2i"?new Pe(new Int32Array(this.buffer,o,2),l,this):c==="vec3i"?new Pe(new Int32Array(this.buffer,o,3),l,this):c==="vec4i"?new Pe(new Int32Array(this.buffer,o,4),l,this):c==="vec2u"?new Pe(new Uint32Array(this.buffer,o,2),l,this):c==="vec3u"?new Pe(new Uint32Array(this.buffer,o,3),l,this):c==="vec4u"?new Pe(new Uint32Array(this.buffer,o,4),l,this):l instanceof cy&&l.name==="atomic"?((n=l.format)===null||n===void 0?void 0:n.name)==="u32"?new et(new Uint32Array(this.buffer,o,1)[0],l.format,this):((a=l.format)===null||a===void 0?void 0:a.name)==="i32"?new et(new Int32Array(this.buffer,o,1)[0],l.format,this):(console.error(`GetDataValue: Invalid atomic format ${(s=l.format)===null||s===void 0?void 0:s.name}`),null):new Sa(this.buffer,l,o,this)}toString(){let e="";if(this.typeInfo instanceof Dg)if(this.typeInfo.format.name==="f32"){const t=new Float32Array(this.buffer,this.offset);e=`[${t[0]}`;for(let i=1;i<t.length;++i)e+=`, ${t[i]}`}else if(this.typeInfo.format.name==="i32"){const t=new Int32Array(this.buffer,this.offset);e=`[${t[0]}`;for(let i=1;i<t.length;++i)e+=`, ${t[i]}`}else if(this.typeInfo.format.name==="u32"){const t=new Uint32Array(this.buffer,this.offset);e=`[${t[0]}`;for(let i=1;i<t.length;++i)e+=`, ${t[i]}`}else if(this.typeInfo.format.name==="vec2f"){const t=new Float32Array(this.buffer,this.offset);e=`[${t[0]}, ${t[1]}]`;for(let i=1;i<t.length/2;++i)e+=`, [${t[2*i]}, ${t[2*i+1]}]`}else if(this.typeInfo.format.name==="vec3f"){const t=new Float32Array(this.buffer,this.offset);e=`[${t[0]}, ${t[1]}, ${t[2]}]`;for(let i=4;i<t.length;i+=4)e+=`, [${t[i]}, ${t[i+1]}, ${t[i+2]}]`}else if(this.typeInfo.format.name==="vec4f"){const t=new Float32Array(this.buffer,this.offset);e=`[${t[0]}, ${t[1]}, ${t[2]}, ${t[3]}]`;for(let i=4;i<t.length;i+=4)e+=`, [${t[i]}, ${t[i+1]}, ${t[i+2]}, ${t[i+3]}]`}else e="[...]";else this.typeInfo instanceof wg?e+="{...}":e="[...]";return e}}class Jd extends wc{constructor(e,t,i,n){super(t,null),this.data=e,this.descriptor=i,this.view=n}clone(){return new Jd(this.data,this.typeInfo,this.descriptor,this.view)}get width(){var e,t;const i=this.descriptor.size;return i instanceof Array&&i.length>0?(e=i[0])!==null&&e!==void 0?e:0:i instanceof Object&&(t=i.width)!==null&&t!==void 0?t:0}get height(){var e,t;const i=this.descriptor.size;return i instanceof Array&&i.length>1?(e=i[1])!==null&&e!==void 0?e:0:i instanceof Object&&(t=i.height)!==null&&t!==void 0?t:0}get depthOrArrayLayers(){var e,t;const i=this.descriptor.size;return i instanceof Array&&i.length>2?(e=i[2])!==null&&e!==void 0?e:0:i instanceof Object&&(t=i.depthOrArrayLayers)!==null&&t!==void 0?t:0}get format(){var e;return this.descriptor&&(e=this.descriptor.format)!==null&&e!==void 0?e:"rgba8unorm"}get sampleCount(){var e;return this.descriptor&&(e=this.descriptor.sampleCount)!==null&&e!==void 0?e:1}get mipLevelCount(){var e;return this.descriptor&&(e=this.descriptor.mipLevelCount)!==null&&e!==void 0?e:1}get dimension(){var e;return this.descriptor&&(e=this.descriptor.dimension)!==null&&e!==void 0?e:"2d"}getMipLevelSize(e){if(e>=this.mipLevelCount)return[0,0,0];const t=[this.width,this.height,this.depthOrArrayLayers];for(let i=0;i<t.length;++i)t[i]=Math.max(1,t[i]>>e);return t}get texelByteSize(){const e=this.format,t=XM[e];return t?t.isDepthStencil?4:t.bytesPerBlock:0}get bytesPerRow(){return this.width*this.texelByteSize}get isDepthStencil(){const e=this.format,t=XM[e];return!!t&&t.isDepthStencil}getGpuSize(){const e=this.format,t=XM[e],i=this.width;if(!e||i<=0||!t)return-1;const n=this.height,a=this.depthOrArrayLayers,s=this.dimension;return i/t.blockWidth*(s==="1d"?1:n/t.blockHeight)*t.bytesPerBlock*a}getPixel(e,t,i=0,n=0){const a=this.texelByteSize,s=this.bytesPerRow,o=this.height,l=this.data[n];return KQ(new Uint8Array(l),e,t,i,n,o,s,a,this.format)}setPixel(e,t,i,n,a){const s=this.texelByteSize,o=this.bytesPerRow,l=this.height,c=this.data[n];(function(f,p,y,b,S,C,E,P,O,B){const F=b*(E>>=S)*(C>>=S)+y*E+p*P;switch(O){case"r8unorm":return void ln(f,F,"8unorm",1,B);case"r8snorm":return void ln(f,F,"8snorm",1,B);case"r8uint":return void ln(f,F,"8uint",1,B);case"r8sint":return void ln(f,F,"8sint",1,B);case"rg8unorm":return void ln(f,F,"8unorm",2,B);case"rg8snorm":return void ln(f,F,"8snorm",2,B);case"rg8uint":return void ln(f,F,"8uint",2,B);case"rg8sint":return void ln(f,F,"8sint",2,B);case"rgba8unorm-srgb":case"rgba8unorm":case"bgra8unorm-srgb":case"bgra8unorm":return void ln(f,F,"8unorm",4,B);case"rgba8snorm":return void ln(f,F,"8snorm",4,B);case"rgba8uint":return void ln(f,F,"8uint",4,B);case"rgba8sint":return void ln(f,F,"8sint",4,B);case"r16uint":return void ln(f,F,"16uint",1,B);case"r16sint":return void ln(f,F,"16sint",1,B);case"r16float":return void ln(f,F,"16float",1,B);case"rg16uint":return void ln(f,F,"16uint",2,B);case"rg16sint":return void ln(f,F,"16sint",2,B);case"rg16float":return void ln(f,F,"16float",2,B);case"rgba16uint":return void ln(f,F,"16uint",4,B);case"rgba16sint":return void ln(f,F,"16sint",4,B);case"rgba16float":return void ln(f,F,"16float",4,B);case"r32uint":return void ln(f,F,"32uint",1,B);case"r32sint":return void ln(f,F,"32sint",1,B);case"depth16unorm":case"depth24plus":case"depth24plus-stencil8":case"depth32float":case"depth32float-stencil8":case"r32float":return void ln(f,F,"32float",1,B);case"rg32uint":return void ln(f,F,"32uint",2,B);case"rg32sint":return void ln(f,F,"32sint",2,B);case"rg32float":return void ln(f,F,"32float",2,B);case"rgba32uint":return void ln(f,F,"32uint",4,B);case"rgba32sint":return void ln(f,F,"32sint",4,B);case"rgba32float":return void ln(f,F,"32float",4,B);case"rg11b10ufloat":console.error("TODO: rg11b10ufloat not supported for writing")}})(new Uint8Array(c),e,t,i,n,l,o,s,this.format,a)}}(r=>{r[r.token=0]="token",r[r.keyword=1]="keyword",r[r.reserved=2]="reserved"})(tt||(tt={}));class rt{constructor(e,t,i){this.name=e,this.type=t,this.rule=i}toString(){return this.name}}class Me{}ut=Me,Me.none=new rt("",tt.reserved,""),Me.eof=new rt("EOF",tt.token,""),Me.reserved={asm:new rt("asm",tt.reserved,"asm"),bf16:new rt("bf16",tt.reserved,"bf16"),do:new rt("do",tt.reserved,"do"),enum:new rt("enum",tt.reserved,"enum"),f16:new rt("f16",tt.reserved,"f16"),f64:new rt("f64",tt.reserved,"f64"),handle:new rt("handle",tt.reserved,"handle"),i8:new rt("i8",tt.reserved,"i8"),i16:new rt("i16",tt.reserved,"i16"),i64:new rt("i64",tt.reserved,"i64"),mat:new rt("mat",tt.reserved,"mat"),premerge:new rt("premerge",tt.reserved,"premerge"),regardless:new rt("regardless",tt.reserved,"regardless"),typedef:new rt("typedef",tt.reserved,"typedef"),u8:new rt("u8",tt.reserved,"u8"),u16:new rt("u16",tt.reserved,"u16"),u64:new rt("u64",tt.reserved,"u64"),unless:new rt("unless",tt.reserved,"unless"),using:new rt("using",tt.reserved,"using"),vec:new rt("vec",tt.reserved,"vec"),void:new rt("void",tt.reserved,"void")},Me.keywords={array:new rt("array",tt.keyword,"array"),atomic:new rt("atomic",tt.keyword,"atomic"),bool:new rt("bool",tt.keyword,"bool"),f32:new rt("f32",tt.keyword,"f32"),i32:new rt("i32",tt.keyword,"i32"),mat2x2:new rt("mat2x2",tt.keyword,"mat2x2"),mat2x3:new rt("mat2x3",tt.keyword,"mat2x3"),mat2x4:new rt("mat2x4",tt.keyword,"mat2x4"),mat3x2:new rt("mat3x2",tt.keyword,"mat3x2"),mat3x3:new rt("mat3x3",tt.keyword,"mat3x3"),mat3x4:new rt("mat3x4",tt.keyword,"mat3x4"),mat4x2:new rt("mat4x2",tt.keyword,"mat4x2"),mat4x3:new rt("mat4x3",tt.keyword,"mat4x3"),mat4x4:new rt("mat4x4",tt.keyword,"mat4x4"),ptr:new rt("ptr",tt.keyword,"ptr"),sampler:new rt("sampler",tt.keyword,"sampler"),sampler_comparison:new rt("sampler_comparison",tt.keyword,"sampler_comparison"),struct:new rt("struct",tt.keyword,"struct"),texture_1d:new rt("texture_1d",tt.keyword,"texture_1d"),texture_2d:new rt("texture_2d",tt.keyword,"texture_2d"),texture_2d_array:new rt("texture_2d_array",tt.keyword,"texture_2d_array"),texture_3d:new rt("texture_3d",tt.keyword,"texture_3d"),texture_cube:new rt("texture_cube",tt.keyword,"texture_cube"),texture_cube_array:new rt("texture_cube_array",tt.keyword,"texture_cube_array"),texture_multisampled_2d:new rt("texture_multisampled_2d",tt.keyword,"texture_multisampled_2d"),texture_storage_1d:new rt("texture_storage_1d",tt.keyword,"texture_storage_1d"),texture_storage_2d:new rt("texture_storage_2d",tt.keyword,"texture_storage_2d"),texture_storage_2d_array:new rt("texture_storage_2d_array",tt.keyword,"texture_storage_2d_array"),texture_storage_3d:new rt("texture_storage_3d",tt.keyword,"texture_storage_3d"),texture_depth_2d:new rt("texture_depth_2d",tt.keyword,"texture_depth_2d"),texture_depth_2d_array:new rt("texture_depth_2d_array",tt.keyword,"texture_depth_2d_array"),texture_depth_cube:new rt("texture_depth_cube",tt.keyword,"texture_depth_cube"),texture_depth_cube_array:new rt("texture_depth_cube_array",tt.keyword,"texture_depth_cube_array"),texture_depth_multisampled_2d:new rt("texture_depth_multisampled_2d",tt.keyword,"texture_depth_multisampled_2d"),texture_external:new rt("texture_external",tt.keyword,"texture_external"),u32:new rt("u32",tt.keyword,"u32"),vec2:new rt("vec2",tt.keyword,"vec2"),vec3:new rt("vec3",tt.keyword,"vec3"),vec4:new rt("vec4",tt.keyword,"vec4"),bitcast:new rt("bitcast",tt.keyword,"bitcast"),block:new rt("block",tt.keyword,"block"),break:new rt("break",tt.keyword,"break"),case:new rt("case",tt.keyword,"case"),continue:new rt("continue",tt.keyword,"continue"),continuing:new rt("continuing",tt.keyword,"continuing"),default:new rt("default",tt.keyword,"default"),diagnostic:new rt("diagnostic",tt.keyword,"diagnostic"),discard:new rt("discard",tt.keyword,"discard"),else:new rt("else",tt.keyword,"else"),enable:new rt("enable",tt.keyword,"enable"),fallthrough:new rt("fallthrough",tt.keyword,"fallthrough"),false:new rt("false",tt.keyword,"false"),fn:new rt("fn",tt.keyword,"fn"),for:new rt("for",tt.keyword,"for"),function:new rt("function",tt.keyword,"function"),if:new rt("if",tt.keyword,"if"),let:new rt("let",tt.keyword,"let"),const:new rt("const",tt.keyword,"const"),loop:new rt("loop",tt.keyword,"loop"),while:new rt("while",tt.keyword,"while"),private:new rt("private",tt.keyword,"private"),read:new rt("read",tt.keyword,"read"),read_write:new rt("read_write",tt.keyword,"read_write"),return:new rt("return",tt.keyword,"return"),requires:new rt("requires",tt.keyword,"requires"),storage:new rt("storage",tt.keyword,"storage"),switch:new rt("switch",tt.keyword,"switch"),true:new rt("true",tt.keyword,"true"),alias:new rt("alias",tt.keyword,"alias"),type:new rt("type",tt.keyword,"type"),uniform:new rt("uniform",tt.keyword,"uniform"),var:new rt("var",tt.keyword,"var"),override:new rt("override",tt.keyword,"override"),workgroup:new rt("workgroup",tt.keyword,"workgroup"),write:new rt("write",tt.keyword,"write"),r8unorm:new rt("r8unorm",tt.keyword,"r8unorm"),r8snorm:new rt("r8snorm",tt.keyword,"r8snorm"),r8uint:new rt("r8uint",tt.keyword,"r8uint"),r8sint:new rt("r8sint",tt.keyword,"r8sint"),r16uint:new rt("r16uint",tt.keyword,"r16uint"),r16sint:new rt("r16sint",tt.keyword,"r16sint"),r16float:new rt("r16float",tt.keyword,"r16float"),rg8unorm:new rt("rg8unorm",tt.keyword,"rg8unorm"),rg8snorm:new rt("rg8snorm",tt.keyword,"rg8snorm"),rg8uint:new rt("rg8uint",tt.keyword,"rg8uint"),rg8sint:new rt("rg8sint",tt.keyword,"rg8sint"),r32uint:new rt("r32uint",tt.keyword,"r32uint"),r32sint:new rt("r32sint",tt.keyword,"r32sint"),r32float:new rt("r32float",tt.keyword,"r32float"),rg16uint:new rt("rg16uint",tt.keyword,"rg16uint"),rg16sint:new rt("rg16sint",tt.keyword,"rg16sint"),rg16float:new rt("rg16float",tt.keyword,"rg16float"),rgba8unorm:new rt("rgba8unorm",tt.keyword,"rgba8unorm"),rgba8unorm_srgb:new rt("rgba8unorm_srgb",tt.keyword,"rgba8unorm_srgb"),rgba8snorm:new rt("rgba8snorm",tt.keyword,"rgba8snorm"),rgba8uint:new rt("rgba8uint",tt.keyword,"rgba8uint"),rgba8sint:new rt("rgba8sint",tt.keyword,"rgba8sint"),bgra8unorm:new rt("bgra8unorm",tt.keyword,"bgra8unorm"),bgra8unorm_srgb:new rt("bgra8unorm_srgb",tt.keyword,"bgra8unorm_srgb"),rgb10a2unorm:new rt("rgb10a2unorm",tt.keyword,"rgb10a2unorm"),rg11b10float:new rt("rg11b10float",tt.keyword,"rg11b10float"),rg32uint:new rt("rg32uint",tt.keyword,"rg32uint"),rg32sint:new rt("rg32sint",tt.keyword,"rg32sint"),rg32float:new rt("rg32float",tt.keyword,"rg32float"),rgba16uint:new rt("rgba16uint",tt.keyword,"rgba16uint"),rgba16sint:new rt("rgba16sint",tt.keyword,"rgba16sint"),rgba16float:new rt("rgba16float",tt.keyword,"rgba16float"),rgba32uint:new rt("rgba32uint",tt.keyword,"rgba32uint"),rgba32sint:new rt("rgba32sint",tt.keyword,"rgba32sint"),rgba32float:new rt("rgba32float",tt.keyword,"rgba32float"),static_assert:new rt("static_assert",tt.keyword,"static_assert")},Me.tokens={decimal_float_literal:new rt("decimal_float_literal",tt.token,/((-?[0-9]*\.[0-9]+|-?[0-9]+\.[0-9]*)((e|E)(\+|-)?[0-9]+)?[fh]?)|(-?[0-9]+(e|E)(\+|-)?[0-9]+[fh]?)|(-?[0-9]+[fh])/),hex_float_literal:new rt("hex_float_literal",tt.token,/-?0x((([0-9a-fA-F]*\.[0-9a-fA-F]+|[0-9a-fA-F]+\.[0-9a-fA-F]*)((p|P)(\+|-)?[0-9]+[fh]?)?)|([0-9a-fA-F]+(p|P)(\+|-)?[0-9]+[fh]?))/),int_literal:new rt("int_literal",tt.token,/-?0x[0-9a-fA-F]+|0i?|-?[1-9][0-9]*i?/),uint_literal:new rt("uint_literal",tt.token,/0x[0-9a-fA-F]+u|0u|[1-9][0-9]*u/),name:new rt("name",tt.token,/([_\p{XID_Start}][\p{XID_Continue}]+)|([\p{XID_Start}])/u),ident:new rt("ident",tt.token,/[_a-zA-Z][0-9a-zA-Z_]*/),and:new rt("and",tt.token,"&"),and_and:new rt("and_and",tt.token,"&&"),arrow:new rt("arrow ",tt.token,"->"),attr:new rt("attr",tt.token,"@"),forward_slash:new rt("forward_slash",tt.token,"/"),bang:new rt("bang",tt.token,"!"),bracket_left:new rt("bracket_left",tt.token,"["),bracket_right:new rt("bracket_right",tt.token,"]"),brace_left:new rt("brace_left",tt.token,"{"),brace_right:new rt("brace_right",tt.token,"}"),colon:new rt("colon",tt.token,":"),comma:new rt("comma",tt.token,","),equal:new rt("equal",tt.token,"="),equal_equal:new rt("equal_equal",tt.token,"=="),not_equal:new rt("not_equal",tt.token,"!="),greater_than:new rt("greater_than",tt.token,">"),greater_than_equal:new rt("greater_than_equal",tt.token,">="),shift_right:new rt("shift_right",tt.token,">>"),less_than:new rt("less_than",tt.token,"<"),less_than_equal:new rt("less_than_equal",tt.token,"<="),shift_left:new rt("shift_left",tt.token,"<<"),modulo:new rt("modulo",tt.token,"%"),minus:new rt("minus",tt.token,"-"),minus_minus:new rt("minus_minus",tt.token,"--"),period:new rt("period",tt.token,"."),plus:new rt("plus",tt.token,"+"),plus_plus:new rt("plus_plus",tt.token,"++"),or:new rt("or",tt.token,"|"),or_or:new rt("or_or",tt.token,"||"),paren_left:new rt("paren_left",tt.token,"("),paren_right:new rt("paren_right",tt.token,")"),semicolon:new rt("semicolon",tt.token,";"),star:new rt("star",tt.token,"*"),tilde:new rt("tilde",tt.token,"~"),underscore:new rt("underscore",tt.token,"_"),xor:new rt("xor",tt.token,"^"),plus_equal:new rt("plus_equal",tt.token,"+="),minus_equal:new rt("minus_equal",tt.token,"-="),times_equal:new rt("times_equal",tt.token,"*="),division_equal:new rt("division_equal",tt.token,"/="),modulo_equal:new rt("modulo_equal",tt.token,"%="),and_equal:new rt("and_equal",tt.token,"&="),or_equal:new rt("or_equal",tt.token,"|="),xor_equal:new rt("xor_equal",tt.token,"^="),shift_right_equal:new rt("shift_right_equal",tt.token,">>="),shift_left_equal:new rt("shift_left_equal",tt.token,"<<=")},Me.simpleTokens={"@":ut.tokens.attr,"{":ut.tokens.brace_left,"}":ut.tokens.brace_right,":":ut.tokens.colon,",":ut.tokens.comma,"(":ut.tokens.paren_left,")":ut.tokens.paren_right,";":ut.tokens.semicolon},Me.literalTokens={"&":ut.tokens.and,"&&":ut.tokens.and_and,"->":ut.tokens.arrow,"/":ut.tokens.forward_slash,"!":ut.tokens.bang,"[":ut.tokens.bracket_left,"]":ut.tokens.bracket_right,"=":ut.tokens.equal,"==":ut.tokens.equal_equal,"!=":ut.tokens.not_equal,">":ut.tokens.greater_than,">=":ut.tokens.greater_than_equal,">>":ut.tokens.shift_right,"<":ut.tokens.less_than,"<=":ut.tokens.less_than_equal,"<<":ut.tokens.shift_left,"%":ut.tokens.modulo,"-":ut.tokens.minus,"--":ut.tokens.minus_minus,".":ut.tokens.period,"+":ut.tokens.plus,"++":ut.tokens.plus_plus,"|":ut.tokens.or,"||":ut.tokens.or_or,"*":ut.tokens.star,"~":ut.tokens.tilde,_:ut.tokens.underscore,"^":ut.tokens.xor,"+=":ut.tokens.plus_equal,"-=":ut.tokens.minus_equal,"*=":ut.tokens.times_equal,"/=":ut.tokens.division_equal,"%=":ut.tokens.modulo_equal,"&=":ut.tokens.and_equal,"|=":ut.tokens.or_equal,"^=":ut.tokens.xor_equal,">>=":ut.tokens.shift_right_equal,"<<=":ut.tokens.shift_left_equal},Me.regexTokens={decimal_float_literal:ut.tokens.decimal_float_literal,hex_float_literal:ut.tokens.hex_float_literal,int_literal:ut.tokens.int_literal,uint_literal:ut.tokens.uint_literal,ident:ut.tokens.ident},Me.storage_class=[ut.keywords.function,ut.keywords.private,ut.keywords.workgroup,ut.keywords.uniform,ut.keywords.storage],Me.access_mode=[ut.keywords.read,ut.keywords.write,ut.keywords.read_write],Me.sampler_type=[ut.keywords.sampler,ut.keywords.sampler_comparison],Me.sampled_texture_type=[ut.keywords.texture_1d,ut.keywords.texture_2d,ut.keywords.texture_2d_array,ut.keywords.texture_3d,ut.keywords.texture_cube,ut.keywords.texture_cube_array],Me.multisampled_texture_type=[ut.keywords.texture_multisampled_2d],Me.storage_texture_type=[ut.keywords.texture_storage_1d,ut.keywords.texture_storage_2d,ut.keywords.texture_storage_2d_array,ut.keywords.texture_storage_3d],Me.depth_texture_type=[ut.keywords.texture_depth_2d,ut.keywords.texture_depth_2d_array,ut.keywords.texture_depth_cube,ut.keywords.texture_depth_cube_array,ut.keywords.texture_depth_multisampled_2d],Me.texture_external_type=[ut.keywords.texture_external],Me.any_texture_type=[...ut.sampled_texture_type,...ut.multisampled_texture_type,...ut.storage_texture_type,...ut.depth_texture_type,...ut.texture_external_type],Me.texel_format=[ut.keywords.r8unorm,ut.keywords.r8snorm,ut.keywords.r8uint,ut.keywords.r8sint,ut.keywords.r16uint,ut.keywords.r16sint,ut.keywords.r16float,ut.keywords.rg8unorm,ut.keywords.rg8snorm,ut.keywords.rg8uint,ut.keywords.rg8sint,ut.keywords.r32uint,ut.keywords.r32sint,ut.keywords.r32float,ut.keywords.rg16uint,ut.keywords.rg16sint,ut.keywords.rg16float,ut.keywords.rgba8unorm,ut.keywords.rgba8unorm_srgb,ut.keywords.rgba8snorm,ut.keywords.rgba8uint,ut.keywords.rgba8sint,ut.keywords.bgra8unorm,ut.keywords.bgra8unorm_srgb,ut.keywords.rgb10a2unorm,ut.keywords.rg11b10float,ut.keywords.rg32uint,ut.keywords.rg32sint,ut.keywords.rg32float,ut.keywords.rgba16uint,ut.keywords.rgba16sint,ut.keywords.rgba16float,ut.keywords.rgba32uint,ut.keywords.rgba32sint,ut.keywords.rgba32float],Me.const_literal=[ut.tokens.int_literal,ut.tokens.uint_literal,ut.tokens.decimal_float_literal,ut.tokens.hex_float_literal,ut.keywords.true,ut.keywords.false],Me.literal_or_ident=[ut.tokens.ident,ut.tokens.int_literal,ut.tokens.uint_literal,ut.tokens.decimal_float_literal,ut.tokens.hex_float_literal,ut.tokens.name],Me.element_count_expression=[ut.tokens.int_literal,ut.tokens.uint_literal,ut.tokens.ident],Me.template_types=[ut.keywords.vec2,ut.keywords.vec3,ut.keywords.vec4,ut.keywords.mat2x2,ut.keywords.mat2x3,ut.keywords.mat2x4,ut.keywords.mat3x2,ut.keywords.mat3x3,ut.keywords.mat3x4,ut.keywords.mat4x2,ut.keywords.mat4x3,ut.keywords.mat4x4,ut.keywords.atomic,ut.keywords.bitcast,...ut.any_texture_type],Me.attribute_name=[ut.tokens.ident,ut.keywords.block,ut.keywords.diagnostic],Me.assignment_operators=[ut.tokens.equal,ut.tokens.plus_equal,ut.tokens.minus_equal,ut.tokens.times_equal,ut.tokens.division_equal,ut.tokens.modulo_equal,ut.tokens.and_equal,ut.tokens.or_equal,ut.tokens.xor_equal,ut.tokens.shift_right_equal,ut.tokens.shift_left_equal],Me.increment_operators=[ut.tokens.plus_plus,ut.tokens.minus_minus];class PN{constructor(e,t,i,n,a){this.type=e,this.lexeme=t,this.line=i,this.start=n,this.end=a}toString(){return this.lexeme}isTemplateType(){return Me.template_types.indexOf(this.type)!=-1}isArrayType(){return this.type==Me.keywords.array}isArrayOrTemplateType(){return this.isArrayType()||this.isTemplateType()}}class nJ{constructor(e){this._tokens=[],this._start=0,this._current=0,this._line=1,this._source=e??""}scanTokens(){for(;!this._isAtEnd();)if(this._start=this._current,!this.scanToken())throw`Invalid syntax at line ${this._line}`;return this._tokens.push(new PN(Me.eof,"",this._line,this._current,this._current)),this._tokens}scanToken(){let e=this._advance();if(e==`
`)return this._line++,!0;if(this._isWhitespace(e))return!0;if(e=="/"){if(this._peekAhead()=="/"){for(;e!=`
`;){if(this._isAtEnd())return!0;e=this._advance()}return this._line++,!0}if(this._peekAhead()=="*"){this._advance();let s=1;for(;s>0;){if(this._isAtEnd())return!0;if(e=this._advance(),e==`
`)this._line++;else if(e=="*"){if(this._peekAhead()=="/"&&(this._advance(),s--,s==0))return!0}else e=="/"&&this._peekAhead()=="*"&&(this._advance(),s++)}return!0}}const t=Me.simpleTokens[e];if(t)return this._addToken(t),!0;let i=Me.none;const n=this._isAlpha(e),a=e==="_";if(this._isAlphaNumeric(e)){let s=this._peekAhead();for(;this._isAlphaNumeric(s);)e+=this._advance(),s=this._peekAhead()}if(n){const s=Me.keywords[e];if(s)return this._addToken(s),!0}if(n||a)return this._addToken(Me.tokens.ident),!0;for(;;){let s=this._findType(e);const o=this._peekAhead();if(e=="-"&&this._tokens.length>0){if(o=="=")return this._current++,e+=o,this._addToken(Me.tokens.minus_equal),!0;if(o=="-")return this._current++,e+=o,this._addToken(Me.tokens.minus_minus),!0;const l=this._tokens.length-1;if((Me.literal_or_ident.indexOf(this._tokens[l].type)!=-1||this._tokens[l].type==Me.tokens.paren_right)&&o!=">")return this._addToken(s),!0}if(e==">"&&(o==">"||o=="=")){let l=!1,c=this._tokens.length-1;for(let f=0;f<5&&c>=0&&Me.assignment_operators.indexOf(this._tokens[c].type)===-1;++f,--c)if(this._tokens[c].type===Me.tokens.less_than){c>0&&this._tokens[c-1].isArrayOrTemplateType()&&(l=!0);break}if(l)return this._addToken(s),!0}if(s===Me.none){let l=e,c=0;const f=2;for(let p=0;p<f;++p)if(l+=this._peekAhead(p),s=this._findType(l),s!==Me.none){c=p;break}if(s===Me.none)return i!==Me.none&&(this._current--,this._addToken(i),!0);e=l,this._current+=c+1}if(i=s,this._isAtEnd())break;e+=this._advance()}return i!==Me.none&&(this._addToken(i),!0)}_findType(e){for(const i in Me.regexTokens){const n=Me.regexTokens[i];if(this._match(e,n.rule))return n}return Me.literalTokens[e]||Me.none}_match(e,t){const i=t.exec(e);return i&&i.index==0&&i[0]==e}_isAtEnd(){return this._current>=this._source.length}_isAlpha(e){return!this._isNumeric(e)&&!this._isWhitespace(e)&&e!=="_"&&e!=="."&&e!=="("&&e!==")"&&e!=="["&&e!=="]"&&e!=="{"&&e!=="}"&&e!==","&&e!==";"&&e!==":"&&e!=="="&&e!=="!"&&e!=="<"&&e!==">"&&e!=="+"&&e!=="-"&&e!=="*"&&e!=="/"&&e!=="%"&&e!=="&"&&e!=="|"&&e!=="^"&&e!=="~"&&e!=="@"&&e!=="#"&&e!=="?"&&e!=="'"&&e!=="`"&&e!=='"'&&e!=="\\"&&e!==`
`&&e!=="\r"&&e!=="	"&&e!=="\0"}_isNumeric(e){return e>="0"&&e<="9"}_isAlphaNumeric(e){return this._isAlpha(e)||this._isNumeric(e)||e==="_"}_isWhitespace(e){return e==" "||e=="	"||e=="\r"}_advance(e=0){let t=this._source[this._current];return e=e||0,e++,this._current+=e,t}_peekAhead(e=0){return e=e||0,this._current+e>=this._source.length?"\0":this._source[this._current+e]}_addToken(e){const t=this._source.substring(this._start,this._current);this._tokens.push(new PN(e,t,this._line,this._start,this._current))}}function ir(r){return Array.isArray(r)||r?.buffer instanceof ArrayBuffer}const nA=new Float32Array(1),aJ=new Uint32Array(nA.buffer),oJ=new Uint32Array(nA.buffer),aA=new Int32Array(1),sJ=new Float32Array(aA.buffer),lJ=new Uint32Array(aA.buffer),oA=new Uint32Array(1),uJ=new Float32Array(oA.buffer),cJ=new Int32Array(oA.buffer);function RN(r,e,t){if(e===t)return r;if(e==="f32"){if(t==="i32"||t==="x32")return nA[0]=r,aJ[0];if(t==="u32")return nA[0]=r,oJ[0]}else if(e==="i32"||e==="x32"){if(t==="f32")return aA[0]=r,sJ[0];if(t==="u32")return aA[0]=r,lJ[0]}else if(e==="u32"){if(t==="f32")return oA[0]=r,uJ[0];if(t==="i32"||t==="x32")return oA[0]=r,cJ[0]}return console.error(`Unsupported cast from ${e} to ${t}`),r}class hJ{constructor(e){this.resources=null,this.inUse=!1,this.info=null,this.node=e}}let nT=class{constructor(e,t){this.align=e,this.size=t}};class Df{constructor(){this.uniforms=[],this.storage=[],this.textures=[],this.samplers=[],this.aliases=[],this.overrides=[],this.structs=[],this.entry=new XQ,this.functions=[],this._types=new Map,this._functions=new Map}_isStorageTexture(e){return e.name=="texture_storage_1d"||e.name=="texture_storage_2d"||e.name=="texture_storage_2d_array"||e.name=="texture_storage_3d"}updateAST(e){for(const t of e)t instanceof Q1&&this._functions.set(t.name,new hJ(t));for(const t of e)if(t instanceof Qd){const i=this.getTypeInfo(t,null);i instanceof wg&&this.structs.push(i)}for(const t of e)if(t instanceof zD)this.aliases.push(this._getAliasInfo(t));else{if(t instanceof ND){const i=t,n=this._getAttributeNum(i.attributes,"id",0),a=i.type!=null?this.getTypeInfo(i.type,i.attributes):null;this.overrides.push(new $Q(i.name,a,i.attributes,n));continue}if(this._isUniformVar(t)){const i=t,n=this._getAttributeNum(i.attributes,"group",0),a=this._getAttributeNum(i.attributes,"binding",0),s=this.getTypeInfo(i.type,i.attributes),o=new iT(i.name,s,n,a,i.attributes,yg.Uniform,i.access);o.access||(o.access="read"),this.uniforms.push(o);continue}if(this._isStorageVar(t)){const i=t,n=this._getAttributeNum(i.attributes,"group",0),a=this._getAttributeNum(i.attributes,"binding",0),s=this.getTypeInfo(i.type,i.attributes),o=this._isStorageTexture(s),l=new iT(i.name,s,n,a,i.attributes,o?yg.StorageTexture:yg.Storage,i.access);l.access||(l.access="read"),this.storage.push(l);continue}if(this._isTextureVar(t)){const i=t,n=this._getAttributeNum(i.attributes,"group",0),a=this._getAttributeNum(i.attributes,"binding",0),s=this.getTypeInfo(i.type,i.attributes),o=this._isStorageTexture(s),l=new iT(i.name,s,n,a,i.attributes,o?yg.StorageTexture:yg.Texture,i.access);l.access||(l.access="read"),o?this.storage.push(l):this.textures.push(l);continue}if(this._isSamplerVar(t)){const i=t,n=this._getAttributeNum(i.attributes,"group",0),a=this._getAttributeNum(i.attributes,"binding",0),s=this.getTypeInfo(i.type,i.attributes),o=new iT(i.name,s,n,a,i.attributes,yg.Sampler,i.access);this.samplers.push(o);continue}}for(const t of e)if(t instanceof Q1){const i=this._getAttribute(t,"vertex"),n=this._getAttribute(t,"fragment"),a=this._getAttribute(t,"compute"),s=i||n||a,o=new GQ(t.name,s?.name,t.attributes);o.attributes=t.attributes,o.startLine=t.startLine,o.endLine=t.endLine,this.functions.push(o),this._functions.get(t.name).info=o,s&&(this._functions.get(t.name).inUse=!0,o.inUse=!0,o.resources=this._findResources(t,!!s),o.inputs=this._getInputs(t.args),o.outputs=this._getOutputs(t.returnType),this.entry[s.name].push(o)),o.arguments=t.args.map(l=>new WQ(l.name,this.getTypeInfo(l.type,l.attributes),l.attributes)),o.returnType=t.returnType?this.getTypeInfo(t.returnType,t.attributes):null;continue}for(const t of this._functions.values())t.info&&(t.info.inUse=t.inUse,this._addCalls(t.node,t.info.calls));for(const t of this._functions.values())t.node.search(i=>{var n,a,s;if(i instanceof mH){if(i.value)if(ir(i.value))for(const o of i.value)for(const l of this.overrides)o===l.name&&((n=t.info)===null||n===void 0||n.overrides.push(l));else for(const o of this.overrides)i.value===o.name&&((a=t.info)===null||a===void 0||a.overrides.push(o))}else if(i instanceof pu)for(const o of this.overrides)i.name===o.name&&((s=t.info)===null||s===void 0||s.overrides.push(o))});for(const t of this.uniforms)this._markStructsInUse(t.type);for(const t of this.storage)this._markStructsInUse(t.type)}getFunctionInfo(e){for(const t of this.functions)if(t.name==e)return t;return null}getStructInfo(e){for(const t of this.structs)if(t.name==e)return t;return null}getOverrideInfo(e){for(const t of this.overrides)if(t.name==e)return t;return null}_markStructsInUse(e){if(e)if(e.isStruct){if(e.inUse=!0,e.members)for(const t of e.members)this._markStructsInUse(t.type)}else if(e.isArray)this._markStructsInUse(e.format);else if(e.isTemplate)e.format&&this._markStructsInUse(e.format);else{const t=this._getAlias(e.name);t&&this._markStructsInUse(t)}}_addCalls(e,t){var i;for(const n of e.calls){const a=(i=this._functions.get(n.name))===null||i===void 0?void 0:i.info;a&&t.add(a)}}findResource(e,t,i){if(i){for(const n of this.entry.compute)if(n.name===i){for(const a of n.resources)if(a.group==e&&a.binding==t)return a}for(const n of this.entry.vertex)if(n.name===i){for(const a of n.resources)if(a.group==e&&a.binding==t)return a}for(const n of this.entry.fragment)if(n.name===i){for(const a of n.resources)if(a.group==e&&a.binding==t)return a}}for(const n of this.uniforms)if(n.group==e&&n.binding==t)return n;for(const n of this.storage)if(n.group==e&&n.binding==t)return n;for(const n of this.textures)if(n.group==e&&n.binding==t)return n;for(const n of this.samplers)if(n.group==e&&n.binding==t)return n;return null}_findResource(e){for(const t of this.uniforms)if(t.name==e)return t;for(const t of this.storage)if(t.name==e)return t;for(const t of this.textures)if(t.name==e)return t;for(const t of this.samplers)if(t.name==e)return t;return null}_markStructsFromAST(e){const t=this.getTypeInfo(e,null);this._markStructsInUse(t)}_findResources(e,t){const i=[],n=this,a=[];return e.search(s=>{if(s instanceof rA)a.push({});else if(s instanceof iA)a.pop();else if(s instanceof ep){const o=s;t&&o.type!==null&&this._markStructsFromAST(o.type),a.length>0&&(a[a.length-1][o.name]=o)}else if(s instanceof Mf){const o=s;t&&o.type!==null&&this._markStructsFromAST(o.type)}else if(s instanceof E1){const o=s;t&&o.type!==null&&this._markStructsFromAST(o.type),a.length>0&&(a[a.length-1][o.name]=o)}else if(s instanceof pu){const o=s;if(a.length>0&&a[a.length-1][o.name])return;const l=n._findResource(o.name);l&&i.push(l)}else if(s instanceof FD){const o=s,l=n._functions.get(o.name);l&&(t&&(l.inUse=!0),e.calls.add(l.node),l.resources===null&&(l.resources=n._findResources(l.node,t)),i.push(...l.resources))}else if(s instanceof BD){const o=s,l=n._functions.get(o.name);l&&(t&&(l.inUse=!0),e.calls.add(l.node),l.resources===null&&(l.resources=n._findResources(l.node,t)),i.push(...l.resources))}}),[...new Map(i.map(s=>[s.name,s])).values()]}getBindGroups(){const e=[];function t(i,n){i>=e.length&&(e.length=i+1),e[i]===void 0&&(e[i]=[]),n>=e[i].length&&(e[i].length=n+1)}for(const i of this.uniforms)t(i.group,i.binding),e[i.group][i.binding]=i;for(const i of this.storage)t(i.group,i.binding),e[i.group][i.binding]=i;for(const i of this.textures)t(i.group,i.binding),e[i.group][i.binding]=i;for(const i of this.samplers)t(i.group,i.binding),e[i.group][i.binding]=i;return e}_getOutputs(e,t=void 0){if(t===void 0&&(t=[]),e instanceof Qd)this._getStructOutputs(e,t);else{const i=this._getOutputInfo(e);i!==null&&t.push(i)}return t}_getStructOutputs(e,t){for(const i of e.members)if(i.type instanceof Qd)this._getStructOutputs(i.type,t);else{const n=this._getAttribute(i,"location")||this._getAttribute(i,"builtin");if(n!==null){const a=this.getTypeInfo(i.type,i.type.attributes),s=this._parseInt(n.value),o=new AN(i.name,a,n.name,s);t.push(o)}}}_getOutputInfo(e){const t=this._getAttribute(e,"location")||this._getAttribute(e,"builtin");if(t!==null){const i=this.getTypeInfo(e,e.attributes),n=this._parseInt(t.value);return new AN("",i,t.name,n)}return null}_getInputs(e,t=void 0){t===void 0&&(t=[]);for(const i of e)if(i.type instanceof Qd)this._getStructInputs(i.type,t);else{const n=this._getInputInfo(i);n!==null&&t.push(n)}return t}_getStructInputs(e,t){for(const i of e.members)if(i.type instanceof Qd)this._getStructInputs(i.type,t);else{const n=this._getInputInfo(i);n!==null&&t.push(n)}}_getInputInfo(e){const t=this._getAttribute(e,"location")||this._getAttribute(e,"builtin");if(t!==null){const i=this._getAttribute(e,"interpolation"),n=this.getTypeInfo(e.type,e.attributes),a=this._parseInt(t.value),s=new jQ(e.name,n,t.name,a);return i!==null&&(s.interpolation=this._parseString(i.value)),s}return null}_parseString(e){return e instanceof Array&&(e=e[0]),e}_parseInt(e){e instanceof Array&&(e=e[0]);const t=parseInt(e);return isNaN(t)?e:t}_getAlias(e){for(const t of this.aliases)if(t.name==e)return t.type;return null}_getAliasInfo(e){return new HQ(e.name,this.getTypeInfo(e.type,null))}getTypeInfoByName(e){for(const t of this.structs)if(t.name==e)return t;for(const t of this.aliases)if(t.name==e)return t.type;return null}getTypeInfo(e,t=null){if(this._types.has(e))return this._types.get(e);if(e instanceof x2){const n=e.type?this.getTypeInfo(e.type,e.attributes):null,a=new eR(e.name,n,t);return this._types.set(e,a),this._updateTypeInfo(a),a}if(e instanceof I1){const n=e,a=n.format?this.getTypeInfo(n.format,n.attributes):null,s=new Dg(n.name,t);return s.format=a,s.count=n.count,this._types.set(e,s),this._updateTypeInfo(s),s}if(e instanceof Qd){const n=e,a=new wg(n.name,t);a.startLine=n.startLine,a.endLine=n.endLine;for(const s of n.members){const o=this.getTypeInfo(s.type,s.attributes);a.members.push(new TN(s.name,o,s.attributes))}return this._types.set(e,a),this._updateTypeInfo(a),a}if(e instanceof c1){const n=e,a=n.format instanceof Rt,s=n.format?a?this.getTypeInfo(n.format,null):new yc(n.format,null):null,o=new cy(n.name,s,t,n.access);return this._types.set(e,o),this._updateTypeInfo(o),o}if(e instanceof nt){const n=e,a=n.format?this.getTypeInfo(n.format,null):null,s=new cy(n.name,a,t,n.access);return this._types.set(e,s),this._updateTypeInfo(s),s}const i=new yc(e.name,t);return this._types.set(e,i),this._updateTypeInfo(i),i}_updateTypeInfo(e){var t,i,n;const a=this._getTypeSize(e);if(e.size=(t=a?.size)!==null&&t!==void 0?t:0,e instanceof Dg&&e.format){const s=this._getTypeSize(e.format);e.stride=Math.max((i=s?.size)!==null&&i!==void 0?i:0,(n=s?.align)!==null&&n!==void 0?n:0),this._updateTypeInfo(e.format)}e instanceof eR&&this._updateTypeInfo(e.format),e instanceof wg&&this._updateStructInfo(e)}_updateStructInfo(e){var t;let i=0,n=0,a=0,s=0;for(let o=0,l=e.members.length;o<l;++o){const c=e.members[o],f=this._getTypeSize(c);if(!f)continue;(t=this._getAlias(c.type.name))!==null&&t!==void 0||c.type;const p=f.align,y=f.size;i=this._roundUp(p,i+n),n=y,a=i,s=Math.max(s,p),c.offset=i,c.size=y,this._updateTypeInfo(c.type)}e.size=this._roundUp(s,a+n),e.align=s}_getTypeSize(e){var t,i;if(e==null)return null;const n=this._getAttributeNum(e.attributes,"size",0),a=this._getAttributeNum(e.attributes,"align",0);if(e instanceof TN&&(e=e.type),e instanceof yc){const s=this._getAlias(e.name);s!==null&&(e=s)}{const s=Df._typeInfo[e.name];if(s!==void 0){const o=((t=e.format)===null||t===void 0?void 0:t.name)==="f16"?2:1;return new nT(Math.max(a,s.align/o),Math.max(n,s.size/o))}}{const s=Df._typeInfo[e.name.substring(0,e.name.length-1)];if(s){const o=e.name[e.name.length-1]==="h"?2:1;return new nT(Math.max(a,s.align/o),Math.max(n,s.size/o))}}if(e instanceof Dg){let s=e,o=8,l=8;const c=this._getTypeSize(s.format);return c!==null&&(l=c.size,o=c.align),l=s.count*this._getAttributeNum((i=e?.attributes)!==null&&i!==void 0?i:null,"stride",this._roundUp(o,l)),n&&(l=n),new nT(Math.max(a,o),Math.max(n,l))}if(e instanceof wg){let s=0,o=0,l=0,c=0,f=0;for(const p of e.members){const y=this._getTypeSize(p.type);y!==null&&(s=Math.max(y.align,s),l=this._roundUp(y.align,l+c),c=y.size,f=l)}return o=this._roundUp(s,f+c),new nT(Math.max(a,s),Math.max(n,o))}return null}_isUniformVar(e){return e instanceof ep&&e.storage=="uniform"}_isStorageVar(e){return e instanceof ep&&e.storage=="storage"}_isTextureVar(e){return e instanceof ep&&e.type!==null&&Df._textureTypes.indexOf(e.type.name)!=-1}_isSamplerVar(e){return e instanceof ep&&e.type!==null&&Df._samplerTypes.indexOf(e.type.name)!=-1}_getAttribute(e,t){const i=e;if(!i||!i.attributes)return null;const n=i.attributes;for(let a of n)if(a.name==t)return a;return null}_getAttributeNum(e,t,i){if(e===null)return i;for(let n of e)if(n.name==t){let a=n!==null&&n.value!==null?n.value:i;return a instanceof Array&&(a=a[0]),typeof a=="number"?a:typeof a=="string"?parseInt(a):i}return i}_roundUp(e,t){return Math.ceil(t/e)*e}}Df._typeInfo={f16:{align:2,size:2},i32:{align:4,size:4},u32:{align:4,size:4},f32:{align:4,size:4},atomic:{align:4,size:4},vec2:{align:8,size:8},vec3:{align:16,size:12},vec4:{align:16,size:16},mat2x2:{align:8,size:16},mat3x2:{align:8,size:24},mat4x2:{align:8,size:32},mat2x3:{align:16,size:32},mat3x3:{align:16,size:48},mat4x3:{align:16,size:64},mat2x4:{align:16,size:32},mat3x4:{align:16,size:48},mat4x4:{align:16,size:64}},Df._textureTypes=Me.any_texture_type.map(r=>r.name),Df._samplerTypes=Me.sampler_type.map(r=>r.name);let VD=0;class UD{constructor(e,t,i){this.id=VD++,this.name=e,this.value=t,this.node=i}clone(){return new UD(this.name,this.value,this.node)}}class HD{constructor(e){this.id=VD++,this.name=e.name,this.node=e}clone(){return new HD(this.node)}}let fJ=class yH{constructor(e){this.parent=null,this.variables=new Map,this.functions=new Map,this.currentFunctionName="",this.id=VD++,e&&(this.parent=e,this.currentFunctionName=e.currentFunctionName)}getVariable(e){var t;return this.variables.has(e)?(t=this.variables.get(e))!==null&&t!==void 0?t:null:this.parent?this.parent.getVariable(e):null}getFunction(e){var t;return this.functions.has(e)?(t=this.functions.get(e))!==null&&t!==void 0?t:null:this.parent?this.parent.getFunction(e):null}createVariable(e,t,i){this.variables.set(e,new UD(e,t,i??null))}setVariable(e,t,i){const n=this.getVariable(e);n!==null?n.value=t:this.createVariable(e,t,i)}getVariableValue(e){var t;const i=this.getVariable(e);return(t=i?.value)!==null&&t!==void 0?t:null}clone(){return new yH(this)}};class dJ{evalExpression(e,t){return null}getTypeInfo(e){return null}getVariableName(e,t){return""}}class pJ{constructor(e){this.exec=e}getTypeInfo(e){return this.exec.getTypeInfo(e)}All(e,t){const i=this.exec.evalExpression(e.args[0],t);let n=!0;if(i instanceof Pe)return i.data.forEach(a=>{a||(n=!1)}),new et(n?1:0,this.getTypeInfo("bool"));throw new Error(`All() expects a vector argument. Line ${e.line}`)}Any(e,t){const i=this.exec.evalExpression(e.args[0],t);if(i instanceof Pe){const n=i.data.some(a=>a);return new et(n?1:0,this.getTypeInfo("bool"))}throw new Error(`Any() expects a vector argument. Line ${e.line}`)}Select(e,t){const i=this.exec.evalExpression(e.args[2],t);if(!(i instanceof et))throw new Error(`Select() expects a bool condition. Line ${e.line}`);return i.value?this.exec.evalExpression(e.args[1],t):this.exec.evalExpression(e.args[0],t)}ArrayLength(e,t){let i=e.args[0];i instanceof Wa&&(i=i.right);const n=this.exec.evalExpression(i,t);if(n instanceof Sa&&n.typeInfo.size===0){const a=n.typeInfo,s=n.buffer.byteLength/a.stride;return new et(s,this.getTypeInfo("u32"))}return new et(n.typeInfo.size,this.getTypeInfo("u32"))}Abs(e,t){const i=this.exec.evalExpression(e.args[0],t);if(i instanceof Pe)return new Pe(i.data.map(a=>Math.abs(a)),i.typeInfo);const n=i;return new et(Math.abs(n.value),n.typeInfo)}Acos(e,t){const i=this.exec.evalExpression(e.args[0],t);if(i instanceof Pe)return new Pe(i.data.map(a=>Math.acos(a)),i.typeInfo);const n=i;return new et(Math.acos(n.value),i.typeInfo)}Acosh(e,t){const i=this.exec.evalExpression(e.args[0],t);if(i instanceof Pe)return new Pe(i.data.map(a=>Math.acosh(a)),i.typeInfo);const n=i;return new et(Math.acosh(n.value),i.typeInfo)}Asin(e,t){const i=this.exec.evalExpression(e.args[0],t);if(i instanceof Pe)return new Pe(i.data.map(a=>Math.asin(a)),i.typeInfo);const n=i;return new et(Math.asin(n.value),i.typeInfo)}Asinh(e,t){const i=this.exec.evalExpression(e.args[0],t);if(i instanceof Pe)return new Pe(i.data.map(a=>Math.asinh(a)),i.typeInfo);const n=i;return new et(Math.asinh(n.value),i.typeInfo)}Atan(e,t){const i=this.exec.evalExpression(e.args[0],t);if(i instanceof Pe)return new Pe(i.data.map(a=>Math.atan(a)),i.typeInfo);const n=i;return new et(Math.atan(n.value),i.typeInfo)}Atanh(e,t){const i=this.exec.evalExpression(e.args[0],t);if(i instanceof Pe)return new Pe(i.data.map(a=>Math.atanh(a)),i.typeInfo);const n=i;return new et(Math.atanh(n.value),i.typeInfo)}Atan2(e,t){const i=this.exec.evalExpression(e.args[0],t),n=this.exec.evalExpression(e.args[1],t);if(i instanceof Pe&&n instanceof Pe)return new Pe(i.data.map((o,l)=>Math.atan2(o,n.data[l])),i.typeInfo);const a=i,s=n;return new et(Math.atan2(a.value,s.value),i.typeInfo)}Ceil(e,t){const i=this.exec.evalExpression(e.args[0],t);if(i instanceof Pe)return new Pe(i.data.map(a=>Math.ceil(a)),i.typeInfo);const n=i;return new et(Math.ceil(n.value),i.typeInfo)}_clamp(e,t,i){return Math.min(Math.max(e,t),i)}Clamp(e,t){const i=this.exec.evalExpression(e.args[0],t),n=this.exec.evalExpression(e.args[1],t),a=this.exec.evalExpression(e.args[2],t);if(i instanceof Pe&&n instanceof Pe&&a instanceof Pe)return new Pe(i.data.map((c,f)=>this._clamp(c,n.data[f],a.data[f])),i.typeInfo);const s=i,o=n,l=a;return new et(this._clamp(s.value,o.value,l.value),i.typeInfo)}Cos(e,t){const i=this.exec.evalExpression(e.args[0],t);if(i instanceof Pe)return new Pe(i.data.map(a=>Math.cos(a)),i.typeInfo);const n=i;return new et(Math.cos(n.value),i.typeInfo)}Cosh(e,t){const i=this.exec.evalExpression(e.args[0],t);if(i instanceof Pe)return new Pe(i.data.map(a=>Math.cosh(a)),i.typeInfo);const n=i;return new et(Math.cos(n.value),i.typeInfo)}CountLeadingZeros(e,t){const i=this.exec.evalExpression(e.args[0],t);if(i instanceof Pe)return new Pe(i.data.map(a=>Math.clz32(a)),i.typeInfo);const n=i;return new et(Math.clz32(n.value),i.typeInfo)}_countOneBits(e){let t=0;for(;e!==0;)1&e&&t++,e>>=1;return t}CountOneBits(e,t){const i=this.exec.evalExpression(e.args[0],t);if(i instanceof Pe)return new Pe(i.data.map(a=>this._countOneBits(a)),i.typeInfo);const n=i;return new et(this._countOneBits(n.value),i.typeInfo)}_countTrailingZeros(e){if(e===0)return 32;let t=0;for(;!(1&e);)e>>=1,t++;return t}CountTrailingZeros(e,t){const i=this.exec.evalExpression(e.args[0],t);if(i instanceof Pe)return new Pe(i.data.map(a=>this._countTrailingZeros(a)),i.typeInfo);const n=i;return new et(this._countTrailingZeros(n.value),i.typeInfo)}Cross(e,t){const i=this.exec.evalExpression(e.args[0],t),n=this.exec.evalExpression(e.args[1],t);if(i instanceof Pe&&n instanceof Pe){if(i.data.length!==3||n.data.length!==3)return console.error(`Cross() expects 3D vectors. Line ${e.line}`),null;const a=i.data,s=n.data;return new Pe([a[1]*s[2]-s[1]*a[2],a[2]*s[0]-s[2]*a[0],a[0]*s[1]-s[0]*a[1]],i.typeInfo)}return console.error(`Cross() expects vector arguments. Line ${e.line}`),null}Degrees(e,t){const i=this.exec.evalExpression(e.args[0],t),n=180/Math.PI;return i instanceof Pe?new Pe(i.data.map(a=>a*n),i.typeInfo):new et(i.value*n,this.getTypeInfo("f32"))}Determinant(e,t){const i=this.exec.evalExpression(e.args[0],t);if(i instanceof Fr){const n=i.data,a=i.typeInfo.getTypeName(),s=a.endsWith("h")?this.getTypeInfo("f16"):this.getTypeInfo("f32");if(a==="mat2x2"||a==="mat2x2f"||a==="mat2x2h")return new et(n[0]*n[3]-n[1]*n[2],s);if(a==="mat2x3"||a==="mat2x3f"||a==="mat2x3h")return new et(n[0]*(n[4]*n[8]-n[5]*n[7])-n[1]*(n[3]*n[8]-n[5]*n[6])+n[2]*(n[3]*n[7]-n[4]*n[6]),s);if(a==="mat2x4"||a==="mat2x4f"||a==="mat2x4h")console.error(`TODO: Determinant for ${a}`);else if(a==="mat3x2"||a==="mat3x2f"||a==="mat3x2h")console.error(`TODO: Determinant for ${a}`);else{if(a==="mat3x3"||a==="mat3x3f"||a==="mat3x3h")return new et(n[0]*(n[4]*n[8]-n[5]*n[7])-n[1]*(n[3]*n[8]-n[5]*n[6])+n[2]*(n[3]*n[7]-n[4]*n[6]),s);a==="mat3x4"||a==="mat3x4f"||a==="mat3x4h"||a==="mat4x2"||a==="mat4x2f"||a==="mat4x2h"||a==="mat4x3"||a==="mat4x3f"||a==="mat4x3h"?console.error(`TODO: Determinant for ${a}`):a!=="mat4x4"&&a!=="mat4x4f"&&a!=="mat4x4h"||console.error(`TODO: Determinant for ${a}`)}}return console.error(`Determinant expects a matrix argument. Line ${e.line}`),null}Distance(e,t){const i=this.exec.evalExpression(e.args[0],t),n=this.exec.evalExpression(e.args[1],t);if(i instanceof Pe&&n instanceof Pe){let o=0;for(let l=0;l<i.data.length;++l)o+=(i.data[l]-n.data[l])*(i.data[l]-n.data[l]);return new et(Math.sqrt(o),this.getTypeInfo("f32"))}const a=i,s=n;return new et(Math.abs(a.value-s.value),i.typeInfo)}_dot(e,t){let i=0;for(let n=0;n<e.length;++n)i+=t[n]*e[n];return i}Dot(e,t){const i=this.exec.evalExpression(e.args[0],t),n=this.exec.evalExpression(e.args[1],t);return i instanceof Pe&&n instanceof Pe?new et(this._dot(i.data,n.data),this.getTypeInfo("f32")):(console.error(`Dot() expects vector arguments. Line ${e.line}`),null)}Dot4U8Packed(e,t){return console.error(`TODO: dot4U8Packed. Line ${e.line}`),null}Dot4I8Packed(e,t){return console.error(`TODO: dot4I8Packed. Line ${e.line}`),null}Exp(e,t){const i=this.exec.evalExpression(e.args[0],t);if(i instanceof Pe)return new Pe(i.data.map(a=>Math.exp(a)),i.typeInfo);const n=i;return new et(Math.exp(n.value),i.typeInfo)}Exp2(e,t){const i=this.exec.evalExpression(e.args[0],t);if(i instanceof Pe)return new Pe(i.data.map(a=>Math.pow(2,a)),i.typeInfo);const n=i;return new et(Math.pow(2,n.value),i.typeInfo)}ExtractBits(e,t){const i=this.exec.evalExpression(e.args[0],t),n=this.exec.evalExpression(e.args[1],t),a=this.exec.evalExpression(e.args[2],t);if(n.typeInfo.name!=="u32"&&n.typeInfo.name!=="x32")return console.error(`ExtractBits() expects an i32 offset argument. Line ${e.line}`),null;if(a.typeInfo.name!=="u32"&&a.typeInfo.name!=="x32")return console.error(`ExtractBits() expects an i32 count argument. Line ${e.line}`),null;const s=n.value,o=a.value;if(i instanceof Pe)return new Pe(i.data.map(c=>c>>s&(1<<o)-1),i.typeInfo);if(i.typeInfo.name!=="i32"&&i.typeInfo.name!=="x32")return console.error(`ExtractBits() expects an i32 argument. Line ${e.line}`),null;const l=i.value;return new et(l>>s&(1<<o)-1,this.getTypeInfo("i32"))}FaceForward(e,t){const i=this.exec.evalExpression(e.args[0],t),n=this.exec.evalExpression(e.args[1],t),a=this.exec.evalExpression(e.args[2],t);if(i instanceof Pe&&n instanceof Pe&&a instanceof Pe){const s=this._dot(n.data,a.data);return new Pe(s<0?Array.from(i.data):i.data.map(o=>-o),i.typeInfo)}return console.error(`FaceForward() expects vector arguments. Line ${e.line}`),null}_firstLeadingBit(e){return e===0?-1:31-Math.clz32(e)}FirstLeadingBit(e,t){const i=this.exec.evalExpression(e.args[0],t);if(i instanceof Pe)return new Pe(i.data.map(a=>this._firstLeadingBit(a)),i.typeInfo);const n=i;return new et(this._firstLeadingBit(n.value),i.typeInfo)}_firstTrailingBit(e){return e===0?-1:Math.log2(e&-e)}FirstTrailingBit(e,t){const i=this.exec.evalExpression(e.args[0],t);if(i instanceof Pe)return new Pe(i.data.map(a=>this._firstTrailingBit(a)),i.typeInfo);const n=i;return new et(this._firstTrailingBit(n.value),i.typeInfo)}Floor(e,t){const i=this.exec.evalExpression(e.args[0],t);if(i instanceof Pe)return new Pe(i.data.map(a=>Math.floor(a)),i.typeInfo);const n=i;return new et(Math.floor(n.value),i.typeInfo)}Fma(e,t){const i=this.exec.evalExpression(e.args[0],t),n=this.exec.evalExpression(e.args[1],t),a=this.exec.evalExpression(e.args[2],t);if(i instanceof Pe&&n instanceof Pe&&a instanceof Pe)return i.data.length!==n.data.length||i.data.length!==a.data.length?(console.error(`Fma() expects vectors of the same length. Line ${e.line}`),null):new Pe(i.data.map((c,f)=>c*n.data[f]+a.data[f]),i.typeInfo);const s=i,o=n,l=a;return new et(s.value*o.value+l.value,s.typeInfo)}Fract(e,t){const i=this.exec.evalExpression(e.args[0],t);if(i instanceof Pe)return new Pe(i.data.map(a=>a-Math.floor(a)),i.typeInfo);const n=i;return new et(n.value-Math.floor(n.value),i.typeInfo)}Frexp(e,t){return console.error(`TODO: frexp. Line ${e.line}`),null}InsertBits(e,t){const i=this.exec.evalExpression(e.args[0],t),n=this.exec.evalExpression(e.args[1],t),a=this.exec.evalExpression(e.args[2],t),s=this.exec.evalExpression(e.args[3],t);if(a.typeInfo.name!=="u32"&&a.typeInfo.name!=="x32")return console.error(`InsertBits() expects an i32 offset argument. Line ${e.line}`),null;const o=a.value,l=(1<<s.value)-1<<o,c=~l;if(i instanceof Pe&&n instanceof Pe)return new Pe(i.data.map((y,b)=>y&c|n.data[b]<<o&l),i.typeInfo);const f=i.value,p=n.value;return new et(f&c|p<<o&l,i.typeInfo)}InverseSqrt(e,t){const i=this.exec.evalExpression(e.args[0],t);if(i instanceof Pe)return new Pe(i.data.map(a=>1/Math.sqrt(a)),i.typeInfo);const n=i;return new et(1/Math.sqrt(n.value),i.typeInfo)}Ldexp(e,t){return console.error(`TODO: ldexp. Line ${e.line}`),null}Length(e,t){const i=this.exec.evalExpression(e.args[0],t);if(i instanceof Pe){let a=0;return i.data.forEach(s=>{a+=s*s}),new et(Math.sqrt(a),this.getTypeInfo("f32"))}const n=i;return new et(Math.abs(n.value),i.typeInfo)}Log(e,t){const i=this.exec.evalExpression(e.args[0],t);if(i instanceof Pe)return new Pe(i.data.map(a=>Math.log(a)),i.typeInfo);const n=i;return new et(Math.log(n.value),i.typeInfo)}Log2(e,t){const i=this.exec.evalExpression(e.args[0],t);if(i instanceof Pe)return new Pe(i.data.map(a=>Math.log2(a)),i.typeInfo);const n=i;return new et(Math.log2(n.value),i.typeInfo)}Max(e,t){const i=this.exec.evalExpression(e.args[0],t),n=this.exec.evalExpression(e.args[1],t);if(i instanceof Pe&&n instanceof Pe)return new Pe(i.data.map((o,l)=>Math.max(o,n.data[l])),i.typeInfo);const a=i,s=n;return new et(Math.max(a.value,s.value),i.typeInfo)}Min(e,t){const i=this.exec.evalExpression(e.args[0],t),n=this.exec.evalExpression(e.args[1],t);if(i instanceof Pe&&n instanceof Pe)return new Pe(i.data.map((o,l)=>Math.min(o,n.data[l])),i.typeInfo);const a=i,s=n;return new et(Math.min(a.value,s.value),i.typeInfo)}Mix(e,t){const i=this.exec.evalExpression(e.args[0],t),n=this.exec.evalExpression(e.args[1],t),a=this.exec.evalExpression(e.args[2],t);if(i instanceof Pe&&n instanceof Pe&&a instanceof Pe)return new Pe(i.data.map((l,c)=>i.data[c]*(1-a.data[c])+n.data[c]*a.data[c]),i.typeInfo);const s=n,o=a;return new et(i.value*(1-o.value)+s.value*o.value,i.typeInfo)}Modf(e,t){const i=this.exec.evalExpression(e.args[0],t),n=this.exec.evalExpression(e.args[1],t);if(i instanceof Pe&&n instanceof Pe)return new Pe(i.data.map((s,o)=>s%n.data[o]),i.typeInfo);const a=n;return new et(i.value%a.value,i.typeInfo)}Normalize(e,t){const i=this.exec.evalExpression(e.args[0],t);if(i instanceof Pe){const n=this.Length(e,t).value;return new Pe(i.data.map(a=>a/n),i.typeInfo)}return console.error(`Normalize() expects a vector argument. Line ${e.line}`),null}Pow(e,t){const i=this.exec.evalExpression(e.args[0],t),n=this.exec.evalExpression(e.args[1],t);if(i instanceof Pe&&n instanceof Pe)return new Pe(i.data.map((o,l)=>Math.pow(o,n.data[l])),i.typeInfo);const a=i,s=n;return new et(Math.pow(a.value,s.value),i.typeInfo)}QuantizeToF16(e,t){const i=this.exec.evalExpression(e.args[0],t);return i instanceof Pe?new Pe(i.data.map(n=>n),i.typeInfo):new et(i.value,i.typeInfo)}Radians(e,t){const i=this.exec.evalExpression(e.args[0],t);return i instanceof Pe?new Pe(i.data.map(n=>n*Math.PI/180),i.typeInfo):new et(i.value*Math.PI/180,this.getTypeInfo("f32"))}Reflect(e,t){let i=this.exec.evalExpression(e.args[0],t),n=this.exec.evalExpression(e.args[1],t);if(i instanceof Pe&&n instanceof Pe){const a=this._dot(i.data,n.data);return new Pe(i.data.map((s,o)=>s-2*a*n.data[o]),i.typeInfo)}return console.error(`Reflect() expects vector arguments. Line ${e.line}`),null}Refract(e,t){let i=this.exec.evalExpression(e.args[0],t),n=this.exec.evalExpression(e.args[1],t),a=this.exec.evalExpression(e.args[2],t);if(i instanceof Pe&&n instanceof Pe&&a instanceof et){const s=this._dot(n.data,i.data);return new Pe(i.data.map((o,l)=>{const c=1-a.value*a.value*(1-s*s);if(c<0)return 0;const f=Math.sqrt(c);return a.value*o-(a.value*s+f)*n.data[l]}),i.typeInfo)}return console.error(`Refract() expects vector arguments and a scalar argument. Line ${e.line}`),null}ReverseBits(e,t){return console.error(`TODO: reverseBits. Line ${e.line}`),null}Round(e,t){const i=this.exec.evalExpression(e.args[0],t);if(i instanceof Pe)return new Pe(i.data.map(a=>Math.round(a)),i.typeInfo);const n=i;return new et(Math.round(n.value),i.typeInfo)}Saturate(e,t){const i=this.exec.evalExpression(e.args[0],t);if(i instanceof Pe)return new Pe(i.data.map(a=>Math.min(Math.max(a,0),1)),i.typeInfo);const n=i;return new et(Math.min(Math.max(n.value,0),1),i.typeInfo)}Sign(e,t){const i=this.exec.evalExpression(e.args[0],t);if(i instanceof Pe)return new Pe(i.data.map(a=>Math.sign(a)),i.typeInfo);const n=i;return new et(Math.sign(n.value),i.typeInfo)}Sin(e,t){const i=this.exec.evalExpression(e.args[0],t);if(i instanceof Pe)return new Pe(i.data.map(a=>Math.sin(a)),i.typeInfo);const n=i;return new et(Math.sin(n.value),i.typeInfo)}Sinh(e,t){const i=this.exec.evalExpression(e.args[0],t);if(i instanceof Pe)return new Pe(i.data.map(a=>Math.sinh(a)),i.typeInfo);const n=i;return new et(Math.sinh(n.value),i.typeInfo)}_smoothstep(e,t,i){const n=Math.min(Math.max((i-e)/(t-e),0),1);return n*n*(3-2*n)}SmoothStep(e,t){const i=this.exec.evalExpression(e.args[0],t),n=this.exec.evalExpression(e.args[1],t),a=this.exec.evalExpression(e.args[2],t);if(a instanceof Pe&&i instanceof Pe&&n instanceof Pe)return new Pe(a.data.map((c,f)=>this._smoothstep(i.data[f],n.data[f],c)),a.typeInfo);const s=i,o=n,l=a;return new et(this._smoothstep(s.value,o.value,l.value),a.typeInfo)}Sqrt(e,t){const i=this.exec.evalExpression(e.args[0],t);if(i instanceof Pe)return new Pe(i.data.map(a=>Math.sqrt(a)),i.typeInfo);const n=i;return new et(Math.sqrt(n.value),i.typeInfo)}Step(e,t){const i=this.exec.evalExpression(e.args[0],t),n=this.exec.evalExpression(e.args[1],t);if(n instanceof Pe&&i instanceof Pe)return new Pe(n.data.map((s,o)=>s<i.data[o]?0:1),n.typeInfo);const a=i;return new et(n.value<a.value?0:1,a.typeInfo)}Tan(e,t){const i=this.exec.evalExpression(e.args[0],t);if(i instanceof Pe)return new Pe(i.data.map(a=>Math.tan(a)),i.typeInfo);const n=i;return new et(Math.tan(n.value),i.typeInfo)}Tanh(e,t){const i=this.exec.evalExpression(e.args[0],t);if(i instanceof Pe)return new Pe(i.data.map(a=>Math.tanh(a)),i.typeInfo);const n=i;return new et(Math.tanh(n.value),i.typeInfo)}_getTransposeType(e){const t=e.getTypeName();return t==="mat2x2f"||t==="mat2x2h"?e:t==="mat2x3f"?this.getTypeInfo("mat3x2f"):t==="mat2x3h"?this.getTypeInfo("mat3x2h"):t==="mat2x4f"?this.getTypeInfo("mat4x2f"):t==="mat2x4h"?this.getTypeInfo("mat4x2h"):t==="mat3x2f"?this.getTypeInfo("mat2x3f"):t==="mat3x2h"?this.getTypeInfo("mat2x3h"):t==="mat3x3f"||t==="mat3x3h"?e:t==="mat3x4f"?this.getTypeInfo("mat4x3f"):t==="mat3x4h"?this.getTypeInfo("mat4x3h"):t==="mat4x2f"?this.getTypeInfo("mat2x4f"):t==="mat4x2h"?this.getTypeInfo("mat2x4h"):t==="mat4x3f"?this.getTypeInfo("mat3x4f"):t==="mat4x3h"?this.getTypeInfo("mat3x4h"):(t==="mat4x4f"||t==="mat4x4h"||console.error(`Invalid matrix type ${t}`),e)}Transpose(e,t){const i=this.exec.evalExpression(e.args[0],t);if(!(i instanceof Fr))return console.error(`Transpose() expects a matrix argument. Line ${e.line}`),null;const n=this._getTransposeType(i.typeInfo);if(i.typeInfo.name==="mat2x2"||i.typeInfo.name==="mat2x2f"||i.typeInfo.name==="mat2x2h"){const a=i.data;return new Fr([a[0],a[2],a[1],a[3]],n)}if(i.typeInfo.name==="mat2x3"||i.typeInfo.name==="mat2x3f"||i.typeInfo.name==="mat2x3h"){const a=i.data;return new Fr([a[0],a[3],a[6],a[1],a[4],a[7]],n)}if(i.typeInfo.name==="mat2x4"||i.typeInfo.name==="mat2x4f"||i.typeInfo.name==="mat2x4h"){const a=i.data;return new Fr([a[0],a[4],a[8],a[12],a[1],a[5],a[9],a[13]],n)}if(i.typeInfo.name==="mat3x2"||i.typeInfo.name==="mat3x2f"||i.typeInfo.name==="mat3x2h"){const a=i.data;return new Fr([a[0],a[3],a[1],a[4],a[2],a[5]],n)}if(i.typeInfo.name==="mat3x3"||i.typeInfo.name==="mat3x3f"||i.typeInfo.name==="mat3x3h"){const a=i.data;return new Fr([a[0],a[3],a[6],a[1],a[4],a[7],a[2],a[5],a[8]],n)}if(i.typeInfo.name==="mat3x4"||i.typeInfo.name==="mat3x4f"||i.typeInfo.name==="mat3x4h"){const a=i.data;return new Fr([a[0],a[4],a[8],a[12],a[1],a[5],a[9],a[13],a[2],a[6],a[10],a[14]],n)}if(i.typeInfo.name==="mat4x2"||i.typeInfo.name==="mat4x2f"||i.typeInfo.name==="mat4x2h"){const a=i.data;return new Fr([a[0],a[4],a[1],a[5],a[2],a[6]],n)}if(i.typeInfo.name==="mat4x3"||i.typeInfo.name==="mat4x3f"||i.typeInfo.name==="mat4x3h"){const a=i.data;return new Fr([a[0],a[4],a[8],a[1],a[5],a[9],a[2],a[6],a[10]],n)}if(i.typeInfo.name==="mat4x4"||i.typeInfo.name==="mat4x4f"||i.typeInfo.name==="mat4x4h"){const a=i.data;return new Fr([a[0],a[4],a[8],a[12],a[1],a[5],a[9],a[13],a[2],a[6],a[10],a[14],a[3],a[7],a[11],a[15]],n)}return console.error(`Invalid matrix type ${i.typeInfo.name}`),null}Trunc(e,t){const i=this.exec.evalExpression(e.args[0],t);if(i instanceof Pe)return new Pe(i.data.map(a=>Math.trunc(a)),i.typeInfo);const n=i;return new et(Math.trunc(n.value),i.typeInfo)}Dpdx(e,t){return console.error(`TODO: dpdx. Line ${e.line}`),null}DpdxCoarse(e,t){return console.error(`TODO: dpdxCoarse. Line ${e.line}`),null}DpdxFine(e,t){return console.error("TODO: dpdxFine"),null}Dpdy(e,t){return console.error("TODO: dpdy"),null}DpdyCoarse(e,t){return console.error("TODO: dpdyCoarse"),null}DpdyFine(e,t){return console.error("TODO: dpdyFine"),null}Fwidth(e,t){return console.error("TODO: fwidth"),null}FwidthCoarse(e,t){return console.error("TODO: fwidthCoarse"),null}FwidthFine(e,t){return console.error("TODO: fwidthFine"),null}TextureDimensions(e,t){const i=e.args[0],n=e.args.length>1?this.exec.evalExpression(e.args[1],t).value:0;if(i instanceof pu){const a=i.name,s=t.getVariableValue(a);if(s instanceof Jd){if(n<0||n>=s.mipLevelCount)return console.error(`Invalid mip level for textureDimensions. Line ${e.line}`),null;const o=s.getMipLevelSize(n),l=s.dimension;return l==="1d"?new et(o[0],this.getTypeInfo("u32")):l==="3d"?new Pe(o,this.getTypeInfo("vec3u")):l==="2d"?new Pe(o.slice(0,2),this.getTypeInfo("vec2u")):(console.error(`Invalid texture dimension ${l} not found. Line ${e.line}`),null)}return console.error(`Texture ${a} not found. Line ${e.line}`),null}return console.error(`Invalid texture argument for textureDimensions. Line ${e.line}`),null}TextureGather(e,t){return console.error("TODO: textureGather"),null}TextureGatherCompare(e,t){return console.error("TODO: textureGatherCompare"),null}TextureLoad(e,t){const i=e.args[0],n=this.exec.evalExpression(e.args[1],t),a=e.args.length>2?this.exec.evalExpression(e.args[2],t).value:0;if(!(n instanceof Pe)||n.data.length!==2)return console.error(`Invalid UV argument for textureLoad. Line ${e.line}`),null;if(i instanceof pu){const s=i.name,o=t.getVariableValue(s);if(o instanceof Jd){const l=Math.floor(n.data[0]),c=Math.floor(n.data[1]);if(l<0||l>=o.width||c<0||c>=o.height)return console.error(`Texture ${s} out of bounds. Line ${e.line}`),null;const f=o.getPixel(l,c,0,a);return f===null?(console.error(`Invalid texture format for textureLoad. Line ${e.line}`),null):new Pe(f,this.getTypeInfo("vec4f"))}return console.error(`Texture ${s} not found. Line ${e.line}`),null}return console.error(`Invalid texture argument for textureLoad. Line ${e.line}`),null}TextureNumLayers(e,t){const i=e.args[0];if(i instanceof pu){const n=i.name,a=t.getVariableValue(n);return a instanceof Jd?new et(a.depthOrArrayLayers,this.getTypeInfo("u32")):(console.error(`Texture ${n} not found. Line ${e.line}`),null)}return console.error(`Invalid texture argument for textureNumLayers. Line ${e.line}`),null}TextureNumLevels(e,t){const i=e.args[0];if(i instanceof pu){const n=i.name,a=t.getVariableValue(n);return a instanceof Jd?new et(a.mipLevelCount,this.getTypeInfo("u32")):(console.error(`Texture ${n} not found. Line ${e.line}`),null)}return console.error(`Invalid texture argument for textureNumLevels. Line ${e.line}`),null}TextureNumSamples(e,t){const i=e.args[0];if(i instanceof pu){const n=i.name,a=t.getVariableValue(n);return a instanceof Jd?new et(a.sampleCount,this.getTypeInfo("u32")):(console.error(`Texture ${n} not found. Line ${e.line}`),null)}return console.error(`Invalid texture argument for textureNumSamples. Line ${e.line}`),null}TextureSample(e,t){return console.error("TODO: textureSample"),null}TextureSampleBias(e,t){return console.error("TODO: textureSampleBias"),null}TextureSampleCompare(e,t){return console.error("TODO: textureSampleCompare"),null}TextureSampleCompareLevel(e,t){return console.error("TODO: textureSampleCompareLevel"),null}TextureSampleGrad(e,t){return console.error("TODO: textureSampleGrad"),null}TextureSampleLevel(e,t){return console.error("TODO: textureSampleLevel"),null}TextureSampleBaseClampToEdge(e,t){return console.error("TODO: textureSampleBaseClampToEdge"),null}TextureStore(e,t){const i=e.args[0],n=this.exec.evalExpression(e.args[1],t),a=e.args.length===4?this.exec.evalExpression(e.args[2],t).value:0,s=e.args.length===4?this.exec.evalExpression(e.args[3],t).data:this.exec.evalExpression(e.args[2],t).data;if(s.length!==4)return console.error(`Invalid value argument for textureStore. Line ${e.line}`),null;if(!(n instanceof Pe)||n.data.length!==2)return console.error(`Invalid UV argument for textureStore. Line ${e.line}`),null;if(i instanceof pu){const o=i.name,l=t.getVariableValue(o);if(l instanceof Jd){const c=l.getMipLevelSize(0),f=Math.floor(n.data[0]),p=Math.floor(n.data[1]);return f<0||f>=c[0]||p<0||p>=c[1]?(console.error(`Texture ${o} out of bounds. Line ${e.line}`),null):(l.setPixel(f,p,0,a,Array.from(s)),null)}return console.error(`Texture ${o} not found. Line ${e.line}`),null}return console.error(`Invalid texture argument for textureStore. Line ${e.line}`),null}AtomicLoad(e,t){let i=e.args[0];i instanceof Wa&&(i=i.right);const n=this.exec.getVariableName(i,t);return t.getVariable(n).value.getSubData(this.exec,i.postfix,t)}AtomicStore(e,t){let i=e.args[0];i instanceof Wa&&(i=i.right);const n=this.exec.getVariableName(i,t),a=t.getVariable(n);let s=e.args[1];const o=this.exec.evalExpression(s,t),l=a.value.getSubData(this.exec,i.postfix,t);return l instanceof et&&o instanceof et&&(l.value=o.value),a.value instanceof Sa&&a.value.setDataValue(this.exec,l,i.postfix,t),null}AtomicAdd(e,t){let i=e.args[0];i instanceof Wa&&(i=i.right);const n=this.exec.getVariableName(i,t),a=t.getVariable(n);let s=e.args[1];const o=this.exec.evalExpression(s,t),l=a.value.getSubData(this.exec,i.postfix,t),c=new et(l.value,l.typeInfo);return l instanceof et&&o instanceof et&&(l.value+=o.value),a.value instanceof Sa&&a.value.setDataValue(this.exec,l,i.postfix,t),c}AtomicSub(e,t){let i=e.args[0];i instanceof Wa&&(i=i.right);const n=this.exec.getVariableName(i,t),a=t.getVariable(n);let s=e.args[1];const o=this.exec.evalExpression(s,t),l=a.value.getSubData(this.exec,i.postfix,t),c=new et(l.value,l.typeInfo);return l instanceof et&&o instanceof et&&(l.value-=o.value),a.value instanceof Sa&&a.value.setDataValue(this.exec,l,i.postfix,t),c}AtomicMax(e,t){let i=e.args[0];i instanceof Wa&&(i=i.right);const n=this.exec.getVariableName(i,t),a=t.getVariable(n);let s=e.args[1];const o=this.exec.evalExpression(s,t),l=a.value.getSubData(this.exec,i.postfix,t),c=new et(l.value,l.typeInfo);return l instanceof et&&o instanceof et&&(l.value=Math.max(l.value,o.value)),a.value instanceof Sa&&a.value.setDataValue(this.exec,l,i.postfix,t),c}AtomicMin(e,t){let i=e.args[0];i instanceof Wa&&(i=i.right);const n=this.exec.getVariableName(i,t),a=t.getVariable(n);let s=e.args[1];const o=this.exec.evalExpression(s,t),l=a.value.getSubData(this.exec,i.postfix,t),c=new et(l.value,l.typeInfo);return l instanceof et&&o instanceof et&&(l.value=Math.min(l.value,o.value)),a.value instanceof Sa&&a.value.setDataValue(this.exec,l,i.postfix,t),c}AtomicAnd(e,t){let i=e.args[0];i instanceof Wa&&(i=i.right);const n=this.exec.getVariableName(i,t),a=t.getVariable(n);let s=e.args[1];const o=this.exec.evalExpression(s,t),l=a.value.getSubData(this.exec,i.postfix,t),c=new et(l.value,l.typeInfo);return l instanceof et&&o instanceof et&&(l.value=l.value&o.value),a.value instanceof Sa&&a.value.setDataValue(this.exec,l,i.postfix,t),c}AtomicOr(e,t){let i=e.args[0];i instanceof Wa&&(i=i.right);const n=this.exec.getVariableName(i,t),a=t.getVariable(n);let s=e.args[1];const o=this.exec.evalExpression(s,t),l=a.value.getSubData(this.exec,i.postfix,t),c=new et(l.value,l.typeInfo);return l instanceof et&&o instanceof et&&(l.value=l.value|o.value),a.value instanceof Sa&&a.value.setDataValue(this.exec,l,i.postfix,t),c}AtomicXor(e,t){let i=e.args[0];i instanceof Wa&&(i=i.right);const n=this.exec.getVariableName(i,t),a=t.getVariable(n);let s=e.args[1];const o=this.exec.evalExpression(s,t),l=a.value.getSubData(this.exec,i.postfix,t),c=new et(l.value,l.typeInfo);return l instanceof et&&o instanceof et&&(l.value=l.value^o.value),a.value instanceof Sa&&a.value.setDataValue(this.exec,l,i.postfix,t),c}AtomicExchange(e,t){let i=e.args[0];i instanceof Wa&&(i=i.right);const n=this.exec.getVariableName(i,t),a=t.getVariable(n);let s=e.args[1];const o=this.exec.evalExpression(s,t),l=a.value.getSubData(this.exec,i.postfix,t),c=new et(l.value,l.typeInfo);return l instanceof et&&o instanceof et&&(l.value=o.value),a.value instanceof Sa&&a.value.setDataValue(this.exec,l,i.postfix,t),c}AtomicCompareExchangeWeak(e,t){return console.error("TODO: atomicCompareExchangeWeak"),null}Pack4x8snorm(e,t){return console.error("TODO: pack4x8snorm"),null}Pack4x8unorm(e,t){return console.error("TODO: pack4x8unorm"),null}Pack4xI8(e,t){return console.error("TODO: pack4xI8"),null}Pack4xU8(e,t){return console.error("TODO: pack4xU8"),null}Pack4x8Clamp(e,t){return console.error("TODO: pack4x8Clamp"),null}Pack4xU8Clamp(e,t){return console.error("TODO: pack4xU8Clamp"),null}Pack2x16snorm(e,t){return console.error("TODO: pack2x16snorm"),null}Pack2x16unorm(e,t){return console.error("TODO: pack2x16unorm"),null}Pack2x16float(e,t){return console.error("TODO: pack2x16float"),null}Unpack4x8snorm(e,t){return console.error("TODO: unpack4x8snorm"),null}Unpack4x8unorm(e,t){return console.error("TODO: unpack4x8unorm"),null}Unpack4xI8(e,t){return console.error("TODO: unpack4xI8"),null}Unpack4xU8(e,t){return console.error("TODO: unpack4xU8"),null}Unpack2x16snorm(e,t){return console.error("TODO: unpack2x16snorm"),null}Unpack2x16unorm(e,t){return console.error("TODO: unpack2x16unorm"),null}Unpack2x16float(e,t){return console.error("TODO: unpack2x16float"),null}StorageBarrier(e,t){return null}TextureBarrier(e,t){return null}WorkgroupBarrier(e,t){return null}WorkgroupUniformLoad(e,t){return null}SubgroupAdd(e,t){return console.error("TODO: subgroupAdd"),null}SubgroupExclusiveAdd(e,t){return console.error("TODO: subgroupExclusiveAdd"),null}SubgroupInclusiveAdd(e,t){return console.error("TODO: subgroupInclusiveAdd"),null}SubgroupAll(e,t){return console.error("TODO: subgroupAll"),null}SubgroupAnd(e,t){return console.error("TODO: subgroupAnd"),null}SubgroupAny(e,t){return console.error("TODO: subgroupAny"),null}SubgroupBallot(e,t){return console.error("TODO: subgroupBallot"),null}SubgroupBroadcast(e,t){return console.error("TODO: subgroupBroadcast"),null}SubgroupBroadcastFirst(e,t){return console.error("TODO: subgroupBroadcastFirst"),null}SubgroupElect(e,t){return console.error("TODO: subgroupElect"),null}SubgroupMax(e,t){return console.error("TODO: subgroupMax"),null}SubgroupMin(e,t){return console.error("TODO: subgroupMin"),null}SubgroupMul(e,t){return console.error("TODO: subgroupMul"),null}SubgroupExclusiveMul(e,t){return console.error("TODO: subgroupExclusiveMul"),null}SubgroupInclusiveMul(e,t){return console.error("TODO: subgroupInclusiveMul"),null}SubgroupOr(e,t){return console.error("TODO: subgroupOr"),null}SubgroupShuffle(e,t){return console.error("TODO: subgroupShuffle"),null}SubgroupShuffleDown(e,t){return console.error("TODO: subgroupShuffleDown"),null}SubgroupShuffleUp(e,t){return console.error("TODO: subgroupShuffleUp"),null}SubgroupShuffleXor(e,t){return console.error("TODO: subgroupShuffleXor"),null}SubgroupXor(e,t){return console.error("TODO: subgroupXor"),null}QuadBroadcast(e,t){return console.error("TODO: quadBroadcast"),null}QuadSwapDiagonal(e,t){return console.error("TODO: quadSwapDiagonal"),null}QuadSwapX(e,t){return console.error("TODO: quadSwapX"),null}QuadSwapY(e,t){return console.error("TODO: quadSwapY"),null}}const ZM={vec2:2,vec2f:2,vec2i:2,vec2u:2,vec2b:2,vec2h:2,vec3:3,vec3f:3,vec3i:3,vec3u:3,vec3b:3,vec3h:3,vec4:4,vec4f:4,vec4i:4,vec4u:4,vec4b:4,vec4h:4},Js={mat2x2:[2,2,4],mat2x2f:[2,2,4],mat2x2h:[2,2,4],mat2x3:[2,3,6],mat2x3f:[2,3,6],mat2x3h:[2,3,6],mat2x4:[2,4,8],mat2x4f:[2,4,8],mat2x4h:[2,4,8],mat3x2:[3,2,6],mat3x2f:[3,2,6],mat3x2h:[3,2,6],mat3x3:[3,3,9],mat3x3f:[3,3,9],mat3x3h:[3,3,9],mat3x4:[3,4,12],mat3x4f:[3,4,12],mat3x4h:[3,4,12],mat4x2:[4,2,8],mat4x2f:[4,2,8],mat4x2h:[4,2,8],mat4x3:[4,3,12],mat4x3f:[4,3,12],mat4x3h:[4,3,12],mat4x4:[4,4,16],mat4x4f:[4,4,16],mat4x4h:[4,4,16]};class Ts extends dJ{constructor(e,t){var i;super(),this.ast=e??[],this.reflection=new Df,this.reflection.updateAST(this.ast),this.context=(i=t?.clone())!==null&&i!==void 0?i:new fJ,this.builtins=new pJ(this),this.typeInfo={bool:this.getTypeInfo(Rt.bool),i32:this.getTypeInfo(Rt.i32),u32:this.getTypeInfo(Rt.u32),f32:this.getTypeInfo(Rt.f32),f16:this.getTypeInfo(Rt.f16),vec2f:this.getTypeInfo(nt.vec2f),vec2u:this.getTypeInfo(nt.vec2u),vec2i:this.getTypeInfo(nt.vec2i),vec2h:this.getTypeInfo(nt.vec2h),vec3f:this.getTypeInfo(nt.vec3f),vec3u:this.getTypeInfo(nt.vec3u),vec3i:this.getTypeInfo(nt.vec3i),vec3h:this.getTypeInfo(nt.vec3h),vec4f:this.getTypeInfo(nt.vec4f),vec4u:this.getTypeInfo(nt.vec4u),vec4i:this.getTypeInfo(nt.vec4i),vec4h:this.getTypeInfo(nt.vec4h),mat2x2f:this.getTypeInfo(nt.mat2x2f),mat2x3f:this.getTypeInfo(nt.mat2x3f),mat2x4f:this.getTypeInfo(nt.mat2x4f),mat3x2f:this.getTypeInfo(nt.mat3x2f),mat3x3f:this.getTypeInfo(nt.mat3x3f),mat3x4f:this.getTypeInfo(nt.mat3x4f),mat4x2f:this.getTypeInfo(nt.mat4x2f),mat4x3f:this.getTypeInfo(nt.mat4x3f),mat4x4f:this.getTypeInfo(nt.mat4x4f)}}getVariableValue(e){var t,i;const n=(i=(t=this.context.getVariable(e))===null||t===void 0?void 0:t.value)!==null&&i!==void 0?i:null;if(n===null)return null;if(n instanceof et)return n.value;if(n instanceof Pe||n instanceof Fr)return Array.from(n.data);if(n instanceof Sa&&n.typeInfo instanceof Dg){if(n.typeInfo.format.name==="u32")return Array.from(new Uint32Array(n.buffer,n.offset,n.typeInfo.count));if(n.typeInfo.format.name==="i32")return Array.from(new Int32Array(n.buffer,n.offset,n.typeInfo.count));if(n.typeInfo.format.name==="f32")return Array.from(new Float32Array(n.buffer,n.offset,n.typeInfo.count))}return console.error(`Unsupported return variable type ${n.typeInfo.name}`),null}execute(e){(e=e??{}).constants&&this._setOverrides(e.constants,this.context),this._execStatements(this.ast,this.context)}dispatchWorkgroups(e,t,i,n){const a=this.context.clone();(n=n??{}).constants&&this._setOverrides(n.constants,a),this._execStatements(this.ast,a);const s=a.getFunction(e);if(!s)return void console.error(`Function ${e} not found`);if(typeof t=="number")t=[t,1,1];else{if(t.length===0)return void console.error("Invalid dispatch count");t.length===1?t=[t[0],1,1]:t.length===2?t=[t[0],t[1],1]:t.length>3&&(t=[t[0],t[1],t[2]])}const o=t[0],l=t[1],c=t[2],f=this.getTypeInfo("vec3u");a.setVariable("@num_workgroups",new Pe(t,f));const p=this.reflection.getFunctionInfo(e);p===null&&console.error(`Function ${e} not found in reflection data`);for(const y in i)for(const b in i[y]){const S=i[y][b];a.variables.forEach(C=>{var E;const P=C.node;if(P?.attributes){let O=null,B=null;for(const F of P.attributes)F.name==="binding"?O=F.value:F.name==="group"&&(B=F.value);if(b==O&&y==B){let F=!1;for(const W of p.resources)if(W.name===C.name&&W.group===parseInt(y)&&W.binding===parseInt(b)){F=!0;break}if(F)if(S.texture!==void 0&&S.descriptor!==void 0){const W=new Jd(S.texture,this.getTypeInfo(P.type),S.descriptor,(E=S.texture.view)!==null&&E!==void 0?E:null);C.value=W}else S.uniform!==void 0?C.value=new Sa(S.uniform,this.getTypeInfo(P.type)):C.value=new Sa(S,this.getTypeInfo(P.type))}}})}for(let y=0;y<c;++y)for(let b=0;b<l;++b)for(let S=0;S<o;++S)a.setVariable("@workgroup_id",new Pe([S,b,y],this.getTypeInfo("vec3u"))),this._dispatchWorkgroup(s,[S,b,y],a)}execStatement(e,t){if(e instanceof sH)return this.evalExpression(e.value,t);if(e instanceof uH){if(e.condition){const i=this.evalExpression(e.condition,t);if(!(i instanceof et))throw new Error("Invalid break-if condition");if(!i.value)return null}return Ts._breakObj}if(e instanceof cH)return Ts._continueObj;if(e instanceof E1)this._let(e,t);else if(e instanceof ep)this._var(e,t);else if(e instanceof b2)this._const(e,t);else if(e instanceof Q1)this._function(e,t);else{if(e instanceof oH)return this._if(e,t);if(e instanceof aH)return this._switch(e,t);if(e instanceof tH)return this._for(e,t);if(e instanceof eH)return this._while(e,t);if(e instanceof nH)return this._loop(e,t);if(e instanceof tR){const i=t.clone();return i.currentFunctionName=t.currentFunctionName,this._execStatements(e.body,i)}if(e instanceof iH)this._assign(e,t);else if(e instanceof rH)this._increment(e,t);else{if(e instanceof Qd)return null;if(e instanceof ND){const i=e.name;t.getVariable(i)===null&&t.setVariable(i,new et(0,this.getTypeInfo("u32")))}else if(e instanceof BD)this._call(e,t);else{if(e instanceof lH||e instanceof zD)return null;console.error("Invalid statement type.",e,`Line ${e.line}`)}}}return null}evalExpression(e,t){return e instanceof vh?this._evalBinaryOp(e,t):e instanceof no?this._evalLiteral(e,t):e instanceof pu?this._evalVariable(e,t):e instanceof FD?this._evalCall(e,t):e instanceof Mf?this._evalCreate(e,t):e instanceof hH?this._evalConst(e,t):e instanceof fH?this._evalBitcast(e,t):e instanceof Wa?this._evalUnaryOp(e,t):(console.error("Invalid expression type",e,`Line ${e.line}`),null)}getTypeInfo(e){var t;if(e instanceof Rt){const n=this.reflection.getTypeInfo(e);if(n!==null)return n}let i=(t=this.typeInfo[e])!==null&&t!==void 0?t:null;return i!==null||(i=this.reflection.getTypeInfoByName(e)),i}_setOverrides(e,t){for(const i in e){const n=e[i],a=this.reflection.getOverrideInfo(i);a!==null?(a.type===null&&(a.type=this.getTypeInfo("u32")),a.type.name==="u32"||a.type.name==="i32"||a.type.name==="f32"||a.type.name==="f16"?t.setVariable(i,new et(n,a.type)):a.type.name==="bool"?t.setVariable(i,new et(n?1:0,a.type)):a.type.name==="vec2"||a.type.name==="vec3"||a.type.name==="vec4"||a.type.name==="vec2f"||a.type.name==="vec3f"||a.type.name==="vec4f"||a.type.name==="vec2i"||a.type.name==="vec3i"||a.type.name==="vec4i"||a.type.name==="vec2u"||a.type.name==="vec3u"||a.type.name==="vec4u"||a.type.name==="vec2h"||a.type.name==="vec3h"||a.type.name==="vec4h"?t.setVariable(i,new Pe(n,a.type)):console.error(`Invalid constant type for ${i}`)):console.error(`Override ${i} does not exist in the shader.`)}}_dispatchWorkgroup(e,t,i){const n=[1,1,1];for(const f of e.node.attributes)if(f.name==="workgroup_size"){if(f.value.length>0){const p=i.getVariableValue(f.value[0]);n[0]=p instanceof et?p.value:parseInt(f.value[0])}if(f.value.length>1){const p=i.getVariableValue(f.value[1]);n[1]=p instanceof et?p.value:parseInt(f.value[1])}if(f.value.length>2){const p=i.getVariableValue(f.value[2]);n[2]=p instanceof et?p.value:parseInt(f.value[2])}}const a=this.getTypeInfo("vec3u"),s=this.getTypeInfo("u32");i.setVariable("@workgroup_size",new Pe(n,a));const o=n[0],l=n[1],c=n[2];for(let f=0,p=0;f<c;++f)for(let y=0;y<l;++y)for(let b=0;b<o;++b,++p){const S=[b,y,f],C=[b+t[0]*n[0],y+t[1]*n[1],f+t[2]*n[2]];i.setVariable("@local_invocation_id",new Pe(S,a)),i.setVariable("@global_invocation_id",new Pe(C,a)),i.setVariable("@local_invocation_index",new et(p,s)),this._dispatchExec(e,i)}}_dispatchExec(e,t){for(const i of e.node.args)for(const n of i.attributes)if(n.name==="builtin"){const a=`@${n.value}`,s=t.getVariable(a);s!==void 0&&t.variables.set(i.name,s)}this._execStatements(e.node.body,t)}getVariableName(e,t){for(;e instanceof Wa;)e=e.right;return e instanceof pu?e.name:(console.error("Unknown variable type",e,"Line",e.line),null)}_execStatements(e,t){for(const i of e){if(i instanceof Array){const a=t.clone(),s=this._execStatements(i,a);if(s)return s;continue}const n=this.execStatement(i,t);if(n)return n}return null}_call(e,t){const i=t.clone();i.currentFunctionName=e.name;const n=t.getFunction(e.name);if(n){for(let a=0;a<n.node.args.length;++a){const s=n.node.args[a],o=this.evalExpression(e.args[a],i);i.setVariable(s.name,o,s)}this._execStatements(n.node.body,i)}else e.isBuiltin?this._callBuiltinFunction(e,i):this.getTypeInfo(e.name)&&this._evalCreate(e,t)}_increment(e,t){const i=this.getVariableName(e.variable,t),n=t.getVariable(i);n?e.operator==="++"?n.value instanceof et?n.value.value++:console.error(`Variable ${i} is not a scalar. Line ${e.line}`):e.operator==="--"?n.value instanceof et?n.value.value--:console.error(`Variable ${i} is not a scalar. Line ${e.line}`):console.error(`Unknown increment operator ${e.operator}. Line ${e.line}`):console.error(`Variable ${i} not found. Line ${e.line}`)}_getVariableData(e,t){if(e instanceof pu){const i=this.getVariableName(e,t),n=t.getVariable(i);return n===null?(console.error(`Variable ${i} not found. Line ${e.line}`),null):n.value.getSubData(this,e.postfix,t)}if(e instanceof Wa){if(e.operator==="*"){const i=this._getVariableData(e.right,t);return i instanceof O_?i.reference.getSubData(this,e.postfix,t):(console.error(`Variable ${e.right} is not a pointer. Line ${e.line}`),null)}if(e.operator==="&"){const i=this._getVariableData(e.right,t);return new O_(i)}}return null}_assign(e,t){let i=null,n="<var>",a=null;if(e.variable instanceof Wa){const l=this._getVariableData(e.variable,t),c=this.evalExpression(e.value,t),f=e.operator;if(f==="="){if(l instanceof et||l instanceof Pe||l instanceof Fr){if(c instanceof et||c instanceof Pe||c instanceof Fr&&l.data.length===c.data.length)return void l.data.set(c.data);console.error(`Invalid assignment. Line ${e.line}`)}else if(l instanceof Sa&&c instanceof Sa&&l.buffer.byteLength-l.offset>=c.buffer.byteLength-c.offset)return void(l.buffer.byteLength%4==0?new Uint32Array(l.buffer,l.offset,l.typeInfo.size/4).set(new Uint32Array(c.buffer,c.offset,c.typeInfo.size/4)):new Uint8Array(l.buffer,l.offset,l.typeInfo.size).set(new Uint8Array(c.buffer,c.offset,c.typeInfo.size)));return console.error(`Invalid assignment. Line ${e.line}`),null}if(f==="+=")return l instanceof et||l instanceof Pe||l instanceof Fr?c instanceof et||c instanceof Pe||c instanceof Fr?void l.data.set(c.data.map((p,y)=>l.data[y]+p)):void console.error(`Invalid assignment . Line ${e.line}`):void console.error(`Invalid assignment. Line ${e.line}`);if(f==="-=")return(l instanceof et||l instanceof Pe||l instanceof Fr)&&(c instanceof et||c instanceof Pe||c instanceof Fr)?void l.data.set(c.data.map((p,y)=>l.data[y]-p)):void console.error(`Invalid assignment. Line ${e.line}`)}if(e.variable instanceof Wa){if(e.variable.operator==="*"){n=this.getVariableName(e.variable.right,t);const l=t.getVariable(n);if(!(l&&l.value instanceof O_))return void console.error(`Variable ${n} is not a pointer. Line ${e.line}`);i=l.value.reference;let c=e.variable.postfix;if(!c){let f=e.variable.right;for(;f instanceof Wa;){if(f.postfix){c=f.postfix;break}f=f.right}}c&&(i=i.getSubData(this,c,t))}}else{a=e.variable.postfix,n=this.getVariableName(e.variable,t);const l=t.getVariable(n);if(l===null)return void console.error(`Variable ${n} not found. Line ${e.line}`);i=l.value}if(i instanceof O_&&(i=i.reference),i===null)return void console.error(`Variable ${n} not found. Line ${e.line}`);const s=this.evalExpression(e.value,t),o=e.operator;if(o!=="="){const l=i.getSubData(this,a,t);if(l instanceof Pe&&s instanceof et){const c=l.data,f=s.value;if(o==="+=")for(let p=0;p<c.length;++p)c[p]+=f;else if(o==="-=")for(let p=0;p<c.length;++p)c[p]-=f;else if(o==="*=")for(let p=0;p<c.length;++p)c[p]*=f;else if(o==="/=")for(let p=0;p<c.length;++p)c[p]/=f;else if(o==="%=")for(let p=0;p<c.length;++p)c[p]%=f;else if(o==="&=")for(let p=0;p<c.length;++p)c[p]&=f;else if(o==="|=")for(let p=0;p<c.length;++p)c[p]|=f;else if(o==="^=")for(let p=0;p<c.length;++p)c[p]^=f;else if(o==="<<=")for(let p=0;p<c.length;++p)c[p]<<=f;else if(o===">>=")for(let p=0;p<c.length;++p)c[p]>>=f;else console.error(`Invalid operator ${o}. Line ${e.line}`)}else if(l instanceof Pe&&s instanceof Pe){const c=l.data,f=s.data;if(c.length!==f.length)return void console.error(`Vector length mismatch. Line ${e.line}`);if(o==="+=")for(let p=0;p<c.length;++p)c[p]+=f[p];else if(o==="-=")for(let p=0;p<c.length;++p)c[p]-=f[p];else if(o==="*=")for(let p=0;p<c.length;++p)c[p]*=f[p];else if(o==="/=")for(let p=0;p<c.length;++p)c[p]/=f[p];else if(o==="%=")for(let p=0;p<c.length;++p)c[p]%=f[p];else if(o==="&=")for(let p=0;p<c.length;++p)c[p]&=f[p];else if(o==="|=")for(let p=0;p<c.length;++p)c[p]|=f[p];else if(o==="^=")for(let p=0;p<c.length;++p)c[p]^=f[p];else if(o==="<<=")for(let p=0;p<c.length;++p)c[p]<<=f[p];else if(o===">>=")for(let p=0;p<c.length;++p)c[p]>>=f[p];else console.error(`Invalid operator ${o}. Line ${e.line}`)}else{if(!(l instanceof et&&s instanceof et))return void console.error(`Invalid type for ${e.operator} operator. Line ${e.line}`);o==="+="?l.value+=s.value:o==="-="?l.value-=s.value:o==="*="?l.value*=s.value:o==="/="?l.value/=s.value:o==="%="?l.value%=s.value:o==="&="?l.value&=s.value:o==="|="?l.value|=s.value:o==="^="?l.value^=s.value:o==="<<="?l.value<<=s.value:o===">>="?l.value>>=s.value:console.error(`Invalid operator ${o}. Line ${e.line}`)}return void(i instanceof Sa&&i.setDataValue(this,l,a,t))}if(i instanceof Sa)i.setDataValue(this,s,a,t);else if(a){if(!(i instanceof Pe||i instanceof Fr))return void console.error(`Variable ${n} is not a vector or matrix. Line ${e.line}`);if(a instanceof L0){const l=this.evalExpression(a.index,t).value;if(i instanceof Pe){if(!(s instanceof et))return void console.error(`Invalid assignment to ${n}. Line ${e.line}`);i.data[l]=s.value}else{if(!(i instanceof Fr))return void console.error(`Invalid assignment to ${n}. Line ${e.line}`);{const c=this.evalExpression(a.index,t).value;if(c<0)return void console.error(`Invalid assignment to ${n}. Line ${e.line}`);if(!(s instanceof Pe))return void console.error(`Invalid assignment to ${n}. Line ${e.line}`);{const f=i.typeInfo.getTypeName();if(f==="mat2x2"||f==="mat2x2f"||f==="mat2x2h"){if(!(c<2&&s.data.length===2))return void console.error(`Invalid assignment to ${n}. Line ${e.line}`);i.data[2*c]=s.data[0],i.data[2*c+1]=s.data[1]}else if(f==="mat2x3"||f==="mat2x3f"||f==="mat2x3h"){if(!(c<2&&s.data.length===3))return void console.error(`Invalid assignment to ${n}. Line ${e.line}`);i.data[3*c]=s.data[0],i.data[3*c+1]=s.data[1],i.data[3*c+2]=s.data[2]}else if(f==="mat2x4"||f==="mat2x4f"||f==="mat2x4h"){if(!(c<2&&s.data.length===4))return void console.error(`Invalid assignment to ${n}. Line ${e.line}`);i.data[4*c]=s.data[0],i.data[4*c+1]=s.data[1],i.data[4*c+2]=s.data[2],i.data[4*c+3]=s.data[3]}else if(f==="mat3x2"||f==="mat3x2f"||f==="mat3x2h"){if(!(c<3&&s.data.length===2))return void console.error(`Invalid assignment to ${n}. Line ${e.line}`);i.data[2*c]=s.data[0],i.data[2*c+1]=s.data[1]}else if(f==="mat3x3"||f==="mat3x3f"||f==="mat3x3h"){if(!(c<3&&s.data.length===3))return void console.error(`Invalid assignment to ${n}. Line ${e.line}`);i.data[3*c]=s.data[0],i.data[3*c+1]=s.data[1],i.data[3*c+2]=s.data[2]}else if(f==="mat3x4"||f==="mat3x4f"||f==="mat3x4h"){if(!(c<3&&s.data.length===4))return void console.error(`Invalid assignment to ${n}. Line ${e.line}`);i.data[4*c]=s.data[0],i.data[4*c+1]=s.data[1],i.data[4*c+2]=s.data[2],i.data[4*c+3]=s.data[3]}else if(f==="mat4x2"||f==="mat4x2f"||f==="mat4x2h"){if(!(c<4&&s.data.length===2))return void console.error(`Invalid assignment to ${n}. Line ${e.line}`);i.data[2*c]=s.data[0],i.data[2*c+1]=s.data[1]}else if(f==="mat4x3"||f==="mat4x3f"||f==="mat4x3h"){if(!(c<4&&s.data.length===3))return void console.error(`Invalid assignment to ${n}. Line ${e.line}`);i.data[3*c]=s.data[0],i.data[3*c+1]=s.data[1],i.data[3*c+2]=s.data[2]}else{if(f!=="mat4x4"&&f!=="mat4x4f"&&f!=="mat4x4h")return void console.error(`Invalid assignment to ${n}. Line ${e.line}`);if(!(c<4&&s.data.length===4))return void console.error(`Invalid assignment to ${n}. Line ${e.line}`);i.data[4*c]=s.data[0],i.data[4*c+1]=s.data[1],i.data[4*c+2]=s.data[2],i.data[4*c+3]=s.data[3]}}}}}else if(a instanceof hy){const l=a.value;if(!(i instanceof Pe))return void console.error(`Invalid assignment to ${l}. Variable ${n} is not a vector. Line ${e.line}`);if(s instanceof et){if(l.length>1)return void console.error(`Invalid assignment to ${l} for variable ${n}. Line ${e.line}`);if(l==="x")i.data[0]=s.value;else if(l==="y"){if(i.data.length<2)return void console.error(`Invalid assignment to ${l} for variable ${n}. Line ${e.line}`);i.data[1]=s.value}else if(l==="z"){if(i.data.length<3)return void console.error(`Invalid assignment to ${l} for variable ${n}. Line ${e.line}`);i.data[2]=s.value}else if(l==="w"){if(i.data.length<4)return void console.error(`Invalid assignment to ${l} for variable ${n}. Line ${e.line}`);i.data[3]=s.value}}else{if(!(s instanceof Pe))return void console.error(`Invalid assignment to ${n}. Line ${e.line}`);if(l.length!==s.data.length)return void console.error(`Invalid assignment to ${l} for variable ${n}. Line ${e.line}`);for(let c=0;c<l.length;++c){const f=l[c];if(f==="x"||f==="r")i.data[0]=s.data[c];else if(f==="y"||f==="g"){if(s.data.length<2)return void console.error(`Invalid assignment to ${f} for variable ${n}. Line ${e.line}`);i.data[1]=s.data[c]}else if(f==="z"||f==="b"){if(s.data.length<3)return void console.error(`Invalid assignment to ${f} for variable ${n}. Line ${e.line}`);i.data[2]=s.data[c]}else{if(f!=="w"&&f!=="a")return void console.error(`Invalid assignment to ${f} for variable ${n}. Line ${e.line}`);if(s.data.length<4)return void console.error(`Invalid assignment to ${f} for variable ${n}. Line ${e.line}`);i.data[3]=s.data[c]}}}}}else i instanceof et&&s instanceof et?i.value=s.value:i instanceof Pe&&s instanceof Pe||i instanceof Fr&&s instanceof Fr?i.data.set(s.data):console.error(`Invalid assignment to ${n}. Line ${e.line}`)}_function(e,t){const i=new HD(e);t.functions.set(e.name,i)}_const(e,t){let i=null;e.value!==null&&(i=this.evalExpression(e.value,t)),t.createVariable(e.name,i,e)}_let(e,t){let i=null;if(e.value!==null){if(i=this.evalExpression(e.value,t),i===null)return void console.error(`Invalid value for variable ${e.name}. Line ${e.line}`);e.value instanceof Wa||(i=i.clone())}else{const n=e.type.name;if(n==="f32"||n==="i32"||n==="u32"||n==="bool"||n==="f16"||n==="vec2"||n==="vec3"||n==="vec4"||n==="vec2f"||n==="vec3f"||n==="vec4f"||n==="vec2i"||n==="vec3i"||n==="vec4i"||n==="vec2u"||n==="vec3u"||n==="vec4u"||n==="vec2h"||n==="vec3h"||n==="vec4h"||n==="vec2b"||n==="vec3b"||n==="vec4b"||n==="mat2x2"||n==="mat2x3"||n==="mat2x4"||n==="mat3x2"||n==="mat3x3"||n==="mat3x4"||n==="mat4x2"||n==="mat4x3"||n==="mat4x4"||n==="mat2x2f"||n==="mat2x3f"||n==="mat2x4f"||n==="mat3x2f"||n==="mat3x3f"||n==="mat3x4f"||n==="mat4x2f"||n==="mat4x3f"||n==="mat4x4f"||n==="mat2x2h"||n==="mat2x3h"||n==="mat2x4h"||n==="mat3x2h"||n==="mat3x3h"||n==="mat3x4h"||n==="mat4x2h"||n==="mat4x3h"||n==="mat4x4h"||n==="array"){const a=new Mf(e.type,[]);i=this._evalCreate(a,t)}}t.createVariable(e.name,i,e)}_var(e,t){let i=null;if(e.value!==null){if(i=this.evalExpression(e.value,t),i===null)return void console.error(`Invalid value for variable ${e.name}. Line ${e.line}`);e.value instanceof Wa||(i=i.clone())}else{if(e.type===null)return void console.error(`Variable ${e.name} has no type. Line ${e.line}`);const n=e.type.name;if(n==="f32"||n==="i32"||n==="u32"||n==="bool"||n==="f16"||n==="vec2"||n==="vec3"||n==="vec4"||n==="vec2f"||n==="vec3f"||n==="vec4f"||n==="vec2i"||n==="vec3i"||n==="vec4i"||n==="vec2u"||n==="vec3u"||n==="vec4u"||n==="vec2h"||n==="vec3h"||n==="vec4h"||n==="vec2b"||n==="vec3b"||n==="vec4b"||n==="mat2x2"||n==="mat2x3"||n==="mat2x4"||n==="mat3x2"||n==="mat3x3"||n==="mat3x4"||n==="mat4x2"||n==="mat4x3"||n==="mat4x4"||n==="mat2x2f"||n==="mat2x3f"||n==="mat2x4f"||n==="mat3x2f"||n==="mat3x3f"||n==="mat3x4f"||n==="mat4x2f"||n==="mat4x3f"||n==="mat4x4f"||n==="mat2x2h"||n==="mat2x3h"||n==="mat2x4h"||n==="mat3x2h"||n==="mat3x3h"||n==="mat3x4h"||n==="mat4x2h"||n==="mat4x3h"||n==="mat4x4h"||e.type instanceof I1||e.type instanceof Qd||e.type instanceof nt){const a=new Mf(e.type,[]);i=this._evalCreate(a,t)}}t.createVariable(e.name,i,e)}_switch(e,t){t=t.clone();const i=this.evalExpression(e.condition,t);if(!(i instanceof et))return console.error(`Invalid if condition. Line ${e.line}`),null;let n=null;for(const a of e.cases)if(a instanceof gH)for(const s of a.selectors){if(s instanceof w2){n=a;continue}const o=this.evalExpression(s,t);if(!(o instanceof et))return console.error(`Invalid case selector. Line ${e.line}`),null;if(o.value===i.value)return this._execStatements(a.body,t)}else a instanceof vH&&(n=a);return n?this._execStatements(n.body,t):null}_if(e,t){t=t.clone();const i=this.evalExpression(e.condition,t);if(!(i instanceof et))return console.error(`Invalid if condition. Line ${e.line}`),null;if(i.value)return this._execStatements(e.body,t);for(const n of e.elseif){const a=this.evalExpression(n.condition,t);if(!(a instanceof et))return console.error(`Invalid if condition. Line ${e.line}`),null;if(a.value)return this._execStatements(n.body,t)}return e.else?this._execStatements(e.else,t):null}_getScalarValue(e){return e instanceof et?e.value:(console.error("Expected scalar value.",e),0)}_for(e,t){for(t=t.clone(),this.execStatement(e.init,t);this._getScalarValue(this.evalExpression(e.condition,t));){const i=this._execStatements(e.body,t);if(i===Ts._breakObj)break;if(i!==null&&i!==Ts._continueObj)return i;this.execStatement(e.increment,t)}return null}_loop(e,t){for(t=t.clone();;){const i=this._execStatements(e.body,t);if(i===Ts._breakObj)break;if(i===Ts._continueObj){if(e.continuing&&this._execStatements(e.continuing.body,t)===Ts._breakObj)break}else if(i!==null)return i}return null}_while(e,t){for(t=t.clone();this._getScalarValue(this.evalExpression(e.condition,t));){const i=this._execStatements(e.body,t);if(i===Ts._breakObj)break;if(i!==Ts._continueObj&&i!==null)return i}return null}_evalBitcast(e,t){const i=this.evalExpression(e.value,t),n=e.type;if(i instanceof et){const a=RN(i.value,i.typeInfo.name,n.name);return new et(a,this.getTypeInfo(n))}if(i instanceof Pe){const a=i.typeInfo.getTypeName();let s="";if(a.endsWith("f"))s="f32";else if(a.endsWith("i"))s="i32";else if(a.endsWith("u"))s="u32";else if(a.endsWith("b"))s="bool";else{if(!a.endsWith("h"))return console.error(`Unknown vector type ${a}. Line ${e.line}`),null;s="f16"}const o=n.getTypeName();let l="";if(o.endsWith("f"))l="f32";else if(o.endsWith("i"))l="i32";else if(o.endsWith("u"))l="u32";else if(o.endsWith("b"))l="bool";else{if(!o.endsWith("h"))return console.error(`Unknown vector type ${l}. Line ${e.line}`),null;l="f16"}const c=(function(f,p,y){if(p===y)return f;const b=new Array(f.length);for(let S=0;S<f.length;S++)b[S]=RN(f[S],p,y);return b})(Array.from(i.data),s,l);return new Pe(c,this.getTypeInfo(n))}return console.error(`TODO: bitcast for ${i.typeInfo.name}. Line ${e.line}`),null}_evalConst(e,t){return t.getVariableValue(e.name).clone().getSubData(this,e.postfix,t)}_evalCreate(e,t){var i;if(e instanceof Mf){if(e.type===null)return rR.void;switch(e.type.getTypeName()){case"bool":case"i32":case"u32":case"f32":case"f16":return this._callConstructorValue(e,t);case"vec2":case"vec3":case"vec4":case"vec2f":case"vec3f":case"vec4f":case"vec2h":case"vec3h":case"vec4h":case"vec2i":case"vec3i":case"vec4i":case"vec2u":case"vec3u":case"vec4u":case"vec2b":case"vec3b":case"vec4b":return this._callConstructorVec(e,t);case"mat2x2":case"mat2x2f":case"mat2x2h":case"mat2x3":case"mat2x3f":case"mat2x3h":case"mat2x4":case"mat2x4f":case"mat2x4h":case"mat3x2":case"mat3x2f":case"mat3x2h":case"mat3x3":case"mat3x3f":case"mat3x3h":case"mat3x4":case"mat3x4f":case"mat3x4h":case"mat4x2":case"mat4x2f":case"mat4x2h":case"mat4x3":case"mat4x3f":case"mat4x3h":case"mat4x4":case"mat4x4f":case"mat4x4h":return this._callConstructorMatrix(e,t)}}const n=e instanceof Mf?e.type.name:e.name,a=e instanceof Mf?this.getTypeInfo(e.type):this.getTypeInfo(e.name);if(a===null)return console.error(`Unknown type ${n}. Line ${e.line}`),null;if(a.size===0)return null;const s=new Sa(new ArrayBuffer(a.size),a,0);if(a instanceof wg){if(e.args)for(let o=0;o<e.args.length;++o){const l=a.members[o],c=e.args[o],f=this.evalExpression(c,t);s.setData(this,f,l.type,l.offset,t)}}else if(a instanceof Dg){let o=0;if(e.args)for(let l=0;l<e.args.length;++l){const c=e.args[l],f=this.evalExpression(c,t);a.format===null&&(((i=f.typeInfo)===null||i===void 0?void 0:i.name)==="x32"?a.format=this.getTypeInfo("i32"):a.format=f.typeInfo),s.setData(this,f,a.format,o,t),o+=a.stride}}else console.error(`Unknown type "${n}". Line ${e.line}`);return e instanceof Mf?s.getSubData(this,e.postfix,t):s}_evalLiteral(e,t){const i=this.getTypeInfo(e.type),n=i.name;return n==="x32"||n==="u32"||n==="f32"||n==="f16"||n==="i32"||n==="bool"?new et(e.scalarValue,i):n==="vec2"||n==="vec3"||n==="vec4"||n==="vec2f"||n==="vec3f"||n==="vec4f"||n==="vec2h"||n==="vec3h"||n==="vec4h"||n==="vec2i"||n==="vec3i"||n==="vec4i"||n==="vec2u"||n==="vec3u"||n==="vec4u"?this._callConstructorVec(e,t):n==="mat2x2"||n==="mat2x3"||n==="mat2x4"||n==="mat3x2"||n==="mat3x3"||n==="mat3x4"||n==="mat4x2"||n==="mat4x3"||n==="mat4x4"||n==="mat2x2f"||n==="mat2x3f"||n==="mat2x4f"||n==="mat3x2f"||n==="mat3x3f"||n==="mat3x4f"||n==="mat4x2f"||n==="mat4x3f"||n==="mat4x4f"||n==="mat2x2h"||n==="mat2x3h"||n==="mat2x4h"||n==="mat3x2h"||n==="mat3x3h"||n==="mat3x4h"||n==="mat4x2h"||n==="mat4x3h"||n==="mat4x4h"?this._callConstructorMatrix(e,t):e.value}_evalVariable(e,t){const i=t.getVariableValue(e.name);return i===null?i:i.getSubData(this,e.postfix,t)}_maxFormatTypeInfo(e){let t=e[0];if(t.name==="f32")return t;for(let i=1;i<e.length;++i){const n=Ts._priority.get(t.name);Ts._priority.get(e[i].name)<n&&(t=e[i])}return t.name==="x32"?this.getTypeInfo("i32"):t}_evalUnaryOp(e,t){const i=this.evalExpression(e.right,t);if(e.operator==="&")return new O_(i);if(e.operator==="*")return i instanceof O_?i.reference.getSubData(this,e.postfix,t):(console.error(`Invalid dereference. Line ${e.line}`),null);const n=i instanceof et?i.value:i instanceof Pe?Array.from(i.data):null;switch(e.operator){case"+":{if(ir(n)){const o=n.map((l,c)=>+l);return new Pe(o,i.typeInfo)}const a=n,s=this._maxFormatTypeInfo([i.typeInfo,i.typeInfo]);return new et(+a,s)}case"-":{if(ir(n)){const o=n.map((l,c)=>-l);return new Pe(o,i.typeInfo)}const a=n,s=this._maxFormatTypeInfo([i.typeInfo,i.typeInfo]);return new et(-a,s)}case"!":{if(ir(n)){const o=n.map((l,c)=>l?0:1);return new Pe(o,i.typeInfo)}const a=n,s=this._maxFormatTypeInfo([i.typeInfo,i.typeInfo]);return new et(a?0:1,s)}case"~":{if(ir(n)){const o=n.map((l,c)=>~l);return new Pe(o,i.typeInfo)}const a=n,s=this._maxFormatTypeInfo([i.typeInfo,i.typeInfo]);return new et(~a,s)}}return console.error(`Invalid unary operator ${e.operator}. Line ${e.line}`),null}_evalBinaryOp(e,t){const i=this.evalExpression(e.left,t),n=this.evalExpression(e.right,t),a=i instanceof et?i.value:i instanceof Pe||i instanceof Fr?Array.from(i.data):null,s=n instanceof et?n.value:n instanceof Pe||n instanceof Fr?Array.from(n.data):null;switch(e.operator){case"+":{if(ir(a)&&ir(s)){const f=a,p=s;if(f.length!==p.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const y=f.map((b,S)=>b+p[S]);return new Pe(y,i.typeInfo)}if(ir(a)){const f=s,p=a.map((y,b)=>y+f);return new Pe(p,i.typeInfo)}if(ir(s)){const f=a,p=s.map((y,b)=>f+y);return new Pe(p,n.typeInfo)}const o=a,l=s,c=this._maxFormatTypeInfo([i.typeInfo,n.typeInfo]);return new et(o+l,c)}case"-":{if(ir(a)&&ir(s)){const f=a,p=s;if(f.length!==p.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const y=f.map((b,S)=>b-p[S]);return new Pe(y,i.typeInfo)}if(ir(a)){const f=s,p=a.map((y,b)=>y-f);return new Pe(p,i.typeInfo)}if(ir(s)){const f=a,p=s.map((y,b)=>f-y);return new Pe(p,n.typeInfo)}const o=a,l=s,c=this._maxFormatTypeInfo([i.typeInfo,n.typeInfo]);return new et(o-l,c)}case"*":{if(ir(a)&&ir(s)){const f=a,p=s;if(i instanceof Fr&&n instanceof Fr){const y=(function(E,P,O,B){if(Js[P.name]===void 0||Js[B.name]===void 0)return null;const F=Js[P.name][0],W=Js[P.name][1],$=Js[B.name][0];if(F!==Js[B.name][1])return null;const q=new Array($*W);for(let Q=0;Q<W;Q++)for(let ee=0;ee<$;ee++){let te=0;for(let ae=0;ae<F;ae++)te+=E[ae*W+Q]*O[ee*F+ae];q[Q*$+ee]=te}return q})(f,i.typeInfo,p,n.typeInfo);if(y===null)return console.error(`Matrix multiplication failed. Line ${e.line}.`),null;const b=Js[n.typeInfo.name][0],S=Js[i.typeInfo.name][1],C=this.getTypeInfo(`mat${b}x${S}f`);return new Fr(y,C)}if(i instanceof Fr&&n instanceof Pe){const y=(function(b,S,C,E){if(Js[S.name]===void 0||ZM[E.name]===void 0)return null;const P=Js[S.name][0],O=Js[S.name][1];if(P!==C.length)return null;const B=new Array(O);for(let F=0;F<O;F++){let W=0;for(let $=0;$<P;$++)W+=b[$*O+F]*C[$];B[F]=W}return B})(f,i.typeInfo,p,n.typeInfo);return y===null?(console.error(`Matrix vector multiplication failed. Line ${e.line}.`),null):new Pe(y,n.typeInfo)}if(i instanceof Pe&&n instanceof Fr){const y=(function(b,S,C,E){if(ZM[S.name]===void 0||Js[E.name]===void 0)return null;const P=Js[E.name][0],O=Js[E.name][1];if(O!==b.length)return null;const B=[];for(let F=0;F<P;F++){let W=0;for(let $=0;$<O;$++)W+=b[$]*C[$*P+F];B[F]=W}return B})(f,i.typeInfo,p,n.typeInfo);return y===null?(console.error(`Matrix vector multiplication failed. Line ${e.line}.`),null):new Pe(y,i.typeInfo)}{if(f.length!==p.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const y=f.map((b,S)=>b*p[S]);return new Pe(y,i.typeInfo)}}if(ir(a)){const f=s,p=a.map((y,b)=>y*f);return i instanceof Fr?new Fr(p,i.typeInfo):new Pe(p,i.typeInfo)}if(ir(s)){const f=a,p=s.map((y,b)=>f*y);return n instanceof Fr?new Fr(p,n.typeInfo):new Pe(p,n.typeInfo)}const o=a,l=s,c=this._maxFormatTypeInfo([i.typeInfo,n.typeInfo]);return new et(o*l,c)}case"%":{if(ir(a)&&ir(s)){const f=a,p=s;if(f.length!==p.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const y=f.map((b,S)=>b%p[S]);return new Pe(y,i.typeInfo)}if(ir(a)){const f=s,p=a.map((y,b)=>y%f);return new Pe(p,i.typeInfo)}if(ir(s)){const f=a,p=s.map((y,b)=>f%y);return new Pe(p,n.typeInfo)}const o=a,l=s,c=this._maxFormatTypeInfo([i.typeInfo,n.typeInfo]);return new et(o%l,c)}case"/":{if(ir(a)&&ir(s)){const f=a,p=s;if(f.length!==p.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const y=f.map((b,S)=>b/p[S]);return new Pe(y,i.typeInfo)}if(ir(a)){const f=s,p=a.map((y,b)=>y/f);return new Pe(p,i.typeInfo)}if(ir(s)){const f=a,p=s.map((y,b)=>f/y);return new Pe(p,n.typeInfo)}const o=a,l=s,c=this._maxFormatTypeInfo([i.typeInfo,n.typeInfo]);return new et(o/l,c)}case"&":{if(ir(a)&&ir(s)){const f=a,p=s;if(f.length!==p.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const y=f.map((b,S)=>b&p[S]);return new Pe(y,i.typeInfo)}if(ir(a)){const f=s,p=a.map((y,b)=>y&f);return new Pe(p,i.typeInfo)}if(ir(s)){const f=a,p=s.map((y,b)=>f&y);return new Pe(p,n.typeInfo)}const o=a,l=s,c=this._maxFormatTypeInfo([i.typeInfo,n.typeInfo]);return new et(o&l,c)}case"|":{if(ir(a)&&ir(s)){const f=a,p=s;if(f.length!==p.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const y=f.map((b,S)=>b|p[S]);return new Pe(y,i.typeInfo)}if(ir(a)){const f=s,p=a.map((y,b)=>y|f);return new Pe(p,i.typeInfo)}if(ir(s)){const f=a,p=s.map((y,b)=>f|y);return new Pe(p,n.typeInfo)}const o=a,l=s,c=this._maxFormatTypeInfo([i.typeInfo,n.typeInfo]);return new et(o|l,c)}case"^":{if(ir(a)&&ir(s)){const f=a,p=s;if(f.length!==p.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const y=f.map((b,S)=>b^p[S]);return new Pe(y,i.typeInfo)}if(ir(a)){const f=s,p=a.map((y,b)=>y^f);return new Pe(p,i.typeInfo)}if(ir(s)){const f=a,p=s.map((y,b)=>f^y);return new Pe(p,n.typeInfo)}const o=a,l=s,c=this._maxFormatTypeInfo([i.typeInfo,n.typeInfo]);return new et(o^l,c)}case"<<":{if(ir(a)&&ir(s)){const f=a,p=s;if(f.length!==p.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const y=f.map((b,S)=>b<<p[S]);return new Pe(y,i.typeInfo)}if(ir(a)){const f=s,p=a.map((y,b)=>y<<f);return new Pe(p,i.typeInfo)}if(ir(s)){const f=a,p=s.map((y,b)=>f<<y);return new Pe(p,n.typeInfo)}const o=a,l=s,c=this._maxFormatTypeInfo([i.typeInfo,n.typeInfo]);return new et(o<<l,c)}case">>":{if(ir(a)&&ir(s)){const f=a,p=s;if(f.length!==p.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const y=f.map((b,S)=>b>>p[S]);return new Pe(y,i.typeInfo)}if(ir(a)){const f=s,p=a.map((y,b)=>y>>f);return new Pe(p,i.typeInfo)}if(ir(s)){const f=a,p=s.map((y,b)=>f>>y);return new Pe(p,n.typeInfo)}const o=a,l=s,c=this._maxFormatTypeInfo([i.typeInfo,n.typeInfo]);return new et(o>>l,c)}case">":if(ir(a)&&ir(s)){const o=a,l=s;if(o.length!==l.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const c=o.map((f,p)=>f>l[p]?1:0);return new Pe(c,i.typeInfo)}if(ir(a)){const o=s,l=a.map((c,f)=>c>o?1:0);return new Pe(l,i.typeInfo)}if(ir(s)){const o=a,l=s.map((c,f)=>o>c?1:0);return new Pe(l,n.typeInfo)}return new et(a>s?1:0,this.getTypeInfo("bool"));case"<":if(ir(a)&&ir(s)){const o=a,l=s;if(o.length!==l.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const c=o.map((f,p)=>f<l[p]?1:0);return new Pe(c,i.typeInfo)}if(ir(a)){const o=s,l=a.map((c,f)=>c<o?1:0);return new Pe(l,i.typeInfo)}if(ir(s)){const o=a,l=s.map((c,f)=>o<c?1:0);return new Pe(l,n.typeInfo)}return new et(a<s?1:0,this.getTypeInfo("bool"));case"==":if(ir(a)&&ir(s)){const o=a,l=s;if(o.length!==l.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const c=o.map((f,p)=>f===l[p]?1:0);return new Pe(c,i.typeInfo)}if(ir(a)){const o=s,l=a.map((c,f)=>c==o?1:0);return new Pe(l,i.typeInfo)}if(ir(s)){const o=a,l=s.map((c,f)=>o==c?1:0);return new Pe(l,n.typeInfo)}return new et(a===s?1:0,this.getTypeInfo("bool"));case"!=":if(ir(a)&&ir(s)){const o=a,l=s;if(o.length!==l.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const c=o.map((f,p)=>f!==l[p]?1:0);return new Pe(c,i.typeInfo)}if(ir(a)){const o=s,l=a.map((c,f)=>c!==o?1:0);return new Pe(l,i.typeInfo)}if(ir(s)){const o=a,l=s.map((c,f)=>o!==c?1:0);return new Pe(l,n.typeInfo)}return new et(a!==s?1:0,this.getTypeInfo("bool"));case">=":if(ir(a)&&ir(s)){const o=a,l=s;if(o.length!==l.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const c=o.map((f,p)=>f>=l[p]?1:0);return new Pe(c,i.typeInfo)}if(ir(a)){const o=s,l=a.map((c,f)=>c>=o?1:0);return new Pe(l,i.typeInfo)}if(ir(s)){const o=a,l=s.map((c,f)=>o>=c?1:0);return new Pe(l,n.typeInfo)}return new et(a>=s?1:0,this.getTypeInfo("bool"));case"<=":if(ir(a)&&ir(s)){const o=a,l=s;if(o.length!==l.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const c=o.map((f,p)=>f<=l[p]?1:0);return new Pe(c,i.typeInfo)}if(ir(a)){const o=s,l=a.map((c,f)=>c<=o?1:0);return new Pe(l,i.typeInfo)}if(ir(s)){const o=a,l=s.map((c,f)=>o<=c?1:0);return new Pe(l,n.typeInfo)}return new et(a<=s?1:0,this.getTypeInfo("bool"));case"&&":if(ir(a)&&ir(s)){const o=a,l=s;if(o.length!==l.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const c=o.map((f,p)=>f&&l[p]?1:0);return new Pe(c,i.typeInfo)}if(ir(a)){const o=s,l=a.map((c,f)=>c&&o?1:0);return new Pe(l,i.typeInfo)}if(ir(s)){const o=a,l=s.map((c,f)=>o&&c?1:0);return new Pe(l,n.typeInfo)}return new et(a&&s?1:0,this.getTypeInfo("bool"));case"||":if(ir(a)&&ir(s)){const o=a,l=s;if(o.length!==l.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const c=o.map((f,p)=>f||l[p]?1:0);return new Pe(c,i.typeInfo)}if(ir(a)){const o=s,l=a.map((c,f)=>c||o?1:0);return new Pe(l,i.typeInfo)}if(ir(s)){const o=a,l=s.map((c,f)=>o||c?1:0);return new Pe(l,n.typeInfo)}return new et(a||s?1:0,this.getTypeInfo("bool"))}return console.error(`Unknown operator ${e.operator}. Line ${e.line}`),null}_evalCall(e,t){if(e.cachedReturnValue!==null)return e.cachedReturnValue;const i=t.clone();i.currentFunctionName=e.name;const n=t.getFunction(e.name);if(!n)return e.isBuiltin?this._callBuiltinFunction(e,i):this.getTypeInfo(e.name)?this._evalCreate(e,t):(console.error(`Unknown function "${e.name}". Line ${e.line}`),null);for(let a=0;a<n.node.args.length;++a){const s=n.node.args[a],o=this.evalExpression(e.args[a],i);i.createVariable(s.name,o,s)}return this._execStatements(n.node.body,i)}_callBuiltinFunction(e,t){switch(e.name){case"all":return this.builtins.All(e,t);case"any":return this.builtins.Any(e,t);case"select":return this.builtins.Select(e,t);case"arrayLength":return this.builtins.ArrayLength(e,t);case"abs":return this.builtins.Abs(e,t);case"acos":return this.builtins.Acos(e,t);case"acosh":return this.builtins.Acosh(e,t);case"asin":return this.builtins.Asin(e,t);case"asinh":return this.builtins.Asinh(e,t);case"atan":return this.builtins.Atan(e,t);case"atanh":return this.builtins.Atanh(e,t);case"atan2":return this.builtins.Atan2(e,t);case"ceil":return this.builtins.Ceil(e,t);case"clamp":return this.builtins.Clamp(e,t);case"cos":return this.builtins.Cos(e,t);case"cosh":return this.builtins.Cosh(e,t);case"countLeadingZeros":return this.builtins.CountLeadingZeros(e,t);case"countOneBits":return this.builtins.CountOneBits(e,t);case"countTrailingZeros":return this.builtins.CountTrailingZeros(e,t);case"cross":return this.builtins.Cross(e,t);case"degrees":return this.builtins.Degrees(e,t);case"determinant":return this.builtins.Determinant(e,t);case"distance":return this.builtins.Distance(e,t);case"dot":return this.builtins.Dot(e,t);case"dot4U8Packed":return this.builtins.Dot4U8Packed(e,t);case"dot4I8Packed":return this.builtins.Dot4I8Packed(e,t);case"exp":return this.builtins.Exp(e,t);case"exp2":return this.builtins.Exp2(e,t);case"extractBits":return this.builtins.ExtractBits(e,t);case"faceForward":return this.builtins.FaceForward(e,t);case"firstLeadingBit":return this.builtins.FirstLeadingBit(e,t);case"firstTrailingBit":return this.builtins.FirstTrailingBit(e,t);case"floor":return this.builtins.Floor(e,t);case"fma":return this.builtins.Fma(e,t);case"fract":return this.builtins.Fract(e,t);case"frexp":return this.builtins.Frexp(e,t);case"insertBits":return this.builtins.InsertBits(e,t);case"inverseSqrt":return this.builtins.InverseSqrt(e,t);case"ldexp":return this.builtins.Ldexp(e,t);case"length":return this.builtins.Length(e,t);case"log":return this.builtins.Log(e,t);case"log2":return this.builtins.Log2(e,t);case"max":return this.builtins.Max(e,t);case"min":return this.builtins.Min(e,t);case"mix":return this.builtins.Mix(e,t);case"modf":return this.builtins.Modf(e,t);case"normalize":return this.builtins.Normalize(e,t);case"pow":return this.builtins.Pow(e,t);case"quantizeToF16":return this.builtins.QuantizeToF16(e,t);case"radians":return this.builtins.Radians(e,t);case"reflect":return this.builtins.Reflect(e,t);case"refract":return this.builtins.Refract(e,t);case"reverseBits":return this.builtins.ReverseBits(e,t);case"round":return this.builtins.Round(e,t);case"saturate":return this.builtins.Saturate(e,t);case"sign":return this.builtins.Sign(e,t);case"sin":return this.builtins.Sin(e,t);case"sinh":return this.builtins.Sinh(e,t);case"smoothstep":return this.builtins.SmoothStep(e,t);case"sqrt":return this.builtins.Sqrt(e,t);case"step":return this.builtins.Step(e,t);case"tan":return this.builtins.Tan(e,t);case"tanh":return this.builtins.Tanh(e,t);case"transpose":return this.builtins.Transpose(e,t);case"trunc":return this.builtins.Trunc(e,t);case"dpdx":return this.builtins.Dpdx(e,t);case"dpdxCoarse":return this.builtins.DpdxCoarse(e,t);case"dpdxFine":return this.builtins.DpdxFine(e,t);case"dpdy":return this.builtins.Dpdy(e,t);case"dpdyCoarse":return this.builtins.DpdyCoarse(e,t);case"dpdyFine":return this.builtins.DpdyFine(e,t);case"fwidth":return this.builtins.Fwidth(e,t);case"fwidthCoarse":return this.builtins.FwidthCoarse(e,t);case"fwidthFine":return this.builtins.FwidthFine(e,t);case"textureDimensions":return this.builtins.TextureDimensions(e,t);case"textureGather":return this.builtins.TextureGather(e,t);case"textureGatherCompare":return this.builtins.TextureGatherCompare(e,t);case"textureLoad":return this.builtins.TextureLoad(e,t);case"textureNumLayers":return this.builtins.TextureNumLayers(e,t);case"textureNumLevels":return this.builtins.TextureNumLevels(e,t);case"textureNumSamples":return this.builtins.TextureNumSamples(e,t);case"textureSample":return this.builtins.TextureSample(e,t);case"textureSampleBias":return this.builtins.TextureSampleBias(e,t);case"textureSampleCompare":return this.builtins.TextureSampleCompare(e,t);case"textureSampleCompareLevel":return this.builtins.TextureSampleCompareLevel(e,t);case"textureSampleGrad":return this.builtins.TextureSampleGrad(e,t);case"textureSampleLevel":return this.builtins.TextureSampleLevel(e,t);case"textureSampleBaseClampToEdge":return this.builtins.TextureSampleBaseClampToEdge(e,t);case"textureStore":return this.builtins.TextureStore(e,t);case"atomicLoad":return this.builtins.AtomicLoad(e,t);case"atomicStore":return this.builtins.AtomicStore(e,t);case"atomicAdd":return this.builtins.AtomicAdd(e,t);case"atomicSub":return this.builtins.AtomicSub(e,t);case"atomicMax":return this.builtins.AtomicMax(e,t);case"atomicMin":return this.builtins.AtomicMin(e,t);case"atomicAnd":return this.builtins.AtomicAnd(e,t);case"atomicOr":return this.builtins.AtomicOr(e,t);case"atomicXor":return this.builtins.AtomicXor(e,t);case"atomicExchange":return this.builtins.AtomicExchange(e,t);case"atomicCompareExchangeWeak":return this.builtins.AtomicCompareExchangeWeak(e,t);case"pack4x8snorm":return this.builtins.Pack4x8snorm(e,t);case"pack4x8unorm":return this.builtins.Pack4x8unorm(e,t);case"pack4xI8":return this.builtins.Pack4xI8(e,t);case"pack4xU8":return this.builtins.Pack4xU8(e,t);case"pack4x8Clamp":return this.builtins.Pack4x8Clamp(e,t);case"pack4xU8Clamp":return this.builtins.Pack4xU8Clamp(e,t);case"pack2x16snorm":return this.builtins.Pack2x16snorm(e,t);case"pack2x16unorm":return this.builtins.Pack2x16unorm(e,t);case"pack2x16float":return this.builtins.Pack2x16float(e,t);case"unpack4x8snorm":return this.builtins.Unpack4x8snorm(e,t);case"unpack4x8unorm":return this.builtins.Unpack4x8unorm(e,t);case"unpack4xI8":return this.builtins.Unpack4xI8(e,t);case"unpack4xU8":return this.builtins.Unpack4xU8(e,t);case"unpack2x16snorm":return this.builtins.Unpack2x16snorm(e,t);case"unpack2x16unorm":return this.builtins.Unpack2x16unorm(e,t);case"unpack2x16float":return this.builtins.Unpack2x16float(e,t);case"storageBarrier":return this.builtins.StorageBarrier(e,t);case"textureBarrier":return this.builtins.TextureBarrier(e,t);case"workgroupBarrier":return this.builtins.WorkgroupBarrier(e,t);case"workgroupUniformLoad":return this.builtins.WorkgroupUniformLoad(e,t);case"subgroupAdd":return this.builtins.SubgroupAdd(e,t);case"subgroupExclusiveAdd":return this.builtins.SubgroupExclusiveAdd(e,t);case"subgroupInclusiveAdd":return this.builtins.SubgroupInclusiveAdd(e,t);case"subgroupAll":return this.builtins.SubgroupAll(e,t);case"subgroupAnd":return this.builtins.SubgroupAnd(e,t);case"subgroupAny":return this.builtins.SubgroupAny(e,t);case"subgroupBallot":return this.builtins.SubgroupBallot(e,t);case"subgroupBroadcast":return this.builtins.SubgroupBroadcast(e,t);case"subgroupBroadcastFirst":return this.builtins.SubgroupBroadcastFirst(e,t);case"subgroupElect":return this.builtins.SubgroupElect(e,t);case"subgroupMax":return this.builtins.SubgroupMax(e,t);case"subgroupMin":return this.builtins.SubgroupMin(e,t);case"subgroupMul":return this.builtins.SubgroupMul(e,t);case"subgroupExclusiveMul":return this.builtins.SubgroupExclusiveMul(e,t);case"subgroupInclusiveMul":return this.builtins.SubgroupInclusiveMul(e,t);case"subgroupOr":return this.builtins.SubgroupOr(e,t);case"subgroupShuffle":return this.builtins.SubgroupShuffle(e,t);case"subgroupShuffleDown":return this.builtins.SubgroupShuffleDown(e,t);case"subgroupShuffleUp":return this.builtins.SubgroupShuffleUp(e,t);case"subgroupShuffleXor":return this.builtins.SubgroupShuffleXor(e,t);case"subgroupXor":return this.builtins.SubgroupXor(e,t);case"quadBroadcast":return this.builtins.QuadBroadcast(e,t);case"quadSwapDiagonal":return this.builtins.QuadSwapDiagonal(e,t);case"quadSwapX":return this.builtins.QuadSwapX(e,t);case"quadSwapY":return this.builtins.QuadSwapY(e,t)}const i=t.getFunction(e.name);if(i){const n=t.clone();for(let a=0;a<i.node.args.length;++a){const s=i.node.args[a],o=this.evalExpression(e.args[a],n);n.setVariable(s.name,o,s)}return this._execStatements(i.node.body,n)}return null}_callConstructorValue(e,t){if(!e.args||e.args.length===0)return new et(0,this.getTypeInfo(e.type));const i=this.evalExpression(e.args[0],t);return i.typeInfo=this.getTypeInfo(e.type),i.getSubData(this,e.postfix,t).clone()}_callConstructorVec(e,t){const i=this.getTypeInfo(e.type),n=e.type.getTypeName(),a=ZM[n];if(a===void 0)return console.error(`Invalid vec constructor ${n}. Line ${e.line}`),null;const s=[];if(e instanceof no)if(e.isVector){const o=e.vectorValue;for(const l of o)s.push(l)}else s.push(e.scalarValue);else if(e.args)for(const o of e.args){const l=this.evalExpression(o,t);if(l instanceof Pe){const c=l.data;for(let f=0;f<c.length;++f){let p=c[f];s.push(p)}}else if(l instanceof et){let c=l.value;s.push(c)}}if(e.type instanceof nt&&e.type.format===null&&(e.type.format=nt.f32),s.length===0){const o=new Array(a).fill(0);return new Pe(o,i).getSubData(this,e.postfix,t)}if(s.length===1)for(;s.length<a;)s.push(s[0]);return s.length<a?(console.error(`Invalid vec constructor. Line ${e.line}`),null):new Pe(s.length>a?s.slice(0,a):s,i).getSubData(this,e.postfix,t)}_callConstructorMatrix(e,t){const i=this.getTypeInfo(e.type),n=e.type.getTypeName(),a=Js[n];if(a===void 0)return console.error(`Invalid matrix constructor ${n}. Line ${e.line}`),null;const s=[];if(e instanceof no)if(e.isVector){const o=e.vectorValue;for(const l of o)s.push(l)}else s.push(e.scalarValue);else if(e.args)for(const o of e.args){const l=this.evalExpression(o,t);l instanceof Pe?s.push(...l.data):l instanceof et?s.push(l.value):l instanceof Fr&&s.push(...l.data)}if(i instanceof cy&&i.format===null&&(i.format=this.getTypeInfo("f32")),s.length===0){const o=new Array(a[2]).fill(0);return new Fr(o,i).getSubData(this,e.postfix,t)}return s.length!==a[2]?(console.error(`Invalid matrix constructor. Line ${e.line}`),null):new Fr(s,i).getSubData(this,e.postfix,t)}}Ts._breakObj=new wc(new yc("BREAK",null),null),Ts._continueObj=new wc(new yc("CONTINUE",null),null),Ts._priority=new Map([["f32",0],["f16",1],["u32",2],["i32",3],["x32",3]]);class gJ{constructor(){this.constants=new Map,this.aliases=new Map,this.structs=new Map}}class vJ{constructor(){this._tokens=[],this._current=0,this._currentLine=1,this._deferArrayCountEval=[],this._currentLoop=[],this._context=new gJ,this._exec=new Ts,this._forwardTypeCount=0}parse(e){this._initialize(e),this._deferArrayCountEval.length=0;const t=[];for(;!this._isAtEnd();){const i=this._global_decl_or_directive();if(!i)break;t.push(i)}if(this._deferArrayCountEval.length>0){for(const i of this._deferArrayCountEval){const n=i.arrayType,a=i.countNode;if(a instanceof pu){const s=a.name,o=this._context.constants.get(s);if(o)try{const l=o.constEvaluate(this._exec);n.count=l}catch{}}}this._deferArrayCountEval.length=0}if(this._forwardTypeCount>0)for(const i of t)i.search(n=>{n instanceof IN||n instanceof x2?n.type=this._forwardType(n.type):n instanceof I1?n.format=this._forwardType(n.format):n instanceof ep||n instanceof E1||n instanceof b2?n.type=this._forwardType(n.type):n instanceof Q1?n.returnType=this._forwardType(n.returnType):n instanceof EN&&(n.type=this._forwardType(n.type))});return t}_forwardType(e){if(e instanceof MN){const t=this._getType(e.name);if(t)return t}else e instanceof x2?e.type=this._forwardType(e.type):e instanceof I1&&(e.format=this._forwardType(e.format));return e}_initialize(e){if(e)if(typeof e=="string"){const t=new nJ(e);this._tokens=t.scanTokens()}else this._tokens=e;else this._tokens=[];this._current=0}_updateNode(e,t){return e.line=t??this._currentLine,e}_error(e,t){return{token:e,message:t,toString:()=>`${t}`}}_isAtEnd(){return this._current>=this._tokens.length||this._peek().type==Me.eof}_match(e){if(e instanceof rt)return!!this._check(e)&&(this._advance(),!0);for(let t=0,i=e.length;t<i;++t){const n=e[t];if(this._check(n))return this._advance(),!0}return!1}_consume(e,t){if(this._check(e))return this._advance();throw this._error(this._peek(),`${t}. Line:${this._currentLine}`)}_check(e){if(this._isAtEnd())return!1;const t=this._peek();if(e instanceof Array){const i=t.type;let n=!1;for(const a of e){if(i===a)return!0;a===Me.tokens.name&&(n=!0)}if(n){const a=Me.tokens.name.rule.exec(t.lexeme);if(a&&a.index==0&&a[0]==t.lexeme)return!0}return!1}if(t.type===e)return!0;if(e===Me.tokens.name){const i=Me.tokens.name.rule.exec(t.lexeme);return i&&i.index==0&&i[0]==t.lexeme}return!1}_advance(){var e,t;return this._currentLine=(t=(e=this._peek())===null||e===void 0?void 0:e.line)!==null&&t!==void 0?t:-1,this._isAtEnd()||this._current++,this._previous()}_peek(){return this._tokens[this._current]}_previous(){return this._tokens[this._current-1]}_global_decl_or_directive(){for(;this._match(Me.tokens.semicolon)&&!this._isAtEnd(););if(this._match(Me.keywords.alias)){const t=this._type_alias();return this._consume(Me.tokens.semicolon,"Expected ';'"),this._exec.reflection.updateAST([t]),t}if(this._match(Me.keywords.diagnostic)){const t=this._diagnostic();return this._consume(Me.tokens.semicolon,"Expected ';'"),this._exec.reflection.updateAST([t]),t}if(this._match(Me.keywords.requires)){const t=this._requires_directive();return this._consume(Me.tokens.semicolon,"Expected ';'"),this._exec.reflection.updateAST([t]),t}if(this._match(Me.keywords.enable)){const t=this._enable_directive();return this._consume(Me.tokens.semicolon,"Expected ';'"),this._exec.reflection.updateAST([t]),t}const e=this._attribute();if(this._check(Me.keywords.var)){const t=this._global_variable_decl();return t!=null&&(t.attributes=e),this._consume(Me.tokens.semicolon,"Expected ';'."),this._exec.reflection.updateAST([t]),t}if(this._check(Me.keywords.override)){const t=this._override_variable_decl();return t!=null&&(t.attributes=e),this._consume(Me.tokens.semicolon,"Expected ';'."),this._exec.reflection.updateAST([t]),t}if(this._check(Me.keywords.let)){const t=this._global_let_decl();return t!=null&&(t.attributes=e),this._consume(Me.tokens.semicolon,"Expected ';'."),this._exec.reflection.updateAST([t]),t}if(this._check(Me.keywords.const)){const t=this._global_const_decl();return t!=null&&(t.attributes=e),this._consume(Me.tokens.semicolon,"Expected ';'."),this._exec.reflection.updateAST([t]),t}if(this._check(Me.keywords.struct)){const t=this._struct_decl();return t!=null&&(t.attributes=e),this._exec.reflection.updateAST([t]),t}if(this._check(Me.keywords.fn)){const t=this._function_decl();return t!=null&&(t.attributes=e),this._exec.reflection.updateAST([t]),t}return null}_function_decl(){if(!this._match(Me.keywords.fn))return null;const e=this._currentLine,t=this._consume(Me.tokens.ident,"Expected function name.").toString();this._consume(Me.tokens.paren_left,"Expected '(' for function arguments.");const i=[];if(!this._check(Me.tokens.paren_right))do{if(this._check(Me.tokens.paren_right))break;const o=this._attribute(),l=this._consume(Me.tokens.name,"Expected argument name.").toString();this._consume(Me.tokens.colon,"Expected ':' for argument type.");const c=this._attribute(),f=this._type_decl();f!=null&&(f.attributes=c,i.push(this._updateNode(new EN(l,f,o))))}while(this._match(Me.tokens.comma));this._consume(Me.tokens.paren_right,"Expected ')' after function arguments.");let n=null;if(this._match(Me.tokens.arrow)){const o=this._attribute();n=this._type_decl(),n!=null&&(n.attributes=o)}const a=this._compound_statement(),s=this._currentLine;return this._updateNode(new Q1(t,i,n,a,e,s),e)}_compound_statement(){const e=[];for(this._consume(Me.tokens.brace_left,"Expected '{' for block.");!this._check(Me.tokens.brace_right);){const t=this._statement();t!==null&&e.push(t)}return this._consume(Me.tokens.brace_right,"Expected '}' for block."),e}_statement(){for(;this._match(Me.tokens.semicolon)&&!this._isAtEnd(););if(this._check(Me.tokens.attr)&&this._attribute(),this._check(Me.keywords.if))return this._if_statement();if(this._check(Me.keywords.switch))return this._switch_statement();if(this._check(Me.keywords.loop))return this._loop_statement();if(this._check(Me.keywords.for))return this._for_statement();if(this._check(Me.keywords.while))return this._while_statement();if(this._check(Me.keywords.continuing))return this._continuing_statement();if(this._check(Me.keywords.static_assert))return this._static_assert_statement();if(this._check(Me.tokens.brace_left))return this._compound_statement();let e=null;if(this._check(Me.keywords.return))e=this._return_statement();else if(this._check([Me.keywords.var,Me.keywords.let,Me.keywords.const]))e=this._variable_statement();else if(this._match(Me.keywords.discard))e=this._updateNode(new tJ);else if(this._match(Me.keywords.break)){const t=this._updateNode(new uH);if(this._currentLoop.length>0){const i=this._currentLoop[this._currentLoop.length-1];t.loopId=i.id}e=t,this._check(Me.keywords.if)&&(this._advance(),t.condition=this._optional_paren_expression())}else if(this._match(Me.keywords.continue)){const t=this._updateNode(new cH);if(!(this._currentLoop.length>0))throw this._error(this._peek(),`Continue statement must be inside a loop. Line: ${t.line}`);{const i=this._currentLoop[this._currentLoop.length-1];t.loopId=i.id}e=t}else e=this._increment_decrement_statement()||this._func_call_statement()||this._assignment_statement();return e!=null&&this._consume(Me.tokens.semicolon,"Expected ';' after statement."),e}_static_assert_statement(){if(!this._match(Me.keywords.static_assert))return null;const e=this._currentLine,t=this._optional_paren_expression();return this._updateNode(new QQ(t),e)}_while_statement(){if(!this._match(Me.keywords.while))return null;const e=this._updateNode(new eH(null,null));return this._currentLoop.push(e),e.condition=this._optional_paren_expression(),this._check(Me.tokens.attr)&&this._attribute(),e.body=this._compound_statement(),this._currentLoop.pop(),e}_continuing_statement(){const e=this._currentLoop.length>0?this._currentLoop[this._currentLoop.length-1].id:-1;if(!this._match(Me.keywords.continuing))return null;const t=this._currentLine,i=this._compound_statement();return this._updateNode(new tR(i,e),t)}_for_statement(){if(!this._match(Me.keywords.for))return null;this._consume(Me.tokens.paren_left,"Expected '('.");const e=this._updateNode(new tH(null,null,null,null));return this._currentLoop.push(e),e.init=this._check(Me.tokens.semicolon)?null:this._for_init(),this._consume(Me.tokens.semicolon,"Expected ';'."),e.condition=this._check(Me.tokens.semicolon)?null:this._short_circuit_or_expression(),this._consume(Me.tokens.semicolon,"Expected ';'."),e.increment=this._check(Me.tokens.paren_right)?null:this._for_increment(),this._consume(Me.tokens.paren_right,"Expected ')'."),this._check(Me.tokens.attr)&&this._attribute(),e.body=this._compound_statement(),this._currentLoop.pop(),e}_for_init(){return this._variable_statement()||this._func_call_statement()||this._assignment_statement()}_for_increment(){return this._func_call_statement()||this._increment_decrement_statement()||this._assignment_statement()}_variable_statement(){if(this._check(Me.keywords.var)){const e=this._variable_decl();if(e===null)throw this._error(this._peek(),"Variable declaration expected.");let t=null;return this._match(Me.tokens.equal)&&(t=this._short_circuit_or_expression()),this._updateNode(new ep(e.name,e.type,e.storage,e.access,t),e.line)}if(this._match(Me.keywords.let)){const e=this._currentLine,t=this._consume(Me.tokens.name,"Expected name for let.").toString();let i=null;if(this._match(Me.tokens.colon)){const a=this._attribute();i=this._type_decl(),i!=null&&(i.attributes=a)}this._consume(Me.tokens.equal,"Expected '=' for let.");const n=this._short_circuit_or_expression();return this._updateNode(new E1(t,i,null,null,n),e)}if(this._match(Me.keywords.const)){const e=this._currentLine,t=this._consume(Me.tokens.name,"Expected name for const.").toString();let i=null;if(this._match(Me.tokens.colon)){const a=this._attribute();i=this._type_decl(),i!=null&&(i.attributes=a)}this._consume(Me.tokens.equal,"Expected '=' for const.");const n=this._short_circuit_or_expression();return i===null&&n instanceof no&&(i=n.type),this._updateNode(new b2(t,i,null,null,n),e)}return null}_increment_decrement_statement(){const e=this._current,t=this._unary_expression();if(t==null)return null;if(!this._check(Me.increment_operators))return this._current=e,null;const i=this._consume(Me.increment_operators,"Expected increment operator");return this._updateNode(new rH(i.type===Me.tokens.plus_plus?d0.increment:d0.decrement,t))}_assignment_statement(){let e=null;const t=this._currentLine;if(this._check(Me.tokens.brace_right))return null;let i=this._match(Me.tokens.underscore);if(i||(e=this._unary_expression()),!i&&e==null)return null;const n=this._consume(Me.assignment_operators,"Expected assignment operator."),a=this._short_circuit_or_expression();return this._updateNode(new iH(u1.parse(n.lexeme),e,a),t)}_func_call_statement(){if(!this._check(Me.tokens.ident))return null;const e=this._currentLine,t=this._current,i=this._consume(Me.tokens.ident,"Expected function name."),n=this._argument_expression_list();return n===null?(this._current=t,null):this._updateNode(new BD(i.lexeme,n),e)}_loop_statement(){if(!this._match(Me.keywords.loop))return null;this._check(Me.tokens.attr)&&this._attribute(),this._consume(Me.tokens.brace_left,"Expected '{' for loop.");const e=this._updateNode(new nH([],null));this._currentLoop.push(e);let t=this._statement();for(;t!==null;){if(Array.isArray(t))for(let i of t)e.body.push(i);else e.body.push(t);if(t instanceof tR){e.continuing=t;break}t=this._statement()}return this._currentLoop.pop(),this._consume(Me.tokens.brace_right,"Expected '}' for loop."),e}_switch_statement(){if(!this._match(Me.keywords.switch))return null;const e=this._updateNode(new aH(null,[]));if(this._currentLoop.push(e),e.condition=this._optional_paren_expression(),this._check(Me.tokens.attr)&&this._attribute(),this._consume(Me.tokens.brace_left,"Expected '{' for switch."),e.cases=this._switch_body(),e.cases==null||e.cases.length==0)throw this._error(this._previous(),"Expected 'case' or 'default'.");return this._consume(Me.tokens.brace_right,"Expected '}' for switch."),this._currentLoop.pop(),e}_switch_body(){const e=[];let t=!1;for(;this._check([Me.keywords.default,Me.keywords.case]);){if(this._match(Me.keywords.case)){const i=this._case_selectors();for(const a of i)if(a instanceof w2){if(t)throw this._error(this._previous(),"Multiple default cases in switch statement.");t=!0;break}this._match(Me.tokens.colon),this._check(Me.tokens.attr)&&this._attribute(),this._consume(Me.tokens.brace_left,"Exected '{' for switch case.");const n=this._case_body();this._consume(Me.tokens.brace_right,"Exected '}' for switch case."),e.push(this._updateNode(new gH(i,n)))}if(this._match(Me.keywords.default)){if(t)throw this._error(this._previous(),"Multiple default cases in switch statement.");this._match(Me.tokens.colon),this._check(Me.tokens.attr)&&this._attribute(),this._consume(Me.tokens.brace_left,"Exected '{' for switch default.");const i=this._case_body();this._consume(Me.tokens.brace_right,"Exected '}' for switch default."),e.push(this._updateNode(new vH(i)))}}return e}_case_selectors(){const e=[];for(this._match(Me.keywords.default)?e.push(this._updateNode(new w2)):e.push(this._shift_expression());this._match(Me.tokens.comma);)this._match(Me.keywords.default)?e.push(this._updateNode(new w2)):e.push(this._shift_expression());return e}_case_body(){if(this._match(Me.keywords.fallthrough))return this._consume(Me.tokens.semicolon,"Expected ';'"),[];let e=this._statement();if(e==null)return[];e instanceof Array||(e=[e]);const t=this._case_body();return t.length==0?e:[...e,t[0]]}_if_statement(){if(!this._match(Me.keywords.if))return null;const e=this._currentLine,t=this._optional_paren_expression();this._check(Me.tokens.attr)&&this._attribute();const i=this._compound_statement();let n=[];this._match_elseif()&&(this._check(Me.tokens.attr)&&this._attribute(),n=this._elseif_statement(n));let a=null;return this._match(Me.keywords.else)&&(this._check(Me.tokens.attr)&&this._attribute(),a=this._compound_statement()),this._updateNode(new oH(t,i,n,a),e)}_match_elseif(){return this._tokens[this._current].type===Me.keywords.else&&this._tokens[this._current+1].type===Me.keywords.if&&(this._advance(),this._advance(),!0)}_elseif_statement(e=[]){const t=this._optional_paren_expression(),i=this._compound_statement();return e.push(this._updateNode(new rJ(t,i))),this._match_elseif()&&(this._check(Me.tokens.attr)&&this._attribute(),this._elseif_statement(e)),e}_return_statement(){if(!this._match(Me.keywords.return))return null;const e=this._short_circuit_or_expression();return this._updateNode(new sH(e))}_short_circuit_or_expression(){let e=this._short_circuit_and_expr();for(;this._match(Me.tokens.or_or);)e=this._updateNode(new vh(this._previous().toString(),e,this._short_circuit_and_expr()));return e}_short_circuit_and_expr(){let e=this._inclusive_or_expression();for(;this._match(Me.tokens.and_and);)e=this._updateNode(new vh(this._previous().toString(),e,this._inclusive_or_expression()));return e}_inclusive_or_expression(){let e=this._exclusive_or_expression();for(;this._match(Me.tokens.or);)e=this._updateNode(new vh(this._previous().toString(),e,this._exclusive_or_expression()));return e}_exclusive_or_expression(){let e=this._and_expression();for(;this._match(Me.tokens.xor);)e=this._updateNode(new vh(this._previous().toString(),e,this._and_expression()));return e}_and_expression(){let e=this._equality_expression();for(;this._match(Me.tokens.and);)e=this._updateNode(new vh(this._previous().toString(),e,this._equality_expression()));return e}_equality_expression(){const e=this._relational_expression();return this._match([Me.tokens.equal_equal,Me.tokens.not_equal])?this._updateNode(new vh(this._previous().toString(),e,this._relational_expression())):e}_relational_expression(){let e=this._shift_expression();for(;this._match([Me.tokens.less_than,Me.tokens.greater_than,Me.tokens.less_than_equal,Me.tokens.greater_than_equal]);)e=this._updateNode(new vh(this._previous().toString(),e,this._shift_expression()));return e}_shift_expression(){let e=this._additive_expression();for(;this._match([Me.tokens.shift_left,Me.tokens.shift_right]);)e=this._updateNode(new vh(this._previous().toString(),e,this._additive_expression()));return e}_additive_expression(){let e=this._multiplicative_expression();for(;this._match([Me.tokens.plus,Me.tokens.minus]);)e=this._updateNode(new vh(this._previous().toString(),e,this._multiplicative_expression()));return e}_multiplicative_expression(){let e=this._unary_expression();for(;this._match([Me.tokens.star,Me.tokens.forward_slash,Me.tokens.modulo]);)e=this._updateNode(new vh(this._previous().toString(),e,this._unary_expression()));return e}_unary_expression(){return this._match([Me.tokens.minus,Me.tokens.bang,Me.tokens.tilde,Me.tokens.star,Me.tokens.and])?this._updateNode(new Wa(this._previous().toString(),this._unary_expression())):this._singular_expression()}_singular_expression(){const e=this._primary_expression(),t=this._postfix_expression();return t&&(e.postfix=t),e}_postfix_expression(){if(this._match(Me.tokens.bracket_left)){const e=this._short_circuit_or_expression();this._consume(Me.tokens.bracket_right,"Expected ']'.");const t=this._updateNode(new L0(e)),i=this._postfix_expression();return i&&(t.postfix=i),t}if(this._match(Me.tokens.period)){const e=this._consume(Me.tokens.name,"Expected member name."),t=this._postfix_expression(),i=this._updateNode(new hy(e.lexeme));return t&&(i.postfix=t),i}return null}_getStruct(e){return this._context.aliases.has(e)?this._context.aliases.get(e).type:this._context.structs.has(e)?this._context.structs.get(e):null}_getType(e){const t=this._getStruct(e);if(t!==null)return t;switch(e){case"void":return Rt.void;case"bool":return Rt.bool;case"i32":return Rt.i32;case"u32":return Rt.u32;case"f32":return Rt.f32;case"f16":return Rt.f16;case"vec2f":return nt.vec2f;case"vec3f":return nt.vec3f;case"vec4f":return nt.vec4f;case"vec2i":return nt.vec2i;case"vec3i":return nt.vec3i;case"vec4i":return nt.vec4i;case"vec2u":return nt.vec2u;case"vec3u":return nt.vec3u;case"vec4u":return nt.vec4u;case"vec2h":return nt.vec2h;case"vec3h":return nt.vec3h;case"vec4h":return nt.vec4h;case"mat2x2f":return nt.mat2x2f;case"mat2x3f":return nt.mat2x3f;case"mat2x4f":return nt.mat2x4f;case"mat3x2f":return nt.mat3x2f;case"mat3x3f":return nt.mat3x3f;case"mat3x4f":return nt.mat3x4f;case"mat4x2f":return nt.mat4x2f;case"mat4x3f":return nt.mat4x3f;case"mat4x4f":return nt.mat4x4f;case"mat2x2h":return nt.mat2x2h;case"mat2x3h":return nt.mat2x3h;case"mat2x4h":return nt.mat2x4h;case"mat3x2h":return nt.mat3x2h;case"mat3x3h":return nt.mat3x3h;case"mat3x4h":return nt.mat3x4h;case"mat4x2h":return nt.mat4x2h;case"mat4x3h":return nt.mat4x3h;case"mat4x4h":return nt.mat4x4h;case"mat2x2i":return nt.mat2x2i;case"mat2x3i":return nt.mat2x3i;case"mat2x4i":return nt.mat2x4i;case"mat3x2i":return nt.mat3x2i;case"mat3x3i":return nt.mat3x3i;case"mat3x4i":return nt.mat3x4i;case"mat4x2i":return nt.mat4x2i;case"mat4x3i":return nt.mat4x3i;case"mat4x4i":return nt.mat4x4i;case"mat2x2u":return nt.mat2x2u;case"mat2x3u":return nt.mat2x3u;case"mat2x4u":return nt.mat2x4u;case"mat3x2u":return nt.mat3x2u;case"mat3x3u":return nt.mat3x3u;case"mat3x4u":return nt.mat3x4u;case"mat4x2u":return nt.mat4x2u;case"mat4x3u":return nt.mat4x3u;case"mat4x4u":return nt.mat4x4u}return null}_validateTypeRange(e,t){if(t.name==="i32"){if(e<-2147483648||e>2147483647)throw this._error(this._previous(),`Value out of range for i32: ${e}. Line: ${this._currentLine}.`)}else if(t.name==="u32"&&(e<0||e>4294967295))throw this._error(this._previous(),`Value out of range for u32: ${e}. Line: ${this._currentLine}.`)}_primary_expression(){if(this._match(Me.tokens.ident)){const i=this._previous().toString();if(this._check(Me.tokens.paren_left)){const n=this._argument_expression_list(),a=this._getType(i);return a!==null?this._updateNode(new Mf(a,n)):this._updateNode(new FD(i,n))}if(this._context.constants.has(i)){const n=this._context.constants.get(i);return this._updateNode(new hH(i,n.value))}return this._updateNode(new pu(i))}if(this._match(Me.tokens.int_literal)){const i=this._previous().toString();let n=i.endsWith("i")||i.endsWith("i")?Rt.i32:i.endsWith("u")||i.endsWith("U")?Rt.u32:Rt.x32;const a=parseInt(i);return this._validateTypeRange(a,n),this._updateNode(new no(new et(a,this._exec.getTypeInfo(n)),n))}if(this._match(Me.tokens.uint_literal)){const i=parseInt(this._previous().toString());return this._validateTypeRange(i,Rt.u32),this._updateNode(new no(new et(i,this._exec.getTypeInfo(Rt.u32)),Rt.u32))}if(this._match([Me.tokens.decimal_float_literal,Me.tokens.hex_float_literal])){let i=this._previous().toString(),n=i.endsWith("h");n&&(i=i.substring(0,i.length-1));const a=parseFloat(i);this._validateTypeRange(a,n?Rt.f16:Rt.f32);const s=n?Rt.f16:Rt.f32;return this._updateNode(new no(new et(a,this._exec.getTypeInfo(s)),s))}if(this._match([Me.keywords.true,Me.keywords.false])){let i=this._previous().toString()===Me.keywords.true.rule;return this._updateNode(new no(new et(i?1:0,this._exec.getTypeInfo(Rt.bool)),Rt.bool))}if(this._check(Me.tokens.paren_left))return this._paren_expression();if(this._match(Me.keywords.bitcast)){this._consume(Me.tokens.less_than,"Expected '<'.");const i=this._type_decl();this._consume(Me.tokens.greater_than,"Expected '>'.");const n=this._paren_expression();return this._updateNode(new fH(i,n))}const e=this._type_decl(),t=this._argument_expression_list();return this._updateNode(new Mf(e,t))}_argument_expression_list(){if(!this._match(Me.tokens.paren_left))return null;const e=[];do{if(this._check(Me.tokens.paren_right))break;const t=this._short_circuit_or_expression();e.push(t)}while(this._match(Me.tokens.comma));return this._consume(Me.tokens.paren_right,"Expected ')' for agument list"),e}_optional_paren_expression(){this._match(Me.tokens.paren_left);const e=this._short_circuit_or_expression();return this._match(Me.tokens.paren_right),e}_paren_expression(){this._consume(Me.tokens.paren_left,"Expected '('.");const e=this._short_circuit_or_expression();return this._consume(Me.tokens.paren_right,"Expected ')'."),e}_struct_decl(){if(!this._match(Me.keywords.struct))return null;const e=this._currentLine,t=this._consume(Me.tokens.ident,"Expected name for struct.").toString();this._consume(Me.tokens.brace_left,"Expected '{' for struct body.");const i=[];for(;!this._check(Me.tokens.brace_right);){const s=this._attribute(),o=this._consume(Me.tokens.name,"Expected variable name.").toString();this._consume(Me.tokens.colon,"Expected ':' for struct member type.");const l=this._attribute(),c=this._type_decl();c!=null&&(c.attributes=l),this._check(Me.tokens.brace_right)?this._match(Me.tokens.comma):this._consume(Me.tokens.comma,"Expected ',' for struct member."),i.push(this._updateNode(new IN(o,c,s)))}this._consume(Me.tokens.brace_right,"Expected '}' after struct body.");const n=this._currentLine,a=this._updateNode(new Qd(t,i,e,n),e);return this._context.structs.set(t,a),a}_global_variable_decl(){const e=this._variable_decl();if(!e)return null;if(this._match(Me.tokens.equal)){const t=this._const_expression();e.value=t}if(e.type!==null&&e.value instanceof no){if(e.value.type.name!=="x32"&&e.type.getTypeName()!==e.value.type.getTypeName())throw this._error(this._peek(),`Invalid cast from ${e.value.type.name} to ${e.type.name}. Line:${this._currentLine}`);e.value.isScalar&&this._validateTypeRange(e.value.scalarValue,e.type),e.value.type=e.type}else e.type===null&&e.value instanceof no&&(e.type=e.value.type.name==="x32"?Rt.i32:e.value.type,e.value.isScalar&&this._validateTypeRange(e.value.scalarValue,e.type));return e}_override_variable_decl(){const e=this._override_decl();return e&&this._match(Me.tokens.equal)&&(e.value=this._const_expression()),e}_global_const_decl(){var e;if(!this._match(Me.keywords.const))return null;const t=this._consume(Me.tokens.name,"Expected variable name"),i=this._currentLine;let n=null;if(this._match(Me.tokens.colon)){const l=this._attribute();n=this._type_decl(),n!=null&&(n.attributes=l)}let a=null;this._consume(Me.tokens.equal,"const declarations require an assignment");const s=this._short_circuit_or_expression();try{let l=[Rt.f32],c=s.constEvaluate(this._exec,l);c instanceof et&&this._validateTypeRange(c.value,l[0]),l[0]instanceof nt&&l[0].format===null&&c.typeInfo instanceof cy&&c.typeInfo.format!==null&&(c.typeInfo.format.name==="f16"?l[0].format=Rt.f16:c.typeInfo.format.name==="f32"?l[0].format=Rt.f32:c.typeInfo.format.name==="i32"?l[0].format=Rt.i32:c.typeInfo.format.name==="u32"?l[0].format=Rt.u32:c.typeInfo.format.name==="bool"?l[0].format=Rt.bool:console.error(`TODO: impelement template format type ${c.typeInfo.format.name}`)),a=this._updateNode(new no(c,l[0])),this._exec.context.setVariable(t.toString(),c)}catch{a=s}if(n!==null&&a instanceof no){if(a.type.name!=="x32"&&n.getTypeName()!==a.type.getTypeName())throw this._error(this._peek(),`Invalid cast from ${a.type.name} to ${n.name}. Line:${this._currentLine}`);a.type=n,a.isScalar&&this._validateTypeRange(a.scalarValue,a.type)}else n===null&&a instanceof no&&(n=(e=a?.type)!==null&&e!==void 0?e:Rt.f32,n===Rt.x32&&(n=Rt.i32));const o=this._updateNode(new b2(t.toString(),n,"","",a),i);return this._context.constants.set(o.name,o),o}_global_let_decl(){if(!this._match(Me.keywords.let))return null;const e=this._currentLine,t=this._consume(Me.tokens.name,"Expected variable name");let i=null;if(this._match(Me.tokens.colon)){const a=this._attribute();i=this._type_decl(),i!=null&&(i.attributes=a)}let n=null;if(this._match(Me.tokens.equal)&&(n=this._const_expression()),i!==null&&n instanceof no){if(n.type.name!=="x32"&&i.getTypeName()!==n.type.getTypeName())throw this._error(this._peek(),`Invalid cast from ${n.type.name} to ${i.name}. Line:${this._currentLine}`);n.type=i}else i===null&&n instanceof no&&(i=n.type.name==="x32"?Rt.i32:n.type);return n instanceof no&&n.isScalar&&this._validateTypeRange(n.scalarValue,i),this._updateNode(new E1(t.toString(),i,"","",n),e)}_const_expression(){return this._short_circuit_or_expression()}_variable_decl(){if(!this._match(Me.keywords.var))return null;const e=this._currentLine;let t="",i="";this._match(Me.tokens.less_than)&&(t=this._consume(Me.storage_class,"Expected storage_class.").toString(),this._match(Me.tokens.comma)&&(i=this._consume(Me.access_mode,"Expected access_mode.").toString()),this._consume(Me.tokens.greater_than,"Expected '>'."));const n=this._consume(Me.tokens.name,"Expected variable name");let a=null;if(this._match(Me.tokens.colon)){const s=this._attribute();a=this._type_decl(),a!=null&&(a.attributes=s)}return this._updateNode(new ep(n.toString(),a,t,i,null),e)}_override_decl(){if(!this._match(Me.keywords.override))return null;const e=this._consume(Me.tokens.name,"Expected variable name");let t=null;if(this._match(Me.tokens.colon)){const i=this._attribute();t=this._type_decl(),t!=null&&(t.attributes=i)}return this._updateNode(new ND(e.toString(),t,null))}_diagnostic(){this._consume(Me.tokens.paren_left,"Expected '('");const e=this._consume(Me.tokens.ident,"Expected severity control name.");this._consume(Me.tokens.comma,"Expected ','");let t=this._consume(Me.tokens.ident,"Expected diagnostic rule name.").toString();return this._match(Me.tokens.period)&&(t+=`.${this._consume(Me.tokens.ident,"Expected diagnostic message.").toString()}`),this._consume(Me.tokens.paren_right,"Expected ')'"),this._updateNode(new lH(e.toString(),t))}_enable_directive(){const e=this._consume(Me.tokens.ident,"identity expected.");return this._updateNode(new JQ(e.toString()))}_requires_directive(){const e=[this._consume(Me.tokens.ident,"identity expected.").toString()];for(;this._match(Me.tokens.comma);){const t=this._consume(Me.tokens.ident,"identity expected.");e.push(t.toString())}return this._updateNode(new eJ(e))}_type_alias(){const e=this._consume(Me.tokens.ident,"identity expected.");this._consume(Me.tokens.equal,"Expected '=' for type alias.");let t=this._type_decl();if(t===null)throw this._error(this._peek(),"Expected Type for Alias.");this._context.aliases.has(t.name)&&(t=this._context.aliases.get(t.name).type);const i=this._updateNode(new zD(e.toString(),t));return this._context.aliases.set(i.name,i),i}_type_decl(){if(this._check([Me.tokens.ident,...Me.texel_format,Me.keywords.bool,Me.keywords.f32,Me.keywords.i32,Me.keywords.u32])){const i=this._advance().toString();if(this._context.structs.has(i))return this._context.structs.get(i);if(this._context.aliases.has(i))return this._context.aliases.get(i).type;if(!this._getType(i)){const n=this._updateNode(new MN(i));return this._forwardTypeCount++,n}return this._updateNode(new Rt(i))}let e=this._texture_sampler_types();if(e)return e;if(this._check(Me.template_types)){let i=this._advance().toString(),n=null,a=null;return this._match(Me.tokens.less_than)&&(n=this._type_decl(),a=null,this._match(Me.tokens.comma)&&(a=this._consume(Me.access_mode,"Expected access_mode for pointer").toString()),this._consume(Me.tokens.greater_than,"Expected '>' for type.")),this._updateNode(new nt(i,n,a))}if(this._match(Me.keywords.ptr)){let i=this._previous().toString();this._consume(Me.tokens.less_than,"Expected '<' for pointer.");const n=this._consume(Me.storage_class,"Expected storage_class for pointer");this._consume(Me.tokens.comma,"Expected ',' for pointer.");const a=this._type_decl();let s=null;return this._match(Me.tokens.comma)&&(s=this._consume(Me.access_mode,"Expected access_mode for pointer").toString()),this._consume(Me.tokens.greater_than,"Expected '>' for pointer."),this._updateNode(new x2(i,n.toString(),a,s))}const t=this._attribute();if(this._match(Me.keywords.array)){let i=null,n=-1;const a=this._previous();let s=null;if(this._match(Me.tokens.less_than)){i=this._type_decl(),this._context.aliases.has(i.name)&&(i=this._context.aliases.get(i.name).type);let l="";if(this._match(Me.tokens.comma)){s=this._shift_expression();try{l=s.constEvaluate(this._exec).toString(),s=null}catch{l="1"}}this._consume(Me.tokens.greater_than,"Expected '>' for array."),n=l?parseInt(l):0}const o=this._updateNode(new I1(a.toString(),t,i,n));return s&&this._deferArrayCountEval.push({arrayType:o,countNode:s}),o}return null}_texture_sampler_types(){if(this._match(Me.sampler_type))return this._updateNode(new c1(this._previous().toString(),null,null));if(this._match(Me.depth_texture_type))return this._updateNode(new c1(this._previous().toString(),null,null));if(this._match(Me.sampled_texture_type)||this._match(Me.multisampled_texture_type)){const e=this._previous();this._consume(Me.tokens.less_than,"Expected '<' for sampler type.");const t=this._type_decl();return this._consume(Me.tokens.greater_than,"Expected '>' for sampler type."),this._updateNode(new c1(e.toString(),t,null))}if(this._match(Me.storage_texture_type)){const e=this._previous();this._consume(Me.tokens.less_than,"Expected '<' for sampler type.");const t=this._consume(Me.texel_format,"Invalid texel format.").toString();this._consume(Me.tokens.comma,"Expected ',' after texel format.");const i=this._consume(Me.access_mode,"Expected access mode for storage texture type.").toString();return this._consume(Me.tokens.greater_than,"Expected '>' for sampler type."),this._updateNode(new c1(e.toString(),t,i))}return null}_attribute(){let e=[];for(;this._match(Me.tokens.attr);){const t=this._consume(Me.attribute_name,"Expected attribute name"),i=this._updateNode(new mH(t.toString(),null));if(this._match(Me.tokens.paren_left)){if(i.value=this._consume(Me.literal_or_ident,"Expected attribute value").toString(),this._check(Me.tokens.comma)){this._advance();do{const n=this._consume(Me.literal_or_ident,"Expected attribute value").toString();i.value instanceof Array||(i.value=[i.value]),i.value.push(n)}while(this._match(Me.tokens.comma))}this._consume(Me.tokens.paren_right,"Expected ')'")}e.push(i)}return e.length==0?null:e}}class mJ extends Df{constructor(e){super(),e&&this.update(e)}update(e){const t=new vJ().parse(e);this.updateAST(t)}}function yJ(r){const e={attributes:[],bindings:[]};let t;try{t=_J(r)}catch(a){return Nt.error(a.message)(),e}for(const a of t.uniforms){const s=[];for(const o of a.type?.members||[])s.push({name:o.name,type:DN(o.type)});e.bindings.push({type:"uniform",name:a.name,group:a.group,location:a.binding,members:s})}for(const a of t.textures)e.bindings.push({type:"texture",name:a.name,group:a.group,location:a.binding});for(const a of t.samplers)e.bindings.push({type:"sampler",name:a.name,group:a.group,location:a.binding});const i=t.entry.vertex[0],n=i?.inputs.length||0;for(let a=0;a<n;a++){const s=i.inputs[a];if(s.locationType==="location"){const o=DN(s.type);e.attributes.push({name:s.name,location:Number(s.location),type:o})}}return e}function DN(r){return r?.format?`${r.name}<${r.format.name}>`:r.name}function _J(r){try{return new mJ(r)}catch(e){if(e instanceof Error)throw e;let t="WGSL parse error";throw typeof e=="object"&&e?.message&&(t+=`: ${e.message} `),typeof e=="object"&&e?.token&&(t+=e.token.line||""),new Error(t,{cause:e})}}const bJ={EPSILON:1e-12,debug:!1,precision:4,printTypes:!1,printDegrees:!1,printRowMajor:!0,_cartographicRadians:!1};globalThis.mathgl=globalThis.mathgl||{config:{...bJ}};const _c=globalThis.mathgl.config;function xJ(r,{precision:e=_c.precision}={}){return r=wJ(r),`${parseFloat(r.toPrecision(e))}`}function O0(r){return Array.isArray(r)||ArrayBuffer.isView(r)&&!(r instanceof DataView)}function kf(r,e,t){return TJ(r,i=>Math.max(e,Math.min(t,i)))}function sA(r,e,t){return O0(r)?r.map((i,n)=>sA(i,e[n],t)):t*e+(1-t)*r}function J1(r,e,t){const i=_c.EPSILON;try{if(r===e)return!0;if(O0(r)&&O0(e)){if(r.length!==e.length)return!1;for(let n=0;n<r.length;++n)if(!J1(r[n],e[n]))return!1;return!0}return r&&r.equals?r.equals(e):e&&e.equals?e.equals(r):typeof r=="number"&&typeof e=="number"?Math.abs(r-e)<=_c.EPSILON*Math.max(1,Math.abs(r),Math.abs(e)):!1}finally{_c.EPSILON=i}}function wJ(r){return Math.round(r/_c.EPSILON)*_c.EPSILON}function SJ(r){return r.clone?r.clone():new Array(r.length)}function TJ(r,e,t){if(O0(r)){const i=r;t=t||SJ(i);for(let n=0;n<t.length&&n<i.length;++n){const a=typeof r=="number"?r:r[n];t[n]=e(a,n,t)}return t}return e(r)}class _H extends Array{clone(){return new this.constructor().copy(this)}fromArray(e,t=0){for(let i=0;i<this.ELEMENTS;++i)this[i]=e[i+t];return this.check()}toArray(e=[],t=0){for(let i=0;i<this.ELEMENTS;++i)e[t+i]=this[i];return e}toObject(e){return e}from(e){return Array.isArray(e)?this.copy(e):this.fromObject(e)}to(e){return e===this?this:O0(e)?this.toArray(e):this.toObject(e)}toTarget(e){return e?this.to(e):this}toFloat32Array(){return new Float32Array(this)}toString(){return this.formatString(_c)}formatString(e){let t="";for(let i=0;i<this.ELEMENTS;++i)t+=(i>0?", ":"")+xJ(this[i],e);return`${e.printTypes?this.constructor.name:""}[${t}]`}equals(e){if(!e||this.length!==e.length)return!1;for(let t=0;t<this.ELEMENTS;++t)if(!J1(this[t],e[t]))return!1;return!0}exactEquals(e){if(!e||this.length!==e.length)return!1;for(let t=0;t<this.ELEMENTS;++t)if(this[t]!==e[t])return!1;return!0}negate(){for(let e=0;e<this.ELEMENTS;++e)this[e]=-this[e];return this.check()}lerp(e,t,i){if(i===void 0)return this.lerp(this,e,t);for(let n=0;n<this.ELEMENTS;++n){const a=e[n],s=typeof t=="number"?t:t[n];this[n]=a+i*(s-a)}return this.check()}min(e){for(let t=0;t<this.ELEMENTS;++t)this[t]=Math.min(e[t],this[t]);return this.check()}max(e){for(let t=0;t<this.ELEMENTS;++t)this[t]=Math.max(e[t],this[t]);return this.check()}clamp(e,t){for(let i=0;i<this.ELEMENTS;++i)this[i]=Math.min(Math.max(this[i],e[i]),t[i]);return this.check()}add(...e){for(const t of e)for(let i=0;i<this.ELEMENTS;++i)this[i]+=t[i];return this.check()}subtract(...e){for(const t of e)for(let i=0;i<this.ELEMENTS;++i)this[i]-=t[i];return this.check()}scale(e){if(typeof e=="number")for(let t=0;t<this.ELEMENTS;++t)this[t]*=e;else for(let t=0;t<this.ELEMENTS&&t<e.length;++t)this[t]*=e[t];return this.check()}multiplyByScalar(e){for(let t=0;t<this.ELEMENTS;++t)this[t]*=e;return this.check()}check(){if(_c.debug&&!this.validate())throw new Error(`math.gl: ${this.constructor.name} some fields set to invalid numbers'`);return this}validate(){let e=this.length===this.ELEMENTS;for(let t=0;t<this.ELEMENTS;++t)e=e&&Number.isFinite(this[t]);return e}sub(e){return this.subtract(e)}setScalar(e){for(let t=0;t<this.ELEMENTS;++t)this[t]=e;return this.check()}addScalar(e){for(let t=0;t<this.ELEMENTS;++t)this[t]+=e;return this.check()}subScalar(e){return this.addScalar(-e)}multiplyScalar(e){for(let t=0;t<this.ELEMENTS;++t)this[t]*=e;return this.check()}divideScalar(e){return this.multiplyByScalar(1/e)}clampScalar(e,t){for(let i=0;i<this.ELEMENTS;++i)this[i]=Math.min(Math.max(this[i],e),t);return this.check()}get elements(){return this}}function AJ(r,e){if(r.length!==e)return!1;for(let t=0;t<r.length;++t)if(!Number.isFinite(r[t]))return!1;return!0}function du(r){if(!Number.isFinite(r))throw new Error(`Invalid number ${JSON.stringify(r)}`);return r}function qM(r,e,t=""){if(_c.debug&&!AJ(r,e))throw new Error(`math.gl: ${t} some fields set to invalid numbers'`);return r}function kN(r,e){if(!r)throw new Error(`math.gl assertion ${e}`)}class CJ extends _H{get x(){return this[0]}set x(e){this[0]=du(e)}get y(){return this[1]}set y(e){this[1]=du(e)}len(){return Math.sqrt(this.lengthSquared())}magnitude(){return this.len()}lengthSquared(){let e=0;for(let t=0;t<this.ELEMENTS;++t)e+=this[t]*this[t];return e}magnitudeSquared(){return this.lengthSquared()}distance(e){return Math.sqrt(this.distanceSquared(e))}distanceSquared(e){let t=0;for(let i=0;i<this.ELEMENTS;++i){const n=this[i]-e[i];t+=n*n}return du(t)}dot(e){let t=0;for(let i=0;i<this.ELEMENTS;++i)t+=this[i]*e[i];return du(t)}normalize(){const e=this.magnitude();if(e!==0)for(let t=0;t<this.ELEMENTS;++t)this[t]/=e;return this.check()}multiply(...e){for(const t of e)for(let i=0;i<this.ELEMENTS;++i)this[i]*=t[i];return this.check()}divide(...e){for(const t of e)for(let i=0;i<this.ELEMENTS;++i)this[i]/=t[i];return this.check()}lengthSq(){return this.lengthSquared()}distanceTo(e){return this.distance(e)}distanceToSquared(e){return this.distanceSquared(e)}getComponent(e){return kN(e>=0&&e<this.ELEMENTS,"index is out of range"),du(this[e])}setComponent(e,t){return kN(e>=0&&e<this.ELEMENTS,"index is out of range"),this[e]=t,this.check()}addVectors(e,t){return this.copy(e).add(t)}subVectors(e,t){return this.copy(e).subtract(t)}multiplyVectors(e,t){return this.copy(e).multiply(t)}addScaledVector(e,t){return this.add(new this.constructor(e).multiplyScalar(t))}}const S2=1e-6;let N0=typeof Float32Array<"u"?Float32Array:Array;function MJ(){const r=new N0(2);return N0!=Float32Array&&(r[0]=0,r[1]=0),r}function LN(r,e,t){return r[0]=e[0]+t[0],r[1]=e[1]+t[1],r}function EJ(r,e){return r[0]=-e[0],r[1]=-e[1],r}function bH(r,e,t,i){const n=e[0],a=e[1];return r[0]=n+i*(t[0]-n),r[1]=a+i*(t[1]-a),r}function IJ(r,e,t){const i=e[0],n=e[1];return r[0]=t[0]*i+t[4]*n+t[12],r[1]=t[1]*i+t[5]*n+t[13],r}(function(){const r=MJ();return function(e,t,i,n,a,s){let o,l;for(t||(t=2),i||(i=0),n?l=Math.min(n*t+i,e.length):l=e.length,o=i;o<l;o+=t)r[0]=e[o],r[1]=e[o+1],a(r,r,s),e[o]=r[0],e[o+1]=r[1];return e}})();function PJ(r,e,t){const i=e[0],n=e[1],a=t[3]*i+t[7]*n||1;return r[0]=(t[0]*i+t[4]*n)/a,r[1]=(t[1]*i+t[5]*n)/a,r}function xH(r,e,t){const i=e[0],n=e[1],a=e[2],s=t[3]*i+t[7]*n+t[11]*a||1;return r[0]=(t[0]*i+t[4]*n+t[8]*a)/s,r[1]=(t[1]*i+t[5]*n+t[9]*a)/s,r[2]=(t[2]*i+t[6]*n+t[10]*a)/s,r}function RJ(r,e,t){const i=e[0],n=e[1];return r[0]=t[0]*i+t[2]*n,r[1]=t[1]*i+t[3]*n,r[2]=e[2],r}function DJ(){const r=new N0(3);return N0!=Float32Array&&(r[0]=0,r[1]=0,r[2]=0),r}function kJ(r){const e=r[0],t=r[1],i=r[2];return Math.sqrt(e*e+t*t+i*i)}function LJ(r,e,t){return r[0]=e[0]-t[0],r[1]=e[1]-t[1],r[2]=e[2]-t[2],r}function OJ(r){const e=r[0],t=r[1],i=r[2];return e*e+t*t+i*i}function NJ(r,e){return r[0]=-e[0],r[1]=-e[1],r[2]=-e[2],r}function BJ(r,e){return r[0]*e[0]+r[1]*e[1]+r[2]*e[2]}function zJ(r,e,t){const i=e[0],n=e[1],a=e[2],s=t[0],o=t[1],l=t[2];return r[0]=n*l-a*o,r[1]=a*s-i*l,r[2]=i*o-n*s,r}function FJ(r,e,t,i){const n=e[0],a=e[1],s=e[2];return r[0]=n+i*(t[0]-n),r[1]=a+i*(t[1]-a),r[2]=s+i*(t[2]-s),r}function wH(r,e,t){const i=e[0],n=e[1],a=e[2];let s=t[3]*i+t[7]*n+t[11]*a+t[15];return s=s||1,r[0]=(t[0]*i+t[4]*n+t[8]*a+t[12])/s,r[1]=(t[1]*i+t[5]*n+t[9]*a+t[13])/s,r[2]=(t[2]*i+t[6]*n+t[10]*a+t[14])/s,r}function VJ(r,e,t){const i=e[0],n=e[1],a=e[2];return r[0]=i*t[0]+n*t[3]+a*t[6],r[1]=i*t[1]+n*t[4]+a*t[7],r[2]=i*t[2]+n*t[5]+a*t[8],r}function UJ(r,e,t){const i=t[0],n=t[1],a=t[2],s=t[3],o=e[0],l=e[1],c=e[2];let f=n*c-a*l,p=a*o-i*c,y=i*l-n*o,b=n*y-a*p,S=a*f-i*y,C=i*p-n*f;const E=s*2;return f*=E,p*=E,y*=E,b*=2,S*=2,C*=2,r[0]=o+f+b,r[1]=l+p+S,r[2]=c+y+C,r}function HJ(r,e,t,i){const n=[],a=[];return n[0]=e[0]-t[0],n[1]=e[1]-t[1],n[2]=e[2]-t[2],a[0]=n[0],a[1]=n[1]*Math.cos(i)-n[2]*Math.sin(i),a[2]=n[1]*Math.sin(i)+n[2]*Math.cos(i),r[0]=a[0]+t[0],r[1]=a[1]+t[1],r[2]=a[2]+t[2],r}function jJ(r,e,t,i){const n=[],a=[];return n[0]=e[0]-t[0],n[1]=e[1]-t[1],n[2]=e[2]-t[2],a[0]=n[2]*Math.sin(i)+n[0]*Math.cos(i),a[1]=n[1],a[2]=n[2]*Math.cos(i)-n[0]*Math.sin(i),r[0]=a[0]+t[0],r[1]=a[1]+t[1],r[2]=a[2]+t[2],r}function $J(r,e,t,i){const n=[],a=[];return n[0]=e[0]-t[0],n[1]=e[1]-t[1],n[2]=e[2]-t[2],a[0]=n[0]*Math.cos(i)-n[1]*Math.sin(i),a[1]=n[0]*Math.sin(i)+n[1]*Math.cos(i),a[2]=n[2],r[0]=a[0]+t[0],r[1]=a[1]+t[1],r[2]=a[2]+t[2],r}function WJ(r,e){const t=r[0],i=r[1],n=r[2],a=e[0],s=e[1],o=e[2],l=Math.sqrt((t*t+i*i+n*n)*(a*a+s*s+o*o)),c=l&&BJ(r,e)/l;return Math.acos(Math.min(Math.max(c,-1),1))}const SH=LJ,GJ=kJ,YM=OJ;(function(){const r=DJ();return function(e,t,i,n,a,s){let o,l;for(t||(t=3),i||(i=0),n?l=Math.min(n*t+i,e.length):l=e.length,o=i;o<l;o+=t)r[0]=e[o],r[1]=e[o+1],r[2]=e[o+2],a(r,r,s),e[o]=r[0],e[o+1]=r[1],e[o+2]=r[2];return e}})();const KM=[0,0,0];let aT;class Vf extends CJ{static get ZERO(){return aT||(aT=new Vf(0,0,0),Object.freeze(aT)),aT}constructor(e=0,t=0,i=0){super(-0,-0,-0),arguments.length===1&&O0(e)?this.copy(e):(_c.debug&&(du(e),du(t),du(i)),this[0]=e,this[1]=t,this[2]=i)}set(e,t,i){return this[0]=e,this[1]=t,this[2]=i,this.check()}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this.check()}fromObject(e){return _c.debug&&(du(e.x),du(e.y),du(e.z)),this[0]=e.x,this[1]=e.y,this[2]=e.z,this.check()}toObject(e){return e.x=this[0],e.y=this[1],e.z=this[2],e}get ELEMENTS(){return 3}get z(){return this[2]}set z(e){this[2]=du(e)}angle(e){return WJ(this,e)}cross(e){return zJ(this,this,e),this.check()}rotateX({radians:e,origin:t=KM}){return HJ(this,this,t,e),this.check()}rotateY({radians:e,origin:t=KM}){return jJ(this,this,t,e),this.check()}rotateZ({radians:e,origin:t=KM}){return $J(this,this,t,e),this.check()}transform(e){return this.transformAsPoint(e)}transformAsPoint(e){return wH(this,this,e),this.check()}transformAsVector(e){return xH(this,this,e),this.check()}transformByMatrix3(e){return VJ(this,this,e),this.check()}transformByMatrix2(e){return RJ(this,this,e),this.check()}transformByQuaternion(e){return UJ(this,this,e),this.check()}}class XJ extends _H{toString(){let e="[";if(_c.printRowMajor){e+="row-major:";for(let t=0;t<this.RANK;++t)for(let i=0;i<this.RANK;++i)e+=` ${this[i*this.RANK+t]}`}else{e+="column-major:";for(let t=0;t<this.ELEMENTS;++t)e+=` ${this[t]}`}return e+="]",e}getElementIndex(e,t){return t*this.RANK+e}getElement(e,t){return this[t*this.RANK+e]}setElement(e,t,i){return this[t*this.RANK+e]=du(i),this}getColumn(e,t=new Array(this.RANK).fill(-0)){const i=e*this.RANK;for(let n=0;n<this.RANK;++n)t[n]=this[i+n];return t}setColumn(e,t){const i=e*this.RANK;for(let n=0;n<this.RANK;++n)this[i+n]=t[n];return this}}function ZJ(r){return r[0]=1,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=1,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=1,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r}function qJ(r,e){if(r===e){const t=e[1],i=e[2],n=e[3],a=e[6],s=e[7],o=e[11];r[1]=e[4],r[2]=e[8],r[3]=e[12],r[4]=t,r[6]=e[9],r[7]=e[13],r[8]=i,r[9]=a,r[11]=e[14],r[12]=n,r[13]=s,r[14]=o}else r[0]=e[0],r[1]=e[4],r[2]=e[8],r[3]=e[12],r[4]=e[1],r[5]=e[5],r[6]=e[9],r[7]=e[13],r[8]=e[2],r[9]=e[6],r[10]=e[10],r[11]=e[14],r[12]=e[3],r[13]=e[7],r[14]=e[11],r[15]=e[15];return r}function iR(r,e){const t=e[0],i=e[1],n=e[2],a=e[3],s=e[4],o=e[5],l=e[6],c=e[7],f=e[8],p=e[9],y=e[10],b=e[11],S=e[12],C=e[13],E=e[14],P=e[15],O=t*o-i*s,B=t*l-n*s,F=t*c-a*s,W=i*l-n*o,$=i*c-a*o,q=n*c-a*l,Q=f*C-p*S,ee=f*E-y*S,te=f*P-b*S,ae=p*E-y*C,de=p*P-b*C,ve=y*P-b*E;let ye=O*ve-B*de+F*ae+W*te-$*ee+q*Q;return ye?(ye=1/ye,r[0]=(o*ve-l*de+c*ae)*ye,r[1]=(n*de-i*ve-a*ae)*ye,r[2]=(C*q-E*$+P*W)*ye,r[3]=(y*$-p*q-b*W)*ye,r[4]=(l*te-s*ve-c*ee)*ye,r[5]=(t*ve-n*te+a*ee)*ye,r[6]=(E*F-S*q-P*B)*ye,r[7]=(f*q-y*F+b*B)*ye,r[8]=(s*de-o*te+c*Q)*ye,r[9]=(i*te-t*de-a*Q)*ye,r[10]=(S*$-C*F+P*O)*ye,r[11]=(p*F-f*$-b*O)*ye,r[12]=(o*ee-s*ae-l*Q)*ye,r[13]=(t*ae-i*ee+n*Q)*ye,r[14]=(C*B-S*W-E*O)*ye,r[15]=(f*W-p*B+y*O)*ye,r):null}function YJ(r){const e=r[0],t=r[1],i=r[2],n=r[3],a=r[4],s=r[5],o=r[6],l=r[7],c=r[8],f=r[9],p=r[10],y=r[11],b=r[12],S=r[13],C=r[14],E=r[15],P=e*s-t*a,O=e*o-i*a,B=t*o-i*s,F=c*S-f*b,W=c*C-p*b,$=f*C-p*S,q=e*$-t*W+i*F,Q=a*$-s*W+o*F,ee=c*B-f*O+p*P,te=b*B-S*O+C*P;return l*q-n*Q+E*ee-y*te}function Km(r,e,t){const i=e[0],n=e[1],a=e[2],s=e[3],o=e[4],l=e[5],c=e[6],f=e[7],p=e[8],y=e[9],b=e[10],S=e[11],C=e[12],E=e[13],P=e[14],O=e[15];let B=t[0],F=t[1],W=t[2],$=t[3];return r[0]=B*i+F*o+W*p+$*C,r[1]=B*n+F*l+W*y+$*E,r[2]=B*a+F*c+W*b+$*P,r[3]=B*s+F*f+W*S+$*O,B=t[4],F=t[5],W=t[6],$=t[7],r[4]=B*i+F*o+W*p+$*C,r[5]=B*n+F*l+W*y+$*E,r[6]=B*a+F*c+W*b+$*P,r[7]=B*s+F*f+W*S+$*O,B=t[8],F=t[9],W=t[10],$=t[11],r[8]=B*i+F*o+W*p+$*C,r[9]=B*n+F*l+W*y+$*E,r[10]=B*a+F*c+W*b+$*P,r[11]=B*s+F*f+W*S+$*O,B=t[12],F=t[13],W=t[14],$=t[15],r[12]=B*i+F*o+W*p+$*C,r[13]=B*n+F*l+W*y+$*E,r[14]=B*a+F*c+W*b+$*P,r[15]=B*s+F*f+W*S+$*O,r}function lA(r,e,t){const i=t[0],n=t[1],a=t[2];let s,o,l,c,f,p,y,b,S,C,E,P;return e===r?(r[12]=e[0]*i+e[4]*n+e[8]*a+e[12],r[13]=e[1]*i+e[5]*n+e[9]*a+e[13],r[14]=e[2]*i+e[6]*n+e[10]*a+e[14],r[15]=e[3]*i+e[7]*n+e[11]*a+e[15]):(s=e[0],o=e[1],l=e[2],c=e[3],f=e[4],p=e[5],y=e[6],b=e[7],S=e[8],C=e[9],E=e[10],P=e[11],r[0]=s,r[1]=o,r[2]=l,r[3]=c,r[4]=f,r[5]=p,r[6]=y,r[7]=b,r[8]=S,r[9]=C,r[10]=E,r[11]=P,r[12]=s*i+f*n+S*a+e[12],r[13]=o*i+p*n+C*a+e[13],r[14]=l*i+y*n+E*a+e[14],r[15]=c*i+b*n+P*a+e[15]),r}function jD(r,e,t){const i=t[0],n=t[1],a=t[2];return r[0]=e[0]*i,r[1]=e[1]*i,r[2]=e[2]*i,r[3]=e[3]*i,r[4]=e[4]*n,r[5]=e[5]*n,r[6]=e[6]*n,r[7]=e[7]*n,r[8]=e[8]*a,r[9]=e[9]*a,r[10]=e[10]*a,r[11]=e[11]*a,r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15],r}function KJ(r,e,t,i){let n=i[0],a=i[1],s=i[2],o=Math.sqrt(n*n+a*a+s*s),l,c,f,p,y,b,S,C,E,P,O,B,F,W,$,q,Q,ee,te,ae,de,ve,ye,Ae;return o<S2?null:(o=1/o,n*=o,a*=o,s*=o,c=Math.sin(t),l=Math.cos(t),f=1-l,p=e[0],y=e[1],b=e[2],S=e[3],C=e[4],E=e[5],P=e[6],O=e[7],B=e[8],F=e[9],W=e[10],$=e[11],q=n*n*f+l,Q=a*n*f+s*c,ee=s*n*f-a*c,te=n*a*f-s*c,ae=a*a*f+l,de=s*a*f+n*c,ve=n*s*f+a*c,ye=a*s*f-n*c,Ae=s*s*f+l,r[0]=p*q+C*Q+B*ee,r[1]=y*q+E*Q+F*ee,r[2]=b*q+P*Q+W*ee,r[3]=S*q+O*Q+$*ee,r[4]=p*te+C*ae+B*de,r[5]=y*te+E*ae+F*de,r[6]=b*te+P*ae+W*de,r[7]=S*te+O*ae+$*de,r[8]=p*ve+C*ye+B*Ae,r[9]=y*ve+E*ye+F*Ae,r[10]=b*ve+P*ye+W*Ae,r[11]=S*ve+O*ye+$*Ae,e!==r&&(r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15]),r)}function TH(r,e,t){const i=Math.sin(t),n=Math.cos(t),a=e[4],s=e[5],o=e[6],l=e[7],c=e[8],f=e[9],p=e[10],y=e[11];return e!==r&&(r[0]=e[0],r[1]=e[1],r[2]=e[2],r[3]=e[3],r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15]),r[4]=a*n+c*i,r[5]=s*n+f*i,r[6]=o*n+p*i,r[7]=l*n+y*i,r[8]=c*n-a*i,r[9]=f*n-s*i,r[10]=p*n-o*i,r[11]=y*n-l*i,r}function QJ(r,e,t){const i=Math.sin(t),n=Math.cos(t),a=e[0],s=e[1],o=e[2],l=e[3],c=e[8],f=e[9],p=e[10],y=e[11];return e!==r&&(r[4]=e[4],r[5]=e[5],r[6]=e[6],r[7]=e[7],r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15]),r[0]=a*n-c*i,r[1]=s*n-f*i,r[2]=o*n-p*i,r[3]=l*n-y*i,r[8]=a*i+c*n,r[9]=s*i+f*n,r[10]=o*i+p*n,r[11]=l*i+y*n,r}function AH(r,e,t){const i=Math.sin(t),n=Math.cos(t),a=e[0],s=e[1],o=e[2],l=e[3],c=e[4],f=e[5],p=e[6],y=e[7];return e!==r&&(r[8]=e[8],r[9]=e[9],r[10]=e[10],r[11]=e[11],r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15]),r[0]=a*n+c*i,r[1]=s*n+f*i,r[2]=o*n+p*i,r[3]=l*n+y*i,r[4]=c*n-a*i,r[5]=f*n-s*i,r[6]=p*n-o*i,r[7]=y*n-l*i,r}function JJ(r,e){const t=e[0],i=e[1],n=e[2],a=e[3],s=t+t,o=i+i,l=n+n,c=t*s,f=i*s,p=i*o,y=n*s,b=n*o,S=n*l,C=a*s,E=a*o,P=a*l;return r[0]=1-p-S,r[1]=f+P,r[2]=y-E,r[3]=0,r[4]=f-P,r[5]=1-c-S,r[6]=b+C,r[7]=0,r[8]=y+E,r[9]=b-C,r[10]=1-c-p,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r}function eee(r,e,t,i,n,a,s){const o=1/(t-e),l=1/(n-i),c=1/(a-s);return r[0]=a*2*o,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=a*2*l,r[6]=0,r[7]=0,r[8]=(t+e)*o,r[9]=(n+i)*l,r[10]=(s+a)*c,r[11]=-1,r[12]=0,r[13]=0,r[14]=s*a*2*c,r[15]=0,r}function tee(r,e,t,i,n){const a=1/Math.tan(e/2);if(r[0]=a/t,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=a,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[11]=-1,r[12]=0,r[13]=0,r[15]=0,n!=null&&n!==1/0){const s=1/(i-n);r[10]=(n+i)*s,r[14]=2*n*i*s}else r[10]=-1,r[14]=-2*i;return r}const ree=tee;function iee(r,e,t,i,n,a,s){const o=1/(e-t),l=1/(i-n),c=1/(a-s);return r[0]=-2*o,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=-2*l,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=2*c,r[11]=0,r[12]=(e+t)*o,r[13]=(n+i)*l,r[14]=(s+a)*c,r[15]=1,r}const nee=iee;function aee(r,e,t,i){let n,a,s,o,l,c,f,p,y,b;const S=e[0],C=e[1],E=e[2],P=i[0],O=i[1],B=i[2],F=t[0],W=t[1],$=t[2];return Math.abs(S-F)<S2&&Math.abs(C-W)<S2&&Math.abs(E-$)<S2?ZJ(r):(p=S-F,y=C-W,b=E-$,n=1/Math.sqrt(p*p+y*y+b*b),p*=n,y*=n,b*=n,a=O*b-B*y,s=B*p-P*b,o=P*y-O*p,n=Math.sqrt(a*a+s*s+o*o),n?(n=1/n,a*=n,s*=n,o*=n):(a=0,s=0,o=0),l=y*o-b*s,c=b*a-p*o,f=p*s-y*a,n=Math.sqrt(l*l+c*c+f*f),n?(n=1/n,l*=n,c*=n,f*=n):(l=0,c=0,f=0),r[0]=a,r[1]=l,r[2]=p,r[3]=0,r[4]=s,r[5]=c,r[6]=y,r[7]=0,r[8]=o,r[9]=f,r[10]=b,r[11]=0,r[12]=-(a*S+s*C+o*E),r[13]=-(l*S+c*C+f*E),r[14]=-(p*S+y*C+b*E),r[15]=1,r)}function oee(){const r=new N0(4);return N0!=Float32Array&&(r[0]=0,r[1]=0,r[2]=0,r[3]=0),r}function CH(r,e,t){return r[0]=e[0]*t,r[1]=e[1]*t,r[2]=e[2]*t,r[3]=e[3]*t,r}function tb(r,e,t){const i=e[0],n=e[1],a=e[2],s=e[3];return r[0]=t[0]*i+t[4]*n+t[8]*a+t[12]*s,r[1]=t[1]*i+t[5]*n+t[9]*a+t[13]*s,r[2]=t[2]*i+t[6]*n+t[10]*a+t[14]*s,r[3]=t[3]*i+t[7]*n+t[11]*a+t[15]*s,r}(function(){const r=oee();return function(e,t,i,n,a,s){let o,l;for(t||(t=4),i||(i=0),n?l=Math.min(n*t+i,e.length):l=e.length,o=i;o<l;o+=t)r[0]=e[o],r[1]=e[o+1],r[2]=e[o+2],r[3]=e[o+3],a(r,r,s),e[o]=r[0],e[o+1]=r[1],e[o+2]=r[2],e[o+3]=r[3];return e}})();var nR;(function(r){r[r.COL0ROW0=0]="COL0ROW0",r[r.COL0ROW1=1]="COL0ROW1",r[r.COL0ROW2=2]="COL0ROW2",r[r.COL0ROW3=3]="COL0ROW3",r[r.COL1ROW0=4]="COL1ROW0",r[r.COL1ROW1=5]="COL1ROW1",r[r.COL1ROW2=6]="COL1ROW2",r[r.COL1ROW3=7]="COL1ROW3",r[r.COL2ROW0=8]="COL2ROW0",r[r.COL2ROW1=9]="COL2ROW1",r[r.COL2ROW2=10]="COL2ROW2",r[r.COL2ROW3=11]="COL2ROW3",r[r.COL3ROW0=12]="COL3ROW0",r[r.COL3ROW1=13]="COL3ROW1",r[r.COL3ROW2=14]="COL3ROW2",r[r.COL3ROW3=15]="COL3ROW3"})(nR||(nR={}));const see=45*Math.PI/180,lee=1,QM=.1,JM=500,uee=Object.freeze([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]);class Eh extends XJ{static get IDENTITY(){return hee()}static get ZERO(){return cee()}get ELEMENTS(){return 16}get RANK(){return 4}get INDICES(){return nR}constructor(e){super(-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0),arguments.length===1&&Array.isArray(e)?this.copy(e):this.identity()}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this[3]=e[3],this[4]=e[4],this[5]=e[5],this[6]=e[6],this[7]=e[7],this[8]=e[8],this[9]=e[9],this[10]=e[10],this[11]=e[11],this[12]=e[12],this[13]=e[13],this[14]=e[14],this[15]=e[15],this.check()}set(e,t,i,n,a,s,o,l,c,f,p,y,b,S,C,E){return this[0]=e,this[1]=t,this[2]=i,this[3]=n,this[4]=a,this[5]=s,this[6]=o,this[7]=l,this[8]=c,this[9]=f,this[10]=p,this[11]=y,this[12]=b,this[13]=S,this[14]=C,this[15]=E,this.check()}setRowMajor(e,t,i,n,a,s,o,l,c,f,p,y,b,S,C,E){return this[0]=e,this[1]=a,this[2]=c,this[3]=b,this[4]=t,this[5]=s,this[6]=f,this[7]=S,this[8]=i,this[9]=o,this[10]=p,this[11]=C,this[12]=n,this[13]=l,this[14]=y,this[15]=E,this.check()}toRowMajor(e){return e[0]=this[0],e[1]=this[4],e[2]=this[8],e[3]=this[12],e[4]=this[1],e[5]=this[5],e[6]=this[9],e[7]=this[13],e[8]=this[2],e[9]=this[6],e[10]=this[10],e[11]=this[14],e[12]=this[3],e[13]=this[7],e[14]=this[11],e[15]=this[15],e}identity(){return this.copy(uee)}fromObject(e){return this.check()}fromQuaternion(e){return JJ(this,e),this.check()}frustum(e){const{left:t,right:i,bottom:n,top:a,near:s=QM,far:o=JM}=e;return o===1/0?fee(this,t,i,n,a,s):eee(this,t,i,n,a,s,o),this.check()}lookAt(e){const{eye:t,center:i=[0,0,0],up:n=[0,1,0]}=e;return aee(this,t,i,n),this.check()}ortho(e){const{left:t,right:i,bottom:n,top:a,near:s=QM,far:o=JM}=e;return nee(this,t,i,n,a,s,o),this.check()}orthographic(e){const{fovy:t=see,aspect:i=lee,focalDistance:n=1,near:a=QM,far:s=JM}=e;ON(t);const o=t/2,l=n*Math.tan(o),c=l*i;return this.ortho({left:-c,right:c,bottom:-l,top:l,near:a,far:s})}perspective(e){const{fovy:t=45*Math.PI/180,aspect:i=1,near:n=.1,far:a=500}=e;return ON(t),ree(this,t,i,n,a),this.check()}determinant(){return YJ(this)}getScale(e=[-0,-0,-0]){return e[0]=Math.sqrt(this[0]*this[0]+this[1]*this[1]+this[2]*this[2]),e[1]=Math.sqrt(this[4]*this[4]+this[5]*this[5]+this[6]*this[6]),e[2]=Math.sqrt(this[8]*this[8]+this[9]*this[9]+this[10]*this[10]),e}getTranslation(e=[-0,-0,-0]){return e[0]=this[12],e[1]=this[13],e[2]=this[14],e}getRotation(e,t){e=e||[-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0],t=t||[-0,-0,-0];const i=this.getScale(t),n=1/i[0],a=1/i[1],s=1/i[2];return e[0]=this[0]*n,e[1]=this[1]*a,e[2]=this[2]*s,e[3]=0,e[4]=this[4]*n,e[5]=this[5]*a,e[6]=this[6]*s,e[7]=0,e[8]=this[8]*n,e[9]=this[9]*a,e[10]=this[10]*s,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}getRotationMatrix3(e,t){e=e||[-0,-0,-0,-0,-0,-0,-0,-0,-0],t=t||[-0,-0,-0];const i=this.getScale(t),n=1/i[0],a=1/i[1],s=1/i[2];return e[0]=this[0]*n,e[1]=this[1]*a,e[2]=this[2]*s,e[3]=this[4]*n,e[4]=this[5]*a,e[5]=this[6]*s,e[6]=this[8]*n,e[7]=this[9]*a,e[8]=this[10]*s,e}transpose(){return qJ(this,this),this.check()}invert(){return iR(this,this),this.check()}multiplyLeft(e){return Km(this,e,this),this.check()}multiplyRight(e){return Km(this,this,e),this.check()}rotateX(e){return TH(this,this,e),this.check()}rotateY(e){return QJ(this,this,e),this.check()}rotateZ(e){return AH(this,this,e),this.check()}rotateXYZ(e){return this.rotateX(e[0]).rotateY(e[1]).rotateZ(e[2])}rotateAxis(e,t){return KJ(this,this,e,t),this.check()}scale(e){return jD(this,this,Array.isArray(e)?e:[e,e,e]),this.check()}translate(e){return lA(this,this,e),this.check()}transform(e,t){return e.length===4?(t=tb(t||[-0,-0,-0,-0],e,this),qM(t,4),t):this.transformAsPoint(e,t)}transformAsPoint(e,t){const{length:i}=e;let n;switch(i){case 2:n=IJ(t||[-0,-0],e,this);break;case 3:n=wH(t||[-0,-0,-0],e,this);break;default:throw new Error("Illegal vector")}return qM(n,e.length),n}transformAsVector(e,t){let i;switch(e.length){case 2:i=PJ(t||[-0,-0],e,this);break;case 3:i=xH(t||[-0,-0,-0],e,this);break;default:throw new Error("Illegal vector")}return qM(i,e.length),i}transformPoint(e,t){return this.transformAsPoint(e,t)}transformVector(e,t){return this.transformAsPoint(e,t)}transformDirection(e,t){return this.transformAsVector(e,t)}makeRotationX(e){return this.identity().rotateX(e)}makeTranslation(e,t,i){return this.identity().translate([e,t,i])}}let oT,sT;function cee(){return oT||(oT=new Eh([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]),Object.freeze(oT)),oT}function hee(){return sT||(sT=new Eh,Object.freeze(sT)),sT}function ON(r){if(r>Math.PI*2)throw Error("expected radians")}function fee(r,e,t,i,n,a){const s=2*a/(t-e),o=2*a/(n-i),l=(t+e)/(t-e),c=(n+i)/(n-i),f=-1,p=-1,y=-2*a;return r[0]=s,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=o,r[6]=0,r[7]=0,r[8]=l,r[9]=c,r[10]=f,r[11]=p,r[12]=0,r[13]=0,r[14]=y,r[15]=0,r}function MH(r,e=[],t=0){const i=Math.fround(r),n=r-i;return e[t]=i,e[t+1]=n,e}function dee(r){return r-Math.fround(r)}function pee(r){const e=new Float32Array(32);for(let t=0;t<4;++t)for(let i=0;i<4;++i){const n=t*4+i;MH(r[i*4+t],e,n*2)}return e}const gee=`#ifdef LUMA_FP32_TAN_PRECISION_WORKAROUND

// All these functions are for substituting tan() function from Intel GPU only
const float TWO_PI = 6.2831854820251465;
const float PI_2 = 1.5707963705062866;
const float PI_16 = 0.1963495463132858;

const float SIN_TABLE_0 = 0.19509032368659973;
const float SIN_TABLE_1 = 0.3826834261417389;
const float SIN_TABLE_2 = 0.5555702447891235;
const float SIN_TABLE_3 = 0.7071067690849304;

const float COS_TABLE_0 = 0.9807852506637573;
const float COS_TABLE_1 = 0.9238795042037964;
const float COS_TABLE_2 = 0.8314695954322815;
const float COS_TABLE_3 = 0.7071067690849304;

const float INVERSE_FACTORIAL_3 = 1.666666716337204e-01; // 1/3!
const float INVERSE_FACTORIAL_5 = 8.333333767950535e-03; // 1/5!
const float INVERSE_FACTORIAL_7 = 1.9841270113829523e-04; // 1/7!
const float INVERSE_FACTORIAL_9 = 2.75573188446287533e-06; // 1/9!

float sin_taylor_fp32(float a) {
  float r, s, t, x;

  if (a == 0.0) {
    return 0.0;
  }

  x = -a * a;
  s = a;
  r = a;

  r = r * x;
  t = r * INVERSE_FACTORIAL_3;
  s = s + t;

  r = r * x;
  t = r * INVERSE_FACTORIAL_5;
  s = s + t;

  r = r * x;
  t = r * INVERSE_FACTORIAL_7;
  s = s + t;

  r = r * x;
  t = r * INVERSE_FACTORIAL_9;
  s = s + t;

  return s;
}

void sincos_taylor_fp32(float a, out float sin_t, out float cos_t) {
  if (a == 0.0) {
    sin_t = 0.0;
    cos_t = 1.0;
  }
  sin_t = sin_taylor_fp32(a);
  cos_t = sqrt(1.0 - sin_t * sin_t);
}

float tan_taylor_fp32(float a) {
    float sin_a;
    float cos_a;

    if (a == 0.0) {
        return 0.0;
    }

    // 2pi range reduction
    float z = floor(a / TWO_PI);
    float r = a - TWO_PI * z;

    float t;
    float q = floor(r / PI_2 + 0.5);
    int j = int(q);

    if (j < -2 || j > 2) {
        return 1.0 / 0.0;
    }

    t = r - PI_2 * q;

    q = floor(t / PI_16 + 0.5);
    int k = int(q);
    int abs_k = int(abs(float(k)));

    if (abs_k > 4) {
        return 1.0 / 0.0;
    } else {
        t = t - PI_16 * q;
    }

    float u = 0.0;
    float v = 0.0;

    float sin_t, cos_t;
    float s, c;
    sincos_taylor_fp32(t, sin_t, cos_t);

    if (k == 0) {
        s = sin_t;
        c = cos_t;
    } else {
        if (abs(float(abs_k) - 1.0) < 0.5) {
            u = COS_TABLE_0;
            v = SIN_TABLE_0;
        } else if (abs(float(abs_k) - 2.0) < 0.5) {
            u = COS_TABLE_1;
            v = SIN_TABLE_1;
        } else if (abs(float(abs_k) - 3.0) < 0.5) {
            u = COS_TABLE_2;
            v = SIN_TABLE_2;
        } else if (abs(float(abs_k) - 4.0) < 0.5) {
            u = COS_TABLE_3;
            v = SIN_TABLE_3;
        }
        if (k > 0) {
            s = u * sin_t + v * cos_t;
            c = u * cos_t - v * sin_t;
        } else {
            s = u * sin_t - v * cos_t;
            c = u * cos_t + v * sin_t;
        }
    }

    if (j == 0) {
        sin_a = s;
        cos_a = c;
    } else if (j == 1) {
        sin_a = c;
        cos_a = -s;
    } else if (j == -1) {
        sin_a = -c;
        cos_a = s;
    } else {
        sin_a = -s;
        cos_a = -c;
    }
    return sin_a / cos_a;
}
#endif

float tan_fp32(float a) {
#ifdef LUMA_FP32_TAN_PRECISION_WORKAROUND
  return tan_taylor_fp32(a);
#else
  return tan(a);
#endif
}
`,vee={name:"fp32",vs:gee},mee=`
uniform fp64arithmeticUniforms {
  uniform float ONE;
} fp64;

/*
About LUMA_FP64_CODE_ELIMINATION_WORKAROUND

The purpose of this workaround is to prevent shader compilers from
optimizing away necessary arithmetic operations by swapping their sequences
or transform the equation to some 'equivalent' form.

The method is to multiply an artifical variable, ONE, which will be known to
the compiler to be 1 only at runtime. The whole expression is then represented
as a polynomial with respective to ONE. In the coefficients of all terms, only one a
and one b should appear

err = (a + b) * ONE^6 - a * ONE^5 - (a + b) * ONE^4 + a * ONE^3 - b - (a + b) * ONE^2 + a * ONE
*/

// Divide float number to high and low floats to extend fraction bits
vec2 split(float a) {
  const float SPLIT = 4097.0;
  float t = a * SPLIT;
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  float a_hi = t * fp64.ONE - (t - a);
  float a_lo = a * fp64.ONE - a_hi;
#else
  float a_hi = t - (t - a);
  float a_lo = a - a_hi;
#endif
  return vec2(a_hi, a_lo);
}

// Divide float number again when high float uses too many fraction bits
vec2 split2(vec2 a) {
  vec2 b = split(a.x);
  b.y += a.y;
  return b;
}

// Special sum operation when a > b
vec2 quickTwoSum(float a, float b) {
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  float sum = (a + b) * fp64.ONE;
  float err = b - (sum - a) * fp64.ONE;
#else
  float sum = a + b;
  float err = b - (sum - a);
#endif
  return vec2(sum, err);
}

// General sum operation
vec2 twoSum(float a, float b) {
  float s = (a + b);
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  float v = (s * fp64.ONE - a) * fp64.ONE;
  float err = (a - (s - v) * fp64.ONE) * fp64.ONE * fp64.ONE * fp64.ONE + (b - v);
#else
  float v = s - a;
  float err = (a - (s - v)) + (b - v);
#endif
  return vec2(s, err);
}

vec2 twoSub(float a, float b) {
  float s = (a - b);
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  float v = (s * fp64.ONE - a) * fp64.ONE;
  float err = (a - (s - v) * fp64.ONE) * fp64.ONE * fp64.ONE * fp64.ONE - (b + v);
#else
  float v = s - a;
  float err = (a - (s - v)) - (b + v);
#endif
  return vec2(s, err);
}

vec2 twoSqr(float a) {
  float prod = a * a;
  vec2 a_fp64 = split(a);
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  float err = ((a_fp64.x * a_fp64.x - prod) * fp64.ONE + 2.0 * a_fp64.x *
    a_fp64.y * fp64.ONE * fp64.ONE) + a_fp64.y * a_fp64.y * fp64.ONE * fp64.ONE * fp64.ONE;
#else
  float err = ((a_fp64.x * a_fp64.x - prod) + 2.0 * a_fp64.x * a_fp64.y) + a_fp64.y * a_fp64.y;
#endif
  return vec2(prod, err);
}

vec2 twoProd(float a, float b) {
  float prod = a * b;
  vec2 a_fp64 = split(a);
  vec2 b_fp64 = split(b);
  float err = ((a_fp64.x * b_fp64.x - prod) + a_fp64.x * b_fp64.y +
    a_fp64.y * b_fp64.x) + a_fp64.y * b_fp64.y;
  return vec2(prod, err);
}

vec2 sum_fp64(vec2 a, vec2 b) {
  vec2 s, t;
  s = twoSum(a.x, b.x);
  t = twoSum(a.y, b.y);
  s.y += t.x;
  s = quickTwoSum(s.x, s.y);
  s.y += t.y;
  s = quickTwoSum(s.x, s.y);
  return s;
}

vec2 sub_fp64(vec2 a, vec2 b) {
  vec2 s, t;
  s = twoSub(a.x, b.x);
  t = twoSub(a.y, b.y);
  s.y += t.x;
  s = quickTwoSum(s.x, s.y);
  s.y += t.y;
  s = quickTwoSum(s.x, s.y);
  return s;
}

vec2 mul_fp64(vec2 a, vec2 b) {
  vec2 prod = twoProd(a.x, b.x);
  // y component is for the error
  prod.y += a.x * b.y;
#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)
  prod = split2(prod);
#endif
  prod = quickTwoSum(prod.x, prod.y);
  prod.y += a.y * b.x;
#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)
  prod = split2(prod);
#endif
  prod = quickTwoSum(prod.x, prod.y);
  return prod;
}

vec2 div_fp64(vec2 a, vec2 b) {
  float xn = 1.0 / b.x;
#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)
  vec2 yn = mul_fp64(a, vec2(xn, 0));
#else
  vec2 yn = a * xn;
#endif
  float diff = (sub_fp64(a, mul_fp64(b, yn))).x;
  vec2 prod = twoProd(xn, diff);
  return sum_fp64(yn, prod);
}

vec2 sqrt_fp64(vec2 a) {
  if (a.x == 0.0 && a.y == 0.0) return vec2(0.0, 0.0);
  if (a.x < 0.0) return vec2(0.0 / 0.0, 0.0 / 0.0);

  float x = 1.0 / sqrt(a.x);
  float yn = a.x * x;
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  vec2 yn_sqr = twoSqr(yn) * fp64.ONE;
#else
  vec2 yn_sqr = twoSqr(yn);
#endif
  float diff = sub_fp64(a, yn_sqr).x;
  vec2 prod = twoProd(x * 0.5, diff);
#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)
  return sum_fp64(split(yn), prod);
#else
  return sum_fp64(vec2(yn, 0.0), prod);
#endif
}
`,yee={ONE:1},_ee={name:"fp64arithmetic",vs:mee,defaultUniforms:yee,uniformTypes:{ONE:"f32"},fp64ify:MH,fp64LowPart:dee,fp64ifyMatrix4:pee},bee=[0,1,1,1],xee=`uniform pickingUniforms {
  float isActive;
  float isAttribute;
  float isHighlightActive;
  float useFloatColors;
  vec3 highlightedObjectColor;
  vec4 highlightColor;
} picking;

out vec4 picking_vRGBcolor_Avalid;

// Normalize unsigned byte color to 0-1 range
vec3 picking_normalizeColor(vec3 color) {
  return picking.useFloatColors > 0.5 ? color : color / 255.0;
}

// Normalize unsigned byte color to 0-1 range
vec4 picking_normalizeColor(vec4 color) {
  return picking.useFloatColors > 0.5 ? color : color / 255.0;
}

bool picking_isColorZero(vec3 color) {
  return dot(color, vec3(1.0)) < 0.00001;
}

bool picking_isColorValid(vec3 color) {
  return dot(color, vec3(1.0)) > 0.00001;
}

// Check if this vertex is highlighted 
bool isVertexHighlighted(vec3 vertexColor) {
  vec3 highlightedObjectColor = picking_normalizeColor(picking.highlightedObjectColor);
  return
    bool(picking.isHighlightActive) && picking_isColorZero(abs(vertexColor - highlightedObjectColor));
}

// Set the current picking color
void picking_setPickingColor(vec3 pickingColor) {
  pickingColor = picking_normalizeColor(pickingColor);

  if (bool(picking.isActive)) {
    // Use alpha as the validity flag. If pickingColor is [0, 0, 0] fragment is non-pickable
    picking_vRGBcolor_Avalid.a = float(picking_isColorValid(pickingColor));

    if (!bool(picking.isAttribute)) {
      // Stores the picking color so that the fragment shader can render it during picking
      picking_vRGBcolor_Avalid.rgb = pickingColor;
    }
  } else {
    // Do the comparison with selected item color in vertex shader as it should mean fewer compares
    picking_vRGBcolor_Avalid.a = float(isVertexHighlighted(pickingColor));
  }
}

void picking_setPickingAttribute(float value) {
  if (bool(picking.isAttribute)) {
    picking_vRGBcolor_Avalid.r = value;
  }
}

void picking_setPickingAttribute(vec2 value) {
  if (bool(picking.isAttribute)) {
    picking_vRGBcolor_Avalid.rg = value;
  }
}

void picking_setPickingAttribute(vec3 value) {
  if (bool(picking.isAttribute)) {
    picking_vRGBcolor_Avalid.rgb = value;
  }
}
`,wee=`uniform pickingUniforms {
  float isActive;
  float isAttribute;
  float isHighlightActive;
  float useFloatColors;
  vec3 highlightedObjectColor;
  vec4 highlightColor;
} picking;

in vec4 picking_vRGBcolor_Avalid;

/*
 * Returns highlight color if this item is selected.
 */
vec4 picking_filterHighlightColor(vec4 color) {
  // If we are still picking, we don't highlight
  if (picking.isActive > 0.5) {
    return color;
  }

  bool selected = bool(picking_vRGBcolor_Avalid.a);

  if (selected) {
    // Blend in highlight color based on its alpha value
    float highLightAlpha = picking.highlightColor.a;
    float blendedAlpha = highLightAlpha + color.a * (1.0 - highLightAlpha);
    float highLightRatio = highLightAlpha / blendedAlpha;

    vec3 blendedRGB = mix(color.rgb, picking.highlightColor.rgb, highLightRatio);
    return vec4(blendedRGB, blendedAlpha);
  } else {
    return color;
  }
}

/*
 * Returns picking color if picking enabled else unmodified argument.
 */
vec4 picking_filterPickingColor(vec4 color) {
  if (bool(picking.isActive)) {
    if (picking_vRGBcolor_Avalid.a == 0.0) {
      discard;
    }
    return picking_vRGBcolor_Avalid;
  }
  return color;
}

/*
 * Returns picking color if picking is enabled if not
 * highlight color if this item is selected, otherwise unmodified argument.
 */
vec4 picking_filterColor(vec4 color) {
  vec4 highlightColor = picking_filterHighlightColor(color);
  return picking_filterPickingColor(highlightColor);
}
`,NN={props:{},uniforms:{},name:"picking",uniformTypes:{isActive:"f32",isAttribute:"f32",isHighlightActive:"f32",useFloatColors:"f32",highlightedObjectColor:"vec3<f32>",highlightColor:"vec4<f32>"},defaultUniforms:{isActive:!1,isAttribute:!1,isHighlightActive:!1,useFloatColors:!0,highlightedObjectColor:[0,0,0],highlightColor:bee},vs:xee,fs:wee,getUniforms:See};function See(r={},e){const t={};if(r.highlightedObjectColor!==void 0)if(r.highlightedObjectColor===null)t.isHighlightActive=!1;else{t.isHighlightActive=!0;const i=r.highlightedObjectColor.slice(0,3);t.highlightedObjectColor=i}if(r.highlightColor){const i=Array.from(r.highlightColor,n=>n/255);Number.isFinite(i[3])||(i[3]=1),t.highlightColor=i}return r.isActive!==void 0&&(t.isActive=!!r.isActive,t.isAttribute=!!r.isAttribute),r.useFloatColors!==void 0&&(t.useFloatColors=!!r.useFloatColors),t}const BN=`uniform layerUniforms {
  uniform float opacity;
} layer;
`,Tee={name:"layer",vs:BN,fs:BN,getUniforms:r=>({opacity:Math.pow(r.opacity,1/2.2)}),uniformTypes:{opacity:"f32"}},Aee=`

struct ColorUniforms {
  opacity: f32,
};

var<private> color: ColorUniforms = ColorUniforms(1.0);
// TODO (kaapp) avoiding binding index collisions to handle layer opacity 
// requires some thought.
// @group(0) @binding(0) var<uniform> color: ColorUniforms;

@must_use
fn deckgl_premultiplied_alpha(fragColor: vec4<f32>) -> vec4<f32> {
    return vec4(fragColor.rgb * fragColor.a, fragColor.a); 
};
`,Cee={name:"color",dependencies:[],source:Aee,getUniforms:r=>({}),uniformTypes:{opacity:"f32"}},Mee=`const SMOOTH_EDGE_RADIUS: f32 = 0.5;

struct VertexGeometry {
  position: vec4<f32>,
  worldPosition: vec3<f32>,
  worldPositionAlt: vec3<f32>,
  normal: vec3<f32>,
  uv: vec2<f32>,
  pickingColor: vec3<f32>,
};

var<private> geometry_: VertexGeometry = VertexGeometry(
  vec4<f32>(0.0, 0.0, 1.0, 0.0),
  vec3<f32>(0.0, 0.0, 0.0),
  vec3<f32>(0.0, 0.0, 0.0),
  vec3<f32>(0.0, 0.0, 0.0),
  vec2<f32>(0.0, 0.0),
  vec3<f32>(0.0, 0.0, 0.0)
);

struct FragmentGeometry {
  uv: vec2<f32>,
};

var<private> fragmentGeometry: FragmentGeometry;

fn smoothedge(edge: f32, x: f32) -> f32 {
  return smoothstep(edge - SMOOTH_EDGE_RADIUS, edge + SMOOTH_EDGE_RADIUS, x);
}
`,EH="#define SMOOTH_EDGE_RADIUS 0.5",Eee=`${EH}

struct VertexGeometry {
  vec4 position;
  vec3 worldPosition;
  vec3 worldPositionAlt;
  vec3 normal;
  vec2 uv;
  vec3 pickingColor;
} geometry = VertexGeometry(
  vec4(0.0, 0.0, 1.0, 0.0),
  vec3(0.0),
  vec3(0.0),
  vec3(0.0),
  vec2(0.0),
  vec3(0.0)
);
`,Iee=`${EH}

struct FragmentGeometry {
  vec2 uv;
} geometry;

float smoothedge(float edge, float x) {
  return smoothstep(edge - SMOOTH_EDGE_RADIUS, edge + SMOOTH_EDGE_RADIUS, x);
}
`,IH={name:"geometry",source:Mee,vs:Eee,fs:Iee},Pee=25;var Xa;(function(r){r[r.Start=1]="Start",r[r.Move=2]="Move",r[r.End=4]="End",r[r.Cancel=8]="Cancel"})(Xa||(Xa={}));var ao;(function(r){r[r.None=0]="None",r[r.Left=1]="Left",r[r.Right=2]="Right",r[r.Up=4]="Up",r[r.Down=8]="Down",r[r.Horizontal=3]="Horizontal",r[r.Vertical=12]="Vertical",r[r.All=15]="All"})(ao||(ao={}));var oi;(function(r){r[r.Possible=1]="Possible",r[r.Began=2]="Began",r[r.Changed=4]="Changed",r[r.Ended=8]="Ended",r[r.Recognized=8]="Recognized",r[r.Cancelled=16]="Cancelled",r[r.Failed=32]="Failed"})(oi||(oi={}));const Ree="compute",Dee="auto",aR="manipulation",T2="none",oR="pan-x",sR="pan-y";function kee(r){if(r.includes(T2))return T2;const e=r.includes(oR),t=r.includes(sR);return e&&t?T2:e||t?e?oR:sR:r.includes(aR)?aR:Dee}class Lee{constructor(e,t){this.actions="",this.manager=e,this.set(t)}set(e){e===Ree&&(e=this.compute()),this.manager.element&&(this.manager.element.style.touchAction=e,this.actions=e)}update(){this.set(this.manager.options.touchAction)}compute(){let e=[];for(const t of this.manager.recognizers)t.options.enable&&(e=e.concat(t.getTouchAction()));return kee(e.join(" "))}}function uA(r){return r.trim().split(/\s+/g)}function eE(r,e,t){if(r)for(const i of uA(e))r.addEventListener(i,t,!1)}function tE(r,e,t){if(r)for(const i of uA(e))r.removeEventListener(i,t,!1)}function zN(r){return(r.ownerDocument||r).defaultView}function Oee(r,e){let t=r;for(;t;){if(t===e)return!0;t=t.parentNode}return!1}function PH(r){const e=r.length;if(e===1)return{x:Math.round(r[0].clientX),y:Math.round(r[0].clientY)};let t=0,i=0,n=0;for(;n<e;)t+=r[n].clientX,i+=r[n].clientY,n++;return{x:Math.round(t/e),y:Math.round(i/e)}}function FN(r){const e=[];let t=0;for(;t<r.pointers.length;)e[t]={clientX:Math.round(r.pointers[t].clientX),clientY:Math.round(r.pointers[t].clientY)},t++;return{timeStamp:Date.now(),pointers:e,center:PH(e),deltaX:r.deltaX,deltaY:r.deltaY}}function RH(r,e){const t=e.x-r.x,i=e.y-r.y;return Math.sqrt(t*t+i*i)}function VN(r,e){const t=e.clientX-r.clientX,i=e.clientY-r.clientY;return Math.sqrt(t*t+i*i)}function Nee(r,e){const t=e.x-r.x,i=e.y-r.y;return Math.atan2(i,t)*180/Math.PI}function UN(r,e){const t=e.clientX-r.clientX,i=e.clientY-r.clientY;return Math.atan2(i,t)*180/Math.PI}function DH(r,e){return r===e?ao.None:Math.abs(r)>=Math.abs(e)?r<0?ao.Left:ao.Right:e<0?ao.Up:ao.Down}function Bee(r,e){const t=e.center;let i=r.offsetDelta,n=r.prevDelta;const a=r.prevInput;return(e.eventType===Xa.Start||a?.eventType===Xa.End)&&(n=r.prevDelta={x:a?.deltaX||0,y:a?.deltaY||0},i=r.offsetDelta={x:t.x,y:t.y}),{deltaX:n.x+(t.x-i.x),deltaY:n.y+(t.y-i.y)}}function kH(r,e,t){return{x:e/r||0,y:t/r||0}}function zee(r,e){return VN(e[0],e[1])/VN(r[0],r[1])}function Fee(r,e){return UN(e[1],e[0])-UN(r[1],r[0])}function Vee(r,e){const t=r.lastInterval||e,i=e.timeStamp-t.timeStamp;let n,a,s,o;if(e.eventType!==Xa.Cancel&&(i>Pee||t.velocity===void 0)){const l=e.deltaX-t.deltaX,c=e.deltaY-t.deltaY,f=kH(i,l,c);a=f.x,s=f.y,n=Math.abs(f.x)>Math.abs(f.y)?f.x:f.y,o=DH(l,c),r.lastInterval=e}else n=t.velocity,a=t.velocityX,s=t.velocityY,o=t.direction;e.velocity=n,e.velocityX=a,e.velocityY=s,e.direction=o}function Uee(r,e){const{session:t}=r,{pointers:i}=e,{length:n}=i;t.firstInput||(t.firstInput=FN(e)),n>1&&!t.firstMultiple?t.firstMultiple=FN(e):n===1&&(t.firstMultiple=!1);const{firstInput:a,firstMultiple:s}=t,o=s?s.center:a.center,l=e.center=PH(i);e.timeStamp=Date.now(),e.deltaTime=e.timeStamp-a.timeStamp,e.angle=Nee(o,l),e.distance=RH(o,l);const{deltaX:c,deltaY:f}=Bee(t,e);e.deltaX=c,e.deltaY=f,e.offsetDirection=DH(e.deltaX,e.deltaY);const p=kH(e.deltaTime,e.deltaX,e.deltaY);e.overallVelocityX=p.x,e.overallVelocityY=p.y,e.overallVelocity=Math.abs(p.x)>Math.abs(p.y)?p.x:p.y,e.scale=s?zee(s.pointers,i):1,e.rotation=s?Fee(s.pointers,i):0,e.maxPointers=t.prevInput?e.pointers.length>t.prevInput.maxPointers?e.pointers.length:t.prevInput.maxPointers:e.pointers.length;let y=r.element;return Oee(e.srcEvent.target,y)&&(y=e.srcEvent.target),e.target=y,Vee(t,e),e}function Hee(r,e,t){const i=t.pointers.length,n=t.changedPointers.length,a=e&Xa.Start&&i-n===0,s=e&(Xa.End|Xa.Cancel)&&i-n===0;t.isFirst=!!a,t.isFinal=!!s,a&&(r.session={}),t.eventType=e;const o=Uee(r,t);r.emit("hammer.input",o),r.recognize(o),r.session.prevInput=o}let jee=class{constructor(e){this.evEl="",this.evWin="",this.evTarget="",this.domHandler=t=>{this.manager.options.enable&&this.handler(t)},this.manager=e,this.element=e.element,this.target=e.options.inputTarget||e.element}callback(e,t){Hee(this.manager,e,t)}init(){eE(this.element,this.evEl,this.domHandler),eE(this.target,this.evTarget,this.domHandler),eE(zN(this.element),this.evWin,this.domHandler)}destroy(){tE(this.element,this.evEl,this.domHandler),tE(this.target,this.evTarget,this.domHandler),tE(zN(this.element),this.evWin,this.domHandler)}};const $ee={pointerdown:Xa.Start,pointermove:Xa.Move,pointerup:Xa.End,pointercancel:Xa.Cancel,pointerout:Xa.Cancel},Wee="pointerdown",Gee="pointermove pointerup pointercancel";class Xee extends jee{constructor(e){super(e),this.evEl=Wee,this.evWin=Gee,this.store=this.manager.session.pointerEvents=[],this.init()}handler(e){const{store:t}=this;let i=!1;const n=$ee[e.type],a=e.pointerType,s=a==="touch";let o=t.findIndex(l=>l.pointerId===e.pointerId);n&Xa.Start&&(e.buttons||s)?o<0&&(t.push(e),o=t.length-1):n&(Xa.End|Xa.Cancel)&&(i=!0),!(o<0)&&(t[o]=e,this.callback(n,{pointers:t,changedPointers:[e],eventType:n,pointerType:a,srcEvent:e}),i&&t.splice(o,1))}}const Zee=["","webkit","Moz","MS","ms","o"];function qee(r,e){const t=e[0].toUpperCase()+e.slice(1);for(const i of Zee){const n=i?i+t:e;if(n in r)return n}}const Yee=1,HN=2,jN={touchAction:"compute",enable:!0,inputTarget:null,cssProps:{userSelect:"none",userDrag:"none",touchCallout:"none",tapHighlightColor:"rgba(0,0,0,0)"}};class Kee{constructor(e,t){this.options={...jN,...t,cssProps:{...jN.cssProps,...t.cssProps},inputTarget:t.inputTarget||e},this.handlers={},this.session={},this.recognizers=[],this.oldCssProps={},this.element=e,this.input=new Xee(this),this.touchAction=new Lee(this,this.options.touchAction),this.toggleCssProps(!0)}set(e){return Object.assign(this.options,e),e.touchAction&&this.touchAction.update(),e.inputTarget&&(this.input.destroy(),this.input.target=e.inputTarget,this.input.init()),this}stop(e){this.session.stopped=e?HN:Yee}recognize(e){const{session:t}=this;if(t.stopped)return;this.session.prevented&&e.srcEvent.preventDefault();let i;const{recognizers:n}=this;let{curRecognizer:a}=t;(!a||a&&a.state&oi.Recognized)&&(a=t.curRecognizer=null);let s=0;for(;s<n.length;)i=n[s],t.stopped!==HN&&(!a||i===a||i.canRecognizeWith(a))?i.recognize(e):i.reset(),!a&&i.state&(oi.Began|oi.Changed|oi.Ended)&&(a=t.curRecognizer=i),s++}get(e){const{recognizers:t}=this;for(let i=0;i<t.length;i++)if(t[i].options.event===e)return t[i];return null}add(e){if(Array.isArray(e)){for(const i of e)this.add(i);return this}const t=this.get(e.options.event);return t&&this.remove(t),this.recognizers.push(e),e.manager=this,this.touchAction.update(),e}remove(e){if(Array.isArray(e)){for(const i of e)this.remove(i);return this}const t=typeof e=="string"?this.get(e):e;if(t){const{recognizers:i}=this,n=i.indexOf(t);n!==-1&&(i.splice(n,1),this.touchAction.update())}return this}on(e,t){if(!e||!t)return;const{handlers:i}=this;for(const n of uA(e))i[n]=i[n]||[],i[n].push(t)}off(e,t){if(!e)return;const{handlers:i}=this;for(const n of uA(e))t?i[n]&&i[n].splice(i[n].indexOf(t),1):delete i[n]}emit(e,t){const i=this.handlers[e]&&this.handlers[e].slice();if(!i||!i.length)return;const n=t;n.type=e,n.preventDefault=function(){t.srcEvent.preventDefault()};let a=0;for(;a<i.length;)i[a](n),a++}destroy(){this.toggleCssProps(!1),this.handlers={},this.session={},this.input.destroy(),this.element=null}toggleCssProps(e){const{element:t}=this;if(t){for(const[i,n]of Object.entries(this.options.cssProps)){const a=qee(t.style,i);e?(this.oldCssProps[a]=t.style[a],t.style[a]=n):t.style[a]=this.oldCssProps[a]||""}e||(this.oldCssProps={})}}}let Qee=1;function Jee(){return Qee++}function $N(r){return r&oi.Cancelled?"cancel":r&oi.Ended?"end":r&oi.Changed?"move":r&oi.Began?"start":""}class LH{constructor(e){this.options=e,this.id=Jee(),this.state=oi.Possible,this.simultaneous={},this.requireFail=[]}set(e){return Object.assign(this.options,e),this.manager.touchAction.update(),this}recognizeWith(e){if(Array.isArray(e)){for(const n of e)this.recognizeWith(n);return this}let t;if(typeof e=="string"){if(t=this.manager.get(e),!t)throw new Error(`Cannot find recognizer ${e}`)}else t=e;const{simultaneous:i}=this;return i[t.id]||(i[t.id]=t,t.recognizeWith(this)),this}dropRecognizeWith(e){if(Array.isArray(e)){for(const i of e)this.dropRecognizeWith(i);return this}let t;return typeof e=="string"?t=this.manager.get(e):t=e,t&&delete this.simultaneous[t.id],this}requireFailure(e){if(Array.isArray(e)){for(const n of e)this.requireFailure(n);return this}let t;if(typeof e=="string"){if(t=this.manager.get(e),!t)throw new Error(`Cannot find recognizer ${e}`)}else t=e;const{requireFail:i}=this;return i.indexOf(t)===-1&&(i.push(t),t.requireFailure(this)),this}dropRequireFailure(e){if(Array.isArray(e)){for(const i of e)this.dropRequireFailure(i);return this}let t;if(typeof e=="string"?t=this.manager.get(e):t=e,t){const i=this.requireFail.indexOf(t);i>-1&&this.requireFail.splice(i,1)}return this}hasRequireFailures(){return!!this.requireFail.find(e=>e.options.enable)}canRecognizeWith(e){return!!this.simultaneous[e.id]}emit(e){if(!e)return;const{state:t}=this;t<oi.Ended&&this.manager.emit(this.options.event+$N(t),e),this.manager.emit(this.options.event,e),e.additionalEvent&&this.manager.emit(e.additionalEvent,e),t>=oi.Ended&&this.manager.emit(this.options.event+$N(t),e)}tryEmit(e){this.canEmit()?this.emit(e):this.state=oi.Failed}canEmit(){let e=0;for(;e<this.requireFail.length;){if(!(this.requireFail[e].state&(oi.Failed|oi.Possible)))return!1;e++}return!0}recognize(e){const t={...e};if(!this.options.enable){this.reset(),this.state=oi.Failed;return}this.state&(oi.Recognized|oi.Cancelled|oi.Failed)&&(this.state=oi.Possible),this.state=this.process(t),this.state&(oi.Began|oi.Changed|oi.Ended|oi.Cancelled)&&this.tryEmit(t)}getEventNames(){return[this.options.event]}reset(){}}class OH extends LH{attrTest(e){const t=this.options.pointers;return t===0||e.pointers.length===t}process(e){const{state:t}=this,{eventType:i}=e,n=t&(oi.Began|oi.Changed),a=this.attrTest(e);return n&&(i&Xa.Cancel||!a)?t|oi.Cancelled:n||a?i&Xa.End?t|oi.Ended:t&oi.Began?t|oi.Changed:oi.Began:oi.Failed}}class WN extends LH{constructor(e={}){super({enable:!0,event:"tap",pointers:1,taps:1,interval:300,time:250,threshold:9,posThreshold:10,...e}),this.pTime=null,this.pCenter=null,this._timer=null,this._input=null,this.count=0}getTouchAction(){return[aR]}process(e){const{options:t}=this,i=e.pointers.length===t.pointers,n=e.distance<t.threshold,a=e.deltaTime<t.time;if(this.reset(),e.eventType&Xa.Start&&this.count===0)return this.failTimeout();if(n&&a&&i){if(e.eventType!==Xa.End)return this.failTimeout();const s=this.pTime?e.timeStamp-this.pTime<t.interval:!0,o=!this.pCenter||RH(this.pCenter,e.center)<t.posThreshold;if(this.pTime=e.timeStamp,this.pCenter=e.center,!o||!s?this.count=1:this.count+=1,this._input=e,this.count%t.taps===0)return this.hasRequireFailures()?(this._timer=setTimeout(()=>{this.state=oi.Recognized,this.tryEmit(this._input)},t.interval),oi.Began):oi.Recognized}return oi.Failed}failTimeout(){return this._timer=setTimeout(()=>{this.state=oi.Failed},this.options.interval),oi.Failed}reset(){clearTimeout(this._timer)}emit(e){this.state===oi.Recognized&&(e.tapCount=this.count,this.manager.emit(this.options.event,e))}}const ete=["","start","move","end","cancel","up","down","left","right"];class GN extends OH{constructor(e={}){super({enable:!0,pointers:1,event:"pan",threshold:10,direction:ao.All,...e}),this.pX=null,this.pY=null}getTouchAction(){const{options:{direction:e}}=this,t=[];return e&ao.Horizontal&&t.push(sR),e&ao.Vertical&&t.push(oR),t}getEventNames(){return ete.map(e=>this.options.event+e)}directionTest(e){const{options:t}=this;let i=!0,{distance:n}=e,{direction:a}=e;const s=e.deltaX,o=e.deltaY;return a&t.direction||(t.direction&ao.Horizontal?(a=s===0?ao.None:s<0?ao.Left:ao.Right,i=s!==this.pX,n=Math.abs(e.deltaX)):(a=o===0?ao.None:o<0?ao.Up:ao.Down,i=o!==this.pY,n=Math.abs(e.deltaY))),e.direction=a,i&&n>t.threshold&&!!(a&t.direction)}attrTest(e){return super.attrTest(e)&&(!!(this.state&oi.Began)||!(this.state&oi.Began)&&this.directionTest(e))}emit(e){this.pX=e.deltaX,this.pY=e.deltaY;const t=ao[e.direction].toLowerCase();t&&(e.additionalEvent=this.options.event+t),super.emit(e)}}const tte=["","start","move","end","cancel","in","out"];class rte extends OH{constructor(e={}){super({enable:!0,event:"pinch",threshold:0,pointers:2,...e})}getTouchAction(){return[T2]}getEventNames(){return tte.map(e=>this.options.event+e)}attrTest(e){return super.attrTest(e)&&(Math.abs(e.scale-1)>this.options.threshold||!!(this.state&oi.Began))}emit(e){if(e.scale!==1){const t=e.scale<1?"in":"out";e.additionalEvent=this.options.event+t}super.emit(e)}}class yC{constructor(e,t,i){this.element=e,this.callback=t,this.options=i}}const ite=typeof navigator<"u"&&navigator.userAgent?navigator.userAgent.toLowerCase():"",nte=ite.indexOf("firefox")!==-1,XN=4.000244140625,ate=40,ote=.25;class ste extends yC{constructor(e,t,i){super(e,t,{enable:!0,...i}),this.handleEvent=n=>{if(!this.options.enable)return;let a=n.deltaY;globalThis.WheelEvent&&(nte&&n.deltaMode===globalThis.WheelEvent.DOM_DELTA_PIXEL&&(a/=globalThis.devicePixelRatio),n.deltaMode===globalThis.WheelEvent.DOM_DELTA_LINE&&(a*=ate)),a!==0&&a%XN===0&&(a=Math.floor(a/XN)),n.shiftKey&&a&&(a=a*ote),this.callback({type:"wheel",center:{x:n.clientX,y:n.clientY},delta:-a,srcEvent:n,pointerType:"mouse",target:n.target})},e.addEventListener("wheel",this.handleEvent,{passive:!1})}destroy(){this.element.removeEventListener("wheel",this.handleEvent)}enableEventType(e,t){e==="wheel"&&(this.options.enable=t)}}const ZN=["mousedown","mousemove","mouseup","mouseover","mouseout","mouseleave"];class lte extends yC{constructor(e,t,i){super(e,t,{enable:!0,...i}),this.handleEvent=a=>{this.handleOverEvent(a),this.handleOutEvent(a),this.handleEnterEvent(a),this.handleLeaveEvent(a),this.handleMoveEvent(a)},this.pressed=!1;const{enable:n}=this.options;this.enableMoveEvent=n,this.enableLeaveEvent=n,this.enableEnterEvent=n,this.enableOutEvent=n,this.enableOverEvent=n,ZN.forEach(a=>e.addEventListener(a,this.handleEvent))}destroy(){ZN.forEach(e=>this.element.removeEventListener(e,this.handleEvent))}enableEventType(e,t){switch(e){case"pointermove":this.enableMoveEvent=t;break;case"pointerover":this.enableOverEvent=t;break;case"pointerout":this.enableOutEvent=t;break;case"pointerenter":this.enableEnterEvent=t;break;case"pointerleave":this.enableLeaveEvent=t;break}}handleOverEvent(e){this.enableOverEvent&&e.type==="mouseover"&&this._emit("pointerover",e)}handleOutEvent(e){this.enableOutEvent&&e.type==="mouseout"&&this._emit("pointerout",e)}handleEnterEvent(e){this.enableEnterEvent&&e.type==="mouseenter"&&this._emit("pointerenter",e)}handleLeaveEvent(e){this.enableLeaveEvent&&e.type==="mouseleave"&&this._emit("pointerleave",e)}handleMoveEvent(e){if(this.enableMoveEvent)switch(e.type){case"mousedown":e.button>=0&&(this.pressed=!0);break;case"mousemove":e.buttons===0&&(this.pressed=!1),this.pressed||this._emit("pointermove",e);break;case"mouseup":this.pressed=!1;break}}_emit(e,t){this.callback({type:e,center:{x:t.clientX,y:t.clientY},srcEvent:t,pointerType:"mouse",target:t.target})}}const qN=["keydown","keyup"];class ute extends yC{constructor(e,t,i){super(e,t,{enable:!0,tabIndex:0,...i}),this.handleEvent=n=>{const a=n.target||n.srcElement;a.tagName==="INPUT"&&a.type==="text"||a.tagName==="TEXTAREA"||(this.enableDownEvent&&n.type==="keydown"&&this.callback({type:"keydown",srcEvent:n,key:n.key,target:n.target}),this.enableUpEvent&&n.type==="keyup"&&this.callback({type:"keyup",srcEvent:n,key:n.key,target:n.target}))},this.enableDownEvent=this.options.enable,this.enableUpEvent=this.options.enable,e.tabIndex=this.options.tabIndex,e.style.outline="none",qN.forEach(n=>e.addEventListener(n,this.handleEvent))}destroy(){qN.forEach(e=>this.element.removeEventListener(e,this.handleEvent))}enableEventType(e,t){e==="keydown"&&(this.enableDownEvent=t),e==="keyup"&&(this.enableUpEvent=t)}}class cte extends yC{constructor(e,t,i){super(e,t,i),this.handleEvent=n=>{this.options.enable&&this.callback({type:"contextmenu",center:{x:n.clientX,y:n.clientY},srcEvent:n,pointerType:"mouse",target:n.target})},e.addEventListener("contextmenu",this.handleEvent)}destroy(){this.element.removeEventListener("contextmenu",this.handleEvent)}enableEventType(e,t){e==="contextmenu"&&(this.options.enable=t)}}const YN=1,lR=2,KN=4,hte={pointerdown:YN,pointermove:lR,pointerup:KN,mousedown:YN,mousemove:lR,mouseup:KN},fte=0,dte=1,pte=2,gte=1,vte=2,mte=4;function yte(r){const e=hte[r.srcEvent.type];if(!e)return null;const{buttons:t,button:i}=r.srcEvent;let n=!1,a=!1,s=!1;return e===lR?(n=!!(t&gte),a=!!(t&mte),s=!!(t&vte)):(n=i===fte,a=i===dte,s=i===pte),{leftButton:n,middleButton:a,rightButton:s}}function _te(r,e){const t=r.center;if(!t)return null;const i=e.getBoundingClientRect(),n=i.width/e.offsetWidth||1,a=i.height/e.offsetHeight||1,s={x:(t.x-i.left-e.clientLeft)/n,y:(t.y-i.top-e.clientTop)/a};return{center:t,offsetCenter:s}}const bte={srcElement:"root",priority:0};class xte{constructor(e,t){this.handleEvent=i=>{if(this.isEmpty())return;const n=this._normalizeEvent(i);let a=i.srcEvent.target;for(;a&&a!==n.rootElement;){if(this._emit(n,a),n.handled)return;a=a.parentNode}this._emit(n,"root")},this.eventManager=e,this.recognizerName=t,this.handlers=[],this.handlersByElement=new Map,this._active=!1}isEmpty(){return!this._active}add(e,t,i,n=!1,a=!1){const{handlers:s,handlersByElement:o}=this,l={...bte,...i};let c=o.get(l.srcElement);c||(c=[],o.set(l.srcElement,c));const f={type:e,handler:t,srcElement:l.srcElement,priority:l.priority};n&&(f.once=!0),a&&(f.passive=!0),s.push(f),this._active=this._active||!f.passive;let p=c.length-1;for(;p>=0&&!(c[p].priority>=f.priority);)p--;c.splice(p+1,0,f)}remove(e,t){const{handlers:i,handlersByElement:n}=this;for(let a=i.length-1;a>=0;a--){const s=i[a];if(s.type===e&&s.handler===t){i.splice(a,1);const o=n.get(s.srcElement);o.splice(o.indexOf(s),1),o.length===0&&n.delete(s.srcElement)}}this._active=i.some(a=>!a.passive)}_emit(e,t){const i=this.handlersByElement.get(t);if(i){let n=!1;const a=()=>{e.handled=!0},s=()=>{e.handled=!0,n=!0},o=[];for(let l=0;l<i.length;l++){const{type:c,handler:f,once:p}=i[l];if(f({...e,type:c,stopPropagation:a,stopImmediatePropagation:s}),p&&o.push(i[l]),n)break}for(let l=0;l<o.length;l++){const{type:c,handler:f}=o[l];this.remove(c,f)}}}_normalizeEvent(e){const t=this.eventManager.getElement();return{...e,...yte(e),..._te(e,t),preventDefault:()=>{e.srcEvent.preventDefault()},stopImmediatePropagation:null,stopPropagation:null,handled:!1,rootElement:t}}}function wte(r){if("recognizer"in r)return r;let e;const t=Array.isArray(r)?[...r]:[r];if(typeof t[0]=="function"){const i=t.shift(),n=t.shift()||{};e=new i(n)}else e=t.shift();return{recognizer:e,recognizeWith:typeof t[0]=="string"?[t[0]]:t[0],requireFailure:typeof t[1]=="string"?[t[1]]:t[1]}}class Ste{constructor(e=null,t={}){if(this._onBasicInput=i=>{this.manager.emit(i.srcEvent.type,i)},this._onOtherEvent=i=>{this.manager.emit(i.type,i)},this.options={recognizers:[],events:{},touchAction:"compute",tabIndex:0,cssProps:{},...t},this.events=new Map,this.element=e,!!e){this.manager=new Kee(e,this.options);for(const i of this.options.recognizers){const{recognizer:n,recognizeWith:a,requireFailure:s}=wte(i);this.manager.add(n),a&&n.recognizeWith(a),s&&n.requireFailure(s)}this.manager.on("hammer.input",this._onBasicInput),this.wheelInput=new ste(e,this._onOtherEvent,{enable:!1}),this.moveInput=new lte(e,this._onOtherEvent,{enable:!1}),this.keyInput=new ute(e,this._onOtherEvent,{enable:!1,tabIndex:t.tabIndex}),this.contextmenuInput=new cte(e,this._onOtherEvent,{enable:!1}),this.on(this.options.events)}}getElement(){return this.element}destroy(){this.element&&(this.wheelInput.destroy(),this.moveInput.destroy(),this.keyInput.destroy(),this.contextmenuInput.destroy(),this.manager.destroy())}on(e,t,i){this._addEventHandler(e,t,i,!1)}once(e,t,i){this._addEventHandler(e,t,i,!0)}watch(e,t,i){this._addEventHandler(e,t,i,!1,!0)}off(e,t){this._removeEventHandler(e,t)}_toggleRecognizer(e,t){const{manager:i}=this;if(!i)return;const n=i.get(e);n&&(n.set({enable:t}),i.touchAction.update()),this.wheelInput?.enableEventType(e,t),this.moveInput?.enableEventType(e,t),this.keyInput?.enableEventType(e,t),this.contextmenuInput?.enableEventType(e,t)}_addEventHandler(e,t,i,n,a){if(typeof e!="string"){i=t;for(const[c,f]of Object.entries(e))this._addEventHandler(c,f,i,n,a);return}const{manager:s,events:o}=this;if(!s)return;let l=o.get(e);if(!l){const c=this._getRecognizerName(e)||e;l=new xte(this,c),o.set(e,l),s&&s.on(e,l.handleEvent)}l.add(e,t,i,n,a),l.isEmpty()||this._toggleRecognizer(l.recognizerName,!0)}_removeEventHandler(e,t){if(typeof e!="string"){for(const[a,s]of Object.entries(e))this._removeEventHandler(a,s);return}const{events:i}=this,n=i.get(e);if(n&&(n.remove(e,t),n.isEmpty())){const{recognizerName:a}=n;let s=!1;for(const o of i.values())if(o.recognizerName===a&&!o.isEmpty()){s=!0;break}s||this._toggleRecognizer(a,!1)}}_getRecognizerName(e){return this.manager.recognizers.find(t=>t.getEventNames().includes(e))?.options.event}}const rn={DEFAULT:-1,LNGLAT:1,METER_OFFSETS:2,LNGLAT_OFFSETS:3,CARTESIAN:0};Object.defineProperty(rn,"IDENTITY",{get:()=>(Tn.deprecated("COORDINATE_SYSTEM.IDENTITY","COORDINATE_SYSTEM.CARTESIAN")(),0)});const mu={WEB_MERCATOR:1,GLOBE:2,WEB_MERCATOR_AUTO_OFFSET:4,IDENTITY:0},fy={common:0,meters:1,pixels:2},uR={click:"onClick",dblclick:"onClick",panstart:"onDragStart",panmove:"onDrag",panend:"onDragEnd"},QN={multipan:[GN,{threshold:10,direction:ao.Vertical,pointers:2}],pinch:[rte,{},null,["multipan"]],pan:[GN,{threshold:1},["pinch"],["multipan"]],dblclick:[WN,{event:"dblclick",taps:2}],click:[WN,{event:"click"},null,["dblclick"]]};function Tte(r,e){if(r===e)return!0;if(Array.isArray(r)){const t=r.length;if(!e||e.length!==t)return!1;for(let i=0;i<t;i++)if(r[i]!==e[i])return!1;return!0}return!1}function Fw(r){let e={},t;return i=>{for(const n in i)if(!Tte(i[n],e[n])){t=r(i),e=i;break}return t}}const JN=[0,0,0,0],Ate=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0],NH=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],Cte=[0,0,0],BH=[0,0,0],Mte=Fw(Pte);function zH(r,e,t=BH){t.length<3&&(t=[t[0],t[1],0]);let i=t,n,a=!0;switch(e===rn.LNGLAT_OFFSETS||e===rn.METER_OFFSETS?n=t:n=r.isGeospatial?[Math.fround(r.longitude),Math.fround(r.latitude),0]:null,r.projectionMode){case mu.WEB_MERCATOR:(e===rn.LNGLAT||e===rn.CARTESIAN)&&(n=[0,0,0],a=!1);break;case mu.WEB_MERCATOR_AUTO_OFFSET:e===rn.LNGLAT?i=n:e===rn.CARTESIAN&&(i=[Math.fround(r.center[0]),Math.fround(r.center[1]),0],n=r.unprojectPosition(i),i[0]-=t[0],i[1]-=t[1],i[2]-=t[2]);break;case mu.IDENTITY:i=r.position.map(Math.fround),i[2]=i[2]||0;break;case mu.GLOBE:a=!1,n=null;break;default:a=!1}return{geospatialOrigin:n,shaderCoordinateOrigin:i,offsetMode:a}}function Ete(r,e,t){const{viewMatrixUncentered:i,projectionMatrix:n}=r;let{viewMatrix:a,viewProjectionMatrix:s}=r,o=JN,l=JN,c=r.cameraPosition;const{geospatialOrigin:f,shaderCoordinateOrigin:p,offsetMode:y}=zH(r,e,t);return y&&(l=r.projectPosition(f||p),c=[c[0]-l[0],c[1]-l[1],c[2]-l[2]],l[3]=1,o=tb([],l,s),a=i||a,s=Km([],n,a),s=Km([],s,Ate)),{viewMatrix:a,viewProjectionMatrix:s,projectionCenter:o,originCommon:l,cameraPosCommon:c,shaderCoordinateOrigin:p,geospatialOrigin:f}}function Ite({viewport:r,devicePixelRatio:e=1,modelMatrix:t=null,coordinateSystem:i=rn.DEFAULT,coordinateOrigin:n=BH,autoWrapLongitude:a=!1}){i===rn.DEFAULT&&(i=r.isGeospatial?rn.LNGLAT:rn.CARTESIAN);const s=Mte({viewport:r,devicePixelRatio:e,coordinateSystem:i,coordinateOrigin:n});return s.wrapLongitude=a,s.modelMatrix=t||NH,s}function Pte({viewport:r,devicePixelRatio:e,coordinateSystem:t,coordinateOrigin:i}){const{projectionCenter:n,viewProjectionMatrix:a,originCommon:s,cameraPosCommon:o,shaderCoordinateOrigin:l,geospatialOrigin:c}=Ete(r,t,i),f=r.getDistanceScales(),p=[r.width*e,r.height*e],y=tb([],[0,0,-r.focalDistance,1],r.projectionMatrix)[3]||1,b={coordinateSystem:t,projectionMode:r.projectionMode,coordinateOrigin:l,commonOrigin:s.slice(0,3),center:n,pseudoMeters:!!r._pseudoMeters,viewportSize:p,devicePixelRatio:e,focalDistance:y,commonUnitsPerMeter:f.unitsPerMeter,commonUnitsPerWorldUnit:f.unitsPerMeter,commonUnitsPerWorldUnit2:Cte,scale:r.scale,wrapLongitude:!1,viewProjectionMatrix:a,modelMatrix:NH,cameraPosition:o};if(c){const S=r.getDistanceScales(c);switch(t){case rn.METER_OFFSETS:b.commonUnitsPerWorldUnit=S.unitsPerMeter,b.commonUnitsPerWorldUnit2=S.unitsPerMeter2;break;case rn.LNGLAT:case rn.LNGLAT_OFFSETS:r._pseudoMeters||(b.commonUnitsPerMeter=S.unitsPerMeter),b.commonUnitsPerWorldUnit=S.unitsPerDegree,b.commonUnitsPerWorldUnit2=S.unitsPerDegree2;break;case rn.CARTESIAN:b.commonUnitsPerWorldUnit=[1,1,S.unitsPerMeter[2]],b.commonUnitsPerWorldUnit2=[0,0,S.unitsPerMeter2[2]];break}}return b}const Rte=Object.keys(rn).map(r=>`const COORDINATE_SYSTEM_${r}: i32 = ${rn[r]};`).join(""),Dte=Object.keys(mu).map(r=>`const PROJECTION_MODE_${r}: i32 = ${mu[r]};`).join(""),kte=Object.keys(fy).map(r=>`const UNIT_${r.toUpperCase()}: i32 = ${fy[r]};`).join(""),Lte=`${Rte}
${Dte}
${kte}

const TILE_SIZE: f32 = 512.0;
const PI: f32 = 3.1415926536;
const WORLD_SCALE: f32 = TILE_SIZE / (PI * 2.0);
const ZERO_64_LOW: vec3<f32> = vec3<f32>(0.0, 0.0, 0.0);
const EARTH_RADIUS: f32 = 6370972.0; // meters
const GLOBE_RADIUS: f32 = 256.0;

// -----------------------------------------------------------------------------
// Uniform block (converted from GLSL uniform block)
// -----------------------------------------------------------------------------
struct ProjectUniforms {
  wrapLongitude: i32,
  coordinateSystem: i32,
  commonUnitsPerMeter: vec3<f32>,
  projectionMode: i32,
  scale: f32,
  commonUnitsPerWorldUnit: vec3<f32>,
  commonUnitsPerWorldUnit2: vec3<f32>,
  center: vec4<f32>,
  modelMatrix: mat4x4<f32>,
  viewProjectionMatrix: mat4x4<f32>,
  viewportSize: vec2<f32>,
  devicePixelRatio: f32,
  focalDistance: f32,
  cameraPosition: vec3<f32>,
  coordinateOrigin: vec3<f32>,
  commonOrigin: vec3<f32>,
  pseudoMeters: i32,
};

@group(0) @binding(0)
var<uniform> project: ProjectUniforms;

// -----------------------------------------------------------------------------
// Geometry data
// (In your GLSL code, "geometry" was assumed to be available globally. In WGSL,
// you might supply this via vertex attributes or a uniform. Here we define a
// uniform struct for demonstration.)
// -----------------------------------------------------------------------------

// Structure to carry additional geometry data used by deck.gl filters.
struct Geometry {
  worldPosition: vec3<f32>,
  worldPositionAlt: vec3<f32>,
  position: vec4<f32>,
  normal: vec3<f32>,
  uv: vec2<f32>,
  pickingColor: vec3<f32>,
};

// @group(0) @binding(1)
var<private> geometry: Geometry;
`,Ote=`${Lte}

// -----------------------------------------------------------------------------
// Functions
// -----------------------------------------------------------------------------

// Returns an adjustment factor for commonUnitsPerMeter
fn _project_size_at_latitude(lat: f32) -> f32 {
  let y = clamp(lat, -89.9, 89.9);
  return 1.0 / cos(radians(y));
}

// Overloaded version: scales a value in meters at a given latitude.
fn _project_size_at_latitude_m(meters: f32, lat: f32) -> f32 {
  return meters * project.commonUnitsPerMeter.z * _project_size_at_latitude(lat);
}

// Computes a non-linear scale factor based on geometry.
// (Note: This function relies on "geometry" being provided.)
fn project_size() -> f32 {
  if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR &&
      project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT &&
      project.pseudoMeters == 0) {
    if (geometry.position.w == 0.0) {
      return _project_size_at_latitude(geometry.worldPosition.y);
    }
    let y: f32 = geometry.position.y / TILE_SIZE * 2.0 - 1.0;
    let y2 = y * y;
    let y4 = y2 * y2;
    let y6 = y4 * y2;
    return 1.0 + 4.9348 * y2 + 4.0587 * y4 + 1.5642 * y6;
  }
  return 1.0;
}

// Overloads to scale offsets (meters to world units)
fn project_size_float(meters: f32) -> f32 {
  return meters * project.commonUnitsPerMeter.z * project_size();
}

fn project_size_vec2(meters: vec2<f32>) -> vec2<f32> {
  return meters * project.commonUnitsPerMeter.xy * project_size();
}

fn project_size_vec3(meters: vec3<f32>) -> vec3<f32> {
  return meters * project.commonUnitsPerMeter * project_size();
}

fn project_size_vec4(meters: vec4<f32>) -> vec4<f32> {
  return vec4<f32>(meters.xyz * project.commonUnitsPerMeter, meters.w);
}

// Returns a rotation matrix aligning the z‑axis with the given up vector.
fn project_get_orientation_matrix(up: vec3<f32>) -> mat3x3<f32> {
  let uz = normalize(up);
  let ux = select(
    vec3<f32>(1.0, 0.0, 0.0),
    normalize(vec3<f32>(uz.y, -uz.x, 0.0)),
    abs(uz.z) == 1.0
  );
  let uy = cross(uz, ux);
  return mat3x3<f32>(ux, uy, uz);
}

// Since WGSL does not support "out" parameters, we return a struct.
struct RotationResult {
  needsRotation: bool,
  transform: mat3x3<f32>,
};

fn project_needs_rotation(commonPosition: vec3<f32>) -> RotationResult {
  if (project.projectionMode == PROJECTION_MODE_GLOBE) {
    return RotationResult(true, project_get_orientation_matrix(commonPosition));
  } else {
    return RotationResult(false, mat3x3<f32>());  // identity alternative if needed
  };
}

// Projects a normal vector from the current coordinate system to world space.
fn project_normal(vector: vec3<f32>) -> vec3<f32> {
  let normal_modelspace = project.modelMatrix * vec4<f32>(vector, 0.0);
  var n = normalize(normal_modelspace.xyz * project.commonUnitsPerMeter);
  let rotResult = project_needs_rotation(geometry.position.xyz);
  if (rotResult.needsRotation) {
    n = rotResult.transform * n;
  }
  return n;
}

// Applies a scale offset based on y-offset (dy)
fn project_offset_(offset: vec4<f32>) -> vec4<f32> {
  let dy: f32 = offset.y;
  let commonUnitsPerWorldUnit = project.commonUnitsPerWorldUnit + project.commonUnitsPerWorldUnit2 * dy;
  return vec4<f32>(offset.xyz * commonUnitsPerWorldUnit, offset.w);
}

// Projects lng/lat coordinates to a unit tile [0,1]
fn project_mercator_(lnglat: vec2<f32>) -> vec2<f32> {
  var x = lnglat.x;
  if (project.wrapLongitude != 0) {
    x = ((x + 180.0) % 360.0) - 180.0;
  }
  let y = clamp(lnglat.y, -89.9, 89.9);
  return vec2<f32>(
    radians(x) + PI,
    PI + log(tan(PI * 0.25 + radians(y) * 0.5))
  ) * WORLD_SCALE;
}

// Projects lng/lat/z coordinates for a globe projection.
fn project_globe_(lnglatz: vec3<f32>) -> vec3<f32> {
  let lambda = radians(lnglatz.x);
  let phi = radians(lnglatz.y);
  let cosPhi = cos(phi);
  let D = (lnglatz.z / EARTH_RADIUS + 1.0) * GLOBE_RADIUS;
  return vec3<f32>(
    sin(lambda) * cosPhi,
    -cos(lambda) * cosPhi,
    sin(phi)
  ) * D;
}

// Projects positions (with an optional 64-bit low part) from the input
// coordinate system to the common space.
fn project_position_vec4_f64(position: vec4<f32>, position64Low: vec3<f32>) -> vec4<f32> {
  var position_world = project.modelMatrix * position;

  // Work around for a Mac+NVIDIA bug:
  if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR) {
    if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
      return vec4<f32>(
        project_mercator_(position_world.xy),
        _project_size_at_latitude_m(position_world.z, position_world.y),
        position_world.w
      );
    }
    if (project.coordinateSystem == COORDINATE_SYSTEM_CARTESIAN) {
      position_world = vec4f(position_world.xyz + project.coordinateOrigin, position_world.w);
    }
  }
  if (project.projectionMode == PROJECTION_MODE_GLOBE) {
    if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
      return vec4<f32>(
        project_globe_(position_world.xyz),
        position_world.w
      );
    }
  }
  if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET) {
    if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
      if (abs(position_world.y - project.coordinateOrigin.y) > 0.25) {
        return vec4<f32>(
          project_mercator_(position_world.xy) - project.commonOrigin.xy,
          project_size_float(position_world.z),
          position_world.w
        );
      }
    }
  }
  if (project.projectionMode == PROJECTION_MODE_IDENTITY ||
      (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET &&
       (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT ||
        project.coordinateSystem == COORDINATE_SYSTEM_CARTESIAN))) {
    position_world = vec4f(position_world.xyz - project.coordinateOrigin, position_world.w);
  }

  return project_offset_(position_world) +
         project_offset_(project.modelMatrix * vec4<f32>(position64Low, 0.0));
}

// Overloaded versions for different input types.
fn project_position_vec4_f32(position: vec4<f32>) -> vec4<f32> {
  return project_position_vec4_f64(position, ZERO_64_LOW);
}

fn project_position_vec3_f64(position: vec3<f32>, position64Low: vec3<f32>) -> vec3<f32> {
  let projected_position = project_position_vec4_f64(vec4<f32>(position, 1.0), position64Low);
  return projected_position.xyz;
}

fn project_position_vec3_f32(position: vec3<f32>) -> vec3<f32> {
  let projected_position = project_position_vec4_f64(vec4<f32>(position, 1.0), ZERO_64_LOW);
  return projected_position.xyz;
}

fn project_position_vec2_f32(position: vec2<f32>) -> vec2<f32> {
  let projected_position = project_position_vec4_f64(vec4<f32>(position, 0.0, 1.0), ZERO_64_LOW);
  return projected_position.xy;
}

// Transforms a common space position to clip space.
fn project_common_position_to_clipspace_with_projection(position: vec4<f32>, viewProjectionMatrix: mat4x4<f32>, center: vec4<f32>) -> vec4<f32> {
  return viewProjectionMatrix * position + center;
}

// Uses the project viewProjectionMatrix and center.
fn project_common_position_to_clipspace(position: vec4<f32>) -> vec4<f32> {
  return project_common_position_to_clipspace_with_projection(position, project.viewProjectionMatrix, project.center);
}

// Returns a clip space offset corresponding to a given number of screen pixels.
fn project_pixel_size_to_clipspace(pixels: vec2<f32>) -> vec2<f32> {
  let offset = pixels / project.viewportSize * project.devicePixelRatio * 2.0;
  return offset * project.focalDistance;
}

fn project_meter_size_to_pixel(meters: f32) -> f32 {
  return project_size_float(meters) * project.scale;
}

fn project_unit_size_to_pixel(size: f32, unit: i32) -> f32 {
  if (unit == UNIT_METERS) {
    return project_meter_size_to_pixel(size);
  } else if (unit == UNIT_COMMON) {
    return size * project.scale;
  }
  // UNIT_PIXELS: no scaling applied.
  return size;
}

fn project_pixel_size_float(pixels: f32) -> f32 {
  return pixels / project.scale;
}

fn project_pixel_size_vec2(pixels: vec2<f32>) -> vec2<f32> {
  return pixels / project.scale;
}
`,Nte=Object.keys(rn).map(r=>`const int COORDINATE_SYSTEM_${r} = ${rn[r]};`).join(""),Bte=Object.keys(mu).map(r=>`const int PROJECTION_MODE_${r} = ${mu[r]};`).join(""),zte=Object.keys(fy).map(r=>`const int UNIT_${r.toUpperCase()} = ${fy[r]};`).join(""),Fte=`${Nte}
${Bte}
${zte}
uniform projectUniforms {
bool wrapLongitude;
int coordinateSystem;
vec3 commonUnitsPerMeter;
int projectionMode;
float scale;
vec3 commonUnitsPerWorldUnit;
vec3 commonUnitsPerWorldUnit2;
vec4 center;
mat4 modelMatrix;
mat4 viewProjectionMatrix;
vec2 viewportSize;
float devicePixelRatio;
float focalDistance;
vec3 cameraPosition;
vec3 coordinateOrigin;
vec3 commonOrigin;
bool pseudoMeters;
} project;
const float TILE_SIZE = 512.0;
const float PI = 3.1415926536;
const float WORLD_SCALE = TILE_SIZE / (PI * 2.0);
const vec3 ZERO_64_LOW = vec3(0.0);
const float EARTH_RADIUS = 6370972.0;
const float GLOBE_RADIUS = 256.0;
float project_size_at_latitude(float lat) {
float y = clamp(lat, -89.9, 89.9);
return 1.0 / cos(radians(y));
}
float project_size() {
if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR &&
project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT &&
project.pseudoMeters == false) {
if (geometry.position.w == 0.0) {
return project_size_at_latitude(geometry.worldPosition.y);
}
float y = geometry.position.y / TILE_SIZE * 2.0 - 1.0;
float y2 = y * y;
float y4 = y2 * y2;
float y6 = y4 * y2;
return 1.0 + 4.9348 * y2 + 4.0587 * y4 + 1.5642 * y6;
}
return 1.0;
}
float project_size_at_latitude(float meters, float lat) {
return meters * project.commonUnitsPerMeter.z * project_size_at_latitude(lat);
}
float project_size(float meters) {
return meters * project.commonUnitsPerMeter.z * project_size();
}
vec2 project_size(vec2 meters) {
return meters * project.commonUnitsPerMeter.xy * project_size();
}
vec3 project_size(vec3 meters) {
return meters * project.commonUnitsPerMeter * project_size();
}
vec4 project_size(vec4 meters) {
return vec4(meters.xyz * project.commonUnitsPerMeter, meters.w);
}
mat3 project_get_orientation_matrix(vec3 up) {
vec3 uz = normalize(up);
vec3 ux = abs(uz.z) == 1.0 ? vec3(1.0, 0.0, 0.0) : normalize(vec3(uz.y, -uz.x, 0));
vec3 uy = cross(uz, ux);
return mat3(ux, uy, uz);
}
bool project_needs_rotation(vec3 commonPosition, out mat3 transform) {
if (project.projectionMode == PROJECTION_MODE_GLOBE) {
transform = project_get_orientation_matrix(commonPosition);
return true;
}
return false;
}
vec3 project_normal(vec3 vector) {
vec4 normal_modelspace = project.modelMatrix * vec4(vector, 0.0);
vec3 n = normalize(normal_modelspace.xyz * project.commonUnitsPerMeter);
mat3 rotation;
if (project_needs_rotation(geometry.position.xyz, rotation)) {
n = rotation * n;
}
return n;
}
vec4 project_offset_(vec4 offset) {
float dy = offset.y;
vec3 commonUnitsPerWorldUnit = project.commonUnitsPerWorldUnit + project.commonUnitsPerWorldUnit2 * dy;
return vec4(offset.xyz * commonUnitsPerWorldUnit, offset.w);
}
vec2 project_mercator_(vec2 lnglat) {
float x = lnglat.x;
if (project.wrapLongitude) {
x = mod(x + 180., 360.0) - 180.;
}
float y = clamp(lnglat.y, -89.9, 89.9);
return vec2(
radians(x) + PI,
PI + log(tan_fp32(PI * 0.25 + radians(y) * 0.5))
) * WORLD_SCALE;
}
vec3 project_globe_(vec3 lnglatz) {
float lambda = radians(lnglatz.x);
float phi = radians(lnglatz.y);
float cosPhi = cos(phi);
float D = (lnglatz.z / EARTH_RADIUS + 1.0) * GLOBE_RADIUS;
return vec3(
sin(lambda) * cosPhi,
-cos(lambda) * cosPhi,
sin(phi)
) * D;
}
vec4 project_position(vec4 position, vec3 position64Low) {
vec4 position_world = project.modelMatrix * position;
if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR) {
if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
return vec4(
project_mercator_(position_world.xy),
project_size_at_latitude(position_world.z, position_world.y),
position_world.w
);
}
if (project.coordinateSystem == COORDINATE_SYSTEM_CARTESIAN) {
position_world.xyz += project.coordinateOrigin;
}
}
if (project.projectionMode == PROJECTION_MODE_GLOBE) {
if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
return vec4(
project_globe_(position_world.xyz),
position_world.w
);
}
}
if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET) {
if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
if (abs(position_world.y - project.coordinateOrigin.y) > 0.25) {
return vec4(
project_mercator_(position_world.xy) - project.commonOrigin.xy,
project_size(position_world.z),
position_world.w
);
}
}
}
if (project.projectionMode == PROJECTION_MODE_IDENTITY ||
(project.projectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET &&
(project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT ||
project.coordinateSystem == COORDINATE_SYSTEM_CARTESIAN))) {
position_world.xyz -= project.coordinateOrigin;
}
return project_offset_(position_world) + project_offset_(project.modelMatrix * vec4(position64Low, 0.0));
}
vec4 project_position(vec4 position) {
return project_position(position, ZERO_64_LOW);
}
vec3 project_position(vec3 position, vec3 position64Low) {
vec4 projected_position = project_position(vec4(position, 1.0), position64Low);
return projected_position.xyz;
}
vec3 project_position(vec3 position) {
vec4 projected_position = project_position(vec4(position, 1.0), ZERO_64_LOW);
return projected_position.xyz;
}
vec2 project_position(vec2 position) {
vec4 projected_position = project_position(vec4(position, 0.0, 1.0), ZERO_64_LOW);
return projected_position.xy;
}
vec4 project_common_position_to_clipspace(vec4 position, mat4 viewProjectionMatrix, vec4 center) {
return viewProjectionMatrix * position + center;
}
vec4 project_common_position_to_clipspace(vec4 position) {
return project_common_position_to_clipspace(position, project.viewProjectionMatrix, project.center);
}
vec2 project_pixel_size_to_clipspace(vec2 pixels) {
vec2 offset = pixels / project.viewportSize * project.devicePixelRatio * 2.0;
return offset * project.focalDistance;
}
float project_size_to_pixel(float meters) {
return project_size(meters) * project.scale;
}
float project_size_to_pixel(float size, int unit) {
if (unit == UNIT_METERS) return project_size_to_pixel(size);
if (unit == UNIT_COMMON) return size * project.scale;
return size;
}
float project_pixel_size(float pixels) {
return pixels / project.scale;
}
vec2 project_pixel_size(vec2 pixels) {
return pixels / project.scale;
}
`,Vte={};function Ute(r=Vte){return"viewport"in r?Ite(r):{}}const $D={name:"project",dependencies:[vee,IH],source:Ote,vs:Fte,getUniforms:Ute,uniformTypes:{wrapLongitude:"f32",coordinateSystem:"i32",commonUnitsPerMeter:"vec3<f32>",projectionMode:"i32",scale:"f32",commonUnitsPerWorldUnit:"vec3<f32>",commonUnitsPerWorldUnit2:"vec3<f32>",center:"vec4<f32>",modelMatrix:"mat4x4<f32>",viewProjectionMatrix:"mat4x4<f32>",viewportSize:"vec2<f32>",devicePixelRatio:"f32",focalDistance:"f32",cameraPosition:"vec3<f32>",coordinateOrigin:"vec3<f32>",commonOrigin:"vec3<f32>",pseudoMeters:"f32"}},Hte=`// Define a structure to hold both the clip-space position and the common position.
struct ProjectResult {
  clipPosition: vec4<f32>,
  commonPosition: vec4<f32>,
};

// This function mimics the GLSL version with the 'out' parameter by returning both values.
fn project_position_to_clipspace_and_commonspace(
    position: vec3<f32>,
    position64Low: vec3<f32>,
    offset: vec3<f32>
) -> ProjectResult {
  // Compute the projected position.
  let projectedPosition: vec3<f32> = project_position_vec3_f64(position, position64Low);

  // Start with the provided offset.
  var finalOffset: vec3<f32> = offset;

  // Get whether a rotation is needed and the rotation matrix.
  let rotationResult = project_needs_rotation(projectedPosition);

  // If rotation is needed, update the offset.
  if (rotationResult.needsRotation) {
    finalOffset = rotationResult.transform * offset;
  }

  // Compute the common position.
  let commonPosition: vec4<f32> = vec4<f32>(projectedPosition + finalOffset, 1.0);

  // Convert to clip-space.
  let clipPosition: vec4<f32> = project_common_position_to_clipspace(commonPosition);

  return ProjectResult(clipPosition, commonPosition);
}

// A convenience overload that returns only the clip-space position.
fn project_position_to_clipspace(
    position: vec3<f32>,
    position64Low: vec3<f32>,
    offset: vec3<f32>
) -> vec4<f32> {
  return project_position_to_clipspace_and_commonspace(position, position64Low, offset).clipPosition;
}
`,jte=`vec4 project_position_to_clipspace(
  vec3 position, vec3 position64Low, vec3 offset, out vec4 commonPosition
) {
  vec3 projectedPosition = project_position(position, position64Low);
  mat3 rotation;
  if (project_needs_rotation(projectedPosition, rotation)) {
    // offset is specified as ENU
    // when in globe projection, rotate offset so that the ground alighs with the surface of the globe
    offset = rotation * offset;
  }
  commonPosition = vec4(projectedPosition + offset, 1.0);
  return project_common_position_to_clipspace(commonPosition);
}

vec4 project_position_to_clipspace(
  vec3 position, vec3 position64Low, vec3 offset
) {
  vec4 commonPosition;
  return project_position_to_clipspace(position, position64Low, offset, commonPosition);
}
`,FH={name:"project32",dependencies:[$D],source:Hte,vs:jte};function $te(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function T0(r,e){const t=tb([],e,r);return CH(t,t,1/t[3]),t}function eB(r,e){const t=r%e;return t<0?e+t:t}function cR(r,e,t){return r<e?e:r>t?t:r}function Wte(r){return Math.log(r)*Math.LOG2E}const WD=Math.log2||Wte;function lp(r,e){if(!r)throw new Error(e||"@math.gl/web-mercator: assertion failed.")}const xh=Math.PI,VH=xh/4,bc=xh/180,hR=180/xh,B0=512,cA=4003e4,Sg=85.051129,Gte=1.5;function Xte(r){return WD(r)}function ew(r){const[e,t]=r;lp(Number.isFinite(e)),lp(Number.isFinite(t)&&t>=-90&&t<=90,"invalid latitude");const i=e*bc,n=t*bc,a=B0*(i+xh)/(2*xh),s=B0*(xh+Math.log(Math.tan(VH+n*.5)))/(2*xh);return[a,s]}function z0(r){const[e,t]=r,i=e/B0*(2*xh)-xh,n=2*(Math.atan(Math.exp(t/B0*(2*xh)-xh))-VH);return[i*hR,n*hR]}function Zte(r){const{latitude:e}=r;lp(Number.isFinite(e));const t=Math.cos(e*bc);return Xte(cA*t)-9}function A2(r){const e=Math.cos(r*bc);return B0/cA/e}function fR(r){const{latitude:e,longitude:t,highPrecision:i=!1}=r;lp(Number.isFinite(e)&&Number.isFinite(t));const n=B0,a=Math.cos(e*bc),s=n/360,o=s/a,l=n/cA/a,c={unitsPerMeter:[l,l,l],metersPerUnit:[1/l,1/l,1/l],unitsPerDegree:[s,o,l],degreesPerUnit:[1/s,1/o,1/l]};if(i){const f=bc*Math.tan(e*bc)/a,p=s*f/2,y=n/cA*f,b=y/o*l;c.unitsPerDegree2=[0,p,y],c.unitsPerMeter2=[b,0,b]}return c}function UH(r,e){const[t,i,n]=r,[a,s,o]=e,{unitsPerMeter:l,unitsPerMeter2:c}=fR({longitude:t,latitude:i,highPrecision:!0}),f=ew(r);f[0]+=a*(l[0]+c[0]*s),f[1]+=s*(l[1]+c[1]*s);const p=z0(f),y=(n||0)+(o||0);return Number.isFinite(n)||Number.isFinite(o)?[p[0],p[1],y]:p}function qte(r){const{height:e,pitch:t,bearing:i,altitude:n,scale:a,center:s}=r,o=$te();lA(o,o,[0,0,-n]),TH(o,o,-t*bc),AH(o,o,i*bc);const l=a/e;return jD(o,o,[l,l,l]),s&&lA(o,o,NJ([],s)),o}function Yte(r){const{width:e,height:t,altitude:i,pitch:n=0,offset:a,center:s,scale:o,nearZMultiplier:l=1,farZMultiplier:c=1}=r;let{fovy:f=tw(Gte)}=r;i!==void 0&&(f=tw(i));const p=f*bc,y=n*bc,b=GD(f);let S=b;s&&(S+=s[2]*o/Math.cos(y)/t);const C=p*(.5+(a?a[1]:0)/t),E=Math.sin(C)*S/Math.sin(cR(Math.PI/2-y-C,.01,Math.PI-.01)),P=Math.sin(y)*E+S,O=S*10,B=Math.min(P*c,O);return{fov:p,aspect:e/t,focalDistance:b,near:l,far:B}}function tw(r){return 2*Math.atan(.5/r)*hR}function GD(r){return .5/Math.tan(.5*r*bc)}function HH(r,e){const[t,i,n=0]=r;return lp(Number.isFinite(t)&&Number.isFinite(i)&&Number.isFinite(n)),T0(e,[t,i,n,1])}function XD(r,e,t=0){const[i,n,a]=r;if(lp(Number.isFinite(i)&&Number.isFinite(n),"invalid pixel coordinate"),Number.isFinite(a))return T0(e,[i,n,a,1]);const s=T0(e,[i,n,0,1]),o=T0(e,[i,n,1,1]),l=s[2],c=o[2],f=l===c?0:((t||0)-l)/(c-l);return bH([],s,o,f)}function Kte(r){const{width:e,height:t,bounds:i,minExtent:n=0,maxZoom:a=24,offset:s=[0,0]}=r,[[o,l],[c,f]]=i,p=Qte(r.padding),y=ew([o,cR(f,-Sg,Sg)]),b=ew([c,cR(l,-Sg,Sg)]),S=[Math.max(Math.abs(b[0]-y[0]),n),Math.max(Math.abs(b[1]-y[1]),n)],C=[e-p.left-p.right-Math.abs(s[0])*2,t-p.top-p.bottom-Math.abs(s[1])*2];lp(C[0]>0&&C[1]>0);const E=C[0]/S[0],P=C[1]/S[1],O=(p.right-p.left)/2/E,B=(p.top-p.bottom)/2/P,F=[(b[0]+y[0])/2+O,(b[1]+y[1])/2+B],W=z0(F),$=Math.min(a,WD(Math.abs(Math.min(E,P))));return lp(Number.isFinite($)),{longitude:W[0],latitude:W[1],zoom:$}}function Qte(r=0){return typeof r=="number"?{top:r,bottom:r,left:r,right:r}:(lp(Number.isFinite(r.top)&&Number.isFinite(r.bottom)&&Number.isFinite(r.left)&&Number.isFinite(r.right)),r)}const tB=Math.PI/180;function Jte(r,e=0){const{width:t,height:i,unproject:n}=r,a={targetZ:e},s=n([0,i],a),o=n([t,i],a);let l,c;const f=r.fovy?.5*r.fovy*tB:Math.atan(.5/r.altitude),p=(90-r.pitch)*tB;return f>p-.01?(l=rB(r,0,e),c=rB(r,t,e)):(l=n([0,0],a),c=n([t,0],a)),[s,o,c,l]}function rB(r,e,t){const{pixelUnprojectionMatrix:i}=r,n=T0(i,[e,0,1,1]),a=T0(i,[e,r.height,1,1]),o=(t*r.distanceScales.unitsPerMeter[2]-n[2])/(a[2]-n[2]),l=bH([],n,a,o),c=z0(l);return c.push(t),c}const iB=512;function ere(r){const{width:e,height:t,pitch:i=0}=r;let{longitude:n,latitude:a,zoom:s,bearing:o=0}=r;(n<-180||n>180)&&(n=eB(n+180,360)-180),(o<-180||o>180)&&(o=eB(o+180,360)-180);const l=WD(t/iB);if(s<=l)s=l,a=0;else{const c=t/2/Math.pow(2,s),f=z0([0,c])[1];if(a<f)a=f;else{const p=z0([0,iB-c])[1];a>p&&(a=p)}}return{width:e,height:t,longitude:n,latitude:a,zoom:s,pitch:i,bearing:o}}const jH=`
uniform shadowUniforms {
  bool drawShadowMap;
  bool useShadowMap;
  vec4 color;
  highp int lightId;
  float lightCount;
  mat4 viewProjectionMatrix0;
  mat4 viewProjectionMatrix1;
  vec4 projectCenter0;
  vec4 projectCenter1;
} shadow;
`,tre=`
const int max_lights = 2;

out vec3 shadow_vPosition[max_lights];

vec4 shadow_setVertexPosition(vec4 position_commonspace) {
  mat4 viewProjectionMatrices[max_lights];
  viewProjectionMatrices[0] = shadow.viewProjectionMatrix0;
  viewProjectionMatrices[1] = shadow.viewProjectionMatrix1;
  vec4 projectCenters[max_lights];
  projectCenters[0] = shadow.projectCenter0;
  projectCenters[1] = shadow.projectCenter1;

  if (shadow.drawShadowMap) {
    return project_common_position_to_clipspace(position_commonspace, viewProjectionMatrices[shadow.lightId], projectCenters[shadow.lightId]);
  }
  if (shadow.useShadowMap) {
    for (int i = 0; i < max_lights; i++) {
      if(i < int(shadow.lightCount)) {
        vec4 shadowMap_position = project_common_position_to_clipspace(position_commonspace, viewProjectionMatrices[i], projectCenters[i]);
        shadow_vPosition[i] = (shadowMap_position.xyz / shadowMap_position.w + 1.0) / 2.0;
      }
    }
  }
  return gl_Position;
}
`,rre=`
${jH}
${tre}
`,ire=`
const int max_lights = 2;
uniform sampler2D shadow_uShadowMap0;
uniform sampler2D shadow_uShadowMap1;

in vec3 shadow_vPosition[max_lights];

const vec4 bitPackShift = vec4(1.0, 255.0, 65025.0, 16581375.0);
const vec4 bitUnpackShift = 1.0 / bitPackShift;
const vec4 bitMask = vec4(1.0 / 255.0, 1.0 / 255.0, 1.0 / 255.0,  0.0);

float shadow_getShadowWeight(vec3 position, sampler2D shadowMap) {
  vec4 rgbaDepth = texture(shadowMap, position.xy);

  float z = dot(rgbaDepth, bitUnpackShift);
  return smoothstep(0.001, 0.01, position.z - z);
}

vec4 shadow_filterShadowColor(vec4 color) {
  if (shadow.drawShadowMap) {
    vec4 rgbaDepth = fract(gl_FragCoord.z * bitPackShift);
    rgbaDepth -= rgbaDepth.gbaa * bitMask;
    return rgbaDepth;
  }
  if (shadow.useShadowMap) {
    float shadowAlpha = 0.0;
    shadowAlpha += shadow_getShadowWeight(shadow_vPosition[0], shadow_uShadowMap0);
    if(shadow.lightCount > 1.0) {
      shadowAlpha += shadow_getShadowWeight(shadow_vPosition[1], shadow_uShadowMap1);
    }
    shadowAlpha *= shadow.color.a / shadow.lightCount;
    float blendedAlpha = shadowAlpha + color.a * (1.0 - shadowAlpha);

    return vec4(
      mix(color.rgb, shadow.color.rgb, shadowAlpha / blendedAlpha),
      blendedAlpha
    );
  }
  return color;
}
`,nre=`
${jH}
${ire}
`,are=Fw(cre),ore=Fw(hre),sre=[0,0,0,1],lre=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0];function ure(r,e){const[t,i,n]=r,a=XD([t,i,n],e);return Number.isFinite(n)?a:[a[0],a[1],0]}function cre({viewport:r,center:e}){return new Eh(r.viewProjectionMatrix).invert().transform(e)}function hre({viewport:r,shadowMatrices:e}){const t=[],i=r.pixelUnprojectionMatrix,n=r.isGeospatial?void 0:1,a=[[0,0,n],[r.width,0,n],[0,r.height,n],[r.width,r.height,n],[0,0,-1],[r.width,0,-1],[0,r.height,-1],[r.width,r.height,-1]].map(s=>ure(s,i));for(const s of e){const o=s.clone().translate(new Vf(r.center).negate()),l=a.map(f=>o.transform(f)),c=new Eh().ortho({left:Math.min(...l.map(f=>f[0])),right:Math.max(...l.map(f=>f[0])),bottom:Math.min(...l.map(f=>f[1])),top:Math.max(...l.map(f=>f[1])),near:Math.min(...l.map(f=>-f[2])),far:Math.max(...l.map(f=>-f[2]))});t.push(c.multiplyRight(s))}return t}function fre(r){const{shadowEnabled:e=!0,project:t}=r;if(!e||!t||!r.shadowMatrices||!r.shadowMatrices.length)return{drawShadowMap:!1,useShadowMap:!1,shadow_uShadowMap0:r.dummyShadowMap,shadow_uShadowMap1:r.dummyShadowMap};const i=$D.getUniforms(t),n=are({viewport:t.viewport,center:i.center}),a=[],s=ore({shadowMatrices:r.shadowMatrices,viewport:t.viewport}).slice();for(let l=0;l<r.shadowMatrices.length;l++){const c=s[l],f=c.clone().translate(new Vf(t.viewport.center).negate());i.coordinateSystem===rn.LNGLAT&&i.projectionMode===mu.WEB_MERCATOR?(s[l]=f,a[l]=n):(s[l]=c.clone().multiplyRight(lre),a[l]=f.transform(n))}const o={drawShadowMap:!!r.drawToShadowMap,useShadowMap:r.shadowMaps?r.shadowMaps.length>0:!1,color:r.shadowColor||sre,lightId:r.shadowLightId||0,lightCount:r.shadowMatrices.length,shadow_uShadowMap0:r.dummyShadowMap,shadow_uShadowMap1:r.dummyShadowMap};for(let l=0;l<s.length;l++)o[`viewProjectionMatrix${l}`]=s[l],o[`projectCenter${l}`]=a[l];for(let l=0;l<2;l++)o[`shadow_uShadowMap${l}`]=r.shadowMaps&&r.shadowMaps[l]||r.dummyShadowMap;return o}const nB={name:"shadow",dependencies:[$D],vs:rre,fs:nre,inject:{"vs:DECKGL_FILTER_GL_POSITION":`
    position = shadow_setVertexPosition(geometry.position);
    `,"fs:DECKGL_FILTER_COLOR":`
    color = shadow_filterShadowColor(color);
    `},getUniforms:fre,uniformTypes:{drawShadowMap:"f32",useShadowMap:"f32",color:"vec4<f32>",lightId:"i32",lightCount:"f32",viewProjectionMatrix0:"mat4x4<f32>",viewProjectionMatrix1:"mat4x4<f32>",projectCenter0:"vec4<f32>",projectCenter1:"vec4<f32>"}},$H={...NN,defaultUniforms:{...NN.defaultUniforms,useFloatColors:!1},inject:{"vs:DECKGL_FILTER_GL_POSITION":`
    // for picking depth values
    picking_setPickingAttribute(position.z / position.w);
  `,"vs:DECKGL_FILTER_COLOR":`
  picking_setPickingColor(geometry.pickingColor);
  `,"fs:DECKGL_FILTER_COLOR":{order:99,injection:`
  // use highlight color if this fragment belongs to the selected object.
  color = picking_filterHighlightColor(color);

  // use picking color if rendering to picking FBO.
  color = picking_filterPickingColor(color);
    `}}},dre=[IH],pre=["vs:DECKGL_FILTER_SIZE(inout vec3 size, VertexGeometry geometry)","vs:DECKGL_FILTER_GL_POSITION(inout vec4 position, VertexGeometry geometry)","vs:DECKGL_FILTER_COLOR(inout vec4 color, VertexGeometry geometry)","fs:DECKGL_FILTER_COLOR(inout vec4 color, FragmentGeometry geometry)"],gre=[];function vre(r){const e=zm.getDefaultShaderAssembler();for(const i of dre)e.addDefaultModule(i);e._hookFunctions.length=0;const t=r==="glsl"?pre:gre;for(const i of t)e.addShaderHook(i);return e}const mre=[255,255,255],yre=1;let _re=0;class bre{constructor(e={}){this.type="ambient";const{color:t=mre}=e,{intensity:i=yre}=e;this.id=e.id||`ambient-${_re++}`,this.color=t,this.intensity=i}}const xre=[255,255,255],wre=1,Sre=[0,0,-1];let Tre=0;class aB{constructor(e={}){this.type="directional";const{color:t=xre}=e,{intensity:i=wre}=e,{direction:n=Sre}=e,{_shadow:a=!1}=e;this.id=e.id||`directional-${Tre++}`,this.color=t,this.intensity=i,this.type="directional",this.direction=new Vf(n).normalize().toArray(),this.shadow=a}getProjectedLight(e){return this}}class Are{constructor(e,t={id:"pass"}){const{id:i}=t;this.id=i,this.device=e,this.props={...t}}setProps(e){Object.assign(this.props,e)}render(e){}cleanup(){}}class ZD extends Are{constructor(){super(...arguments),this._lastRenderIndex=-1}render(e){const[t,i]=this.device.canvasContext.getDrawingBufferSize(),n=e.clearCanvas??!0,a=e.clearColor??(n?[0,0,0,0]:!1),s=n?1:!1,o=n?0:!1,l=e.colorMask??15,c={viewport:[0,0,t,i]};e.colorMask&&(c.colorMask=l),e.scissorRect&&(c.scissorRect=e.scissorRect);const f=this.device.beginRenderPass({framebuffer:e.target,parameters:c,clearColor:a,clearDepth:s,clearStencil:o});try{return this._drawLayers(f,e)}finally{f.end(),this.device.submit()}}_drawLayers(e,t){const{target:i,shaderModuleProps:n,viewports:a,views:s,onViewportActive:o,clearStack:l=!0}=t;t.pass=t.pass||"unknown",l&&(this._lastRenderIndex=-1);const c=[];for(const f of a){const p=s&&s[f.id];o?.(f);const y=this._getDrawLayerParams(f,t),b=f.subViewports||[f];for(const S of b){const C=this._drawLayersInViewport(e,{target:i,shaderModuleProps:n,viewport:S,view:p,pass:t.pass,layers:t.layers},y);c.push(C)}}return c}_getDrawLayerParams(e,{layers:t,pass:i,isPicking:n=!1,layerFilter:a,cullRect:s,effects:o,shaderModuleProps:l},c=!1){const f=[],p=WH(this._lastRenderIndex+1),y={layer:t[0],viewport:e,isPicking:n,renderPass:i,cullRect:s},b={};for(let S=0;S<t.length;S++){const C=t[S],E=this._shouldDrawLayer(C,y,a,b),P={shouldDrawLayer:E};E&&!c&&(P.shouldDrawLayer=!0,P.layerRenderIndex=p(C,E),P.shaderModuleProps=this._getShaderModuleProps(C,o,i,l),P.layerParameters={...C.context.deck?.props.parameters,...this.getLayerParameters(C,S,e)}),f[S]=P}return f}_drawLayersInViewport(e,{layers:t,shaderModuleProps:i,pass:n,target:a,viewport:s,view:o},l){const c=Cre(this.device,{shaderModuleProps:i,target:a,viewport:s});if(o){const{clear:p,clearColor:y,clearDepth:b,clearStencil:S}=o.props;if(p){let C=[0,0,0,0],E=1,P=0;Array.isArray(y)?C=[...y.slice(0,3),y[3]||255].map(B=>B/255):y===!1&&(C=!1),b!==void 0&&(E=b),S!==void 0&&(P=S),this.device.beginRenderPass({framebuffer:a,parameters:{viewport:c,scissorRect:c},clearColor:C,clearDepth:E,clearStencil:P}).end()}}const f={totalCount:t.length,visibleCount:0,compositeCount:0,pickableCount:0};e.setParameters({viewport:c});for(let p=0;p<t.length;p++){const y=t[p],b=l[p],{shouldDrawLayer:S}=b;if(S&&y.props.pickable&&f.pickableCount++,y.isComposite&&f.compositeCount++,y.isDrawable&&b.shouldDrawLayer){const{layerRenderIndex:C,shaderModuleProps:E,layerParameters:P}=b;f.visibleCount++,this._lastRenderIndex=Math.max(this._lastRenderIndex,C),E.project&&(E.project.viewport=s),y.context.renderPass=e;try{y._drawLayer({renderPass:e,shaderModuleProps:E,uniforms:{layerIndex:C},parameters:P})}catch(O){y.raiseError(O,`drawing ${y} to ${n}`)}}}return f}shouldDrawLayer(e){return!0}getShaderModuleProps(e,t,i){return null}getLayerParameters(e,t,i){return e.props.parameters}_shouldDrawLayer(e,t,i,n){if(!(e.props.visible&&this.shouldDrawLayer(e)))return!1;t.layer=e;let s=e.parent;for(;s;){if(!s.props.visible||!s.filterSubLayer(t))return!1;t.layer=s,s=s.parent}if(i){const o=t.layer.id;if(o in n||(n[o]=i(t)),!n[o])return!1}return e.activateViewport(t.viewport),!0}_getShaderModuleProps(e,t,i,n){const a=this.device.canvasContext.cssToDeviceRatio(),s=e.internalState?.propsInTransition||e.props,o={layer:s,picking:{isActive:!1},project:{viewport:e.context.viewport,devicePixelRatio:a,modelMatrix:s.modelMatrix,coordinateSystem:s.coordinateSystem,coordinateOrigin:s.coordinateOrigin,autoWrapLongitude:e.wrapLongitude}};if(t)for(const l of t)oB(o,l.getShaderModuleProps?.(e,o));return oB(o,this.getShaderModuleProps(e,t,o),n)}}function WH(r=0,e={}){const t={},i=(n,a)=>{const s=n.props._offset,o=n.id,l=n.parent&&n.parent.id;let c;if(l&&!(l in e)&&i(n.parent,!1),l in t){const f=t[l]=t[l]||WH(e[l],e);c=f(n,a),t[o]=f}else Number.isFinite(s)?(c=s+(e[l]||0),t[o]=null):c=r;return a&&c>=r&&(r=c+1),e[o]=c,c};return i}function Cre(r,{shaderModuleProps:e,target:t,viewport:i}){const n=e?.project?.devicePixelRatio??r.canvasContext.cssToDeviceRatio(),[,a]=r.canvasContext.getDrawingBufferSize(),s=t?t.height:a,o=i;return[o.x*n,s-(o.y+o.height)*n,o.width*n,o.height*n]}function oB(r,...e){for(const t of e)if(t)for(const i in t)r[i]?Object.assign(r[i],t[i]):r[i]=t[i];return r}class Mre extends ZD{constructor(e,t){super(e,t);const i=e.createTexture({format:"rgba8unorm",width:1,height:1,sampler:{minFilter:"linear",magFilter:"linear",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge"}}),n=e.createTexture({format:"depth16unorm",width:1,height:1});this.fbo=e.createFramebuffer({id:"shadowmap",width:1,height:1,colorAttachments:[i],depthStencilAttachment:n})}delete(){this.fbo&&(this.fbo.destroy(),this.fbo=null)}getShadowMap(){return this.fbo.colorAttachments[0].texture}render(e){const t=this.fbo,i=this.device.canvasContext.cssToDeviceRatio(),n=e.viewports[0],a=n.width*i,s=n.height*i,o=[1,1,1,1];(a!==t.width||s!==t.height)&&t.resize({width:a,height:s}),super.render({...e,clearColor:o,target:t,pass:"shadow"})}getLayerParameters(e,t,i){return{...e.props.parameters,blend:!1,depthWriteEnabled:!0,depthCompare:"less-equal"}}shouldDrawLayer(e){return e.props.shadowEnabled!==!1}getShaderModuleProps(e,t,i){return{shadow:{project:i.project,drawToShadowMap:!0}}}}const Ere={color:[255,255,255],intensity:1},sB=[{color:[255,255,255],intensity:1,direction:[-1,3,-1]},{color:[255,255,255],intensity:.9,direction:[1,-8,-2.5]}],Ire=[0,0,0,200/255];class GH{constructor(e={}){this.id="lighting-effect",this.shadowColor=Ire,this.shadow=!1,this.directionalLights=[],this.pointLights=[],this.shadowPasses=[],this.dummyShadowMap=null,this.setProps(e)}setup(e){this.context=e;const{device:t,deck:i}=e;this.shadow&&!this.dummyShadowMap&&(this._createShadowPasses(t),i._addDefaultShaderModule(nB),this.dummyShadowMap=t.createTexture({width:1,height:1}))}setProps(e){this.ambientLight=void 0,this.directionalLights=[],this.pointLights=[];for(const t in e){const i=e[t];switch(i.type){case"ambient":this.ambientLight=i;break;case"directional":this.directionalLights.push(i);break;case"point":this.pointLights.push(i);break}}this._applyDefaultLights(),this.shadow=this.directionalLights.some(t=>t.shadow),this.context&&this.setup(this.context),this.props=e}preRender({layers:e,layerFilter:t,viewports:i,onViewportActive:n,views:a}){if(this.shadow){this.shadowMatrices=this._calculateMatrices();for(let s=0;s<this.shadowPasses.length;s++)this.shadowPasses[s].render({layers:e,layerFilter:t,viewports:i,onViewportActive:n,views:a,shaderModuleProps:{shadow:{shadowLightId:s,dummyShadowMap:this.dummyShadowMap,shadowMatrices:this.shadowMatrices}}})}}getShaderModuleProps(e,t){const i=this.shadow?{project:t.project,shadowMaps:this.shadowPasses.map(s=>s.getShadowMap()),dummyShadowMap:this.dummyShadowMap,shadowColor:this.shadowColor,shadowMatrices:this.shadowMatrices}:{},n={enabled:!0,ambientLight:this.ambientLight,directionalLights:this.directionalLights.map(s=>s.getProjectedLight({layer:e})),pointLights:this.pointLights.map(s=>s.getProjectedLight({layer:e}))},a=e.props.material;return{shadow:i,lighting:n,phongMaterial:a,gouraudMaterial:a}}cleanup(e){for(const t of this.shadowPasses)t.delete();this.shadowPasses.length=0,this.dummyShadowMap&&(this.dummyShadowMap.destroy(),this.dummyShadowMap=null,e.deck._removeDefaultShaderModule(nB))}_calculateMatrices(){const e=[];for(const t of this.directionalLights){const i=new Eh().lookAt({eye:new Vf(t.direction).negate()});e.push(i)}return e}_createShadowPasses(e){for(let t=0;t<this.directionalLights.length;t++){const i=new Mre(e);this.shadowPasses[t]=i}}_applyDefaultLights(){const{ambientLight:e,pointLights:t,directionalLights:i}=this;!e&&t.length===0&&i.length===0&&(this.ambientLight=new bre(Ere),this.directionalLights.push(new aB(sB[0]),new aB(sB[1])))}}class Pre{constructor(e={}){this._pool=[],this.opts={overAlloc:2,poolSize:100},this.setOptions(e)}setOptions(e){Object.assign(this.opts,e)}allocate(e,t,{size:i=1,type:n,padding:a=0,copy:s=!1,initialize:o=!1,maxCount:l}){const c=n||e&&e.constructor||Float32Array,f=t*i+a;if(ArrayBuffer.isView(e)){if(f<=e.length)return e;if(f*e.BYTES_PER_ELEMENT<=e.buffer.byteLength)return new c(e.buffer,0,f)}let p=1/0;l&&(p=l*i+a);const y=this._allocate(c,f,o,p);return e&&s?y.set(e):o||y.fill(0,0,4),this._release(e),y}release(e){this._release(e)}_allocate(e,t,i,n){let a=Math.max(Math.ceil(t*this.opts.overAlloc),1);a>n&&(a=n);const s=this._pool,o=e.BYTES_PER_ELEMENT*a,l=s.findIndex(c=>c.byteLength>=o);if(l>=0){const c=new e(s.splice(l,1)[0],0,a);return i&&c.fill(0),c}return new e(a)}_release(e){if(!ArrayBuffer.isView(e))return;const t=this._pool,{buffer:i}=e,{byteLength:n}=i,a=t.findIndex(s=>s.byteLength>=n);a<0?t.push(i):(a>0||t.length<this.opts.poolSize)&&t.splice(a,0,i),t.length>this.opts.poolSize&&t.shift()}}const F0=new Pre;function h1(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function Rre(r,e){const t=r%e;return t<0?e+t:t}function Dre(r){return[r[12],r[13],r[14]]}function kre(r){return{left:N_(r[3]+r[0],r[7]+r[4],r[11]+r[8],r[15]+r[12]),right:N_(r[3]-r[0],r[7]-r[4],r[11]-r[8],r[15]-r[12]),bottom:N_(r[3]+r[1],r[7]+r[5],r[11]+r[9],r[15]+r[13]),top:N_(r[3]-r[1],r[7]-r[5],r[11]-r[9],r[15]-r[13]),near:N_(r[3]+r[2],r[7]+r[6],r[11]+r[10],r[15]+r[14]),far:N_(r[3]-r[2],r[7]-r[6],r[11]-r[10],r[15]-r[14])}}const lB=new Vf;function N_(r,e,t,i){lB.set(r,e,t);const n=lB.len();return{distance:i/n,normal:new Vf(-r/n,-e/n,-t/n)}}function Lre(r){return r-Math.fround(r)}let Ex;function rE(r,e){const{size:t=1,startIndex:i=0}=e,n=e.endIndex!==void 0?e.endIndex:r.length,a=(n-i)/t;Ex=F0.allocate(Ex,a,{type:Float32Array,size:t*2});let s=i,o=0;for(;s<n;){for(let l=0;l<t;l++){const c=r[s++];Ex[o+l]=c,Ex[o+l+t]=Lre(c)}o+=t*2}return Ex.subarray(0,a*t*2)}function Ore(r){let e=null,t=!1;for(const i of r)i&&(e?(t||(e=[[e[0][0],e[0][1]],[e[1][0],e[1][1]]],t=!0),e[0][0]=Math.min(e[0][0],i[0][0]),e[0][1]=Math.min(e[0][1],i[0][1]),e[1][0]=Math.max(e[1][0],i[1][0]),e[1][1]=Math.max(e[1][1],i[1][1])):e=i);return e}const Nre=Math.PI/180,Bre=h1(),uB=[0,0,0],zre={unitsPerMeter:[1,1,1],metersPerUnit:[1,1,1]};function Fre({width:r,height:e,orthographic:t,fovyRadians:i,focalDistance:n,padding:a,near:s,far:o}){const l=r/e,c=t?new Eh().orthographic({fovy:i,aspect:l,focalDistance:n,near:s,far:o}):new Eh().perspective({fovy:i,aspect:l,near:s,far:o});if(a){const{left:f=0,right:p=0,top:y=0,bottom:b=0}=a,S=kf((f+r-p)/2,0,r)-r/2,C=kf((y+e-b)/2,0,e)-e/2;c[8]-=S*2/r,c[9]+=C*2/e}return c}class rb{constructor(e={}){this._frustumPlanes={},this.id=e.id||this.constructor.displayName||"viewport",this.x=e.x||0,this.y=e.y||0,this.width=e.width||1,this.height=e.height||1,this.zoom=e.zoom||0,this.padding=e.padding,this.distanceScales=e.distanceScales||zre,this.focalDistance=e.focalDistance||1,this.position=e.position||uB,this.modelMatrix=e.modelMatrix||null;const{longitude:t,latitude:i}=e;this.isGeospatial=Number.isFinite(i)&&Number.isFinite(t),this._initProps(e),this._initMatrices(e),this.equals=this.equals.bind(this),this.project=this.project.bind(this),this.unproject=this.unproject.bind(this),this.projectPosition=this.projectPosition.bind(this),this.unprojectPosition=this.unprojectPosition.bind(this),this.projectFlat=this.projectFlat.bind(this),this.unprojectFlat=this.unprojectFlat.bind(this)}get subViewports(){return null}get metersPerPixel(){return this.distanceScales.metersPerUnit[2]/this.scale}get projectionMode(){return this.isGeospatial?this.zoom<12?mu.WEB_MERCATOR:mu.WEB_MERCATOR_AUTO_OFFSET:mu.IDENTITY}equals(e){return e instanceof rb?this===e?!0:e.width===this.width&&e.height===this.height&&e.scale===this.scale&&J1(e.projectionMatrix,this.projectionMatrix)&&J1(e.viewMatrix,this.viewMatrix):!1}project(e,{topLeft:t=!0}={}){const i=this.projectPosition(e),n=HH(i,this.pixelProjectionMatrix),[a,s]=n,o=t?s:this.height-s;return e.length===2?[a,o]:[a,o,n[2]]}unproject(e,{topLeft:t=!0,targetZ:i}={}){const[n,a,s]=e,o=t?a:this.height-a,l=i&&i*this.distanceScales.unitsPerMeter[2],c=XD([n,o,s],this.pixelUnprojectionMatrix,l),[f,p,y]=this.unprojectPosition(c);return Number.isFinite(s)?[f,p,y]:Number.isFinite(i)?[f,p,i]:[f,p]}projectPosition(e){const[t,i]=this.projectFlat(e),n=(e[2]||0)*this.distanceScales.unitsPerMeter[2];return[t,i,n]}unprojectPosition(e){const[t,i]=this.unprojectFlat(e),n=(e[2]||0)*this.distanceScales.metersPerUnit[2];return[t,i,n]}projectFlat(e){if(this.isGeospatial){const t=ew(e);return t[1]=kf(t[1],-318,830),t}return e}unprojectFlat(e){return this.isGeospatial?z0(e):e}getBounds(e={}){const t={targetZ:e.z||0},i=this.unproject([0,0],t),n=this.unproject([this.width,0],t),a=this.unproject([0,this.height],t),s=this.unproject([this.width,this.height],t);return[Math.min(i[0],n[0],a[0],s[0]),Math.min(i[1],n[1],a[1],s[1]),Math.max(i[0],n[0],a[0],s[0]),Math.max(i[1],n[1],a[1],s[1])]}getDistanceScales(e){return e&&this.isGeospatial?fR({longitude:e[0],latitude:e[1],highPrecision:!0}):this.distanceScales}containsPixel({x:e,y:t,width:i=1,height:n=1}){return e<this.x+this.width&&this.x<e+i&&t<this.y+this.height&&this.y<t+n}getFrustumPlanes(){return this._frustumPlanes.near?this._frustumPlanes:(Object.assign(this._frustumPlanes,kre(this.viewProjectionMatrix)),this._frustumPlanes)}panByPosition(e,t){return null}_initProps(e){const t=e.longitude,i=e.latitude;this.isGeospatial&&(Number.isFinite(e.zoom)||(this.zoom=Zte({latitude:i})+Math.log2(this.focalDistance)),this.distanceScales=e.distanceScales||fR({latitude:i,longitude:t}));const n=Math.pow(2,this.zoom);this.scale=n;const{position:a,modelMatrix:s}=e;let o=uB;if(a&&(o=s?new Eh(s).transformAsVector(a,[]):a),this.isGeospatial){const l=this.projectPosition([t,i,0]);this.center=new Vf(o).scale(this.distanceScales.unitsPerMeter).add(l)}else this.center=this.projectPosition(o)}_initMatrices(e){const{viewMatrix:t=Bre,projectionMatrix:i=null,orthographic:n=!1,fovyRadians:a,fovy:s=75,near:o=.1,far:l=1e3,padding:c=null,focalDistance:f=1}=e;this.viewMatrixUncentered=t,this.viewMatrix=new Eh().multiplyRight(t).translate(new Vf(this.center).negate()),this.projectionMatrix=i||Fre({width:this.width,height:this.height,orthographic:n,fovyRadians:a||s*Nre,focalDistance:f,padding:c,near:o,far:l});const p=h1();Km(p,p,this.projectionMatrix),Km(p,p,this.viewMatrix),this.viewProjectionMatrix=p,this.viewMatrixInverse=iR([],this.viewMatrix)||this.viewMatrix,this.cameraPosition=Dre(this.viewMatrixInverse);const y=h1(),b=h1();jD(y,y,[this.width/2,-this.height/2,1]),lA(y,y,[1,-1,0]),Km(b,y,this.viewProjectionMatrix),this.pixelProjectionMatrix=b,this.pixelUnprojectionMatrix=iR(h1(),this.pixelProjectionMatrix),this.pixelUnprojectionMatrix||Tn.warn("Pixel project matrix not invertible")()}}rb.displayName="Viewport";class dy extends rb{constructor(e={}){const{latitude:t=0,longitude:i=0,zoom:n=0,pitch:a=0,bearing:s=0,nearZMultiplier:o=.1,farZMultiplier:l=1.01,nearZ:c,farZ:f,orthographic:p=!1,projectionMatrix:y,repeat:b=!1,worldOffset:S=0,position:C,padding:E,legacyMeterSizes:P=!1}=e;let{width:O,height:B,altitude:F=1.5}=e;const W=Math.pow(2,n);O=O||1,B=B||1;let $,q=null;if(y)F=y[5]/2,$=tw(F);else{e.fovy?($=e.fovy,F=GD($)):$=tw(F);let ee;if(E){const{top:te=0,bottom:ae=0}=E;ee=[0,kf((te+B-ae)/2,0,B)-B/2]}q=Yte({width:O,height:B,scale:W,center:C&&[0,0,C[2]*A2(t)],offset:ee,pitch:a,fovy:$,nearZMultiplier:o,farZMultiplier:l}),Number.isFinite(c)&&(q.near=c),Number.isFinite(f)&&(q.far=f)}let Q=qte({height:B,pitch:a,bearing:s,scale:W,altitude:F});S&&(Q=new Eh().translate([512*S,0,0]).multiplyLeft(Q)),super({...e,width:O,height:B,viewMatrix:Q,longitude:i,latitude:t,zoom:n,...q,fovy:$,focalDistance:F}),this.latitude=t,this.longitude=i,this.zoom=n,this.pitch=a,this.bearing=s,this.altitude=F,this.fovy=$,this.orthographic=p,this._subViewports=b?[]:null,this._pseudoMeters=P,Object.freeze(this)}get subViewports(){if(this._subViewports&&!this._subViewports.length){const e=this.getBounds(),t=Math.floor((e[0]+180)/360),i=Math.ceil((e[2]-180)/360);for(let n=t;n<=i;n++){const a=n?new dy({...this,worldOffset:n}):this;this._subViewports.push(a)}}return this._subViewports}projectPosition(e){if(this._pseudoMeters)return super.projectPosition(e);const[t,i]=this.projectFlat(e),n=(e[2]||0)*A2(e[1]);return[t,i,n]}unprojectPosition(e){if(this._pseudoMeters)return super.unprojectPosition(e);const[t,i]=this.unprojectFlat(e),n=(e[2]||0)/A2(i);return[t,i,n]}addMetersToLngLat(e,t){return UH(e,t)}panByPosition(e,t){const i=XD(t,this.pixelUnprojectionMatrix),n=this.projectFlat(e),a=LN([],n,EJ([],i)),s=LN([],this.center,a),[o,l]=this.unprojectFlat(s);return{longitude:o,latitude:l}}getBounds(e={}){const t=Jte(this,e.z||0);return[Math.min(t[0][0],t[1][0],t[2][0],t[3][0]),Math.min(t[0][1],t[1][1],t[2][1],t[3][1]),Math.max(t[0][0],t[1][0],t[2][0],t[3][0]),Math.max(t[0][1],t[1][1],t[2][1],t[3][1])]}fitBounds(e,t={}){const{width:i,height:n}=this,{longitude:a,latitude:s,zoom:o}=Kte({width:i,height:n,bounds:e,...t});return new dy({width:i,height:n,longitude:a,latitude:s,zoom:o})}}dy.displayName="WebMercatorViewport";const cB=[0,0,0];function iE(r,e,t=!1){const i=e.projectPosition(r);if(t&&e instanceof dy){const[n,a,s=0]=r,o=e.getDistanceScales([n,a]);i[2]=s*o.unitsPerMeter[2]}return i}function Vre(r){const{viewport:e,modelMatrix:t,coordinateOrigin:i}=r;let{coordinateSystem:n,fromCoordinateSystem:a,fromCoordinateOrigin:s}=r;return n===rn.DEFAULT&&(n=e.isGeospatial?rn.LNGLAT:rn.CARTESIAN),a===void 0&&(a=n),s===void 0&&(s=i),{viewport:e,coordinateSystem:n,coordinateOrigin:i,modelMatrix:t,fromCoordinateSystem:a,fromCoordinateOrigin:s}}function XH(r,{viewport:e,modelMatrix:t,coordinateSystem:i,coordinateOrigin:n,offsetMode:a}){let[s,o,l=0]=r;switch(t&&([s,o,l]=tb([],[s,o,l,1],t)),i){case rn.LNGLAT:return iE([s,o,l],e,a);case rn.LNGLAT_OFFSETS:return iE([s+n[0],o+n[1],l+(n[2]||0)],e,a);case rn.METER_OFFSETS:return iE(UH(n,[s,o,l]),e,a);case rn.CARTESIAN:default:return e.isGeospatial?[s+n[0],o+n[1],l+n[2]]:e.projectPosition([s,o,l])}}function Ure(r,e){const{viewport:t,coordinateSystem:i,coordinateOrigin:n,modelMatrix:a,fromCoordinateSystem:s,fromCoordinateOrigin:o}=Vre(e),{autoOffset:l=!0}=e,{geospatialOrigin:c=cB,shaderCoordinateOrigin:f=cB,offsetMode:p=!1}=l?zH(t,i,n):{},y=XH(r,{viewport:t,modelMatrix:a,coordinateSystem:s,coordinateOrigin:o,offsetMode:p});if(p){const b=t.projectPosition(c||f);SH(y,y,b)}return y}let Hre=1,jre=1;class ZH{time=0;channels=new Map;animations=new Map;playing=!1;lastEngineTime=-1;constructor(){}addChannel(e){const{delay:t=0,duration:i=Number.POSITIVE_INFINITY,rate:n=1,repeat:a=1}=e,s=Hre++,o={time:0,delay:t,duration:i,rate:n,repeat:a};return this._setChannelTime(o,this.time),this.channels.set(s,o),s}removeChannel(e){this.channels.delete(e);for(const[t,i]of this.animations)i.channel===e&&this.detachAnimation(t)}isFinished(e){const t=this.channels.get(e);return t===void 0?!1:this.time>=t.delay+t.duration*t.repeat}getTime(e){if(e===void 0)return this.time;const t=this.channels.get(e);return t===void 0?-1:t.time}setTime(e){this.time=Math.max(0,e);const t=this.channels.values();for(const n of t)this._setChannelTime(n,this.time);const i=this.animations.values();for(const n of i){const{animation:a,channel:s}=n;a.setTime(this.getTime(s))}}play(){this.playing=!0}pause(){this.playing=!1,this.lastEngineTime=-1}reset(){this.setTime(0)}attachAnimation(e,t){const i=jre++;return this.animations.set(i,{animation:e,channel:t}),e.setTime(this.getTime(t)),i}detachAnimation(e){this.animations.delete(e)}update(e){this.playing&&(this.lastEngineTime===-1&&(this.lastEngineTime=e),this.setTime(this.time+(e-this.lastEngineTime)),this.lastEngineTime=e)}_setChannelTime(e,t){const i=t-e.delay,n=e.duration*e.repeat;i>=n?e.time=e.duration*e.rate:(e.time=Math.max(0,i)%e.duration,e.time*=e.rate)}}function $re(r){return typeof window<"u"&&window.requestAnimationFrame?window.requestAnimationFrame(r):setTimeout(r,1e3/60)}function Wre(r){return typeof window<"u"&&window.cancelAnimationFrame?window.cancelAnimationFrame(r):clearTimeout(r)}let Gre=0;class qD{static defaultAnimationLoopProps={device:null,onAddHTML:()=>"",onInitialize:async()=>null,onRender:()=>{},onFinalize:()=>{},onError:e=>console.error(e),stats:JP.stats.get(`animation-loop-${Gre++}`),autoResizeViewport:!1};device=null;canvas=null;props;animationProps=null;timeline=null;stats;cpuTime;gpuTime;frameRate;display;needsRedraw="initialized";_initialized=!1;_running=!1;_animationFrameId=null;_nextFramePromise=null;_resolveNextFrame=null;_cpuStartTime=0;_error=null;constructor(e){if(this.props={...qD.defaultAnimationLoopProps,...e},e=this.props,!e.device)throw new Error("No device provided");this.stats=e.stats||new fC({id:"animation-loop-stats"}),this.cpuTime=this.stats.get("CPU Time"),this.gpuTime=this.stats.get("GPU Time"),this.frameRate=this.stats.get("Frame Rate"),this.setProps({autoResizeViewport:e.autoResizeViewport}),this.start=this.start.bind(this),this.stop=this.stop.bind(this),this._onMousemove=this._onMousemove.bind(this),this._onMouseleave=this._onMouseleave.bind(this)}destroy(){this.stop(),this._setDisplay(null)}delete(){this.destroy()}reportError(e){this.props.onError(e),this._error=e}setNeedsRedraw(e){return this.needsRedraw=this.needsRedraw||e,this}setProps(e){return"autoResizeViewport"in e&&(this.props.autoResizeViewport=e.autoResizeViewport||!1),this}async start(){if(this._running)return this;this._running=!0;try{let e;return this._initialized||(this._initialized=!0,await this._initDevice(),this._initialize(),await this.props.onInitialize(this._getAnimationProps())),this._running?(e!==!1&&(this._cancelAnimationFrame(),this._requestAnimationFrame()),this):null}catch(e){const t=e instanceof Error?e:new Error("Unknown error");throw this.props.onError(t),t}}stop(){return this._running&&(this.animationProps&&!this._error&&this.props.onFinalize(this.animationProps),this._cancelAnimationFrame(),this._nextFramePromise=null,this._resolveNextFrame=null,this._running=!1),this}redraw(){return this.device?.isLost||this._error?this:(this._beginFrameTimers(),this._setupFrame(),this._updateAnimationProps(),this._renderFrame(this._getAnimationProps()),this._clearNeedsRedraw(),this._resolveNextFrame&&(this._resolveNextFrame(this),this._nextFramePromise=null,this._resolveNextFrame=null),this._endFrameTimers(),this)}attachTimeline(e){return this.timeline=e,this.timeline}detachTimeline(){this.timeline=null}waitForRender(){return this.setNeedsRedraw("waitForRender"),this._nextFramePromise||(this._nextFramePromise=new Promise(e=>{this._resolveNextFrame=e})),this._nextFramePromise}async toDataURL(){if(this.setNeedsRedraw("toDataURL"),await this.waitForRender(),this.canvas instanceof HTMLCanvasElement)return this.canvas.toDataURL();throw new Error("OffscreenCanvas")}_initialize(){this._startEventHandling(),this._initializeAnimationProps(),this._updateAnimationProps(),this._resizeViewport()}_setDisplay(e){this.display&&(this.display.destroy(),this.display.animationLoop=null),e&&(e.animationLoop=this),this.display=e}_requestAnimationFrame(){this._running&&(this._animationFrameId=$re(this._animationFrame.bind(this)))}_cancelAnimationFrame(){this._animationFrameId!==null&&(Wre(this._animationFrameId),this._animationFrameId=null)}_animationFrame(){this._running&&(this.redraw(),this._requestAnimationFrame())}_renderFrame(e){if(this.display){this.display._renderFrame(e);return}this.props.onRender(this._getAnimationProps()),this.device?.submit()}_clearNeedsRedraw(){this.needsRedraw=!1}_setupFrame(){this._resizeViewport()}_initializeAnimationProps(){const e=this.device?.getDefaultCanvasContext();if(!this.device||!e)throw new Error("loop");const t=e?.canvas,i=e.props.useDevicePixels;this.animationProps={animationLoop:this,device:this.device,canvasContext:e,canvas:t,useDevicePixels:i,timeline:this.timeline,needsRedraw:!1,width:1,height:1,aspect:1,time:0,startTime:Date.now(),engineTime:0,tick:0,tock:0,_mousePosition:null}}_getAnimationProps(){if(!this.animationProps)throw new Error("animationProps");return this.animationProps}_updateAnimationProps(){if(!this.animationProps)return;const{width:e,height:t,aspect:i}=this._getSizeAndAspect();(e!==this.animationProps.width||t!==this.animationProps.height)&&this.setNeedsRedraw("drawing buffer resized"),i!==this.animationProps.aspect&&this.setNeedsRedraw("drawing buffer aspect changed"),this.animationProps.width=e,this.animationProps.height=t,this.animationProps.aspect=i,this.animationProps.needsRedraw=this.needsRedraw,this.animationProps.engineTime=Date.now()-this.animationProps.startTime,this.timeline&&this.timeline.update(this.animationProps.engineTime),this.animationProps.tick=Math.floor(this.animationProps.time/1e3*60),this.animationProps.tock++,this.animationProps.time=this.timeline?this.timeline.getTime():this.animationProps.engineTime}async _initDevice(){if(this.device=await this.props.device,!this.device)throw new Error("No device provided");this.canvas=this.device.getDefaultCanvasContext().canvas||null}_createInfoDiv(){if(this.canvas&&this.props.onAddHTML){const e=document.createElement("div");document.body.appendChild(e),e.style.position="relative";const t=document.createElement("div");t.style.position="absolute",t.style.left="10px",t.style.bottom="10px",t.style.width="300px",t.style.background="white",this.canvas instanceof HTMLCanvasElement&&e.appendChild(this.canvas),e.appendChild(t);const i=this.props.onAddHTML(t);i&&(t.innerHTML=i)}}_getSizeAndAspect(){if(!this.device)return{width:1,height:1,aspect:1};const[e,t]=this.device?.getDefaultCanvasContext().getDevicePixelSize()||[1,1];let i=1;const n=this.device?.getDefaultCanvasContext().canvas;return n&&n.clientHeight?i=n.clientWidth/n.clientHeight:e>0&&t>0&&(i=e/t),{width:e,height:t,aspect:i}}_resizeViewport(){this.props.autoResizeViewport&&this.device.gl&&this.device.gl.viewport(0,0,this.device.gl.drawingBufferWidth,this.device.gl.drawingBufferHeight)}_beginFrameTimers(){this.frameRate.timeEnd(),this.frameRate.timeStart(),this.cpuTime.timeStart()}_endFrameTimers(){this.cpuTime.timeEnd()}_startEventHandling(){this.canvas&&(this.canvas.addEventListener("mousemove",this._onMousemove.bind(this)),this.canvas.addEventListener("mouseleave",this._onMouseleave.bind(this)))}_onMousemove(e){e instanceof MouseEvent&&(this._getAnimationProps()._mousePosition=[e.offsetX,e.offsetY])}_onMouseleave(e){this._getAnimationProps()._mousePosition=null}}const nE={};function Vw(r="id"){nE[r]=nE[r]||1;const e=nE[r]++;return`${r}-${e}`}class hB{id;userData={};topology;bufferLayout=[];vertexCount;indices;attributes;constructor(e){if(this.id=e.id||Vw("geometry"),this.topology=e.topology,this.indices=e.indices||null,this.attributes=e.attributes,this.vertexCount=e.vertexCount,this.bufferLayout=e.bufferLayout||[],this.indices&&!(this.indices.usage&ua.INDEX))throw new Error("Index buffer must have INDEX usage")}destroy(){this.indices?.destroy();for(const e of Object.values(this.attributes))e.destroy()}getVertexCount(){return this.vertexCount}getAttributes(){return this.attributes}getIndexes(){return this.indices||null}_calculateVertexCount(e){return e.byteLength/12}}function Xre(r,e){if(e instanceof hB)return e;const t=Zre(r,e),{attributes:i,bufferLayout:n}=qre(r,e);return new hB({topology:e.topology||"triangle-list",bufferLayout:n,vertexCount:e.vertexCount,indices:t,attributes:i})}function Zre(r,e){if(!e.indices)return;const t=e.indices.value;return r.createBuffer({usage:ua.INDEX,data:t})}function qre(r,e){const t=[],i={};for(const[a,s]of Object.entries(e.attributes)){let o=a;switch(a){case"POSITION":o="positions";break;case"NORMAL":o="normals";break;case"TEXCOORD_0":o="texCoords";break;case"COLOR_0":o="colors";break}if(s){i[o]=r.createBuffer({data:s.value,id:`${a}-buffer`});const{value:l,size:c,normalized:f}=s;t.push({name:o,format:$K(l,c,f)})}}const n=e._calculateVertexCount(e.attributes,e.indices);return{attributes:i,bufferLayout:t,vertexCount:n}}class YD{static defaultProps={...Ym.defaultProps};static getDefaultPipelineFactory(e){return e._lumaData.defaultPipelineFactory=e._lumaData.defaultPipelineFactory||new YD(e),e._lumaData.defaultPipelineFactory}device;cachingEnabled;destroyPolicy;debug;_hashCounter=0;_hashes={};_renderPipelineCache={};_computePipelineCache={};get[Symbol.toStringTag](){return"PipelineFactory"}toString(){return`PipelineFactory(${this.device.id})`}constructor(e){this.device=e,this.cachingEnabled=e.props._cachePipelines,this.destroyPolicy=e.props._cacheDestroyPolicy,this.debug=e.props.debugFactories}createRenderPipeline(e){if(!this.cachingEnabled)return this.device.createRenderPipeline(e);const t={...Ym.defaultProps,...e},i=this._renderPipelineCache,n=this._hashRenderPipeline(t);let a=i[n]?.pipeline;return a?(i[n].useCount++,this.debug&&Nt.warn(`${this}: ${i[n].pipeline} reused, count=${i[n].useCount}, (id=${e.id})`)()):(a=this.device.createRenderPipeline({...t,id:t.id?`${t.id}-cached`:Vw("unnamed-cached")}),a.hash=n,i[n]={pipeline:a,useCount:1},this.debug&&Nt.warn(`${this}: ${a} created, count=${i[n].useCount}`)()),a}createComputePipeline(e){if(!this.cachingEnabled)return this.device.createComputePipeline(e);const t={...eA.defaultProps,...e},i=this._computePipelineCache,n=this._hashComputePipeline(t);let a=i[n]?.pipeline;return a?(i[n].useCount++,this.debug&&Nt.warn(`${this}: ${i[n].pipeline} reused, count=${i[n].useCount}, (id=${e.id})`)()):(a=this.device.createComputePipeline({...t,id:t.id?`${t.id}-cached`:void 0}),a.hash=n,i[n]={pipeline:a,useCount:1},this.debug&&Nt.warn(`${this}: ${a} created, count=${i[n].useCount}`)()),a}release(e){if(!this.cachingEnabled){e.destroy();return}const t=this._getCache(e),i=e.hash;t[i].useCount--,t[i].useCount===0?(this._destroyPipeline(e),this.debug&&Nt.warn(`${this}: ${e} released and destroyed`)()):t[i].useCount<0?(Nt.error(`${this}: ${e} released, useCount < 0, resetting`)(),t[i].useCount=0):this.debug&&Nt.warn(`${this}: ${e} released, count=${t[i].useCount}`)()}_destroyPipeline(e){const t=this._getCache(e);switch(this.destroyPolicy){case"never":return!1;case"unused":return delete t[e.hash],e.destroy(),!0}}_getCache(e){let t;if(e instanceof eA&&(t=this._computePipelineCache),e instanceof Ym&&(t=this._renderPipelineCache),!t)throw new Error(`${this}`);if(!t[e.hash])throw new Error(`${this}: ${e} matched incorrect entry`);return t}_hashComputePipeline(e){const{type:t}=this.device,i=this._getHash(e.shader.source);return`${t}/C/${i}`}_hashRenderPipeline(e){const t=e.vs?this._getHash(e.vs.source):0,i=e.fs?this._getHash(e.fs.source):0,n="-",a=this._getHash(JSON.stringify(e.bufferLayout)),{type:s}=this.device;switch(s){case"webgl":return`${s}/R/${t}/${i}V${n}BL${a}`;case"webgpu":default:const o=this._getHash(JSON.stringify(e.parameters));return`${s}/R/${t}/${i}V${n}T${e.topology}P${o}BL${a}`}}_getHash(e){return this._hashes[e]===void 0&&(this._hashes[e]=this._hashCounter++),this._hashes[e]}}class KD{static defaultProps={...vC.defaultProps};static getDefaultShaderFactory(e){return e._lumaData.defaultShaderFactory||=new KD(e),e._lumaData.defaultShaderFactory}device;cachingEnabled;destroyPolicy;debug;_cache={};get[Symbol.toStringTag](){return"ShaderFactory"}toString(){return`${this[Symbol.toStringTag]}(${this.device.id})`}constructor(e){this.device=e,this.cachingEnabled=e.props._cacheShaders,this.destroyPolicy=e.props._cacheDestroyPolicy,this.debug=!0}createShader(e){if(!this.cachingEnabled)return this.device.createShader(e);const t=this._hashShader(e);let i=this._cache[t];if(i)i.useCount++,this.debug&&Nt.warn(`${this}: Reusing shader ${i.shader.id} count=${i.useCount}`)();else{const n=this.device.createShader({...e,id:e.id?`${e.id}-cached`:void 0});this._cache[t]=i={shader:n,useCount:1},this.debug&&Nt.warn(`${this}: Created new shader ${n.id}`)()}return i.shader}release(e){if(!this.cachingEnabled){e.destroy();return}const t=this._hashShader(e),i=this._cache[t];if(i)if(i.useCount--,i.useCount===0)this.destroyPolicy==="unused"&&(delete this._cache[t],i.shader.destroy(),this.debug&&Nt.warn(`${this}: Releasing shader ${e.id}, destroyed`)());else{if(i.useCount<0)throw new Error(`ShaderFactory: Shader ${e.id} released too many times`);this.debug&&Nt.warn(`${this}: Releasing shader ${e.id} count=${i.useCount}`)()}}_hashShader(e){return`${e.stage}:${e.source}`}}function Yre(r,e){const t={},i="Values";if(r.attributes.length===0&&!r.varyings?.length)return{"No attributes or varyings":{[i]:"N/A"}};for(const n of r.attributes)if(n){const a=`${n.location} ${n.name}: ${n.type}`;t[`in ${a}`]={[i]:n.stepMode||"vertex"}}for(const n of r.varyings||[]){const a=`${n.location} ${n.name}`;t[`out ${a}`]={[i]:JSON.stringify(n)}}return t}let Io=null,aE=null;function Kre(r,{id:e,minimap:t,opaque:i,top:n="0",left:a="0",rgbaScale:s=1}){Io||(Io=document.createElement("canvas"),Io.id=e,Io.title=e,Io.style.zIndex="100",Io.style.position="absolute",Io.style.top=n,Io.style.left=a,Io.style.border="blue 5px solid",Io.style.transform="scaleY(-1)",document.body.appendChild(Io),aE=Io.getContext("2d")),(Io.width!==r.width||Io.height!==r.height)&&(Io.width=r.width/2,Io.height=r.height/2,Io.style.width="400px",Io.style.height="400px");const o=r.device.readPixelsToArrayWebGL(r),l=aE?.createImageData(r.width,r.height);if(l){for(let f=0;f<o.length;f+=4)l.data[0+f+0]=o[f+0]*s,l.data[0+f+1]=o[f+1]*s,l.data[0+f+2]=o[f+2]*s,l.data[0+f+3]=i?255:o[f+3]*s;aE?.putImageData(l,0,0)}}function dR(r,e,t){if(r===e)return!0;if(!t||!r||!e)return!1;if(Array.isArray(r)){if(!Array.isArray(e)||r.length!==e.length)return!1;for(let i=0;i<r.length;i++)if(!dR(r[i],e[i],t-1))return!1;return!0}if(Array.isArray(e))return!1;if(typeof r=="object"&&typeof e=="object"){const i=Object.keys(r),n=Object.keys(e);if(i.length!==n.length)return!1;for(const a of i)if(!e.hasOwnProperty(a)||!dR(r[a],e[a],t-1))return!1;return!0}return!1}class oE{bufferLayouts;constructor(e){this.bufferLayouts=e}getBufferLayout(e){return this.bufferLayouts.find(t=>t.name===e)||null}getAttributeNamesForBuffer(e){return e.attributes?e.attributes?.map(t=>t.attribute):[e.name]}mergeBufferLayouts(e,t){const i=[...e];for(const n of t){const a=i.findIndex(s=>s.name===n.name);a<0?i.push(n):i[a]=n}return i}getBufferIndex(e){const t=this.bufferLayouts.findIndex(i=>i.name===e);return t===-1&&Nt.warn(`BufferLayout: Missing buffer for "${e}".`)(),t}}function Qre(r,e){const t=Object.fromEntries(r.attributes.map(n=>[n.name,n.location])),i=e.slice();return i.sort((n,a)=>{const s=n.attributes?n.attributes.map(f=>f.attribute):[n.name],o=a.attributes?a.attributes.map(f=>f.attribute):[a.name],l=Math.min(...s.map(f=>t[f])),c=Math.min(...o.map(f=>t[f]));return l-c}),i}function Jre(r){return ArrayBuffer.isView(r)&&!(r instanceof DataView)}function eie(r){return Array.isArray(r)?r.length===0||typeof r[0]=="number":!1}function tie(r){return Jre(r)||eie(r)}function rie(r){return tie(r)||typeof r=="number"||typeof r=="boolean"}function iie(r){const e={bindings:{},uniforms:{}};return Object.keys(r).forEach(t=>{const i=r[t];rie(i)?e.uniforms[t]=i:e.bindings[t]=i}),e}class nie{options={disableWarnings:!1};modules;moduleUniforms;moduleBindings;constructor(e,t){Object.assign(this.options,t);const i=AD(Object.values(e).filter(n=>n.dependencies));for(const n of i)e[n.name]=n;Nt.log(1,"Creating ShaderInputs with modules",Object.keys(e))(),this.modules=e,this.moduleUniforms={},this.moduleBindings={};for(const[n,a]of Object.entries(e))this._addModule(a),a.name&&n!==a.name&&!this.options.disableWarnings&&Nt.warn(`Module name: ${n} vs ${a.name}`)()}destroy(){}setProps(e){for(const t of Object.keys(e)){const i=t,n=e[i]||{},a=this.modules[i];if(!a){this.options.disableWarnings||Nt.warn(`Module ${t} not found`)();continue}const s=this.moduleUniforms[i],o=this.moduleBindings[i],l=a.getUniforms?.(n,s)||n,{uniforms:c,bindings:f}=iie(l);this.moduleUniforms[i]={...s,...c},this.moduleBindings[i]={...o,...f}}}getModules(){return Object.values(this.modules)}getUniformValues(){return this.moduleUniforms}getBindingValues(){const e={};for(const t of Object.values(this.moduleBindings))Object.assign(e,t);return e}getDebugTable(){const e={};for(const[t,i]of Object.entries(this.moduleUniforms))for(const[n,a]of Object.entries(i))e[`${t}.${n}`]={type:this.modules[t].uniformTypes?.[n],value:String(a)};return e}_addModule(e){const t=e.name;this.moduleUniforms[t]=e.defaultUniforms||{},this.moduleBindings[t]={}}}let aie="";async function oie(r,e){const t=new Image;return t.crossOrigin="anonymous",t.src=r.startsWith("http")?r:aie+r,await t.decode(),e?await createImageBitmap(t,e):await createImageBitmap(t)}const sie=["+X","-X","+Y","-Y","+Z","-Z"],lie=["+X","-X","+Y","-Y","+Z","-Z"];class P1{device;id;props;texture;sampler;view;ready;isReady=!1;destroyed=!1;resolveReady=()=>{};rejectReady=()=>{};get[Symbol.toStringTag](){return"AsyncTexture"}toString(){return`AsyncTexture:"${this.id}"(${this.isReady?"ready":"loading"})`}constructor(e,t){this.device=e;const i=Vw("async-texture");this.props={...P1.defaultProps,id:i,...t},this.id=this.props.id,t={...t},typeof t?.data=="string"&&t.dimension==="2d"&&(t.data=oie(t.data)),t.mipmaps&&(t.mipLevels="auto"),this.ready=new Promise((n,a)=>{this.resolveReady=()=>{this.isReady=!0,n()},this.rejectReady=a}),this.initAsync(t)}async initAsync(e){const t=e.data,i=await qH(t).then(void 0,this.rejectReady);if(this.destroyed)return;const n=this.props.width&&this.props.height?{width:this.props.width,height:this.props.height}:this.getTextureDataSize(i);if(!n)throw new Error("Texture size could not be determined");const a={...n,...e,data:void 0,mipLevels:1},s=this.device.getMipLevelCount(a.width,a.height);if(a.mipLevels=this.props.mipLevels==="auto"?s:Math.min(s,this.props.mipLevels),this.texture=this.device.createTexture(a),this.sampler=this.texture.sampler,this.view=this.texture.view,e.data)switch(this.props.dimension){case"1d":this._setTexture1DData(this.texture,i);break;case"2d":this._setTexture2DData(i);break;case"3d":this._setTexture3DData(this.texture,i);break;case"2d-array":this._setTextureArrayData(this.texture,i);break;case"cube":this._setTextureCubeData(this.texture,i);break;case"cube-array":this._setTextureCubeArrayData(this.texture,i);break}this.props.mipmaps&&this.generateMipmaps(),Nt.info(1,`${this} loaded`),this.resolveReady()}destroy(){this.texture&&(this.texture.destroy(),this.texture=null),this.destroyed=!0}generateMipmaps(){this.texture.generateMipmapsWebGL()}setSampler(e={}){this.texture.setSampler(e instanceof uy?e:this.device.createSampler(e))}resize(e){if(!this.isReady)throw new Error("Cannot resize texture before it is ready");if(e.width===this.texture.width&&e.height===this.texture.height)return!1;if(this.texture){const t=this.texture;this.texture=t.clone(e),t.destroy()}return!0}isTextureLevelData(e){const t=e?.data;return ArrayBuffer.isView(t)}getTextureDataSize(e){if(!e||ArrayBuffer.isView(e))return null;if(Array.isArray(e))return this.getTextureDataSize(e[0]);if(this.device.isExternalImage(e))return this.device.getExternalImageSize(e);if(e&&typeof e=="object"&&e.constructor===Object){const i=Object.values(e)[0];return{width:i.width,height:i.height}}throw new Error("texture size deduction failed")}getCubeFaceDepth(e){switch(e){case"+X":return 0;case"-X":return 1;case"+Y":return 2;case"-Y":return 3;case"+Z":return 4;case"-Z":return 5;default:throw new Error(e)}}setTextureData(e){}_setTexture1DData(e,t){throw new Error("setTexture1DData not supported in WebGL.")}_setTexture2DData(e,t=0){if(!this.texture)throw new Error("Texture not initialized");const i=this._normalizeTextureData(e);i.length>1&&this.props.mipmaps!==!1&&Nt.warn(`Texture ${this.id} mipmap and multiple LODs.`)();for(let n=0;n<i.length;n++){const a=i[n];this.device.isExternalImage(a)?this.texture.copyExternalImage({image:a,depth:t,mipLevel:n,flipY:!0}):this.texture.copyImageData({data:a.data,mipLevel:n})}}_setTexture3DData(e,t){if(this.texture?.props.dimension!=="3d")throw new Error(this.id);for(let i=0;i<t.length;i++)this._setTexture2DData(t[i],i)}_setTextureCubeData(e,t){if(this.texture?.props.dimension!=="cube")throw new Error(this.id);for(const[i,n]of Object.entries(t)){const a=lie.indexOf(i);this._setTexture2DData(n,a)}}_setTextureArrayData(e,t){if(this.texture?.props.dimension!=="2d-array")throw new Error(this.id);for(let i=0;i<t.length;i++)this._setTexture2DData(t[i],i)}_setTextureCubeArrayData(e,t){throw new Error("setTextureCubeArrayData not supported in WebGL2.")}_setTextureCubeFaceData(e,t,i,n=0){Array.isArray(t)&&t.length>1&&this.props.mipmaps!==!1&&Nt.warn(`${this.id} has mipmap and multiple LODs.`)();const a=sie.indexOf(i);this._setTexture2DData(t,a)}_normalizeTextureData(e){const t=this.texture;let i;return ArrayBuffer.isView(e)?i=[{data:e,width:t.width,height:t.height}]:Array.isArray(e)?i=e:i=[e],i}static defaultProps={...lo.defaultProps,data:null,mipmaps:!1}}async function qH(r){if(r=await r,Array.isArray(r))return await Promise.all(r.map(qH));if(r&&typeof r=="object"&&r.constructor===Object){const e=r,t=await Promise.all(Object.values(e)),i=Object.keys(e),n={};for(let a=0;a<i.length;a++)n[i[a]]=t[a];return n}return r}const tm=2,uie=1e4;let hA=class YH{static defaultProps={...Ym.defaultProps,source:void 0,vs:null,fs:null,id:"unnamed",handle:void 0,userData:{},defines:{},modules:[],geometry:null,indexBuffer:null,attributes:{},constantAttributes:{},varyings:[],isInstanced:void 0,instanceCount:0,vertexCount:0,shaderInputs:void 0,pipelineFactory:void 0,shaderFactory:void 0,transformFeedback:void 0,shaderAssembler:zm.getDefaultShaderAssembler(),debugShaders:void 0,disableWarnings:void 0};device;id;source;vs;fs;pipelineFactory;shaderFactory;userData={};parameters;topology;bufferLayout;isInstanced=void 0;instanceCount=0;vertexCount;indexBuffer=null;bufferAttributes={};constantAttributes={};bindings={};vertexArray;transformFeedback=null;pipeline;shaderInputs;_uniformStore;_attributeInfos={};_gpuGeometry=null;props;_pipelineNeedsUpdate="newly created";_needsRedraw="initializing";_destroyed=!1;_lastDrawTimestamp=-1;get[Symbol.toStringTag](){return"Model"}toString(){return`Model(${this.id})`}constructor(e,t){this.props={...YH.defaultProps,...t},t=this.props,this.id=t.id||Vw("model"),this.device=e,Object.assign(this.userData,t.userData);const i=Object.fromEntries(this.props.modules?.map(l=>[l.name,l])||[]),n=t.shaderInputs||new nie(i,{disableWarnings:this.props.disableWarnings});this.setShaderInputs(n);const a=hie(e),s=(this.props.modules?.length>0?this.props.modules:this.shaderInputs?.getModules())||[];if(this.device.type==="webgpu"&&this.props.source){const{source:l,getUniforms:c}=this.props.shaderAssembler.assembleWGSLShader({platformInfo:a,...this.props,modules:s});this.source=l,this._getModuleUniforms=c,this.props.shaderLayout||=yJ(this.source)}else{const{vs:l,fs:c,getUniforms:f}=this.props.shaderAssembler.assembleGLSLShaderPair({platformInfo:a,...this.props,modules:s});this.vs=l,this.fs=c,this._getModuleUniforms=f}this.vertexCount=this.props.vertexCount,this.instanceCount=this.props.instanceCount,this.topology=this.props.topology,this.bufferLayout=this.props.bufferLayout,this.parameters=this.props.parameters,t.geometry&&this.setGeometry(t.geometry),this.pipelineFactory=t.pipelineFactory||YD.getDefaultPipelineFactory(this.device),this.shaderFactory=t.shaderFactory||KD.getDefaultShaderFactory(this.device),this.pipeline=this._updatePipeline(),this.vertexArray=e.createVertexArray({shaderLayout:this.pipeline.shaderLayout,bufferLayout:this.pipeline.bufferLayout}),this._gpuGeometry&&this._setGeometryAttributes(this._gpuGeometry),"isInstanced"in t&&(this.isInstanced=t.isInstanced),t.instanceCount&&this.setInstanceCount(t.instanceCount),t.vertexCount&&this.setVertexCount(t.vertexCount),t.indexBuffer&&this.setIndexBuffer(t.indexBuffer),t.attributes&&this.setAttributes(t.attributes),t.constantAttributes&&this.setConstantAttributes(t.constantAttributes),t.bindings&&this.setBindings(t.bindings),t.transformFeedback&&(this.transformFeedback=t.transformFeedback),Object.seal(this)}destroy(){this._destroyed||(this.pipelineFactory.release(this.pipeline),this.shaderFactory.release(this.pipeline.vs),this.pipeline.fs&&this.shaderFactory.release(this.pipeline.fs),this._uniformStore.destroy(),this._gpuGeometry?.destroy(),this._destroyed=!0)}needsRedraw(){this._getBindingsUpdateTimestamp()>this._lastDrawTimestamp&&this.setNeedsRedraw("contents of bound textures or buffers updated");const e=this._needsRedraw;return this._needsRedraw=!1,e}setNeedsRedraw(e){this._needsRedraw||=e}predraw(){this.updateShaderInputs(),this.pipeline=this._updatePipeline()}draw(e){const t=this._areBindingsLoading();if(t)return Nt.info(tm,`>>> DRAWING ABORTED ${this.id}: ${t} not loaded`)(),!1;try{e.pushDebugGroup(`${this}.predraw(${e})`),this.predraw()}finally{e.popDebugGroup()}let i;try{e.pushDebugGroup(`${this}.draw(${e})`),this._logDrawCallStart(),this.pipeline=this._updatePipeline();const n=this._getBindings();this.pipeline.setBindings(n,{disableWarnings:this.props.disableWarnings});const{indexBuffer:a}=this.vertexArray,s=a?a.byteLength/(a.indexType==="uint32"?4:2):void 0;i=this.pipeline.draw({renderPass:e,vertexArray:this.vertexArray,isInstanced:this.isInstanced,vertexCount:this.vertexCount,instanceCount:this.instanceCount,indexCount:s,transformFeedback:this.transformFeedback||void 0,parameters:this.parameters,topology:this.topology})}finally{e.popDebugGroup(),this._logDrawCallEnd()}return this._logFramebuffer(e),i?(this._lastDrawTimestamp=this.device.timestamp,this._needsRedraw=!1):this._needsRedraw="waiting for resource initialization",i}setGeometry(e){this._gpuGeometry?.destroy();const t=e&&Xre(this.device,e);if(t){this.setTopology(t.topology||"triangle-list");const i=new oE(this.bufferLayout);this.bufferLayout=i.mergeBufferLayouts(t.bufferLayout,this.bufferLayout),this.vertexArray&&this._setGeometryAttributes(t)}this._gpuGeometry=t}setTopology(e){e!==this.topology&&(this.topology=e,this._setPipelineNeedsUpdate("topology"))}setBufferLayout(e){const t=new oE(this.bufferLayout);this.bufferLayout=this._gpuGeometry?t.mergeBufferLayouts(e,this._gpuGeometry.bufferLayout):e,this._setPipelineNeedsUpdate("bufferLayout"),this.pipeline=this._updatePipeline(),this.vertexArray=this.device.createVertexArray({shaderLayout:this.pipeline.shaderLayout,bufferLayout:this.pipeline.bufferLayout}),this._gpuGeometry&&this._setGeometryAttributes(this._gpuGeometry)}setParameters(e){dR(e,this.parameters,2)||(this.parameters=e,this._setPipelineNeedsUpdate("parameters"))}setInstanceCount(e){this.instanceCount=e,this.isInstanced===void 0&&e>0&&(this.isInstanced=!0),this.setNeedsRedraw("instanceCount")}setVertexCount(e){this.vertexCount=e,this.setNeedsRedraw("vertexCount")}setShaderInputs(e){this.shaderInputs=e,this._uniformStore=new UQ(this.shaderInputs.modules);for(const[t,i]of Object.entries(this.shaderInputs.modules))if(cie(i)){const n=this._uniformStore.getManagedUniformBuffer(this.device,t);this.bindings[`${t}Uniforms`]=n}this.setNeedsRedraw("shaderInputs")}updateShaderInputs(){this._uniformStore.setUniforms(this.shaderInputs.getUniformValues()),this.setBindings(this.shaderInputs.getBindingValues()),this.setNeedsRedraw("shaderInputs")}setBindings(e){Object.assign(this.bindings,e),this.setNeedsRedraw("bindings")}setTransformFeedback(e){this.transformFeedback=e,this.setNeedsRedraw("transformFeedback")}setIndexBuffer(e){this.vertexArray.setIndexBuffer(e),this.setNeedsRedraw("indexBuffer")}setAttributes(e,t){const i=t?.disableWarnings??this.props.disableWarnings;e.indices&&Nt.warn(`Model:${this.id} setAttributes() - indexBuffer should be set using setIndexBuffer()`)(),this.bufferLayout=Qre(this.pipeline.shaderLayout,this.bufferLayout);const n=new oE(this.bufferLayout);for(const[a,s]of Object.entries(e)){const o=n.getBufferLayout(a);if(!o){i||Nt.warn(`Model(${this.id}): Missing layout for buffer "${a}".`)();continue}const l=n.getAttributeNamesForBuffer(o);let c=!1;for(const f of l){const p=this._attributeInfos[f];if(p){const y=this.device.type==="webgpu"?n.getBufferIndex(p.bufferName):p.location;this.vertexArray.setBuffer(y,s),c=!0}}!c&&!i&&Nt.warn(`Model(${this.id}): Ignoring buffer "${s.id}" for unknown attribute "${a}"`)()}this.setNeedsRedraw("attributes")}setConstantAttributes(e,t){for(const[i,n]of Object.entries(e)){const a=this._attributeInfos[i];a?this.vertexArray.setConstantWebGL(a.location,n):(t?.disableWarnings??this.props.disableWarnings)||Nt.warn(`Model "${this.id}: Ignoring constant supplied for unknown attribute "${i}"`)()}this.setNeedsRedraw("constants")}_areBindingsLoading(){for(const e of Object.values(this.bindings))if(e instanceof P1&&!e.isReady)return e.id;return!1}_getBindings(){const e={};for(const[t,i]of Object.entries(this.bindings))i instanceof P1?i.isReady&&(e[t]=i.texture):e[t]=i;return e}_getBindingsUpdateTimestamp(){let e=0;for(const t of Object.values(this.bindings))t instanceof gC?e=Math.max(e,t.texture.updateTimestamp):t instanceof ua||t instanceof lo?e=Math.max(e,t.updateTimestamp):t instanceof P1?e=t.texture?Math.max(e,t.texture.updateTimestamp):1/0:t instanceof uy||(e=Math.max(e,t.buffer.updateTimestamp));return e}_setGeometryAttributes(e){const t={...e.attributes};for(const[i]of Object.entries(t))!this.pipeline.shaderLayout.attributes.find(n=>n.name===i)&&i!=="positions"&&delete t[i];this.vertexCount=e.vertexCount,this.setIndexBuffer(e.indices||null),this.setAttributes(e.attributes,{disableWarnings:!0}),this.setAttributes(t,{disableWarnings:this.props.disableWarnings}),this.setNeedsRedraw("geometry attributes")}_setPipelineNeedsUpdate(e){this._pipelineNeedsUpdate||=e,this.setNeedsRedraw(e)}_updatePipeline(){if(this._pipelineNeedsUpdate){let e=null,t=null;this.pipeline&&(Nt.log(1,`Model ${this.id}: Recreating pipeline because "${this._pipelineNeedsUpdate}".`)(),e=this.pipeline.vs,t=this.pipeline.fs),this._pipelineNeedsUpdate=!1;const i=this.shaderFactory.createShader({id:`${this.id}-vertex`,stage:"vertex",source:this.source||this.vs,debugShaders:this.props.debugShaders});let n=null;this.source?n=i:this.fs&&(n=this.shaderFactory.createShader({id:`${this.id}-fragment`,stage:"fragment",source:this.source||this.fs,debugShaders:this.props.debugShaders})),this.pipeline=this.pipelineFactory.createRenderPipeline({...this.props,bufferLayout:this.bufferLayout,topology:this.topology,parameters:this.parameters,bindings:this._getBindings(),vs:i,fs:n}),this._attributeInfos=q8(this.pipeline.shaderLayout,this.bufferLayout),e&&this.shaderFactory.release(e),t&&this.shaderFactory.release(t)}return this.pipeline}_lastLogTime=0;_logOpen=!1;_logDrawCallStart(){const e=Nt.level>3?0:uie;Nt.level<2||Date.now()-this._lastLogTime<e||(this._lastLogTime=Date.now(),this._logOpen=!0,Nt.group(tm,`>>> DRAWING MODEL ${this.id}`,{collapsed:Nt.level<=2})())}_logDrawCallEnd(){if(this._logOpen){const e=Yre(this.pipeline.shaderLayout,this.id);Nt.table(tm,e)();const t=this.shaderInputs.getDebugTable();Nt.table(tm,t)();const i=this._getAttributeDebugTable();Nt.table(tm,this._attributeInfos)(),Nt.table(tm,i)(),Nt.groupEnd(tm)(),this._logOpen=!1}}_drawCount=0;_logFramebuffer(e){const t=this.device.props.debugFramebuffers;if(this._drawCount++,!t)return;const i=e.props.framebuffer;i&&Kre(i,{id:i.id,minimap:!0})}_getAttributeDebugTable(){const e={};for(const[t,i]of Object.entries(this._attributeInfos)){const n=this.vertexArray.attributes[i.location];e[i.location]={name:t,type:i.shaderType,values:n?this._getBufferOrConstantValues(n,i.bufferDataType):"null"}}if(this.vertexArray.indexBuffer){const{indexBuffer:t}=this.vertexArray,i=t.indexType==="uint32"?new Uint32Array(t.debugData):new Uint16Array(t.debugData);e.indices={name:"indices",type:t.indexType,values:i.toString()}}return e}_getBufferOrConstantValues(e,t){const i=MD(t);return(e instanceof ua?new i(e.debugData):e).toString()}};function cie(r){return!!(r.uniformTypes&&!fie(r.uniformTypes))}function hie(r){return{type:r.type,shaderLanguage:r.info.shadingLanguage,shaderLanguageVersion:r.info.shadingLanguageVersion,gpu:r.info.gpu,features:r.features}}function fie(r){for(const e in r)return!1;return!0}class V0{device;model;transformFeedback;static defaultProps={...hA.defaultProps,outputs:void 0,feedbackBuffers:void 0};static isSupported(e){return e?.info?.type==="webgl"}constructor(e,t=V0.defaultProps){if(!V0.isSupported(e))throw new Error("BufferTransform not yet implemented on WebGPU");this.device=e,this.model=new hA(this.device,{id:t.id||"buffer-transform-model",fs:t.fs||NK(),topology:t.topology||"point-list",varyings:t.outputs||t.varyings,...t}),this.transformFeedback=this.device.createTransformFeedback({layout:this.model.pipeline.shaderLayout,buffers:t.feedbackBuffers}),this.model.setTransformFeedback(this.transformFeedback),Object.seal(this)}destroy(){this.model&&this.model.destroy()}delete(){this.destroy()}run(e){e?.inputBuffers&&this.model.setAttributes(e.inputBuffers),e?.outputBuffers&&this.transformFeedback.setBuffers(e.outputBuffers);const t=this.device.beginRenderPass(e);this.model.draw(t),t.end()}getBuffer(e){return this.transformFeedback.getBuffer(e)}readAsync(e){const t=this.getBuffer(e);if(!t)throw new Error("BufferTransform#getBuffer");if(t instanceof ua)return t.readAsync();const{buffer:i,byteOffset:n=0,byteLength:a=i.byteLength}=t;return i.readAsync(n,a)}}class KH{id;topology;vertexCount;indices;attributes;userData={};constructor(e){const{attributes:t={},indices:i=null,vertexCount:n=null}=e;this.id=e.id||Vw("geometry"),this.topology=e.topology,i&&(this.indices=ArrayBuffer.isView(i)?{value:i,size:1}:i),this.attributes={};for(const[a,s]of Object.entries(t)){const o=ArrayBuffer.isView(s)?{value:s}:s;if(!ArrayBuffer.isView(o.value))throw new Error(`${this._print(a)}: must be typed array or object with value as typed array`);if((a==="POSITION"||a==="positions")&&!o.size&&(o.size=3),a==="indices"){if(this.indices)throw new Error("Multiple indices detected");this.indices=o}else this.attributes[a]=o}this.indices&&this.indices.isIndexed!==void 0&&(this.indices=Object.assign({},this.indices),delete this.indices.isIndexed),this.vertexCount=n||this._calculateVertexCount(this.attributes,this.indices)}getVertexCount(){return this.vertexCount}getAttributes(){return this.indices?{indices:this.indices,...this.attributes}:this.attributes}_print(e){return`Geometry ${this.id} attribute ${e}`}_setAttributes(e,t){return this}_calculateVertexCount(e,t){if(t)return t.value.length;let i=1/0;for(const n of Object.values(e)){const{value:a,size:s,constant:o}=n;!o&&a&&s!==void 0&&s>=1&&(i=Math.min(i,a.length/s))}return i}}const die={blendColorOperation:"add",blendColorSrcFactor:"one",blendColorDstFactor:"zero",blendAlphaOperation:"add",blendAlphaSrcFactor:"constant",blendAlphaDstFactor:"zero"};class QH extends ZD{constructor(){super(...arguments),this._colorEncoderState=null}render(e){return"pickingFBO"in e?this._drawPickingBuffer(e):super.render(e)}_drawPickingBuffer({layers:e,layerFilter:t,views:i,viewports:n,onViewportActive:a,pickingFBO:s,deviceRect:{x:o,y:l,width:c,height:f},cullRect:p,effects:y,pass:b="picking",pickZ:S,shaderModuleProps:C}){this.pickZ=S;const E=this._resetColorEncoder(S),P=[o,l,c,f],O=super.render({target:s,layers:e,layerFilter:t,views:i,viewports:n,onViewportActive:a,cullRect:p,effects:y?.filter(F=>F.useInPicking),pass:b,isPicking:!0,shaderModuleProps:C,clearColor:[0,0,0,0],colorMask:15,scissorRect:P});return this._colorEncoderState=null,{decodePickingColor:E&&gie.bind(null,E),stats:O}}shouldDrawLayer(e){const{pickable:t,operation:i}=e.props;return t&&i.includes("draw")||i.includes("terrain")||i.includes("mask")}getShaderModuleProps(e,t,i){return{picking:{isActive:1,isAttribute:this.pickZ},lighting:{enabled:!1}}}getLayerParameters(e,t,i){const n={...e.props.parameters},{pickable:a,operation:s}=e.props;return!this._colorEncoderState||s.includes("terrain")?n.blend=!1:a&&s.includes("draw")&&(Object.assign(n,die),n.blend=!0,n.blendColor=pie(this._colorEncoderState,e,i)),n}_resetColorEncoder(e){return this._colorEncoderState=e?null:{byLayer:new Map,byAlpha:[]},this._colorEncoderState}}function pie(r,e,t){const{byLayer:i,byAlpha:n}=r;let a,s=i.get(e);return s?(s.viewports.push(t),a=s.a):(a=i.size+1,a<=255?(s={a,layer:e,viewports:[t]},i.set(e,s),n[a]=s):(Tn.warn("Too many pickable layers, only picking the first 255")(),a=0)),[0,0,0,a/255]}function gie(r,e){const t=r.byAlpha[e[3]];return t&&{pickedLayer:t.layer,pickedViewports:t.viewports,pickedObjectIndex:t.layer.decodePickingColor(e)}}const s0={NO_STATE:"Awaiting state",MATCHED:"Matched. State transferred from previous layer",INITIALIZED:"Initialized",AWAITING_GC:"Discarded. Awaiting garbage collection",AWAITING_FINALIZATION:"No longer matched. Awaiting garbage collection",FINALIZED:"Finalized! Awaiting garbage collection"},fA=Symbol.for("component"),Qm=Symbol.for("propTypes"),sE=Symbol.for("deprecatedProps"),A0=Symbol.for("asyncPropDefaults"),py=Symbol.for("asyncPropOriginal"),Tg=Symbol.for("asyncPropResolved");function U0(r,e=()=>!0){return Array.isArray(r)?JH(r,e,[]):e(r)?[r]:[]}function JH(r,e,t){let i=-1;for(;++i<r.length;){const n=r[i];Array.isArray(n)?JH(n,e,t):e(n)&&t.push(n)}return t}function vie({target:r,source:e,start:t=0,count:i=1}){const n=e.length,a=i*n;let s=0;for(let o=t;s<n;s++)r[o++]=e[s];for(;s<a;)s<a-s?(r.copyWithin(t+s,t,t+s),s*=2):(r.copyWithin(t+s,t,t+a-s),s=a);return r}class mie{constructor(e,t,i){this._loadCount=0,this._subscribers=new Set,this.id=e,this.context=i,this.setData(t)}subscribe(e){this._subscribers.add(e)}unsubscribe(e){this._subscribers.delete(e)}inUse(){return this._subscribers.size>0}delete(){}getData(){return this.isLoaded?this._error?Promise.reject(this._error):this._content:this._loader.then(()=>this.getData())}setData(e,t){if(e===this._data&&!t)return;this._data=e;const i=++this._loadCount;let n=e;typeof e=="string"&&(n=XP(e)),n instanceof Promise?(this.isLoaded=!1,this._loader=n.then(a=>{this._loadCount===i&&(this.isLoaded=!0,this._error=void 0,this._content=a)}).catch(a=>{this._loadCount===i&&(this.isLoaded=!0,this._error=a||!0)})):(this.isLoaded=!0,this._error=void 0,this._content=e);for(const a of this._subscribers)a.onChange(this.getData())}}class yie{constructor(e){this.protocol=e.protocol||"resource://",this._context={device:e.device,gl:e.device?.gl,resourceManager:this},this._resources={},this._consumers={},this._pruneRequest=null}contains(e){return e.startsWith(this.protocol)?!0:e in this._resources}add({resourceId:e,data:t,forceUpdate:i=!1,persistent:n=!0}){let a=this._resources[e];a?a.setData(t,i):(a=new mie(e,t,this._context),this._resources[e]=a),a.persistent=n}remove(e){const t=this._resources[e];t&&(t.delete(),delete this._resources[e])}unsubscribe({consumerId:e}){const t=this._consumers[e];if(t){for(const i in t){const n=t[i],a=this._resources[n.resourceId];a&&a.unsubscribe(n)}delete this._consumers[e],this.prune()}}subscribe({resourceId:e,onChange:t,consumerId:i,requestId:n="default"}){const{_resources:a,protocol:s}=this;e.startsWith(s)&&(e=e.replace(s,""),a[e]||this.add({resourceId:e,data:null,persistent:!1}));const o=a[e];if(this._track(i,n,o,t),o)return o.getData()}prune(){this._pruneRequest||(this._pruneRequest=setTimeout(()=>this._prune(),0))}finalize(){for(const e in this._resources)this._resources[e].delete()}_track(e,t,i,n){const a=this._consumers,s=a[e]=a[e]||{};let o=s[t];const l=o&&o.resourceId&&this._resources[o.resourceId];l&&(l.unsubscribe(o),this.prune()),i&&(o?(o.onChange=n,o.resourceId=i.id):o={onChange:n,resourceId:i.id},s[t]=o,i.subscribe(o))}_prune(){this._pruneRequest=null;for(const e of Object.keys(this._resources)){const t=this._resources[e];!t.persistent&&!t.inUse()&&(t.delete(),delete this._resources[e])}}}const _ie="layerManager.setLayers",bie="layerManager.activateViewport";class xie{constructor(e,t){this._lastRenderedLayers=[],this._needsRedraw=!1,this._needsUpdate=!1,this._nextLayers=null,this._debug=!1,this._defaultShaderModulesChanged=!1,this.activateViewport=o=>{nl(bie,this,o),o&&(this.context.viewport=o)};const{deck:i,stats:n,viewport:a,timeline:s}=t||{};this.layers=[],this.resourceManager=new yie({device:e,protocol:"deck://"}),this.context={mousePosition:null,userData:{},layerManager:this,device:e,gl:e?.gl,deck:i,shaderAssembler:vre(e?.info?.shadingLanguage||"glsl"),defaultShaderModules:[Tee],renderPass:void 0,stats:n||new fC({id:"deck.gl"}),viewport:a||new rb({id:"DEFAULT-INITIAL-VIEWPORT"}),timeline:s||new ZH,resourceManager:this.resourceManager,onError:void 0},Object.seal(this)}finalize(){this.resourceManager.finalize();for(const e of this.layers)this._finalizeLayer(e)}needsRedraw(e={clearRedrawFlags:!1}){let t=this._needsRedraw;e.clearRedrawFlags&&(this._needsRedraw=!1);for(const i of this.layers){const n=i.getNeedsRedraw(e);t=t||n}return t}needsUpdate(){return this._nextLayers&&this._nextLayers!==this._lastRenderedLayers?"layers changed":this._defaultShaderModulesChanged?"shader modules changed":this._needsUpdate}setNeedsRedraw(e){this._needsRedraw=this._needsRedraw||e}setNeedsUpdate(e){this._needsUpdate=this._needsUpdate||e}getLayers({layerIds:e}={}){return e?this.layers.filter(t=>e.find(i=>t.id.indexOf(i)===0)):this.layers}setProps(e){"debug"in e&&(this._debug=e.debug),"userData"in e&&(this.context.userData=e.userData),"layers"in e&&(this._nextLayers=e.layers),"onError"in e&&(this.context.onError=e.onError)}setLayers(e,t){nl(_ie,this,t,e),this._lastRenderedLayers=e;const i=U0(e,Boolean);for(const n of i)n.context=this.context;this._updateLayers(this.layers,i)}updateLayers(){const e=this.needsUpdate();e&&(this.setNeedsRedraw(`updating layers: ${e}`),this.setLayers(this._nextLayers||this._lastRenderedLayers,e)),this._nextLayers=null}addDefaultShaderModule(e){const{defaultShaderModules:t}=this.context;t.find(i=>i.name===e.name)||(t.push(e),this._defaultShaderModulesChanged=!0)}removeDefaultShaderModule(e){const{defaultShaderModules:t}=this.context,i=t.findIndex(n=>n.name===e.name);i>=0&&(t.splice(i,1),this._defaultShaderModulesChanged=!0)}_handleError(e,t,i){i.raiseError(t,`${e} of ${i}`)}_updateLayers(e,t){const i={};for(const s of e)i[s.id]?Tn.warn(`Multiple old layers with same id ${s.id}`)():i[s.id]=s;if(this._defaultShaderModulesChanged){for(const s of e)s.setNeedsUpdate(),s.setChangeFlags({extensionsChanged:!0});this._defaultShaderModulesChanged=!1}const n=[];this._updateSublayersRecursively(t,i,n),this._finalizeOldLayers(i);let a=!1;for(const s of n)if(s.hasUniformTransition()){a=`Uniform transition in ${s}`;break}this._needsUpdate=a,this.layers=n}_updateSublayersRecursively(e,t,i){for(const n of e){n.context=this.context;const a=t[n.id];a===null&&Tn.warn(`Multiple new layers with same id ${n.id}`)(),t[n.id]=null;let s=null;try{this._debug&&a!==n&&n.validateProps(),a?(this._transferLayerState(a,n),this._updateLayer(n)):this._initializeLayer(n),i.push(n),s=n.isComposite?n.getSubLayers():null}catch(o){this._handleError("matching",o,n)}s&&this._updateSublayersRecursively(s,t,i)}}_finalizeOldLayers(e){for(const t in e){const i=e[t];i&&this._finalizeLayer(i)}}_initializeLayer(e){try{e._initialize(),e.lifecycle=s0.INITIALIZED}catch(t){this._handleError("initialization",t,e)}}_transferLayerState(e,t){t._transferState(e),t.lifecycle=s0.MATCHED,t!==e&&(e.lifecycle=s0.AWAITING_GC)}_updateLayer(e){try{e._update()}catch(t){this._handleError("update",t,e)}}_finalizeLayer(e){this._needsRedraw=this._needsRedraw||`finalized ${e}`,e.lifecycle=s0.AWAITING_FINALIZATION;try{e._finalize(),e.lifecycle=s0.FINALIZED}catch(t){this._handleError("finalization",t,e)}}}function vc(r,e,t){if(r===e)return!0;if(!t||!r||!e)return!1;if(Array.isArray(r)){if(!Array.isArray(e)||r.length!==e.length)return!1;for(let i=0;i<r.length;i++)if(!vc(r[i],e[i],t-1))return!1;return!0}if(Array.isArray(e))return!1;if(typeof r=="object"&&typeof e=="object"){const i=Object.keys(r),n=Object.keys(e);if(i.length!==n.length)return!1;for(const a of i)if(!e.hasOwnProperty(a)||!vc(r[a],e[a],t-1))return!1;return!0}return!1}class wie{constructor(e){this.views=[],this.width=100,this.height=100,this.viewState={},this.controllers={},this.timeline=e.timeline,this._viewports=[],this._viewportMap={},this._isUpdating=!1,this._needsRedraw="First render",this._needsUpdate="Initialize",this._eventManager=e.eventManager,this._eventCallbacks={onViewStateChange:e.onViewStateChange,onInteractionStateChange:e.onInteractionStateChange},Object.seal(this),this.setProps(e)}finalize(){for(const e in this.controllers){const t=this.controllers[e];t&&t.finalize()}this.controllers={}}needsRedraw(e={clearRedrawFlags:!1}){const t=this._needsRedraw;return e.clearRedrawFlags&&(this._needsRedraw=!1),t}setNeedsUpdate(e){this._needsUpdate=this._needsUpdate||e,this._needsRedraw=this._needsRedraw||e}updateViewStates(){for(const e in this.controllers){const t=this.controllers[e];t&&t.updateTransition()}}getViewports(e){return e?this._viewports.filter(t=>t.containsPixel(e)):this._viewports}getViews(){const e={};return this.views.forEach(t=>{e[t.id]=t}),e}getView(e){return this.views.find(t=>t.id===e)}getViewState(e){const t=typeof e=="string"?this.getView(e):e,i=t&&this.viewState[t.getViewStateId()]||this.viewState;return t?t.filterViewState(i):i}getViewport(e){return this._viewportMap[e]}unproject(e,t){const i=this.getViewports(),n={x:e[0],y:e[1]};for(let a=i.length-1;a>=0;--a){const s=i[a];if(s.containsPixel(n)){const o=e.slice();return o[0]-=s.x,o[1]-=s.y,s.unproject(o,t)}}return null}setProps(e){e.views&&this._setViews(e.views),e.viewState&&this._setViewState(e.viewState),("width"in e||"height"in e)&&this._setSize(e.width,e.height),this._isUpdating||this._update()}_update(){this._isUpdating=!0,this._needsUpdate&&(this._needsUpdate=!1,this._rebuildViewports()),this._needsUpdate&&(this._needsUpdate=!1,this._rebuildViewports()),this._isUpdating=!1}_setSize(e,t){(e!==this.width||t!==this.height)&&(this.width=e,this.height=t,this.setNeedsUpdate("Size changed"))}_setViews(e){e=U0(e,Boolean),this._diffViews(e,this.views)&&this.setNeedsUpdate("views changed"),this.views=e}_setViewState(e){e?(!vc(e,this.viewState,3)&&this.setNeedsUpdate("viewState changed"),this.viewState=e):Tn.warn("missing `viewState` or `initialViewState`")()}_createController(e,t){const i=t.type;return new i({timeline:this.timeline,eventManager:this._eventManager,onViewStateChange:this._eventCallbacks.onViewStateChange,onStateChange:this._eventCallbacks.onInteractionStateChange,makeViewport:a=>this.getView(e.id)?.makeViewport({viewState:a,width:this.width,height:this.height})})}_updateController(e,t,i,n){const a=e.controller;if(a&&i){const s={...t,...a,id:e.id,x:i.x,y:i.y,width:i.width,height:i.height};return(!n||n.constructor!==a.type)&&(n=this._createController(e,s)),n&&n.setProps(s),n}return null}_rebuildViewports(){const{views:e}=this,t=this.controllers;this._viewports=[],this.controllers={};let i=!1;for(let n=e.length;n--;){const a=e[n],s=this.getViewState(a),o=a.makeViewport({viewState:s,width:this.width,height:this.height});let l=t[a.id];const c=!!a.controller;c&&!l&&(i=!0),(i||!c)&&l&&(l.finalize(),l=null),this.controllers[a.id]=this._updateController(a,s,o,l),o&&this._viewports.unshift(o)}for(const n in t){const a=t[n];a&&!this.controllers[n]&&a.finalize()}this._buildViewportMap()}_buildViewportMap(){this._viewportMap={},this._viewports.forEach(e=>{e.id&&(this._viewportMap[e.id]=this._viewportMap[e.id]||e)})}_diffViews(e,t){return e.length!==t.length?!0:e.some((i,n)=>!e[n].equals(t[n]))}}const Sie=/([0-9]+\.?[0-9]*)(%|px)/;function ag(r){switch(typeof r){case"number":return{position:r,relative:!1};case"string":const e=Sie.exec(r);if(e&&e.length>=3){const t=e[2]==="%",i=parseFloat(e[1]);return{position:t?i/100:i,relative:t}}default:throw new Error(`Could not parse position string ${r}`)}}function og(r,e){return r.relative?Math.round(r.position*e):r.position}let ej=class{constructor(e){const{id:t,x:i=0,y:n=0,width:a="100%",height:s="100%",padding:o=null}=e;this.id=t||this.constructor.displayName||"view",this.props={...e,id:this.id},this._x=ag(i),this._y=ag(n),this._width=ag(a),this._height=ag(s),this._padding=o&&{left:ag(o.left||0),right:ag(o.right||0),top:ag(o.top||0),bottom:ag(o.bottom||0)},this.equals=this.equals.bind(this),Object.seal(this)}equals(e){return this===e?!0:this.constructor===e.constructor&&vc(this.props,e.props,2)}clone(e){const t=this.constructor;return new t({...this.props,...e})}makeViewport({width:e,height:t,viewState:i}){i=this.filterViewState(i);const n=this.getDimensions({width:e,height:t});if(!n.height||!n.width)return null;const a=this.getViewportType(i);return new a({...i,...this.props,...n})}getViewStateId(){const{viewState:e}=this.props;return typeof e=="string"?e:e?.id||this.id}filterViewState(e){if(this.props.viewState&&typeof this.props.viewState=="object"){if(!this.props.viewState.id)return this.props.viewState;const t={...e};for(const i in this.props.viewState)i!=="id"&&(t[i]=this.props.viewState[i]);return t}return e}getDimensions({width:e,height:t}){const i={x:og(this._x,e),y:og(this._y,t),width:og(this._width,e),height:og(this._height,t)};return this._padding&&(i.padding={left:og(this._padding.left,e),top:og(this._padding.top,t),right:og(this._padding.right,e),bottom:og(this._padding.bottom,t)}),i}get controller(){const e=this.props.controller;return e?e===!0?{type:this.ControllerType}:typeof e=="function"?{type:e}:{type:this.ControllerType,...e}:null}};class _C{constructor(e){this._inProgress=!1,this._handle=null,this.time=0,this.settings={duration:0},this._timeline=e}get inProgress(){return this._inProgress}start(e){this.cancel(),this.settings=e,this._inProgress=!0,this.settings.onStart?.(this)}end(){this._inProgress&&(this._timeline.removeChannel(this._handle),this._handle=null,this._inProgress=!1,this.settings.onEnd?.(this))}cancel(){this._inProgress&&(this.settings.onInterrupt?.(this),this._timeline.removeChannel(this._handle),this._handle=null,this._inProgress=!1)}update(){if(!this._inProgress)return!1;if(this._handle===null){const{_timeline:e,settings:t}=this;this._handle=e.addChannel({delay:e.getTime(),duration:t.duration})}return this.time=this._timeline.getTime(this._handle),this._onUpdate(),this.settings.onUpdate?.(this),this._timeline.isFinished(this._handle)&&this.end(),!0}_onUpdate(){}}const fB=()=>{},pR={BREAK:1,SNAP_TO_END:2,IGNORE:3},Tie=r=>r,Aie=pR.BREAK;class Cie{constructor(e){this._onTransitionUpdate=t=>{const{time:i,settings:{interpolator:n,startProps:a,endProps:s,duration:o,easing:l}}=t,c=l(i/o),f=n.interpolateProps(a,s,c);this.propsInTransition=this.getControllerState({...this.props,...f}).getViewportProps(),this.onViewStateChange({viewState:this.propsInTransition,oldViewState:this.props})},this.getControllerState=e.getControllerState,this.propsInTransition=null,this.transition=new _C(e.timeline),this.onViewStateChange=e.onViewStateChange||fB,this.onStateChange=e.onStateChange||fB}finalize(){this.transition.cancel()}getViewportInTransition(){return this.propsInTransition}processViewStateChange(e){let t=!1;const i=this.props;if(this.props=e,!i||this._shouldIgnoreViewportChange(i,e))return!1;if(this._isTransitionEnabled(e)){let n=i;if(this.transition.inProgress){const{interruption:a,endProps:s}=this.transition.settings;n={...i,...a===pR.SNAP_TO_END?s:this.propsInTransition||i}}this._triggerTransition(n,e),t=!0}else this.transition.cancel();return t}updateTransition(){this.transition.update()}_isTransitionEnabled(e){const{transitionDuration:t,transitionInterpolator:i}=e;return(t>0||t==="auto")&&!!i}_isUpdateDueToCurrentTransition(e){return this.transition.inProgress&&this.propsInTransition?this.transition.settings.interpolator.arePropsEqual(e,this.propsInTransition):!1}_shouldIgnoreViewportChange(e,t){return this.transition.inProgress?this.transition.settings.interruption===pR.IGNORE||this._isUpdateDueToCurrentTransition(t):this._isTransitionEnabled(t)?t.transitionInterpolator.arePropsEqual(e,t):!0}_triggerTransition(e,t){const i=this.getControllerState(e),n=this.getControllerState(t).shortestPathFrom(i),a=t.transitionInterpolator,s=a.getDuration?a.getDuration(e,t):t.transitionDuration;if(s===0)return;const o=a.initializeProps(e,n);this.propsInTransition={};const l={duration:s,easing:t.transitionEasing||Tie,interpolator:a,interruption:t.transitionInterruption||Aie,startProps:o.start,endProps:o.end,onStart:t.onTransitionStart,onUpdate:this._onTransitionUpdate,onInterrupt:this._onTransitionEnd(t.onTransitionInterrupt),onEnd:this._onTransitionEnd(t.onTransitionEnd)};this.transition.start(l),this.onStateChange({inTransition:!0}),this.updateTransition()}_onTransitionEnd(e){return t=>{this.propsInTransition=null,this.onStateChange({inTransition:!1,isZooming:!1,isPanning:!1,isRotating:!1}),e?.(t)}}}function Ga(r,e){if(!r)throw new Error(e||"deck.gl: assertion failed.")}class Mie{constructor(e){const{compare:t,extract:i,required:n}=e;this._propsToCompare=t,this._propsToExtract=i||t,this._requiredProps=n}arePropsEqual(e,t){for(const i of this._propsToCompare)if(!(i in e)||!(i in t)||!J1(e[i],t[i]))return!1;return!0}initializeProps(e,t){const i={},n={};for(const a of this._propsToExtract)(a in e||a in t)&&(i[a]=e[a],n[a]=t[a]);return this._checkRequiredProps(i),this._checkRequiredProps(n),{start:i,end:n}}getDuration(e,t){return t.transitionDuration}_checkRequiredProps(e){this._requiredProps&&this._requiredProps.forEach(t=>{const i=e[t];Ga(Number.isFinite(i)||Array.isArray(i),`${t} is required for transition`)})}}const Eie=["longitude","latitude","zoom","bearing","pitch"],Iie=["longitude","latitude","zoom"];class QD extends Mie{constructor(e={}){const t=Array.isArray(e)?e:e.transitionProps,i=Array.isArray(e)?{}:e;i.transitionProps=Array.isArray(t)?{compare:t,required:t}:t||{compare:Eie,required:Iie},super(i.transitionProps),this.opts=i}initializeProps(e,t){const i=super.initializeProps(e,t),{makeViewport:n,around:a}=this.opts;if(n&&a){const s=n(e),o=n(t),l=s.unproject(a);i.start.around=a,Object.assign(i.end,{around:o.project(l),aroundPosition:l,width:t.width,height:t.height})}return i}interpolateProps(e,t,i){const n={};for(const a of this._propsToExtract)n[a]=sA(e[a]||0,t[a]||0,i);if(t.aroundPosition&&this.opts.makeViewport){const a=this.opts.makeViewport({...t,...n});Object.assign(n,a.panByPosition(t.aroundPosition,sA(e.around,t.around,i)))}return n}}const jd={transitionDuration:0},Pie=300,lT=r=>1-(1-r)*(1-r),B_={WHEEL:["wheel"],PAN:["panstart","panmove","panend"],PINCH:["pinchstart","pinchmove","pinchend"],MULTI_PAN:["multipanstart","multipanmove","multipanend"],DOUBLE_CLICK:["dblclick"],KEYBOARD:["keydown"]},rm={};class tj{constructor(e){this.state={},this._events={},this._interactionState={isDragging:!1},this._customEvents=[],this._eventStartBlocked=null,this._panMove=!1,this.invertPan=!1,this.dragMode="rotate",this.inertia=0,this.scrollZoom=!0,this.dragPan=!0,this.dragRotate=!0,this.doubleClickZoom=!0,this.touchZoom=!0,this.touchRotate=!1,this.keyboard=!0,this.transitionManager=new Cie({...e,getControllerState:t=>new this.ControllerState(t),onViewStateChange:this._onTransition.bind(this),onStateChange:this._setInteractionState.bind(this)}),this.handleEvent=this.handleEvent.bind(this),this.eventManager=e.eventManager,this.onViewStateChange=e.onViewStateChange||(()=>{}),this.onStateChange=e.onStateChange||(()=>{}),this.makeViewport=e.makeViewport}set events(e){this.toggleEvents(this._customEvents,!1),this.toggleEvents(e,!0),this._customEvents=e,this.props&&this.setProps(this.props)}finalize(){for(const e in this._events)this._events[e]&&this.eventManager?.off(e,this.handleEvent);this.transitionManager.finalize()}handleEvent(e){this._controllerState=void 0;const t=this._eventStartBlocked;switch(e.type){case"panstart":return t?!1:this._onPanStart(e);case"panmove":return this._onPan(e);case"panend":return this._onPanEnd(e);case"pinchstart":return t?!1:this._onPinchStart(e);case"pinchmove":return this._onPinch(e);case"pinchend":return this._onPinchEnd(e);case"multipanstart":return t?!1:this._onMultiPanStart(e);case"multipanmove":return this._onMultiPan(e);case"multipanend":return this._onMultiPanEnd(e);case"dblclick":return this._onDoubleClick(e);case"wheel":return this._onWheel(e);case"keydown":return this._onKeyDown(e);default:return!1}}get controllerState(){return this._controllerState=this._controllerState||new this.ControllerState({makeViewport:this.makeViewport,...this.props,...this.state}),this._controllerState}getCenter(e){const{x:t,y:i}=this.props,{offsetCenter:n}=e;return[n.x-t,n.y-i]}isPointInBounds(e,t){const{width:i,height:n}=this.props;if(t&&t.handled)return!1;const a=e[0]>=0&&e[0]<=i&&e[1]>=0&&e[1]<=n;return a&&t&&t.stopPropagation(),a}isFunctionKeyPressed(e){const{srcEvent:t}=e;return!!(t.metaKey||t.altKey||t.ctrlKey||t.shiftKey)}isDragging(){return this._interactionState.isDragging||!1}blockEvents(e){const t=setTimeout(()=>{this._eventStartBlocked===t&&(this._eventStartBlocked=null)},e);this._eventStartBlocked=t}setProps(e){e.dragMode&&(this.dragMode=e.dragMode),this.props=e,"transitionInterpolator"in e||(e.transitionInterpolator=this._getTransitionProps().transitionInterpolator),this.transitionManager.processViewStateChange(e);const{inertia:t}=e;this.inertia=Number.isFinite(t)?t:t===!0?Pie:0;const{scrollZoom:i=!0,dragPan:n=!0,dragRotate:a=!0,doubleClickZoom:s=!0,touchZoom:o=!0,touchRotate:l=!1,keyboard:c=!0}=e,f=!!this.onViewStateChange;this.toggleEvents(B_.WHEEL,f&&i),this.toggleEvents(B_.PAN,f),this.toggleEvents(B_.PINCH,f&&(o||l)),this.toggleEvents(B_.MULTI_PAN,f&&l),this.toggleEvents(B_.DOUBLE_CLICK,f&&s),this.toggleEvents(B_.KEYBOARD,f&&c),this.scrollZoom=i,this.dragPan=n,this.dragRotate=a,this.doubleClickZoom=s,this.touchZoom=o,this.touchRotate=l,this.keyboard=c}updateTransition(){this.transitionManager.updateTransition()}toggleEvents(e,t){this.eventManager&&e.forEach(i=>{this._events[i]!==t&&(this._events[i]=t,t?this.eventManager.on(i,this.handleEvent):this.eventManager.off(i,this.handleEvent))})}updateViewport(e,t=null,i={}){const n={...e.getViewportProps(),...t},a=this.controllerState!==e;if(this.state=e.getState(),this._setInteractionState(i),a){const s=this.controllerState&&this.controllerState.getViewportProps();this.onViewStateChange&&this.onViewStateChange({viewState:n,interactionState:this._interactionState,oldViewState:s,viewId:this.props.id})}}_onTransition(e){this.onViewStateChange({...e,interactionState:this._interactionState,viewId:this.props.id})}_setInteractionState(e){Object.assign(this._interactionState,e),this.onStateChange(this._interactionState)}_onPanStart(e){const t=this.getCenter(e);if(!this.isPointInBounds(t,e))return!1;let i=this.isFunctionKeyPressed(e)||e.rightButton||!1;(this.invertPan||this.dragMode==="pan")&&(i=!i);const n=this.controllerState[i?"panStart":"rotateStart"]({pos:t});return this._panMove=i,this.updateViewport(n,jd,{isDragging:!0}),!0}_onPan(e){return this.isDragging()?this._panMove?this._onPanMove(e):this._onPanRotate(e):!1}_onPanEnd(e){return this.isDragging()?this._panMove?this._onPanMoveEnd(e):this._onPanRotateEnd(e):!1}_onPanMove(e){if(!this.dragPan)return!1;const t=this.getCenter(e),i=this.controllerState.pan({pos:t});return this.updateViewport(i,jd,{isDragging:!0,isPanning:!0}),!0}_onPanMoveEnd(e){const{inertia:t}=this;if(this.dragPan&&t&&e.velocity){const i=this.getCenter(e),n=[i[0]+e.velocityX*t/2,i[1]+e.velocityY*t/2],a=this.controllerState.pan({pos:n}).panEnd();this.updateViewport(a,{...this._getTransitionProps(),transitionDuration:t,transitionEasing:lT},{isDragging:!1,isPanning:!0})}else{const i=this.controllerState.panEnd();this.updateViewport(i,null,{isDragging:!1,isPanning:!1})}return!0}_onPanRotate(e){if(!this.dragRotate)return!1;const t=this.getCenter(e),i=this.controllerState.rotate({pos:t});return this.updateViewport(i,jd,{isDragging:!0,isRotating:!0}),!0}_onPanRotateEnd(e){const{inertia:t}=this;if(this.dragRotate&&t&&e.velocity){const i=this.getCenter(e),n=[i[0]+e.velocityX*t/2,i[1]+e.velocityY*t/2],a=this.controllerState.rotate({pos:n}).rotateEnd();this.updateViewport(a,{...this._getTransitionProps(),transitionDuration:t,transitionEasing:lT},{isDragging:!1,isRotating:!0})}else{const i=this.controllerState.rotateEnd();this.updateViewport(i,null,{isDragging:!1,isRotating:!1})}return!0}_onWheel(e){if(!this.scrollZoom)return!1;const t=this.getCenter(e);if(!this.isPointInBounds(t,e))return!1;e.srcEvent.preventDefault();const{speed:i=.01,smooth:n=!1}=this.scrollZoom===!0?{}:this.scrollZoom,{delta:a}=e;let s=2/(1+Math.exp(-Math.abs(a*i)));a<0&&s!==0&&(s=1/s);const o=n?{...this._getTransitionProps({around:t}),transitionDuration:250}:jd,l=this.controllerState.zoom({pos:t,scale:s});return this.updateViewport(l,o,{isZooming:!0,isPanning:!0}),!0}_onMultiPanStart(e){const t=this.getCenter(e);if(!this.isPointInBounds(t,e))return!1;const i=this.controllerState.rotateStart({pos:t});return this.updateViewport(i,jd,{isDragging:!0}),!0}_onMultiPan(e){if(!this.touchRotate||!this.isDragging())return!1;const t=this.getCenter(e);t[0]-=e.deltaX;const i=this.controllerState.rotate({pos:t});return this.updateViewport(i,jd,{isDragging:!0,isRotating:!0}),!0}_onMultiPanEnd(e){if(!this.isDragging())return!1;const{inertia:t}=this;if(this.touchRotate&&t&&e.velocityY){const i=this.getCenter(e),n=[i[0],i[1]+=e.velocityY*t/2],a=this.controllerState.rotate({pos:n});this.updateViewport(a,{...this._getTransitionProps(),transitionDuration:t,transitionEasing:lT},{isDragging:!1,isRotating:!0}),this.blockEvents(t)}else{const i=this.controllerState.rotateEnd();this.updateViewport(i,null,{isDragging:!1,isRotating:!1})}return!0}_onPinchStart(e){const t=this.getCenter(e);if(!this.isPointInBounds(t,e))return!1;const i=this.controllerState.zoomStart({pos:t}).rotateStart({pos:t});return rm._startPinchRotation=e.rotation,rm._lastPinchEvent=e,this.updateViewport(i,jd,{isDragging:!0}),!0}_onPinch(e){if(!this.touchZoom&&!this.touchRotate||!this.isDragging())return!1;let t=this.controllerState;if(this.touchZoom){const{scale:i}=e,n=this.getCenter(e);t=t.zoom({pos:n,scale:i})}if(this.touchRotate){const{rotation:i}=e;t=t.rotate({deltaAngleX:rm._startPinchRotation-i})}return this.updateViewport(t,jd,{isDragging:!0,isPanning:this.touchZoom,isZooming:this.touchZoom,isRotating:this.touchRotate}),rm._lastPinchEvent=e,!0}_onPinchEnd(e){if(!this.isDragging())return!1;const{inertia:t}=this,{_lastPinchEvent:i}=rm;if(this.touchZoom&&t&&i&&e.scale!==i.scale){const n=this.getCenter(e);let a=this.controllerState.rotateEnd();const s=Math.log2(e.scale),o=(s-Math.log2(i.scale))/(e.deltaTime-i.deltaTime),l=Math.pow(2,s+o*t/2);a=a.zoom({pos:n,scale:l}).zoomEnd(),this.updateViewport(a,{...this._getTransitionProps({around:n}),transitionDuration:t,transitionEasing:lT},{isDragging:!1,isPanning:this.touchZoom,isZooming:this.touchZoom,isRotating:!1}),this.blockEvents(t)}else{const n=this.controllerState.zoomEnd().rotateEnd();this.updateViewport(n,null,{isDragging:!1,isPanning:!1,isZooming:!1,isRotating:!1})}return rm._startPinchRotation=null,rm._lastPinchEvent=null,!0}_onDoubleClick(e){if(!this.doubleClickZoom)return!1;const t=this.getCenter(e);if(!this.isPointInBounds(t,e))return!1;const i=this.isFunctionKeyPressed(e),n=this.controllerState.zoom({pos:t,scale:i?.5:2});return this.updateViewport(n,this._getTransitionProps({around:t}),{isZooming:!0,isPanning:!0}),this.blockEvents(100),!0}_onKeyDown(e){if(!this.keyboard)return!1;const t=this.isFunctionKeyPressed(e),{zoomSpeed:i,moveSpeed:n,rotateSpeedX:a,rotateSpeedY:s}=this.keyboard===!0?{}:this.keyboard,{controllerState:o}=this;let l;const c={};switch(e.srcEvent.code){case"Minus":l=t?o.zoomOut(i).zoomOut(i):o.zoomOut(i),c.isZooming=!0;break;case"Equal":l=t?o.zoomIn(i).zoomIn(i):o.zoomIn(i),c.isZooming=!0;break;case"ArrowLeft":t?(l=o.rotateLeft(a),c.isRotating=!0):(l=o.moveLeft(n),c.isPanning=!0);break;case"ArrowRight":t?(l=o.rotateRight(a),c.isRotating=!0):(l=o.moveRight(n),c.isPanning=!0);break;case"ArrowUp":t?(l=o.rotateUp(s),c.isRotating=!0):(l=o.moveUp(n),c.isPanning=!0);break;case"ArrowDown":t?(l=o.rotateDown(s),c.isRotating=!0):(l=o.moveDown(n),c.isPanning=!0);break;default:return!1}return this.updateViewport(l,this._getTransitionProps(),c),!0}_getTransitionProps(e){const{transition:t}=this;return!t||!t.transitionInterpolator?jd:e?{...t,transitionInterpolator:new QD({...e,...t.transitionInterpolator.opts,makeViewport:this.controllerState.makeViewport})}:t}}class Rie{constructor(e,t){this._viewportProps=this.applyConstraints(e),this._state=t}getViewportProps(){return this._viewportProps}getState(){return this._state}}const dB=5,Die=1.2;class rj extends Rie{constructor(e){const{width:t,height:i,latitude:n,longitude:a,zoom:s,bearing:o=0,pitch:l=0,altitude:c=1.5,position:f=[0,0,0],maxZoom:p=20,minZoom:y=0,maxPitch:b=60,minPitch:S=0,startPanLngLat:C,startZoomLngLat:E,startRotatePos:P,startBearing:O,startPitch:B,startZoom:F,normalize:W=!0}=e;Ga(Number.isFinite(a)),Ga(Number.isFinite(n)),Ga(Number.isFinite(s)),super({width:t,height:i,latitude:n,longitude:a,zoom:s,bearing:o,pitch:l,altitude:c,maxZoom:p,minZoom:y,maxPitch:b,minPitch:S,normalize:W,position:f},{startPanLngLat:C,startZoomLngLat:E,startRotatePos:P,startBearing:O,startPitch:B,startZoom:F}),this.makeViewport=e.makeViewport}panStart({pos:e}){return this._getUpdatedState({startPanLngLat:this._unproject(e)})}pan({pos:e,startPos:t}){const i=this.getState().startPanLngLat||this._unproject(t);if(!i)return this;const a=this.makeViewport(this.getViewportProps()).panByPosition(i,e);return this._getUpdatedState(a)}panEnd(){return this._getUpdatedState({startPanLngLat:null})}rotateStart({pos:e}){return this._getUpdatedState({startRotatePos:e,startBearing:this.getViewportProps().bearing,startPitch:this.getViewportProps().pitch})}rotate({pos:e,deltaAngleX:t=0,deltaAngleY:i=0}){const{startRotatePos:n,startBearing:a,startPitch:s}=this.getState();if(!n||a===void 0||s===void 0)return this;let o;return e?o=this._getNewRotation(e,n,s,a):o={bearing:a+t,pitch:s+i},this._getUpdatedState(o)}rotateEnd(){return this._getUpdatedState({startBearing:null,startPitch:null})}zoomStart({pos:e}){return this._getUpdatedState({startZoomLngLat:this._unproject(e),startZoom:this.getViewportProps().zoom})}zoom({pos:e,startPos:t,scale:i}){let{startZoom:n,startZoomLngLat:a}=this.getState();if(a||(n=this.getViewportProps().zoom,a=this._unproject(t)||this._unproject(e)),!a)return this;const{maxZoom:s,minZoom:o}=this.getViewportProps();let l=n+Math.log2(i);l=kf(l,o,s);const c=this.makeViewport({...this.getViewportProps(),zoom:l});return this._getUpdatedState({zoom:l,...c.panByPosition(a,e)})}zoomEnd(){return this._getUpdatedState({startZoomLngLat:null,startZoom:null})}zoomIn(e=2){return this._zoomFromCenter(e)}zoomOut(e=2){return this._zoomFromCenter(1/e)}moveLeft(e=100){return this._panFromCenter([e,0])}moveRight(e=100){return this._panFromCenter([-e,0])}moveUp(e=100){return this._panFromCenter([0,e])}moveDown(e=100){return this._panFromCenter([0,-e])}rotateLeft(e=15){return this._getUpdatedState({bearing:this.getViewportProps().bearing-e})}rotateRight(e=15){return this._getUpdatedState({bearing:this.getViewportProps().bearing+e})}rotateUp(e=10){return this._getUpdatedState({pitch:this.getViewportProps().pitch+e})}rotateDown(e=10){return this._getUpdatedState({pitch:this.getViewportProps().pitch-e})}shortestPathFrom(e){const t=e.getViewportProps(),i={...this.getViewportProps()},{bearing:n,longitude:a}=i;return Math.abs(n-t.bearing)>180&&(i.bearing=n<0?n+360:n-360),Math.abs(a-t.longitude)>180&&(i.longitude=a<0?a+360:a-360),i}applyConstraints(e){const{maxZoom:t,minZoom:i,zoom:n}=e;e.zoom=kf(n,i,t);const{maxPitch:a,minPitch:s,pitch:o}=e;e.pitch=kf(o,s,a);const{normalize:l=!0}=e;return l&&Object.assign(e,ere(e)),e}_zoomFromCenter(e){const{width:t,height:i}=this.getViewportProps();return this.zoom({pos:[t/2,i/2],scale:e})}_panFromCenter(e){const{width:t,height:i}=this.getViewportProps();return this.pan({startPos:[t/2,i/2],pos:[t/2+e[0],i/2+e[1]]})}_getUpdatedState(e){return new this.constructor({makeViewport:this.makeViewport,...this.getViewportProps(),...this.getState(),...e})}_unproject(e){const t=this.makeViewport(this.getViewportProps());return e&&t.unproject(e)}_getNewRotation(e,t,i,n){const a=e[0]-t[0],s=e[1]-t[1],o=e[1],l=t[1],{width:c,height:f}=this.getViewportProps(),p=a/c;let y=0;s>0?Math.abs(f-l)>dB&&(y=s/(l-f)*Die):s<0&&l>dB&&(y=1-o/l),y=kf(y,-1,1);const{minPitch:b,maxPitch:S}=this.getViewportProps(),C=n+180*p;let E=i;return y>0?E=i+y*(S-i):y<0&&(E=i-y*(b-i)),{pitch:E,bearing:C}}}class kie extends tj{constructor(){super(...arguments),this.ControllerState=rj,this.transition={transitionDuration:300,transitionInterpolator:new QD({transitionProps:{compare:["longitude","latitude","zoom","bearing","pitch","position"],required:["longitude","latitude","zoom"]}})},this.dragMode="pan"}setProps(e){e.position=e.position||[0,0,0];const t=this.props;super.setProps(e),(!t||t.height!==e.height)&&this.updateViewport(new this.ControllerState({makeViewport:this.makeViewport,...e,...this.state}))}}let JD=class extends ej{constructor(e={}){super(e)}getViewportType(){return dy}get ControllerType(){return kie}};JD.displayName="MapView";const Lie=new GH;function Oie(r,e){const t=r.order??1/0,i=e.order??1/0;return t-i}class Nie{constructor(e){this._resolvedEffects=[],this._defaultEffects=[],this.effects=[],this._context=e,this._needsRedraw="Initial render",this._setEffects([])}addDefaultEffect(e){const t=this._defaultEffects;if(!t.find(i=>i.id===e.id)){const i=t.findIndex(n=>Oie(n,e)>0);i<0?t.push(e):t.splice(i,0,e),e.setup(this._context),this._setEffects(this.effects)}}setProps(e){"effects"in e&&(vc(e.effects,this.effects,1)||this._setEffects(e.effects))}needsRedraw(e={clearRedrawFlags:!1}){const t=this._needsRedraw;return e.clearRedrawFlags&&(this._needsRedraw=!1),t}getEffects(){return this._resolvedEffects}_setEffects(e){const t={};for(const n of this.effects)t[n.id]=n;const i=[];for(const n of e){const a=t[n.id];let s=n;a&&a!==n?a.setProps?(a.setProps(n.props),s=a):a.cleanup(this._context):a||n.setup(this._context),i.push(s),delete t[n.id]}for(const n in t)t[n].cleanup(this._context);this.effects=i,this._resolvedEffects=i.concat(this._defaultEffects),e.some(n=>n instanceof GH)||this._resolvedEffects.push(Lie),this._needsRedraw="effects changed"}finalize(){for(const e of this._resolvedEffects)e.cleanup(this._context);this.effects.length=0,this._resolvedEffects.length=0,this._defaultEffects.length=0}}class Bie extends ZD{shouldDrawLayer(e){const{operation:t}=e.props;return t.includes("draw")||t.includes("terrain")}}const zie="deckRenderer.renderLayers";class Fie{constructor(e){this.device=e,this.layerFilter=null,this.drawPickingColors=!1,this.drawLayersPass=new Bie(e),this.pickLayersPass=new QH(e),this.renderCount=0,this._needsRedraw="Initial render",this.renderBuffers=[],this.lastPostProcessEffect=null}setProps(e){this.layerFilter!==e.layerFilter&&(this.layerFilter=e.layerFilter,this._needsRedraw="layerFilter changed"),this.drawPickingColors!==e.drawPickingColors&&(this.drawPickingColors=e.drawPickingColors,this._needsRedraw="drawPickingColors changed")}renderLayers(e){if(!e.viewports.length)return;const t=this.drawPickingColors?this.pickLayersPass:this.drawLayersPass,i={layerFilter:this.layerFilter,isPicking:this.drawPickingColors,...e};i.effects&&this._preRender(i.effects,i);const n=this.lastPostProcessEffect?this.renderBuffers[0]:i.target;this.lastPostProcessEffect&&(i.clearColor=[0,0,0,0],i.clearCanvas=!0);const a=t.render({...i,target:n});i.effects&&(this.lastPostProcessEffect&&(i.clearCanvas=e.clearCanvas===void 0?!0:e.clearCanvas),this._postRender(i.effects,i)),this.renderCount++,nl(zie,this,a,e)}needsRedraw(e={clearRedrawFlags:!1}){const t=this._needsRedraw;return e.clearRedrawFlags&&(this._needsRedraw=!1),t}finalize(){const{renderBuffers:e}=this;for(const t of e)t.delete();e.length=0}_preRender(e,t){this.lastPostProcessEffect=null,t.preRenderStats=t.preRenderStats||{};for(const i of e)t.preRenderStats[i.id]=i.preRender(t),i.postRender&&(this.lastPostProcessEffect=i.id);this.lastPostProcessEffect&&this._resizeRenderBuffers()}_resizeRenderBuffers(){const{renderBuffers:e}=this,t=this.device.canvasContext.getDrawingBufferSize(),[i,n]=t;e.length===0&&[0,1].map(a=>{const s=this.device.createTexture({sampler:{minFilter:"linear",magFilter:"linear"},width:i,height:n});e.push(this.device.createFramebuffer({id:`deck-renderbuffer-${a}`,colorAttachments:[s]}))});for(const a of e)a.resize(t)}_postRender(e,t){const{renderBuffers:i}=this,n={...t,inputBuffer:i[0],swapBuffer:i[1]};for(const a of e)if(a.postRender){n.target=a.id===this.lastPostProcessEffect?t.target:void 0;const s=a.postRender(n);n.inputBuffer=s,n.swapBuffer=s===i[0]?i[1]:i[0]}}}const Vie={pickedColor:null,pickedObjectIndex:-1};function pB({pickedColors:r,decodePickingColor:e,deviceX:t,deviceY:i,deviceRadius:n,deviceRect:a}){const{x:s,y:o,width:l,height:c}=a;let f=n*n,p=-1,y=0;for(let b=0;b<c;b++){const S=b+o-i,C=S*S;if(C>f)y+=4*l;else for(let E=0;E<l;E++){if(r[y+3]-1>=0){const O=E+s-t,B=O*O+C;B<=f&&(f=B,p=y)}y+=4}}if(p>=0){const b=r.slice(p,p+4),S=e(b);if(S){const C=Math.floor(p/4/l),E=p/4-C*l;return{...S,pickedColor:b,pickedX:s+E,pickedY:o+C}}Tn.error("Picked non-existent layer. Is picking buffer corrupt?")()}return Vie}function gB({pickedColors:r,decodePickingColor:e}){const t=new Map;if(r){for(let i=0;i<r.length;i+=4)if(r[i+3]-1>=0){const a=r.slice(i,i+4),s=a.join(",");if(!t.has(s)){const o=e(a);o?t.set(s,{...o,color:a}):Tn.error("Picked non-existent layer. Is picking buffer corrupt?")()}}}return Array.from(t.values())}function gR({pickInfo:r,viewports:e,pixelRatio:t,x:i,y:n,z:a}){let s=e[0];e.length>1&&(s=Uie(r?.pickedViewports||e,{x:i,y:n}));let o;if(s){const l=[i-s.x,n-s.y];a!==void 0&&(l[2]=a),o=s.unproject(l)}return{color:null,layer:null,viewport:s,index:-1,picked:!1,x:i,y:n,pixel:[i,n],coordinate:o,devicePixel:r&&"pickedX"in r?[r.pickedX,r.pickedY]:void 0,pixelRatio:t}}function vB(r){const{pickInfo:e,lastPickedInfo:t,mode:i,layers:n}=r,{pickedColor:a,pickedLayer:s,pickedObjectIndex:o}=e,l=s?[s]:[];if(i==="hover"){const p=t.index,y=t.layerId,b=s?s.props.id:null;if(b!==y||o!==p){if(b!==y){const S=n.find(C=>C.props.id===y);S&&l.unshift(S)}t.layerId=b,t.index=o,t.info=null}}const c=gR(r),f=new Map;return f.set(null,c),l.forEach(p=>{let y={...c};p===s&&(y.color=a,y.index=o,y.picked=!0),y=vR({layer:p,info:y,mode:i});const b=y.layer;p===s&&i==="hover"&&(t.info=y),f.set(b.id,y),i==="hover"&&b.updateAutoHighlight(y)}),f}function vR({layer:r,info:e,mode:t}){for(;r&&e;){const i=e.layer||null;e.sourceLayer=i,e.layer=r,e=r.getPickingInfo({info:e,mode:t,sourceLayer:i}),r=r.parent}return e}function Uie(r,e){for(let t=r.length-1;t>=0;t--){const i=r[t];if(i.containsPixel(e))return i}return r[0]}class Hie{constructor(e){this._pickable=!0,this.device=e,this.pickLayersPass=new QH(e),this.lastPickedInfo={index:-1,layerId:null,info:null}}setProps(e){"layerFilter"in e&&(this.layerFilter=e.layerFilter),"_pickable"in e&&(this._pickable=e._pickable)}finalize(){this.pickingFBO&&this.pickingFBO.destroy(),this.depthFBO&&this.depthFBO.destroy()}pickObjectAsync(e){return this._pickClosestObjectAsync(e)}pickObjectsAsync(e){return this._pickVisibleObjectsAsync(e)}pickObject(e){return this._pickClosestObject(e)}pickObjects(e){return this._pickVisibleObjects(e)}getLastPickedObject({x:e,y:t,layers:i,viewports:n},a=this.lastPickedInfo.info){const s=a&&a.layer&&a.layer.id,o=a&&a.viewport&&a.viewport.id,l=s?i.find(y=>y.id===s):null,c=o&&n.find(y=>y.id===o)||n[0],f=c&&c.unproject([e-c.x,t-c.y]);return{...a,...{x:e,y:t,viewport:c,coordinate:f,layer:l}}}_resizeBuffer(){if(!this.pickingFBO&&(this.pickingFBO=this.device.createFramebuffer({colorAttachments:["rgba8unorm"],depthStencilAttachment:"depth16unorm"}),this.device.isTextureFormatRenderable("rgba32float"))){const t=this.device.createFramebuffer({colorAttachments:["rgba32float"],depthStencilAttachment:"depth16unorm"});this.depthFBO=t}const{canvas:e}=this.device.getDefaultCanvasContext();this.pickingFBO?.resize({width:e.width,height:e.height}),this.depthFBO?.resize({width:e.width,height:e.height})}_getPickable(e){if(this._pickable===!1)return null;const t=e.filter(i=>this.pickLayersPass.shouldDrawLayer(i)&&!i.isComposite);return t.length?t:null}async _pickClosestObjectAsync({layers:e,views:t,viewports:i,x:n,y:a,radius:s=0,depth:o=1,mode:l="query",unproject3D:c,onViewportActive:f,effects:p}){const y=this.device.canvasContext.cssToDeviceRatio(),b=this._getPickable(e);if(!b||i.length===0)return{result:[],emptyInfo:gR({viewports:i,x:n,y:a,pixelRatio:y})};this._resizeBuffer();const S=this.device.canvasContext.cssToDevicePixels([n,a],!0),C=[S.x+Math.floor(S.width/2),S.y+Math.floor(S.height/2)],E=Math.round(s*y),{width:P,height:O}=this.pickingFBO,B=this._getPickingRect({deviceX:C[0],deviceY:C[1],deviceRadius:E,deviceWidth:P,deviceHeight:O}),F={x:n-s,y:a-s,width:s*2+1,height:s*2+1};let W;const $=[],q=new Set;for(let Q=0;Q<o;Q++){let ee;if(B){const ae=this._drawAndSample({layers:b,views:t,viewports:i,onViewportActive:f,deviceRect:B,cullRect:F,effects:p,pass:`picking:${l}`});ee=pB({...ae,deviceX:C[0],deviceY:C[1],deviceRadius:E,deviceRect:B})}else ee={pickedColor:null,pickedObjectIndex:-1};let te;if(ee.pickedLayer&&c&&this.depthFBO){const{pickedColors:ae}=this._drawAndSample({layers:[ee.pickedLayer],views:t,viewports:i,onViewportActive:f,deviceRect:{x:ee.pickedX,y:ee.pickedY,width:1,height:1},cullRect:F,effects:p,pass:`picking:${l}:z`},!0);ae[3]&&(te=ae[0])}ee.pickedLayer&&Q+1<o&&(q.add(ee.pickedLayer),ee.pickedLayer.disablePickingIndex(ee.pickedObjectIndex)),W=vB({pickInfo:ee,lastPickedInfo:this.lastPickedInfo,mode:l,layers:b,viewports:i,x:n,y:a,z:te,pixelRatio:y});for(const ae of W.values())ae.layer&&$.push(ae);if(!ee.pickedColor)break}for(const Q of q)Q.restorePickingColors();return{result:$,emptyInfo:W.get(null)}}_pickClosestObject({layers:e,views:t,viewports:i,x:n,y:a,radius:s=0,depth:o=1,mode:l="query",unproject3D:c,onViewportActive:f,effects:p}){const y=this.device.canvasContext.cssToDeviceRatio(),b=this._getPickable(e);if(!b||i.length===0)return{result:[],emptyInfo:gR({viewports:i,x:n,y:a,pixelRatio:y})};this._resizeBuffer();const S=this.device.canvasContext.cssToDevicePixels([n,a],!0),C=[S.x+Math.floor(S.width/2),S.y+Math.floor(S.height/2)],E=Math.round(s*y),{width:P,height:O}=this.pickingFBO,B=this._getPickingRect({deviceX:C[0],deviceY:C[1],deviceRadius:E,deviceWidth:P,deviceHeight:O}),F={x:n-s,y:a-s,width:s*2+1,height:s*2+1};let W;const $=[],q=new Set;for(let Q=0;Q<o;Q++){let ee;if(B){const ae=this._drawAndSample({layers:b,views:t,viewports:i,onViewportActive:f,deviceRect:B,cullRect:F,effects:p,pass:`picking:${l}`});ee=pB({...ae,deviceX:C[0],deviceY:C[1],deviceRadius:E,deviceRect:B})}else ee={pickedColor:null,pickedObjectIndex:-1};let te;if(ee.pickedLayer&&c&&this.depthFBO){const{pickedColors:ae}=this._drawAndSample({layers:[ee.pickedLayer],views:t,viewports:i,onViewportActive:f,deviceRect:{x:ee.pickedX,y:ee.pickedY,width:1,height:1},cullRect:F,effects:p,pass:`picking:${l}:z`},!0);ae[3]&&(te=ae[0])}ee.pickedLayer&&Q+1<o&&(q.add(ee.pickedLayer),ee.pickedLayer.disablePickingIndex(ee.pickedObjectIndex)),W=vB({pickInfo:ee,lastPickedInfo:this.lastPickedInfo,mode:l,layers:b,viewports:i,x:n,y:a,z:te,pixelRatio:y});for(const ae of W.values())ae.layer&&$.push(ae);if(!ee.pickedColor)break}for(const Q of q)Q.restorePickingColors();return{result:$,emptyInfo:W.get(null)}}async _pickVisibleObjectsAsync({layers:e,views:t,viewports:i,x:n,y:a,width:s=1,height:o=1,mode:l="query",maxObjects:c=null,onViewportActive:f,effects:p}){const y=this._getPickable(e);if(!y||i.length===0)return[];this._resizeBuffer();const b=this.device.canvasContext.cssToDeviceRatio(),S=this.device.canvasContext.cssToDevicePixels([n,a],!0),C=S.x,E=S.y+S.height,P=this.device.canvasContext.cssToDevicePixels([n+s,a+o],!0),O=P.x+P.width,B=P.y,F={x:C,y:B,width:O-C,height:E-B},W=this._drawAndSample({layers:y,views:t,viewports:i,onViewportActive:f,deviceRect:F,cullRect:{x:n,y:a,width:s,height:o},effects:p,pass:`picking:${l}`}),$=gB(W),q=new Map,Q=[],ee=Number.isFinite(c);for(let te=0;te<$.length&&!(ee&&Q.length>=c);te++){const ae=$[te];let de={color:ae.pickedColor,layer:null,index:ae.pickedObjectIndex,picked:!0,x:n,y:a,pixelRatio:b};de=vR({layer:ae.pickedLayer,info:de,mode:l});const ve=de.layer.id;q.has(ve)||q.set(ve,new Set);const ye=q.get(ve),Ae=de.object??de.index;ye.has(Ae)||(ye.add(Ae),Q.push(de))}return Q}_pickVisibleObjects({layers:e,views:t,viewports:i,x:n,y:a,width:s=1,height:o=1,mode:l="query",maxObjects:c=null,onViewportActive:f,effects:p}){const y=this._getPickable(e);if(!y||i.length===0)return[];this._resizeBuffer();const b=this.device.canvasContext.cssToDeviceRatio(),S=this.device.canvasContext.cssToDevicePixels([n,a],!0),C=S.x,E=S.y+S.height,P=this.device.canvasContext.cssToDevicePixels([n+s,a+o],!0),O=P.x+P.width,B=P.y,F={x:C,y:B,width:O-C,height:E-B},W=this._drawAndSample({layers:y,views:t,viewports:i,onViewportActive:f,deviceRect:F,cullRect:{x:n,y:a,width:s,height:o},effects:p,pass:`picking:${l}`}),$=gB(W),q=new Map,Q=[],ee=Number.isFinite(c);for(let te=0;te<$.length&&!(ee&&Q.length>=c);te++){const ae=$[te];let de={color:ae.pickedColor,layer:null,index:ae.pickedObjectIndex,picked:!0,x:n,y:a,pixelRatio:b};de=vR({layer:ae.pickedLayer,info:de,mode:l});const ve=de.layer.id;q.has(ve)||q.set(ve,new Set);const ye=q.get(ve),Ae=de.object??de.index;ye.has(Ae)||(ye.add(Ae),Q.push(de))}return Q}async _drawAndSampleAsync({layers:e,views:t,viewports:i,onViewportActive:n,deviceRect:a,cullRect:s,effects:o,pass:l},c=!1){const f=c?this.depthFBO:this.pickingFBO,p={layers:e,layerFilter:this.layerFilter,views:t,viewports:i,onViewportActive:n,pickingFBO:f,deviceRect:a,cullRect:s,effects:o,pass:l,pickZ:c,preRenderStats:{},isPicking:!0};for(const O of o)O.useInPicking&&(p.preRenderStats[O.id]=O.preRender(p));const{decodePickingColor:y}=this.pickLayersPass.render(p),{x:b,y:S,width:C,height:E}=a,P=new(c?Float32Array:Uint8Array)(C*E*4);return this.device.readPixelsToArrayWebGL(f,{sourceX:b,sourceY:S,sourceWidth:C,sourceHeight:E,target:P}),{pickedColors:P,decodePickingColor:y}}_drawAndSample({layers:e,views:t,viewports:i,onViewportActive:n,deviceRect:a,cullRect:s,effects:o,pass:l},c=!1){const f=c?this.depthFBO:this.pickingFBO,p={layers:e,layerFilter:this.layerFilter,views:t,viewports:i,onViewportActive:n,pickingFBO:f,deviceRect:a,cullRect:s,effects:o,pass:l,pickZ:c,preRenderStats:{},isPicking:!0};for(const O of o)O.useInPicking&&(p.preRenderStats[O.id]=O.preRender(p));const{decodePickingColor:y}=this.pickLayersPass.render(p),{x:b,y:S,width:C,height:E}=a,P=new(c?Float32Array:Uint8Array)(C*E*4);return this.device.readPixelsToArrayWebGL(f,{sourceX:b,sourceY:S,sourceWidth:C,sourceHeight:E,target:P}),{pickedColors:P,decodePickingColor:y}}_getPickingRect({deviceX:e,deviceY:t,deviceRadius:i,deviceWidth:n,deviceHeight:a}){const s=Math.max(0,e-i),o=Math.max(0,t-i),l=Math.min(n,e+i+1)-s,c=Math.min(a,t+i+1)-o;return l<=0||c<=0?null:{x:s,y:o,width:l,height:c}}}const jie={"top-left":{top:0,left:0},"top-right":{top:0,right:0},"bottom-left":{bottom:0,left:0},"bottom-right":{bottom:0,right:0},fill:{top:0,left:0,bottom:0,right:0}},$ie="top-left",mB="__root";class Wie{constructor({deck:e,parentElement:t}){this.defaultWidgets=[],this.widgets=[],this.resolvedWidgets=[],this.containers={},this.lastViewports={},this.deck=e,t?.classList.add("deck-widget-container"),this.parentElement=t}getWidgets(){return this.resolvedWidgets}setProps(e){if(e.widgets&&!vc(e.widgets,this.widgets,1)){const t=e.widgets.filter(Boolean);this._setWidgets(t)}}finalize(){for(const e of this.getWidgets())this._removeWidget(e);this.defaultWidgets.length=0,this.resolvedWidgets.length=0;for(const e in this.containers)this.containers[e].remove()}addDefault(e){this.defaultWidgets.find(t=>t.id===e.id)||(this._addWidget(e),this.defaultWidgets.push(e),this._setWidgets(this.widgets))}onRedraw({viewports:e,layers:t}){const i=e.reduce((n,a)=>(n[a.id]=a,n),{});for(const n of this.getWidgets()){const{viewId:a}=n;if(a){const s=i[a];s&&(n.onViewportChange&&n.onViewportChange(s),n.onRedraw?.({viewports:[s],layers:t}))}else{if(n.onViewportChange)for(const s of e)n.onViewportChange(s);n.onRedraw?.({viewports:e,layers:t})}}this.lastViewports=i,this._updateContainers()}onHover(e,t){for(const i of this.getWidgets()){const{viewId:n}=i;(!n||n===e.viewport?.id)&&i.onHover?.(e,t)}}onEvent(e,t){const i=uR[t.type];if(i)for(const n of this.getWidgets()){const{viewId:a}=n;(!a||a===e.viewport?.id)&&n[i]?.(e,t)}}_setWidgets(e){const t={};for(const i of this.resolvedWidgets)t[i.id]=i;this.resolvedWidgets.length=0;for(const i of this.defaultWidgets)t[i.id]=null,this.resolvedWidgets.push(i);for(let i of e){const n=t[i.id];n?n.viewId!==i.viewId||n.placement!==i.placement?(this._removeWidget(n),this._addWidget(i)):i!==n&&(n.setProps(i.props),i=n):this._addWidget(i),t[i.id]=null,this.resolvedWidgets.push(i)}for(const i in t){const n=t[i];n&&this._removeWidget(n)}this.widgets=e}_addWidget(e){const{viewId:t=null,placement:i=$ie}=e;e.widgetManager=this,e.deck=this.deck,e.rootElement=e._onAdd({deck:this.deck,viewId:t}),e.rootElement&&this._getContainer(t,i).append(e.rootElement),e.updateHTML()}_removeWidget(e){e.onRemove?.(),e.rootElement&&e.rootElement.remove(),e.rootElement=void 0,e.deck=void 0,e.widgetManager=void 0}_getContainer(e,t){const i=e||mB;let n=this.containers[i];n||(n=document.createElement("div"),n.style.pointerEvents="none",n.style.position="absolute",n.style.overflow="hidden",this.parentElement?.append(n),this.containers[i]=n);let a=n.querySelector(`.${t}`);return a||(a=globalThis.document.createElement("div"),a.className=t,a.style.position="absolute",a.style.zIndex="2",Object.assign(a.style,jie[t]),n.append(a)),a}_updateContainers(){const e=this.deck.width,t=this.deck.height;for(const i in this.containers){const n=this.lastViewports[i]||null,a=i===mB||n,s=this.containers[i];a?(s.style.display="block",s.style.left=`${n?n.x:0}px`,s.style.top=`${n?n.y:0}px`,s.style.width=`${n?n.width:e}px`,s.style.height=`${n?n.height:t}px`):s.style.display="none"}}}function yB(r,e){e&&Object.entries(e).map(([t,i])=>{t.startsWith("--")?r.style.setProperty(t,i):r.style[t]=i})}function Gie(r,e){e&&Object.keys(e).map(t=>{t.startsWith("--")?r.style.removeProperty(t):r.style[t]=""})}class ek{constructor(e){this.viewId=null,this.props={...this.constructor.defaultProps,...e},this.id=this.props.id}setProps(e){const t=this.props,i=this.rootElement;i&&t.className!==e.className&&(t.className&&i.classList.remove(t.className),e.className&&i.classList.add(e.className)),i&&!vc(t.style,e.style,1)&&(Gie(i,t.style),yB(i,e.style)),Object.assign(this.props,e),this.updateHTML()}updateHTML(){this.rootElement&&this.onRenderHTML(this.rootElement)}onCreateRootElement(){const e=["deck-widget",this.className,this.props.className],t=document.createElement("div");return e.filter(i=>typeof i=="string"&&i.length>0).forEach(i=>t.classList.add(i)),yB(t,this.props.style),t}_onAdd(e){return this.onAdd(e)??this.onCreateRootElement()}onAdd(e){}onRemove(){}onViewportChange(e){}onRedraw(e){}onHover(e,t){}onClick(e,t){}onDrag(e,t){}onDragStart(e,t){}onDragEnd(e,t){}}ek.defaultProps={id:"widget",style:{},className:""};const Xie={zIndex:"1",position:"absolute",pointerEvents:"none",color:"#a0a7b4",backgroundColor:"#29323c",padding:"10px",top:"0",left:"0",display:"none"};class ij extends ek{constructor(e={}){super(e),this.id="default-tooltip",this.placement="fill",this.className="deck-tooltip",this.isVisible=!1,this.setProps(e)}onCreateRootElement(){const e=document.createElement("div");return e.className=this.className,Object.assign(e.style,Xie),e}onRenderHTML(e){}onViewportChange(e){this.isVisible&&e.id===this.lastViewport?.id&&e!==this.lastViewport&&this.setTooltip(null)}onHover(e){const{deck:t}=this,i=t&&t.props.getTooltip;if(!i)return;const n=i(e);this.lastViewport=e.viewport,this.setTooltip(n,e.x,e.y)}setTooltip(e,t,i){const n=this.rootElement;if(n){if(typeof e=="string")n.innerText=e;else if(e)e.text&&(n.innerText=e.text),e.html&&(n.innerHTML=e.html),e.className&&(n.className=e.className);else{this.isVisible=!1,n.style.display="none";return}this.isVisible=!0,n.style.display="block",n.style.transform=`translate(${t}px, ${i}px)`,e&&typeof e=="object"&&"style"in e&&Object.assign(n.style,e.style)}}}ij.defaultProps={...ek.defaultProps};const Zie="modulepreload",qie=function(r){return"/dataflash-viewer/"+r},_B={},bB=function(e,t,i){let n=Promise.resolve();if(t&&t.length>0){let c=function(f){return Promise.all(f.map(p=>Promise.resolve(p).then(y=>({status:"fulfilled",value:y}),y=>({status:"rejected",reason:y}))))};var s=c;document.getElementsByTagName("link");const o=document.querySelector("meta[property=csp-nonce]"),l=o?.nonce||o?.getAttribute("nonce");n=c(t.map(f=>{if(f=qie(f),f in _B)return;_B[f]=!0;const p=f.endsWith(".css"),y=p?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${f}"]${y}`))return;const b=document.createElement("link");if(b.rel=p?"stylesheet":Zie,p||(b.as="script"),b.crossOrigin="",b.href=f,l&&b.setAttribute("nonce",l),document.head.appendChild(b),p)return new Promise((S,C)=>{b.addEventListener("load",S),b.addEventListener("error",()=>C(new Error(`Unable to preload CSS for ${f}`)))})}))}function a(o){const l=new Event("vite:preloadError",{cancelable:!0});if(l.payload=o,window.dispatchEvent(l),!l.defaultPrevented)throw o}return n.then(o=>{for(const l of o||[])l.status==="rejected"&&a(l.reason);return e().catch(a)})};var p0;(function(r){r[r.DEPTH_BUFFER_BIT=256]="DEPTH_BUFFER_BIT",r[r.STENCIL_BUFFER_BIT=1024]="STENCIL_BUFFER_BIT",r[r.COLOR_BUFFER_BIT=16384]="COLOR_BUFFER_BIT",r[r.POINTS=0]="POINTS",r[r.LINES=1]="LINES",r[r.LINE_LOOP=2]="LINE_LOOP",r[r.LINE_STRIP=3]="LINE_STRIP",r[r.TRIANGLES=4]="TRIANGLES",r[r.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",r[r.TRIANGLE_FAN=6]="TRIANGLE_FAN",r[r.ZERO=0]="ZERO",r[r.ONE=1]="ONE",r[r.SRC_COLOR=768]="SRC_COLOR",r[r.ONE_MINUS_SRC_COLOR=769]="ONE_MINUS_SRC_COLOR",r[r.SRC_ALPHA=770]="SRC_ALPHA",r[r.ONE_MINUS_SRC_ALPHA=771]="ONE_MINUS_SRC_ALPHA",r[r.DST_ALPHA=772]="DST_ALPHA",r[r.ONE_MINUS_DST_ALPHA=773]="ONE_MINUS_DST_ALPHA",r[r.DST_COLOR=774]="DST_COLOR",r[r.ONE_MINUS_DST_COLOR=775]="ONE_MINUS_DST_COLOR",r[r.SRC_ALPHA_SATURATE=776]="SRC_ALPHA_SATURATE",r[r.CONSTANT_COLOR=32769]="CONSTANT_COLOR",r[r.ONE_MINUS_CONSTANT_COLOR=32770]="ONE_MINUS_CONSTANT_COLOR",r[r.CONSTANT_ALPHA=32771]="CONSTANT_ALPHA",r[r.ONE_MINUS_CONSTANT_ALPHA=32772]="ONE_MINUS_CONSTANT_ALPHA",r[r.FUNC_ADD=32774]="FUNC_ADD",r[r.FUNC_SUBTRACT=32778]="FUNC_SUBTRACT",r[r.FUNC_REVERSE_SUBTRACT=32779]="FUNC_REVERSE_SUBTRACT",r[r.BLEND_EQUATION=32777]="BLEND_EQUATION",r[r.BLEND_EQUATION_RGB=32777]="BLEND_EQUATION_RGB",r[r.BLEND_EQUATION_ALPHA=34877]="BLEND_EQUATION_ALPHA",r[r.BLEND_DST_RGB=32968]="BLEND_DST_RGB",r[r.BLEND_SRC_RGB=32969]="BLEND_SRC_RGB",r[r.BLEND_DST_ALPHA=32970]="BLEND_DST_ALPHA",r[r.BLEND_SRC_ALPHA=32971]="BLEND_SRC_ALPHA",r[r.BLEND_COLOR=32773]="BLEND_COLOR",r[r.ARRAY_BUFFER_BINDING=34964]="ARRAY_BUFFER_BINDING",r[r.ELEMENT_ARRAY_BUFFER_BINDING=34965]="ELEMENT_ARRAY_BUFFER_BINDING",r[r.LINE_WIDTH=2849]="LINE_WIDTH",r[r.ALIASED_POINT_SIZE_RANGE=33901]="ALIASED_POINT_SIZE_RANGE",r[r.ALIASED_LINE_WIDTH_RANGE=33902]="ALIASED_LINE_WIDTH_RANGE",r[r.CULL_FACE_MODE=2885]="CULL_FACE_MODE",r[r.FRONT_FACE=2886]="FRONT_FACE",r[r.DEPTH_RANGE=2928]="DEPTH_RANGE",r[r.DEPTH_WRITEMASK=2930]="DEPTH_WRITEMASK",r[r.DEPTH_CLEAR_VALUE=2931]="DEPTH_CLEAR_VALUE",r[r.DEPTH_FUNC=2932]="DEPTH_FUNC",r[r.STENCIL_CLEAR_VALUE=2961]="STENCIL_CLEAR_VALUE",r[r.STENCIL_FUNC=2962]="STENCIL_FUNC",r[r.STENCIL_FAIL=2964]="STENCIL_FAIL",r[r.STENCIL_PASS_DEPTH_FAIL=2965]="STENCIL_PASS_DEPTH_FAIL",r[r.STENCIL_PASS_DEPTH_PASS=2966]="STENCIL_PASS_DEPTH_PASS",r[r.STENCIL_REF=2967]="STENCIL_REF",r[r.STENCIL_VALUE_MASK=2963]="STENCIL_VALUE_MASK",r[r.STENCIL_WRITEMASK=2968]="STENCIL_WRITEMASK",r[r.STENCIL_BACK_FUNC=34816]="STENCIL_BACK_FUNC",r[r.STENCIL_BACK_FAIL=34817]="STENCIL_BACK_FAIL",r[r.STENCIL_BACK_PASS_DEPTH_FAIL=34818]="STENCIL_BACK_PASS_DEPTH_FAIL",r[r.STENCIL_BACK_PASS_DEPTH_PASS=34819]="STENCIL_BACK_PASS_DEPTH_PASS",r[r.STENCIL_BACK_REF=36003]="STENCIL_BACK_REF",r[r.STENCIL_BACK_VALUE_MASK=36004]="STENCIL_BACK_VALUE_MASK",r[r.STENCIL_BACK_WRITEMASK=36005]="STENCIL_BACK_WRITEMASK",r[r.VIEWPORT=2978]="VIEWPORT",r[r.SCISSOR_BOX=3088]="SCISSOR_BOX",r[r.COLOR_CLEAR_VALUE=3106]="COLOR_CLEAR_VALUE",r[r.COLOR_WRITEMASK=3107]="COLOR_WRITEMASK",r[r.UNPACK_ALIGNMENT=3317]="UNPACK_ALIGNMENT",r[r.PACK_ALIGNMENT=3333]="PACK_ALIGNMENT",r[r.MAX_TEXTURE_SIZE=3379]="MAX_TEXTURE_SIZE",r[r.MAX_VIEWPORT_DIMS=3386]="MAX_VIEWPORT_DIMS",r[r.SUBPIXEL_BITS=3408]="SUBPIXEL_BITS",r[r.RED_BITS=3410]="RED_BITS",r[r.GREEN_BITS=3411]="GREEN_BITS",r[r.BLUE_BITS=3412]="BLUE_BITS",r[r.ALPHA_BITS=3413]="ALPHA_BITS",r[r.DEPTH_BITS=3414]="DEPTH_BITS",r[r.STENCIL_BITS=3415]="STENCIL_BITS",r[r.POLYGON_OFFSET_UNITS=10752]="POLYGON_OFFSET_UNITS",r[r.POLYGON_OFFSET_FACTOR=32824]="POLYGON_OFFSET_FACTOR",r[r.TEXTURE_BINDING_2D=32873]="TEXTURE_BINDING_2D",r[r.SAMPLE_BUFFERS=32936]="SAMPLE_BUFFERS",r[r.SAMPLES=32937]="SAMPLES",r[r.SAMPLE_COVERAGE_VALUE=32938]="SAMPLE_COVERAGE_VALUE",r[r.SAMPLE_COVERAGE_INVERT=32939]="SAMPLE_COVERAGE_INVERT",r[r.COMPRESSED_TEXTURE_FORMATS=34467]="COMPRESSED_TEXTURE_FORMATS",r[r.VENDOR=7936]="VENDOR",r[r.RENDERER=7937]="RENDERER",r[r.VERSION=7938]="VERSION",r[r.IMPLEMENTATION_COLOR_READ_TYPE=35738]="IMPLEMENTATION_COLOR_READ_TYPE",r[r.IMPLEMENTATION_COLOR_READ_FORMAT=35739]="IMPLEMENTATION_COLOR_READ_FORMAT",r[r.BROWSER_DEFAULT_WEBGL=37444]="BROWSER_DEFAULT_WEBGL",r[r.STATIC_DRAW=35044]="STATIC_DRAW",r[r.STREAM_DRAW=35040]="STREAM_DRAW",r[r.DYNAMIC_DRAW=35048]="DYNAMIC_DRAW",r[r.ARRAY_BUFFER=34962]="ARRAY_BUFFER",r[r.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",r[r.BUFFER_SIZE=34660]="BUFFER_SIZE",r[r.BUFFER_USAGE=34661]="BUFFER_USAGE",r[r.CURRENT_VERTEX_ATTRIB=34342]="CURRENT_VERTEX_ATTRIB",r[r.VERTEX_ATTRIB_ARRAY_ENABLED=34338]="VERTEX_ATTRIB_ARRAY_ENABLED",r[r.VERTEX_ATTRIB_ARRAY_SIZE=34339]="VERTEX_ATTRIB_ARRAY_SIZE",r[r.VERTEX_ATTRIB_ARRAY_STRIDE=34340]="VERTEX_ATTRIB_ARRAY_STRIDE",r[r.VERTEX_ATTRIB_ARRAY_TYPE=34341]="VERTEX_ATTRIB_ARRAY_TYPE",r[r.VERTEX_ATTRIB_ARRAY_NORMALIZED=34922]="VERTEX_ATTRIB_ARRAY_NORMALIZED",r[r.VERTEX_ATTRIB_ARRAY_POINTER=34373]="VERTEX_ATTRIB_ARRAY_POINTER",r[r.VERTEX_ATTRIB_ARRAY_BUFFER_BINDING=34975]="VERTEX_ATTRIB_ARRAY_BUFFER_BINDING",r[r.CULL_FACE=2884]="CULL_FACE",r[r.FRONT=1028]="FRONT",r[r.BACK=1029]="BACK",r[r.FRONT_AND_BACK=1032]="FRONT_AND_BACK",r[r.BLEND=3042]="BLEND",r[r.DEPTH_TEST=2929]="DEPTH_TEST",r[r.DITHER=3024]="DITHER",r[r.POLYGON_OFFSET_FILL=32823]="POLYGON_OFFSET_FILL",r[r.SAMPLE_ALPHA_TO_COVERAGE=32926]="SAMPLE_ALPHA_TO_COVERAGE",r[r.SAMPLE_COVERAGE=32928]="SAMPLE_COVERAGE",r[r.SCISSOR_TEST=3089]="SCISSOR_TEST",r[r.STENCIL_TEST=2960]="STENCIL_TEST",r[r.NO_ERROR=0]="NO_ERROR",r[r.INVALID_ENUM=1280]="INVALID_ENUM",r[r.INVALID_VALUE=1281]="INVALID_VALUE",r[r.INVALID_OPERATION=1282]="INVALID_OPERATION",r[r.OUT_OF_MEMORY=1285]="OUT_OF_MEMORY",r[r.CONTEXT_LOST_WEBGL=37442]="CONTEXT_LOST_WEBGL",r[r.CW=2304]="CW",r[r.CCW=2305]="CCW",r[r.DONT_CARE=4352]="DONT_CARE",r[r.FASTEST=4353]="FASTEST",r[r.NICEST=4354]="NICEST",r[r.GENERATE_MIPMAP_HINT=33170]="GENERATE_MIPMAP_HINT",r[r.BYTE=5120]="BYTE",r[r.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",r[r.SHORT=5122]="SHORT",r[r.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",r[r.INT=5124]="INT",r[r.UNSIGNED_INT=5125]="UNSIGNED_INT",r[r.FLOAT=5126]="FLOAT",r[r.DOUBLE=5130]="DOUBLE",r[r.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",r[r.ALPHA=6406]="ALPHA",r[r.RGB=6407]="RGB",r[r.RGBA=6408]="RGBA",r[r.LUMINANCE=6409]="LUMINANCE",r[r.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",r[r.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",r[r.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",r[r.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",r[r.FRAGMENT_SHADER=35632]="FRAGMENT_SHADER",r[r.VERTEX_SHADER=35633]="VERTEX_SHADER",r[r.COMPILE_STATUS=35713]="COMPILE_STATUS",r[r.DELETE_STATUS=35712]="DELETE_STATUS",r[r.LINK_STATUS=35714]="LINK_STATUS",r[r.VALIDATE_STATUS=35715]="VALIDATE_STATUS",r[r.ATTACHED_SHADERS=35717]="ATTACHED_SHADERS",r[r.ACTIVE_ATTRIBUTES=35721]="ACTIVE_ATTRIBUTES",r[r.ACTIVE_UNIFORMS=35718]="ACTIVE_UNIFORMS",r[r.MAX_VERTEX_ATTRIBS=34921]="MAX_VERTEX_ATTRIBS",r[r.MAX_VERTEX_UNIFORM_VECTORS=36347]="MAX_VERTEX_UNIFORM_VECTORS",r[r.MAX_VARYING_VECTORS=36348]="MAX_VARYING_VECTORS",r[r.MAX_COMBINED_TEXTURE_IMAGE_UNITS=35661]="MAX_COMBINED_TEXTURE_IMAGE_UNITS",r[r.MAX_VERTEX_TEXTURE_IMAGE_UNITS=35660]="MAX_VERTEX_TEXTURE_IMAGE_UNITS",r[r.MAX_TEXTURE_IMAGE_UNITS=34930]="MAX_TEXTURE_IMAGE_UNITS",r[r.MAX_FRAGMENT_UNIFORM_VECTORS=36349]="MAX_FRAGMENT_UNIFORM_VECTORS",r[r.SHADER_TYPE=35663]="SHADER_TYPE",r[r.SHADING_LANGUAGE_VERSION=35724]="SHADING_LANGUAGE_VERSION",r[r.CURRENT_PROGRAM=35725]="CURRENT_PROGRAM",r[r.NEVER=512]="NEVER",r[r.LESS=513]="LESS",r[r.EQUAL=514]="EQUAL",r[r.LEQUAL=515]="LEQUAL",r[r.GREATER=516]="GREATER",r[r.NOTEQUAL=517]="NOTEQUAL",r[r.GEQUAL=518]="GEQUAL",r[r.ALWAYS=519]="ALWAYS",r[r.KEEP=7680]="KEEP",r[r.REPLACE=7681]="REPLACE",r[r.INCR=7682]="INCR",r[r.DECR=7683]="DECR",r[r.INVERT=5386]="INVERT",r[r.INCR_WRAP=34055]="INCR_WRAP",r[r.DECR_WRAP=34056]="DECR_WRAP",r[r.NEAREST=9728]="NEAREST",r[r.LINEAR=9729]="LINEAR",r[r.NEAREST_MIPMAP_NEAREST=9984]="NEAREST_MIPMAP_NEAREST",r[r.LINEAR_MIPMAP_NEAREST=9985]="LINEAR_MIPMAP_NEAREST",r[r.NEAREST_MIPMAP_LINEAR=9986]="NEAREST_MIPMAP_LINEAR",r[r.LINEAR_MIPMAP_LINEAR=9987]="LINEAR_MIPMAP_LINEAR",r[r.TEXTURE_MAG_FILTER=10240]="TEXTURE_MAG_FILTER",r[r.TEXTURE_MIN_FILTER=10241]="TEXTURE_MIN_FILTER",r[r.TEXTURE_WRAP_S=10242]="TEXTURE_WRAP_S",r[r.TEXTURE_WRAP_T=10243]="TEXTURE_WRAP_T",r[r.TEXTURE_2D=3553]="TEXTURE_2D",r[r.TEXTURE=5890]="TEXTURE",r[r.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",r[r.TEXTURE_BINDING_CUBE_MAP=34068]="TEXTURE_BINDING_CUBE_MAP",r[r.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",r[r.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",r[r.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",r[r.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",r[r.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",r[r.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z",r[r.MAX_CUBE_MAP_TEXTURE_SIZE=34076]="MAX_CUBE_MAP_TEXTURE_SIZE",r[r.TEXTURE0=33984]="TEXTURE0",r[r.ACTIVE_TEXTURE=34016]="ACTIVE_TEXTURE",r[r.REPEAT=10497]="REPEAT",r[r.CLAMP_TO_EDGE=33071]="CLAMP_TO_EDGE",r[r.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT",r[r.TEXTURE_WIDTH=4096]="TEXTURE_WIDTH",r[r.TEXTURE_HEIGHT=4097]="TEXTURE_HEIGHT",r[r.FLOAT_VEC2=35664]="FLOAT_VEC2",r[r.FLOAT_VEC3=35665]="FLOAT_VEC3",r[r.FLOAT_VEC4=35666]="FLOAT_VEC4",r[r.INT_VEC2=35667]="INT_VEC2",r[r.INT_VEC3=35668]="INT_VEC3",r[r.INT_VEC4=35669]="INT_VEC4",r[r.BOOL=35670]="BOOL",r[r.BOOL_VEC2=35671]="BOOL_VEC2",r[r.BOOL_VEC3=35672]="BOOL_VEC3",r[r.BOOL_VEC4=35673]="BOOL_VEC4",r[r.FLOAT_MAT2=35674]="FLOAT_MAT2",r[r.FLOAT_MAT3=35675]="FLOAT_MAT3",r[r.FLOAT_MAT4=35676]="FLOAT_MAT4",r[r.SAMPLER_2D=35678]="SAMPLER_2D",r[r.SAMPLER_CUBE=35680]="SAMPLER_CUBE",r[r.LOW_FLOAT=36336]="LOW_FLOAT",r[r.MEDIUM_FLOAT=36337]="MEDIUM_FLOAT",r[r.HIGH_FLOAT=36338]="HIGH_FLOAT",r[r.LOW_INT=36339]="LOW_INT",r[r.MEDIUM_INT=36340]="MEDIUM_INT",r[r.HIGH_INT=36341]="HIGH_INT",r[r.FRAMEBUFFER=36160]="FRAMEBUFFER",r[r.RENDERBUFFER=36161]="RENDERBUFFER",r[r.RGBA4=32854]="RGBA4",r[r.RGB5_A1=32855]="RGB5_A1",r[r.RGB565=36194]="RGB565",r[r.DEPTH_COMPONENT16=33189]="DEPTH_COMPONENT16",r[r.STENCIL_INDEX=6401]="STENCIL_INDEX",r[r.STENCIL_INDEX8=36168]="STENCIL_INDEX8",r[r.DEPTH_STENCIL=34041]="DEPTH_STENCIL",r[r.RENDERBUFFER_WIDTH=36162]="RENDERBUFFER_WIDTH",r[r.RENDERBUFFER_HEIGHT=36163]="RENDERBUFFER_HEIGHT",r[r.RENDERBUFFER_INTERNAL_FORMAT=36164]="RENDERBUFFER_INTERNAL_FORMAT",r[r.RENDERBUFFER_RED_SIZE=36176]="RENDERBUFFER_RED_SIZE",r[r.RENDERBUFFER_GREEN_SIZE=36177]="RENDERBUFFER_GREEN_SIZE",r[r.RENDERBUFFER_BLUE_SIZE=36178]="RENDERBUFFER_BLUE_SIZE",r[r.RENDERBUFFER_ALPHA_SIZE=36179]="RENDERBUFFER_ALPHA_SIZE",r[r.RENDERBUFFER_DEPTH_SIZE=36180]="RENDERBUFFER_DEPTH_SIZE",r[r.RENDERBUFFER_STENCIL_SIZE=36181]="RENDERBUFFER_STENCIL_SIZE",r[r.FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE=36048]="FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE",r[r.FRAMEBUFFER_ATTACHMENT_OBJECT_NAME=36049]="FRAMEBUFFER_ATTACHMENT_OBJECT_NAME",r[r.FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL=36050]="FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL",r[r.FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE=36051]="FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE",r[r.COLOR_ATTACHMENT0=36064]="COLOR_ATTACHMENT0",r[r.DEPTH_ATTACHMENT=36096]="DEPTH_ATTACHMENT",r[r.STENCIL_ATTACHMENT=36128]="STENCIL_ATTACHMENT",r[r.DEPTH_STENCIL_ATTACHMENT=33306]="DEPTH_STENCIL_ATTACHMENT",r[r.NONE=0]="NONE",r[r.FRAMEBUFFER_COMPLETE=36053]="FRAMEBUFFER_COMPLETE",r[r.FRAMEBUFFER_INCOMPLETE_ATTACHMENT=36054]="FRAMEBUFFER_INCOMPLETE_ATTACHMENT",r[r.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT=36055]="FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT",r[r.FRAMEBUFFER_INCOMPLETE_DIMENSIONS=36057]="FRAMEBUFFER_INCOMPLETE_DIMENSIONS",r[r.FRAMEBUFFER_UNSUPPORTED=36061]="FRAMEBUFFER_UNSUPPORTED",r[r.FRAMEBUFFER_BINDING=36006]="FRAMEBUFFER_BINDING",r[r.RENDERBUFFER_BINDING=36007]="RENDERBUFFER_BINDING",r[r.READ_FRAMEBUFFER=36008]="READ_FRAMEBUFFER",r[r.DRAW_FRAMEBUFFER=36009]="DRAW_FRAMEBUFFER",r[r.MAX_RENDERBUFFER_SIZE=34024]="MAX_RENDERBUFFER_SIZE",r[r.INVALID_FRAMEBUFFER_OPERATION=1286]="INVALID_FRAMEBUFFER_OPERATION",r[r.UNPACK_FLIP_Y_WEBGL=37440]="UNPACK_FLIP_Y_WEBGL",r[r.UNPACK_PREMULTIPLY_ALPHA_WEBGL=37441]="UNPACK_PREMULTIPLY_ALPHA_WEBGL",r[r.UNPACK_COLORSPACE_CONVERSION_WEBGL=37443]="UNPACK_COLORSPACE_CONVERSION_WEBGL",r[r.READ_BUFFER=3074]="READ_BUFFER",r[r.UNPACK_ROW_LENGTH=3314]="UNPACK_ROW_LENGTH",r[r.UNPACK_SKIP_ROWS=3315]="UNPACK_SKIP_ROWS",r[r.UNPACK_SKIP_PIXELS=3316]="UNPACK_SKIP_PIXELS",r[r.PACK_ROW_LENGTH=3330]="PACK_ROW_LENGTH",r[r.PACK_SKIP_ROWS=3331]="PACK_SKIP_ROWS",r[r.PACK_SKIP_PIXELS=3332]="PACK_SKIP_PIXELS",r[r.TEXTURE_BINDING_3D=32874]="TEXTURE_BINDING_3D",r[r.UNPACK_SKIP_IMAGES=32877]="UNPACK_SKIP_IMAGES",r[r.UNPACK_IMAGE_HEIGHT=32878]="UNPACK_IMAGE_HEIGHT",r[r.MAX_3D_TEXTURE_SIZE=32883]="MAX_3D_TEXTURE_SIZE",r[r.MAX_ELEMENTS_VERTICES=33e3]="MAX_ELEMENTS_VERTICES",r[r.MAX_ELEMENTS_INDICES=33001]="MAX_ELEMENTS_INDICES",r[r.MAX_TEXTURE_LOD_BIAS=34045]="MAX_TEXTURE_LOD_BIAS",r[r.MAX_FRAGMENT_UNIFORM_COMPONENTS=35657]="MAX_FRAGMENT_UNIFORM_COMPONENTS",r[r.MAX_VERTEX_UNIFORM_COMPONENTS=35658]="MAX_VERTEX_UNIFORM_COMPONENTS",r[r.MAX_ARRAY_TEXTURE_LAYERS=35071]="MAX_ARRAY_TEXTURE_LAYERS",r[r.MIN_PROGRAM_TEXEL_OFFSET=35076]="MIN_PROGRAM_TEXEL_OFFSET",r[r.MAX_PROGRAM_TEXEL_OFFSET=35077]="MAX_PROGRAM_TEXEL_OFFSET",r[r.MAX_VARYING_COMPONENTS=35659]="MAX_VARYING_COMPONENTS",r[r.FRAGMENT_SHADER_DERIVATIVE_HINT=35723]="FRAGMENT_SHADER_DERIVATIVE_HINT",r[r.RASTERIZER_DISCARD=35977]="RASTERIZER_DISCARD",r[r.VERTEX_ARRAY_BINDING=34229]="VERTEX_ARRAY_BINDING",r[r.MAX_VERTEX_OUTPUT_COMPONENTS=37154]="MAX_VERTEX_OUTPUT_COMPONENTS",r[r.MAX_FRAGMENT_INPUT_COMPONENTS=37157]="MAX_FRAGMENT_INPUT_COMPONENTS",r[r.MAX_SERVER_WAIT_TIMEOUT=37137]="MAX_SERVER_WAIT_TIMEOUT",r[r.MAX_ELEMENT_INDEX=36203]="MAX_ELEMENT_INDEX",r[r.RED=6403]="RED",r[r.RGB8=32849]="RGB8",r[r.RGBA8=32856]="RGBA8",r[r.RGB10_A2=32857]="RGB10_A2",r[r.TEXTURE_3D=32879]="TEXTURE_3D",r[r.TEXTURE_WRAP_R=32882]="TEXTURE_WRAP_R",r[r.TEXTURE_MIN_LOD=33082]="TEXTURE_MIN_LOD",r[r.TEXTURE_MAX_LOD=33083]="TEXTURE_MAX_LOD",r[r.TEXTURE_BASE_LEVEL=33084]="TEXTURE_BASE_LEVEL",r[r.TEXTURE_MAX_LEVEL=33085]="TEXTURE_MAX_LEVEL",r[r.TEXTURE_COMPARE_MODE=34892]="TEXTURE_COMPARE_MODE",r[r.TEXTURE_COMPARE_FUNC=34893]="TEXTURE_COMPARE_FUNC",r[r.SRGB=35904]="SRGB",r[r.SRGB8=35905]="SRGB8",r[r.SRGB8_ALPHA8=35907]="SRGB8_ALPHA8",r[r.COMPARE_REF_TO_TEXTURE=34894]="COMPARE_REF_TO_TEXTURE",r[r.RGBA32F=34836]="RGBA32F",r[r.RGB32F=34837]="RGB32F",r[r.RGBA16F=34842]="RGBA16F",r[r.RGB16F=34843]="RGB16F",r[r.TEXTURE_2D_ARRAY=35866]="TEXTURE_2D_ARRAY",r[r.TEXTURE_BINDING_2D_ARRAY=35869]="TEXTURE_BINDING_2D_ARRAY",r[r.R11F_G11F_B10F=35898]="R11F_G11F_B10F",r[r.RGB9_E5=35901]="RGB9_E5",r[r.RGBA32UI=36208]="RGBA32UI",r[r.RGB32UI=36209]="RGB32UI",r[r.RGBA16UI=36214]="RGBA16UI",r[r.RGB16UI=36215]="RGB16UI",r[r.RGBA8UI=36220]="RGBA8UI",r[r.RGB8UI=36221]="RGB8UI",r[r.RGBA32I=36226]="RGBA32I",r[r.RGB32I=36227]="RGB32I",r[r.RGBA16I=36232]="RGBA16I",r[r.RGB16I=36233]="RGB16I",r[r.RGBA8I=36238]="RGBA8I",r[r.RGB8I=36239]="RGB8I",r[r.RED_INTEGER=36244]="RED_INTEGER",r[r.RGB_INTEGER=36248]="RGB_INTEGER",r[r.RGBA_INTEGER=36249]="RGBA_INTEGER",r[r.R8=33321]="R8",r[r.RG8=33323]="RG8",r[r.R16F=33325]="R16F",r[r.R32F=33326]="R32F",r[r.RG16F=33327]="RG16F",r[r.RG32F=33328]="RG32F",r[r.R8I=33329]="R8I",r[r.R8UI=33330]="R8UI",r[r.R16I=33331]="R16I",r[r.R16UI=33332]="R16UI",r[r.R32I=33333]="R32I",r[r.R32UI=33334]="R32UI",r[r.RG8I=33335]="RG8I",r[r.RG8UI=33336]="RG8UI",r[r.RG16I=33337]="RG16I",r[r.RG16UI=33338]="RG16UI",r[r.RG32I=33339]="RG32I",r[r.RG32UI=33340]="RG32UI",r[r.R8_SNORM=36756]="R8_SNORM",r[r.RG8_SNORM=36757]="RG8_SNORM",r[r.RGB8_SNORM=36758]="RGB8_SNORM",r[r.RGBA8_SNORM=36759]="RGBA8_SNORM",r[r.RGB10_A2UI=36975]="RGB10_A2UI",r[r.TEXTURE_IMMUTABLE_FORMAT=37167]="TEXTURE_IMMUTABLE_FORMAT",r[r.TEXTURE_IMMUTABLE_LEVELS=33503]="TEXTURE_IMMUTABLE_LEVELS",r[r.UNSIGNED_INT_2_10_10_10_REV=33640]="UNSIGNED_INT_2_10_10_10_REV",r[r.UNSIGNED_INT_10F_11F_11F_REV=35899]="UNSIGNED_INT_10F_11F_11F_REV",r[r.UNSIGNED_INT_5_9_9_9_REV=35902]="UNSIGNED_INT_5_9_9_9_REV",r[r.FLOAT_32_UNSIGNED_INT_24_8_REV=36269]="FLOAT_32_UNSIGNED_INT_24_8_REV",r[r.UNSIGNED_INT_24_8=34042]="UNSIGNED_INT_24_8",r[r.HALF_FLOAT=5131]="HALF_FLOAT",r[r.RG=33319]="RG",r[r.RG_INTEGER=33320]="RG_INTEGER",r[r.INT_2_10_10_10_REV=36255]="INT_2_10_10_10_REV",r[r.CURRENT_QUERY=34917]="CURRENT_QUERY",r[r.QUERY_RESULT=34918]="QUERY_RESULT",r[r.QUERY_RESULT_AVAILABLE=34919]="QUERY_RESULT_AVAILABLE",r[r.ANY_SAMPLES_PASSED=35887]="ANY_SAMPLES_PASSED",r[r.ANY_SAMPLES_PASSED_CONSERVATIVE=36202]="ANY_SAMPLES_PASSED_CONSERVATIVE",r[r.MAX_DRAW_BUFFERS=34852]="MAX_DRAW_BUFFERS",r[r.DRAW_BUFFER0=34853]="DRAW_BUFFER0",r[r.DRAW_BUFFER1=34854]="DRAW_BUFFER1",r[r.DRAW_BUFFER2=34855]="DRAW_BUFFER2",r[r.DRAW_BUFFER3=34856]="DRAW_BUFFER3",r[r.DRAW_BUFFER4=34857]="DRAW_BUFFER4",r[r.DRAW_BUFFER5=34858]="DRAW_BUFFER5",r[r.DRAW_BUFFER6=34859]="DRAW_BUFFER6",r[r.DRAW_BUFFER7=34860]="DRAW_BUFFER7",r[r.DRAW_BUFFER8=34861]="DRAW_BUFFER8",r[r.DRAW_BUFFER9=34862]="DRAW_BUFFER9",r[r.DRAW_BUFFER10=34863]="DRAW_BUFFER10",r[r.DRAW_BUFFER11=34864]="DRAW_BUFFER11",r[r.DRAW_BUFFER12=34865]="DRAW_BUFFER12",r[r.DRAW_BUFFER13=34866]="DRAW_BUFFER13",r[r.DRAW_BUFFER14=34867]="DRAW_BUFFER14",r[r.DRAW_BUFFER15=34868]="DRAW_BUFFER15",r[r.MAX_COLOR_ATTACHMENTS=36063]="MAX_COLOR_ATTACHMENTS",r[r.COLOR_ATTACHMENT1=36065]="COLOR_ATTACHMENT1",r[r.COLOR_ATTACHMENT2=36066]="COLOR_ATTACHMENT2",r[r.COLOR_ATTACHMENT3=36067]="COLOR_ATTACHMENT3",r[r.COLOR_ATTACHMENT4=36068]="COLOR_ATTACHMENT4",r[r.COLOR_ATTACHMENT5=36069]="COLOR_ATTACHMENT5",r[r.COLOR_ATTACHMENT6=36070]="COLOR_ATTACHMENT6",r[r.COLOR_ATTACHMENT7=36071]="COLOR_ATTACHMENT7",r[r.COLOR_ATTACHMENT8=36072]="COLOR_ATTACHMENT8",r[r.COLOR_ATTACHMENT9=36073]="COLOR_ATTACHMENT9",r[r.COLOR_ATTACHMENT10=36074]="COLOR_ATTACHMENT10",r[r.COLOR_ATTACHMENT11=36075]="COLOR_ATTACHMENT11",r[r.COLOR_ATTACHMENT12=36076]="COLOR_ATTACHMENT12",r[r.COLOR_ATTACHMENT13=36077]="COLOR_ATTACHMENT13",r[r.COLOR_ATTACHMENT14=36078]="COLOR_ATTACHMENT14",r[r.COLOR_ATTACHMENT15=36079]="COLOR_ATTACHMENT15",r[r.SAMPLER_3D=35679]="SAMPLER_3D",r[r.SAMPLER_2D_SHADOW=35682]="SAMPLER_2D_SHADOW",r[r.SAMPLER_2D_ARRAY=36289]="SAMPLER_2D_ARRAY",r[r.SAMPLER_2D_ARRAY_SHADOW=36292]="SAMPLER_2D_ARRAY_SHADOW",r[r.SAMPLER_CUBE_SHADOW=36293]="SAMPLER_CUBE_SHADOW",r[r.INT_SAMPLER_2D=36298]="INT_SAMPLER_2D",r[r.INT_SAMPLER_3D=36299]="INT_SAMPLER_3D",r[r.INT_SAMPLER_CUBE=36300]="INT_SAMPLER_CUBE",r[r.INT_SAMPLER_2D_ARRAY=36303]="INT_SAMPLER_2D_ARRAY",r[r.UNSIGNED_INT_SAMPLER_2D=36306]="UNSIGNED_INT_SAMPLER_2D",r[r.UNSIGNED_INT_SAMPLER_3D=36307]="UNSIGNED_INT_SAMPLER_3D",r[r.UNSIGNED_INT_SAMPLER_CUBE=36308]="UNSIGNED_INT_SAMPLER_CUBE",r[r.UNSIGNED_INT_SAMPLER_2D_ARRAY=36311]="UNSIGNED_INT_SAMPLER_2D_ARRAY",r[r.MAX_SAMPLES=36183]="MAX_SAMPLES",r[r.SAMPLER_BINDING=35097]="SAMPLER_BINDING",r[r.PIXEL_PACK_BUFFER=35051]="PIXEL_PACK_BUFFER",r[r.PIXEL_UNPACK_BUFFER=35052]="PIXEL_UNPACK_BUFFER",r[r.PIXEL_PACK_BUFFER_BINDING=35053]="PIXEL_PACK_BUFFER_BINDING",r[r.PIXEL_UNPACK_BUFFER_BINDING=35055]="PIXEL_UNPACK_BUFFER_BINDING",r[r.COPY_READ_BUFFER=36662]="COPY_READ_BUFFER",r[r.COPY_WRITE_BUFFER=36663]="COPY_WRITE_BUFFER",r[r.COPY_READ_BUFFER_BINDING=36662]="COPY_READ_BUFFER_BINDING",r[r.COPY_WRITE_BUFFER_BINDING=36663]="COPY_WRITE_BUFFER_BINDING",r[r.FLOAT_MAT2x3=35685]="FLOAT_MAT2x3",r[r.FLOAT_MAT2x4=35686]="FLOAT_MAT2x4",r[r.FLOAT_MAT3x2=35687]="FLOAT_MAT3x2",r[r.FLOAT_MAT3x4=35688]="FLOAT_MAT3x4",r[r.FLOAT_MAT4x2=35689]="FLOAT_MAT4x2",r[r.FLOAT_MAT4x3=35690]="FLOAT_MAT4x3",r[r.UNSIGNED_INT_VEC2=36294]="UNSIGNED_INT_VEC2",r[r.UNSIGNED_INT_VEC3=36295]="UNSIGNED_INT_VEC3",r[r.UNSIGNED_INT_VEC4=36296]="UNSIGNED_INT_VEC4",r[r.UNSIGNED_NORMALIZED=35863]="UNSIGNED_NORMALIZED",r[r.SIGNED_NORMALIZED=36764]="SIGNED_NORMALIZED",r[r.VERTEX_ATTRIB_ARRAY_INTEGER=35069]="VERTEX_ATTRIB_ARRAY_INTEGER",r[r.VERTEX_ATTRIB_ARRAY_DIVISOR=35070]="VERTEX_ATTRIB_ARRAY_DIVISOR",r[r.TRANSFORM_FEEDBACK_BUFFER_MODE=35967]="TRANSFORM_FEEDBACK_BUFFER_MODE",r[r.MAX_TRANSFORM_FEEDBACK_SEPARATE_COMPONENTS=35968]="MAX_TRANSFORM_FEEDBACK_SEPARATE_COMPONENTS",r[r.TRANSFORM_FEEDBACK_VARYINGS=35971]="TRANSFORM_FEEDBACK_VARYINGS",r[r.TRANSFORM_FEEDBACK_BUFFER_START=35972]="TRANSFORM_FEEDBACK_BUFFER_START",r[r.TRANSFORM_FEEDBACK_BUFFER_SIZE=35973]="TRANSFORM_FEEDBACK_BUFFER_SIZE",r[r.TRANSFORM_FEEDBACK_PRIMITIVES_WRITTEN=35976]="TRANSFORM_FEEDBACK_PRIMITIVES_WRITTEN",r[r.MAX_TRANSFORM_FEEDBACK_INTERLEAVED_COMPONENTS=35978]="MAX_TRANSFORM_FEEDBACK_INTERLEAVED_COMPONENTS",r[r.MAX_TRANSFORM_FEEDBACK_SEPARATE_ATTRIBS=35979]="MAX_TRANSFORM_FEEDBACK_SEPARATE_ATTRIBS",r[r.INTERLEAVED_ATTRIBS=35980]="INTERLEAVED_ATTRIBS",r[r.SEPARATE_ATTRIBS=35981]="SEPARATE_ATTRIBS",r[r.TRANSFORM_FEEDBACK_BUFFER=35982]="TRANSFORM_FEEDBACK_BUFFER",r[r.TRANSFORM_FEEDBACK_BUFFER_BINDING=35983]="TRANSFORM_FEEDBACK_BUFFER_BINDING",r[r.TRANSFORM_FEEDBACK=36386]="TRANSFORM_FEEDBACK",r[r.TRANSFORM_FEEDBACK_PAUSED=36387]="TRANSFORM_FEEDBACK_PAUSED",r[r.TRANSFORM_FEEDBACK_ACTIVE=36388]="TRANSFORM_FEEDBACK_ACTIVE",r[r.TRANSFORM_FEEDBACK_BINDING=36389]="TRANSFORM_FEEDBACK_BINDING",r[r.FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING=33296]="FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING",r[r.FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE=33297]="FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE",r[r.FRAMEBUFFER_ATTACHMENT_RED_SIZE=33298]="FRAMEBUFFER_ATTACHMENT_RED_SIZE",r[r.FRAMEBUFFER_ATTACHMENT_GREEN_SIZE=33299]="FRAMEBUFFER_ATTACHMENT_GREEN_SIZE",r[r.FRAMEBUFFER_ATTACHMENT_BLUE_SIZE=33300]="FRAMEBUFFER_ATTACHMENT_BLUE_SIZE",r[r.FRAMEBUFFER_ATTACHMENT_ALPHA_SIZE=33301]="FRAMEBUFFER_ATTACHMENT_ALPHA_SIZE",r[r.FRAMEBUFFER_ATTACHMENT_DEPTH_SIZE=33302]="FRAMEBUFFER_ATTACHMENT_DEPTH_SIZE",r[r.FRAMEBUFFER_ATTACHMENT_STENCIL_SIZE=33303]="FRAMEBUFFER_ATTACHMENT_STENCIL_SIZE",r[r.FRAMEBUFFER_DEFAULT=33304]="FRAMEBUFFER_DEFAULT",r[r.DEPTH24_STENCIL8=35056]="DEPTH24_STENCIL8",r[r.DRAW_FRAMEBUFFER_BINDING=36006]="DRAW_FRAMEBUFFER_BINDING",r[r.READ_FRAMEBUFFER_BINDING=36010]="READ_FRAMEBUFFER_BINDING",r[r.RENDERBUFFER_SAMPLES=36011]="RENDERBUFFER_SAMPLES",r[r.FRAMEBUFFER_ATTACHMENT_TEXTURE_LAYER=36052]="FRAMEBUFFER_ATTACHMENT_TEXTURE_LAYER",r[r.FRAMEBUFFER_INCOMPLETE_MULTISAMPLE=36182]="FRAMEBUFFER_INCOMPLETE_MULTISAMPLE",r[r.UNIFORM_BUFFER=35345]="UNIFORM_BUFFER",r[r.UNIFORM_BUFFER_BINDING=35368]="UNIFORM_BUFFER_BINDING",r[r.UNIFORM_BUFFER_START=35369]="UNIFORM_BUFFER_START",r[r.UNIFORM_BUFFER_SIZE=35370]="UNIFORM_BUFFER_SIZE",r[r.MAX_VERTEX_UNIFORM_BLOCKS=35371]="MAX_VERTEX_UNIFORM_BLOCKS",r[r.MAX_FRAGMENT_UNIFORM_BLOCKS=35373]="MAX_FRAGMENT_UNIFORM_BLOCKS",r[r.MAX_COMBINED_UNIFORM_BLOCKS=35374]="MAX_COMBINED_UNIFORM_BLOCKS",r[r.MAX_UNIFORM_BUFFER_BINDINGS=35375]="MAX_UNIFORM_BUFFER_BINDINGS",r[r.MAX_UNIFORM_BLOCK_SIZE=35376]="MAX_UNIFORM_BLOCK_SIZE",r[r.MAX_COMBINED_VERTEX_UNIFORM_COMPONENTS=35377]="MAX_COMBINED_VERTEX_UNIFORM_COMPONENTS",r[r.MAX_COMBINED_FRAGMENT_UNIFORM_COMPONENTS=35379]="MAX_COMBINED_FRAGMENT_UNIFORM_COMPONENTS",r[r.UNIFORM_BUFFER_OFFSET_ALIGNMENT=35380]="UNIFORM_BUFFER_OFFSET_ALIGNMENT",r[r.ACTIVE_UNIFORM_BLOCKS=35382]="ACTIVE_UNIFORM_BLOCKS",r[r.UNIFORM_TYPE=35383]="UNIFORM_TYPE",r[r.UNIFORM_SIZE=35384]="UNIFORM_SIZE",r[r.UNIFORM_BLOCK_INDEX=35386]="UNIFORM_BLOCK_INDEX",r[r.UNIFORM_OFFSET=35387]="UNIFORM_OFFSET",r[r.UNIFORM_ARRAY_STRIDE=35388]="UNIFORM_ARRAY_STRIDE",r[r.UNIFORM_MATRIX_STRIDE=35389]="UNIFORM_MATRIX_STRIDE",r[r.UNIFORM_IS_ROW_MAJOR=35390]="UNIFORM_IS_ROW_MAJOR",r[r.UNIFORM_BLOCK_BINDING=35391]="UNIFORM_BLOCK_BINDING",r[r.UNIFORM_BLOCK_DATA_SIZE=35392]="UNIFORM_BLOCK_DATA_SIZE",r[r.UNIFORM_BLOCK_ACTIVE_UNIFORMS=35394]="UNIFORM_BLOCK_ACTIVE_UNIFORMS",r[r.UNIFORM_BLOCK_ACTIVE_UNIFORM_INDICES=35395]="UNIFORM_BLOCK_ACTIVE_UNIFORM_INDICES",r[r.UNIFORM_BLOCK_REFERENCED_BY_VERTEX_SHADER=35396]="UNIFORM_BLOCK_REFERENCED_BY_VERTEX_SHADER",r[r.UNIFORM_BLOCK_REFERENCED_BY_FRAGMENT_SHADER=35398]="UNIFORM_BLOCK_REFERENCED_BY_FRAGMENT_SHADER",r[r.OBJECT_TYPE=37138]="OBJECT_TYPE",r[r.SYNC_CONDITION=37139]="SYNC_CONDITION",r[r.SYNC_STATUS=37140]="SYNC_STATUS",r[r.SYNC_FLAGS=37141]="SYNC_FLAGS",r[r.SYNC_FENCE=37142]="SYNC_FENCE",r[r.SYNC_GPU_COMMANDS_COMPLETE=37143]="SYNC_GPU_COMMANDS_COMPLETE",r[r.UNSIGNALED=37144]="UNSIGNALED",r[r.SIGNALED=37145]="SIGNALED",r[r.ALREADY_SIGNALED=37146]="ALREADY_SIGNALED",r[r.TIMEOUT_EXPIRED=37147]="TIMEOUT_EXPIRED",r[r.CONDITION_SATISFIED=37148]="CONDITION_SATISFIED",r[r.WAIT_FAILED=37149]="WAIT_FAILED",r[r.SYNC_FLUSH_COMMANDS_BIT=1]="SYNC_FLUSH_COMMANDS_BIT",r[r.COLOR=6144]="COLOR",r[r.DEPTH=6145]="DEPTH",r[r.STENCIL=6146]="STENCIL",r[r.MIN=32775]="MIN",r[r.MAX=32776]="MAX",r[r.DEPTH_COMPONENT24=33190]="DEPTH_COMPONENT24",r[r.STREAM_READ=35041]="STREAM_READ",r[r.STREAM_COPY=35042]="STREAM_COPY",r[r.STATIC_READ=35045]="STATIC_READ",r[r.STATIC_COPY=35046]="STATIC_COPY",r[r.DYNAMIC_READ=35049]="DYNAMIC_READ",r[r.DYNAMIC_COPY=35050]="DYNAMIC_COPY",r[r.DEPTH_COMPONENT32F=36012]="DEPTH_COMPONENT32F",r[r.DEPTH32F_STENCIL8=36013]="DEPTH32F_STENCIL8",r[r.INVALID_INDEX=4294967295]="INVALID_INDEX",r[r.TIMEOUT_IGNORED=-1]="TIMEOUT_IGNORED",r[r.MAX_CLIENT_WAIT_TIMEOUT_WEBGL=37447]="MAX_CLIENT_WAIT_TIMEOUT_WEBGL",r[r.UNMASKED_VENDOR_WEBGL=37445]="UNMASKED_VENDOR_WEBGL",r[r.UNMASKED_RENDERER_WEBGL=37446]="UNMASKED_RENDERER_WEBGL",r[r.MAX_TEXTURE_MAX_ANISOTROPY_EXT=34047]="MAX_TEXTURE_MAX_ANISOTROPY_EXT",r[r.TEXTURE_MAX_ANISOTROPY_EXT=34046]="TEXTURE_MAX_ANISOTROPY_EXT",r[r.R16_EXT=33322]="R16_EXT",r[r.RG16_EXT=33324]="RG16_EXT",r[r.RGB16_EXT=32852]="RGB16_EXT",r[r.RGBA16_EXT=32859]="RGBA16_EXT",r[r.R16_SNORM_EXT=36760]="R16_SNORM_EXT",r[r.RG16_SNORM_EXT=36761]="RG16_SNORM_EXT",r[r.RGB16_SNORM_EXT=36762]="RGB16_SNORM_EXT",r[r.RGBA16_SNORM_EXT=36763]="RGBA16_SNORM_EXT",r[r.COMPRESSED_RGB_S3TC_DXT1_EXT=33776]="COMPRESSED_RGB_S3TC_DXT1_EXT",r[r.COMPRESSED_RGBA_S3TC_DXT1_EXT=33777]="COMPRESSED_RGBA_S3TC_DXT1_EXT",r[r.COMPRESSED_RGBA_S3TC_DXT3_EXT=33778]="COMPRESSED_RGBA_S3TC_DXT3_EXT",r[r.COMPRESSED_RGBA_S3TC_DXT5_EXT=33779]="COMPRESSED_RGBA_S3TC_DXT5_EXT",r[r.COMPRESSED_SRGB_S3TC_DXT1_EXT=35916]="COMPRESSED_SRGB_S3TC_DXT1_EXT",r[r.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT=35917]="COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT",r[r.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT=35918]="COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT",r[r.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT=35919]="COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT",r[r.COMPRESSED_RED_RGTC1_EXT=36283]="COMPRESSED_RED_RGTC1_EXT",r[r.COMPRESSED_SIGNED_RED_RGTC1_EXT=36284]="COMPRESSED_SIGNED_RED_RGTC1_EXT",r[r.COMPRESSED_RED_GREEN_RGTC2_EXT=36285]="COMPRESSED_RED_GREEN_RGTC2_EXT",r[r.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT=36286]="COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT",r[r.COMPRESSED_RGBA_BPTC_UNORM_EXT=36492]="COMPRESSED_RGBA_BPTC_UNORM_EXT",r[r.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT=36493]="COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT",r[r.COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT=36494]="COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT",r[r.COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT=36495]="COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT",r[r.COMPRESSED_R11_EAC=37488]="COMPRESSED_R11_EAC",r[r.COMPRESSED_SIGNED_R11_EAC=37489]="COMPRESSED_SIGNED_R11_EAC",r[r.COMPRESSED_RG11_EAC=37490]="COMPRESSED_RG11_EAC",r[r.COMPRESSED_SIGNED_RG11_EAC=37491]="COMPRESSED_SIGNED_RG11_EAC",r[r.COMPRESSED_RGB8_ETC2=37492]="COMPRESSED_RGB8_ETC2",r[r.COMPRESSED_RGBA8_ETC2_EAC=37493]="COMPRESSED_RGBA8_ETC2_EAC",r[r.COMPRESSED_SRGB8_ETC2=37494]="COMPRESSED_SRGB8_ETC2",r[r.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=37495]="COMPRESSED_SRGB8_ALPHA8_ETC2_EAC",r[r.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2=37496]="COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2",r[r.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2=37497]="COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2",r[r.COMPRESSED_RGB_PVRTC_4BPPV1_IMG=35840]="COMPRESSED_RGB_PVRTC_4BPPV1_IMG",r[r.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG=35842]="COMPRESSED_RGBA_PVRTC_4BPPV1_IMG",r[r.COMPRESSED_RGB_PVRTC_2BPPV1_IMG=35841]="COMPRESSED_RGB_PVRTC_2BPPV1_IMG",r[r.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG=35843]="COMPRESSED_RGBA_PVRTC_2BPPV1_IMG",r[r.COMPRESSED_RGB_ETC1_WEBGL=36196]="COMPRESSED_RGB_ETC1_WEBGL",r[r.COMPRESSED_RGB_ATC_WEBGL=35986]="COMPRESSED_RGB_ATC_WEBGL",r[r.COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL=35986]="COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL",r[r.COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL=34798]="COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL",r[r.COMPRESSED_RGBA_ASTC_4x4_KHR=37808]="COMPRESSED_RGBA_ASTC_4x4_KHR",r[r.COMPRESSED_RGBA_ASTC_5x4_KHR=37809]="COMPRESSED_RGBA_ASTC_5x4_KHR",r[r.COMPRESSED_RGBA_ASTC_5x5_KHR=37810]="COMPRESSED_RGBA_ASTC_5x5_KHR",r[r.COMPRESSED_RGBA_ASTC_6x5_KHR=37811]="COMPRESSED_RGBA_ASTC_6x5_KHR",r[r.COMPRESSED_RGBA_ASTC_6x6_KHR=37812]="COMPRESSED_RGBA_ASTC_6x6_KHR",r[r.COMPRESSED_RGBA_ASTC_8x5_KHR=37813]="COMPRESSED_RGBA_ASTC_8x5_KHR",r[r.COMPRESSED_RGBA_ASTC_8x6_KHR=37814]="COMPRESSED_RGBA_ASTC_8x6_KHR",r[r.COMPRESSED_RGBA_ASTC_8x8_KHR=37815]="COMPRESSED_RGBA_ASTC_8x8_KHR",r[r.COMPRESSED_RGBA_ASTC_10x5_KHR=37816]="COMPRESSED_RGBA_ASTC_10x5_KHR",r[r.COMPRESSED_RGBA_ASTC_10x6_KHR=37817]="COMPRESSED_RGBA_ASTC_10x6_KHR",r[r.COMPRESSED_RGBA_ASTC_10x8_KHR=37818]="COMPRESSED_RGBA_ASTC_10x8_KHR",r[r.COMPRESSED_RGBA_ASTC_10x10_KHR=37819]="COMPRESSED_RGBA_ASTC_10x10_KHR",r[r.COMPRESSED_RGBA_ASTC_12x10_KHR=37820]="COMPRESSED_RGBA_ASTC_12x10_KHR",r[r.COMPRESSED_RGBA_ASTC_12x12_KHR=37821]="COMPRESSED_RGBA_ASTC_12x12_KHR",r[r.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR=37840]="COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR",r[r.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR=37841]="COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR",r[r.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR=37842]="COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR",r[r.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR=37843]="COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR",r[r.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR=37844]="COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR",r[r.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR=37845]="COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR",r[r.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR=37846]="COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR",r[r.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR=37847]="COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR",r[r.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR=37848]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR",r[r.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR=37849]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR",r[r.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR=37850]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR",r[r.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR=37851]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR",r[r.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR=37852]="COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR",r[r.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR=37853]="COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR",r[r.QUERY_COUNTER_BITS_EXT=34916]="QUERY_COUNTER_BITS_EXT",r[r.CURRENT_QUERY_EXT=34917]="CURRENT_QUERY_EXT",r[r.QUERY_RESULT_EXT=34918]="QUERY_RESULT_EXT",r[r.QUERY_RESULT_AVAILABLE_EXT=34919]="QUERY_RESULT_AVAILABLE_EXT",r[r.TIME_ELAPSED_EXT=35007]="TIME_ELAPSED_EXT",r[r.TIMESTAMP_EXT=36392]="TIMESTAMP_EXT",r[r.GPU_DISJOINT_EXT=36795]="GPU_DISJOINT_EXT",r[r.COMPLETION_STATUS_KHR=37297]="COMPLETION_STATUS_KHR",r[r.DEPTH_CLAMP_EXT=34383]="DEPTH_CLAMP_EXT",r[r.FIRST_VERTEX_CONVENTION_WEBGL=36429]="FIRST_VERTEX_CONVENTION_WEBGL",r[r.LAST_VERTEX_CONVENTION_WEBGL=36430]="LAST_VERTEX_CONVENTION_WEBGL",r[r.PROVOKING_VERTEX_WEBL=36431]="PROVOKING_VERTEX_WEBL",r[r.POLYGON_MODE_WEBGL=2880]="POLYGON_MODE_WEBGL",r[r.POLYGON_OFFSET_LINE_WEBGL=10754]="POLYGON_OFFSET_LINE_WEBGL",r[r.LINE_WEBGL=6913]="LINE_WEBGL",r[r.FILL_WEBGL=6914]="FILL_WEBGL",r[r.MAX_CLIP_DISTANCES_WEBGL=3378]="MAX_CLIP_DISTANCES_WEBGL",r[r.MAX_CULL_DISTANCES_WEBGL=33529]="MAX_CULL_DISTANCES_WEBGL",r[r.MAX_COMBINED_CLIP_AND_CULL_DISTANCES_WEBGL=33530]="MAX_COMBINED_CLIP_AND_CULL_DISTANCES_WEBGL",r[r.CLIP_DISTANCE0_WEBGL=12288]="CLIP_DISTANCE0_WEBGL",r[r.CLIP_DISTANCE1_WEBGL=12289]="CLIP_DISTANCE1_WEBGL",r[r.CLIP_DISTANCE2_WEBGL=12290]="CLIP_DISTANCE2_WEBGL",r[r.CLIP_DISTANCE3_WEBGL=12291]="CLIP_DISTANCE3_WEBGL",r[r.CLIP_DISTANCE4_WEBGL=12292]="CLIP_DISTANCE4_WEBGL",r[r.CLIP_DISTANCE5_WEBGL=12293]="CLIP_DISTANCE5_WEBGL",r[r.CLIP_DISTANCE6_WEBGL=12294]="CLIP_DISTANCE6_WEBGL",r[r.CLIP_DISTANCE7_WEBGL=12295]="CLIP_DISTANCE7_WEBGL",r[r.POLYGON_OFFSET_CLAMP_EXT=36379]="POLYGON_OFFSET_CLAMP_EXT",r[r.LOWER_LEFT_EXT=36001]="LOWER_LEFT_EXT",r[r.UPPER_LEFT_EXT=36002]="UPPER_LEFT_EXT",r[r.NEGATIVE_ONE_TO_ONE_EXT=37726]="NEGATIVE_ONE_TO_ONE_EXT",r[r.ZERO_TO_ONE_EXT=37727]="ZERO_TO_ONE_EXT",r[r.CLIP_ORIGIN_EXT=37724]="CLIP_ORIGIN_EXT",r[r.CLIP_DEPTH_MODE_EXT=37725]="CLIP_DEPTH_MODE_EXT",r[r.SRC1_COLOR_WEBGL=35065]="SRC1_COLOR_WEBGL",r[r.SRC1_ALPHA_WEBGL=34185]="SRC1_ALPHA_WEBGL",r[r.ONE_MINUS_SRC1_COLOR_WEBGL=35066]="ONE_MINUS_SRC1_COLOR_WEBGL",r[r.ONE_MINUS_SRC1_ALPHA_WEBGL=35067]="ONE_MINUS_SRC1_ALPHA_WEBGL",r[r.MAX_DUAL_SOURCE_DRAW_BUFFERS_WEBGL=35068]="MAX_DUAL_SOURCE_DRAW_BUFFERS_WEBGL",r[r.MIRROR_CLAMP_TO_EDGE_EXT=34627]="MIRROR_CLAMP_TO_EDGE_EXT"})(p0||(p0={}));const Yie={WEBGL_depth_texture:{UNSIGNED_INT_24_8_WEBGL:34042},OES_element_index_uint:{},OES_texture_float:{},OES_texture_half_float:{HALF_FLOAT_OES:5131},EXT_color_buffer_float:{},OES_standard_derivatives:{FRAGMENT_SHADER_DERIVATIVE_HINT_OES:35723},EXT_frag_depth:{},EXT_blend_minmax:{MIN_EXT:32775,MAX_EXT:32776},EXT_shader_texture_lod:{}},Kie=r=>({drawBuffersWEBGL(e){return r.drawBuffers(e)},COLOR_ATTACHMENT0_WEBGL:36064,COLOR_ATTACHMENT1_WEBGL:36065,COLOR_ATTACHMENT2_WEBGL:36066,COLOR_ATTACHMENT3_WEBGL:36067}),Qie=r=>({VERTEX_ARRAY_BINDING_OES:34229,createVertexArrayOES(){return r.createVertexArray()},deleteVertexArrayOES(e){return r.deleteVertexArray(e)},isVertexArrayOES(e){return r.isVertexArray(e)},bindVertexArrayOES(e){return r.bindVertexArray(e)}}),Jie=r=>({VERTEX_ATTRIB_ARRAY_DIVISOR_ANGLE:35070,drawArraysInstancedANGLE(...e){return r.drawArraysInstanced(...e)},drawElementsInstancedANGLE(...e){return r.drawElementsInstanced(...e)},vertexAttribDivisorANGLE(...e){return r.vertexAttribDivisor(...e)}});function ene(r=!0){const e=HTMLCanvasElement.prototype;if(!r&&e.originalGetContext){e.getContext=e.originalGetContext,e.originalGetContext=void 0;return}e.originalGetContext=e.getContext,e.getContext=function(t,i){if(t==="webgl"||t==="experimental-webgl"){const n=this.originalGetContext("webgl2",i);return n instanceof HTMLElement&&tne(n),n}return this.originalGetContext(t,i)}}function tne(r){r.getExtension("EXT_color_buffer_float");const e={...Yie,WEBGL_disjoint_timer_query:r.getExtension("EXT_disjoint_timer_query_webgl2"),WEBGL_draw_buffers:Kie(r),OES_vertex_array_object:Qie(r),ANGLE_instanced_arrays:Jie(r)},t=r.getExtension;r.getExtension=function(n){const a=t.call(r,n);return a||(n in e?e[n]:null)};const i=r.getSupportedExtensions;r.getSupportedExtensions=function(){return(i.apply(r)||[])?.concat(Object.keys(e))}}async function nj(r,e){const t=document.getElementsByTagName("head")[0];if(!t)throw new Error("loadScript");const i=document.createElement("script");return i.setAttribute("type","text/javascript"),i.setAttribute("src",r),new Promise((n,a)=>{i.onload=n,i.onerror=s=>a(new Error(`Unable to load script '${r}': ${s}`)),t.appendChild(i)})}const rne=1;let cu=null,xB=!1;const tk={debugSpectorJS:Nt.get("debug-spectorjs"),debugSpectorJSUrl:"https://cdn.jsdelivr.net/npm/spectorjs@0.9.30/dist/spector.bundle.js",gl:void 0};async function ine(r){if(!globalThis.SPECTOR)try{await nj(r.debugSpectorJSUrl||tk.debugSpectorJSUrl)}catch(e){Nt.warn(String(e))}}function nne(r){if(r={...tk,...r},!r.debugSpectorJS)return null;if(!cu&&globalThis.SPECTOR&&!globalThis.luma?.spector){Nt.probe(rne,"SPECTOR found and initialized. Start with `luma.spector.displayUI()`")();const{Spector:e}=globalThis.SPECTOR;cu=new e,globalThis.luma&&(globalThis.luma.spector=cu)}if(!cu)return null;if(xB||(xB=!0,cu.spyCanvases(),cu?.onCaptureStarted.add(e=>Nt.info("Spector capture started:",e)()),cu?.onCapture.add(e=>{Nt.info("Spector capture complete:",e)(),cu?.getResultUI(),cu?.resultView.display(),cu?.resultView.addCapture(e)})),r.gl){const e=r.gl,t=e.device;cu?.startCapture(r.gl,500),e.device=t,new Promise(i=>setTimeout(i,2e3)).then(i=>{Nt.info("Spector capture stopped after 2 seconds")(),cu?.stopCapture()})}return cu}const ane="https://unpkg.com/webgl-debug@2.0.1/index.js";function aj(r){return r.luma=r.luma||{},r.luma}async function one(){Ty()&&!globalThis.WebGLDebugUtils&&(globalThis.global=globalThis.global||globalThis,globalThis.global.module={},await nj(ane))}function sne(r,e={}){return e.debugWebGL||e.traceWebGL?une(r,e):lne(r)}function lne(r){const e=aj(r);return e.realContext?e.realContext:r}function une(r,e){if(!globalThis.WebGLDebugUtils)return Nt.warn("webgl-debug not loaded")(),r;const t=aj(r);if(t.debugContext)return t.debugContext;globalThis.WebGLDebugUtils.init({...p0,...r});const i=globalThis.WebGLDebugUtils.makeDebugContext(r,cne.bind(null,e),hne.bind(null,e));for(const s in p0)!(s in i)&&typeof p0[s]=="number"&&(i[s]=p0[s]);class n{}Object.setPrototypeOf(i,Object.getPrototypeOf(r)),Object.setPrototypeOf(n,i);const a=Object.create(n);return t.realContext=r,t.debugContext=a,a.debug=!0,a}function wB(r,e){e=Array.from(e).map(i=>i===void 0?"undefined":i);let t=globalThis.WebGLDebugUtils.glFunctionArgsToString(r,e);return t=`${t.slice(0,100)}${t.length>100?"...":""}`,`gl.${r}(${t})`}function cne(r,e,t,i){i=Array.from(i).map(o=>o===void 0?"undefined":o);const n=globalThis.WebGLDebugUtils.glEnumToString(e),a=globalThis.WebGLDebugUtils.glFunctionArgsToString(t,i),s=`${n} in gl.${t}(${a})`;Nt.error(s)();debugger}function hne(r,e,t){let i="";Nt.level>=1&&(i=wB(e,t),r.traceWebGL&&Nt.log(1,i)());for(const n of t)if(n===void 0){i=i||wB(e,t);debugger}}const uT=1;class fne extends sQ{type="webgl";constructor(){super(),ly.defaultProps={...ly.defaultProps,...tk}}enforceWebGL2(e){ene(e)}isSupported(){return typeof WebGL2RenderingContext<"u"}isDeviceHandle(e){return typeof WebGL2RenderingContext<"u"&&e instanceof WebGL2RenderingContext?!0:(typeof WebGLRenderingContext<"u"&&e instanceof WebGLRenderingContext&&Nt.warn("WebGL1 is not supported",e)(),!1)}async attach(e,t={}){const{WebGLDevice:i}=await bB(async()=>{const{WebGLDevice:a}=await Promise.resolve().then(()=>zB);return{WebGLDevice:a}},void 0);if(e instanceof i)return e;if(e?.device instanceof i)return e.device;if(!dne(e))throw new Error("Invalid WebGL2RenderingContext");const n=t.createCanvasContext===!0?{}:t.createCanvasContext;return new i({...t,_handle:e,createCanvasContext:{canvas:e.canvas,autoResize:!1,...n}})}async create(e={}){const{WebGLDevice:t}=await bB(async()=>{const{WebGLDevice:i}=await Promise.resolve().then(()=>zB);return{WebGLDevice:i}},void 0);Nt.groupCollapsed(uT,"WebGLDevice created")();try{const i=[];(e.debugWebGL||e.debug)&&i.push(one()),e.debugSpectorJS&&i.push(ine(e));const n=await Promise.allSettled(i);for(const o of n)o.status==="rejected"&&Nt.error(`Failed to initialize debug libraries ${o.reason}`)();const a=new t(e),s=`${a._reused?"Reusing":"Created"} device with WebGL2 ${a.props.debug?"debug ":""}context: ${a.info.vendor}, ${a.info.renderer} for canvas: ${a.canvasContext.id}`;return Nt.probe(uT,s)(),Nt.table(uT,a.info)(),a}finally{Nt.groupEnd(uT)()}}}function dne(r){return typeof WebGL2RenderingContext<"u"&&r instanceof WebGL2RenderingContext?!0:!!(r&&Number.isFinite(r._version))}const lE=new fne,rk={3042:!1,32773:new Float32Array([0,0,0,0]),32777:32774,34877:32774,32969:1,32968:0,32971:1,32970:0,3106:new Float32Array([0,0,0,0]),3107:[!0,!0,!0,!0],2884:!1,2885:1029,2929:!1,2931:1,2932:513,2928:new Float32Array([0,1]),2930:!0,3024:!0,35725:null,36006:null,36007:null,34229:null,34964:null,2886:2305,33170:4352,2849:1,32823:!1,32824:0,10752:0,32926:!1,32928:!1,32938:1,32939:!1,3089:!1,3088:new Int32Array([0,0,1024,1024]),2960:!1,2961:0,2968:4294967295,36005:4294967295,2962:519,2967:0,2963:4294967295,34816:519,36003:0,36004:4294967295,2964:7680,2965:7680,2966:7680,34817:7680,34818:7680,34819:7680,2978:[0,0,1024,1024],36389:null,36662:null,36663:null,35053:null,35055:null,35723:4352,36010:null,35977:!1,3333:4,3317:4,37440:!1,37441:!1,37443:37444,3330:0,3332:0,3331:0,3314:0,32878:0,3316:0,3315:0,32877:0},$a=(r,e,t)=>e?r.enable(t):r.disable(t),SB=(r,e,t)=>r.hint(t,e),hu=(r,e,t)=>r.pixelStorei(t,e),TB=(r,e,t)=>{const i=t===36006?36009:36008;return r.bindFramebuffer(i,e)},Ix=(r,e,t)=>{const n={34964:34962,36662:36662,36663:36663,35053:35051,35055:35052}[t];r.bindBuffer(n,e)};function uE(r){return Array.isArray(r)||ArrayBuffer.isView(r)&&!(r instanceof DataView)}const pne={3042:$a,32773:(r,e)=>r.blendColor(...e),32777:"blendEquation",34877:"blendEquation",32969:"blendFunc",32968:"blendFunc",32971:"blendFunc",32970:"blendFunc",3106:(r,e)=>r.clearColor(...e),3107:(r,e)=>r.colorMask(...e),2884:$a,2885:(r,e)=>r.cullFace(e),2929:$a,2931:(r,e)=>r.clearDepth(e),2932:(r,e)=>r.depthFunc(e),2928:(r,e)=>r.depthRange(...e),2930:(r,e)=>r.depthMask(e),3024:$a,35723:SB,35725:(r,e)=>r.useProgram(e),36007:(r,e)=>r.bindRenderbuffer(36161,e),36389:(r,e)=>r.bindTransformFeedback?.(36386,e),34229:(r,e)=>r.bindVertexArray(e),36006:TB,36010:TB,34964:Ix,36662:Ix,36663:Ix,35053:Ix,35055:Ix,2886:(r,e)=>r.frontFace(e),33170:SB,2849:(r,e)=>r.lineWidth(e),32823:$a,32824:"polygonOffset",10752:"polygonOffset",35977:$a,32926:$a,32928:$a,32938:"sampleCoverage",32939:"sampleCoverage",3089:$a,3088:(r,e)=>r.scissor(...e),2960:$a,2961:(r,e)=>r.clearStencil(e),2968:(r,e)=>r.stencilMaskSeparate(1028,e),36005:(r,e)=>r.stencilMaskSeparate(1029,e),2962:"stencilFuncFront",2967:"stencilFuncFront",2963:"stencilFuncFront",34816:"stencilFuncBack",36003:"stencilFuncBack",36004:"stencilFuncBack",2964:"stencilOpFront",2965:"stencilOpFront",2966:"stencilOpFront",34817:"stencilOpBack",34818:"stencilOpBack",34819:"stencilOpBack",2978:(r,e)=>r.viewport(...e),34383:$a,10754:$a,12288:$a,12289:$a,12290:$a,12291:$a,12292:$a,12293:$a,12294:$a,12295:$a,3333:hu,3317:hu,37440:hu,37441:hu,37443:hu,3330:hu,3332:hu,3331:hu,3314:hu,32878:hu,3316:hu,3315:hu,32877:hu,framebuffer:(r,e)=>{const t=e&&"handle"in e?e.handle:e;return r.bindFramebuffer(36160,t)},blend:(r,e)=>e?r.enable(3042):r.disable(3042),blendColor:(r,e)=>r.blendColor(...e),blendEquation:(r,e)=>{const t=typeof e=="number"?[e,e]:e;r.blendEquationSeparate(...t)},blendFunc:(r,e)=>{const t=e?.length===2?[...e,...e]:e;r.blendFuncSeparate(...t)},clearColor:(r,e)=>r.clearColor(...e),clearDepth:(r,e)=>r.clearDepth(e),clearStencil:(r,e)=>r.clearStencil(e),colorMask:(r,e)=>r.colorMask(...e),cull:(r,e)=>e?r.enable(2884):r.disable(2884),cullFace:(r,e)=>r.cullFace(e),depthTest:(r,e)=>e?r.enable(2929):r.disable(2929),depthFunc:(r,e)=>r.depthFunc(e),depthMask:(r,e)=>r.depthMask(e),depthRange:(r,e)=>r.depthRange(...e),dither:(r,e)=>e?r.enable(3024):r.disable(3024),derivativeHint:(r,e)=>{r.hint(35723,e)},frontFace:(r,e)=>r.frontFace(e),mipmapHint:(r,e)=>r.hint(33170,e),lineWidth:(r,e)=>r.lineWidth(e),polygonOffsetFill:(r,e)=>e?r.enable(32823):r.disable(32823),polygonOffset:(r,e)=>r.polygonOffset(...e),sampleCoverage:(r,e)=>r.sampleCoverage(e[0],e[1]||!1),scissorTest:(r,e)=>e?r.enable(3089):r.disable(3089),scissor:(r,e)=>r.scissor(...e),stencilTest:(r,e)=>e?r.enable(2960):r.disable(2960),stencilMask:(r,e)=>{e=uE(e)?e:[e,e];const[t,i]=e;r.stencilMaskSeparate(1028,t),r.stencilMaskSeparate(1029,i)},stencilFunc:(r,e)=>{e=uE(e)&&e.length===3?[...e,...e]:e;const[t,i,n,a,s,o]=e;r.stencilFuncSeparate(1028,t,i,n),r.stencilFuncSeparate(1029,a,s,o)},stencilOp:(r,e)=>{e=uE(e)&&e.length===3?[...e,...e]:e;const[t,i,n,a,s,o]=e;r.stencilOpSeparate(1028,t,i,n),r.stencilOpSeparate(1029,a,s,o)},viewport:(r,e)=>r.viewport(...e)};function wa(r,e,t){return e[r]!==void 0?e[r]:t[r]}const gne={blendEquation:(r,e,t)=>r.blendEquationSeparate(wa(32777,e,t),wa(34877,e,t)),blendFunc:(r,e,t)=>r.blendFuncSeparate(wa(32969,e,t),wa(32968,e,t),wa(32971,e,t),wa(32970,e,t)),polygonOffset:(r,e,t)=>r.polygonOffset(wa(32824,e,t),wa(10752,e,t)),sampleCoverage:(r,e,t)=>r.sampleCoverage(wa(32938,e,t),wa(32939,e,t)),stencilFuncFront:(r,e,t)=>r.stencilFuncSeparate(1028,wa(2962,e,t),wa(2967,e,t),wa(2963,e,t)),stencilFuncBack:(r,e,t)=>r.stencilFuncSeparate(1029,wa(34816,e,t),wa(36003,e,t),wa(36004,e,t)),stencilOpFront:(r,e,t)=>r.stencilOpSeparate(1028,wa(2964,e,t),wa(2965,e,t),wa(2966,e,t)),stencilOpBack:(r,e,t)=>r.stencilOpSeparate(1029,wa(34817,e,t),wa(34818,e,t),wa(34819,e,t))},AB={enable:(r,e)=>r({[e]:!0}),disable:(r,e)=>r({[e]:!1}),pixelStorei:(r,e,t)=>r({[e]:t}),hint:(r,e,t)=>r({[e]:t}),useProgram:(r,e)=>r({35725:e}),bindRenderbuffer:(r,e,t)=>r({36007:t}),bindTransformFeedback:(r,e,t)=>r({36389:t}),bindVertexArray:(r,e)=>r({34229:e}),bindFramebuffer:(r,e,t)=>{switch(e){case 36160:return r({36006:t,36010:t});case 36009:return r({36006:t});case 36008:return r({36010:t});default:return null}},bindBuffer:(r,e,t)=>{const i={34962:[34964],36662:[36662],36663:[36663],35051:[35053],35052:[35055]}[e];return i?r({[i]:t}):{valueChanged:!0}},blendColor:(r,e,t,i,n)=>r({32773:new Float32Array([e,t,i,n])}),blendEquation:(r,e)=>r({32777:e,34877:e}),blendEquationSeparate:(r,e,t)=>r({32777:e,34877:t}),blendFunc:(r,e,t)=>r({32969:e,32968:t,32971:e,32970:t}),blendFuncSeparate:(r,e,t,i,n)=>r({32969:e,32968:t,32971:i,32970:n}),clearColor:(r,e,t,i,n)=>r({3106:new Float32Array([e,t,i,n])}),clearDepth:(r,e)=>r({2931:e}),clearStencil:(r,e)=>r({2961:e}),colorMask:(r,e,t,i,n)=>r({3107:[e,t,i,n]}),cullFace:(r,e)=>r({2885:e}),depthFunc:(r,e)=>r({2932:e}),depthRange:(r,e,t)=>r({2928:new Float32Array([e,t])}),depthMask:(r,e)=>r({2930:e}),frontFace:(r,e)=>r({2886:e}),lineWidth:(r,e)=>r({2849:e}),polygonOffset:(r,e,t)=>r({32824:e,10752:t}),sampleCoverage:(r,e,t)=>r({32938:e,32939:t}),scissor:(r,e,t,i,n)=>r({3088:new Int32Array([e,t,i,n])}),stencilMask:(r,e)=>r({2968:e,36005:e}),stencilMaskSeparate:(r,e,t)=>r({[e===1028?2968:36005]:t}),stencilFunc:(r,e,t,i)=>r({2962:e,2967:t,2963:i,34816:e,36003:t,36004:i}),stencilFuncSeparate:(r,e,t,i,n)=>r({[e===1028?2962:34816]:t,[e===1028?2967:36003]:i,[e===1028?2963:36004]:n}),stencilOp:(r,e,t,i)=>r({2964:e,2965:t,2966:i,34817:e,34818:t,34819:i}),stencilOpSeparate:(r,e,t,i,n)=>r({[e===1028?2964:34817]:t,[e===1028?2965:34818]:i,[e===1028?2966:34819]:n}),viewport:(r,e,t,i,n)=>r({2978:[e,t,i,n]})},_f=(r,e)=>r.isEnabled(e),CB={3042:_f,2884:_f,2929:_f,3024:_f,32823:_f,32926:_f,32928:_f,3089:_f,2960:_f,35977:_f},vne=new Set([34016,36388,36387,35983,35368,34965,35739,35738,3074,34853,34854,34855,34856,34857,34858,34859,34860,34861,34862,34863,34864,34865,34866,34867,34868,35097,32873,35869,32874,34068]);function ib(r,e){if(yne(e))return;const t={};for(const n in e){const a=Number(n),s=pne[n];s&&(typeof s=="string"?t[s]=!0:s(r,e[n],a))}const i=r.state&&r.state.cache;if(i)for(const n in t){const a=gne[n];a(r,e,i)}}function oj(r,e=rk){if(typeof e=="number"){const n=e,a=CB[n];return a?a(r,n):r.getParameter(n)}const t=Array.isArray(e)?e:Object.keys(e),i={};for(const n of t){const a=CB[n];i[n]=a?a(r,Number(n)):r.getParameter(Number(n))}return i}function mne(r){ib(r,rk)}function yne(r){for(const e in r)return!1;return!0}function _ne(r,e){if(r===e)return!0;if(MB(r)&&MB(e)&&r.length===e.length){for(let t=0;t<r.length;++t)if(r[t]!==e[t])return!1;return!0}return!1}function MB(r){return Array.isArray(r)||ArrayBuffer.isView(r)}class Jm{static get(e){return e.state}gl;program=null;stateStack=[];enable=!0;cache=null;log;initialized=!1;constructor(e,t){this.gl=e,this.log=t?.log||(()=>{}),this._updateCache=this._updateCache.bind(this),Object.seal(this)}push(e={}){this.stateStack.push({})}pop(){const e=this.stateStack[this.stateStack.length-1];ib(this.gl,e),this.stateStack.pop()}trackState(e,t){if(this.cache=t?.copyState?oj(e):Object.assign({},rk),this.initialized)throw new Error("WebGLStateTracker");this.initialized=!0,this.gl.state=this,xne(e);for(const i in AB){const n=AB[i];bne(e,i,n)}EB(e,"getParameter"),EB(e,"isEnabled")}_updateCache(e){let t=!1,i;const n=this.stateStack.length>0?this.stateStack[this.stateStack.length-1]:null;for(const a in e){const s=e[a],o=this.cache[a];_ne(s,o)||(t=!0,i=o,n&&!(a in n)&&(n[a]=o),this.cache[a]=s)}return{valueChanged:t,oldValue:i}}}function EB(r,e){const t=r[e].bind(r);r[e]=function(n){if(n===void 0||vne.has(n))return t(n);const a=Jm.get(r);return n in a.cache||(a.cache[n]=t(n)),a.enable?a.cache[n]:t(n)},Object.defineProperty(r[e],"name",{value:`${e}-from-cache`,configurable:!1})}function bne(r,e,t){if(!r[e])return;const i=r[e].bind(r);r[e]=function(...a){const s=Jm.get(r),{valueChanged:o,oldValue:l}=t(s._updateCache,...a);return o&&i(...a),l},Object.defineProperty(r[e],"name",{value:`${e}-to-cache`,configurable:!1})}function xne(r){const e=r.useProgram.bind(r);r.useProgram=function(i){const n=Jm.get(r);n.program!==i&&(e(i),n.program=i)}}function wne(r,e,t){let i="";const n={preserveDrawingBuffer:!0,...t};let a=null;if(a||=r.getContext("webgl2",n),n.failIfMajorPerformanceCaveat&&(i||="Only software GPU is available. Set `failIfMajorPerformanceCaveat: false` to allow."),!a&&!t.failIfMajorPerformanceCaveat&&(n.failIfMajorPerformanceCaveat=!1,a=r.getContext("webgl2",n),a.luma||={},a.luma.softwareRenderer=!0),a||(a=r.getContext("webgl",{}),a&&(a=null,i||="Your browser only supports WebGL1")),!a)throw i||="Your browser does not support WebGL",new Error(`Failed to create WebGL context: ${i}`);const{onContextLost:s,onContextRestored:o}=e;return r.addEventListener("webglcontextlost",l=>s(l),!1),r.addEventListener("webglcontextrestored",l=>o(l),!1),a.luma||={},a}function H0(r,e,t){return t[e]===void 0&&(t[e]=r.getExtension(e)||null),t[e]}function Sne(r,e){const t=r.getParameter(7936),i=r.getParameter(7937);H0(r,"WEBGL_debug_renderer_info",e);const n=e.WEBGL_debug_renderer_info,a=r.getParameter(n?n.UNMASKED_VENDOR_WEBGL:7936),s=r.getParameter(n?n.UNMASKED_RENDERER_WEBGL:7937),o=a||t,l=s||i,c=r.getParameter(7938),f=sj(o,l),p=Tne(o,l),y=Ane(o,l);return{type:"webgl",gpu:f,gpuType:y,gpuBackend:p,vendor:o,renderer:l,version:c,shadingLanguage:"glsl",shadingLanguageVersion:300}}function sj(r,e){return/NVIDIA/i.exec(r)||/NVIDIA/i.exec(e)?"nvidia":/INTEL/i.exec(r)||/INTEL/i.exec(e)?"intel":/Apple/i.exec(r)||/Apple/i.exec(e)?"apple":/AMD/i.exec(r)||/AMD/i.exec(e)||/ATI/i.exec(r)||/ATI/i.exec(e)?"amd":/SwiftShader/i.exec(r)||/SwiftShader/i.exec(e)?"software":"unknown"}function Tne(r,e){return/Metal/i.exec(r)||/Metal/i.exec(e)?"metal":/ANGLE/i.exec(r)||/ANGLE/i.exec(e)?"opengl":"unknown"}function Ane(r,e){if(/SwiftShader/i.exec(r)||/SwiftShader/i.exec(e))return"cpu";switch(sj(r,e)){case"intel":return"integrated";case"software":return"cpu";case"unknown":return"unknown";default:return"discrete"}}function lj(r){switch(r){case"uint8":return 5121;case"sint8":return 5120;case"unorm8":return 5121;case"snorm8":return 5120;case"uint16":return 5123;case"sint16":return 5122;case"unorm16":return 5123;case"snorm16":return 5122;case"uint32":return 5125;case"sint32":return 5124;case"float16":return 5131;case"float32":return 5126}throw new Error(String(r))}const f1="WEBGL_compressed_texture_s3tc",d1="WEBGL_compressed_texture_s3tc_srgb",g0="EXT_texture_compression_rgtc",v0="EXT_texture_compression_bptc",Cne="WEBGL_compressed_texture_etc",Mne="WEBGL_compressed_texture_astc",Ene="WEBGL_compressed_texture_etc1",Ine="WEBGL_compressed_texture_pvrtc",Pne="WEBGL_compressed_texture_atc",IB="EXT_texture_norm16",PB="EXT_render_snorm",Rne="EXT_color_buffer_float",ik={"float32-renderable-webgl":["EXT_color_buffer_float"],"float16-renderable-webgl":["EXT_color_buffer_half_float"],"rgb9e5ufloat-renderable-webgl":["WEBGL_render_shared_exponent"],"snorm8-renderable-webgl":[PB],"norm16-renderable-webgl":[IB],"snorm16-renderable-webgl":[IB,PB],"float32-filterable":["OES_texture_float_linear"],"float16-filterable-webgl":["OES_texture_half_float_linear"],"texture-filterable-anisotropic-webgl":["EXT_texture_filter_anisotropic"],"texture-blend-float-webgl":["EXT_float_blend"],"texture-compression-bc":[f1,d1,g0,v0],"texture-compression-bc5-webgl":[g0],"texture-compression-bc7-webgl":[v0],"texture-compression-etc2":[Cne],"texture-compression-astc":[Mne],"texture-compression-etc1-webgl":[Ene],"texture-compression-pvrtc-webgl":[Ine],"texture-compression-atc-webgl":[Pne]};function Dne(r){return r in ik}function kne(r,e,t){return(ik[e]||[]).every(n=>H0(r,n,t))}const nk={r8unorm:{gl:33321,rb:!0},r8snorm:{gl:36756},r8uint:{gl:33330,rb:!0},r8sint:{gl:33329,rb:!0},rg8unorm:{gl:33323,rb:!0},rg8snorm:{gl:36757},rg8uint:{gl:33336,rb:!0},rg8sint:{gl:33335,rb:!0},r16uint:{gl:33332,rb:!0},r16sint:{gl:33331,rb:!0},r16float:{gl:33325,rb:!0},r16unorm:{gl:33322,rb:!0},r16snorm:{gl:36760},"rgba4unorm-webgl":{gl:32854,rb:!0},"rgb565unorm-webgl":{gl:36194,rb:!0},"rgb5a1unorm-webgl":{gl:32855,rb:!0},"rgb8unorm-webgl":{gl:32849},"rgb8snorm-webgl":{gl:36758},rgba8unorm:{gl:32856},"rgba8unorm-srgb":{gl:35907},rgba8snorm:{gl:36759},rgba8uint:{gl:36220},rgba8sint:{gl:36238},bgra8unorm:{},"bgra8unorm-srgb":{},rg16uint:{gl:33338},rg16sint:{gl:33337},rg16float:{gl:33327,rb:!0},rg16unorm:{gl:33324},rg16snorm:{gl:36761},r32uint:{gl:33334,rb:!0},r32sint:{gl:33333,rb:!0},r32float:{gl:33326},rgb9e5ufloat:{gl:35901},rg11b10ufloat:{gl:35898,rb:!0},rgb10a2unorm:{gl:32857,rb:!0},rgb10a2uint:{gl:36975,rb:!0},"rgb16unorm-webgl":{gl:32852},"rgb16snorm-webgl":{gl:36762},rg32uint:{gl:33340,rb:!0},rg32sint:{gl:33339,rb:!0},rg32float:{gl:33328,rb:!0},rgba16uint:{gl:36214,rb:!0},rgba16sint:{gl:36232,rb:!0},rgba16float:{gl:34842},rgba16unorm:{gl:32859,rb:!0},rgba16snorm:{gl:36763},"rgb32float-webgl":{gl:34837,x:Rne,dataFormat:6407,types:[5126]},rgba32uint:{gl:36208,rb:!0},rgba32sint:{gl:36226,rb:!0},rgba32float:{gl:34836,rb:!0},stencil8:{gl:36168,rb:!0},depth16unorm:{gl:33189,dataFormat:6402,types:[5123],rb:!0},depth24plus:{gl:33190,dataFormat:6402,types:[5125]},depth32float:{gl:36012,dataFormat:6402,types:[5126],rb:!0},"depth24plus-stencil8":{gl:35056,rb:!0,depthTexture:!0,dataFormat:34041,types:[34042]},"depth32float-stencil8":{gl:36013,dataFormat:34041,types:[36269],rb:!0},"bc1-rgb-unorm-webgl":{gl:33776,x:f1},"bc1-rgb-unorm-srgb-webgl":{gl:35916,x:d1},"bc1-rgba-unorm":{gl:33777,x:f1},"bc1-rgba-unorm-srgb":{gl:35916,x:d1},"bc2-rgba-unorm":{gl:33778,x:f1},"bc2-rgba-unorm-srgb":{gl:35918,x:d1},"bc3-rgba-unorm":{gl:33779,x:f1},"bc3-rgba-unorm-srgb":{gl:35919,x:d1},"bc4-r-unorm":{gl:36283,x:g0},"bc4-r-snorm":{gl:36284,x:g0},"bc5-rg-unorm":{gl:36285,x:g0},"bc5-rg-snorm":{gl:36286,x:g0},"bc6h-rgb-ufloat":{gl:36495,x:v0},"bc6h-rgb-float":{gl:36494,x:v0},"bc7-rgba-unorm":{gl:36492,x:v0},"bc7-rgba-unorm-srgb":{gl:36493,x:v0},"etc2-rgb8unorm":{gl:37492},"etc2-rgb8unorm-srgb":{gl:37494},"etc2-rgb8a1unorm":{gl:37496},"etc2-rgb8a1unorm-srgb":{gl:37497},"etc2-rgba8unorm":{gl:37493},"etc2-rgba8unorm-srgb":{gl:37495},"eac-r11unorm":{gl:37488},"eac-r11snorm":{gl:37489},"eac-rg11unorm":{gl:37490},"eac-rg11snorm":{gl:37491},"astc-4x4-unorm":{gl:37808},"astc-4x4-unorm-srgb":{gl:37840},"astc-5x4-unorm":{gl:37809},"astc-5x4-unorm-srgb":{gl:37841},"astc-5x5-unorm":{gl:37810},"astc-5x5-unorm-srgb":{gl:37842},"astc-6x5-unorm":{gl:37811},"astc-6x5-unorm-srgb":{gl:37843},"astc-6x6-unorm":{gl:37812},"astc-6x6-unorm-srgb":{gl:37844},"astc-8x5-unorm":{gl:37813},"astc-8x5-unorm-srgb":{gl:37845},"astc-8x6-unorm":{gl:37814},"astc-8x6-unorm-srgb":{gl:37846},"astc-8x8-unorm":{gl:37815},"astc-8x8-unorm-srgb":{gl:37847},"astc-10x5-unorm":{gl:37819},"astc-10x5-unorm-srgb":{gl:37851},"astc-10x6-unorm":{gl:37817},"astc-10x6-unorm-srgb":{gl:37849},"astc-10x8-unorm":{gl:37818},"astc-10x8-unorm-srgb":{gl:37850},"astc-10x10-unorm":{gl:37819},"astc-10x10-unorm-srgb":{gl:37851},"astc-12x10-unorm":{gl:37820},"astc-12x10-unorm-srgb":{gl:37852},"astc-12x12-unorm":{gl:37821},"astc-12x12-unorm-srgb":{gl:37853},"pvrtc-rgb4unorm-webgl":{gl:35840},"pvrtc-rgba4unorm-webgl":{gl:35842},"pvrtc-rbg2unorm-webgl":{gl:35841},"pvrtc-rgba2unorm-webgl":{gl:35843},"etc1-rbg-unorm-webgl":{gl:36196},"atc-rgb-unorm-webgl":{gl:35986},"atc-rgba-unorm-webgl":{gl:35986},"atc-rgbai-unorm-webgl":{gl:34798}};function Lne(r,e,t){let i=e.create;const n=nk[e.format];return n?.gl===void 0&&(i=!1),n?.x&&(i=i&&!!H0(r,n.x,t)),{format:e.format,create:i&&e.create,render:i&&e.render,filter:i&&e.filter,blend:i&&e.blend,store:i&&e.store}}function uj(r){const e=nk[r],t=Bne(r),i=S0.getInfo(r);return i.compressed&&(e.dataFormat=t),{internalFormat:t,format:e?.dataFormat||Nne(i.channels,i.integer,i.normalized,t),type:i.dataType?lj(i.dataType):e?.types?.[0]||5121,compressed:i.compressed||!1}}function One(r){switch(S0.getInfo(r).attachment){case"depth":return 36096;case"stencil":return 36128;case"depth-stencil":return 33306;default:throw new Error(`Not a depth stencil format: ${r}`)}}function Nne(r,e,t,i){if(i===6408||i===6407)return i;switch(r){case"r":return e&&!t?36244:6403;case"rg":return e&&!t?33320:33319;case"rgb":return e&&!t?36248:6407;case"rgba":return e&&!t?36249:6408;case"bgra":throw new Error("bgra pixels not supported by WebGL");default:return 6408}}function Bne(r){const t=nk[r]?.gl;if(t===void 0)throw new Error(`Unsupported texture format ${r}`);return t}const RB={"depth-clip-control":"EXT_depth_clamp","timer-query-webgl":"EXT_disjoint_timer_query_webgl2","compilation-status-async-webgl":"KHR_parallel_shader_compile","polygon-mode-webgl":"WEBGL_polygon_mode","provoking-vertex-webgl":"WEBGL_provoking_vertex","shader-clip-cull-distance-webgl":"WEBGL_clip_cull_distance","shader-noperspective-interpolation-webgl":"NV_shader_noperspective_interpolation","shader-conservative-depth-webgl":"EXT_conservative_depth"};class zne extends aQ{gl;extensions;testedFeatures=new Set;constructor(e,t,i){super([],i),this.gl=e,this.extensions=t,H0(e,"EXT_color_buffer_float",t)}*[Symbol.iterator](){const e=this.getFeatures();for(const t of e)this.has(t)&&(yield t);return[]}has(e){return this.disabledFeatures?.[e]?!1:(this.testedFeatures.has(e)||(this.testedFeatures.add(e),Dne(e)&&kne(this.gl,e,this.extensions)&&this.features.add(e),this.getWebGLFeature(e)&&this.features.add(e)),this.features.has(e))}initializeFeatures(){const e=this.getFeatures().filter(t=>t!=="polygon-mode-webgl");for(const t of e)this.has(t)}getFeatures(){return[...Object.keys(RB),...Object.keys(ik)]}getWebGLFeature(e){const t=RB[e];return typeof t=="string"?!!H0(this.gl,t,this.extensions):!!t}}class Fne extends nQ{get maxTextureDimension1D(){return 0}get maxTextureDimension2D(){return this.getParameter(3379)}get maxTextureDimension3D(){return this.getParameter(32883)}get maxTextureArrayLayers(){return this.getParameter(35071)}get maxBindGroups(){return 0}get maxDynamicUniformBuffersPerPipelineLayout(){return 0}get maxDynamicStorageBuffersPerPipelineLayout(){return 0}get maxSampledTexturesPerShaderStage(){return this.getParameter(35660)}get maxSamplersPerShaderStage(){return this.getParameter(35661)}get maxStorageBuffersPerShaderStage(){return 0}get maxStorageTexturesPerShaderStage(){return 0}get maxUniformBuffersPerShaderStage(){return this.getParameter(35375)}get maxUniformBufferBindingSize(){return this.getParameter(35376)}get maxStorageBufferBindingSize(){return 0}get minUniformBufferOffsetAlignment(){return this.getParameter(35380)}get minStorageBufferOffsetAlignment(){return 0}get maxVertexBuffers(){return 16}get maxVertexAttributes(){return this.getParameter(34921)}get maxVertexBufferArrayStride(){return 2048}get maxInterStageShaderVariables(){return this.getParameter(35659)}get maxComputeWorkgroupStorageSize(){return 0}get maxComputeInvocationsPerWorkgroup(){return 0}get maxComputeWorkgroupSizeX(){return 0}get maxComputeWorkgroupSizeY(){return 0}get maxComputeWorkgroupSizeZ(){return 0}get maxComputeWorkgroupsPerDimension(){return 0}gl;limits={};constructor(e){super(),this.gl=e}getParameter(e){return this.limits[e]===void 0&&(this.limits[e]=this.gl.getParameter(e)),this.limits[e]||0}}class R1 extends mC{device;gl;handle;colorAttachments=[];depthStencilAttachment=null;constructor(e,t){super(e,t);const i=t.handle===null;this.device=e,this.gl=e.gl,this.handle=this.props.handle||i?this.props.handle:this.gl.createFramebuffer(),i||(e._setWebGLDebugMetadata(this.handle,this,{spector:this.props}),this.autoCreateAttachmentTextures(),this.updateAttachments())}destroy(){super.destroy(),!this.destroyed&&this.handle!==null&&this.gl.deleteFramebuffer(this.handle)}updateAttachments(){const e=this.gl.bindFramebuffer(36160,this.handle);for(let t=0;t<this.colorAttachments.length;++t){const i=this.colorAttachments[t];if(i){const n=36064+t;this._attachTextureView(n,i)}}if(this.depthStencilAttachment){const t=One(this.depthStencilAttachment.props.format);this._attachTextureView(t,this.depthStencilAttachment)}if(this.device.props.debug){const t=this.gl.checkFramebufferStatus(36160);if(t!==36053)throw new Error(`Framebuffer ${Une(t)}`)}this.gl.bindFramebuffer(36160,e)}_attachTextureView(e,t){const{gl:i}=this.device,{texture:n}=t,a=t.props.baseMipLevel,s=t.props.baseArrayLayer;switch(i.bindTexture(n.glTarget,n.handle),n.glTarget){case 35866:case 32879:i.framebufferTextureLayer(36160,e,n.handle,a,s);break;case 34067:const o=Vne(s);i.framebufferTexture2D(36160,e,o,n.handle,a);break;case 3553:i.framebufferTexture2D(36160,e,3553,n.handle,a);break;default:throw new Error("Illegal texture type")}i.bindTexture(n.glTarget,null)}}function Vne(r){return r<34069?r+34069:r}function Une(r){switch(r){case 36053:return"success";case 36054:return"Mismatched attachments";case 36055:return"No attachments";case 36057:return"Height/width mismatch";case 36061:return"Unsupported or split attachments";case 36182:return"Samples mismatch";default:return`${r}`}}class Hne extends Fm{device;handle=null;_framebuffer=null;get[Symbol.toStringTag](){return"WebGLCanvasContext"}constructor(e,t){super(t),this.device=e,this._setAutoCreatedCanvasId(`${this.device.id}-canvas`),this._updateDevice()}getCurrentFramebuffer(){return this._framebuffer=this._framebuffer||new R1(this.device,{handle:null}),this._framebuffer}_updateDevice(){}}const cE={};function jne(r="id"){cE[r]=cE[r]||1;const e=cE[r]++;return`${r}-${e}`}class D1 extends ua{device;gl;handle;glTarget;glUsage;glIndexType=5123;byteLength=0;bytesUsed=0;constructor(e,t={}){super(e,t),this.device=e,this.gl=this.device.gl;const i=typeof t=="object"?t.handle:void 0;this.handle=i||this.gl.createBuffer(),e._setWebGLDebugMetadata(this.handle,this,{spector:{...this.props,data:typeof this.props.data}}),this.glTarget=$ne(this.props.usage),this.glUsage=Wne(this.props.usage),this.glIndexType=this.props.indexType==="uint32"?5125:5123,t.data?this._initWithData(t.data,t.byteOffset,t.byteLength):this._initWithByteLength(t.byteLength||0)}destroy(){!this.destroyed&&this.handle&&(this.removeStats(),this.trackDeallocatedMemory(),this.gl.deleteBuffer(this.handle),this.destroyed=!0,this.handle=null)}_initWithData(e,t=0,i=e.byteLength+t){const n=this.glTarget;this.gl.bindBuffer(n,this.handle),this.gl.bufferData(n,i,this.glUsage),this.gl.bufferSubData(n,t,e),this.gl.bindBuffer(n,null),this.bytesUsed=i,this.byteLength=i,this._setDebugData(e,t,i),this.trackAllocatedMemory(i)}_initWithByteLength(e){let t=e;e===0&&(t=new Float32Array(0));const i=this.glTarget;return this.gl.bindBuffer(i,this.handle),this.gl.bufferData(i,t,this.glUsage),this.gl.bindBuffer(i,null),this.bytesUsed=e,this.byteLength=e,this._setDebugData(null,0,e),this.trackAllocatedMemory(e),this}write(e,t=0){const i=ArrayBuffer.isView(e)?e:new Uint8Array(e),n=36663;this.gl.bindBuffer(n,this.handle),this.gl.bufferSubData(n,t,i),this.gl.bindBuffer(n,null),this._setDebugData(e,t,e.byteLength)}async mapAndWriteAsync(e,t=0,i=this.byteLength-t){const n=new ArrayBuffer(i);await e(n,"copied"),this.write(n,t)}async readAsync(e=0,t){return this.readSyncWebGL(e,t)}async mapAndReadAsync(e,t=0,i){const n=await this.readAsync(t,i);return await e(n.buffer,"copied")}readSyncWebGL(e=0,t){t=t??this.byteLength-e;const i=new Uint8Array(t),n=0;return this.gl.bindBuffer(36662,this.handle),this.gl.getBufferSubData(36662,e,i,n,t),this.gl.bindBuffer(36662,null),this._setDebugData(i,e,t),i}}function $ne(r){return r&ua.INDEX?34963:r&ua.VERTEX?34962:r&ua.UNIFORM?35345:34962}function Wne(r){return r&ua.INDEX||r&ua.VERTEX?35044:r&ua.UNIFORM?35048:35044}function Gne(r){const e=r.split(/\r?\n/),t=[];for(const i of e){if(i.length<=1)continue;const n=i.split(":");if(n.length===2){const[p,y]=n;t.push({message:y.trim(),type:DB(p),lineNum:0,linePos:0});continue}const[a,s,o,...l]=n;let c=parseInt(o,10);isNaN(c)&&(c=0);let f=parseInt(s,10);isNaN(f)&&(f=0),t.push({message:l.join(":").trim(),type:DB(a),lineNum:c,linePos:f})}return t}function DB(r){const e=["warning","error","info"],t=r.toLowerCase();return e.includes(t)?t:"info"}class Xne extends vC{device;handle;constructor(e,t){switch(super(e,t),this.device=e,this.props.stage){case"vertex":this.handle=this.props.handle||this.device.gl.createShader(35633);break;case"fragment":this.handle=this.props.handle||this.device.gl.createShader(35632);break;default:throw new Error(this.props.stage)}e._setWebGLDebugMetadata(this.handle,this,{spector:this.props}),this._compile(this.source)}destroy(){this.handle&&(this.removeStats(),this.device.gl.deleteShader(this.handle),this.destroyed=!0,this.handle.destroyed=!0)}get asyncCompilationStatus(){return this._waitForCompilationComplete().then(()=>(this._getCompilationStatus(),this.compilationStatus))}async getCompilationInfo(){return await this._waitForCompilationComplete(),this.getCompilationInfoSync()}getCompilationInfoSync(){const e=this.device.gl.getShaderInfoLog(this.handle);return e?Gne(e):[]}getTranslatedSource(){return this.device.getExtension("WEBGL_debug_shaders").WEBGL_debug_shaders?.getTranslatedShaderSource(this.handle)||null}async _compile(e){e=e.startsWith("#version ")?e:`#version 300 es
${e}`;const{gl:t}=this.device;if(t.shaderSource(this.handle,e),t.compileShader(this.handle),!this.device.props.debug){this.compilationStatus="pending";return}if(!this.device.features.has("compilation-status-async-webgl")){if(this._getCompilationStatus(),this.debugShader(),this.compilationStatus==="error")throw new Error(`GLSL compilation errors in ${this.props.stage} shader ${this.props.id}`);return}Nt.once(1,"Shader compilation is asynchronous")(),await this._waitForCompilationComplete(),Nt.info(2,`Shader ${this.id} - async compilation complete: ${this.compilationStatus}`)(),this._getCompilationStatus(),this.debugShader()}async _waitForCompilationComplete(){const e=async n=>await new Promise(a=>setTimeout(a,n));if(!this.device.features.has("compilation-status-async-webgl")){await e(10);return}const{gl:i}=this.device;for(;;){if(i.getShaderParameter(this.handle,37297))return;await e(10)}}_getCompilationStatus(){this.compilationStatus=this.device.gl.getShaderParameter(this.handle,35713)?"success":"error"}}function Zne(r,e,t,i){if(Qne(e))return i(r);const n=r;n.pushState();try{return qne(r,e),ib(n.gl,t),i(r)}finally{n.popState()}}function qne(r,e){const t=r,{gl:i}=t;if(e.cullMode)switch(e.cullMode){case"none":i.disable(2884);break;case"front":i.enable(2884),i.cullFace(1028);break;case"back":i.enable(2884),i.cullFace(1029);break}if(e.frontFace&&i.frontFace(ey("frontFace",e.frontFace,{ccw:2305,cw:2304})),e.unclippedDepth&&r.features.has("depth-clip-control")&&i.enable(34383),e.depthBias!==void 0&&(i.enable(32823),i.polygonOffset(e.depthBias,e.depthBiasSlopeScale||0)),e.provokingVertex&&r.features.has("provoking-vertex-webgl")){const a=t.getExtension("WEBGL_provoking_vertex").WEBGL_provoking_vertex,s=ey("provokingVertex",e.provokingVertex,{first:36429,last:36430});a?.provokingVertexWEBGL(s)}if((e.polygonMode||e.polygonOffsetLine)&&r.features.has("polygon-mode-webgl")){if(e.polygonMode){const a=t.getExtension("WEBGL_polygon_mode").WEBGL_polygon_mode,s=ey("polygonMode",e.polygonMode,{fill:6914,line:6913});a?.polygonModeWEBGL(1028,s),a?.polygonModeWEBGL(1029,s)}e.polygonOffsetLine&&i.enable(10754)}if(r.features.has("shader-clip-cull-distance-webgl")&&(e.clipDistance0&&i.enable(12288),e.clipDistance1&&i.enable(12289),e.clipDistance2&&i.enable(12290),e.clipDistance3&&i.enable(12291),e.clipDistance4&&i.enable(12292),e.clipDistance5&&i.enable(12293),e.clipDistance6&&i.enable(12294),e.clipDistance7&&i.enable(12295)),e.depthWriteEnabled!==void 0&&i.depthMask(Kne("depthWriteEnabled",e.depthWriteEnabled)),e.depthCompare&&(e.depthCompare!=="always"?i.enable(2929):i.disable(2929),i.depthFunc(mR("depthCompare",e.depthCompare))),e.stencilWriteMask){const n=e.stencilWriteMask;i.stencilMaskSeparate(1028,n),i.stencilMaskSeparate(1029,n)}if(e.stencilReadMask&&Nt.warn("stencilReadMask not supported under WebGL"),e.stencilCompare){const n=e.stencilReadMask||4294967295,a=mR("depthCompare",e.stencilCompare);e.stencilCompare!=="always"?i.enable(2960):i.disable(2960),i.stencilFuncSeparate(1028,a,0,n),i.stencilFuncSeparate(1029,a,0,n)}if(e.stencilPassOperation&&e.stencilFailOperation&&e.stencilDepthFailOperation){const n=hE("stencilPassOperation",e.stencilPassOperation),a=hE("stencilFailOperation",e.stencilFailOperation),s=hE("stencilDepthFailOperation",e.stencilDepthFailOperation);i.stencilOpSeparate(1028,a,s,n),i.stencilOpSeparate(1029,a,s,n)}switch(e.blend){case!0:i.enable(3042);break;case!1:i.disable(3042);break}if(e.blendColorOperation||e.blendAlphaOperation){const n=kB("blendColorOperation",e.blendColorOperation||"add"),a=kB("blendAlphaOperation",e.blendAlphaOperation||"add");i.blendEquationSeparate(n,a);const s=cT("blendColorSrcFactor",e.blendColorSrcFactor||"one"),o=cT("blendColorDstFactor",e.blendColorDstFactor||"zero"),l=cT("blendAlphaSrcFactor",e.blendAlphaSrcFactor||"one"),c=cT("blendAlphaDstFactor",e.blendAlphaDstFactor||"zero");i.blendFuncSeparate(s,o,l,c)}}function mR(r,e){return ey(r,e,{never:512,less:513,equal:514,"less-equal":515,greater:516,"not-equal":517,"greater-equal":518,always:519})}function hE(r,e){return ey(r,e,{keep:7680,zero:0,replace:7681,invert:5386,"increment-clamp":7682,"decrement-clamp":7683,"increment-wrap":34055,"decrement-wrap":34056})}function kB(r,e){return ey(r,e,{add:32774,subtract:32778,"reverse-subtract":32779,min:32775,max:32776})}function cT(r,e,t="color"){return ey(r,e,{one:1,zero:0,src:768,"one-minus-src":769,dst:774,"one-minus-dst":775,"src-alpha":770,"one-minus-src-alpha":771,"dst-alpha":772,"one-minus-dst-alpha":773,"src-alpha-saturated":776,constant:t==="color"?32769:32771,"one-minus-constant":t==="color"?32770:32772,src1:768,"one-minus-src1":769,"src1-alpha":770,"one-minus-src1-alpha":771})}function Yne(r,e){return`Illegal parameter ${e} for ${r}`}function ey(r,e,t){if(!(e in t))throw new Error(Yne(r,e));return t[e]}function Kne(r,e){return e}function Qne(r){let e=!0;for(const t in r){e=!1;break}return e}function cj(r){const e={};return r.addressModeU&&(e[10242]=fE(r.addressModeU)),r.addressModeV&&(e[10243]=fE(r.addressModeV)),r.addressModeW&&(e[32882]=fE(r.addressModeW)),r.magFilter&&(e[10240]=yR(r.magFilter)),(r.minFilter||r.mipmapFilter)&&(e[10241]=Jne(r.minFilter||"linear",r.mipmapFilter)),r.lodMinClamp!==void 0&&(e[33082]=r.lodMinClamp),r.lodMaxClamp!==void 0&&(e[33083]=r.lodMaxClamp),r.type==="comparison-sampler"&&(e[34892]=34894),r.compare&&(e[34893]=mR("compare",r.compare)),r.maxAnisotropy&&(e[34046]=r.maxAnisotropy),e}function fE(r){switch(r){case"clamp-to-edge":return 33071;case"repeat":return 10497;case"mirror-repeat":return 33648}}function yR(r){switch(r){case"nearest":return 9728;case"linear":return 9729}}function Jne(r,e="none"){if(!e)return yR(r);switch(e){case"none":return yR(r);case"nearest":switch(r){case"nearest":return 9984;case"linear":return 9985}break;case"linear":switch(r){case"nearest":return 9986;case"linear":return 9987}}}class eae extends uy{device;handle;parameters;constructor(e,t){super(e,t),this.device=e,this.parameters=cj(t),this.handle=t.handle||this.device.gl.createSampler(),this._setSamplerParameters(this.parameters)}destroy(){this.handle&&(this.device.gl.deleteSampler(this.handle),this.handle=void 0)}toString(){return`Sampler(${this.id},${JSON.stringify(this.props)})`}_setSamplerParameters(e){for(const[t,i]of Object.entries(e)){const n=Number(t);switch(n){case 33082:case 33083:this.device.gl.samplerParameterf(this.handle,n,i);break;default:this.device.gl.samplerParameteri(this.handle,n,i);break}}}}function rw(r,e,t){if(tae(e))return t(r);const{nocatch:i=!0}=e,n=Jm.get(r);n.push(),ib(r,e);let a;if(i)a=t(r),n.pop();else try{a=t(r)}finally{n.pop()}return a}function tae(r){for(const e in r)return!1;return!0}class m0 extends gC{device;gl;handle;texture;constructor(e,t){super(e,{...lo.defaultProps,...t}),this.device=e,this.gl=this.device.gl,this.handle=null,this.texture=t.texture}}class k1 extends lo{device;gl;handle;sampler=void 0;view;glTarget;glFormat;glType;glInternalFormat;compressed;_textureUnit=0;constructor(e,t){super(e,t),this.device=e,this.gl=this.device.gl;const i=uj(this.props.format);this.glTarget=rae(this.props.dimension),this.glInternalFormat=i.internalFormat,this.glFormat=i.format,this.glType=i.type,this.compressed=i.compressed,this.handle=this.props.handle||this.gl.createTexture(),this.device._setWebGLDebugMetadata(this.handle,this,{spector:this.props}),this.gl.bindTexture(this.glTarget,this.handle);const{dimension:n,width:a,height:s,depth:o,mipLevels:l,glTarget:c,glInternalFormat:f}=this;switch(n){case"2d":case"cube":this.gl.texStorage2D(c,l,f,a,s);break;case"2d-array":case"3d":this.gl.texStorage3D(c,l,f,a,s,o);break;default:throw new Error(n)}this.gl.bindTexture(this.glTarget,null),this._initializeData(t.data),this.setSampler(this.props.sampler),this.view=new m0(this.device,{...this.props,texture:this}),Object.seal(this)}destroy(){this.handle&&(this.gl.deleteTexture(this.handle),this.removeStats(),this.trackDeallocatedMemory("Texture"),this.destroyed=!0)}createView(e){return new m0(this.device,{...e,texture:this})}setSampler(e={}){super.setSampler(e);const t=cj(this.sampler.props);this._setSamplerParameters(t)}copyImageData(e){const t=this._normalizeCopyImageDataOptions(e),i=t.data,{width:n,height:a,depth:s}=this,{mipLevel:o=0,byteOffset:l=0,x:c=0,y:f=0,z:p=0}=t,{glFormat:y,glType:b,compressed:S}=this,C=LB(this.glTarget,this.dimension,s),E=this.compressed?{}:{3314:t.bytesPerRow,32878:t.rowsPerImage};this.gl.bindTexture(C,this.handle),rw(this.gl,E,()=>{switch(this.dimension){case"2d":case"cube":S?this.gl.compressedTexSubImage2D(C,o,c,f,n,a,y,i,l):this.gl.texSubImage2D(C,o,c,f,n,a,y,b,i,l);break;case"2d-array":case"3d":S?this.gl.compressedTexSubImage3D(C,o,c,f,p,n,a,s,y,i,l):this.gl.texSubImage3D(C,o,c,f,p,n,a,s,y,b,i,l);break;default:}}),this.gl.bindTexture(C,null)}copyExternalImage(e){const t=this._normalizeCopyExternalImageOptions(e);if(t.sourceX||t.sourceY)throw new Error("WebGL does not support sourceX/sourceY)");const{glFormat:i,glType:n}=this,{image:a,depth:s,mipLevel:o,x:l,y:c,z:f,width:p,height:y}=t,b=LB(this.glTarget,this.dimension,s),S=t.flipY?{37440:!0}:{};return this.gl.bindTexture(this.glTarget,this.handle),rw(this.gl,S,()=>{switch(this.dimension){case"2d":case"cube":this.gl.texSubImage2D(b,o,l,c,p,y,i,n,a);break;case"2d-array":case"3d":this.gl.texSubImage3D(b,o,l,c,f,p,y,s,i,n,a);break;default:}}),this.gl.bindTexture(this.glTarget,null),{width:t.width,height:t.height}}generateMipmapsWebGL(e){if(!(!(this.device.isTextureFormatRenderable(this.props.format)&&this.device.isTextureFormatFilterable(this.props.format))&&(Nt.warn(`${this} is not renderable or filterable, may not be able to generate mipmaps`)(),!e?.force)))try{this.gl.bindTexture(this.glTarget,this.handle),this.gl.generateMipmap(this.glTarget)}catch(i){Nt.warn(`Error generating mipmap for ${this}: ${i.message}`)()}finally{this.gl.bindTexture(this.glTarget,null)}}_setSamplerParameters(e){Nt.log(2,`${this.id} sampler parameters`,this.device.getGLKeys(e))(),this.gl.bindTexture(this.glTarget,this.handle);for(const[t,i]of Object.entries(e)){const n=Number(t),a=i;switch(n){case 33082:case 33083:this.gl.texParameterf(this.glTarget,n,a);break;case 10240:case 10241:this.gl.texParameteri(this.glTarget,n,a);break;case 10242:case 10243:case 32882:this.gl.texParameteri(this.glTarget,n,a);break;case 34046:this.device.features.has("texture-filterable-anisotropic-webgl")&&this.gl.texParameteri(this.glTarget,n,a);break;case 34892:case 34893:this.gl.texParameteri(this.glTarget,n,a);break}}this.gl.bindTexture(this.glTarget,null)}_getActiveUnit(){return this.gl.getParameter(34016)-33984}_bind(e){const{gl:t}=this;return e!==void 0&&(this._textureUnit=e,t.activeTexture(33984+e)),t.bindTexture(this.glTarget,this.handle),e}_unbind(e){const{gl:t}=this;return e!==void 0&&(this._textureUnit=e,t.activeTexture(33984+e)),t.bindTexture(this.glTarget,null),e}}function rae(r){switch(r){case"1d":break;case"2d":return 3553;case"3d":return 32879;case"cube":return 34067;case"2d-array":return 35866}throw new Error(r)}function LB(r,e,t){return e==="cube"?34069+t:r}function iae(r){return sae[r]}function ak(r){return oae[r]}function nae(r){return!!hj[r]}function aae(r){return hj[r]}const oae={5126:"f32",35664:"vec2<f32>",35665:"vec3<f32>",35666:"vec4<f32>",5124:"i32",35667:"vec2<i32>",35668:"vec3<i32>",35669:"vec4<i32>",5125:"u32",36294:"vec2<u32>",36295:"vec3<u32>",36296:"vec4<u32>",35670:"f32",35671:"vec2<f32>",35672:"vec3<f32>",35673:"vec4<f32>",35674:"mat2x2<f32>",35685:"mat2x3<f32>",35686:"mat2x4<f32>",35687:"mat3x2<f32>",35675:"mat3x3<f32>",35688:"mat3x4<f32>",35689:"mat4x2<f32>",35690:"mat4x3<f32>",35676:"mat4x4<f32>"},hj={35678:{viewDimension:"2d",sampleType:"float"},35680:{viewDimension:"cube",sampleType:"float"},35679:{viewDimension:"3d",sampleType:"float"},35682:{viewDimension:"3d",sampleType:"depth"},36289:{viewDimension:"2d-array",sampleType:"float"},36292:{viewDimension:"2d-array",sampleType:"depth"},36293:{viewDimension:"cube",sampleType:"float"},36298:{viewDimension:"2d",sampleType:"sint"},36299:{viewDimension:"3d",sampleType:"sint"},36300:{viewDimension:"cube",sampleType:"sint"},36303:{viewDimension:"2d-array",sampleType:"uint"},36306:{viewDimension:"2d",sampleType:"uint"},36307:{viewDimension:"3d",sampleType:"uint"},36308:{viewDimension:"cube",sampleType:"uint"},36311:{viewDimension:"2d-array",sampleType:"uint"}},sae={uint8:5121,sint8:5120,unorm8:5121,snorm8:5120,uint16:5123,sint16:5122,unorm16:5123,snorm16:5122,uint32:5125,sint32:5124,float16:5131,float32:5126};function lae(r,e){const t={attributes:[],bindings:[]};t.attributes=uae(r,e);const i=fae(r,e);for(const o of i){const l=o.uniforms.map(c=>({name:c.name,format:c.format,byteOffset:c.byteOffset,byteStride:c.byteStride,arrayLength:c.arrayLength}));t.bindings.push({type:"uniform",name:o.name,group:0,location:o.location,visibility:(o.vertex?1:0)&(o.fragment?2:0),minBindingSize:o.byteLength,uniforms:l})}const n=hae(r,e);let a=0;for(const o of n)if(nae(o.type)){const{viewDimension:l,sampleType:c}=aae(o.type);t.bindings.push({type:"texture",name:o.name,group:0,location:a,viewDimension:l,sampleType:c}),o.textureUnit=a,a+=1}n.length&&(t.uniforms=n);const s=cae(r,e);return s?.length&&(t.varyings=s),t}function uae(r,e){const t=[],i=r.getProgramParameter(e,35721);for(let n=0;n<i;n++){const a=r.getActiveAttrib(e,n);if(!a)throw new Error("activeInfo");const{name:s,type:o}=a,l=r.getAttribLocation(e,s);if(l>=0){const c=ak(o),f=/instance/i.test(s)?"instance":"vertex";t.push({name:s,location:l,stepMode:f,type:c})}}return t.sort((n,a)=>n.location-a.location),t}function cae(r,e){const t=[],i=r.getProgramParameter(e,35971);for(let n=0;n<i;n++){const a=r.getTransformFeedbackVarying(e,n);if(!a)throw new Error("activeInfo");const{name:s,type:o,size:l}=a,c=ak(o),{type:f,components:p}=Z8(c);t.push({location:n,name:s,type:f,size:l*p})}return t.sort((n,a)=>n.location-a.location),t}function hae(r,e){const t=[],i=r.getProgramParameter(e,35718);for(let n=0;n<i;n++){const a=r.getActiveUniform(e,n);if(!a)throw new Error("activeInfo");const{name:s,size:o,type:l}=a,{name:c,isArray:f}=dae(s);let p=r.getUniformLocation(e,c);const y={location:p,name:c,size:o,type:l,isArray:f};if(t.push(y),y.size>1)for(let b=0;b<y.size;b++){const S=`${c}[${b}]`;p=r.getUniformLocation(e,S);const C={...y,name:S,location:p};t.push(C)}}return t}function fae(r,e){const t=(a,s)=>r.getActiveUniformBlockParameter(e,a,s),i=[],n=r.getProgramParameter(e,35382);for(let a=0;a<n;a++){const s={name:r.getActiveUniformBlockName(e,a)||"",location:t(a,35391),byteLength:t(a,35392),vertex:t(a,35396),fragment:t(a,35398),uniformCount:t(a,35394),uniforms:[]},o=t(a,35395)||[],l=r.getActiveUniforms(e,o,35383),c=r.getActiveUniforms(e,o,35384),f=r.getActiveUniforms(e,o,35387),p=r.getActiveUniforms(e,o,35388);for(let y=0;y<s.uniformCount;++y){const b=r.getActiveUniform(e,o[y]);if(!b)throw new Error("activeInfo");const S=ak(l[y]);s.uniforms.push({name:b.name,format:S,type:l[y],arrayLength:c[y],byteOffset:f[y],byteStride:p[y]})}i.push(s)}return i.sort((a,s)=>a.location-s.location),i}function dae(r){if(r[r.length-1]!=="]")return{name:r,length:1,isArray:!1};const t=/([^[]*)(\[[0-9]+\])?/.exec(r);if(!t||t.length<2)throw new Error(`Failed to parse GLSL uniform name ${r}`);return{name:t[1],length:t[2]?1:0,isArray:!!t[2]}}function pae(r,e,t,i){const n=r;let a=i;a===!0&&(a=1),a===!1&&(a=0);const s=typeof a=="number"?[a]:a;switch(t){case 35678:case 35680:case 35679:case 35682:case 36289:case 36292:case 36293:case 36298:case 36299:case 36300:case 36303:case 36306:case 36307:case 36308:case 36311:if(typeof i!="number")throw new Error("samplers must be set to integers");return r.uniform1i(e,i);case 5126:return r.uniform1fv(e,s);case 35664:return r.uniform2fv(e,s);case 35665:return r.uniform3fv(e,s);case 35666:return r.uniform4fv(e,s);case 5124:return r.uniform1iv(e,s);case 35667:return r.uniform2iv(e,s);case 35668:return r.uniform3iv(e,s);case 35669:return r.uniform4iv(e,s);case 35670:return r.uniform1iv(e,s);case 35671:return r.uniform2iv(e,s);case 35672:return r.uniform3iv(e,s);case 35673:return r.uniform4iv(e,s);case 5125:return n.uniform1uiv(e,s,1);case 36294:return n.uniform2uiv(e,s,2);case 36295:return n.uniform3uiv(e,s,3);case 36296:return n.uniform4uiv(e,s,4);case 35674:return r.uniformMatrix2fv(e,!1,s);case 35675:return r.uniformMatrix3fv(e,!1,s);case 35676:return r.uniformMatrix4fv(e,!1,s);case 35685:return n.uniformMatrix2x3fv(e,!1,s);case 35686:return n.uniformMatrix2x4fv(e,!1,s);case 35687:return n.uniformMatrix3x2fv(e,!1,s);case 35688:return n.uniformMatrix3x4fv(e,!1,s);case 35689:return n.uniformMatrix4x2fv(e,!1,s);case 35690:return n.uniformMatrix4x3fv(e,!1,s)}throw new Error("Illegal uniform")}function gae(r){switch(r){case"point-list":return 0;case"line-list":return 1;case"line-strip":return 3;case"triangle-list":return 4;case"triangle-strip":return 5;default:throw new Error(r)}}function vae(r){switch(r){case"point-list":return 0;case"line-list":return 1;case"line-strip":return 1;case"triangle-list":return 4;case"triangle-strip":return 4;default:throw new Error(r)}}const OB=4;class mae extends Ym{device;handle;vs;fs;introspectedLayout;uniforms={};bindings={};varyings=null;_uniformCount=0;_uniformSetters={};get[Symbol.toStringTag](){return"WEBGLRenderPipeline"}constructor(e,t){super(e,t),this.device=e,this.handle=this.props.handle||this.device.gl.createProgram(),this.device._setWebGLDebugMetadata(this.handle,this,{spector:{id:this.props.id}}),this.vs=t.vs,this.fs=t.fs;const{varyings:i,bufferMode:n=35981}=t;i&&i.length>0&&(this.varyings=i,this.device.gl.transformFeedbackVaryings(this.handle,i,n)),this._linkShaders(),Nt.time(3,`RenderPipeline ${this.id} - shaderLayout introspection`)(),this.introspectedLayout=lae(this.device.gl,this.handle),Nt.timeEnd(3,`RenderPipeline ${this.id} - shaderLayout introspection`)(),this.shaderLayout=t.shaderLayout?yae(this.introspectedLayout,t.shaderLayout):this.introspectedLayout}destroy(){this.handle&&(this.device.gl.useProgram(null),this.device.gl.deleteProgram(this.handle),this.destroyed=!0,this.handle.destroyed=!0,this.handle=null)}setBindings(e,t){for(const[i,n]of Object.entries(e)){const a=this.shaderLayout.bindings.find(s=>s.name===i)||this.shaderLayout.bindings.find(s=>s.name===`${i}Uniforms`);if(!a){const s=this.shaderLayout.bindings.map(o=>`"${o.name}"`).join(", ");t?.disableWarnings||Nt.warn(`No binding "${i}" in render pipeline "${this.id}", expected one of ${s}`,n)();continue}switch(n||Nt.warn(`Unsetting binding "${i}" in render pipeline "${this.id}"`)(),a.type){case"uniform":if(!(n instanceof D1)&&!(n.buffer instanceof D1))throw new Error("buffer value");break;case"texture":if(!(n instanceof m0||n instanceof k1||n instanceof R1))throw new Error(`${this} Bad texture binding for ${i}`);break;case"sampler":Nt.warn(`Ignoring sampler ${i}`)();break;default:throw new Error(a.type)}this.bindings[i]=n}}draw(e){const{renderPass:t,parameters:i=this.props.parameters,topology:n=this.props.topology,vertexArray:a,vertexCount:s,instanceCount:o,isInstanced:l=!1,firstVertex:c=0,transformFeedback:f}=e,p=gae(n),y=!!a.indexBuffer,b=a.indexBuffer?.glIndexType;if(this.linkStatus!=="success")return Nt.info(2,`RenderPipeline:${this.id}.draw() aborted - waiting for shader linking`)(),!1;if(!this._areTexturesRenderable())return Nt.info(2,`RenderPipeline:${this.id}.draw() aborted - textures not yet loaded`)(),!1;this.device.gl.useProgram(this.handle),a.bindBeforeRender(t),f&&f.begin(this.props.topology),this._applyBindings(),this._applyUniforms();const S=t;return Zne(this.device,i,S.glParameters,()=>{y&&l?this.device.gl.drawElementsInstanced(p,s||0,b,c,o||0):y?this.device.gl.drawElements(p,s||0,b,c):l?this.device.gl.drawArraysInstanced(p,c,s||0,o||0):this.device.gl.drawArrays(p,c,s||0),f&&f.end()}),a.unbindAfterRender(t),!0}async _linkShaders(){const{gl:e}=this.device;if(e.attachShader(this.handle,this.vs.handle),e.attachShader(this.handle,this.fs.handle),Nt.time(OB,`linkProgram for ${this.id}`)(),e.linkProgram(this.handle),Nt.timeEnd(OB,`linkProgram for ${this.id}`)(),Nt.level,!this.device.features.has("compilation-status-async-webgl")){const i=this._getLinkStatus();this._reportLinkStatus(i);return}Nt.once(1,"RenderPipeline linking is asynchronous")(),await this._waitForLinkComplete(),Nt.info(2,`RenderPipeline ${this.id} - async linking complete: ${this.linkStatus}`)();const t=this._getLinkStatus();this._reportLinkStatus(t)}async _reportLinkStatus(e){switch(e){case"success":return;default:const t=e==="link-error"?"Link error":"Validation error";switch(this.vs.compilationStatus){case"error":throw this.vs.debugShader(),new Error(`${this} ${t} during compilation of ${this.vs}`);case"pending":await this.vs.asyncCompilationStatus,this.vs.debugShader();break}switch(this.fs?.compilationStatus){case"error":throw this.fs.debugShader(),new Error(`${this} ${t} during compilation of ${this.fs}`);case"pending":await this.fs.asyncCompilationStatus,this.fs.debugShader();break}const i=this.device.gl.getProgramInfoLog(this.handle);this.device.reportError(new Error(`${t} during ${e}: ${i}`),this)(),this.device.debug()}}_getLinkStatus(){const{gl:e}=this.device;return e.getProgramParameter(this.handle,35714)?(e.validateProgram(this.handle),e.getProgramParameter(this.handle,35715)?(this.linkStatus="success","success"):(this.linkStatus="error","validation-error")):(this.linkStatus="error","link-error")}async _waitForLinkComplete(){const e=async n=>await new Promise(a=>setTimeout(a,n));if(!this.device.features.has("compilation-status-async-webgl")){await e(10);return}const{gl:i}=this.device;for(;;){if(i.getProgramParameter(this.handle,37297))return;await e(10)}}_areTexturesRenderable(){let e=!0;for(const t of this.shaderLayout.bindings)!this.bindings[t.name]&&!this.bindings[t.name.replace(/Uniforms$/,"")]&&(Nt.warn(`Binding ${t.name} not found in ${this.id}`)(),e=!1);return e}_applyBindings(){if(this.linkStatus!=="success")return;const{gl:e}=this.device;e.useProgram(this.handle);let t=0,i=0;for(const n of this.shaderLayout.bindings){const a=this.bindings[n.name]||this.bindings[n.name.replace(/Uniforms$/,"")];if(!a)throw new Error(`No value for binding ${n.name} in ${this.id}`);switch(n.type){case"uniform":const{name:s}=n,o=e.getUniformBlockIndex(this.handle,s);if(o===4294967295)throw new Error(`Invalid uniform block name ${s}`);e.uniformBlockBinding(this.handle,i,o),a instanceof D1?e.bindBufferBase(35345,i,a.handle):e.bindBufferRange(35345,i,a.buffer.handle,a.offset||0,a.size||a.buffer.byteLength-a.offset),i+=1;break;case"texture":if(!(a instanceof m0||a instanceof k1||a instanceof R1))throw new Error("texture");let l;if(a instanceof m0)l=a.texture;else if(a instanceof k1)l=a;else if(a instanceof R1&&a.colorAttachments[0]instanceof m0)Nt.warn("Passing framebuffer in texture binding may be deprecated. Use fbo.colorAttachments[0] instead")(),l=a.colorAttachments[0].texture;else throw new Error("No texture");e.activeTexture(33984+t),e.bindTexture(l.glTarget,l.handle),t+=1;break;case"sampler":break;case"storage":case"read-only-storage":throw new Error(`binding type '${n.type}' not supported in WebGL`)}}}_applyUniforms(){for(const e of this.shaderLayout.uniforms||[]){const{name:t,location:i,type:n,textureUnit:a}=e,s=this.uniforms[t]??a;s!==void 0&&pae(this.device.gl,i,n,s)}}}function yae(r,e){const t={...r,attributes:r.attributes.map(i=>({...i}))};for(const i of e?.attributes||[]){const n=t.attributes.find(a=>a.name===i.name);n?(n.type=i.type||n.type,n.stepMode=i.stepMode||n.stepMode):Nt.warn(`shader layout attribute ${i.name} not present in shader`)}return t}class _ae extends RD{device;handle=null;commands=[];constructor(e){super(e,{}),this.device=e}_executeCommands(e=this.commands){for(const t of e)switch(t.name){case"copy-buffer-to-buffer":bae(this.device,t.options);break;case"copy-buffer-to-texture":xae(this.device,t.options);break;case"copy-texture-to-buffer":wae(this.device,t.options);break;case"copy-texture-to-texture":Sae(this.device,t.options);break;default:throw new Error(t.name)}}}function bae(r,e){const t=e.sourceBuffer,i=e.destinationBuffer;r.gl.bindBuffer(36662,t.handle),r.gl.bindBuffer(36663,i.handle),r.gl.copyBufferSubData(36662,36663,e.sourceOffset??0,e.destinationOffset??0,e.size),r.gl.bindBuffer(36662,null),r.gl.bindBuffer(36663,null)}function xae(r,e){throw new Error("Not implemented")}function wae(r,e){const{sourceTexture:t,mipLevel:i=0,aspect:n="all",width:a=e.sourceTexture.width,height:s=e.sourceTexture.height,depthOrArrayLayers:o=0,origin:l=[0,0],destinationBuffer:c,byteOffset:f=0,bytesPerRow:p,rowsPerImage:y}=e;if(n!=="all")throw new Error("aspect not supported in WebGL");if(i!==0||o!==0||p||y)throw new Error("not implemented");const{framebuffer:b,destroyFramebuffer:S}=fj(t);let C;try{const E=c,P=a||b.width,O=s||b.height,B=uj(b.colorAttachments[0].texture.props.format),F=B.format,W=B.type;r.gl.bindBuffer(35051,E.handle),C=r.gl.bindFramebuffer(36160,b.handle),r.gl.readPixels(l[0],l[1],P,O,F,W,f)}finally{r.gl.bindBuffer(35051,null),C!==void 0&&r.gl.bindFramebuffer(36160,C),S&&b.destroy()}}function Sae(r,e){const{sourceTexture:t,destinationMipLevel:i=0,origin:n=[0,0],destinationOrigin:a=[0,0],destinationTexture:s}=e;let{width:o=e.destinationTexture.width,height:l=e.destinationTexture.height}=e;const{framebuffer:c,destroyFramebuffer:f}=fj(t),[p,y]=n,[b,S,C]=a,E=r.gl.bindFramebuffer(36160,c.handle);let P,O;if(s instanceof k1)P=s,o=Number.isFinite(o)?o:P.width,l=Number.isFinite(l)?l:P.height,P._bind(0),O=P.glTarget;else throw new Error("invalid destination");switch(O){case 3553:case 34067:r.gl.copyTexSubImage2D(O,i,b,S,p,y,o,l);break;case 35866:case 32879:r.gl.copyTexSubImage3D(O,i,b,S,C,p,y,o,l);break}P&&P._unbind(),r.gl.bindFramebuffer(36160,E),f&&c.destroy()}function fj(r){if(r instanceof lo){const{width:e,height:t,id:i}=r;return{framebuffer:r.device.createFramebuffer({id:`framebuffer-for-${i}`,width:e,height:t,colorAttachments:[r]}),destroyFramebuffer:!0}}return{framebuffer:r,destroyFramebuffer:!1}}const Tae=[1,2,4,8];class Aae extends km{device;handle=null;glParameters={};constructor(e,t){super(e,t),this.device=e;let i;if(!t?.parameters?.viewport)if(t?.framebuffer){const{width:a,height:s}=t.framebuffer;i=[0,0,a,s]}else{const[a,s]=e.getDefaultCanvasContext().getDrawingBufferSize();i=[0,0,a,s]}this.device.pushState(),this.setParameters({viewport:i,...this.props.parameters});const n=this.props.framebuffer;if(this.props.framebuffer&&n?.handle){const a=this.props.framebuffer.colorAttachments.map((s,o)=>36064+o);this.device.gl.drawBuffers(a)}else this.device.gl.drawBuffers([1029]);this.clear()}end(){this.device.popState()}pushDebugGroup(e){}popDebugGroup(){}insertDebugMarker(e){}setParameters(e={}){const t={...this.glParameters};t.framebuffer=this.props.framebuffer||null,this.props.depthReadOnly&&(t.depthMask=!this.props.depthReadOnly),t.stencilMask=this.props.stencilReadOnly?0:1,t[35977]=this.props.discard,e.viewport&&(e.viewport.length>=6?(t.viewport=e.viewport.slice(0,4),t.depthRange=[e.viewport[4],e.viewport[5]]):t.viewport=e.viewport),e.scissorRect&&(t.scissorTest=!0,t.scissor=e.scissorRect),e.blendConstant&&(t.blendColor=e.blendConstant),e.stencilReference&&(console.warn("RenderPassParameters.stencilReference not yet implemented in WebGL"),t[2967]=e.stencilReference),"colorMask"in e&&(t.colorMask=Tae.map(i=>!!(i&e.colorMask))),this.glParameters=t,ib(this.device.gl,t)}beginOcclusionQuery(e){this.props.occlusionQuerySet?.beginOcclusionQuery()}endOcclusionQuery(){this.props.occlusionQuerySet?.endOcclusionQuery()}clear(){const e={...this.glParameters};let t=0;this.props.clearColors&&this.props.clearColors.forEach((i,n)=>{i&&this.clearColorBuffer(n,i)}),this.props.clearColor!==!1&&this.props.clearColors===void 0&&(t|=16384,e.clearColor=this.props.clearColor),this.props.clearDepth!==!1&&(t|=256,e.clearDepth=this.props.clearDepth),this.props.clearStencil!==!1&&(t|=1024,e.clearStencil=this.props.clearStencil),t!==0&&rw(this.device.gl,e,()=>{this.device.gl.clear(t)})}clearColorBuffer(e=0,t=[0,0,0,0]){rw(this.device.gl,{framebuffer:this.props.framebuffer},()=>{switch(t.constructor){case Int8Array:case Int16Array:case Int32Array:this.device.gl.clearBufferiv(6144,e,t);break;case Uint8Array:case Uint8ClampedArray:case Uint16Array:case Uint32Array:this.device.gl.clearBufferuiv(6144,e,t);break;case Float32Array:this.device.gl.clearBufferfv(6144,e,t);break;default:throw new Error("clearColorBuffer: color must be typed array")}})}}class NB extends PD{device;handle=null;commandBuffer;constructor(e,t){super(e,t),this.device=e,this.commandBuffer=new _ae(e)}destroy(){}finish(){return this.commandBuffer}beginRenderPass(e){return new Aae(this.device,e)}beginComputePass(e){throw new Error("ComputePass not supported in WebGL")}copyBufferToBuffer(e){this.commandBuffer.commands.push({name:"copy-buffer-to-buffer",options:e})}copyBufferToTexture(e){this.commandBuffer.commands.push({name:"copy-buffer-to-texture",options:e})}copyTextureToBuffer(e){this.commandBuffer.commands.push({name:"copy-texture-to-buffer",options:e})}copyTextureToTexture(e){this.commandBuffer.commands.push({name:"copy-texture-to-texture",options:e})}pushDebugGroup(e){}popDebugGroup(){}insertDebugMarker(e){}resolveQuerySet(e,t,i){}}function Cae(r){const{target:e,source:t,start:i=0,count:n=1}=r,a=t.length,s=n*a;let o=0;for(let l=i;o<a;o++)e[l++]=t[o];for(;o<s;)o<s-o?(e.copyWithin(i+o,i,i+o),o*=2):(e.copyWithin(i+o,i,i+s-o),o=s);return r.target}class ok extends DD{get[Symbol.toStringTag](){return"VertexArray"}device;handle;buffer=null;bufferValue=null;static isConstantAttributeZeroSupported(e){return HZ()==="Chrome"}constructor(e,t){super(e,t),this.device=e,this.handle=this.device.gl.createVertexArray()}destroy(){super.destroy(),this.buffer&&this.buffer?.destroy(),this.handle&&(this.device.gl.deleteVertexArray(this.handle),this.handle=void 0)}setIndexBuffer(e){const t=e;if(t&&t.glTarget!==34963)throw new Error("Use .setBuffer()");this.device.gl.bindVertexArray(this.handle),this.device.gl.bindBuffer(34963,t?t.handle:null),this.indexBuffer=t,this.device.gl.bindVertexArray(null)}setBuffer(e,t){const i=t;if(i.glTarget===34963)throw new Error("Use .setIndexBuffer()");const{size:n,type:a,stride:s,offset:o,normalized:l,integer:c,divisor:f}=this._getAccessor(e);this.device.gl.bindVertexArray(this.handle),this.device.gl.bindBuffer(34962,i.handle),c?this.device.gl.vertexAttribIPointer(e,n,a,s,o):this.device.gl.vertexAttribPointer(e,n,a,l,s,o),this.device.gl.bindBuffer(34962,null),this.device.gl.enableVertexAttribArray(e),this.device.gl.vertexAttribDivisor(e,f||0),this.attributes[e]=i,this.device.gl.bindVertexArray(null)}setConstantWebGL(e,t){this._enable(e,!1),this.attributes[e]=t}bindBeforeRender(){this.device.gl.bindVertexArray(this.handle),this._applyConstantAttributes()}unbindAfterRender(){this.device.gl.bindVertexArray(null)}_applyConstantAttributes(){for(let e=0;e<this.maxVertexAttributes;++e){const t=this.attributes[e];ArrayBuffer.isView(t)&&this.device.setConstantAttributeWebGL(e,t)}}_getAccessor(e){const t=this.attributeInfos[e];if(!t)throw new Error(`Unknown attribute location ${e}`);const i=lj(t.bufferDataType);return{size:t.bufferComponents,type:i,stride:t.byteStride,offset:t.byteOffset,normalized:t.normalized,integer:t.integer,divisor:t.stepMode==="instance"?1:0}}_enable(e,t=!0){const n=ok.isConstantAttributeZeroSupported(this.device)||e!==0;(t||n)&&(e=Number(e),this.device.gl.bindVertexArray(this.handle),t?this.device.gl.enableVertexAttribArray(e):this.device.gl.disableVertexAttribArray(e),this.device.gl.bindVertexArray(null))}getConstantBuffer(e,t){const i=Mae(t),n=i.byteLength*e,a=i.length*e;if(this.buffer&&n!==this.buffer.byteLength)throw new Error(`Buffer size is immutable, byte length ${n} !== ${this.buffer.byteLength}.`);let s=!this.buffer;if(this.buffer=this.buffer||this.device.createBuffer({byteLength:n}),s||=!Eae(i,this.bufferValue),s){const o=LQ(t.constructor,a);Cae({target:o,source:i,start:0,count:a}),this.buffer.write(o),this.bufferValue=t}return this.buffer}}function Mae(r){return Array.isArray(r)?new Float32Array(r):r}function Eae(r,e){if(!r||!e||r.length!==e.length||r.constructor!==e.constructor)return!1;for(let t=0;t<r.length;++t)if(r[t]!==e[t])return!1;return!0}class Iae extends kD{device;gl;handle;layout;buffers={};unusedBuffers={};bindOnUse=!0;_bound=!1;constructor(e,t){super(e,t),this.device=e,this.gl=e.gl,this.handle=this.props.handle||this.gl.createTransformFeedback(),this.layout=this.props.layout,t.buffers&&this.setBuffers(t.buffers),Object.seal(this)}destroy(){this.gl.deleteTransformFeedback(this.handle),super.destroy()}begin(e="point-list"){this.gl.bindTransformFeedback(36386,this.handle),this.bindOnUse&&this._bindBuffers(),this.gl.beginTransformFeedback(vae(e))}end(){this.gl.endTransformFeedback(),this.bindOnUse&&this._unbindBuffers(),this.gl.bindTransformFeedback(36386,null)}setBuffers(e){this.buffers={},this.unusedBuffers={},this.bind(()=>{for(const t in e)this.setBuffer(t,e[t])})}setBuffer(e,t){const i=this._getVaryingIndex(e),{buffer:n,byteLength:a,byteOffset:s}=this._getBufferRange(t);if(i<0){this.unusedBuffers[e]=n,Nt.warn(`${this.id} unusedBuffers varying buffer ${e}`)();return}this.buffers[i]={buffer:n,byteLength:a,byteOffset:s},this.bindOnUse||this._bindBuffer(i,n,s,a)}getBuffer(e){if(BB(e))return this.buffers[e]||null;const t=this._getVaryingIndex(e);return t>=0?this.buffers[t]:null}bind(e=this.handle){if(typeof e!="function")return this.gl.bindTransformFeedback(36386,e),this;let t;return this._bound?t=e():(this.gl.bindTransformFeedback(36386,this.handle),this._bound=!0,t=e(),this._bound=!1,this.gl.bindTransformFeedback(36386,null)),t}unbind(){this.bind(null)}_getBufferRange(e){if(e instanceof D1)return{buffer:e,byteOffset:0,byteLength:e.byteLength};const{buffer:t,byteOffset:i=0,byteLength:n=e.buffer.byteLength}=e;return{buffer:t,byteOffset:i,byteLength:n}}_getVaryingIndex(e){if(BB(e))return Number(e);for(const t of this.layout.varyings||[])if(e===t.name)return t.location;return-1}_bindBuffers(){for(const e in this.buffers){const{buffer:t,byteLength:i,byteOffset:n}=this._getBufferRange(this.buffers[e]);this._bindBuffer(Number(e),t,n,i)}}_unbindBuffers(){for(const e in this.buffers)this.gl.bindBufferBase(35982,Number(e),null)}_bindBuffer(e,t,i=0,n){const a=t&&t.handle;!a||n===void 0?this.gl.bindBufferBase(35982,e,a):this.gl.bindBufferRange(35982,e,a,i,n)}}function BB(r){return typeof r=="number"?Number.isInteger(r):/^\d+$/.test(r)}class Pae extends LD{device;handle;target=null;_queryPending=!1;_pollingPromise=null;get[Symbol.toStringTag](){return"Query"}constructor(e,t){if(super(e,t),this.device=e,t.count>1)throw new Error("WebGL QuerySet can only have one value");const i=this.device.gl.createQuery();if(!i)throw new Error("WebGL query not supported");this.handle=i,Object.seal(this)}destroy(){this.device.gl.deleteQuery(this.handle)}beginTimestampQuery(){return this._begin(35007)}endTimestampQuery(){this._end()}beginOcclusionQuery(e){return this._begin(e?.conservative?36202:35887)}endOcclusionQuery(){this._end()}beginTransformFeedbackQuery(){return this._begin(35976)}endTransformFeedbackQuery(){this._end()}async resolveQuery(){return[await this.pollQuery()]}_begin(e){this._queryPending||(this.target=e,this.device.gl.beginQuery(this.target,this.handle))}_end(){this._queryPending||this.target&&(this.device.gl.endQuery(this.target),this.target=null,this._queryPending=!0)}isResultAvailable(){if(!this._queryPending)return!1;const e=this.device.gl.getQueryParameter(this.handle,34919);return e&&(this._queryPending=!1),e}isTimerDisjoint(){return this.device.gl.getParameter(36795)}getResult(){return this.device.gl.getQueryParameter(this.handle,34918)}getTimerMilliseconds(){return this.getResult()/1e6}pollQuery(e=Number.POSITIVE_INFINITY){if(this._pollingPromise)return this._pollingPromise;let t=0;return this._pollingPromise=new Promise((i,n)=>{const a=()=>{this.isResultAvailable()?(i(this.getResult()),this._pollingPromise=null):t++>e?(n("Timed out"),this._pollingPromise=null):requestAnimationFrame(a)};requestAnimationFrame(a)}),this._pollingPromise}}function dj(r){switch(r){case 6406:case 33326:case 6403:case 36244:return 1;case 33339:case 33340:case 33328:case 33320:case 33319:return 2;case 6407:case 36248:case 34837:return 3;case 6408:case 36249:case 34836:return 4;default:return 0}}function Rae(r){switch(r){case 5121:return 1;case 33635:case 32819:case 32820:return 2;case 5126:return 4;default:return 0}}function Dae(r){return kae[r]}const kae={5124:"sint32",5125:"uint32",5122:"sint16",5123:"uint16",5120:"sint8",5121:"uint8",5126:"float32",5131:"float16",33635:"uint16",32819:"uint16",32820:"uint16",33640:"uint32",35899:"uint32",35902:"uint32",34042:"uint32",36269:"uint32"};function Lae(r,e){const{sourceX:t=0,sourceY:i=0,sourceAttachment:n=0}=e||{};let{target:a=null,sourceWidth:s,sourceHeight:o,sourceDepth:l,sourceFormat:c,sourceType:f}=e||{};const{framebuffer:p,deleteFramebuffer:y}=pj(r),{gl:b,handle:S}=p;s||=p.width,o||=p.height;const C=p.colorAttachments[n]?.texture;if(!C)throw new Error(`Invalid framebuffer attachment ${n}`);l=C?.depth||1,c||=C?.glFormat||6408,f||=C?.glType||5121,a=Bae(a,f,c,s,o);const E=CD(a);f=f||iae(E);const P=b.bindFramebuffer(36160,S);return b.readBuffer(36064+n),b.readPixels(t,i,s,o,c,f,a),b.readBuffer(36064),b.bindFramebuffer(36160,P||null),y&&p.destroy(),a}function Oae(r,e){const{target:t,sourceX:i=0,sourceY:n=0,sourceFormat:a=6408,targetByteOffset:s=0}=e||{};let{sourceWidth:o,sourceHeight:l,sourceType:c}=e||{};const{framebuffer:f,deleteFramebuffer:p}=pj(r);o=o||f.width,l=l||f.height;const y=f;c=c||5121;let b=t;if(!b){const C=dj(a),E=Rae(c),P=s+o*l*C*E;b=y.device.createBuffer({byteLength:P})}const S=r.device.createCommandEncoder();return S.copyTextureToBuffer({sourceTexture:r,width:o,height:l,origin:[i,n],destinationBuffer:b,byteOffset:s}),S.destroy(),p&&f.destroy(),b}function pj(r){return r instanceof mC?{framebuffer:r,deleteFramebuffer:!1}:{framebuffer:Nae(r),deleteFramebuffer:!0}}function Nae(r,e){const{device:t,width:i,height:n,id:a}=r;return t.createFramebuffer({...e,id:`framebuffer-for-${a}`,width:i,height:n,colorAttachments:[r]})}function Bae(r,e,t,i,n,a){if(r)return r;e||=5121;const s=Dae(e),o=MD(s),l=dj(t);return new o(i*n*l)}class _R extends ly{type="webgl";handle;features;limits;info;canvasContext;preferredColorFormat="rgba8unorm";preferredDepthFormat="depth24plus";commandEncoder;lost;_resolveContextLost;gl;_constants;_extensions={};_polyfilled=!1;spectorJS;get[Symbol.toStringTag](){return"WebGLDevice"}toString(){return`${this[Symbol.toStringTag]}(${this.id})`}isVertexFormatSupported(e){switch(e){case"unorm8x4-bgra":return!1;default:return!0}}constructor(e){super({...e,id:e.id||jne("webgl-device")});const t=ly._getCanvasContextProps(e);if(!t)throw new Error("WebGLDevice requires props.createCanvasContext to be set");let i=t.canvas?.gl?.device;if(i)throw new Error(`WebGL context already attached to device ${i.id}`);this.canvasContext=new Hne(this,t),this.lost=new Promise(f=>{this._resolveContextLost=f});const n={...e.webgl};t.alphaMode==="premultiplied"&&(n.premultipliedAlpha=!0),e.powerPreference!==void 0&&(n.powerPreference=e.powerPreference);const s=this.props._handle||wne(this.canvasContext.canvas,{onContextLost:f=>this._resolveContextLost?.({reason:"destroyed",message:"Entered sleep mode, or too many apps or browser tabs are using the GPU."}),onContextRestored:f=>console.log("WebGL context restored")},n);if(!s)throw new Error("WebGL context creation failed");if(i=s.device,i){if(e._reuseDevices)return Nt.log(1,`Not creating a new Device, instead returning a reference to Device ${i.id} already attached to WebGL context`,i)(),i._reused=!0,i;throw new Error(`WebGL context already attached to device ${i.id}`)}this.handle=s,this.gl=s,this.spectorJS=nne({...this.props,gl:this.handle}),this.gl.device=this,this.gl._version=2,this.info=Sne(this.gl,this._extensions),this.limits=new Fne(this.gl),this.features=new zne(this.gl,this._extensions,this.props._disabledFeatures),this.props._initializeFeatures&&this.features.initializeFeatures(),new Jm(this.gl,{log:(...f)=>Nt.log(1,...f)()}).trackState(this.gl,{copyState:!1});const l=e.debugWebGL||e.debug,c=e.debugWebGL;l&&(this.gl=sne(this.gl,{debugWebGL:l,traceWebGL:c}),Nt.warn("WebGL debug mode activated. Performance reduced.")(),e.debugWebGL&&(Nt.level=Math.max(Nt.level,1))),this.commandEncoder=new NB(this,{id:`${this}-command-encoder`})}destroy(){!this.props._reuseDevices&&!this._reused&&delete this.gl.device}get isLost(){return this.gl.isContextLost()}getTextureByteAlignment(){return 4}createCanvasContext(e){throw new Error("WebGL only supports a single canvas")}createBuffer(e){const t=this._normalizeBufferProps(e);return new D1(this,t)}createTexture(e){return new k1(this,e)}createExternalTexture(e){throw new Error("createExternalTexture() not implemented")}createSampler(e){return new eae(this,e)}createShader(e){return new Xne(this,e)}createFramebuffer(e){return new R1(this,e)}createVertexArray(e){return new ok(this,e)}createTransformFeedback(e){return new Iae(this,e)}createQuerySet(e){return new Pae(this,e)}createRenderPipeline(e){return new mae(this,e)}createComputePipeline(e){throw new Error("ComputePipeline not supported in WebGL")}createCommandEncoder(e={}){return new NB(this,e)}submit(e){e||(e=this.commandEncoder.finish(),this.commandEncoder.destroy(),this.commandEncoder=this.createCommandEncoder({id:`${this.id}-default-encoder`})),e._executeCommands()}readPixelsToArrayWebGL(e,t){return Lae(e,t)}readPixelsToBufferWebGL(e,t){return Oae(e,t)}setParametersWebGL(e){ib(this.gl,e)}getParametersWebGL(e){return oj(this.gl,e)}withParametersWebGL(e,t){return rw(this.gl,e,t)}resetWebGL(){Nt.warn("WebGLDevice.resetWebGL is deprecated, use only for debugging")(),mne(this.gl)}_getDeviceSpecificTextureFormatCapabilities(e){return Lne(this.gl,e,this._extensions)}loseDevice(){let e=!1;const i=this.getExtension("WEBGL_lose_context").WEBGL_lose_context;return i&&(e=!0,i.loseContext()),this._resolveContextLost?.({reason:"destroyed",message:"Application triggered context loss"}),e}pushState(){Jm.get(this.gl).push()}popState(){Jm.get(this.gl).pop()}getGLKey(e,t){const i=Number(e);for(const n in this.gl)if(this.gl[n]===i)return`GL.${n}`;return t?.emptyIfUnknown?"":String(e)}getGLKeys(e){const t={emptyIfUnknown:!0};return Object.entries(e).reduce((i,[n,a])=>(i[`${n}:${this.getGLKey(n,t)}`]=`${a}:${this.getGLKey(a,t)}`,i),{})}setConstantAttributeWebGL(e,t){const i=this.limits.maxVertexAttributes;this._constants=this._constants||new Array(i).fill(null);const n=this._constants[e];switch(n&&Uae(n,t)&&Nt.info(1,`setConstantAttributeWebGL(${e}) could have been skipped, value unchanged`)(),this._constants[e]=t,t.constructor){case Float32Array:zae(this,e,t);break;case Int32Array:Fae(this,e,t);break;case Uint32Array:Vae(this,e,t);break;default:throw new Error("constant")}}getExtension(e){return H0(this.gl,e,this._extensions),this._extensions}_setWebGLDebugMetadata(e,t,i){e.luma=t;const n={props:i.spector,id:i.spector.id};e.__SPECTOR_Metadata=n}}function zae(r,e,t){switch(t.length){case 1:r.gl.vertexAttrib1fv(e,t);break;case 2:r.gl.vertexAttrib2fv(e,t);break;case 3:r.gl.vertexAttrib3fv(e,t);break;case 4:r.gl.vertexAttrib4fv(e,t);break}}function Fae(r,e,t){r.gl.vertexAttribI4iv(e,t)}function Vae(r,e,t){r.gl.vertexAttribI4uiv(e,t)}function Uae(r,e){if(!r||!e||r.length!==e.length||r.constructor!==e.constructor)return!1;for(let t=0;t<r.length;++t)if(r[t]!==e[t])return!1;return!0}const zB=Object.freeze(Object.defineProperty({__proto__:null,WebGLDevice:_R},Symbol.toStringTag,{value:"Module"}));function sg(){}const Hae=({isDragging:r})=>r?"grabbing":"grab",gj={id:"",width:"100%",height:"100%",style:null,viewState:null,initialViewState:null,pickingRadius:0,layerFilter:null,parameters:{},parent:null,device:null,deviceProps:{},gl:null,canvas:null,layers:[],effects:[],views:null,controller:null,useDevicePixels:!0,touchAction:"none",eventRecognizerOptions:{},_framebuffer:null,_animate:!1,_pickable:!0,_typedArrayManagerProps:{},_customRender:null,widgets:[],onDeviceInitialized:sg,onWebGLInitialized:sg,onResize:sg,onViewStateChange:sg,onInteractionStateChange:sg,onBeforeRender:sg,onAfterRender:sg,onLoad:sg,onError:r=>Tn.error(r.message,r.cause)(),onHover:null,onClick:null,onDragStart:null,onDrag:null,onDragEnd:null,_onMetrics:null,getCursor:Hae,getTooltip:null,debug:!1,drawPickingColors:!1};class iw{constructor(e){this.width=0,this.height=0,this.userData={},this.device=null,this.canvas=null,this.viewManager=null,this.layerManager=null,this.effectManager=null,this.deckRenderer=null,this.deckPicker=null,this.eventManager=null,this.widgetManager=null,this.tooltip=null,this.animationLoop=null,this.cursorState={isHovering:!1,isDragging:!1},this.stats=new fC({id:"deck.gl"}),this.metrics={fps:0,setPropsTime:0,updateAttributesTime:0,framesRedrawn:0,pickTime:0,pickCount:0,gpuTime:0,gpuTimePerFrame:0,cpuTime:0,cpuTimePerFrame:0,bufferMemory:0,textureMemory:0,renderbufferMemory:0,gpuMemory:0},this._metricsCounter=0,this._needsRedraw="Initial render",this._pickRequest={mode:"hover",x:-1,y:-1,radius:0,event:null},this._lastPointerDownInfo=null,this._onPointerMove=i=>{const{_pickRequest:n}=this;if(i.type==="pointerleave")n.x=-1,n.y=-1,n.radius=0;else{if(i.leftButton||i.rightButton)return;{const a=i.offsetCenter;if(!a)return;n.x=a.x,n.y=a.y,n.radius=this.props.pickingRadius}}this.layerManager&&(this.layerManager.context.mousePosition={x:n.x,y:n.y}),n.event=i},this._onEvent=i=>{const n=uR[i.type],a=i.offsetCenter;if(!n||!a||!this.layerManager)return;const s=this.layerManager.getLayers(),o=this.deckPicker.getLastPickedObject({x:a.x,y:a.y,layers:s,viewports:this.getViewports(a)},this._lastPointerDownInfo),{layer:l}=o,c=l&&(l[n]||l.props[n]),f=this.props[n];let p=!1;c&&(p=c.call(l,o,i)),p||(f?.(o,i),this.widgetManager.onEvent(o,i))},this._onPointerDown=i=>{if(this.device?.type==="webgpu")return;const n=i.offsetCenter,a=this._pick("pickObject","pickObject Time",{x:n.x,y:n.y,radius:this.props.pickingRadius});this._lastPointerDownInfo=a.result[0]||a.emptyInfo},this.props={...gj,...e},e=this.props,e.viewState&&e.initialViewState&&Tn.warn("View state tracking is disabled. Use either `initialViewState` for auto update or `viewState` for manual update.")(),this.viewState=this.props.initialViewState,e.device&&(this.device=e.device);let t=this.device;!t&&e.gl&&(e.gl instanceof WebGLRenderingContext&&Tn.error("WebGL1 context not supported.")(),t=lE.attach(e.gl,this.props.deviceProps)),t||(t=this._createDevice(e)),this.animationLoop=this._createAnimationLoop(t,e),this.setProps(e),e._typedArrayManagerProps&&F0.setOptions(e._typedArrayManagerProps),this.animationLoop.start()}finalize(){this.animationLoop?.stop(),this.animationLoop?.destroy(),this.animationLoop=null,this._lastPointerDownInfo=null,this.layerManager?.finalize(),this.layerManager=null,this.viewManager?.finalize(),this.viewManager=null,this.effectManager?.finalize(),this.effectManager=null,this.deckRenderer?.finalize(),this.deckRenderer=null,this.deckPicker?.finalize(),this.deckPicker=null,this.eventManager?.destroy(),this.eventManager=null,this.widgetManager?.finalize(),this.widgetManager=null,!this.props.canvas&&!this.props.device&&!this.props.gl&&this.canvas&&(this.canvas.parentElement?.removeChild(this.canvas),this.canvas=null)}setProps(e){this.stats.get("setProps Time").timeStart(),"onLayerHover"in e&&Tn.removed("onLayerHover","onHover")(),"onLayerClick"in e&&Tn.removed("onLayerClick","onClick")(),e.initialViewState&&!vc(this.props.initialViewState,e.initialViewState,3)&&(this.viewState=e.initialViewState),Object.assign(this.props,e),this._setCanvasSize(this.props);const t=Object.create(this.props);if(Object.assign(t,{views:this._getViews(),width:this.width,height:this.height,viewState:this._getViewState()}),e.device&&e.device.id!==this.device?.id&&(this.animationLoop?.stop(),this.canvas!==e.device.canvasContext?.canvas&&(this.canvas?.remove(),this.eventManager?.destroy(),this.canvas=null),Tn.log(`recreating animation loop for new device! id=${e.device.id}`)(),this.animationLoop=this._createAnimationLoop(e.device,e),this.animationLoop.start()),this.animationLoop?.setProps(t),e.useDevicePixels!==void 0&&this.device?.canvasContext?.canvas instanceof HTMLCanvasElement){this.device.canvasContext.props.useDevicePixels=e.useDevicePixels;const i=this.device.canvasContext.canvas,n={target:i,contentBoxSize:[{inlineSize:i.clientWidth,blockSize:i.clientHeight}],devicePixelContentBoxSize:[{inlineSize:i.clientWidth,blockSize:i.clientHeight}],borderBoxSize:[{inlineSize:i.clientWidth,blockSize:i.clientHeight}]};this.device.canvasContext._handleResize([n])}this.layerManager&&(this.viewManager.setProps(t),this.layerManager.activateViewport(this.getViewports()[0]),this.layerManager.setProps(t),this.effectManager.setProps(t),this.deckRenderer.setProps(t),this.deckPicker.setProps(t),this.widgetManager.setProps(t)),this.stats.get("setProps Time").timeEnd()}needsRedraw(e={clearRedrawFlags:!1}){if(!this.layerManager)return!1;if(this.props._animate)return"Deck._animate";let t=this._needsRedraw;e.clearRedrawFlags&&(this._needsRedraw=!1);const i=this.viewManager.needsRedraw(e),n=this.layerManager.needsRedraw(e),a=this.effectManager.needsRedraw(e),s=this.deckRenderer.needsRedraw(e);return t=t||i||n||a||s,t}redraw(e){if(!this.layerManager)return;let t=this.needsRedraw({clearRedrawFlags:!0});t=e||t,t&&(this.stats.get("Redraw Count").incrementCount(),this.props._customRender?this.props._customRender(t):this._drawLayers(t))}get isInitialized(){return this.viewManager!==null}getViews(){return Ga(this.viewManager),this.viewManager.views}getViewports(e){return Ga(this.viewManager),this.viewManager.getViewports(e)}getCanvas(){return this.canvas}pickObject(e){const t=this._pick("pickObject","pickObject Time",e).result;return t.length?t[0]:null}pickMultipleObjects(e){return e.depth=e.depth||10,this._pick("pickObject","pickMultipleObjects Time",e).result}pickObjects(e){return this._pick("pickObjects","pickObjects Time",e)}_addResources(e,t=!1){for(const i in e)this.layerManager.resourceManager.add({resourceId:i,data:e[i],forceUpdate:t})}_removeResources(e){for(const t of e)this.layerManager.resourceManager.remove(t)}_addDefaultEffect(e){this.effectManager.addDefaultEffect(e)}_addDefaultShaderModule(e){this.layerManager.addDefaultShaderModule(e)}_removeDefaultShaderModule(e){this.layerManager?.removeDefaultShaderModule(e)}_pick(e,t,i){Ga(this.deckPicker);const{stats:n}=this;n.get("Pick Count").incrementCount(),n.get(t).timeStart();const a=this.deckPicker[e]({layers:this.layerManager.getLayers(i),views:this.viewManager.getViews(),viewports:this.getViewports(i),onViewportActive:this.layerManager.activateViewport,effects:this.effectManager.getEffects(),...i});return n.get(t).timeEnd(),a}_createCanvas(e){let t=e.canvas;return typeof t=="string"&&(t=document.getElementById(t),Ga(t)),t||(t=document.createElement("canvas"),t.id=e.id||"deckgl-overlay",e.width&&typeof e.width=="number"&&(t.width=e.width),e.height&&typeof e.height=="number"&&(t.height=e.height),(e.parent||document.body).appendChild(t)),Object.assign(t.style,e.style),t}_setCanvasSize(e){if(!this.canvas)return;const{width:t,height:i}=e;if(t||t===0){const n=Number.isFinite(t)?`${t}px`:t;this.canvas.style.width=n}if(i||i===0){const n=Number.isFinite(i)?`${i}px`:i;this.canvas.style.position=e.style?.position||"absolute",this.canvas.style.height=n}}_updateCanvasSize(){const{canvas:e}=this;if(!e)return;const t=e.clientWidth??e.width,i=e.clientHeight??e.height;(t!==this.width||i!==this.height)&&(this.width=t,this.height=i,this.viewManager?.setProps({width:t,height:i}),this.layerManager?.activateViewport(this.getViewports()[0]),this.props.onResize({width:t,height:i}))}_createAnimationLoop(e,t){const{gl:i,onError:n}=t;return new qD({device:e,autoResizeDrawingBuffer:!i,autoResizeViewport:!1,onInitialize:a=>this._setDevice(a.device),onRender:this._onRenderFrame.bind(this),onError:n})}_createDevice(e){const t=this.props.deviceProps?.createCanvasContext,i=typeof t=="object"?t:void 0,n={adapters:[],...e.deviceProps};n.adapters.includes(lE)||n.adapters.push(lE);const a={alphaMode:this.props.deviceProps?.type==="webgpu"?"premultiplied":void 0};return JP.createDevice({_reuseDevices:!0,type:"webgl",...n,createCanvasContext:{...a,...i,canvas:this._createCanvas(e),useDevicePixels:this.props.useDevicePixels,autoResize:!0}})}_getViewState(){return this.props.viewState||this.viewState}_getViews(){const{views:e}=this.props,t=Array.isArray(e)?e:e?[e]:[new JD({id:"default-view"})];return t.length&&this.props.controller&&(t[0].props.controller=this.props.controller),t}_onContextLost(){const{onError:e}=this.props;this.animationLoop&&e&&e(new Error("WebGL context is lost"))}_pickAndCallback(){if(this.device?.type==="webgpu")return;const{_pickRequest:e}=this;if(e.event){const{result:t,emptyInfo:i}=this._pick("pickObject","pickObject Time",e);this.cursorState.isHovering=t.length>0;let n=i,a=!1;for(const s of t)n=s,a=s.layer?.onHover(s,e.event)||a;a||(this.props.onHover?.(n,e.event),this.widgetManager.onHover(n,e.event)),e.event=null}}_updateCursor(){const e=this.props.parent||this.canvas;e&&(e.style.cursor=this.props.getCursor(this.cursorState))}_setDevice(e){if(this.device=e,!this.animationLoop)return;this.canvas||(this.canvas=this.device.canvasContext?.canvas,!this.canvas.isConnected&&this.props.parent&&this.props.parent.insertBefore(this.canvas,this.props.parent.firstChild)),this.device.type==="webgl"&&this.device.setParametersWebGL({blend:!0,blendFunc:[770,771,1,771],polygonOffsetFill:!0,depthTest:!0,depthFunc:515}),this.props.onDeviceInitialized(this.device),this.device.type==="webgl"&&this.props.onWebGLInitialized(this.device.gl);const t=new ZH;t.play(),this.animationLoop.attachTimeline(t),this.eventManager=new Ste(this.props.parent||this.canvas,{touchAction:this.props.touchAction,recognizers:Object.keys(QN).map(n=>{const[a,s,o,l]=QN[n],c=this.props.eventRecognizerOptions?.[n],f={...s,...c,event:n};return{recognizer:new a(f),recognizeWith:o,requestFailure:l}}),events:{pointerdown:this._onPointerDown,pointermove:this._onPointerMove,pointerleave:this._onPointerMove}});for(const n in uR)this.eventManager.on(n,this._onEvent);this.viewManager=new wie({timeline:t,eventManager:this.eventManager,onViewStateChange:this._onViewStateChange.bind(this),onInteractionStateChange:this._onInteractionStateChange.bind(this),views:this._getViews(),viewState:this._getViewState(),width:this.width,height:this.height});const i=this.viewManager.getViewports()[0];this.layerManager=new xie(this.device,{deck:this,stats:this.stats,viewport:i,timeline:t}),this.effectManager=new Nie({deck:this,device:this.device}),this.deckRenderer=new Fie(this.device),this.deckPicker=new Hie(this.device),this.widgetManager=new Wie({deck:this,parentElement:this.canvas?.parentElement}),this.widgetManager.addDefault(new ij),this.setProps(this.props),this._updateCanvasSize(),this.props.onLoad()}_drawLayers(e,t){const{device:i,gl:n}=this.layerManager.context;this.props.onBeforeRender({device:i,gl:n});const a={target:this.props._framebuffer,layers:this.layerManager.getLayers(),viewports:this.viewManager.getViewports(),onViewportActive:this.layerManager.activateViewport,views:this.viewManager.getViews(),pass:"screen",effects:this.effectManager.getEffects(),...t};this.deckRenderer?.renderLayers(a),a.pass==="screen"&&this.widgetManager.onRedraw({viewports:a.viewports,layers:a.layers}),this.props.onAfterRender({device:i,gl:n})}_onRenderFrame(){this._getFrameStats(),this._metricsCounter++%60===0&&(this._getMetrics(),this.stats.reset(),Tn.table(4,this.metrics)(),this.props._onMetrics&&this.props._onMetrics(this.metrics)),this._updateCanvasSize(),this._updateCursor(),this.layerManager.updateLayers(),this.device?.type!=="webgpu"&&this._pickAndCallback(),this.redraw(),this.viewManager&&this.viewManager.updateViewStates()}_onViewStateChange(e){const t=this.props.onViewStateChange(e)||e.viewState;this.viewState&&(this.viewState={...this.viewState,[e.viewId]:t},this.props.viewState||this.viewManager&&this.viewManager.setProps({viewState:this.viewState}))}_onInteractionStateChange(e){this.cursorState.isDragging=e.isDragging||!1,this.props.onInteractionStateChange(e)}_getFrameStats(){const{stats:e}=this;e.get("frameRate").timeEnd(),e.get("frameRate").timeStart();const t=this.animationLoop.stats;e.get("GPU Time").addTime(t.get("GPU Time").lastTiming),e.get("CPU Time").addTime(t.get("CPU Time").lastTiming)}_getMetrics(){const{metrics:e,stats:t}=this;e.fps=t.get("frameRate").getHz(),e.setPropsTime=t.get("setProps Time").time,e.updateAttributesTime=t.get("Update Attributes").time,e.framesRedrawn=t.get("Redraw Count").count,e.pickTime=t.get("pickObject Time").time+t.get("pickMultipleObjects Time").time+t.get("pickObjects Time").time,e.pickCount=t.get("Pick Count").count,e.gpuTime=t.get("GPU Time").time,e.cpuTime=t.get("CPU Time").time,e.gpuTimePerFrame=t.get("GPU Time").getAverageTime(),e.cpuTimePerFrame=t.get("CPU Time").getAverageTime();const i=JP.stats.get("Memory Usage");e.bufferMemory=i.get("Buffer Memory").count,e.textureMemory=i.get("Texture Memory").count,e.renderbufferMemory=i.get("Renderbuffer Memory").count,e.gpuMemory=i.get("GPU Memory").count}}iw.defaultProps=gj;iw.VERSION=uK;function jae(r){switch(r){case"float64":return Float64Array;case"uint8":case"unorm8":return Uint8ClampedArray;default:return MD(r)}}const $ae=CD;function hT(r,e,t){const i=t==="webgpu"&&e.type==="uint8"?"unorm8":e.type;return{attribute:r,format:e.size>1?`${i}x${e.size}`:e.type,byteOffset:e.offset||0}}function Vm(r){return r.stride||r.size*r.bytesPerElement}function Wae(r,e){return r.type===e.type&&r.size===e.size&&Vm(r)===Vm(e)&&(r.offset||0)===(e.offset||0)}function bR(r,e){e.offset&&Tn.removed("shaderAttribute.offset","vertexOffset, elementOffset")();const t=Vm(r),i=e.vertexOffset!==void 0?e.vertexOffset:r.vertexOffset||0,n=e.elementOffset||0,a=i*t+n*r.bytesPerElement+(r.offset||0);return{...e,offset:a,stride:t}}function Gae(r,e){const t=bR(r,e);return{high:t,low:{...t,offset:t.offset+r.size*4}}}class Xae{constructor(e,t,i){this._buffer=null,this.device=e,this.id=t.id||"",this.size=t.size||1;const n=t.logicalType||t.type,a=n==="float64";let{defaultValue:s}=t;s=Number.isFinite(s)?[s]:s||new Array(this.size).fill(0);let o;a?o="float32":!n&&t.isIndexed?o="uint32":o=n||"float32";let l=jae(n||o);this.doublePrecision=a,a&&t.fp64===!1&&(l=Float32Array),this.value=null,this.settings={...t,defaultType:l,defaultValue:s,logicalType:n,type:o,normalized:o.includes("norm"),size:this.size,bytesPerElement:l.BYTES_PER_ELEMENT},this.state={...i,externalBuffer:null,bufferAccessor:this.settings,allocatedValue:null,numInstances:0,bounds:null,constant:!1}}get isConstant(){return this.state.constant}get buffer(){return this._buffer}get byteOffset(){const e=this.getAccessor();return e.vertexOffset?e.vertexOffset*Vm(e):0}get numInstances(){return this.state.numInstances}set numInstances(e){this.state.numInstances=e}delete(){this._buffer&&(this._buffer.delete(),this._buffer=null),F0.release(this.state.allocatedValue)}getBuffer(){return this.state.constant?null:this.state.externalBuffer||this._buffer}getValue(e=this.id,t=null){const i={};if(this.state.constant){const n=this.value;if(t){const a=bR(this.getAccessor(),t),s=a.offset/n.BYTES_PER_ELEMENT,o=a.size||this.size;i[e]=n.subarray(s,s+o)}else i[e]=n}else i[e]=this.getBuffer();return this.doublePrecision&&(this.value instanceof Float64Array?i[`${e}64Low`]=i[e]:i[`${e}64Low`]=new Float32Array(this.size)),i}_getBufferLayout(e=this.id,t=null){const i=this.getAccessor(),n=[],a={name:this.id,byteStride:Vm(i),attributes:n};if(this.doublePrecision){const s=Gae(i,t||{});n.push(hT(e,{...i,...s.high},this.device.type),hT(`${e}64Low`,{...i,...s.low},this.device.type))}else if(t){const s=bR(i,t);n.push(hT(e,{...i,...s},this.device.type))}else n.push(hT(e,i,this.device.type));return a}setAccessor(e){this.state.bufferAccessor=e}getAccessor(){return this.state.bufferAccessor}getBounds(){if(this.state.bounds)return this.state.bounds;let e=null;if(this.state.constant&&this.value){const t=Array.from(this.value);e=[t,t]}else{const{value:t,numInstances:i,size:n}=this,a=i*n;if(t&&a&&t.length>=a){const s=new Array(n).fill(1/0),o=new Array(n).fill(-1/0);for(let l=0;l<a;)for(let c=0;c<n;c++){const f=t[l++];f<s[c]&&(s[c]=f),f>o[c]&&(o[c]=f)}e=[s,o]}}return this.state.bounds=e,e}setData(e){const{state:t}=this;let i;ArrayBuffer.isView(e)?i={value:e}:e instanceof ua?i={buffer:e}:i=e;const n={...this.settings,...i};if(ArrayBuffer.isView(i.value)){if(!i.type)if(this.doublePrecision&&i.value instanceof Float64Array)n.type="float32";else{const s=$ae(i.value);n.type=n.normalized?s.replace("int","norm"):s}n.bytesPerElement=i.value.BYTES_PER_ELEMENT,n.stride=Vm(n)}if(t.bounds=null,i.constant){let a=i.value;if(a=this._normalizeValue(a,[],0),this.settings.normalized&&(a=this.normalizeConstant(a)),!(!t.constant||!this._areValuesEqual(a,this.value)))return!1;t.externalBuffer=null,t.constant=!0,this.value=ArrayBuffer.isView(a)?a:new Float32Array(a)}else if(i.buffer){const a=i.buffer;t.externalBuffer=a,t.constant=!1,this.value=i.value||null}else if(i.value){this._checkExternalBuffer(i);let a=i.value;t.externalBuffer=null,t.constant=!1,this.value=a;let{buffer:s}=this;const o=Vm(n),l=(n.vertexOffset||0)*o;if(this.doublePrecision&&a instanceof Float64Array&&(a=rE(a,n)),this.settings.isIndexed){const f=this.settings.defaultType;a.constructor!==f&&(a=new f(a))}const c=a.byteLength+l+o*2;(!s||s.byteLength<c)&&(s=this._createBuffer(c)),s.write(a,l)}return this.setAccessor(n),!0}updateSubBuffer(e={}){this.state.bounds=null;const t=this.value,{startOffset:i=0,endOffset:n}=e;this.buffer.write(this.doublePrecision&&t instanceof Float64Array?rE(t,{size:this.size,startIndex:i,endIndex:n}):t.subarray(i,n),i*t.BYTES_PER_ELEMENT+this.byteOffset)}allocate(e,t=!1){const{state:i}=this,n=i.allocatedValue,a=F0.allocate(n,e+1,{size:this.size,type:this.settings.defaultType,copy:t});this.value=a;const{byteOffset:s}=this;let{buffer:o}=this;return(!o||o.byteLength<a.byteLength+s)&&(o=this._createBuffer(a.byteLength+s),t&&n&&o.write(n instanceof Float64Array?rE(n,this):n,s)),i.allocatedValue=a,i.constant=!1,i.externalBuffer=null,this.setAccessor(this.settings),!0}_checkExternalBuffer(e){const{value:t}=e;if(!ArrayBuffer.isView(t))throw new Error(`Attribute ${this.id} value is not TypedArray`);const i=this.settings.defaultType;let n=!1;if(this.doublePrecision&&(n=t.BYTES_PER_ELEMENT<4),n)throw new Error(`Attribute ${this.id} does not support ${t.constructor.name}`);!(t instanceof i)&&this.settings.normalized&&!("normalized"in e)&&Tn.warn(`Attribute ${this.id} is normalized`)()}normalizeConstant(e){switch(this.settings.type){case"snorm8":return new Float32Array(e).map(t=>(t+128)/255*2-1);case"snorm16":return new Float32Array(e).map(t=>(t+32768)/65535*2-1);case"unorm8":return new Float32Array(e).map(t=>t/255);case"unorm16":return new Float32Array(e).map(t=>t/65535);default:return e}}_normalizeValue(e,t,i){const{defaultValue:n,size:a}=this.settings;if(Number.isFinite(e))return t[i]=e,t;if(!e){let s=a;for(;--s>=0;)t[i+s]=n[s];return t}switch(a){case 4:t[i+3]=Number.isFinite(e[3])?e[3]:n[3];case 3:t[i+2]=Number.isFinite(e[2])?e[2]:n[2];case 2:t[i+1]=Number.isFinite(e[1])?e[1]:n[1];case 1:t[i+0]=Number.isFinite(e[0])?e[0]:n[0];break;default:let s=a;for(;--s>=0;)t[i+s]=Number.isFinite(e[s])?e[s]:n[s]}return t}_areValuesEqual(e,t){if(!e||!t)return!1;const{size:i}=this;for(let n=0;n<i;n++)if(e[n]!==t[n])return!1;return!0}_createBuffer(e){this._buffer&&this._buffer.destroy();const{isIndexed:t,type:i}=this.settings;return this._buffer=this.device.createBuffer({...this._buffer?.props,id:this.id,usage:(t?ua.INDEX:ua.VERTEX)|ua.COPY_DST,indexType:t?i:void 0,byteLength:e}),this._buffer}}const FB=[],VB=[];function vj(r,e=0,t=1/0){let i=FB;const n={index:-1,data:r,target:[]};return r?typeof r[Symbol.iterator]=="function"?i=r:r.length>0&&(VB.length=r.length,i=VB):i=FB,(e>0||Number.isFinite(t))&&(i=(Array.isArray(i)?i:Array.from(i)).slice(e,t),n.index=e-1),{iterable:i,objectInfo:n}}function mj(r){return r&&r[Symbol.asyncIterator]}function yj(r,e){const{size:t,stride:i,offset:n,startIndices:a,nested:s}=e,o=r.BYTES_PER_ELEMENT,l=i?i/o:t,c=n?n/o:0,f=Math.floor((r.length-c)/l);return(p,{index:y,target:b})=>{if(!a){const P=y*l+c;for(let O=0;O<t;O++)b[O]=r[P+O];return b}const S=a[y],C=a[y+1]||f;let E;if(s){E=new Array(C-S);for(let P=S;P<C;P++){const O=P*l+c;b=new Array(t);for(let B=0;B<t;B++)b[B]=r[O+B];E[P-S]=b}}else if(l===t)E=r.subarray(S*t+c,C*t+c);else{E=new r.constructor((C-S)*t);let P=0;for(let O=S;O<C;O++){const B=O*l+c;for(let F=0;F<t;F++)E[P++]=r[B+F]}}return E}}const Zae=[],C2=[[0,1/0]];function qae(r,e){if(r===C2||(e[0]<0&&(e[0]=0),e[0]>=e[1]))return r;const t=[],i=r.length;let n=0;for(let a=0;a<i;a++){const s=r[a];s[1]<e[0]?(t.push(s),n=a+1):s[0]>e[1]?t.push(s):e=[Math.min(s[0],e[0]),Math.max(s[1],e[1])]}return t.splice(n,0,e),t}const Yae={interpolation:{duration:0,easing:r=>r},spring:{stiffness:.05,damping:.5}};function _j(r,e){if(!r)return null;Number.isFinite(r)&&(r={type:"interpolation",duration:r});const t=r.type||"interpolation";return{...Yae[t],...e,...r,type:t}}class bj extends Xae{constructor(e,t){super(e,t,{startIndices:null,lastExternalBuffer:null,binaryValue:null,binaryAccessor:null,needsUpdate:!0,needsRedraw:!1,layoutChanged:!1,updateRanges:C2}),this.constant=!1,this.settings.update=t.update||(t.accessor?this._autoUpdater:void 0),Object.seal(this.settings),Object.seal(this.state),this._validateAttributeUpdaters()}get startIndices(){return this.state.startIndices}set startIndices(e){this.state.startIndices=e}needsUpdate(){return this.state.needsUpdate}needsRedraw({clearChangedFlags:e=!1}={}){const t=this.state.needsRedraw;return this.state.needsRedraw=t&&!e,t}layoutChanged(){return this.state.layoutChanged}setAccessor(e){var t;(t=this.state).layoutChanged||(t.layoutChanged=!Wae(e,this.getAccessor())),super.setAccessor(e)}getUpdateTriggers(){const{accessor:e}=this.settings;return[this.id].concat(typeof e!="function"&&e||[])}supportsTransition(){return!!this.settings.transition}getTransitionSetting(e){if(!e||!this.supportsTransition())return null;const{accessor:t}=this.settings,i=this.settings.transition,n=Array.isArray(t)?e[t.find(a=>e[a])]:e[t];return _j(n,i)}setNeedsUpdate(e=this.id,t){if(this.state.needsUpdate=this.state.needsUpdate||e,this.setNeedsRedraw(e),t){const{startRow:i=0,endRow:n=1/0}=t;this.state.updateRanges=qae(this.state.updateRanges,[i,n])}else this.state.updateRanges=C2}clearNeedsUpdate(){this.state.needsUpdate=!1,this.state.updateRanges=Zae}setNeedsRedraw(e=this.id){this.state.needsRedraw=this.state.needsRedraw||e}allocate(e){const{state:t,settings:i}=this;return i.noAlloc?!1:i.update?(super.allocate(e,t.updateRanges!==C2),!0):!1}updateBuffer({numInstances:e,data:t,props:i,context:n}){if(!this.needsUpdate())return!1;const{state:{updateRanges:a},settings:{update:s,noAlloc:o}}=this;let l=!0;if(s){for(const[c,f]of a)s.call(n,this,{data:t,startRow:c,endRow:f,props:i,numInstances:e});if(this.value)if(this.constant||!this.buffer||this.buffer.byteLength<this.value.byteLength+this.byteOffset)this.setData({value:this.value,constant:this.constant}),this.constant=!1;else for(const[c,f]of a){const p=Number.isFinite(c)?this.getVertexOffset(c):0,y=Number.isFinite(f)?this.getVertexOffset(f):o||!Number.isFinite(e)?this.value.length:e*this.size;super.updateSubBuffer({startOffset:p,endOffset:y})}this._checkAttributeArray()}else l=!1;return this.clearNeedsUpdate(),this.setNeedsRedraw(),l}setConstantValue(e,t){const i=this.device.type==="webgpu";if(i||t===void 0||typeof t=="function"){if(i&&typeof t!="function"){const s=this._normalizeValue(t,[],0);this._areValuesEqual(s,this.value)||this.setNeedsUpdate("WebGPU constant updated")}return!1}const n=this.settings.transform&&e?this.settings.transform.call(e,t):t;return this.setData({constant:!0,value:n})&&this.setNeedsRedraw(),this.clearNeedsUpdate(),!0}setExternalBuffer(e){const{state:t}=this;return e?(this.clearNeedsUpdate(),t.lastExternalBuffer===e||(t.lastExternalBuffer=e,this.setNeedsRedraw(),this.setData(e)),!0):(t.lastExternalBuffer=null,!1)}setBinaryValue(e,t=null){const{state:i,settings:n}=this;if(!e)return i.binaryValue=null,i.binaryAccessor=null,!1;if(n.noAlloc)return!1;if(i.binaryValue===e)return this.clearNeedsUpdate(),!0;if(i.binaryValue=e,this.setNeedsRedraw(),n.transform||t!==this.startIndices){ArrayBuffer.isView(e)&&(e={value:e});const s=e;Ga(ArrayBuffer.isView(s.value),`invalid ${n.accessor}`);const o=!!s.size&&s.size!==this.size;return i.binaryAccessor=yj(s.value,{size:s.size||this.size,stride:s.stride,offset:s.offset,startIndices:t,nested:o}),!1}return this.clearNeedsUpdate(),this.setData(e),!0}getVertexOffset(e){const{startIndices:t}=this;return(t?e<t.length?t[e]:this.numInstances:e)*this.size}getValue(){const e=this.settings.shaderAttributes,t=super.getValue();if(!e)return t;for(const i in e)Object.assign(t,super.getValue(i,e[i]));return t}getBufferLayout(e){this.state.layoutChanged=!1;const t=this.settings.shaderAttributes,i=super._getBufferLayout(),{stepMode:n}=this.settings;if(n==="dynamic"?i.stepMode=e?e.isInstanced?"instance":"vertex":"instance":i.stepMode=n??"vertex",!t)return i;for(const a in t){const s=super._getBufferLayout(a,t[a]);i.attributes.push(...s.attributes)}return i}_autoUpdater(e,{data:t,startRow:i,endRow:n,props:a,numInstances:s}){if(e.constant&&this.context.device.type!=="webgpu")return;const{settings:o,state:l,value:c,size:f,startIndices:p}=e,{accessor:y,transform:b}=o;let S=l.binaryAccessor||(typeof y=="function"?y:a[y]);typeof S!="function"&&typeof y=="string"&&(S=()=>a[y]),Ga(typeof S=="function",`accessor "${y}" is not a function`);let C=e.getVertexOffset(i);const{iterable:E,objectInfo:P}=vj(t,i,n);for(const O of E){P.index++;let B=S(O,P);if(b&&(B=b.call(this,B)),p){const F=(P.index<p.length-1?p[P.index+1]:s)-p[P.index];if(B&&Array.isArray(B[0])){let W=C;for(const $ of B)e._normalizeValue($,c,W),W+=f}else B&&B.length>f?c.set(B,C):(e._normalizeValue(B,P.target,0),vie({target:c,source:P.target,start:C,count:F}));C+=F*f}else e._normalizeValue(B,c,C),C+=f}}_validateAttributeUpdaters(){const{settings:e}=this;if(!(e.noAlloc||typeof e.update=="function"))throw new Error(`Attribute ${this.id} missing update or accessor`)}_checkAttributeArray(){const{value:e}=this,t=Math.min(4,this.size);if(e&&e.length>=t){let i=!0;switch(t){case 4:i=i&&Number.isFinite(e[3]);case 3:i=i&&Number.isFinite(e[2]);case 2:i=i&&Number.isFinite(e[1]);case 1:i=i&&Number.isFinite(e[0]);break;default:i=!1}if(!i)throw new Error(`Illegal attribute generated for ${this.id}`)}}}function dE(r){const{source:e,target:t,start:i=0,size:n,getData:a}=r,s=r.end||t.length,o=e.length,l=s-i;if(o>l){t.set(e.subarray(0,l),i);return}if(t.set(e,i),!a)return;let c=o;for(;c<l;){const f=a(c,e);for(let p=0;p<n;p++)t[i+c]=f[p]||0,c++}}function Kae({source:r,target:e,size:t,getData:i,sourceStartIndices:n,targetStartIndices:a}){if(!n||!a)return dE({source:r,target:e,size:t,getData:i}),e;let s=0,o=0;const l=i&&((f,p)=>i(f+o,p)),c=Math.min(n.length,a.length);for(let f=1;f<c;f++){const p=n[f]*t,y=a[f]*t;dE({source:r.subarray(s,p),target:e,start:o,end:y,size:t,getData:l}),s=p,o=y}return o<e.length&&dE({source:[],target:e,start:o,size:t,getData:l}),e}function Qae(r){const{device:e,settings:t,value:i}=r,n=new bj(e,t);return n.setData({value:i instanceof Float64Array?new Float64Array(0):new Float32Array(0),normalized:t.normalized}),n}function xj(r){switch(r){case 1:return"float";case 2:return"vec2";case 3:return"vec3";case 4:return"vec4";default:throw new Error(`No defined attribute type for size "${r}"`)}}function wj(r){switch(r){case 1:return"float32";case 2:return"float32x2";case 3:return"float32x3";case 4:return"float32x4";default:throw new Error("invalid type size")}}function Sj(r){r.push(r.shift())}function Jae(r,e){const{doublePrecision:t,settings:i,value:n,size:a}=r,s=t&&n instanceof Float64Array?2:1;let o=0;const{shaderAttributes:l}=r.settings;if(l)for(const c of Object.values(l))o=Math.max(o,c.vertexOffset??0);return(i.noAlloc?n.length:(e+o)*a)*s}function Tj({device:r,source:e,target:t}){return(!t||t.byteLength<e.byteLength)&&(t?.destroy(),t=r.createBuffer({byteLength:e.byteLength,usage:e.usage})),t}function Aj({device:r,buffer:e,attribute:t,fromLength:i,toLength:n,fromStartIndices:a,getData:s=o=>o}){const o=t.doublePrecision&&t.value instanceof Float64Array?2:1,l=t.size*o,c=t.byteOffset,f=t.settings.bytesPerElement<4?c/t.settings.bytesPerElement*4:c,p=t.startIndices,y=a&&p,b=t.isConstant;if(!y&&e&&i>=n)return e;const S=t.value instanceof Float64Array?Float32Array:t.value.constructor,C=b?t.value:new S(t.getBuffer().readSyncWebGL(c,n*S.BYTES_PER_ELEMENT).buffer);if(t.settings.normalized&&!b){const B=s;s=(F,W)=>t.normalizeConstant(B(F,W))}const E=b?(B,F)=>s(C,F):(B,F)=>s(C.subarray(B+c,B+c+l),F),P=e?new Float32Array(e.readSyncWebGL(f,i*4).buffer):new Float32Array(0),O=new Float32Array(n);return Kae({source:P,target:O,sourceStartIndices:a,targetStartIndices:p,size:l,getData:E}),(!e||e.byteLength<O.byteLength+f)&&(e?.destroy(),e=r.createBuffer({byteLength:O.byteLength+f,usage:35050})),e.write(O,f),e}class Cj{constructor({device:e,attribute:t,timeline:i}){this.buffers=[],this.currentLength=0,this.device=e,this.transition=new _C(i),this.attribute=t,this.attributeInTransition=Qae(t),this.currentStartIndices=t.startIndices}get inProgress(){return this.transition.inProgress}start(e,t,i=1/0){this.settings=e,this.currentStartIndices=this.attribute.startIndices,this.currentLength=Jae(this.attribute,t),this.transition.start({...e,duration:i})}update(){const e=this.transition.update();return e&&this.onUpdate(),e}setBuffer(e){this.attributeInTransition.setData({buffer:e,normalized:this.attribute.settings.normalized,value:this.attributeInTransition.value})}cancel(){this.transition.cancel()}delete(){this.cancel();for(const e of this.buffers)e.destroy();this.buffers.length=0}}class eoe extends Cj{constructor({device:e,attribute:t,timeline:i}){super({device:e,attribute:t,timeline:i}),this.type="interpolation",this.transform=noe(e,t)}start(e,t){const i=this.currentLength,n=this.currentStartIndices;if(super.start(e,t,e.duration),e.duration<=0){this.transition.cancel();return}const{buffers:a,attribute:s}=this;Sj(a),a[0]=Aj({device:this.device,buffer:a[0],attribute:s,fromLength:i,toLength:this.currentLength,fromStartIndices:n,getData:e.enter}),a[1]=Tj({device:this.device,source:a[0],target:a[1]}),this.setBuffer(a[1]);const{transform:o}=this,l=o.model;let c=Math.floor(this.currentLength/s.size);Mj(s)&&(c/=2),l.setVertexCount(c),s.isConstant?(l.setAttributes({aFrom:a[0]}),l.setConstantAttributes({aTo:s.value})):l.setAttributes({aFrom:a[0],aTo:s.getBuffer()}),o.transformFeedback.setBuffers({vCurrent:a[1]})}onUpdate(){const{duration:e,easing:t}=this.settings,{time:i}=this.transition;let n=i/e;t&&(n=t(n));const{model:a}=this.transform,s={time:n};a.shaderInputs.setProps({interpolation:s}),this.transform.run({discard:!0})}delete(){super.delete(),this.transform.destroy()}}const toe=`uniform interpolationUniforms {
  float time;
} interpolation;
`,UB={name:"interpolation",vs:toe,uniformTypes:{time:"f32"}},roe=`#version 300 es
#define SHADER_NAME interpolation-transition-vertex-shader

in ATTRIBUTE_TYPE aFrom;
in ATTRIBUTE_TYPE aTo;
out ATTRIBUTE_TYPE vCurrent;

void main(void) {
  vCurrent = mix(aFrom, aTo, interpolation.time);
  gl_Position = vec4(0.0);
}
`,ioe=`#version 300 es
#define SHADER_NAME interpolation-transition-vertex-shader

in ATTRIBUTE_TYPE aFrom;
in ATTRIBUTE_TYPE aFrom64Low;
in ATTRIBUTE_TYPE aTo;
in ATTRIBUTE_TYPE aTo64Low;
out ATTRIBUTE_TYPE vCurrent;
out ATTRIBUTE_TYPE vCurrent64Low;

vec2 mix_fp64(vec2 a, vec2 b, float x) {
  vec2 range = sub_fp64(b, a);
  return sum_fp64(a, mul_fp64(range, vec2(x, 0.0)));
}

void main(void) {
  for (int i=0; i<ATTRIBUTE_SIZE; i++) {
    vec2 value = mix_fp64(vec2(aFrom[i], aFrom64Low[i]), vec2(aTo[i], aTo64Low[i]), interpolation.time);
    vCurrent[i] = value.x;
    vCurrent64Low[i] = value.y;
  }
  gl_Position = vec4(0.0);
}
`;function Mj(r){return r.doublePrecision&&r.value instanceof Float64Array}function noe(r,e){const t=e.size,i=xj(t),n=wj(t),a=e.getBufferLayout();return Mj(e)?new V0(r,{vs:ioe,bufferLayout:[{name:"aFrom",byteStride:8*t,attributes:[{attribute:"aFrom",format:n,byteOffset:0},{attribute:"aFrom64Low",format:n,byteOffset:4*t}]},{name:"aTo",byteStride:8*t,attributes:[{attribute:"aTo",format:n,byteOffset:0},{attribute:"aTo64Low",format:n,byteOffset:4*t}]}],modules:[_ee,UB],defines:{ATTRIBUTE_TYPE:i,ATTRIBUTE_SIZE:t},moduleSettings:{},varyings:["vCurrent","vCurrent64Low"],bufferMode:35980,disableWarnings:!0}):new V0(r,{vs:roe,bufferLayout:[{name:"aFrom",format:n},{name:"aTo",format:a.attributes[0].format}],modules:[UB],defines:{ATTRIBUTE_TYPE:i},varyings:["vCurrent"],disableWarnings:!0})}class aoe extends Cj{constructor({device:e,attribute:t,timeline:i}){super({device:e,attribute:t,timeline:i}),this.type="spring",this.texture=hoe(e),this.framebuffer=foe(e,this.texture),this.transform=coe(e,t)}start(e,t){const i=this.currentLength,n=this.currentStartIndices;super.start(e,t);const{buffers:a,attribute:s}=this;for(let l=0;l<2;l++)a[l]=Aj({device:this.device,buffer:a[l],attribute:s,fromLength:i,toLength:this.currentLength,fromStartIndices:n,getData:e.enter});a[2]=Tj({device:this.device,source:a[0],target:a[2]}),this.setBuffer(a[1]);const{model:o}=this.transform;o.setVertexCount(Math.floor(this.currentLength/s.size)),s.isConstant?o.setConstantAttributes({aTo:s.value}):o.setAttributes({aTo:s.getBuffer()})}onUpdate(){const{buffers:e,transform:t,framebuffer:i,transition:n}=this,a=this.settings;t.model.setAttributes({aPrev:e[0],aCur:e[1]}),t.transformFeedback.setBuffers({vNext:e[2]});const s={stiffness:a.stiffness,damping:a.damping};t.model.shaderInputs.setProps({spring:s}),t.run({framebuffer:i,discard:!1,parameters:{viewport:[0,0,1,1]},clearColor:[0,0,0,0]}),Sj(e),this.setBuffer(e[1]),this.device.readPixelsToArrayWebGL(i)[0]>0||n.end()}delete(){super.delete(),this.transform.destroy(),this.texture.destroy(),this.framebuffer.destroy()}}const ooe=`uniform springUniforms {
  float damping;
  float stiffness;
} spring;
`,soe={name:"spring",vs:ooe,uniformTypes:{damping:"f32",stiffness:"f32"}},loe=`#version 300 es
#define SHADER_NAME spring-transition-vertex-shader

#define EPSILON 0.00001

in ATTRIBUTE_TYPE aPrev;
in ATTRIBUTE_TYPE aCur;
in ATTRIBUTE_TYPE aTo;
out ATTRIBUTE_TYPE vNext;
out float vIsTransitioningFlag;

ATTRIBUTE_TYPE getNextValue(ATTRIBUTE_TYPE cur, ATTRIBUTE_TYPE prev, ATTRIBUTE_TYPE dest) {
  ATTRIBUTE_TYPE velocity = cur - prev;
  ATTRIBUTE_TYPE delta = dest - cur;
  ATTRIBUTE_TYPE force = delta * spring.stiffness;
  ATTRIBUTE_TYPE resistance = velocity * spring.damping;
  return force - resistance + velocity + cur;
}

void main(void) {
  bool isTransitioning = length(aCur - aPrev) > EPSILON || length(aTo - aCur) > EPSILON;
  vIsTransitioningFlag = isTransitioning ? 1.0 : 0.0;

  vNext = getNextValue(aCur, aPrev, aTo);
  gl_Position = vec4(0, 0, 0, 1);
  gl_PointSize = 100.0;
}
`,uoe=`#version 300 es
#define SHADER_NAME spring-transition-is-transitioning-fragment-shader

in float vIsTransitioningFlag;

out vec4 fragColor;

void main(void) {
  if (vIsTransitioningFlag == 0.0) {
    discard;
  }
  fragColor = vec4(1.0);
}`;function coe(r,e){const t=xj(e.size),i=wj(e.size);return new V0(r,{vs:loe,fs:uoe,bufferLayout:[{name:"aPrev",format:i},{name:"aCur",format:i},{name:"aTo",format:e.getBufferLayout().attributes[0].format}],varyings:["vNext"],modules:[soe],defines:{ATTRIBUTE_TYPE:t},parameters:{depthCompare:"always",blendColorOperation:"max",blendColorSrcFactor:"one",blendColorDstFactor:"one",blendAlphaOperation:"max",blendAlphaSrcFactor:"one",blendAlphaDstFactor:"one"}})}function hoe(r){return r.createTexture({data:new Uint8Array(4),format:"rgba8unorm",width:1,height:1})}function foe(r,e){return r.createFramebuffer({id:"spring-transition-is-transitioning-framebuffer",width:1,height:1,colorAttachments:[e]})}const doe={interpolation:eoe,spring:aoe};class poe{constructor(e,{id:t,timeline:i}){if(!e)throw new Error("AttributeTransitionManager is constructed without device");this.id=t,this.device=e,this.timeline=i,this.transitions={},this.needsRedraw=!1,this.numInstances=1}finalize(){for(const e in this.transitions)this._removeTransition(e)}update({attributes:e,transitions:t,numInstances:i}){this.numInstances=i||1;for(const n in e){const a=e[n],s=a.getTransitionSetting(t);s&&this._updateAttribute(n,a,s)}for(const n in this.transitions){const a=e[n];(!a||!a.getTransitionSetting(t))&&this._removeTransition(n)}}hasAttribute(e){const t=this.transitions[e];return t&&t.inProgress}getAttributes(){const e={};for(const t in this.transitions){const i=this.transitions[t];i.inProgress&&(e[t]=i.attributeInTransition)}return e}run(){if(this.numInstances===0)return!1;for(const t in this.transitions)this.transitions[t].update()&&(this.needsRedraw=!0);const e=this.needsRedraw;return this.needsRedraw=!1,e}_removeTransition(e){this.transitions[e].delete(),delete this.transitions[e]}_updateAttribute(e,t,i){const n=this.transitions[e];let a=!n||n.type!==i.type;if(a){n&&this._removeTransition(e);const s=doe[i.type];s?this.transitions[e]=new s({attribute:t,timeline:this.timeline,device:this.device}):(Tn.error(`unsupported transition type '${i.type}'`)(),a=!1)}(a||t.needsRedraw())&&(this.needsRedraw=!0,this.transitions[e].start(i,this.numInstances))}}const HB="attributeManager.invalidate",goe="attributeManager.updateStart",voe="attributeManager.updateEnd",moe="attribute.updateStart",yoe="attribute.allocate",_oe="attribute.updateEnd";class boe{constructor(e,{id:t="attribute-manager",stats:i,timeline:n}={}){this.mergeBoundsMemoized=Fw(Ore),this.id=t,this.device=e,this.attributes={},this.updateTriggers={},this.needsRedraw=!0,this.userData={},this.stats=i,this.attributeTransitionManager=new poe(e,{id:`${t}-transitions`,timeline:n}),Object.seal(this)}finalize(){for(const e in this.attributes)this.attributes[e].delete();this.attributeTransitionManager.finalize()}getNeedsRedraw(e={clearRedrawFlags:!1}){const t=this.needsRedraw;return this.needsRedraw=this.needsRedraw&&!e.clearRedrawFlags,t&&this.id}setNeedsRedraw(){this.needsRedraw=!0}add(e){this._add(e)}addInstanced(e){this._add(e,{stepMode:"instance"})}remove(e){for(const t of e)this.attributes[t]!==void 0&&(this.attributes[t].delete(),delete this.attributes[t])}invalidate(e,t){const i=this._invalidateTrigger(e,t);nl(HB,this,e,i)}invalidateAll(e){for(const t in this.attributes)this.attributes[t].setNeedsUpdate(t,e);nl(HB,this,"all")}update({data:e,numInstances:t,startIndices:i=null,transitions:n,props:a={},buffers:s={},context:o={}}){let l=!1;nl(goe,this),this.stats&&this.stats.get("Update Attributes").timeStart();for(const c in this.attributes){const f=this.attributes[c],p=f.settings.accessor;f.startIndices=i,f.numInstances=t,a[c]&&Tn.removed(`props.${c}`,`data.attributes.${c}`)(),f.setExternalBuffer(s[c])||f.setBinaryValue(typeof p=="string"?s[p]:void 0,e.startIndices)||typeof p=="string"&&!s[p]&&f.setConstantValue(o,a[p])||f.needsUpdate()&&(l=!0,this._updateAttribute({attribute:f,numInstances:t,data:e,props:a,context:o})),this.needsRedraw=this.needsRedraw||f.needsRedraw()}l&&nl(voe,this,t),this.stats&&this.stats.get("Update Attributes").timeEnd(),this.attributeTransitionManager.update({attributes:this.attributes,numInstances:t,transitions:n})}updateTransition(){const{attributeTransitionManager:e}=this,t=e.run();return this.needsRedraw=this.needsRedraw||t,t}getAttributes(){return{...this.attributes,...this.attributeTransitionManager.getAttributes()}}getBounds(e){const t=e.map(i=>this.attributes[i]?.getBounds());return this.mergeBoundsMemoized(t)}getChangedAttributes(e={clearChangedFlags:!1}){const{attributes:t,attributeTransitionManager:i}=this,n={...i.getAttributes()};for(const a in t){const s=t[a];s.needsRedraw(e)&&!i.hasAttribute(a)&&(n[a]=s)}return n}getBufferLayouts(e){return Object.values(this.getAttributes()).map(t=>t.getBufferLayout(e))}_add(e,t){for(const i in e){const n=e[i],a={...n,id:i,size:n.isIndexed&&1||n.size||1,...t};this.attributes[i]=new bj(this.device,a)}this._mapUpdateTriggersToAttributes()}_mapUpdateTriggersToAttributes(){const e={};for(const t in this.attributes)this.attributes[t].getUpdateTriggers().forEach(n=>{e[n]||(e[n]=[]),e[n].push(t)});this.updateTriggers=e}_invalidateTrigger(e,t){const{attributes:i,updateTriggers:n}=this,a=n[e];return a&&a.forEach(s=>{const o=i[s];o&&o.setNeedsUpdate(o.id,t)}),a}_updateAttribute(e){const{attribute:t,numInstances:i}=e;if(nl(moe,t),t.constant){t.setConstantValue(e.context,t.value);return}t.allocate(i)&&nl(yoe,t,i),t.updateBuffer(e)&&(this.needsRedraw=!0,nl(_oe,t,i))}}class xoe extends _C{get value(){return this._value}_onUpdate(){const{time:e,settings:{fromValue:t,toValue:i,duration:n,easing:a}}=this,s=a(e/n);this._value=sA(t,i,s)}}const jB=1e-5;function $B(r,e,t,i,n){const a=e-r,o=(t-e)*n,l=-a*i;return o+l+a+e}function woe(r,e,t,i,n){if(Array.isArray(t)){const a=[];for(let s=0;s<t.length;s++)a[s]=$B(r[s],e[s],t[s],i,n);return a}return $B(r,e,t,i,n)}function WB(r,e){if(Array.isArray(r)){let t=0;for(let i=0;i<r.length;i++){const n=r[i]-e[i];t+=n*n}return Math.sqrt(t)}return Math.abs(r-e)}class Soe extends _C{get value(){return this._currValue}_onUpdate(){const{fromValue:e,toValue:t,damping:i,stiffness:n}=this.settings,{_prevValue:a=e,_currValue:s=e}=this;let o=woe(a,s,t,i,n);const l=WB(o,t),c=WB(o,s);l<jB&&c<jB&&(o=t,this.end()),this._prevValue=s,this._currValue=o}}const Toe={interpolation:xoe,spring:Soe};class Aoe{constructor(e){this.transitions=new Map,this.timeline=e}get active(){return this.transitions.size>0}add(e,t,i,n){const{transitions:a}=this;if(a.has(e)){const l=a.get(e),{value:c=l.settings.fromValue}=l;t=c,this.remove(e)}if(n=_j(n),!n)return;const s=Toe[n.type];if(!s){Tn.error(`unsupported transition type '${n.type}'`)();return}const o=new s(this.timeline);o.start({...n,fromValue:t,toValue:i}),a.set(e,o)}remove(e){const{transitions:t}=this;t.has(e)&&(t.get(e).cancel(),t.delete(e))}update(){const e={};for(const[t,i]of this.transitions)i.update(),e[t]=i.value,i.inProgress||this.remove(t);return e}clear(){for(const e of this.transitions.keys())this.remove(e)}}function Coe(r){const e=r[Qm];for(const t in e){const i=e[t],{validate:n}=i;if(n&&!n(r[t],i))throw new Error(`Invalid prop ${t}: ${r[t]}`)}}function Moe(r,e){const t=Ej({newProps:r,oldProps:e,propTypes:r[Qm],ignoreProps:{data:null,updateTriggers:null,extensions:null,transitions:null}}),i=Ioe(r,e);let n=!1;return i||(n=Poe(r,e)),{dataChanged:i,propsChanged:t,updateTriggersChanged:n,extensionsChanged:Roe(r,e),transitionsChanged:Eoe(r,e)}}function Eoe(r,e){if(!r.transitions)return!1;const t={},i=r[Qm];let n=!1;for(const a in r.transitions){const s=i[a],o=s&&s.type;(o==="number"||o==="color"||o==="array")&&xR(r[a],e[a],s)&&(t[a]=!0,n=!0)}return n?t:!1}function Ej({newProps:r,oldProps:e,ignoreProps:t={},propTypes:i={},triggerName:n="props"}){if(e===r)return!1;if(typeof r!="object"||r===null)return`${n} changed shallowly`;if(typeof e!="object"||e===null)return`${n} changed shallowly`;for(const a of Object.keys(r))if(!(a in t)){if(!(a in e))return`${n}.${a} added`;const s=xR(r[a],e[a],i[a]);if(s)return`${n}.${a} ${s}`}for(const a of Object.keys(e))if(!(a in t)){if(!(a in r))return`${n}.${a} dropped`;if(!Object.hasOwnProperty.call(r,a)){const s=xR(r[a],e[a],i[a]);if(s)return`${n}.${a} ${s}`}}return!1}function xR(r,e,t){let i=t&&t.equal;return i&&!i(r,e,t)||!i&&(i=r&&e&&r.equals,i&&!i.call(r,e))?"changed deeply":!i&&e!==r?"changed shallowly":null}function Ioe(r,e){if(e===null)return"oldProps is null, initial diff";let t=!1;const{dataComparator:i,_dataDiff:n}=r;return i?i(r.data,e.data)||(t="Data comparator detected a change"):r.data!==e.data&&(t="A new data container was supplied"),t&&n&&(t=n(r.data,e.data)||t),t}function Poe(r,e){if(e===null)return{all:!0};if("all"in r.updateTriggers&&GB(r,e,"all"))return{all:!0};const t={};let i=!1;for(const n in r.updateTriggers)n!=="all"&&GB(r,e,n)&&(t[n]=!0,i=!0);return i?t:!1}function Roe(r,e){if(e===null)return!0;const t=e.extensions,{extensions:i}=r;if(i===t)return!1;if(!t||!i||i.length!==t.length)return!0;for(let n=0;n<i.length;n++)if(!i[n].equals(t[n]))return!0;return!1}function GB(r,e,t){let i=r.updateTriggers[t];i=i??{};let n=e.updateTriggers[t];return n=n??{},Ej({oldProps:n,newProps:i,triggerName:t})}const Doe="count(): argument not an object",koe="count(): argument not a container";function Loe(r){if(!Noe(r))throw new Error(Doe);if(typeof r.count=="function")return r.count();if(Number.isFinite(r.size))return r.size;if(Number.isFinite(r.length))return r.length;if(Ooe(r))return Object.keys(r).length;throw new Error(koe)}function Ooe(r){return r!==null&&typeof r=="object"&&r.constructor===Object}function Noe(r){return r!==null&&typeof r=="object"}function XB(r,e){if(!e)return r;const t={...r,...e};if("defines"in e&&(t.defines={...r.defines,...e.defines}),"modules"in e&&(t.modules=(r.modules||[]).concat(e.modules),e.modules.some(i=>i.name==="project64"))){const i=t.modules.findIndex(n=>n.name==="project32");i>=0&&t.modules.splice(i,1)}if("inject"in e)if(!r.inject)t.inject=e.inject;else{const i={...r.inject};for(const n in e.inject)i[n]=(i[n]||"")+e.inject[n];t.inject=i}return t}const Boe={minFilter:"linear",mipmapFilter:"linear",magFilter:"linear",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge"},wR={};function zoe(r,e,t,i){if(t instanceof lo)return t;t.constructor&&t.constructor.name!=="Object"&&(t={data:t});let n=null;t.compressed&&(n={minFilter:"linear",mipmapFilter:t.data.length>1?"nearest":"linear"});const{width:a,height:s}=t.data,o=e.createTexture({...t,sampler:{...Boe,...n,...i},mipLevels:e.getMipLevelCount(a,s)});return o.generateMipmapsWebGL(),wR[o.id]=r,o}function Foe(r,e){!e||!(e instanceof lo)||wR[e.id]===r&&(e.delete(),delete wR[e.id])}const Voe={boolean:{validate(r,e){return!0},equal(r,e,t){return!!r==!!e}},number:{validate(r,e){return Number.isFinite(r)&&(!("max"in e)||r<=e.max)&&(!("min"in e)||r>=e.min)}},color:{validate(r,e){return e.optional&&!r||SR(r)&&(r.length===3||r.length===4)},equal(r,e,t){return vc(r,e,1)}},accessor:{validate(r,e){const t=dA(r);return t==="function"||t===dA(e.value)},equal(r,e,t){return typeof e=="function"?!0:vc(r,e,1)}},array:{validate(r,e){return e.optional&&!r||SR(r)},equal(r,e,t){const{compare:i}=t,n=Number.isInteger(i)?i:i?1:0;return i?vc(r,e,n):r===e}},object:{equal(r,e,t){if(t.ignore)return!0;const{compare:i}=t,n=Number.isInteger(i)?i:i?1:0;return i?vc(r,e,n):r===e}},function:{validate(r,e){return e.optional&&!r||typeof r=="function"},equal(r,e,t){return!t.compare&&t.ignore!==!1||r===e}},data:{transform:(r,e,t)=>{if(!r)return r;const{dataTransform:i}=t.props;return i?i(r):typeof r.shape=="string"&&r.shape.endsWith("-table")&&Array.isArray(r.data)?r.data:r}},image:{transform:(r,e,t)=>{const i=t.context;return!i||!i.device?null:zoe(t.id,i.device,r,{...e.parameters,...t.props.textureParameters})},release:(r,e,t)=>{Foe(t.id,r)}}};function Uoe(r){const e={},t={},i={};for(const[n,a]of Object.entries(r)){const s=a?.deprecatedFor;if(s)i[n]=Array.isArray(s)?s:[s];else{const o=Hoe(n,a);e[n]=o,t[n]=o.value}}return{propTypes:e,defaultProps:t,deprecatedProps:i}}function Hoe(r,e){switch(dA(e)){case"object":return Px(r,e);case"array":return Px(r,{type:"array",value:e,compare:!1});case"boolean":return Px(r,{type:"boolean",value:e});case"number":return Px(r,{type:"number",value:e});case"function":return Px(r,{type:"function",value:e,compare:!0});default:return{name:r,type:"unknown",value:e}}}function Px(r,e){return"type"in e?{name:r,...Voe[e.type],...e}:"value"in e?{name:r,type:dA(e.value),...e}:{name:r,type:"object",value:e}}function SR(r){return Array.isArray(r)||ArrayBuffer.isView(r)}function dA(r){return SR(r)?"array":r===null?"null":typeof r}function joe(r,e){let t;for(let a=e.length-1;a>=0;a--){const s=e[a];"extensions"in s&&(t=s.extensions)}const i=TR(r.constructor,t),n=Object.create(i);n[fA]=r,n[py]={},n[Tg]={};for(let a=0;a<e.length;++a){const s=e[a];for(const o in s)n[o]=s[o]}return Object.freeze(n),n}const $oe="_mergedDefaultProps";function TR(r,e){if(!(r instanceof bC.constructor))return{};let t=$oe;if(e)for(const n of e){const a=n.constructor;a&&(t+=`:${a.extensionName||a.name}`)}const i=Ij(r,t);return i||(r[t]=Woe(r,e||[]))}function Woe(r,e){if(!r.prototype)return null;const i=Object.getPrototypeOf(r),n=TR(i),a=Ij(r,"defaultProps")||{},s=Uoe(a),o=Object.assign(Object.create(null),n,s.defaultProps),l=Object.assign(Object.create(null),n?.[Qm],s.propTypes),c=Object.assign(Object.create(null),n?.[sE],s.deprecatedProps);for(const f of e){const p=TR(f.constructor);p&&(Object.assign(o,p),Object.assign(l,p[Qm]),Object.assign(c,p[sE]))}return Goe(o,r),Zoe(o,l),Xoe(o,c),o[Qm]=l,o[sE]=c,e.length===0&&!sk(r,"_propTypes")&&(r._propTypes=l),o}function Goe(r,e){const t=Yoe(e);Object.defineProperties(r,{id:{writable:!0,value:t}})}function Xoe(r,e){for(const t in e)Object.defineProperty(r,t,{enumerable:!1,set(i){const n=`${this.id}: ${t}`;for(const a of e[t])sk(this,a)||(this[a]=i);Tn.deprecated(n,e[t].join("/"))()}})}function Zoe(r,e){const t={},i={};for(const n in e){const a=e[n],{name:s,value:o}=a;a.async&&(t[s]=o,i[s]=qoe(s))}r[A0]=t,r[py]={},Object.defineProperties(r,i)}function qoe(r){return{enumerable:!0,set(e){typeof e=="string"||e instanceof Promise||mj(e)?this[py][r]=e:this[Tg][r]=e},get(){if(this[Tg]){if(r in this[Tg])return this[Tg][r]||this[A0][r];if(r in this[py]){const e=this[fA]&&this[fA].internalState;if(e&&e.hasAsyncProp(r))return e.getAsyncProp(r)||this[A0][r]}}return this[A0][r]}}}function sk(r,e){return Object.prototype.hasOwnProperty.call(r,e)}function Ij(r,e){return sk(r,e)&&r[e]}function Yoe(r){const e=r.componentName;return e||Tn.warn(`${r.name}.componentName not specified`)(),e||r.name}let Koe=0;class bC{constructor(...e){this.props=joe(this,e),this.id=this.props.id,this.count=Koe++}clone(e){const{props:t}=this,i={};for(const n in t[A0])n in t[Tg]?i[n]=t[Tg][n]:n in t[py]&&(i[n]=t[py][n]);return new this.constructor({...t,...i,...e})}}bC.componentName="Component";bC.defaultProps={};const Qoe=Object.freeze({});class Joe{constructor(e){this.component=e,this.asyncProps={},this.onAsyncPropUpdated=()=>{},this.oldProps=null,this.oldAsyncProps=null}finalize(){for(const e in this.asyncProps){const t=this.asyncProps[e];t&&t.type&&t.type.release&&t.type.release(t.resolvedValue,t.type,this.component)}this.asyncProps={},this.component=null,this.resetOldProps()}getOldProps(){return this.oldAsyncProps||this.oldProps||Qoe}resetOldProps(){this.oldAsyncProps=null,this.oldProps=this.component?this.component.props:null}hasAsyncProp(e){return e in this.asyncProps}getAsyncProp(e){const t=this.asyncProps[e];return t&&t.resolvedValue}isAsyncPropLoading(e){if(e){const t=this.asyncProps[e];return!!(t&&t.pendingLoadCount>0&&t.pendingLoadCount!==t.resolvedLoadCount)}for(const t in this.asyncProps)if(this.isAsyncPropLoading(t))return!0;return!1}reloadAsyncProp(e,t){this._watchPromise(e,Promise.resolve(t))}setAsyncProps(e){this.component=e[fA]||this.component;const t=e[Tg]||{},i=e[py]||e,n=e[A0]||{};for(const a in t){const s=t[a];this._createAsyncPropData(a,n[a]),this._updateAsyncProp(a,s),t[a]=this.getAsyncProp(a)}for(const a in i){const s=i[a];this._createAsyncPropData(a,n[a]),this._updateAsyncProp(a,s)}}_fetch(e,t){return null}_onResolve(e,t){}_onError(e,t){}_updateAsyncProp(e,t){if(this._didAsyncInputValueChange(e,t)){if(typeof t=="string"&&(t=this._fetch(e,t)),t instanceof Promise){this._watchPromise(e,t);return}if(mj(t)){this._resolveAsyncIterable(e,t);return}this._setPropValue(e,t)}}_freezeAsyncOldProps(){if(!this.oldAsyncProps&&this.oldProps){this.oldAsyncProps=Object.create(this.oldProps);for(const e in this.asyncProps)Object.defineProperty(this.oldAsyncProps,e,{enumerable:!0,value:this.oldProps[e]})}}_didAsyncInputValueChange(e,t){const i=this.asyncProps[e];return t===i.resolvedValue||t===i.lastValue?!1:(i.lastValue=t,!0)}_setPropValue(e,t){this._freezeAsyncOldProps();const i=this.asyncProps[e];i&&(t=this._postProcessValue(i,t),i.resolvedValue=t,i.pendingLoadCount++,i.resolvedLoadCount=i.pendingLoadCount)}_setAsyncPropValue(e,t,i){const n=this.asyncProps[e];n&&i>=n.resolvedLoadCount&&t!==void 0&&(this._freezeAsyncOldProps(),n.resolvedValue=t,n.resolvedLoadCount=i,this.onAsyncPropUpdated(e,t))}_watchPromise(e,t){const i=this.asyncProps[e];if(i){i.pendingLoadCount++;const n=i.pendingLoadCount;t.then(a=>{this.component&&(a=this._postProcessValue(i,a),this._setAsyncPropValue(e,a,n),this._onResolve(e,a))}).catch(a=>{this._onError(e,a)})}}async _resolveAsyncIterable(e,t){if(e!=="data"){this._setPropValue(e,t);return}const i=this.asyncProps[e];if(!i)return;i.pendingLoadCount++;const n=i.pendingLoadCount;let a=[],s=0;for await(const o of t){if(!this.component)return;const{dataTransform:l}=this.component.props;l?a=l(o,a):a=a.concat(o),Object.defineProperty(a,"__diff",{enumerable:!1,value:[{startRow:s,endRow:a.length}]}),s=a.length,this._setAsyncPropValue(e,a,n)}this._onResolve(e,a)}_postProcessValue(e,t){const i=e.type;return i&&this.component&&(i.release&&i.release(e.resolvedValue,i,this.component),i.transform)?i.transform(t,i,this.component):t}_createAsyncPropData(e,t){if(!this.asyncProps[e]){const n=this.component&&this.component.props[Qm];this.asyncProps[e]={type:n&&n[e],lastValue:null,resolvedValue:t,pendingLoadCount:0,resolvedLoadCount:0}}}}class ese extends Joe{constructor({attributeManager:e,layer:t}){super(t),this.attributeManager=e,this.needsRedraw=!0,this.needsUpdate=!0,this.subLayers=null,this.usesPickingColorCache=!1}get layer(){return this.component}_fetch(e,t){const i=this.layer,n=i?.props.fetch;return n?n(t,{propName:e,layer:i}):super._fetch(e,t)}_onResolve(e,t){const i=this.layer;if(i){const n=i.props.onDataLoad;e==="data"&&n&&n(t,{propName:e,layer:i})}}_onError(e,t){const i=this.layer;i&&i.raiseError(t,`loading ${e} of ${this.layer}`)}}const tse="layer.changeFlag",rse="layer.initialize",ise="layer.update",nse="layer.finalize",ase="layer.matched",ZB=2**24-1,ose=Object.freeze([]),sse=Fw(({oldViewport:r,viewport:e})=>r.equals(e));let dh=new Uint8ClampedArray(0);const lse={data:{type:"data",value:ose,async:!0},dataComparator:{type:"function",value:null,optional:!0},_dataDiff:{type:"function",value:r=>r&&r.__diff,optional:!0},dataTransform:{type:"function",value:null,optional:!0},onDataLoad:{type:"function",value:null,optional:!0},onError:{type:"function",value:null,optional:!0},fetch:{type:"function",value:(r,{propName:e,layer:t,loaders:i,loadOptions:n,signal:a})=>{const{resourceManager:s}=t.context;n=n||t.getLoadOptions(),i=i||t.props.loaders,a&&(n={...n,fetch:{...n?.fetch,signal:a}});let o=s.contains(r);return!o&&!n&&(s.add({resourceId:r,data:XP(r,i),persistent:!1}),o=!0),o?s.subscribe({resourceId:r,onChange:l=>t.internalState?.reloadAsyncProp(e,l),consumerId:t.id,requestId:e}):XP(r,i,n)}},updateTriggers:{},visible:!0,pickable:!1,opacity:{type:"number",min:0,max:1,value:1},operation:"draw",onHover:{type:"function",value:null,optional:!0},onClick:{type:"function",value:null,optional:!0},onDragStart:{type:"function",value:null,optional:!0},onDrag:{type:"function",value:null,optional:!0},onDragEnd:{type:"function",value:null,optional:!0},coordinateSystem:rn.DEFAULT,coordinateOrigin:{type:"array",value:[0,0,0],compare:!0},modelMatrix:{type:"array",value:null,compare:!0,optional:!0},wrapLongitude:!1,positionFormat:"XYZ",colorFormat:"RGBA",parameters:{type:"object",value:{},optional:!0,compare:2},loadOptions:{type:"object",value:null,optional:!0,ignore:!0},transitions:null,extensions:[],loaders:{type:"array",value:[],optional:!0,ignore:!0},getPolygonOffset:{type:"function",value:({layerIndex:r})=>[0,-r*100]},highlightedObjectIndex:null,autoHighlight:!1,highlightColor:{type:"accessor",value:[0,0,128,128]}};let xC=class extends bC{constructor(){super(...arguments),this.internalState=null,this.lifecycle=s0.NO_STATE,this.parent=null}static get componentName(){return Object.prototype.hasOwnProperty.call(this,"layerName")?this.layerName:""}get root(){let e=this;for(;e.parent;)e=e.parent;return e}toString(){return`${this.constructor.layerName||this.constructor.name}({id: '${this.props.id}'})`}project(e){Ga(this.internalState);const t=this.internalState.viewport||this.context.viewport,i=XH(e,{viewport:t,modelMatrix:this.props.modelMatrix,coordinateOrigin:this.props.coordinateOrigin,coordinateSystem:this.props.coordinateSystem}),[n,a,s]=HH(i,t.pixelProjectionMatrix);return e.length===2?[n,a]:[n,a,s]}unproject(e){return Ga(this.internalState),(this.internalState.viewport||this.context.viewport).unproject(e)}projectPosition(e,t){Ga(this.internalState);const i=this.internalState.viewport||this.context.viewport;return Ure(e,{viewport:i,modelMatrix:this.props.modelMatrix,coordinateOrigin:this.props.coordinateOrigin,coordinateSystem:this.props.coordinateSystem,...t})}get isComposite(){return!1}get isDrawable(){return!0}setState(e){this.setChangeFlags({stateChanged:!0}),Object.assign(this.state,e),this.setNeedsRedraw()}setNeedsRedraw(){this.internalState&&(this.internalState.needsRedraw=!0)}setNeedsUpdate(){this.internalState&&(this.context.layerManager.setNeedsUpdate(String(this)),this.internalState.needsUpdate=!0)}get isLoaded(){return this.internalState?!this.internalState.isAsyncPropLoading():!1}get wrapLongitude(){return this.props.wrapLongitude}isPickable(){return this.props.pickable&&this.props.visible}getModels(){const e=this.state;return e&&(e.models||e.model&&[e.model])||[]}setShaderModuleProps(...e){for(const t of this.getModels())t.shaderInputs.setProps(...e)}getAttributeManager(){return this.internalState&&this.internalState.attributeManager}getCurrentLayer(){return this.internalState&&this.internalState.layer}getLoadOptions(){return this.props.loadOptions}use64bitPositions(){const{coordinateSystem:e}=this.props;return e===rn.DEFAULT||e===rn.LNGLAT||e===rn.CARTESIAN}onHover(e,t){return this.props.onHover&&this.props.onHover(e,t)||!1}onClick(e,t){return this.props.onClick&&this.props.onClick(e,t)||!1}nullPickingColor(){return[0,0,0]}encodePickingColor(e,t=[]){return t[0]=e+1&255,t[1]=e+1>>8&255,t[2]=e+1>>8>>8&255,t}decodePickingColor(e){Ga(e instanceof Uint8Array);const[t,i,n]=e;return t+i*256+n*65536-1}getNumInstances(){return Number.isFinite(this.props.numInstances)?this.props.numInstances:this.state&&this.state.numInstances!==void 0?this.state.numInstances:Loe(this.props.data)}getStartIndices(){return this.props.startIndices?this.props.startIndices:this.state&&this.state.startIndices?this.state.startIndices:null}getBounds(){return this.getAttributeManager()?.getBounds(["positions","instancePositions"])}getShaders(e){e=XB(e,{disableWarnings:!0,modules:this.context.defaultShaderModules});for(const t of this.props.extensions)e=XB(e,t.getShaders.call(this,t));return e}shouldUpdateState(e){return e.changeFlags.propsOrDataChanged}updateState(e){const t=this.getAttributeManager(),{dataChanged:i}=e.changeFlags;if(i&&t)if(Array.isArray(i))for(const n of i)t.invalidateAll(n);else t.invalidateAll();if(t){const{props:n}=e,a=this.internalState.hasPickingBuffer,s=Number.isInteger(n.highlightedObjectIndex)||n.pickable||n.extensions.some(o=>o.getNeedsPickingBuffer.call(this,o));if(a!==s){this.internalState.hasPickingBuffer=s;const{pickingColors:o,instancePickingColors:l}=t.attributes,c=o||l;c&&(s&&c.constant&&(c.constant=!1,t.invalidate(c.id)),!c.value&&!s&&(c.constant=!0,c.value=[0,0,0]))}}}finalizeState(e){for(const i of this.getModels())i.destroy();const t=this.getAttributeManager();t&&t.finalize(),this.context&&this.context.resourceManager.unsubscribe({consumerId:this.id}),this.internalState&&(this.internalState.uniformTransitions.clear(),this.internalState.finalize())}draw(e){for(const t of this.getModels())t.draw(e.renderPass)}getPickingInfo({info:e,mode:t,sourceLayer:i}){const{index:n}=e;return n>=0&&Array.isArray(this.props.data)&&(e.object=this.props.data[n]),e}raiseError(e,t){t&&(e=new Error(`${t}: ${e.message}`,{cause:e})),this.props.onError?.(e)||this.context?.onError?.(e,this)}getNeedsRedraw(e={clearRedrawFlags:!1}){return this._getNeedsRedraw(e)}needsUpdate(){return this.internalState?this.internalState.needsUpdate||this.hasUniformTransition()||this.shouldUpdateState(this._getUpdateParams()):!1}hasUniformTransition(){return this.internalState?.uniformTransitions.active||!1}activateViewport(e){if(!this.internalState)return;const t=this.internalState.viewport;this.internalState.viewport=e,(!t||!sse({oldViewport:t,viewport:e}))&&(this.setChangeFlags({viewportChanged:!0}),this.isComposite?this.needsUpdate()&&this.setNeedsUpdate():this._update())}invalidateAttribute(e="all"){const t=this.getAttributeManager();t&&(e==="all"?t.invalidateAll():t.invalidate(e))}updateAttributes(e){let t=!1;for(const i in e)e[i].layoutChanged()&&(t=!0);for(const i of this.getModels())this._setModelAttributes(i,e,t)}_updateAttributes(){const e=this.getAttributeManager();if(!e)return;const t=this.props,i=this.getNumInstances(),n=this.getStartIndices();e.update({data:t.data,numInstances:i,startIndices:n,props:t,transitions:t.transitions,buffers:t.data.attributes,context:this});const a=e.getChangedAttributes({clearChangedFlags:!0});this.updateAttributes(a)}_updateAttributeTransition(){const e=this.getAttributeManager();e&&e.updateTransition()}_updateUniformTransition(){const{uniformTransitions:e}=this.internalState;if(e.active){const t=e.update(),i=Object.create(this.props);for(const n in t)Object.defineProperty(i,n,{value:t[n]});return i}return this.props}calculateInstancePickingColors(e,{numInstances:t}){if(e.constant)return;const i=Math.floor(dh.length/4);if(this.internalState.usesPickingColorCache=!0,i<t){t>ZB&&Tn.warn("Layer has too many data objects. Picking might not be able to distinguish all objects.")(),dh=F0.allocate(dh,t,{size:4,copy:!0,maxCount:Math.max(t,ZB)});const n=Math.floor(dh.length/4),a=[0,0,0];for(let s=i;s<n;s++)this.encodePickingColor(s,a),dh[s*4+0]=a[0],dh[s*4+1]=a[1],dh[s*4+2]=a[2],dh[s*4+3]=0}e.value=dh.subarray(0,t*4)}_setModelAttributes(e,t,i=!1){if(!Object.keys(t).length)return;if(i){const o=this.getAttributeManager();e.setBufferLayout(o.getBufferLayouts(e)),t=o.getAttributes()}const n=e.userData?.excludeAttributes||{},a={},s={};for(const o in t){if(n[o])continue;const l=t[o].getValue();for(const c in l){const f=l[c];f instanceof ua?t[o].settings.isIndexed?e.setIndexBuffer(f):a[c]=f:f&&(s[c]=f)}}e.setAttributes(a),e.setConstantAttributes(s)}disablePickingIndex(e){const t=this.props.data;if(!("attributes"in t)){this._disablePickingIndex(e);return}const{pickingColors:i,instancePickingColors:n}=this.getAttributeManager().attributes,a=i||n,s=a&&t.attributes&&t.attributes[a.id];if(s&&s.value){const o=s.value,l=this.encodePickingColor(e);for(let c=0;c<t.length;c++){const f=a.getVertexOffset(c);o[f]===l[0]&&o[f+1]===l[1]&&o[f+2]===l[2]&&this._disablePickingIndex(c)}}else this._disablePickingIndex(e)}_disablePickingIndex(e){const{pickingColors:t,instancePickingColors:i}=this.getAttributeManager().attributes,n=t||i;if(!n)return;const a=n.getVertexOffset(e),s=n.getVertexOffset(e+1);n.buffer.write(new Uint8Array(s-a),a)}restorePickingColors(){const{pickingColors:e,instancePickingColors:t}=this.getAttributeManager().attributes,i=e||t;i&&(this.internalState.usesPickingColorCache&&i.value.buffer!==dh.buffer&&(i.value=dh.subarray(0,i.value.length)),i.updateSubBuffer({startOffset:0}))}_initialize(){Ga(!this.internalState),Ga(Number.isFinite(this.props.coordinateSystem)),nl(rse,this);const e=this._getAttributeManager();e&&e.addInstanced({instancePickingColors:{type:"uint8",size:4,noAlloc:!0,update:this.calculateInstancePickingColors}}),this.internalState=new ese({attributeManager:e,layer:this}),this._clearChangeFlags(),this.state={},Object.defineProperty(this.state,"attributeManager",{get:()=>(Tn.deprecated("layer.state.attributeManager","layer.getAttributeManager()")(),e)}),this.internalState.uniformTransitions=new Aoe(this.context.timeline),this.internalState.onAsyncPropUpdated=this._onAsyncPropUpdated.bind(this),this.internalState.setAsyncProps(this.props),this.initializeState(this.context);for(const t of this.props.extensions)t.initializeState.call(this,this.context,t);this.setChangeFlags({dataChanged:"init",propsChanged:"init",viewportChanged:!0,extensionsChanged:!0}),this._update()}_transferState(e){nl(ase,this,this===e);const{state:t,internalState:i}=e;this!==e&&(this.internalState=i,this.state=t,this.internalState.setAsyncProps(this.props),this._diffProps(this.props,this.internalState.getOldProps()))}_update(){const e=this.needsUpdate();if(nl(ise,this,e),!e)return;const t=this.props,i=this.context,n=this.internalState,a=i.viewport,s=this._updateUniformTransition();n.propsInTransition=s,i.viewport=n.viewport||a,this.props=s;try{const o=this._getUpdateParams(),l=this.getModels();if(i.device)this.updateState(o);else try{this.updateState(o)}catch{}for(const f of this.props.extensions)f.updateState.call(this,o,f);this.setNeedsRedraw(),this._updateAttributes();const c=this.getModels()[0]!==l[0];this._postUpdate(o,c)}finally{i.viewport=a,this.props=t,this._clearChangeFlags(),n.needsUpdate=!1,n.resetOldProps()}}_finalize(){nl(nse,this),this.finalizeState(this.context);for(const e of this.props.extensions)e.finalizeState.call(this,this.context,e)}_drawLayer({renderPass:e,shaderModuleProps:t=null,uniforms:i={},parameters:n={}}){this._updateAttributeTransition();const a=this.props,s=this.context;this.props=this.internalState.propsInTransition||a;try{t&&this.setShaderModuleProps(t);const{getPolygonOffset:o}=this.props,l=o&&o(i)||[0,0];s.device instanceof _R&&s.device.setParametersWebGL({polygonOffset:l});for(const c of this.getModels())c.device.type==="webgpu"?c.setParameters({...c.parameters,...n}):c.setParameters(n);if(s.device instanceof _R)s.device.withParametersWebGL(n,()=>{const c={renderPass:e,shaderModuleProps:t,uniforms:i,parameters:n,context:s};for(const f of this.props.extensions)f.draw.call(this,c,f);this.draw(c)});else{const c={renderPass:e,shaderModuleProps:t,uniforms:i,parameters:n,context:s};for(const f of this.props.extensions)f.draw.call(this,c,f);this.draw(c)}}finally{this.props=a}}getChangeFlags(){return this.internalState?.changeFlags}setChangeFlags(e){if(!this.internalState)return;const{changeFlags:t}=this.internalState;for(const n in e)if(e[n]){let a=!1;switch(n){case"dataChanged":const s=e[n],o=t[n];s&&Array.isArray(o)&&(t.dataChanged=Array.isArray(s)?o.concat(s):s,a=!0);default:t[n]||(t[n]=e[n],a=!0)}a&&nl(tse,this,n,e)}const i=!!(t.dataChanged||t.updateTriggersChanged||t.propsChanged||t.extensionsChanged);t.propsOrDataChanged=i,t.somethingChanged=i||t.viewportChanged||t.stateChanged}_clearChangeFlags(){this.internalState.changeFlags={dataChanged:!1,propsChanged:!1,updateTriggersChanged:!1,viewportChanged:!1,stateChanged:!1,extensionsChanged:!1,propsOrDataChanged:!1,somethingChanged:!1}}_diffProps(e,t){const i=Moe(e,t);if(i.updateTriggersChanged)for(const n in i.updateTriggersChanged)i.updateTriggersChanged[n]&&this.invalidateAttribute(n);if(i.transitionsChanged)for(const n in i.transitionsChanged)this.internalState.uniformTransitions.add(n,t[n],e[n],e.transitions?.[n]);return this.setChangeFlags(i)}validateProps(){Coe(this.props)}updateAutoHighlight(e){this.props.autoHighlight&&!Number.isInteger(this.props.highlightedObjectIndex)&&this._updateAutoHighlight(e)}_updateAutoHighlight(e){const t={highlightedObjectColor:e.picked?e.color:null},{highlightColor:i}=this.props;e.picked&&typeof i=="function"&&(t.highlightColor=i(e)),this.setShaderModuleProps({picking:t}),this.setNeedsRedraw()}_getAttributeManager(){const e=this.context;return new boe(e.device,{id:this.props.id,stats:e.stats,timeline:e.timeline})}_postUpdate(e,t){const{props:i,oldProps:n}=e,a=this.state.model;a?.isInstanced&&a.setInstanceCount(this.getNumInstances());const{autoHighlight:s,highlightedObjectIndex:o,highlightColor:l}=i;if(t||n.autoHighlight!==s||n.highlightedObjectIndex!==o||n.highlightColor!==l){const c={};Array.isArray(l)&&(c.highlightColor=l),(t||n.autoHighlight!==s||o!==n.highlightedObjectIndex)&&(c.highlightedObjectColor=Number.isFinite(o)&&o>=0?this.encodePickingColor(o):null),this.setShaderModuleProps({picking:c})}}_getUpdateParams(){return{props:this.props,oldProps:this.internalState.getOldProps(),context:this.context,changeFlags:this.internalState.changeFlags}}_getNeedsRedraw(e){if(!this.internalState)return!1;let t=!1;t=t||this.internalState.needsRedraw&&this.id;const i=this.getAttributeManager(),n=i?i.getNeedsRedraw(e):!1;if(t=t||n,t)for(const a of this.props.extensions)a.onNeedsRedraw.call(this,a);return this.internalState.needsRedraw=this.internalState.needsRedraw&&!e.clearRedrawFlags,t}_onAsyncPropUpdated(){this._diffProps(this.props,this.internalState.getOldProps()),this.setNeedsUpdate()}};xC.defaultProps=lse;xC.layerName="Layer";const fT=Math.PI/180,qB=180/Math.PI,M2=6370972,y0=256;function use(){const r=y0/M2,e=Math.PI/180*y0;return{unitsPerMeter:[r,r,r],unitsPerMeter2:[0,0,0],metersPerUnit:[1/r,1/r,1/r],unitsPerDegree:[e,e,r],unitsPerDegree2:[0,0,0],degreesPerUnit:[1/e,1/e,1/r]}}class cse extends rb{constructor(e={}){const{longitude:t=0,zoom:i=0,nearZMultiplier:n=.5,farZMultiplier:a=1,resolution:s=10}=e;let{latitude:o=0,height:l,altitude:c=1.5,fovy:f}=e;o=Math.max(Math.min(o,Sg),-Sg),l=l||1,f?c=GD(f):f=tw(c);const p=1/Math.PI/Math.cos(o*Math.PI/180),y=Math.pow(2,i)*p,b=e.nearZ??n,S=e.farZ??(c+y0*2*y/l)*a,C=new Eh().lookAt({eye:[0,-c,0],up:[0,0,1]});C.rotateX(o*fT),C.rotateZ(-t*fT),C.scale(y/l),super({...e,height:l,viewMatrix:C,longitude:t,latitude:o,zoom:i,distanceScales:use(),fovy:f,focalDistance:c,near:b,far:S}),this.scale=y,this.latitude=o,this.longitude=t,this.resolution=s}get projectionMode(){return mu.GLOBE}getDistanceScales(){return this.distanceScales}getBounds(e={}){const t={targetZ:e.z||0},i=this.unproject([0,this.height/2],t),n=this.unproject([this.width/2,0],t),a=this.unproject([this.width,this.height/2],t),s=this.unproject([this.width/2,this.height],t);return a[0]<this.longitude&&(a[0]+=360),i[0]>this.longitude&&(i[0]-=360),[Math.min(i[0],a[0],n[0],s[0]),Math.min(i[1],a[1],n[1],s[1]),Math.max(i[0],a[0],n[0],s[0]),Math.max(i[1],a[1],n[1],s[1])]}unproject(e,{topLeft:t=!0,targetZ:i}={}){const[n,a,s]=e,o=t?a:this.height-a,{pixelUnprojectionMatrix:l}=this;let c;if(Number.isFinite(s))c=pE(l,[n,o,s,1]);else{const b=pE(l,[n,o,-1,1]),S=pE(l,[n,o,1,1]),C=((i||0)/M2+1)*y0,E=YM(SH([],b,S)),P=YM(b),O=YM(S),F=4*((4*P*O-(E-P-O)**2)/16)/E,W=Math.sqrt(P-F),$=Math.sqrt(Math.max(0,C*C-F)),q=(W-$)/Math.sqrt(E);c=FJ([],b,S,q)}const[f,p,y]=this.unprojectPosition(c);return Number.isFinite(s)?[f,p,y]:Number.isFinite(i)?[f,p,i]:[f,p]}projectPosition(e){const[t,i,n=0]=e,a=t*fT,s=i*fT,o=Math.cos(s),l=(n/M2+1)*y0;return[Math.sin(a)*o*l,-Math.cos(a)*o*l,Math.sin(s)*l]}unprojectPosition(e){const[t,i,n]=e,a=GJ(e),s=Math.asin(n/a),l=Math.atan2(t,-i)*qB,c=s*qB,f=(a/y0-1)*M2;return[l,c,f]}projectFlat(e){return e}unprojectFlat(e){return e}panByPosition(e,t){const i=this.unproject(t);return{longitude:e[0]-i[0]+this.longitude,latitude:e[1]-i[1]+this.latitude}}}function pE(r,e){const t=tb([],e,r);return CH(t,t,1/t[3]),t}class hse extends rj{applyConstraints(e){const{maxZoom:t,minZoom:i,zoom:n}=e;e.zoom=kf(n,i,t);const{longitude:a,latitude:s}=e;return(a<-180||a>180)&&(e.longitude=Rre(a+180,360)-180),e.latitude=kf(s,-Sg,Sg),e}}class fse extends tj{constructor(){super(...arguments),this.ControllerState=hse,this.transition={transitionDuration:300,transitionInterpolator:new QD(["longitude","latitude","zoom"])},this.dragMode="pan"}setProps(e){super.setProps(e),this.dragRotate=!1,this.touchRotate=!1}}class Pj extends ej{constructor(e={}){super(e)}getViewportType(e){return e.zoom>12?dy:cse}get ControllerType(){return fse}}Pj.displayName="GlobeView";class dse{constructor(e){this.indexStarts=[0],this.vertexStarts=[0],this.vertexCount=0,this.instanceCount=0;const{attributes:t={}}=e;this.typedArrayManager=F0,this.attributes={},this._attributeDefs=t,this.opts=e,this.updateGeometry(e)}updateGeometry(e){Object.assign(this.opts,e);const{data:t,buffers:i={},getGeometry:n,geometryBuffer:a,positionFormat:s,dataChanged:o,normalize:l=!0}=this.opts;if(this.data=t,this.getGeometry=n,this.positionSize=a&&a.size||(s==="XY"?2:3),this.buffers=i,this.normalize=l,a&&(Ga(t.startIndices),this.getGeometry=this.getGeometryFromBuffer(a),l||(i.vertexPositions=a)),this.geometryBuffer=i.vertexPositions,Array.isArray(o))for(const c of o)this._rebuildGeometry(c);else this._rebuildGeometry()}updatePartialGeometry({startRow:e,endRow:t}){this._rebuildGeometry({startRow:e,endRow:t})}getGeometryFromBuffer(e){const t=e.value||e;return ArrayBuffer.isView(t)?yj(t,{size:this.positionSize,offset:e.offset,stride:e.stride,startIndices:this.data.startIndices}):null}_allocate(e,t){const{attributes:i,buffers:n,_attributeDefs:a,typedArrayManager:s}=this;for(const o in a)if(o in n)s.release(i[o]),i[o]=null;else{const l=a[o];l.copy=t,i[o]=s.allocate(i[o],e,l)}}_forEachGeometry(e,t,i){const{data:n,getGeometry:a}=this,{iterable:s,objectInfo:o}=vj(n,t,i);for(const l of s){o.index++;const c=a?a(l,o):null;e(c,o.index)}}_rebuildGeometry(e){if(!this.data)return;let{indexStarts:t,vertexStarts:i,instanceCount:n}=this;const{data:a,geometryBuffer:s}=this,{startRow:o=0,endRow:l=1/0}=e||{},c={};if(e||(t=[0],i=[0]),this.normalize||!s)this._forEachGeometry((p,y)=>{const b=p&&this.normalizeGeometry(p);c[y]=b,i[y+1]=i[y]+(b?this.getGeometrySize(b):0)},o,l),n=i[i.length-1];else if(i=a.startIndices,n=i[a.length]||0,ArrayBuffer.isView(s))n=n||s.length/this.positionSize;else if(s instanceof ua){const p=this.positionSize*4;n=n||s.byteLength/p}else if(s.buffer){const p=s.stride||this.positionSize*4;n=n||s.buffer.byteLength/p}else if(s.value){const p=s.value,y=s.stride/p.BYTES_PER_ELEMENT||this.positionSize;n=n||p.length/y}this._allocate(n,!!e),this.indexStarts=t,this.vertexStarts=i,this.instanceCount=n;const f={};this._forEachGeometry((p,y)=>{const b=c[y]||p;f.vertexStart=i[y],f.indexStart=t[y];const S=y<i.length-1?i[y+1]:n;f.geometrySize=S-i[y],f.geometryIndex=y,this.updateGeometryAttributes(b,f)},o,l),this.vertexCount=t[t.length-1]}}const nw="mapbox",gE=512,pse=Math.PI/180;function Rj({map:r,gl:e,deck:t}){if(r.__deck)return r.__deck;const i=t?.props._customRender,n=t?.props.onLoad,a={...t?.props,_customRender:()=>{r.triggerRepaint(),i?.("")}};a.parameters={...E2(r,!0),...a.parameters},a.views||(a.views=L1(r));let s;return(!t||t.props.gl===e)&&(Object.assign(a,{gl:e,width:null,height:null,touchAction:"unset",viewState:aw(r)}),t?.isInitialized?YB(t,r):a.onLoad=()=>{n?.(),YB(s,r)}),t?(s=t,t.setProps(a),t.userData.isExternal=!0):(s=new iw(a),r.on("remove",()=>{Dj(r)})),s.userData.mapboxLayers=new Set,r.__deck=s,r.on("render",()=>{s.isInitialized&&bse(s,r)}),s}function YB(r,e){const t=()=>{r.isInitialized?xse(r,e):e.off("move",t)};e.on("move",t)}function Dj(r){r.__deck?.finalize(),r.__deck=null}function E2(r,e){const t=e?{depthWriteEnabled:!0,depthCompare:"less-equal",depthBias:0,blend:!0,blendColorSrcFactor:"src-alpha",blendColorDstFactor:"one-minus-src-alpha",blendAlphaSrcFactor:"one",blendAlphaDstFactor:"one-minus-src-alpha",blendColorOperation:"add",blendAlphaOperation:"add"}:{};return lk(r)==="globe"&&(t.cullMode="back"),t}function gse(r,e){r.userData.mapboxLayers.add(e),uk(r)}function vse(r,e){r.userData.mapboxLayers.delete(e),uk(r)}function mse(r,e){uk(r)}function yse(r,e,t,i){let{currentViewport:n}=r.userData,a=!1;n||(n=kj(r,e,i),r.userData.currentViewport=n,a=!0),r.isInitialized&&r._drawLayers("mapbox-repaint",{viewports:[n],layerFilter:s=>(!r.props.layerFilter||r.props.layerFilter(s))&&(t.id===s.layer.id||s.layer.props.operation.includes("terrain")),clearStack:a,clearCanvas:!1})}function lk(r){const e=r.getProjection?.(),t=e?.type||e?.name;if(t==="globe")return"globe";if(t&&t!=="mercator")throw new Error("Unsupported projection");return"mercator"}function L1(r){return lk(r)==="globe"?new Pj({id:nw}):new JD({id:nw})}function aw(r){const{lng:e,lat:t}=r.getCenter(),i={longitude:(e+540)%360-180,latitude:t,zoom:r.getZoom(),bearing:r.getBearing(),pitch:r.getPitch(),padding:r.getPadding(),repeat:r.getRenderWorldCopies()};return r.getTerrain?.()&&_se(r,i),i}function _se(r,e){if(r.getFreeCameraOptions){const{position:t}=r.getFreeCameraOptions();if(!t||t.z===void 0)return;const i=r.transform.height,{longitude:n,latitude:a,pitch:s}=e,o=t.x*gE,l=(1-t.y)*gE,c=t.z*gE,f=ew([n,a]),p=o-f[0],y=l-f[1],b=Math.sqrt(p*p+y*y),S=s*pse,C=1.5*i,E=S<.001?C*Math.cos(S)/c:C*Math.sin(S)/b;e.zoom=Math.log2(E);const P=C*Math.cos(S)/E,O=c-P;e.position=[0,0,O/A2(a)]}else typeof r.transform.elevation=="number"&&(e.position=[0,0,r.transform.elevation])}function kj(r,e,t){const i=aw(e),{views:n}=r.props,a=n&&U0(n).find(l=>l.id===nw)||L1(e);t&&(a.props.nearZMultiplier=.2);const s=t?.nearZ??e.transform._nearZ,o=t?.farZ??e.transform._farZ;return Number.isFinite(s)&&(i.nearZ=s/e.transform.height,i.farZ=o/e.transform.height),a.makeViewport({width:r.width,height:r.height,viewState:i})}function bse(r,e){const{mapboxLayers:t,isExternal:i}=r.userData;if(i){const n=Array.from(t,f=>f.id),s=U0(r.props.layers,Boolean).some(f=>f&&!n.includes(f.id));let o=r.getViewports();const l=o.findIndex(f=>f.id===nw),c=o.length>1||l<0;(s||c)&&(l>=0&&(o=o.slice(),o[l]=kj(r,e)),r._drawLayers("mapbox-repaint",{viewports:o,layerFilter:f=>(!r.props.layerFilter||r.props.layerFilter(f))&&(f.viewport.id!==nw||!n.includes(f.layer.id)),clearCanvas:!1}))}r.userData.currentViewport=null}function xse(r,e){r.setProps({viewState:aw(e)}),r.needsRedraw({clearRedrawFlags:!0})}function uk(r){if(r.userData.isExternal)return;const e=[];r.userData.mapboxLayers.forEach(t=>{const i=t.props.type,n=new i(t.props);e.push(n)}),r.setProps({layers:e})}class wse{constructor(e){if(!e.id)throw new Error("Layer must have an unique id");this.id=e.id,this.type="custom",this.renderingMode=e.renderingMode||"3d",this.slot=e.slot,this.map=null,this.deck=null,this.props=e}onAdd(e,t){this.map=e,this.deck=Rj({map:e,gl:t,deck:this.props.deck}),gse(this.deck,this)}onRemove(){this.deck&&vse(this.deck,this)}setProps(e){Object.assign(this.props,e,{id:this.id}),this.deck&&mse(this.deck)}render(e,t){yse(this.deck,this.map,this,t)}}const vE="__UNDEFINED__";function dT(r,e,t,i){if(!r||!e||!r.style||!r.style._loaded)return;const n=U0(i,Boolean);if(t!==i){const o=U0(t,Boolean),l=new Set(o.map(c=>c.id));for(const c of n)l.delete(c.id);for(const c of l)r.getLayer(c)&&r.removeLayer(c)}for(const o of n){const l=r.getLayer(o.id);l?(l.implementation||l).setProps(o.props):r.addLayer(new wse({id:o.id,deck:e,slot:o.props.slot}),o.props.beforeId)}const a=r.style._order,s={};for(const o of n){let{beforeId:l}=o.props;(!l||!a.includes(l))&&(l=vE),s[l]=s[l]||[],s[l].push(o.id)}for(const o in s){const l=s[o];let c=o===vE?a.length:a.indexOf(o),f=o===vE?void 0:o;for(let p=l.length-1;p>=0;p--){const y=l[p],b=a.indexOf(y);b!==c-1&&(r.moveLayer(y,f),b>c&&c++),c--,f=y}}}class Sse{constructor(e){this._handleStyleChange=()=>{if(dT(this._map,this._deck,this._props.layers,this._props.layers),!this._map)return;lk(this._map)&&!this._props.views&&this._deck?.setProps({views:L1(this._map)})},this._updateContainerSize=()=>{if(this._map&&this._container){const{clientWidth:i,clientHeight:n}=this._map.getContainer();Object.assign(this._container.style,{width:`${i}px`,height:`${n}px`})}},this._updateViewState=()=>{const i=this._deck,n=this._map;i&&n&&(i.setProps({views:this._props.views||L1(n),viewState:aw(n)}),i.isInitialized&&i.redraw())},this._handleMouseEvent=i=>{const n=this._deck;if(!n||!n.isInitialized)return;const a={type:i.type,offsetCenter:i.point,srcEvent:i},s=this._lastMouseDownPoint;switch(!i.point&&s&&(a.deltaX=i.originalEvent.clientX-s.clientX,a.deltaY=i.originalEvent.clientY-s.clientY,a.offsetCenter={x:s.x+a.deltaX,y:s.y+a.deltaY}),a.type){case"mousedown":n._onPointerDown(a),this._lastMouseDownPoint={...i.point,clientX:i.originalEvent.clientX,clientY:i.originalEvent.clientY};break;case"dragstart":a.type="panstart",n._onEvent(a);break;case"drag":a.type="panmove",n._onEvent(a);break;case"dragend":a.type="panend",n._onEvent(a);break;case"click":a.tapCount=1,n._onEvent(a);break;case"dblclick":a.type="click",a.tapCount=2,n._onEvent(a);break;case"mousemove":a.type="pointermove",n._onPointerMove(a);break;case"mouseout":a.type="pointerleave",n._onPointerMove(a);break;default:return}};const{interleaved:t=!1}=e;this._interleaved=t,this._props=this.filterProps(e)}filterProps(e){const{interleaved:t=!1,useDevicePixels:i,...n}=e;return!t&&i!==void 0&&(n.useDevicePixels=i),n}setProps(e){this._interleaved&&e.layers&&dT(this._map,this._deck,this._props.layers,e.layers),Object.assign(this._props,this.filterProps(e)),this._deck&&this._map&&this._deck.setProps({...this._props,parameters:{...E2(this._map,this._interleaved),...this._props.parameters}})}onAdd(e){return this._map=e,this._interleaved?this._onAddInterleaved(e):this._onAddOverlaid(e)}_onAddOverlaid(e){const t=document.createElement("div");return Object.assign(t.style,{position:"absolute",left:0,top:0,textAlign:"initial",pointerEvents:"none"}),this._container=t,this._deck=new iw({...this._props,parent:t,parameters:{...E2(e,!1),...this._props.parameters},views:this._props.views||L1(e),viewState:aw(e)}),e.on("resize",this._updateContainerSize),e.on("render",this._updateViewState),e.on("mousedown",this._handleMouseEvent),e.on("dragstart",this._handleMouseEvent),e.on("drag",this._handleMouseEvent),e.on("dragend",this._handleMouseEvent),e.on("mousemove",this._handleMouseEvent),e.on("mouseout",this._handleMouseEvent),e.on("click",this._handleMouseEvent),e.on("dblclick",this._handleMouseEvent),this._updateContainerSize(),t}_onAddInterleaved(e){const t=e.painter.context.gl;return t instanceof WebGLRenderingContext&&Tn.warn("Incompatible basemap library. See: https://deck.gl/docs/api-reference/mapbox/overview#compatibility")(),this._deck=Rj({map:e,gl:t,deck:new iw({...this._props,gl:t,parameters:{...E2(e,!1),...this._props.parameters},deviceProps:{createCanvasContext:{autoResize:!0}}})}),e.on("styledata",this._handleStyleChange),dT(e,this._deck,[],this._props.layers),document.createElement("div")}onRemove(){const e=this._map;e&&(this._interleaved?this._onRemoveInterleaved(e):this._onRemoveOverlaid(e)),this._deck=void 0,this._map=void 0,this._container=void 0}_onRemoveOverlaid(e){e.off("resize",this._updateContainerSize),e.off("render",this._updateViewState),e.off("mousedown",this._handleMouseEvent),e.off("dragstart",this._handleMouseEvent),e.off("drag",this._handleMouseEvent),e.off("dragend",this._handleMouseEvent),e.off("mousemove",this._handleMouseEvent),e.off("mouseout",this._handleMouseEvent),e.off("click",this._handleMouseEvent),e.off("dblclick",this._handleMouseEvent),this._deck?.finalize()}_onRemoveInterleaved(e){e.off("styledata",this._handleStyleChange),dT(e,this._deck,this._props.layers,[]),Dj(e)}getDefaultPosition(){return"top-left"}pickObject(e){return Ga(this._deck),this._deck.pickObject(e)}pickMultipleObjects(e){return Ga(this._deck),this._deck.pickMultipleObjects(e)}pickObjects(e){return Ga(this._deck),this._deck.pickObjects(e)}finalize(){this._map&&this._map.removeControl(this)}getCanvas(){return this._map?this._interleaved?this._map.getCanvas():this._deck.getCanvas():null}}const KB=`uniform scatterplotUniforms {
  float radiusScale;
  float radiusMinPixels;
  float radiusMaxPixels;
  float lineWidthScale;
  float lineWidthMinPixels;
  float lineWidthMaxPixels;
  float stroked;
  float filled;
  bool antialiasing;
  bool billboard;
  highp int radiusUnits;
  highp int lineWidthUnits;
} scatterplot;
`,Tse={name:"scatterplot",vs:KB,fs:KB,source:"",uniformTypes:{radiusScale:"f32",radiusMinPixels:"f32",radiusMaxPixels:"f32",lineWidthScale:"f32",lineWidthMinPixels:"f32",lineWidthMaxPixels:"f32",stroked:"f32",filled:"f32",antialiasing:"f32",billboard:"f32",radiusUnits:"i32",lineWidthUnits:"i32"}},Ase=`#version 300 es
#define SHADER_NAME scatterplot-layer-vertex-shader
in vec3 positions;
in vec3 instancePositions;
in vec3 instancePositions64Low;
in float instanceRadius;
in float instanceLineWidths;
in vec4 instanceFillColors;
in vec4 instanceLineColors;
in vec3 instancePickingColors;
out vec4 vFillColor;
out vec4 vLineColor;
out vec2 unitPosition;
out float innerUnitRadius;
out float outerRadiusPixels;
void main(void) {
geometry.worldPosition = instancePositions;
outerRadiusPixels = clamp(
project_size_to_pixel(scatterplot.radiusScale * instanceRadius, scatterplot.radiusUnits),
scatterplot.radiusMinPixels, scatterplot.radiusMaxPixels
);
float lineWidthPixels = clamp(
project_size_to_pixel(scatterplot.lineWidthScale * instanceLineWidths, scatterplot.lineWidthUnits),
scatterplot.lineWidthMinPixels, scatterplot.lineWidthMaxPixels
);
outerRadiusPixels += scatterplot.stroked * lineWidthPixels / 2.0;
float edgePadding = scatterplot.antialiasing ? (outerRadiusPixels + SMOOTH_EDGE_RADIUS) / outerRadiusPixels : 1.0;
unitPosition = edgePadding * positions.xy;
geometry.uv = unitPosition;
geometry.pickingColor = instancePickingColors;
innerUnitRadius = 1.0 - scatterplot.stroked * lineWidthPixels / outerRadiusPixels;
if (scatterplot.billboard) {
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, vec3(0.0), geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
vec3 offset = edgePadding * positions * outerRadiusPixels;
DECKGL_FILTER_SIZE(offset, geometry);
gl_Position.xy += project_pixel_size_to_clipspace(offset.xy);
} else {
vec3 offset = edgePadding * positions * project_pixel_size(outerRadiusPixels);
DECKGL_FILTER_SIZE(offset, geometry);
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, offset, geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
}
vFillColor = vec4(instanceFillColors.rgb, instanceFillColors.a * layer.opacity);
DECKGL_FILTER_COLOR(vFillColor, geometry);
vLineColor = vec4(instanceLineColors.rgb, instanceLineColors.a * layer.opacity);
DECKGL_FILTER_COLOR(vLineColor, geometry);
}
`,Cse=`#version 300 es
#define SHADER_NAME scatterplot-layer-fragment-shader
precision highp float;
in vec4 vFillColor;
in vec4 vLineColor;
in vec2 unitPosition;
in float innerUnitRadius;
in float outerRadiusPixels;
out vec4 fragColor;
void main(void) {
geometry.uv = unitPosition;
float distToCenter = length(unitPosition) * outerRadiusPixels;
float inCircle = scatterplot.antialiasing ?
smoothedge(distToCenter, outerRadiusPixels) :
step(distToCenter, outerRadiusPixels);
if (inCircle == 0.0) {
discard;
}
if (scatterplot.stroked > 0.5) {
float isLine = scatterplot.antialiasing ?
smoothedge(innerUnitRadius * outerRadiusPixels, distToCenter) :
step(innerUnitRadius * outerRadiusPixels, distToCenter);
if (scatterplot.filled > 0.5) {
fragColor = mix(vFillColor, vLineColor, isLine);
} else {
if (isLine == 0.0) {
discard;
}
fragColor = vec4(vLineColor.rgb, vLineColor.a * isLine);
}
} else if (scatterplot.filled < 0.5) {
discard;
} else {
fragColor = vFillColor;
}
fragColor.a *= inCircle;
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,Mse=`// Main shaders

struct ScatterplotUniforms {
  radiusScale: f32,
  radiusMinPixels: f32,
  radiusMaxPixels: f32,
  lineWidthScale: f32,
  lineWidthMinPixels: f32,
  lineWidthMaxPixels: f32,
  stroked: f32,
  filled: i32,
  antialiasing: i32,
  billboard: i32,
  radiusUnits: i32,
  lineWidthUnits: i32,
};

struct ConstantAttributeUniforms {
 instancePositions: vec3<f32>,
 instancePositions64Low: vec3<f32>,
 instanceRadius: f32,
 instanceLineWidths: f32,
 instanceFillColors: vec4<f32>,
 instanceLineColors: vec4<f32>,
 instancePickingColors: vec3<f32>,

 instancePositionsConstant: i32,
 instancePositions64LowConstant: i32,
 instanceRadiusConstant: i32,
 instanceLineWidthsConstant: i32,
 instanceFillColorsConstant: i32,
 instanceLineColorsConstant: i32,
 instancePickingColorsConstant: i32
};

@group(0) @binding(2) var<uniform> scatterplot: ScatterplotUniforms;

struct ConstantAttributes {
  instancePositions: vec3<f32>,
  instancePositions64Low: vec3<f32>,
  instanceRadius: f32,
  instanceLineWidths: f32,
  instanceFillColors: vec4<f32>,
  instanceLineColors: vec4<f32>,
  instancePickingColors: vec3<f32>
};

const constants = ConstantAttributes(
  vec3<f32>(0.0),
  vec3<f32>(0.0),
  0.0,
  0.0,
  vec4<f32>(0.0, 0.0, 0.0, 1.0),
  vec4<f32>(0.0, 0.0, 0.0, 1.0),
  vec3<f32>(0.0)
);

struct Attributes {
  @builtin(instance_index) instanceIndex : u32,
  @builtin(vertex_index) vertexIndex : u32,
  @location(0) positions: vec3<f32>,
  @location(1) instancePositions: vec3<f32>,
  @location(2) instancePositions64Low: vec3<f32>,
  @location(3) instanceRadius: f32,
  @location(4) instanceLineWidths: f32,
  @location(5) instanceFillColors: vec4<f32>,
  @location(6) instanceLineColors: vec4<f32>,
  @location(7) instancePickingColors: vec3<f32>
};

struct Varyings {
  @builtin(position) position: vec4<f32>,
  @location(0) vFillColor: vec4<f32>,
  @location(1) vLineColor: vec4<f32>,
  @location(2) unitPosition: vec2<f32>,
  @location(3) innerUnitRadius: f32,
  @location(4) outerRadiusPixels: f32,
};

@vertex
fn vertexMain(attributes: Attributes) -> Varyings {
  var varyings: Varyings;

  // Draw an inline geometry constant array clip space triangle to verify that rendering works.
  // var positions = array<vec2<f32>, 3>(vec2(0.0, 0.5), vec2(-0.5, -0.5), vec2(0.5, -0.5));
  // if (attributes.instanceIndex == 0) {
  //   varyings.position = vec4<f32>(positions[attributes.vertexIndex], 0.0, 1.0);
  //   return varyings;
  // }

  // var geometry: Geometry;
  // geometry.worldPosition = instancePositions;

  // Multiply out radius and clamp to limits
  varyings.outerRadiusPixels = clamp(
    project_unit_size_to_pixel(scatterplot.radiusScale * attributes.instanceRadius, scatterplot.radiusUnits),
    scatterplot.radiusMinPixels, scatterplot.radiusMaxPixels
  );

  // Multiply out line width and clamp to limits
  let lineWidthPixels = clamp(
    project_unit_size_to_pixel(scatterplot.lineWidthScale * attributes.instanceLineWidths, scatterplot.lineWidthUnits),
    scatterplot.lineWidthMinPixels, scatterplot.lineWidthMaxPixels
  );

  // outer radius needs to offset by half stroke width
  varyings.outerRadiusPixels += scatterplot.stroked * lineWidthPixels / 2.0;
  // Expand geometry to accommodate edge smoothing
  let edgePadding = select(
    (varyings.outerRadiusPixels + SMOOTH_EDGE_RADIUS) / varyings.outerRadiusPixels,
    1.0,
    scatterplot.antialiasing != 0
  );

  // position on the containing square in [-1, 1] space
  varyings.unitPosition = edgePadding * attributes.positions.xy;
  geometry.uv = varyings.unitPosition;
  geometry.pickingColor = attributes.instancePickingColors;

  varyings.innerUnitRadius = 1.0 - scatterplot.stroked * lineWidthPixels / varyings.outerRadiusPixels;

  if (scatterplot.billboard != 0) {
    varyings.position = project_position_to_clipspace(attributes.instancePositions, attributes.instancePositions64Low, vec3<f32>(0.0)); // TODO , geometry.position);
    // DECKGL_FILTER_GL_POSITION(varyings.position, geometry);
    let offset = attributes.positions; // * edgePadding * varyings.outerRadiusPixels;
    // DECKGL_FILTER_SIZE(offset, geometry);
    let clipPixels = project_pixel_size_to_clipspace(offset.xy);
    varyings.position.x = clipPixels.x;
    varyings.position.y = clipPixels.y;
  } else {
    let offset = edgePadding * attributes.positions * project_pixel_size_float(varyings.outerRadiusPixels);
    // DECKGL_FILTER_SIZE(offset, geometry);
    varyings.position = project_position_to_clipspace(attributes.instancePositions, attributes.instancePositions64Low, offset); // TODO , geometry.position);
    // DECKGL_FILTER_GL_POSITION(varyings.position, geometry);
  }

  // Apply opacity to instance color, or return instance picking color
  varyings.vFillColor = vec4<f32>(attributes.instanceFillColors.rgb, attributes.instanceFillColors.a * color.opacity);
  // DECKGL_FILTER_COLOR(varyings.vFillColor, geometry);
  varyings.vLineColor = vec4<f32>(attributes.instanceLineColors.rgb, attributes.instanceLineColors.a * color.opacity);
  // DECKGL_FILTER_COLOR(varyings.vLineColor, geometry);

  return varyings;
}

@fragment
fn fragmentMain(varyings: Varyings) -> @location(0) vec4<f32> {
  // var geometry: Geometry;
  // geometry.uv = unitPosition;

  let distToCenter = length(varyings.unitPosition) * varyings.outerRadiusPixels;
  let inCircle = select(
    smoothedge(distToCenter, varyings.outerRadiusPixels),
    step(distToCenter, varyings.outerRadiusPixels),
    scatterplot.antialiasing != 0
  );

  if (inCircle == 0.0) {
    discard;
  }

  var fragColor: vec4<f32>;

  if (scatterplot.stroked != 0) {
    let isLine = select(
      smoothedge(varyings.innerUnitRadius * varyings.outerRadiusPixels, distToCenter),
      step(varyings.innerUnitRadius * varyings.outerRadiusPixels, distToCenter),
      scatterplot.antialiasing != 0
    );

    if (scatterplot.filled != 0) {
      fragColor = mix(varyings.vFillColor, varyings.vLineColor, isLine);
    } else {
      if (isLine == 0.0) {
        discard;
      }
      fragColor = vec4<f32>(varyings.vLineColor.rgb, varyings.vLineColor.a * isLine);
    }
  } else if (scatterplot.filled == 0) {
    discard;
  } else {
    fragColor = varyings.vFillColor;
  }

  fragColor.a *= inCircle;
  // DECKGL_FILTER_COLOR(fragColor, geometry);

  // Apply premultiplied alpha as required by transparent canvas
  fragColor = deckgl_premultiplied_alpha(fragColor);

  return fragColor;
  // return vec4<f32>(0, 0, 1, 1);
}
`,QB=[0,0,0,255],Ese={radiusUnits:"meters",radiusScale:{type:"number",min:0,value:1},radiusMinPixels:{type:"number",min:0,value:0},radiusMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},lineWidthUnits:"meters",lineWidthScale:{type:"number",min:0,value:1},lineWidthMinPixels:{type:"number",min:0,value:0},lineWidthMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},stroked:!1,filled:!0,billboard:!1,antialiasing:!0,getPosition:{type:"accessor",value:r=>r.position},getRadius:{type:"accessor",value:1},getFillColor:{type:"accessor",value:QB},getLineColor:{type:"accessor",value:QB},getLineWidth:{type:"accessor",value:1},strokeWidth:{deprecatedFor:"getLineWidth"},outline:{deprecatedFor:"stroked"},getColor:{deprecatedFor:["getFillColor","getLineColor"]}};class ck extends xC{getShaders(){return super.getShaders({vs:Ase,fs:Cse,source:Mse,modules:[FH,Cee,$H,Tse]})}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{size:3,type:"float64",fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceRadius:{size:1,transition:!0,accessor:"getRadius",defaultValue:1},instanceFillColors:{size:this.props.colorFormat.length,transition:!0,type:"unorm8",accessor:"getFillColor",defaultValue:[0,0,0,255]},instanceLineColors:{size:this.props.colorFormat.length,transition:!0,type:"unorm8",accessor:"getLineColor",defaultValue:[0,0,0,255]},instanceLineWidths:{size:1,transition:!0,accessor:"getLineWidth",defaultValue:1}})}updateState(e){super.updateState(e),e.changeFlags.extensionsChanged&&(this.state.model?.destroy(),this.state.model=this._getModel(),this.getAttributeManager().invalidateAll())}draw({uniforms:e}){const{radiusUnits:t,radiusScale:i,radiusMinPixels:n,radiusMaxPixels:a,stroked:s,filled:o,billboard:l,antialiasing:c,lineWidthUnits:f,lineWidthScale:p,lineWidthMinPixels:y,lineWidthMaxPixels:b}=this.props,S={stroked:s,filled:o,billboard:l,antialiasing:c,radiusUnits:fy[t],radiusScale:i,radiusMinPixels:n,radiusMaxPixels:a,lineWidthUnits:fy[f],lineWidthScale:p,lineWidthMinPixels:y,lineWidthMaxPixels:b},C=this.state.model;C.shaderInputs.setProps({scatterplot:S}),this.context.device.type==="webgpu"&&(C.instanceCount=this.props.data.length),C.draw(this.context.renderPass)}_getModel(){const e=this.context.device.type==="webgpu"?{depthWriteEnabled:!0,depthCompare:"less-equal"}:void 0,t=[-1,-1,0,1,-1,0,-1,1,0,1,1,0];return new hA(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),geometry:new KH({topology:"triangle-strip",attributes:{positions:{size:3,value:new Float32Array(t)}}}),isInstanced:!0,parameters:e})}}ck.defaultProps=Ese;ck.layerName="ScatterplotLayer";function pT(r,e){const t=e.length,i=r.length;if(i>0){let n=!0;for(let a=0;a<t;a++)if(r[i-t+a]!==e[a]){n=!1;break}if(n)return!1}for(let n=0;n<t;n++)r[i+n]=e[n];return!0}function JB(r,e){const t=e.length;for(let i=0;i<t;i++)r[i]=e[i]}function e4(r,e,t,i,n=[]){const a=i+e*t;for(let s=0;s<t;s++)n[s]=r[a+s];return n}function t4(r,e,t,i,n=[]){let a,s;if(t&8)a=(i[3]-r[1])/(e[1]-r[1]),s=3;else if(t&4)a=(i[1]-r[1])/(e[1]-r[1]),s=1;else if(t&2)a=(i[2]-r[0])/(e[0]-r[0]),s=2;else if(t&1)a=(i[0]-r[0])/(e[0]-r[0]),s=0;else return null;for(let o=0;o<r.length;o++)n[o]=(s&1)===o?i[s]:a*(e[o]-r[o])+r[o];return n}function mE(r,e){let t=0;return r[0]<e[0]?t|=1:r[0]>e[2]&&(t|=2),r[1]<e[1]?t|=4:r[1]>e[3]&&(t|=8),t}function Lj(r,e){const{size:t=2,broken:i=!1,gridResolution:n=10,gridOffset:a=[0,0],startIndex:s=0,endIndex:o=r.length}=e||{},l=(o-s)/t;let c=[];const f=[c],p=e4(r,0,t,s);let y,b;const S=Ise(p,n,a,[]),C=[];pT(c,p);for(let E=1;E<l;E++){for(y=e4(r,E,t,s,y),b=mE(y,S);b;){t4(p,y,b,S,C);const P=mE(C,S);P&&(t4(p,C,P,S,C),b=P),pT(c,C),JB(p,C),Pse(S,n,b),i&&c.length>t&&(c=[],f.push(c),pT(c,p)),b=mE(y,S)}pT(c,y),JB(p,y)}return i?f:f[0]}function Ise(r,e,t,i){const n=Math.floor((r[0]-t[0])/e)*e+t[0],a=Math.floor((r[1]-t[1])/e)*e+t[1];return i[0]=n,i[1]=a,i[2]=n+e,i[3]=a+e,i}function Pse(r,e,t){t&8?(r[1]+=e,r[3]+=e):t&4?(r[1]-=e,r[3]-=e):t&2?(r[0]+=e,r[2]+=e):t&1&&(r[0]-=e,r[2]-=e)}function Rse(r,e){const{size:t=2,startIndex:i=0,endIndex:n=r.length,normalize:a=!0}=e||{},s=r.slice(i,n);Dse(s,t,0,n-i);const o=Lj(s,{size:t,broken:!0,gridResolution:360,gridOffset:[-180,-180]});if(a)for(const l of o)kse(l,t);return o}function Dse(r,e,t,i){let n=r[0],a;for(let s=t;s<i;s+=e){a=r[s];const o=a-n;(o>180||o<-180)&&(a-=Math.round(o/360)*360),r[s]=n=a}}function kse(r,e){let t;const i=r.length/e;for(let a=0;a<i&&(t=r[a*e],(t+180)%360===0);a++);const n=-Math.round(t/360)*360;if(n!==0)for(let a=0;a<i;a++)r[a*e]+=n}function Lse(r,e,t,i){let n;if(Array.isArray(r[0])){const a=r.length*e;n=new Array(a);for(let s=0;s<r.length;s++)for(let o=0;o<e;o++)n[s*e+o]=r[s][o]||0}else n=r;return t?Lj(n,{size:e,gridResolution:t}):i?Rse(n,{size:e}):n}const Ose=1,Nse=2,yE=4;class Bse extends dse{constructor(e){super({...e,attributes:{positions:{size:3,padding:18,initialize:!0,type:e.fp64?Float64Array:Float32Array},segmentTypes:{size:1,type:Uint8ClampedArray}}})}get(e){return this.attributes[e]}getGeometryFromBuffer(e){return this.normalize?super.getGeometryFromBuffer(e):null}normalizeGeometry(e){return this.normalize?Lse(e,this.positionSize,this.opts.resolution,this.opts.wrapLongitude):e}getGeometrySize(e){if(r4(e)){let i=0;for(const n of e)i+=this.getGeometrySize(n);return i}const t=this.getPathLength(e);return t<2?0:this.isClosed(e)?t<3?0:t+2:t}updateGeometryAttributes(e,t){if(t.geometrySize!==0)if(e&&r4(e))for(const i of e){const n=this.getGeometrySize(i);t.geometrySize=n,this.updateGeometryAttributes(i,t),t.vertexStart+=n}else this._updateSegmentTypes(e,t),this._updatePositions(e,t)}_updateSegmentTypes(e,t){const i=this.attributes.segmentTypes,n=e?this.isClosed(e):!1,{vertexStart:a,geometrySize:s}=t;i.fill(0,a,a+s),n?(i[a]=yE,i[a+s-2]=yE):(i[a]+=Ose,i[a+s-2]+=Nse),i[a+s-1]=yE}_updatePositions(e,t){const{positions:i}=this.attributes;if(!i||!e)return;const{vertexStart:n,geometrySize:a}=t,s=new Array(3);for(let o=n,l=0;l<a;o++,l++)this.getPointOnPath(e,l,s),i[o*3]=s[0],i[o*3+1]=s[1],i[o*3+2]=s[2]}getPathLength(e){return e.length/this.positionSize}getPointOnPath(e,t,i=[]){const{positionSize:n}=this;t*n>=e.length&&(t+=1-e.length/n);const a=t*n;return i[0]=e[a],i[1]=e[a+1],i[2]=n===3&&e[a+2]||0,i}isClosed(e){if(!this.normalize)return!!this.opts.loop;const{positionSize:t}=this,i=e.length-t;return e[0]===e[i]&&e[1]===e[i+1]&&(t===2||e[2]===e[i+2])}}function r4(r){return Array.isArray(r[0])}const i4=`uniform pathUniforms {
  float widthScale;
  float widthMinPixels;
  float widthMaxPixels;
  float jointType;
  float capType;
  float miterLimit;
  bool billboard;
  highp int widthUnits;
} path;
`,zse={name:"path",vs:i4,fs:i4,uniformTypes:{widthScale:"f32",widthMinPixels:"f32",widthMaxPixels:"f32",jointType:"f32",capType:"f32",miterLimit:"f32",billboard:"f32",widthUnits:"i32"}},Fse=`#version 300 es
#define SHADER_NAME path-layer-vertex-shader
in vec2 positions;
in float instanceTypes;
in vec3 instanceStartPositions;
in vec3 instanceEndPositions;
in vec3 instanceLeftPositions;
in vec3 instanceRightPositions;
in vec3 instanceLeftPositions64Low;
in vec3 instanceStartPositions64Low;
in vec3 instanceEndPositions64Low;
in vec3 instanceRightPositions64Low;
in float instanceStrokeWidths;
in vec4 instanceColors;
in vec3 instancePickingColors;
uniform float opacity;
out vec4 vColor;
out vec2 vCornerOffset;
out float vMiterLength;
out vec2 vPathPosition;
out float vPathLength;
out float vJointType;
const float EPSILON = 0.001;
const vec3 ZERO_OFFSET = vec3(0.0);
float flipIfTrue(bool flag) {
return -(float(flag) * 2. - 1.);
}
vec3 getLineJoinOffset(
vec3 prevPoint, vec3 currPoint, vec3 nextPoint,
vec2 width
) {
bool isEnd = positions.x > 0.0;
float sideOfPath = positions.y;
float isJoint = float(sideOfPath == 0.0);
vec3 deltaA3 = (currPoint - prevPoint);
vec3 deltaB3 = (nextPoint - currPoint);
mat3 rotationMatrix;
bool needsRotation = !path.billboard && project_needs_rotation(currPoint, rotationMatrix);
if (needsRotation) {
deltaA3 = deltaA3 * rotationMatrix;
deltaB3 = deltaB3 * rotationMatrix;
}
vec2 deltaA = deltaA3.xy / width;
vec2 deltaB = deltaB3.xy / width;
float lenA = length(deltaA);
float lenB = length(deltaB);
vec2 dirA = lenA > 0. ? normalize(deltaA) : vec2(0.0, 0.0);
vec2 dirB = lenB > 0. ? normalize(deltaB) : vec2(0.0, 0.0);
vec2 perpA = vec2(-dirA.y, dirA.x);
vec2 perpB = vec2(-dirB.y, dirB.x);
vec2 tangent = dirA + dirB;
tangent = length(tangent) > 0. ? normalize(tangent) : perpA;
vec2 miterVec = vec2(-tangent.y, tangent.x);
vec2 dir = isEnd ? dirA : dirB;
vec2 perp = isEnd ? perpA : perpB;
float L = isEnd ? lenA : lenB;
float sinHalfA = abs(dot(miterVec, perp));
float cosHalfA = abs(dot(dirA, miterVec));
float turnDirection = flipIfTrue(dirA.x * dirB.y >= dirA.y * dirB.x);
float cornerPosition = sideOfPath * turnDirection;
float miterSize = 1.0 / max(sinHalfA, EPSILON);
miterSize = mix(
min(miterSize, max(lenA, lenB) / max(cosHalfA, EPSILON)),
miterSize,
step(0.0, cornerPosition)
);
vec2 offsetVec = mix(miterVec * miterSize, perp, step(0.5, cornerPosition))
* (sideOfPath + isJoint * turnDirection);
bool isStartCap = lenA == 0.0 || (!isEnd && (instanceTypes == 1.0 || instanceTypes == 3.0));
bool isEndCap = lenB == 0.0 || (isEnd && (instanceTypes == 2.0 || instanceTypes == 3.0));
bool isCap = isStartCap || isEndCap;
if (isCap) {
offsetVec = mix(perp * sideOfPath, dir * path.capType * 4.0 * flipIfTrue(isStartCap), isJoint);
vJointType = path.capType;
} else {
vJointType = path.jointType;
}
vPathLength = L;
vCornerOffset = offsetVec;
vMiterLength = dot(vCornerOffset, miterVec * turnDirection);
vMiterLength = isCap ? isJoint : vMiterLength;
vec2 offsetFromStartOfPath = vCornerOffset + deltaA * float(isEnd);
vPathPosition = vec2(
dot(offsetFromStartOfPath, perp),
dot(offsetFromStartOfPath, dir)
);
geometry.uv = vPathPosition;
float isValid = step(instanceTypes, 3.5);
vec3 offset = vec3(offsetVec * width * isValid, 0.0);
if (needsRotation) {
offset = rotationMatrix * offset;
}
return offset;
}
void clipLine(inout vec4 position, vec4 refPosition) {
if (position.w < EPSILON) {
float r = (EPSILON - refPosition.w) / (position.w - refPosition.w);
position = refPosition + (position - refPosition) * r;
}
}
void main() {
geometry.pickingColor = instancePickingColors;
vColor = vec4(instanceColors.rgb, instanceColors.a * layer.opacity);
float isEnd = positions.x;
vec3 prevPosition = mix(instanceLeftPositions, instanceStartPositions, isEnd);
vec3 prevPosition64Low = mix(instanceLeftPositions64Low, instanceStartPositions64Low, isEnd);
vec3 currPosition = mix(instanceStartPositions, instanceEndPositions, isEnd);
vec3 currPosition64Low = mix(instanceStartPositions64Low, instanceEndPositions64Low, isEnd);
vec3 nextPosition = mix(instanceEndPositions, instanceRightPositions, isEnd);
vec3 nextPosition64Low = mix(instanceEndPositions64Low, instanceRightPositions64Low, isEnd);
geometry.worldPosition = currPosition;
vec2 widthPixels = vec2(clamp(
project_size_to_pixel(instanceStrokeWidths * path.widthScale, path.widthUnits),
path.widthMinPixels, path.widthMaxPixels) / 2.0);
vec3 width;
if (path.billboard) {
vec4 prevPositionScreen = project_position_to_clipspace(prevPosition, prevPosition64Low, ZERO_OFFSET);
vec4 currPositionScreen = project_position_to_clipspace(currPosition, currPosition64Low, ZERO_OFFSET, geometry.position);
vec4 nextPositionScreen = project_position_to_clipspace(nextPosition, nextPosition64Low, ZERO_OFFSET);
clipLine(prevPositionScreen, currPositionScreen);
clipLine(nextPositionScreen, currPositionScreen);
clipLine(currPositionScreen, mix(nextPositionScreen, prevPositionScreen, isEnd));
width = vec3(widthPixels, 0.0);
DECKGL_FILTER_SIZE(width, geometry);
vec3 offset = getLineJoinOffset(
prevPositionScreen.xyz / prevPositionScreen.w,
currPositionScreen.xyz / currPositionScreen.w,
nextPositionScreen.xyz / nextPositionScreen.w,
project_pixel_size_to_clipspace(width.xy)
);
DECKGL_FILTER_GL_POSITION(currPositionScreen, geometry);
gl_Position = vec4(currPositionScreen.xyz + offset * currPositionScreen.w, currPositionScreen.w);
} else {
prevPosition = project_position(prevPosition, prevPosition64Low);
currPosition = project_position(currPosition, currPosition64Low);
nextPosition = project_position(nextPosition, nextPosition64Low);
width = vec3(project_pixel_size(widthPixels), 0.0);
DECKGL_FILTER_SIZE(width, geometry);
vec3 offset = getLineJoinOffset(prevPosition, currPosition, nextPosition, width.xy);
geometry.position = vec4(currPosition + offset, 1.0);
gl_Position = project_common_position_to_clipspace(geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
}
DECKGL_FILTER_COLOR(vColor, geometry);
}
`,Vse=`#version 300 es
#define SHADER_NAME path-layer-fragment-shader
precision highp float;
in vec4 vColor;
in vec2 vCornerOffset;
in float vMiterLength;
in vec2 vPathPosition;
in float vPathLength;
in float vJointType;
out vec4 fragColor;
void main(void) {
geometry.uv = vPathPosition;
if (vPathPosition.y < 0.0 || vPathPosition.y > vPathLength) {
if (vJointType > 0.5 && length(vCornerOffset) > 1.0) {
discard;
}
if (vJointType < 0.5 && vMiterLength > path.miterLimit + 1.0) {
discard;
}
}
fragColor = vColor;
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,Oj=[0,0,0,255],Use={widthUnits:"meters",widthScale:{type:"number",min:0,value:1},widthMinPixels:{type:"number",min:0,value:0},widthMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},jointRounded:!1,capRounded:!1,miterLimit:{type:"number",min:0,value:4},billboard:!1,_pathType:null,getPath:{type:"accessor",value:r=>r.path},getColor:{type:"accessor",value:Oj},getWidth:{type:"accessor",value:1},rounded:{deprecatedFor:["jointRounded","capRounded"]}},_E={enter:(r,e)=>e.length?e.subarray(e.length-r.length):r};class hk extends xC{getShaders(){return super.getShaders({vs:Fse,fs:Vse,modules:[FH,$H,zse]})}get wrapLongitude(){return!1}getBounds(){return this.getAttributeManager()?.getBounds(["vertexPositions"])}initializeState(){this.getAttributeManager().addInstanced({vertexPositions:{size:3,vertexOffset:1,type:"float64",fp64:this.use64bitPositions(),transition:_E,accessor:"getPath",update:this.calculatePositions,noAlloc:!0,shaderAttributes:{instanceLeftPositions:{vertexOffset:0},instanceStartPositions:{vertexOffset:1},instanceEndPositions:{vertexOffset:2},instanceRightPositions:{vertexOffset:3}}},instanceTypes:{size:1,type:"uint8",update:this.calculateSegmentTypes,noAlloc:!0},instanceStrokeWidths:{size:1,accessor:"getWidth",transition:_E,defaultValue:1},instanceColors:{size:this.props.colorFormat.length,type:"unorm8",accessor:"getColor",transition:_E,defaultValue:Oj},instancePickingColors:{size:4,type:"uint8",accessor:(i,{index:n,target:a})=>this.encodePickingColor(i&&i.__source?i.__source.index:n,a)}}),this.setState({pathTesselator:new Bse({fp64:this.use64bitPositions()})})}updateState(e){super.updateState(e);const{props:t,changeFlags:i}=e,n=this.getAttributeManager();if(i.dataChanged||i.updateTriggersChanged&&(i.updateTriggersChanged.all||i.updateTriggersChanged.getPath)){const{pathTesselator:s}=this.state,o=t.data.attributes||{};s.updateGeometry({data:t.data,geometryBuffer:o.getPath,buffers:o,normalize:!t._pathType,loop:t._pathType==="loop",getGeometry:t.getPath,positionFormat:t.positionFormat,wrapLongitude:t.wrapLongitude,resolution:this.context.viewport.resolution,dataChanged:i.dataChanged}),this.setState({numInstances:s.instanceCount,startIndices:s.vertexStarts}),i.dataChanged||n.invalidateAll()}i.extensionsChanged&&(this.state.model?.destroy(),this.state.model=this._getModel(),n.invalidateAll())}getPickingInfo(e){const t=super.getPickingInfo(e),{index:i}=t,n=this.props.data;return n[0]&&n[0].__source&&(t.object=n.find(a=>a.__source.index===i)),t}disablePickingIndex(e){const t=this.props.data;if(t[0]&&t[0].__source)for(let i=0;i<t.length;i++)t[i].__source.index===e&&this._disablePickingIndex(i);else super.disablePickingIndex(e)}draw({uniforms:e}){const{jointRounded:t,capRounded:i,billboard:n,miterLimit:a,widthUnits:s,widthScale:o,widthMinPixels:l,widthMaxPixels:c}=this.props,f=this.state.model,p={jointType:Number(t),capType:Number(i),billboard:n,widthUnits:fy[s],widthScale:o,miterLimit:a,widthMinPixels:l,widthMaxPixels:c};f.shaderInputs.setProps({path:p}),f.draw(this.context.renderPass)}_getModel(){const e=[0,1,2,1,4,2,1,3,4,3,5,4],t=[0,0,0,-1,0,1,1,-1,1,1,1,0];return new hA(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),geometry:new KH({topology:"triangle-list",attributes:{indices:new Uint16Array(e),positions:{value:new Float32Array(t),size:2}}}),isInstanced:!0})}calculatePositions(e){const{pathTesselator:t}=this.state;e.startIndices=t.vertexStarts,e.value=t.get("positions")}calculateSegmentTypes(e){const{pathTesselator:t}=this.state;e.startIndices=t.vertexStarts,e.value=t.get("segmentTypes")}}hk.defaultProps=Use;hk.layerName="PathLayer";const Hse=({defaultCoords:r=[40.4168,-3.7038],markers:e=[],className:t="",selectedTrack:i,hoverPosition:n,onMarkerClick:a})=>{const s=so.useRef(null),o=so.useRef(null),l=so.useRef([]),c=so.useRef(null);return so.useEffect(()=>(s.current&&!o.current&&(async()=>{const p="OmQbtPBBXew0rigc1ltu",y={version:8,sources:{osm:{type:"raster",tiles:["https://a.tile.openstreetmap.org/{z}/{x}/{y}.png","https://b.tile.openstreetmap.org/{z}/{x}/{y}.png","https://c.tile.openstreetmap.org/{z}/{x}/{y}.png"],tileSize:256,attribution:"© OpenStreetMap contributors"}},layers:[{id:"osm",type:"raster",source:"osm",minzoom:0,maxzoom:19}]};let b=y;try{const E=await(await fetch(`https://api.maptiler.com/maps/hybrid/style.json?key=${p}`)).json();E.layers=(E.layers||[]).filter(P=>P.type!=="sky"&&P.id!=="sky"),b=E}catch{b=y}const S=new KS.Map({container:s.current,style:b,center:[r[1],r[0]],zoom:6});S.on("load",()=>{S.getSource("terrain")||S.addSource("terrain",{type:"raster-dem",url:`https://api.maptiler.com/tiles/terrain-rgb-v2/tiles.json?key=${p}`,tileSize:256}),S.setTerrain({source:"terrain",exaggeration:1.2})}),o.current=S})(),()=>{o.current&&(o.current.remove(),o.current=null)}),[]),so.useEffect(()=>{if(o.current&&(l.current.forEach(f=>{f.remove()}),l.current=[],e.forEach(f=>{const{lat:p,lng:y,color:b="blue",name:S}=f,C=document.createElement("div");C.style.display="flex",C.style.flexDirection="column",C.style.alignItems="center",C.style.position="absolute",C.style.transform="translate(-50%, -100%)",C.style.pointerEvents="none";const E=document.createElement("div");if(E.style.backgroundColor=b,E.style.width="20px",E.style.height="20px",E.style.borderRadius="50%",E.style.border="2px solid white",E.style.boxShadow="0 2px 4px rgba(0,0,0,0.3)",E.style.position="relative",E.style.pointerEvents="auto",E.style.cursor="pointer",a&&E.addEventListener("click",O=>{O.stopPropagation(),a(f)}),C.appendChild(E),S){const O=document.createElement("div");O.textContent=S,O.style.backgroundColor="rgba(255, 255, 255, 0.9)",O.style.color="#333",O.style.padding="4px 8px",O.style.borderRadius="4px",O.style.fontSize="12px",O.style.fontWeight="500",O.style.whiteSpace="nowrap",O.style.boxShadow="0 2px 4px rgba(0,0,0,0.2)",O.style.marginTop="4px",O.style.border="1px solid rgba(0,0,0,0.1)",O.style.maxWidth="150px",O.style.overflow="hidden",O.style.textOverflow="ellipsis",O.style.position="relative",O.style.pointerEvents="auto",C.appendChild(O)}const P=new KS.Marker({element:C}).setLngLat([y,p]).addTo(o.current);l.current.push(P)}),e.length>0))if(e.length===1){const{lat:p,lng:y}=e[0];o.current.easeTo({center:[y,p],zoom:15})}else{const p=new KS.LngLatBounds;e.forEach(({lat:P,lng:O})=>p.extend([O,P]));const y=p.getNorthEast(),b=p.getSouthWest(),S=Math.abs(y.lat-b.lat),C=Math.abs(y.lng-b.lng);if(S<.01&&C<.01){const P=e.reduce((B,F)=>({lat:B.lat+F.lat,lng:B.lng+F.lng}),{lat:0,lng:0}),O=[P.lng/e.length,P.lat/e.length];o.current.easeTo({center:O,zoom:15})}else o.current.fitBounds(p,{padding:40,maxZoom:15})}},[e]),so.useEffect(()=>{const f=o.current;if(!f)return;if(!i||i.length===0){if(c.current){try{c.current.setProps({layers:[]}),f.removeControl(c.current)}catch{}c.current=null}return}const p=()=>{const y=i.some(P=>typeof P.alt=="number"),b=i.map(P=>{const O=f.queryTerrainElevation([P.lng,P.lat])||0,B=(P.alt||0)+O;return{...P,alt:B}}),S=[];if(y){const P=new hk({id:"deckgl-selected-track-path",data:[b],getPath:O=>O.map(B=>[B.lng,B.lat,B.alt||0]),getWidth:4,widthUnits:"pixels",getColor:[255,85,0,255],parameters:{depthTest:!0}});S.push(P)}if(n&&y&&n.index<b.length){const P=b[n.index];if(P){const O=new ck({id:"deckgl-hover-point",data:[P],getPosition:B=>[B.lng,B.lat,B.alt||0],getRadius:8,getFillColor:[255,0,0,255],getLineColor:[255,255,255,255],getLineWidth:3,radiusUnits:"pixels",parameters:{depthTest:!0}});S.push(O)}}const C=Sse;if(S.length>0)c.current?c.current.setProps({layers:S}):(c.current=new C({layers:S}),f.addControl(c.current));else if(c.current){try{c.current.setProps({layers:[]}),f.removeControl(c.current)}catch{}c.current=null}const E=new KS.LngLatBounds;i.forEach(P=>E.extend([P.lng,P.lat])),f.fitBounds(E,{padding:40})};f.isStyleLoaded()?p():f.once("load",p)},[i,n]),pn.jsx("div",{ref:s,className:t})},jse=({fileName:r,color:e,trackPoints:t,location:i,onSelect:n,processing:a,isSelected:s=!1})=>pn.jsxs("div",{className:`mission-card ${s?"selected":""}`,onClick:n,children:[pn.jsxs("div",{className:"mission-card-header",children:[pn.jsx("div",{className:"mission-color-indicator",style:{backgroundColor:e}}),pn.jsx("span",{className:"mission-file-name",children:r}),a&&pn.jsx("i",{className:"fa-solid fa-spinner fa-spin loading-icon","aria-label":"Procesando"})]}),pn.jsx("div",{className:"mission-card-info",children:pn.jsxs("span",{className:"marker-count",children:[t.lat.length," puntos GPS"]})}),i&&pn.jsx("div",{className:"mission-location",children:pn.jsx("span",{className:"location-text",children:i})})]});/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */var AR=function(r,e){return AR=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,i){t.__proto__=i}||function(t,i){for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(t[n]=i[n])},AR(r,e)};function Ye(r,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");AR(r,e);function t(){this.constructor=r}r.prototype=e===null?Object.create(e):(t.prototype=e.prototype,new t)}var CR=function(){return CR=Object.assign||function(e){for(var t,i=1,n=arguments.length;i<n;i++){t=arguments[i];for(var a in t)Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a])}return e},CR.apply(this,arguments)},$se=(function(){function r(){this.firefox=!1,this.ie=!1,this.edge=!1,this.newEdge=!1,this.weChat=!1}return r})(),Wse=(function(){function r(){this.browser=new $se,this.node=!1,this.wxa=!1,this.worker=!1,this.svgSupported=!1,this.touchEventsSupported=!1,this.pointerEventsSupported=!1,this.domSupported=!1,this.transformSupported=!1,this.transform3dSupported=!1,this.hasGlobalWindow=typeof window<"u"}return r})(),Gr=new Wse;typeof wx=="object"&&typeof wx.getSystemInfoSync=="function"?(Gr.wxa=!0,Gr.touchEventsSupported=!0):typeof document>"u"&&typeof self<"u"?Gr.worker=!0:!Gr.hasGlobalWindow||"Deno"in window?(Gr.node=!0,Gr.svgSupported=!0):Gse(navigator.userAgent,Gr);function Gse(r,e){var t=e.browser,i=r.match(/Firefox\/([\d.]+)/),n=r.match(/MSIE\s([\d.]+)/)||r.match(/Trident\/.+?rv:(([\d.]+))/),a=r.match(/Edge?\/([\d.]+)/),s=/micromessenger/i.test(r);i&&(t.firefox=!0,t.version=i[1]),n&&(t.ie=!0,t.version=n[1]),a&&(t.edge=!0,t.version=a[1],t.newEdge=+a[1].split(".")[0]>18),s&&(t.weChat=!0),e.svgSupported=typeof SVGRect<"u",e.touchEventsSupported="ontouchstart"in window&&!t.ie&&!t.edge,e.pointerEventsSupported="onpointerdown"in window&&(t.edge||t.ie&&+t.version>=11),e.domSupported=typeof document<"u";var o=document.documentElement.style;e.transform3dSupported=(t.ie&&"transition"in o||t.edge||"WebKitCSSMatrix"in window&&"m11"in new WebKitCSSMatrix||"MozPerspective"in o)&&!("OTransition"in o),e.transformSupported=e.transform3dSupported||t.ie&&+t.version>=9}var fk=12,Nj="sans-serif",Ug=fk+"px "+Nj,Xse=20,Zse=100,qse="007LLmW'55;N0500LLLLLLLLLL00NNNLzWW\\\\WQb\\0FWLg\\bWb\\WQ\\WrWWQ000CL5LLFLL0LL**F*gLLLL5F0LF\\FFF5.5N";function Yse(r){var e={};if(typeof JSON>"u")return e;for(var t=0;t<r.length;t++){var i=String.fromCharCode(t+32),n=(r.charCodeAt(t)-Xse)/Zse;e[i]=n}return e}var Kse=Yse(qse),Ih={createCanvas:function(){return typeof document<"u"&&document.createElement("canvas")},measureText:(function(){var r,e;return function(t,i){if(!r){var n=Ih.createCanvas();r=n&&n.getContext("2d")}if(r)return e!==i&&(e=r.font=i||Ug),r.measureText(t);t=t||"",i=i||Ug;var a=/((?:\d+)?\.?\d*)px/.exec(i),s=a&&+a[1]||fk,o=0;if(i.indexOf("mono")>=0)o=s*t.length;else for(var l=0;l<t.length;l++){var c=Kse[t[l]];o+=c==null?s:c*s}return{width:o}}})(),loadImage:function(r,e,t){var i=new Image;return i.onload=e,i.onerror=t,i.src=r,i}};function Bj(r){for(var e in Ih)r[e]&&(Ih[e]=r[e])}var zj=Sc(["Function","RegExp","Date","Error","CanvasGradient","CanvasPattern","Image","Canvas"],function(r,e){return r["[object "+e+"]"]=!0,r},{}),Fj=Sc(["Int8","Uint8","Uint8Clamped","Int16","Uint16","Int32","Uint32","Float32","Float64"],function(r,e){return r["[object "+e+"Array]"]=!0,r},{}),nb=Object.prototype.toString,wC=Array.prototype,Qse=wC.forEach,Jse=wC.filter,dk=wC.slice,ele=wC.map,n4=(function(){}).constructor,gT=n4?n4.prototype:null,pk="__proto__",tle=2311;function gk(){return tle++}function SC(){for(var r=[],e=0;e<arguments.length;e++)r[e]=arguments[e];typeof console<"u"&&console.error.apply(console,r)}function hr(r){if(r==null||typeof r!="object")return r;var e=r,t=nb.call(r);if(t==="[object Array]"){if(!C0(r)){e=[];for(var i=0,n=r.length;i<n;i++)e[i]=hr(r[i])}}else if(Fj[t]){if(!C0(r)){var a=r.constructor;if(a.from)e=a.from(r);else{e=new a(r.length);for(var i=0,n=r.length;i<n;i++)e[i]=r[i]}}}else if(!zj[t]&&!C0(r)&&!gy(r)){e={};for(var s in r)r.hasOwnProperty(s)&&s!==pk&&(e[s]=hr(r[s]))}return e}function Cr(r,e,t){if(!cr(e)||!cr(r))return t?hr(e):r;for(var i in e)if(e.hasOwnProperty(i)&&i!==pk){var n=r[i],a=e[i];cr(a)&&cr(n)&&!xt(a)&&!xt(n)&&!gy(a)&&!gy(n)&&!MR(a)&&!MR(n)&&!C0(a)&&!C0(n)?Cr(n,a,t):(t||!(i in r))&&(r[i]=hr(e[i]))}return r}function TC(r,e){for(var t=r[0],i=1,n=r.length;i<n;i++)t=Cr(t,r[i],e);return t}function mt(r,e){if(Object.assign)Object.assign(r,e);else for(var t in e)e.hasOwnProperty(t)&&t!==pk&&(r[t]=e[t]);return r}function lr(r,e,t){for(var i=qr(e),n=0,a=i.length;n<a;n++){var s=i[n];(t?e[s]!=null:r[s]==null)&&(r[s]=e[s])}return r}var rle=Ih.createCanvas;function Or(r,e){if(r){if(r.indexOf)return r.indexOf(e);for(var t=0,i=r.length;t<i;t++)if(r[t]===e)return t}return-1}function vk(r,e){var t=r.prototype;function i(){}i.prototype=e.prototype,r.prototype=new i;for(var n in t)t.hasOwnProperty(n)&&(r.prototype[n]=t[n]);r.prototype.constructor=r,r.superClass=e}function ha(r,e,t){if(r="prototype"in r?r.prototype:r,e="prototype"in e?e.prototype:e,Object.getOwnPropertyNames)for(var i=Object.getOwnPropertyNames(e),n=0;n<i.length;n++){var a=i[n];a!=="constructor"&&(t?e[a]!=null:r[a]==null)&&(r[a]=e[a])}else lr(r,e,t)}function es(r){return!r||typeof r=="string"?!1:typeof r.length=="number"}function se(r,e,t){if(r&&e)if(r.forEach&&r.forEach===Qse)r.forEach(e,t);else if(r.length===+r.length)for(var i=0,n=r.length;i<n;i++)e.call(t,r[i],i,r);else for(var a in r)r.hasOwnProperty(a)&&e.call(t,r[a],a,r)}function wt(r,e,t){if(!r)return[];if(!e)return AC(r);if(r.map&&r.map===ele)return r.map(e,t);for(var i=[],n=0,a=r.length;n<a;n++)i.push(e.call(t,r[n],n,r));return i}function Sc(r,e,t,i){if(r&&e){for(var n=0,a=r.length;n<a;n++)t=e.call(i,t,r[n],n,r);return t}}function wi(r,e,t){if(!r)return[];if(!e)return AC(r);if(r.filter&&r.filter===Jse)return r.filter(e,t);for(var i=[],n=0,a=r.length;n<a;n++)e.call(t,r[n],n,r)&&i.push(r[n]);return i}function Vj(r,e,t){if(r&&e){for(var i=0,n=r.length;i<n;i++)if(e.call(t,r[i],i,r))return r[i]}}function qr(r){if(!r)return[];if(Object.keys)return Object.keys(r);var e=[];for(var t in r)r.hasOwnProperty(t)&&e.push(t);return e}function ile(r,e){for(var t=[],i=2;i<arguments.length;i++)t[i-2]=arguments[i];return function(){return r.apply(e,t.concat(dk.call(arguments)))}}var Xt=gT&&sr(gT.bind)?gT.call.bind(gT.bind):ile;function Sr(r){for(var e=[],t=1;t<arguments.length;t++)e[t-1]=arguments[t];return function(){return r.apply(this,e.concat(dk.call(arguments)))}}function xt(r){return Array.isArray?Array.isArray(r):nb.call(r)==="[object Array]"}function sr(r){return typeof r=="function"}function $t(r){return typeof r=="string"}function pA(r){return nb.call(r)==="[object String]"}function di(r){return typeof r=="number"}function cr(r){var e=typeof r;return e==="function"||!!r&&e==="object"}function MR(r){return!!zj[nb.call(r)]}function sl(r){return!!Fj[nb.call(r)]}function gy(r){return typeof r=="object"&&typeof r.nodeType=="number"&&typeof r.ownerDocument=="object"}function Uw(r){return r.colorStops!=null}function Uj(r){return r.image!=null}function Hj(r){return nb.call(r)==="[object RegExp]"}function j0(r){return r!==r}function uo(){for(var r=[],e=0;e<arguments.length;e++)r[e]=arguments[e];for(var t=0,i=r.length;t<i;t++)if(r[t]!=null)return r[t]}function wr(r,e){return r??e}function Th(r,e,t){return r??e??t}function AC(r){for(var e=[],t=1;t<arguments.length;t++)e[t-1]=arguments[t];return dk.apply(r,e)}function CC(r){if(typeof r=="number")return[r,r,r,r];var e=r.length;return e===2?[r[0],r[1],r[0],r[1]]:e===3?[r[0],r[1],r[2],r[1]]:r}function Is(r,e){if(!r)throw new Error(e)}function mc(r){return r==null?null:typeof r.trim=="function"?r.trim():r.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"")}var jj="__ec_primitive__";function ow(r){r[jj]=!0}function C0(r){return r[jj]}var nle=(function(){function r(){this.data={}}return r.prototype.delete=function(e){var t=this.has(e);return t&&delete this.data[e],t},r.prototype.has=function(e){return this.data.hasOwnProperty(e)},r.prototype.get=function(e){return this.data[e]},r.prototype.set=function(e,t){return this.data[e]=t,this},r.prototype.keys=function(){return qr(this.data)},r.prototype.forEach=function(e){var t=this.data;for(var i in t)t.hasOwnProperty(i)&&e(t[i],i)},r})(),$j=typeof Map=="function";function ale(){return $j?new Map:new nle}var Wj=(function(){function r(e){var t=xt(e);this.data=ale();var i=this;e instanceof r?e.each(n):e&&se(e,n);function n(a,s){t?i.set(a,s):i.set(s,a)}}return r.prototype.hasKey=function(e){return this.data.has(e)},r.prototype.get=function(e){return this.data.get(e)},r.prototype.set=function(e,t){return this.data.set(e,t),t},r.prototype.each=function(e,t){this.data.forEach(function(i,n){e.call(t,i,n)})},r.prototype.keys=function(){var e=this.data.keys();return $j?Array.from(e):e},r.prototype.removeKey=function(e){this.data.delete(e)},r})();function Qt(r){return new Wj(r)}function $0(r,e){for(var t=new r.constructor(r.length+e.length),i=0;i<r.length;i++)t[i]=r[i];for(var n=r.length,i=0;i<e.length;i++)t[i+n]=e[i];return t}function Hw(r,e){var t;if(Object.create)t=Object.create(r);else{var i=function(){};i.prototype=r,t=new i}return e&&mt(t,e),t}function mk(r){var e=r.style;e.webkitUserSelect="none",e.userSelect="none",e.webkitTapHighlightColor="rgba(0,0,0,0)",e["-webkit-touch-callout"]="none"}function Yt(r,e){return r.hasOwnProperty(e)}function ca(){}var O1=180/Math.PI;const ole=Object.freeze(Object.defineProperty({__proto__:null,HashMap:Wj,RADIAN_TO_DEGREE:O1,assert:Is,bind:Xt,clone:hr,concatArray:$0,createCanvas:rle,createHashMap:Qt,createObject:Hw,curry:Sr,defaults:lr,disableUserSelect:mk,each:se,eqNaN:j0,extend:mt,filter:wi,find:Vj,guid:gk,hasOwn:Yt,indexOf:Or,inherits:vk,isArray:xt,isArrayLike:es,isBuiltInObject:MR,isDom:gy,isFunction:sr,isGradientObject:Uw,isImagePatternObject:Uj,isNumber:di,isObject:cr,isPrimitive:C0,isRegExp:Hj,isString:$t,isStringSafe:pA,isTypedArray:sl,keys:qr,logError:SC,map:wt,merge:Cr,mergeAll:TC,mixin:ha,noop:ca,normalizeCssArray:CC,reduce:Sc,retrieve:uo,retrieve2:wr,retrieve3:Th,setAsPrimitive:ow,slice:AC,trim:mc},Symbol.toStringTag,{value:"Module"}));function Xg(r,e){return r==null&&(r=0),e==null&&(e=0),[r,e]}function As(r,e){return r[0]=e[0],r[1]=e[1],r}function Bf(r){return[r[0],r[1]]}function Gj(r,e,t){return r[0]=e,r[1]=t,r}function ER(r,e,t){return r[0]=e[0]+t[0],r[1]=e[1]+t[1],r}function gA(r,e,t,i){return r[0]=e[0]+t[0]*i,r[1]=e[1]+t[1]*i,r}function Ag(r,e,t){return r[0]=e[0]-t[0],r[1]=e[1]-t[1],r}function sw(r){return Math.sqrt(yk(r))}var sle=sw;function yk(r){return r[0]*r[0]+r[1]*r[1]}var lle=yk;function ule(r,e,t){return r[0]=e[0]*t[0],r[1]=e[1]*t[1],r}function cle(r,e,t){return r[0]=e[0]/t[0],r[1]=e[1]/t[1],r}function hle(r,e){return r[0]*e[0]+r[1]*e[1]}function N1(r,e,t){return r[0]=e[0]*t,r[1]=e[1]*t,r}function My(r,e){var t=sw(e);return t===0?(r[0]=0,r[1]=0):(r[0]=e[0]/t,r[1]=e[1]/t),r}function vA(r,e){return Math.sqrt((r[0]-e[0])*(r[0]-e[0])+(r[1]-e[1])*(r[1]-e[1]))}var tp=vA;function Xj(r,e){return(r[0]-e[0])*(r[0]-e[0])+(r[1]-e[1])*(r[1]-e[1])}var kg=Xj;function fle(r,e){return r[0]=-e[0],r[1]=-e[1],r}function B1(r,e,t,i){return r[0]=e[0]+i*(t[0]-e[0]),r[1]=e[1]+i*(t[1]-e[1]),r}function Ro(r,e,t){var i=e[0],n=e[1];return r[0]=t[0]*i+t[2]*n+t[4],r[1]=t[1]*i+t[3]*n+t[5],r}function rp(r,e,t){return r[0]=Math.min(e[0],t[0]),r[1]=Math.min(e[1],t[1]),r}function ip(r,e,t){return r[0]=Math.max(e[0],t[0]),r[1]=Math.max(e[1],t[1]),r}const dle=Object.freeze(Object.defineProperty({__proto__:null,add:ER,applyTransform:Ro,clone:Bf,copy:As,create:Xg,dist:tp,distSquare:kg,distance:vA,distanceSquare:Xj,div:cle,dot:hle,len:sw,lenSquare:yk,length:sle,lengthSquare:lle,lerp:B1,max:ip,min:rp,mul:ule,negate:fle,normalize:My,scale:N1,scaleAndAdd:gA,set:Gj,sub:Ag},Symbol.toStringTag,{value:"Module"}));var z_=(function(){function r(e,t){this.target=e,this.topTarget=t&&t.topTarget}return r})(),ple=(function(){function r(e){this.handler=e,e.on("mousedown",this._dragStart,this),e.on("mousemove",this._drag,this),e.on("mouseup",this._dragEnd,this)}return r.prototype._dragStart=function(e){for(var t=e.target;t&&!t.draggable;)t=t.parent||t.__hostTarget;t&&(this._draggingTarget=t,t.dragging=!0,this._x=e.offsetX,this._y=e.offsetY,this.handler.dispatchToElement(new z_(t,e),"dragstart",e.event))},r.prototype._drag=function(e){var t=this._draggingTarget;if(t){var i=e.offsetX,n=e.offsetY,a=i-this._x,s=n-this._y;this._x=i,this._y=n,t.drift(a,s,e),this.handler.dispatchToElement(new z_(t,e),"drag",e.event);var o=this.handler.findHover(i,n,t).target,l=this._dropTarget;this._dropTarget=o,t!==o&&(l&&o!==l&&this.handler.dispatchToElement(new z_(l,e),"dragleave",e.event),o&&o!==l&&this.handler.dispatchToElement(new z_(o,e),"dragenter",e.event))}},r.prototype._dragEnd=function(e){var t=this._draggingTarget;t&&(t.dragging=!1),this.handler.dispatchToElement(new z_(t,e),"dragend",e.event),this._dropTarget&&this.handler.dispatchToElement(new z_(this._dropTarget,e),"drop",e.event),this._draggingTarget=null,this._dropTarget=null},r})(),Cc=(function(){function r(e){e&&(this._$eventProcessor=e)}return r.prototype.on=function(e,t,i,n){this._$handlers||(this._$handlers={});var a=this._$handlers;if(typeof t=="function"&&(n=i,i=t,t=null),!i||!e)return this;var s=this._$eventProcessor;t!=null&&s&&s.normalizeQuery&&(t=s.normalizeQuery(t)),a[e]||(a[e]=[]);for(var o=0;o<a[e].length;o++)if(a[e][o].h===i)return this;var l={h:i,query:t,ctx:n||this,callAtLast:i.zrEventfulCallAtLast},c=a[e].length-1,f=a[e][c];return f&&f.callAtLast?a[e].splice(c,0,l):a[e].push(l),this},r.prototype.isSilent=function(e){var t=this._$handlers;return!t||!t[e]||!t[e].length},r.prototype.off=function(e,t){var i=this._$handlers;if(!i)return this;if(!e)return this._$handlers={},this;if(t){if(i[e]){for(var n=[],a=0,s=i[e].length;a<s;a++)i[e][a].h!==t&&n.push(i[e][a]);i[e]=n}i[e]&&i[e].length===0&&delete i[e]}else delete i[e];return this},r.prototype.trigger=function(e){for(var t=[],i=1;i<arguments.length;i++)t[i-1]=arguments[i];if(!this._$handlers)return this;var n=this._$handlers[e],a=this._$eventProcessor;if(n)for(var s=t.length,o=n.length,l=0;l<o;l++){var c=n[l];if(!(a&&a.filter&&c.query!=null&&!a.filter(e,c.query)))switch(s){case 0:c.h.call(c.ctx);break;case 1:c.h.call(c.ctx,t[0]);break;case 2:c.h.call(c.ctx,t[0],t[1]);break;default:c.h.apply(c.ctx,t);break}}return a&&a.afterTrigger&&a.afterTrigger(e),this},r.prototype.triggerWithContext=function(e){for(var t=[],i=1;i<arguments.length;i++)t[i-1]=arguments[i];if(!this._$handlers)return this;var n=this._$handlers[e],a=this._$eventProcessor;if(n)for(var s=t.length,o=t[s-1],l=n.length,c=0;c<l;c++){var f=n[c];if(!(a&&a.filter&&f.query!=null&&!a.filter(e,f.query)))switch(s){case 0:f.h.call(o);break;case 1:f.h.call(o,t[0]);break;case 2:f.h.call(o,t[0],t[1]);break;default:f.h.apply(o,t.slice(1,s-1));break}}return a&&a.afterTrigger&&a.afterTrigger(e),this},r})(),gle=Math.log(2);function IR(r,e,t,i,n,a){var s=i+"-"+n,o=r.length;if(a.hasOwnProperty(s))return a[s];if(e===1){var l=Math.round(Math.log((1<<o)-1&~n)/gle);return r[t][l]}for(var c=i|1<<t,f=t+1;i&1<<f;)f++;for(var p=0,y=0,b=0;y<o;y++){var S=1<<y;S&n||(p+=(b%2?-1:1)*r[t][y]*IR(r,e-1,f,c,n|S,a),b++)}return a[s]=p,p}function a4(r,e){var t=[[r[0],r[1],1,0,0,0,-e[0]*r[0],-e[0]*r[1]],[0,0,0,r[0],r[1],1,-e[1]*r[0],-e[1]*r[1]],[r[2],r[3],1,0,0,0,-e[2]*r[2],-e[2]*r[3]],[0,0,0,r[2],r[3],1,-e[3]*r[2],-e[3]*r[3]],[r[4],r[5],1,0,0,0,-e[4]*r[4],-e[4]*r[5]],[0,0,0,r[4],r[5],1,-e[5]*r[4],-e[5]*r[5]],[r[6],r[7],1,0,0,0,-e[6]*r[6],-e[6]*r[7]],[0,0,0,r[6],r[7],1,-e[7]*r[6],-e[7]*r[7]]],i={},n=IR(t,8,0,0,0,i);if(n!==0){for(var a=[],s=0;s<8;s++)for(var o=0;o<8;o++)a[o]==null&&(a[o]=0),a[o]+=((s+o)%2?-1:1)*IR(t,7,s===0?1:0,1<<s,1<<o,i)/n*e[s];return function(l,c,f){var p=c*a[6]+f*a[7]+1;l[0]=(c*a[0]+f*a[1]+a[2])/p,l[1]=(c*a[3]+f*a[4]+a[5])/p}}}var o4="___zrEVENTSAVED",bE=[];function vle(r,e,t,i,n){return PR(bE,e,i,n,!0)&&PR(r,t,bE[0],bE[1])}function PR(r,e,t,i,n){if(e.getBoundingClientRect&&Gr.domSupported&&!Zj(e)){var a=e[o4]||(e[o4]={}),s=mle(e,a),o=yle(s,a,n);if(o)return o(r,t,i),!0}return!1}function mle(r,e){var t=e.markers;if(t)return t;t=e.markers=[];for(var i=["left","right"],n=["top","bottom"],a=0;a<4;a++){var s=document.createElement("div"),o=s.style,l=a%2,c=(a>>1)%2;o.cssText=["position: absolute","visibility: hidden","padding: 0","margin: 0","border-width: 0","user-select: none","width:0","height:0",i[l]+":0",n[c]+":0",i[1-l]+":auto",n[1-c]+":auto",""].join("!important;"),r.appendChild(s),t.push(s)}return t}function yle(r,e,t){for(var i=t?"invTrans":"trans",n=e[i],a=e.srcCoords,s=[],o=[],l=!0,c=0;c<4;c++){var f=r[c].getBoundingClientRect(),p=2*c,y=f.left,b=f.top;s.push(y,b),l=l&&a&&y===a[p]&&b===a[p+1],o.push(r[c].offsetLeft,r[c].offsetTop)}return l&&n?n:(e.srcCoords=s,e[i]=t?a4(o,s):a4(s,o))}function Zj(r){return r.nodeName.toUpperCase()==="CANVAS"}var _le=/([&<>"'])/g,ble={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"};function Ms(r){return r==null?"":(r+"").replace(_le,function(e,t){return ble[t]})}var xle=/^(?:mouse|pointer|contextmenu|drag|drop)|click/,xE=[],wle=Gr.browser.firefox&&+Gr.browser.version.split(".")[0]<39;function RR(r,e,t,i){return t=t||{},i?s4(r,e,t):wle&&e.layerX!=null&&e.layerX!==e.offsetX?(t.zrX=e.layerX,t.zrY=e.layerY):e.offsetX!=null?(t.zrX=e.offsetX,t.zrY=e.offsetY):s4(r,e,t),t}function s4(r,e,t){if(Gr.domSupported&&r.getBoundingClientRect){var i=e.clientX,n=e.clientY;if(Zj(r)){var a=r.getBoundingClientRect();t.zrX=i-a.left,t.zrY=n-a.top;return}else if(PR(xE,r,i,n)){t.zrX=xE[0],t.zrY=xE[1];return}}t.zrX=t.zrY=0}function _k(r){return r||window.event}function uc(r,e,t){if(e=_k(e),e.zrX!=null)return e;var i=e.type,n=i&&i.indexOf("touch")>=0;if(n){var s=i!=="touchend"?e.targetTouches[0]:e.changedTouches[0];s&&RR(r,s,e,t)}else{RR(r,e,e,t);var a=Sle(e);e.zrDelta=a?a/120:-(e.detail||0)/3}var o=e.button;return e.which==null&&o!==void 0&&xle.test(e.type)&&(e.which=o&1?1:o&2?3:o&4?2:0),e}function Sle(r){var e=r.wheelDelta;if(e)return e;var t=r.deltaX,i=r.deltaY;if(t==null||i==null)return e;var n=Math.abs(i!==0?i:t),a=i>0?-1:i<0?1:t>0?-1:1;return 3*n*a}function DR(r,e,t,i){r.addEventListener(e,t,i)}function Tle(r,e,t,i){r.removeEventListener(e,t,i)}var up=function(r){r.preventDefault(),r.stopPropagation(),r.cancelBubble=!0};function l4(r){return r.which===2||r.which===3}var Ale=(function(){function r(){this._track=[]}return r.prototype.recognize=function(e,t,i){return this._doTrack(e,t,i),this._recognize(e)},r.prototype.clear=function(){return this._track.length=0,this},r.prototype._doTrack=function(e,t,i){var n=e.touches;if(n){for(var a={points:[],touches:[],target:t,event:e},s=0,o=n.length;s<o;s++){var l=n[s],c=RR(i,l,{});a.points.push([c.zrX,c.zrY]),a.touches.push(l)}this._track.push(a)}},r.prototype._recognize=function(e){for(var t in wE)if(wE.hasOwnProperty(t)){var i=wE[t](this._track,e);if(i)return i}},r})();function u4(r){var e=r[1][0]-r[0][0],t=r[1][1]-r[0][1];return Math.sqrt(e*e+t*t)}function Cle(r){return[(r[0][0]+r[1][0])/2,(r[0][1]+r[1][1])/2]}var wE={pinch:function(r,e){var t=r.length;if(t){var i=(r[t-1]||{}).points,n=(r[t-2]||{}).points||i;if(n&&n.length>1&&i&&i.length>1){var a=u4(i)/u4(n);!isFinite(a)&&(a=1),e.pinchScale=a;var s=Cle(i);return e.pinchX=s[0],e.pinchY=s[1],{type:"pinch",target:r[0].target,event:e}}}}};function kl(){return[1,0,0,1,0,0]}function jw(r){return r[0]=1,r[1]=0,r[2]=0,r[3]=1,r[4]=0,r[5]=0,r}function MC(r,e){return r[0]=e[0],r[1]=e[1],r[2]=e[2],r[3]=e[3],r[4]=e[4],r[5]=e[5],r}function zf(r,e,t){var i=e[0]*t[0]+e[2]*t[1],n=e[1]*t[0]+e[3]*t[1],a=e[0]*t[2]+e[2]*t[3],s=e[1]*t[2]+e[3]*t[3],o=e[0]*t[4]+e[2]*t[5]+e[4],l=e[1]*t[4]+e[3]*t[5]+e[5];return r[0]=i,r[1]=n,r[2]=a,r[3]=s,r[4]=o,r[5]=l,r}function Ph(r,e,t){return r[0]=e[0],r[1]=e[1],r[2]=e[2],r[3]=e[3],r[4]=e[4]+t[0],r[5]=e[5]+t[1],r}function Zg(r,e,t,i){i===void 0&&(i=[0,0]);var n=e[0],a=e[2],s=e[4],o=e[1],l=e[3],c=e[5],f=Math.sin(t),p=Math.cos(t);return r[0]=n*p+o*f,r[1]=-n*f+o*p,r[2]=a*p+l*f,r[3]=-a*f+p*l,r[4]=p*(s-i[0])+f*(c-i[1])+i[0],r[5]=p*(c-i[1])-f*(s-i[0])+i[1],r}function EC(r,e,t){var i=t[0],n=t[1];return r[0]=e[0]*i,r[1]=e[1]*n,r[2]=e[2]*i,r[3]=e[3]*n,r[4]=e[4]*i,r[5]=e[5]*n,r}function Ey(r,e){var t=e[0],i=e[2],n=e[4],a=e[1],s=e[3],o=e[5],l=t*s-a*i;return l?(l=1/l,r[0]=s*l,r[1]=-a*l,r[2]=-i*l,r[3]=t*l,r[4]=(i*o-s*n)*l,r[5]=(a*n-t*o)*l,r):null}function qj(r){var e=kl();return MC(e,r),e}const Mle=Object.freeze(Object.defineProperty({__proto__:null,clone:qj,copy:MC,create:kl,identity:jw,invert:Ey,mul:zf,rotate:Zg,scale:EC,translate:Ph},Symbol.toStringTag,{value:"Module"}));var Rr=(function(){function r(e,t){this.x=e||0,this.y=t||0}return r.prototype.copy=function(e){return this.x=e.x,this.y=e.y,this},r.prototype.clone=function(){return new r(this.x,this.y)},r.prototype.set=function(e,t){return this.x=e,this.y=t,this},r.prototype.equal=function(e){return e.x===this.x&&e.y===this.y},r.prototype.add=function(e){return this.x+=e.x,this.y+=e.y,this},r.prototype.scale=function(e){this.x*=e,this.y*=e},r.prototype.scaleAndAdd=function(e,t){this.x+=e.x*t,this.y+=e.y*t},r.prototype.sub=function(e){return this.x-=e.x,this.y-=e.y,this},r.prototype.dot=function(e){return this.x*e.x+this.y*e.y},r.prototype.len=function(){return Math.sqrt(this.x*this.x+this.y*this.y)},r.prototype.lenSquare=function(){return this.x*this.x+this.y*this.y},r.prototype.normalize=function(){var e=this.len();return this.x/=e,this.y/=e,this},r.prototype.distance=function(e){var t=this.x-e.x,i=this.y-e.y;return Math.sqrt(t*t+i*i)},r.prototype.distanceSquare=function(e){var t=this.x-e.x,i=this.y-e.y;return t*t+i*i},r.prototype.negate=function(){return this.x=-this.x,this.y=-this.y,this},r.prototype.transform=function(e){if(e){var t=this.x,i=this.y;return this.x=e[0]*t+e[2]*i+e[4],this.y=e[1]*t+e[3]*i+e[5],this}},r.prototype.toArray=function(e){return e[0]=this.x,e[1]=this.y,e},r.prototype.fromArray=function(e){this.x=e[0],this.y=e[1]},r.set=function(e,t,i){e.x=t,e.y=i},r.copy=function(e,t){e.x=t.x,e.y=t.y},r.len=function(e){return Math.sqrt(e.x*e.x+e.y*e.y)},r.lenSquare=function(e){return e.x*e.x+e.y*e.y},r.dot=function(e,t){return e.x*t.x+e.y*t.y},r.add=function(e,t,i){e.x=t.x+i.x,e.y=t.y+i.y},r.sub=function(e,t,i){e.x=t.x-i.x,e.y=t.y-i.y},r.scale=function(e,t,i){e.x=t.x*i,e.y=t.y*i},r.scaleAndAdd=function(e,t,i,n){e.x=t.x+i.x*n,e.y=t.y+i.y*n},r.lerp=function(e,t,i,n){var a=1-n;e.x=a*t.x+n*i.x,e.y=a*t.y+n*i.y},r})(),vT=Math.min,mT=Math.max,im=new Rr,nm=new Rr,am=new Rr,om=new Rr,Rx=new Rr,Dx=new Rr,Dr=(function(){function r(e,t,i,n){i<0&&(e=e+i,i=-i),n<0&&(t=t+n,n=-n),this.x=e,this.y=t,this.width=i,this.height=n}return r.prototype.union=function(e){var t=vT(e.x,this.x),i=vT(e.y,this.y);isFinite(this.x)&&isFinite(this.width)?this.width=mT(e.x+e.width,this.x+this.width)-t:this.width=e.width,isFinite(this.y)&&isFinite(this.height)?this.height=mT(e.y+e.height,this.y+this.height)-i:this.height=e.height,this.x=t,this.y=i},r.prototype.applyTransform=function(e){r.applyTransform(this,this,e)},r.prototype.calculateTransform=function(e){var t=this,i=e.width/t.width,n=e.height/t.height,a=kl();return Ph(a,a,[-t.x,-t.y]),EC(a,a,[i,n]),Ph(a,a,[e.x,e.y]),a},r.prototype.intersect=function(e,t){if(!e)return!1;e instanceof r||(e=r.create(e));var i=this,n=i.x,a=i.x+i.width,s=i.y,o=i.y+i.height,l=e.x,c=e.x+e.width,f=e.y,p=e.y+e.height,y=!(a<l||c<n||o<f||p<s);if(t){var b=1/0,S=0,C=Math.abs(a-l),E=Math.abs(c-n),P=Math.abs(o-f),O=Math.abs(p-s),B=Math.min(C,E),F=Math.min(P,O);a<l||c<n?B>S&&(S=B,C<E?Rr.set(Dx,-C,0):Rr.set(Dx,E,0)):B<b&&(b=B,C<E?Rr.set(Rx,C,0):Rr.set(Rx,-E,0)),o<f||p<s?F>S&&(S=F,P<O?Rr.set(Dx,0,-P):Rr.set(Dx,0,O)):B<b&&(b=B,P<O?Rr.set(Rx,0,P):Rr.set(Rx,0,-O))}return t&&Rr.copy(t,y?Rx:Dx),y},r.prototype.contain=function(e,t){var i=this;return e>=i.x&&e<=i.x+i.width&&t>=i.y&&t<=i.y+i.height},r.prototype.clone=function(){return new r(this.x,this.y,this.width,this.height)},r.prototype.copy=function(e){r.copy(this,e)},r.prototype.plain=function(){return{x:this.x,y:this.y,width:this.width,height:this.height}},r.prototype.isFinite=function(){return isFinite(this.x)&&isFinite(this.y)&&isFinite(this.width)&&isFinite(this.height)},r.prototype.isZero=function(){return this.width===0||this.height===0},r.create=function(e){return new r(e.x,e.y,e.width,e.height)},r.copy=function(e,t){e.x=t.x,e.y=t.y,e.width=t.width,e.height=t.height},r.applyTransform=function(e,t,i){if(!i){e!==t&&r.copy(e,t);return}if(i[1]<1e-5&&i[1]>-1e-5&&i[2]<1e-5&&i[2]>-1e-5){var n=i[0],a=i[3],s=i[4],o=i[5];e.x=t.x*n+s,e.y=t.y*a+o,e.width=t.width*n,e.height=t.height*a,e.width<0&&(e.x+=e.width,e.width=-e.width),e.height<0&&(e.y+=e.height,e.height=-e.height);return}im.x=am.x=t.x,im.y=om.y=t.y,nm.x=om.x=t.x+t.width,nm.y=am.y=t.y+t.height,im.transform(i),om.transform(i),nm.transform(i),am.transform(i),e.x=vT(im.x,nm.x,am.x,om.x),e.y=vT(im.y,nm.y,am.y,om.y);var l=mT(im.x,nm.x,am.x,om.x),c=mT(im.y,nm.y,am.y,om.y);e.width=l-e.x,e.height=c-e.y},r})(),Yj="silent";function Ele(r,e,t){return{type:r,event:t,target:e.target,topTarget:e.topTarget,cancelBubble:!1,offsetX:t.zrX,offsetY:t.zrY,gestureEvent:t.gestureEvent,pinchX:t.pinchX,pinchY:t.pinchY,pinchScale:t.pinchScale,wheelDelta:t.zrDelta,zrByTouch:t.zrByTouch,which:t.which,stop:Ile}}function Ile(){up(this.event)}var Ple=(function(r){Ye(e,r);function e(){var t=r!==null&&r.apply(this,arguments)||this;return t.handler=null,t}return e.prototype.dispose=function(){},e.prototype.setCursor=function(){},e})(Cc),kx=(function(){function r(e,t){this.x=e,this.y=t}return r})(),Rle=["click","dblclick","mousewheel","mouseout","mouseup","mousedown","mousemove","contextmenu"],SE=new Dr(0,0,0,0),Kj=(function(r){Ye(e,r);function e(t,i,n,a,s){var o=r.call(this)||this;return o._hovered=new kx(0,0),o.storage=t,o.painter=i,o.painterRoot=a,o._pointerSize=s,n=n||new Ple,o.proxy=null,o.setHandlerProxy(n),o._draggingMgr=new ple(o),o}return e.prototype.setHandlerProxy=function(t){this.proxy&&this.proxy.dispose(),t&&(se(Rle,function(i){t.on&&t.on(i,this[i],this)},this),t.handler=this),this.proxy=t},e.prototype.mousemove=function(t){var i=t.zrX,n=t.zrY,a=Qj(this,i,n),s=this._hovered,o=s.target;o&&!o.__zr&&(s=this.findHover(s.x,s.y),o=s.target);var l=this._hovered=a?new kx(i,n):this.findHover(i,n),c=l.target,f=this.proxy;f.setCursor&&f.setCursor(c?c.cursor:"default"),o&&c!==o&&this.dispatchToElement(s,"mouseout",t),this.dispatchToElement(l,"mousemove",t),c&&c!==o&&this.dispatchToElement(l,"mouseover",t)},e.prototype.mouseout=function(t){var i=t.zrEventControl;i!=="only_globalout"&&this.dispatchToElement(this._hovered,"mouseout",t),i!=="no_globalout"&&this.trigger("globalout",{type:"globalout",event:t})},e.prototype.resize=function(){this._hovered=new kx(0,0)},e.prototype.dispatch=function(t,i){var n=this[t];n&&n.call(this,i)},e.prototype.dispose=function(){this.proxy.dispose(),this.storage=null,this.proxy=null,this.painter=null},e.prototype.setCursorStyle=function(t){var i=this.proxy;i.setCursor&&i.setCursor(t)},e.prototype.dispatchToElement=function(t,i,n){t=t||{};var a=t.target;if(!(a&&a.silent)){for(var s="on"+i,o=Ele(i,t,n);a&&(a[s]&&(o.cancelBubble=!!a[s].call(a,o)),a.trigger(i,o),a=a.__hostTarget?a.__hostTarget:a.parent,!o.cancelBubble););o.cancelBubble||(this.trigger(i,o),this.painter&&this.painter.eachOtherLayer&&this.painter.eachOtherLayer(function(l){typeof l[s]=="function"&&l[s].call(l,o),l.trigger&&l.trigger(i,o)}))}},e.prototype.findHover=function(t,i,n){var a=this.storage.getDisplayList(),s=new kx(t,i);if(c4(a,s,t,i,n),this._pointerSize&&!s.target){for(var o=[],l=this._pointerSize,c=l/2,f=new Dr(t-c,i-c,l,l),p=a.length-1;p>=0;p--){var y=a[p];y!==n&&!y.ignore&&!y.ignoreCoarsePointer&&(!y.parent||!y.parent.ignoreCoarsePointer)&&(SE.copy(y.getBoundingRect()),y.transform&&SE.applyTransform(y.transform),SE.intersect(f)&&o.push(y))}if(o.length)for(var b=4,S=Math.PI/12,C=Math.PI*2,E=0;E<c;E+=b)for(var P=0;P<C;P+=S){var O=t+E*Math.cos(P),B=i+E*Math.sin(P);if(c4(o,s,O,B,n),s.target)return s}}return s},e.prototype.processGesture=function(t,i){this._gestureMgr||(this._gestureMgr=new Ale);var n=this._gestureMgr;i==="start"&&n.clear();var a=n.recognize(t,this.findHover(t.zrX,t.zrY,null).target,this.proxy.dom);if(i==="end"&&n.clear(),a){var s=a.type;t.gestureEvent=s;var o=new kx;o.target=a.target,this.dispatchToElement(o,s,a.event)}},e})(Cc);se(["click","mousedown","mouseup","mousewheel","dblclick","contextmenu"],function(r){Kj.prototype[r]=function(e){var t=e.zrX,i=e.zrY,n=Qj(this,t,i),a,s;if((r!=="mouseup"||!n)&&(a=this.findHover(t,i),s=a.target),r==="mousedown")this._downEl=s,this._downPoint=[e.zrX,e.zrY],this._upEl=s;else if(r==="mouseup")this._upEl=s;else if(r==="click"){if(this._downEl!==this._upEl||!this._downPoint||tp(this._downPoint,[e.zrX,e.zrY])>4)return;this._downPoint=null}this.dispatchToElement(a,r,e)}});function Dle(r,e,t){if(r[r.rectHover?"rectContain":"contain"](e,t)){for(var i=r,n=void 0,a=!1;i;){if(i.ignoreClip&&(a=!0),!a){var s=i.getClipPath();if(s&&!s.contain(e,t))return!1}i.silent&&(n=!0);var o=i.__hostTarget;i=o||i.parent}return n?Yj:!0}return!1}function c4(r,e,t,i,n){for(var a=r.length-1;a>=0;a--){var s=r[a],o=void 0;if(s!==n&&!s.ignore&&(o=Dle(s,t,i))&&(!e.topTarget&&(e.topTarget=s),o!==Yj)){e.target=s;break}}}function Qj(r,e,t){var i=r.painter;return e<0||e>i.getWidth()||t<0||t>i.getHeight()}var Jj=32,Lx=7;function kle(r){for(var e=0;r>=Jj;)e|=r&1,r>>=1;return r+e}function h4(r,e,t,i){var n=e+1;if(n===t)return 1;if(i(r[n++],r[e])<0){for(;n<t&&i(r[n],r[n-1])<0;)n++;Lle(r,e,n)}else for(;n<t&&i(r[n],r[n-1])>=0;)n++;return n-e}function Lle(r,e,t){for(t--;e<t;){var i=r[e];r[e++]=r[t],r[t--]=i}}function f4(r,e,t,i,n){for(i===e&&i++;i<t;i++){for(var a=r[i],s=e,o=i,l;s<o;)l=s+o>>>1,n(a,r[l])<0?o=l:s=l+1;var c=i-s;switch(c){case 3:r[s+3]=r[s+2];case 2:r[s+2]=r[s+1];case 1:r[s+1]=r[s];break;default:for(;c>0;)r[s+c]=r[s+c-1],c--}r[s]=a}}function TE(r,e,t,i,n,a){var s=0,o=0,l=1;if(a(r,e[t+n])>0){for(o=i-n;l<o&&a(r,e[t+n+l])>0;)s=l,l=(l<<1)+1,l<=0&&(l=o);l>o&&(l=o),s+=n,l+=n}else{for(o=n+1;l<o&&a(r,e[t+n-l])<=0;)s=l,l=(l<<1)+1,l<=0&&(l=o);l>o&&(l=o);var c=s;s=n-l,l=n-c}for(s++;s<l;){var f=s+(l-s>>>1);a(r,e[t+f])>0?s=f+1:l=f}return l}function AE(r,e,t,i,n,a){var s=0,o=0,l=1;if(a(r,e[t+n])<0){for(o=n+1;l<o&&a(r,e[t+n-l])<0;)s=l,l=(l<<1)+1,l<=0&&(l=o);l>o&&(l=o);var c=s;s=n-l,l=n-c}else{for(o=i-n;l<o&&a(r,e[t+n+l])>=0;)s=l,l=(l<<1)+1,l<=0&&(l=o);l>o&&(l=o),s+=n,l+=n}for(s++;s<l;){var f=s+(l-s>>>1);a(r,e[t+f])<0?l=f:s=f+1}return l}function Ole(r,e){var t=Lx,i,n,a=0,s=[];i=[],n=[];function o(b,S){i[a]=b,n[a]=S,a+=1}function l(){for(;a>1;){var b=a-2;if(b>=1&&n[b-1]<=n[b]+n[b+1]||b>=2&&n[b-2]<=n[b]+n[b-1])n[b-1]<n[b+1]&&b--;else if(n[b]>n[b+1])break;f(b)}}function c(){for(;a>1;){var b=a-2;b>0&&n[b-1]<n[b+1]&&b--,f(b)}}function f(b){var S=i[b],C=n[b],E=i[b+1],P=n[b+1];n[b]=C+P,b===a-3&&(i[b+1]=i[b+2],n[b+1]=n[b+2]),a--;var O=AE(r[E],r,S,C,0,e);S+=O,C-=O,C!==0&&(P=TE(r[S+C-1],r,E,P,P-1,e),P!==0&&(C<=P?p(S,C,E,P):y(S,C,E,P)))}function p(b,S,C,E){var P=0;for(P=0;P<S;P++)s[P]=r[b+P];var O=0,B=C,F=b;if(r[F++]=r[B++],--E===0){for(P=0;P<S;P++)r[F+P]=s[O+P];return}if(S===1){for(P=0;P<E;P++)r[F+P]=r[B+P];r[F+E]=s[O];return}for(var W=t,$,q,Q;;){$=0,q=0,Q=!1;do if(e(r[B],s[O])<0){if(r[F++]=r[B++],q++,$=0,--E===0){Q=!0;break}}else if(r[F++]=s[O++],$++,q=0,--S===1){Q=!0;break}while(($|q)<W);if(Q)break;do{if($=AE(r[B],s,O,S,0,e),$!==0){for(P=0;P<$;P++)r[F+P]=s[O+P];if(F+=$,O+=$,S-=$,S<=1){Q=!0;break}}if(r[F++]=r[B++],--E===0){Q=!0;break}if(q=TE(s[O],r,B,E,0,e),q!==0){for(P=0;P<q;P++)r[F+P]=r[B+P];if(F+=q,B+=q,E-=q,E===0){Q=!0;break}}if(r[F++]=s[O++],--S===1){Q=!0;break}W--}while($>=Lx||q>=Lx);if(Q)break;W<0&&(W=0),W+=2}if(t=W,t<1&&(t=1),S===1){for(P=0;P<E;P++)r[F+P]=r[B+P];r[F+E]=s[O]}else{if(S===0)throw new Error;for(P=0;P<S;P++)r[F+P]=s[O+P]}}function y(b,S,C,E){var P=0;for(P=0;P<E;P++)s[P]=r[C+P];var O=b+S-1,B=E-1,F=C+E-1,W=0,$=0;if(r[F--]=r[O--],--S===0){for(W=F-(E-1),P=0;P<E;P++)r[W+P]=s[P];return}if(E===1){for(F-=S,O-=S,$=F+1,W=O+1,P=S-1;P>=0;P--)r[$+P]=r[W+P];r[F]=s[B];return}for(var q=t;;){var Q=0,ee=0,te=!1;do if(e(s[B],r[O])<0){if(r[F--]=r[O--],Q++,ee=0,--S===0){te=!0;break}}else if(r[F--]=s[B--],ee++,Q=0,--E===1){te=!0;break}while((Q|ee)<q);if(te)break;do{if(Q=S-AE(s[B],r,b,S,S-1,e),Q!==0){for(F-=Q,O-=Q,S-=Q,$=F+1,W=O+1,P=Q-1;P>=0;P--)r[$+P]=r[W+P];if(S===0){te=!0;break}}if(r[F--]=s[B--],--E===1){te=!0;break}if(ee=E-TE(r[O],s,0,E,E-1,e),ee!==0){for(F-=ee,B-=ee,E-=ee,$=F+1,W=B+1,P=0;P<ee;P++)r[$+P]=s[W+P];if(E<=1){te=!0;break}}if(r[F--]=r[O--],--S===0){te=!0;break}q--}while(Q>=Lx||ee>=Lx);if(te)break;q<0&&(q=0),q+=2}if(t=q,t<1&&(t=1),E===1){for(F-=S,O-=S,$=F+1,W=O+1,P=S-1;P>=0;P--)r[$+P]=r[W+P];r[F]=s[B]}else{if(E===0)throw new Error;for(W=F-(E-1),P=0;P<E;P++)r[W+P]=s[P]}}return{mergeRuns:l,forceMergeRuns:c,pushRun:o}}function I2(r,e,t,i){t||(t=0),i||(i=r.length);var n=i-t;if(!(n<2)){var a=0;if(n<Jj){a=h4(r,t,i,e),f4(r,t,i,t+a,e);return}var s=Ole(r,e),o=kle(n);do{if(a=h4(r,t,i,e),a<o){var l=n;l>o&&(l=o),f4(r,t,t+l,t+a,e),a=l}s.pushRun(t,a),s.mergeRuns(),n-=a,t+=a}while(n!==0);s.forceMergeRuns()}}var gu=1,p1=2,l0=4,d4=!1;function CE(){d4||(d4=!0,console.warn("z / z2 / zlevel of displayable is invalid, which may cause unexpected errors"))}function p4(r,e){return r.zlevel===e.zlevel?r.z===e.z?r.z2-e.z2:r.z-e.z:r.zlevel-e.zlevel}var Nle=(function(){function r(){this._roots=[],this._displayList=[],this._displayListLen=0,this.displayableSortFunc=p4}return r.prototype.traverse=function(e,t){for(var i=0;i<this._roots.length;i++)this._roots[i].traverse(e,t)},r.prototype.getDisplayList=function(e,t){t=t||!1;var i=this._displayList;return(e||!i.length)&&this.updateDisplayList(t),i},r.prototype.updateDisplayList=function(e){this._displayListLen=0;for(var t=this._roots,i=this._displayList,n=0,a=t.length;n<a;n++)this._updateAndAddDisplayable(t[n],null,e);i.length=this._displayListLen,I2(i,p4)},r.prototype._updateAndAddDisplayable=function(e,t,i){if(!(e.ignore&&!i)){e.beforeUpdate(),e.update(),e.afterUpdate();var n=e.getClipPath();if(e.ignoreClip)t=null;else if(n){t?t=t.slice():t=[];for(var a=n,s=e;a;)a.parent=s,a.updateTransform(),t.push(a),s=a,a=a.getClipPath()}if(e.childrenRef){for(var o=e.childrenRef(),l=0;l<o.length;l++){var c=o[l];e.__dirty&&(c.__dirty|=gu),this._updateAndAddDisplayable(c,t,i)}e.__dirty=0}else{var f=e;t&&t.length?f.__clipPaths=t:f.__clipPaths&&f.__clipPaths.length>0&&(f.__clipPaths=[]),isNaN(f.z)&&(CE(),f.z=0),isNaN(f.z2)&&(CE(),f.z2=0),isNaN(f.zlevel)&&(CE(),f.zlevel=0),this._displayList[this._displayListLen++]=f}var p=e.getDecalElement&&e.getDecalElement();p&&this._updateAndAddDisplayable(p,t,i);var y=e.getTextGuideLine();y&&this._updateAndAddDisplayable(y,t,i);var b=e.getTextContent();b&&this._updateAndAddDisplayable(b,t,i)}},r.prototype.addRoot=function(e){e.__zr&&e.__zr.storage===this||this._roots.push(e)},r.prototype.delRoot=function(e){if(e instanceof Array){for(var t=0,i=e.length;t<i;t++)this.delRoot(e[t]);return}var n=Or(this._roots,e);n>=0&&this._roots.splice(n,1)},r.prototype.delAllRoots=function(){this._roots=[],this._displayList=[],this._displayListLen=0},r.prototype.getRoots=function(){return this._roots},r.prototype.dispose=function(){this._displayList=null,this._roots=null},r})(),mA;mA=Gr.hasGlobalWindow&&(window.requestAnimationFrame&&window.requestAnimationFrame.bind(window)||window.msRequestAnimationFrame&&window.msRequestAnimationFrame.bind(window)||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame)||function(r){return setTimeout(r,16)};var z1={linear:function(r){return r},quadraticIn:function(r){return r*r},quadraticOut:function(r){return r*(2-r)},quadraticInOut:function(r){return(r*=2)<1?.5*r*r:-.5*(--r*(r-2)-1)},cubicIn:function(r){return r*r*r},cubicOut:function(r){return--r*r*r+1},cubicInOut:function(r){return(r*=2)<1?.5*r*r*r:.5*((r-=2)*r*r+2)},quarticIn:function(r){return r*r*r*r},quarticOut:function(r){return 1- --r*r*r*r},quarticInOut:function(r){return(r*=2)<1?.5*r*r*r*r:-.5*((r-=2)*r*r*r-2)},quinticIn:function(r){return r*r*r*r*r},quinticOut:function(r){return--r*r*r*r*r+1},quinticInOut:function(r){return(r*=2)<1?.5*r*r*r*r*r:.5*((r-=2)*r*r*r*r+2)},sinusoidalIn:function(r){return 1-Math.cos(r*Math.PI/2)},sinusoidalOut:function(r){return Math.sin(r*Math.PI/2)},sinusoidalInOut:function(r){return .5*(1-Math.cos(Math.PI*r))},exponentialIn:function(r){return r===0?0:Math.pow(1024,r-1)},exponentialOut:function(r){return r===1?1:1-Math.pow(2,-10*r)},exponentialInOut:function(r){return r===0?0:r===1?1:(r*=2)<1?.5*Math.pow(1024,r-1):.5*(-Math.pow(2,-10*(r-1))+2)},circularIn:function(r){return 1-Math.sqrt(1-r*r)},circularOut:function(r){return Math.sqrt(1- --r*r)},circularInOut:function(r){return(r*=2)<1?-.5*(Math.sqrt(1-r*r)-1):.5*(Math.sqrt(1-(r-=2)*r)+1)},elasticIn:function(r){var e,t=.1,i=.4;return r===0?0:r===1?1:(!t||t<1?(t=1,e=i/4):e=i*Math.asin(1/t)/(2*Math.PI),-(t*Math.pow(2,10*(r-=1))*Math.sin((r-e)*(2*Math.PI)/i)))},elasticOut:function(r){var e,t=.1,i=.4;return r===0?0:r===1?1:(!t||t<1?(t=1,e=i/4):e=i*Math.asin(1/t)/(2*Math.PI),t*Math.pow(2,-10*r)*Math.sin((r-e)*(2*Math.PI)/i)+1)},elasticInOut:function(r){var e,t=.1,i=.4;return r===0?0:r===1?1:(!t||t<1?(t=1,e=i/4):e=i*Math.asin(1/t)/(2*Math.PI),(r*=2)<1?-.5*(t*Math.pow(2,10*(r-=1))*Math.sin((r-e)*(2*Math.PI)/i)):t*Math.pow(2,-10*(r-=1))*Math.sin((r-e)*(2*Math.PI)/i)*.5+1)},backIn:function(r){var e=1.70158;return r*r*((e+1)*r-e)},backOut:function(r){var e=1.70158;return--r*r*((e+1)*r+e)+1},backInOut:function(r){var e=2.5949095;return(r*=2)<1?.5*(r*r*((e+1)*r-e)):.5*((r-=2)*r*((e+1)*r+e)+2)},bounceIn:function(r){return 1-z1.bounceOut(1-r)},bounceOut:function(r){return r<1/2.75?7.5625*r*r:r<2/2.75?7.5625*(r-=1.5/2.75)*r+.75:r<2.5/2.75?7.5625*(r-=2.25/2.75)*r+.9375:7.5625*(r-=2.625/2.75)*r+.984375},bounceInOut:function(r){return r<.5?z1.bounceIn(r*2)*.5:z1.bounceOut(r*2-1)*.5+.5}},yT=Math.pow,Lg=Math.sqrt,yA=1e-8,e$=1e-4,g4=Lg(3),_T=1/3,Pf=Xg(),dc=Xg(),M0=Xg();function Cg(r){return r>-yA&&r<yA}function t$(r){return r>yA||r<-yA}function oo(r,e,t,i,n){var a=1-n;return a*a*(a*r+3*n*e)+n*n*(n*i+3*a*t)}function v4(r,e,t,i,n){var a=1-n;return 3*(((e-r)*a+2*(t-e)*n)*a+(i-t)*n*n)}function _A(r,e,t,i,n,a){var s=i+3*(e-t)-r,o=3*(t-e*2+r),l=3*(e-r),c=r-n,f=o*o-3*s*l,p=o*l-9*s*c,y=l*l-3*o*c,b=0;if(Cg(f)&&Cg(p))if(Cg(o))a[0]=0;else{var S=-l/o;S>=0&&S<=1&&(a[b++]=S)}else{var C=p*p-4*f*y;if(Cg(C)){var E=p/f,S=-o/s+E,P=-E/2;S>=0&&S<=1&&(a[b++]=S),P>=0&&P<=1&&(a[b++]=P)}else if(C>0){var O=Lg(C),B=f*o+1.5*s*(-p+O),F=f*o+1.5*s*(-p-O);B<0?B=-yT(-B,_T):B=yT(B,_T),F<0?F=-yT(-F,_T):F=yT(F,_T);var S=(-o-(B+F))/(3*s);S>=0&&S<=1&&(a[b++]=S)}else{var W=(2*f*o-3*s*p)/(2*Lg(f*f*f)),$=Math.acos(W)/3,q=Lg(f),Q=Math.cos($),S=(-o-2*q*Q)/(3*s),P=(-o+q*(Q+g4*Math.sin($)))/(3*s),ee=(-o+q*(Q-g4*Math.sin($)))/(3*s);S>=0&&S<=1&&(a[b++]=S),P>=0&&P<=1&&(a[b++]=P),ee>=0&&ee<=1&&(a[b++]=ee)}}return b}function r$(r,e,t,i,n){var a=6*t-12*e+6*r,s=9*e+3*i-3*r-9*t,o=3*e-3*r,l=0;if(Cg(s)){if(t$(a)){var c=-o/a;c>=0&&c<=1&&(n[l++]=c)}}else{var f=a*a-4*s*o;if(Cg(f))n[0]=-a/(2*s);else if(f>0){var p=Lg(f),c=(-a+p)/(2*s),y=(-a-p)/(2*s);c>=0&&c<=1&&(n[l++]=c),y>=0&&y<=1&&(n[l++]=y)}}return l}function Hg(r,e,t,i,n,a){var s=(e-r)*n+r,o=(t-e)*n+e,l=(i-t)*n+t,c=(o-s)*n+s,f=(l-o)*n+o,p=(f-c)*n+c;a[0]=r,a[1]=s,a[2]=c,a[3]=p,a[4]=p,a[5]=f,a[6]=l,a[7]=i}function i$(r,e,t,i,n,a,s,o,l,c,f){var p,y=.005,b=1/0,S,C,E,P;Pf[0]=l,Pf[1]=c;for(var O=0;O<1;O+=.05)dc[0]=oo(r,t,n,s,O),dc[1]=oo(e,i,a,o,O),E=kg(Pf,dc),E<b&&(p=O,b=E);b=1/0;for(var B=0;B<32&&!(y<e$);B++)S=p-y,C=p+y,dc[0]=oo(r,t,n,s,S),dc[1]=oo(e,i,a,o,S),E=kg(dc,Pf),S>=0&&E<b?(p=S,b=E):(M0[0]=oo(r,t,n,s,C),M0[1]=oo(e,i,a,o,C),P=kg(M0,Pf),C<=1&&P<b?(p=C,b=P):y*=.5);return f&&(f[0]=oo(r,t,n,s,p),f[1]=oo(e,i,a,o,p)),Lg(b)}function Ble(r,e,t,i,n,a,s,o,l){for(var c=r,f=e,p=0,y=1/l,b=1;b<=l;b++){var S=b*y,C=oo(r,t,n,s,S),E=oo(e,i,a,o,S),P=C-c,O=E-f;p+=Math.sqrt(P*P+O*O),c=C,f=E}return p}function Po(r,e,t,i){var n=1-i;return n*(n*r+2*i*e)+i*i*t}function kR(r,e,t,i){return 2*((1-i)*(e-r)+i*(t-e))}function zle(r,e,t,i,n){var a=r-2*e+t,s=2*(e-r),o=r-i,l=0;if(Cg(a)){if(t$(s)){var c=-o/s;c>=0&&c<=1&&(n[l++]=c)}}else{var f=s*s-4*a*o;if(Cg(f)){var c=-s/(2*a);c>=0&&c<=1&&(n[l++]=c)}else if(f>0){var p=Lg(f),c=(-s+p)/(2*a),y=(-s-p)/(2*a);c>=0&&c<=1&&(n[l++]=c),y>=0&&y<=1&&(n[l++]=y)}}return l}function n$(r,e,t){var i=r+t-2*e;return i===0?.5:(r-e)/i}function lw(r,e,t,i,n){var a=(e-r)*i+r,s=(t-e)*i+e,o=(s-a)*i+a;n[0]=r,n[1]=a,n[2]=o,n[3]=o,n[4]=s,n[5]=t}function a$(r,e,t,i,n,a,s,o,l){var c,f=.005,p=1/0;Pf[0]=s,Pf[1]=o;for(var y=0;y<1;y+=.05){dc[0]=Po(r,t,n,y),dc[1]=Po(e,i,a,y);var b=kg(Pf,dc);b<p&&(c=y,p=b)}p=1/0;for(var S=0;S<32&&!(f<e$);S++){var C=c-f,E=c+f;dc[0]=Po(r,t,n,C),dc[1]=Po(e,i,a,C);var b=kg(dc,Pf);if(C>=0&&b<p)c=C,p=b;else{M0[0]=Po(r,t,n,E),M0[1]=Po(e,i,a,E);var P=kg(M0,Pf);E<=1&&P<p?(c=E,p=P):f*=.5}}return l&&(l[0]=Po(r,t,n,c),l[1]=Po(e,i,a,c)),Lg(p)}function Fle(r,e,t,i,n,a,s){for(var o=r,l=e,c=0,f=1/s,p=1;p<=s;p++){var y=p*f,b=Po(r,t,n,y),S=Po(e,i,a,y),C=b-o,E=S-l;c+=Math.sqrt(C*C+E*E),o=b,l=S}return c}var Vle=/cubic-bezier\(([0-9,\.e ]+)\)/;function bk(r){var e=r&&Vle.exec(r);if(e){var t=e[1].split(","),i=+mc(t[0]),n=+mc(t[1]),a=+mc(t[2]),s=+mc(t[3]);if(isNaN(i+n+a+s))return;var o=[];return function(l){return l<=0?0:l>=1?1:_A(0,i,a,1,l,o)&&oo(0,n,s,1,o[0])}}}var Ule=(function(){function r(e){this._inited=!1,this._startTime=0,this._pausedTime=0,this._paused=!1,this._life=e.life||1e3,this._delay=e.delay||0,this.loop=e.loop||!1,this.onframe=e.onframe||ca,this.ondestroy=e.ondestroy||ca,this.onrestart=e.onrestart||ca,e.easing&&this.setEasing(e.easing)}return r.prototype.step=function(e,t){if(this._inited||(this._startTime=e+this._delay,this._inited=!0),this._paused){this._pausedTime+=t;return}var i=this._life,n=e-this._startTime-this._pausedTime,a=n/i;a<0&&(a=0),a=Math.min(a,1);var s=this.easingFunc,o=s?s(a):a;if(this.onframe(o),a===1)if(this.loop){var l=n%i;this._startTime=e-l,this._pausedTime=0,this.onrestart()}else return!0;return!1},r.prototype.pause=function(){this._paused=!0},r.prototype.resume=function(){this._paused=!1},r.prototype.setEasing=function(e){this.easing=e,this.easingFunc=sr(e)?e:z1[e]||bk(e)},r})(),o$=(function(){function r(e){this.value=e}return r})(),Hle=(function(){function r(){this._len=0}return r.prototype.insert=function(e){var t=new o$(e);return this.insertEntry(t),t},r.prototype.insertEntry=function(e){this.head?(this.tail.next=e,e.prev=this.tail,e.next=null,this.tail=e):this.head=this.tail=e,this._len++},r.prototype.remove=function(e){var t=e.prev,i=e.next;t?t.next=i:this.head=i,i?i.prev=t:this.tail=t,e.next=e.prev=null,this._len--},r.prototype.len=function(){return this._len},r.prototype.clear=function(){this.head=this.tail=null,this._len=0},r})(),$w=(function(){function r(e){this._list=new Hle,this._maxSize=10,this._map={},this._maxSize=e}return r.prototype.put=function(e,t){var i=this._list,n=this._map,a=null;if(n[e]==null){var s=i.len(),o=this._lastRemovedEntry;if(s>=this._maxSize&&s>0){var l=i.head;i.remove(l),delete n[l.key],a=l.value,this._lastRemovedEntry=l}o?o.value=t:o=new o$(t),o.key=e,i.insertEntry(o),n[e]=o}return a},r.prototype.get=function(e){var t=this._map[e],i=this._list;if(t!=null)return t!==i.tail&&(i.remove(t),i.insertEntry(t)),t.value},r.prototype.clear=function(){this._list.clear(),this._map={}},r.prototype.len=function(){return this._list.len()},r})(),m4={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function Ah(r){return r=Math.round(r),r<0?0:r>255?255:r}function jle(r){return r=Math.round(r),r<0?0:r>360?360:r}function uw(r){return r<0?0:r>1?1:r}function ME(r){var e=r;return e.length&&e.charAt(e.length-1)==="%"?Ah(parseFloat(e)/100*255):Ah(parseInt(e,10))}function ty(r){var e=r;return e.length&&e.charAt(e.length-1)==="%"?uw(parseFloat(e)/100):uw(parseFloat(e))}function EE(r,e,t){return t<0?t+=1:t>1&&(t-=1),t*6<1?r+(e-r)*t*6:t*2<1?e:t*3<2?r+(e-r)*(2/3-t)*6:r}function Mg(r,e,t){return r+(e-r)*t}function lc(r,e,t,i,n){return r[0]=e,r[1]=t,r[2]=i,r[3]=n,r}function LR(r,e){return r[0]=e[0],r[1]=e[1],r[2]=e[2],r[3]=e[3],r}var s$=new $w(20),bT=null;function F_(r,e){bT&&LR(bT,e),bT=s$.put(r,bT||e.slice())}function al(r,e){if(r){e=e||[];var t=s$.get(r);if(t)return LR(e,t);r=r+"";var i=r.replace(/ /g,"").toLowerCase();if(i in m4)return LR(e,m4[i]),F_(r,e),e;var n=i.length;if(i.charAt(0)==="#"){if(n===4||n===5){var a=parseInt(i.slice(1,4),16);if(!(a>=0&&a<=4095)){lc(e,0,0,0,1);return}return lc(e,(a&3840)>>4|(a&3840)>>8,a&240|(a&240)>>4,a&15|(a&15)<<4,n===5?parseInt(i.slice(4),16)/15:1),F_(r,e),e}else if(n===7||n===9){var a=parseInt(i.slice(1,7),16);if(!(a>=0&&a<=16777215)){lc(e,0,0,0,1);return}return lc(e,(a&16711680)>>16,(a&65280)>>8,a&255,n===9?parseInt(i.slice(7),16)/255:1),F_(r,e),e}return}var s=i.indexOf("("),o=i.indexOf(")");if(s!==-1&&o+1===n){var l=i.substr(0,s),c=i.substr(s+1,o-(s+1)).split(","),f=1;switch(l){case"rgba":if(c.length!==4)return c.length===3?lc(e,+c[0],+c[1],+c[2],1):lc(e,0,0,0,1);f=ty(c.pop());case"rgb":if(c.length>=3)return lc(e,ME(c[0]),ME(c[1]),ME(c[2]),c.length===3?f:ty(c[3])),F_(r,e),e;lc(e,0,0,0,1);return;case"hsla":if(c.length!==4){lc(e,0,0,0,1);return}return c[3]=ty(c[3]),OR(c,e),F_(r,e),e;case"hsl":if(c.length!==3){lc(e,0,0,0,1);return}return OR(c,e),F_(r,e),e;default:return}}lc(e,0,0,0,1)}}function OR(r,e){var t=(parseFloat(r[0])%360+360)%360/360,i=ty(r[1]),n=ty(r[2]),a=n<=.5?n*(i+1):n+i-n*i,s=n*2-a;return e=e||[],lc(e,Ah(EE(s,a,t+1/3)*255),Ah(EE(s,a,t)*255),Ah(EE(s,a,t-1/3)*255),1),r.length===4&&(e[3]=r[3]),e}function $le(r){if(r){var e=r[0]/255,t=r[1]/255,i=r[2]/255,n=Math.min(e,t,i),a=Math.max(e,t,i),s=a-n,o=(a+n)/2,l,c;if(s===0)l=0,c=0;else{o<.5?c=s/(a+n):c=s/(2-a-n);var f=((a-e)/6+s/2)/s,p=((a-t)/6+s/2)/s,y=((a-i)/6+s/2)/s;e===a?l=y-p:t===a?l=1/3+f-y:i===a&&(l=2/3+p-f),l<0&&(l+=1),l>1&&(l-=1)}var b=[l*360,c,o];return r[3]!=null&&b.push(r[3]),b}}function bA(r,e){var t=al(r);if(t){for(var i=0;i<3;i++)e<0?t[i]=t[i]*(1-e)|0:t[i]=(255-t[i])*e+t[i]|0,t[i]>255?t[i]=255:t[i]<0&&(t[i]=0);return Ch(t,t.length===4?"rgba":"rgb")}}function Wle(r){var e=al(r);if(e)return((1<<24)+(e[0]<<16)+(e[1]<<8)+ +e[2]).toString(16).slice(1)}function F1(r,e,t){if(!(!(e&&e.length)||!(r>=0&&r<=1))){t=t||[];var i=r*(e.length-1),n=Math.floor(i),a=Math.ceil(i),s=e[n],o=e[a],l=i-n;return t[0]=Ah(Mg(s[0],o[0],l)),t[1]=Ah(Mg(s[1],o[1],l)),t[2]=Ah(Mg(s[2],o[2],l)),t[3]=uw(Mg(s[3],o[3],l)),t}}var Gle=F1;function xk(r,e,t){if(!(!(e&&e.length)||!(r>=0&&r<=1))){var i=r*(e.length-1),n=Math.floor(i),a=Math.ceil(i),s=al(e[n]),o=al(e[a]),l=i-n,c=Ch([Ah(Mg(s[0],o[0],l)),Ah(Mg(s[1],o[1],l)),Ah(Mg(s[2],o[2],l)),uw(Mg(s[3],o[3],l))],"rgba");return t?{color:c,leftIndex:n,rightIndex:a,value:i}:c}}var Xle=xk;function E0(r,e,t,i){var n=al(r);if(r)return n=$le(n),e!=null&&(n[0]=jle(e)),t!=null&&(n[1]=ty(t)),i!=null&&(n[2]=ty(i)),Ch(OR(n),"rgba")}function cw(r,e){var t=al(r);if(t&&e!=null)return t[3]=uw(e),Ch(t,"rgba")}function Ch(r,e){if(!(!r||!r.length)){var t=r[0]+","+r[1]+","+r[2];return(e==="rgba"||e==="hsva"||e==="hsla")&&(t+=","+r[3]),e+"("+t+")"}}function hw(r,e){var t=al(r);return t?(.299*t[0]+.587*t[1]+.114*t[2])*t[3]/255+(1-t[3])*e:0}function Zle(){return Ch([Math.round(Math.random()*255),Math.round(Math.random()*255),Math.round(Math.random()*255)],"rgb")}var y4=new $w(100);function xA(r){if($t(r)){var e=y4.get(r);return e||(e=bA(r,-.1),y4.put(r,e)),e}else if(Uw(r)){var t=mt({},r);return t.colorStops=wt(r.colorStops,function(i){return{offset:i.offset,color:bA(i.color,-.1)}}),t}return r}const qle=Object.freeze(Object.defineProperty({__proto__:null,fastLerp:F1,fastMapToColor:Gle,lerp:xk,lift:bA,liftColor:xA,lum:hw,mapToColor:Xle,modifyAlpha:cw,modifyHSL:E0,parse:al,random:Zle,stringify:Ch,toHex:Wle},Symbol.toStringTag,{value:"Module"}));var wA=Math.round;function fw(r){var e;if(!r||r==="transparent")r="none";else if(typeof r=="string"&&r.indexOf("rgba")>-1){var t=al(r);t&&(r="rgb("+t[0]+","+t[1]+","+t[2]+")",e=t[3])}return{color:r,opacity:e??1}}var _4=1e-4;function Eg(r){return r<_4&&r>-_4}function xT(r){return wA(r*1e3)/1e3}function NR(r){return wA(r*1e4)/1e4}function Yle(r){return"matrix("+xT(r[0])+","+xT(r[1])+","+xT(r[2])+","+xT(r[3])+","+NR(r[4])+","+NR(r[5])+")"}var Kle={left:"start",right:"end",center:"middle",middle:"middle"};function Qle(r,e,t){return t==="top"?r+=e/2:t==="bottom"&&(r-=e/2),r}function Jle(r){return r&&(r.shadowBlur||r.shadowOffsetX||r.shadowOffsetY)}function eue(r){var e=r.style,t=r.getGlobalScale();return[e.shadowColor,(e.shadowBlur||0).toFixed(2),(e.shadowOffsetX||0).toFixed(2),(e.shadowOffsetY||0).toFixed(2),t[0],t[1]].join(",")}function l$(r){return r&&!!r.image}function tue(r){return r&&!!r.svgElement}function wk(r){return l$(r)||tue(r)}function u$(r){return r.type==="linear"}function c$(r){return r.type==="radial"}function h$(r){return r&&(r.type==="linear"||r.type==="radial")}function IC(r){return"url(#"+r+")"}function f$(r){var e=r.getGlobalScale(),t=Math.max(e[0],e[1]);return Math.max(Math.ceil(Math.log(t)/Math.log(10)),1)}function d$(r){var e=r.x||0,t=r.y||0,i=(r.rotation||0)*O1,n=wr(r.scaleX,1),a=wr(r.scaleY,1),s=r.skewX||0,o=r.skewY||0,l=[];return(e||t)&&l.push("translate("+e+"px,"+t+"px)"),i&&l.push("rotate("+i+")"),(n!==1||a!==1)&&l.push("scale("+n+","+a+")"),(s||o)&&l.push("skew("+wA(s*O1)+"deg, "+wA(o*O1)+"deg)"),l.join(" ")}var rue=(function(){return Gr.hasGlobalWindow&&sr(window.btoa)?function(r){return window.btoa(unescape(encodeURIComponent(r)))}:typeof Buffer<"u"?function(r){return Buffer.from(r).toString("base64")}:function(r){return null}})(),BR=Array.prototype.slice;function Yd(r,e,t){return(e-r)*t+r}function IE(r,e,t,i){for(var n=e.length,a=0;a<n;a++)r[a]=Yd(e[a],t[a],i);return r}function iue(r,e,t,i){for(var n=e.length,a=n&&e[0].length,s=0;s<n;s++){r[s]||(r[s]=[]);for(var o=0;o<a;o++)r[s][o]=Yd(e[s][o],t[s][o],i)}return r}function wT(r,e,t,i){for(var n=e.length,a=0;a<n;a++)r[a]=e[a]+t[a]*i;return r}function b4(r,e,t,i){for(var n=e.length,a=n&&e[0].length,s=0;s<n;s++){r[s]||(r[s]=[]);for(var o=0;o<a;o++)r[s][o]=e[s][o]+t[s][o]*i}return r}function nue(r,e){for(var t=r.length,i=e.length,n=t>i?e:r,a=Math.min(t,i),s=n[a-1]||{color:[0,0,0,0],offset:0},o=a;o<Math.max(t,i);o++)n.push({offset:s.offset,color:s.color.slice()})}function aue(r,e,t){var i=r,n=e;if(!(!i.push||!n.push)){var a=i.length,s=n.length;if(a!==s){var o=a>s;if(o)i.length=s;else for(var l=a;l<s;l++)i.push(t===1?n[l]:BR.call(n[l]))}for(var c=i[0]&&i[0].length,l=0;l<i.length;l++)if(t===1)isNaN(i[l])&&(i[l]=n[l]);else for(var f=0;f<c;f++)isNaN(i[l][f])&&(i[l][f]=n[l][f])}}function V1(r){if(es(r)){var e=r.length;if(es(r[0])){for(var t=[],i=0;i<e;i++)t.push(BR.call(r[i]));return t}return BR.call(r)}return r}function P2(r){return r[0]=Math.floor(r[0])||0,r[1]=Math.floor(r[1])||0,r[2]=Math.floor(r[2])||0,r[3]=r[3]==null?1:r[3],"rgba("+r.join(",")+")"}function oue(r){return es(r&&r[0])?2:1}var ST=0,R2=1,p$=2,g1=3,zR=4,FR=5,x4=6;function w4(r){return r===zR||r===FR}function TT(r){return r===R2||r===p$}var Ox=[0,0,0,0],sue=(function(){function r(e){this.keyframes=[],this.discrete=!1,this._invalid=!1,this._needsSort=!1,this._lastFr=0,this._lastFrP=0,this.propName=e}return r.prototype.isFinished=function(){return this._finished},r.prototype.setFinished=function(){this._finished=!0,this._additiveTrack&&this._additiveTrack.setFinished()},r.prototype.needsAnimate=function(){return this.keyframes.length>=1},r.prototype.getAdditiveTrack=function(){return this._additiveTrack},r.prototype.addKeyframe=function(e,t,i){this._needsSort=!0;var n=this.keyframes,a=n.length,s=!1,o=x4,l=t;if(es(t)){var c=oue(t);o=c,(c===1&&!di(t[0])||c===2&&!di(t[0][0]))&&(s=!0)}else if(di(t)&&!j0(t))o=ST;else if($t(t))if(!isNaN(+t))o=ST;else{var f=al(t);f&&(l=f,o=g1)}else if(Uw(t)){var p=mt({},l);p.colorStops=wt(t.colorStops,function(b){return{offset:b.offset,color:al(b.color)}}),u$(t)?o=zR:c$(t)&&(o=FR),l=p}a===0?this.valType=o:(o!==this.valType||o===x4)&&(s=!0),this.discrete=this.discrete||s;var y={time:e,value:l,rawValue:t,percent:0};return i&&(y.easing=i,y.easingFunc=sr(i)?i:z1[i]||bk(i)),n.push(y),y},r.prototype.prepare=function(e,t){var i=this.keyframes;this._needsSort&&i.sort(function(C,E){return C.time-E.time});for(var n=this.valType,a=i.length,s=i[a-1],o=this.discrete,l=TT(n),c=w4(n),f=0;f<a;f++){var p=i[f],y=p.value,b=s.value;p.percent=p.time/e,o||(l&&f!==a-1?aue(y,b,n):c&&nue(y.colorStops,b.colorStops))}if(!o&&n!==FR&&t&&this.needsAnimate()&&t.needsAnimate()&&n===t.valType&&!t._finished){this._additiveTrack=t;for(var S=i[0].value,f=0;f<a;f++)n===ST?i[f].additiveValue=i[f].value-S:n===g1?i[f].additiveValue=wT([],i[f].value,S,-1):TT(n)&&(i[f].additiveValue=n===R2?wT([],i[f].value,S,-1):b4([],i[f].value,S,-1))}},r.prototype.step=function(e,t){if(!this._finished){this._additiveTrack&&this._additiveTrack._finished&&(this._additiveTrack=null);var i=this._additiveTrack!=null,n=i?"additiveValue":"value",a=this.valType,s=this.keyframes,o=s.length,l=this.propName,c=a===g1,f,p=this._lastFr,y=Math.min,b,S;if(o===1)b=S=s[0];else{if(t<0)f=0;else if(t<this._lastFrP){var C=y(p+1,o-1);for(f=C;f>=0&&!(s[f].percent<=t);f--);f=y(f,o-2)}else{for(f=p;f<o&&!(s[f].percent>t);f++);f=y(f-1,o-2)}S=s[f+1],b=s[f]}if(b&&S){this._lastFr=f,this._lastFrP=t;var E=S.percent-b.percent,P=E===0?1:y((t-b.percent)/E,1);S.easingFunc&&(P=S.easingFunc(P));var O=i?this._additiveValue:c?Ox:e[l];if((TT(a)||c)&&!O&&(O=this._additiveValue=[]),this.discrete)e[l]=P<1?b.rawValue:S.rawValue;else if(TT(a))a===R2?IE(O,b[n],S[n],P):iue(O,b[n],S[n],P);else if(w4(a)){var B=b[n],F=S[n],W=a===zR;e[l]={type:W?"linear":"radial",x:Yd(B.x,F.x,P),y:Yd(B.y,F.y,P),colorStops:wt(B.colorStops,function(q,Q){var ee=F.colorStops[Q];return{offset:Yd(q.offset,ee.offset,P),color:P2(IE([],q.color,ee.color,P))}}),global:F.global},W?(e[l].x2=Yd(B.x2,F.x2,P),e[l].y2=Yd(B.y2,F.y2,P)):e[l].r=Yd(B.r,F.r,P)}else if(c)IE(O,b[n],S[n],P),i||(e[l]=P2(O));else{var $=Yd(b[n],S[n],P);i?this._additiveValue=$:e[l]=$}i&&this._addToTarget(e)}}},r.prototype._addToTarget=function(e){var t=this.valType,i=this.propName,n=this._additiveValue;t===ST?e[i]=e[i]+n:t===g1?(al(e[i],Ox),wT(Ox,Ox,n,1),e[i]=P2(Ox)):t===R2?wT(e[i],e[i],n,1):t===p$&&b4(e[i],e[i],n,1)},r})(),Sk=(function(){function r(e,t,i,n){if(this._tracks={},this._trackKeys=[],this._maxTime=0,this._started=0,this._clip=null,this._target=e,this._loop=t,t&&n){SC("Can' use additive animation on looped animation.");return}this._additiveAnimators=n,this._allowDiscrete=i}return r.prototype.getMaxTime=function(){return this._maxTime},r.prototype.getDelay=function(){return this._delay},r.prototype.getLoop=function(){return this._loop},r.prototype.getTarget=function(){return this._target},r.prototype.changeTarget=function(e){this._target=e},r.prototype.when=function(e,t,i){return this.whenWithKeys(e,t,qr(t),i)},r.prototype.whenWithKeys=function(e,t,i,n){for(var a=this._tracks,s=0;s<i.length;s++){var o=i[s],l=a[o];if(!l){l=a[o]=new sue(o);var c=void 0,f=this._getAdditiveTrack(o);if(f){var p=f.keyframes,y=p[p.length-1];c=y&&y.value,f.valType===g1&&c&&(c=P2(c))}else c=this._target[o];if(c==null)continue;e>0&&l.addKeyframe(0,V1(c),n),this._trackKeys.push(o)}l.addKeyframe(e,V1(t[o]),n)}return this._maxTime=Math.max(this._maxTime,e),this},r.prototype.pause=function(){this._clip.pause(),this._paused=!0},r.prototype.resume=function(){this._clip.resume(),this._paused=!1},r.prototype.isPaused=function(){return!!this._paused},r.prototype.duration=function(e){return this._maxTime=e,this._force=!0,this},r.prototype._doneCallback=function(){this._setTracksFinished(),this._clip=null;var e=this._doneCbs;if(e)for(var t=e.length,i=0;i<t;i++)e[i].call(this)},r.prototype._abortedCallback=function(){this._setTracksFinished();var e=this.animation,t=this._abortedCbs;if(e&&e.removeClip(this._clip),this._clip=null,t)for(var i=0;i<t.length;i++)t[i].call(this)},r.prototype._setTracksFinished=function(){for(var e=this._tracks,t=this._trackKeys,i=0;i<t.length;i++)e[t[i]].setFinished()},r.prototype._getAdditiveTrack=function(e){var t,i=this._additiveAnimators;if(i)for(var n=0;n<i.length;n++){var a=i[n].getTrack(e);a&&(t=a)}return t},r.prototype.start=function(e){if(!(this._started>0)){this._started=1;for(var t=this,i=[],n=this._maxTime||0,a=0;a<this._trackKeys.length;a++){var s=this._trackKeys[a],o=this._tracks[s],l=this._getAdditiveTrack(s),c=o.keyframes,f=c.length;if(o.prepare(n,l),o.needsAnimate())if(!this._allowDiscrete&&o.discrete){var p=c[f-1];p&&(t._target[o.propName]=p.rawValue),o.setFinished()}else i.push(o)}if(i.length||this._force){var y=new Ule({life:n,loop:this._loop,delay:this._delay||0,onframe:function(b){t._started=2;var S=t._additiveAnimators;if(S){for(var C=!1,E=0;E<S.length;E++)if(S[E]._clip){C=!0;break}C||(t._additiveAnimators=null)}for(var E=0;E<i.length;E++)i[E].step(t._target,b);var P=t._onframeCbs;if(P)for(var E=0;E<P.length;E++)P[E](t._target,b)},ondestroy:function(){t._doneCallback()}});this._clip=y,this.animation&&this.animation.addClip(y),e&&y.setEasing(e)}else this._doneCallback();return this}},r.prototype.stop=function(e){if(this._clip){var t=this._clip;e&&t.onframe(1),this._abortedCallback()}},r.prototype.delay=function(e){return this._delay=e,this},r.prototype.during=function(e){return e&&(this._onframeCbs||(this._onframeCbs=[]),this._onframeCbs.push(e)),this},r.prototype.done=function(e){return e&&(this._doneCbs||(this._doneCbs=[]),this._doneCbs.push(e)),this},r.prototype.aborted=function(e){return e&&(this._abortedCbs||(this._abortedCbs=[]),this._abortedCbs.push(e)),this},r.prototype.getClip=function(){return this._clip},r.prototype.getTrack=function(e){return this._tracks[e]},r.prototype.getTracks=function(){var e=this;return wt(this._trackKeys,function(t){return e._tracks[t]})},r.prototype.stopTracks=function(e,t){if(!e.length||!this._clip)return!0;for(var i=this._tracks,n=this._trackKeys,a=0;a<e.length;a++){var s=i[e[a]];s&&!s.isFinished()&&(t?s.step(this._target,1):this._started===1&&s.step(this._target,0),s.setFinished())}for(var o=!0,a=0;a<n.length;a++)if(!i[n[a]].isFinished()){o=!1;break}return o&&this._abortedCallback(),o},r.prototype.saveTo=function(e,t,i){if(e){t=t||this._trackKeys;for(var n=0;n<t.length;n++){var a=t[n],s=this._tracks[a];if(!(!s||s.isFinished())){var o=s.keyframes,l=o[i?0:o.length-1];l&&(e[a]=V1(l.rawValue))}}}},r.prototype.__changeFinalValue=function(e,t){t=t||qr(e);for(var i=0;i<t.length;i++){var n=t[i],a=this._tracks[n];if(a){var s=a.keyframes;if(s.length>1){var o=s.pop();a.addKeyframe(o.time,e[n]),a.prepare(this._maxTime,a.getAdditiveTrack())}}}},r})();function _0(){return new Date().getTime()}var lue=(function(r){Ye(e,r);function e(t){var i=r.call(this)||this;return i._running=!1,i._time=0,i._pausedTime=0,i._pauseStart=0,i._paused=!1,t=t||{},i.stage=t.stage||{},i}return e.prototype.addClip=function(t){t.animation&&this.removeClip(t),this._head?(this._tail.next=t,t.prev=this._tail,t.next=null,this._tail=t):this._head=this._tail=t,t.animation=this},e.prototype.addAnimator=function(t){t.animation=this;var i=t.getClip();i&&this.addClip(i)},e.prototype.removeClip=function(t){if(t.animation){var i=t.prev,n=t.next;i?i.next=n:this._head=n,n?n.prev=i:this._tail=i,t.next=t.prev=t.animation=null}},e.prototype.removeAnimator=function(t){var i=t.getClip();i&&this.removeClip(i),t.animation=null},e.prototype.update=function(t){for(var i=_0()-this._pausedTime,n=i-this._time,a=this._head;a;){var s=a.next,o=a.step(i,n);o&&(a.ondestroy(),this.removeClip(a)),a=s}this._time=i,t||(this.trigger("frame",n),this.stage.update&&this.stage.update())},e.prototype._startLoop=function(){var t=this;this._running=!0;function i(){t._running&&(mA(i),!t._paused&&t.update())}mA(i)},e.prototype.start=function(){this._running||(this._time=_0(),this._pausedTime=0,this._startLoop())},e.prototype.stop=function(){this._running=!1},e.prototype.pause=function(){this._paused||(this._pauseStart=_0(),this._paused=!0)},e.prototype.resume=function(){this._paused&&(this._pausedTime+=_0()-this._pauseStart,this._paused=!1)},e.prototype.clear=function(){for(var t=this._head;t;){var i=t.next;t.prev=t.next=t.animation=null,t=i}this._head=this._tail=null},e.prototype.isFinished=function(){return this._head==null},e.prototype.animate=function(t,i){i=i||{},this.start();var n=new Sk(t,i.loop);return this.addAnimator(n),n},e})(Cc),uue=300,PE=Gr.domSupported,RE=(function(){var r=["click","dblclick","mousewheel","wheel","mouseout","mouseup","mousedown","mousemove","contextmenu"],e=["touchstart","touchend","touchmove"],t={pointerdown:1,pointerup:1,pointermove:1,pointerout:1},i=wt(r,function(n){var a=n.replace("mouse","pointer");return t.hasOwnProperty(a)?a:n});return{mouse:r,touch:e,pointer:i}})(),S4={mouse:["mousemove","mouseup"],pointer:["pointermove","pointerup"]},T4=!1;function VR(r){var e=r.pointerType;return e==="pen"||e==="touch"}function cue(r){r.touching=!0,r.touchTimer!=null&&(clearTimeout(r.touchTimer),r.touchTimer=null),r.touchTimer=setTimeout(function(){r.touching=!1,r.touchTimer=null},700)}function DE(r){r&&(r.zrByTouch=!0)}function hue(r,e){return uc(r.dom,new fue(r,e),!0)}function g$(r,e){for(var t=e,i=!1;t&&t.nodeType!==9&&!(i=t.domBelongToZr||t!==e&&t===r.painterRoot);)t=t.parentNode;return i}var fue=(function(){function r(e,t){this.stopPropagation=ca,this.stopImmediatePropagation=ca,this.preventDefault=ca,this.type=t.type,this.target=this.currentTarget=e.dom,this.pointerType=t.pointerType,this.clientX=t.clientX,this.clientY=t.clientY}return r})(),yh={mousedown:function(r){r=uc(this.dom,r),this.__mayPointerCapture=[r.zrX,r.zrY],this.trigger("mousedown",r)},mousemove:function(r){r=uc(this.dom,r);var e=this.__mayPointerCapture;e&&(r.zrX!==e[0]||r.zrY!==e[1])&&this.__togglePointerCapture(!0),this.trigger("mousemove",r)},mouseup:function(r){r=uc(this.dom,r),this.__togglePointerCapture(!1),this.trigger("mouseup",r)},mouseout:function(r){r=uc(this.dom,r);var e=r.toElement||r.relatedTarget;g$(this,e)||(this.__pointerCapturing&&(r.zrEventControl="no_globalout"),this.trigger("mouseout",r))},wheel:function(r){T4=!0,r=uc(this.dom,r),this.trigger("mousewheel",r)},mousewheel:function(r){T4||(r=uc(this.dom,r),this.trigger("mousewheel",r))},touchstart:function(r){r=uc(this.dom,r),DE(r),this.__lastTouchMoment=new Date,this.handler.processGesture(r,"start"),yh.mousemove.call(this,r),yh.mousedown.call(this,r)},touchmove:function(r){r=uc(this.dom,r),DE(r),this.handler.processGesture(r,"change"),yh.mousemove.call(this,r)},touchend:function(r){r=uc(this.dom,r),DE(r),this.handler.processGesture(r,"end"),yh.mouseup.call(this,r),+new Date-+this.__lastTouchMoment<uue&&yh.click.call(this,r)},pointerdown:function(r){yh.mousedown.call(this,r)},pointermove:function(r){VR(r)||yh.mousemove.call(this,r)},pointerup:function(r){yh.mouseup.call(this,r)},pointerout:function(r){VR(r)||yh.mouseout.call(this,r)}};se(["click","dblclick","contextmenu"],function(r){yh[r]=function(e){e=uc(this.dom,e),this.trigger(r,e)}});var UR={pointermove:function(r){VR(r)||UR.mousemove.call(this,r)},pointerup:function(r){UR.mouseup.call(this,r)},mousemove:function(r){this.trigger("mousemove",r)},mouseup:function(r){var e=this.__pointerCapturing;this.__togglePointerCapture(!1),this.trigger("mouseup",r),e&&(r.zrEventControl="only_globalout",this.trigger("mouseout",r))}};function due(r,e){var t=e.domHandlers;Gr.pointerEventsSupported?se(RE.pointer,function(i){D2(e,i,function(n){t[i].call(r,n)})}):(Gr.touchEventsSupported&&se(RE.touch,function(i){D2(e,i,function(n){t[i].call(r,n),cue(e)})}),se(RE.mouse,function(i){D2(e,i,function(n){n=_k(n),e.touching||t[i].call(r,n)})}))}function pue(r,e){Gr.pointerEventsSupported?se(S4.pointer,t):Gr.touchEventsSupported||se(S4.mouse,t);function t(i){function n(a){a=_k(a),g$(r,a.target)||(a=hue(r,a),e.domHandlers[i].call(r,a))}D2(e,i,n,{capture:!0})}}function D2(r,e,t,i){r.mounted[e]=t,r.listenerOpts[e]=i,DR(r.domTarget,e,t,i)}function kE(r){var e=r.mounted;for(var t in e)e.hasOwnProperty(t)&&Tle(r.domTarget,t,e[t],r.listenerOpts[t]);r.mounted={}}var A4=(function(){function r(e,t){this.mounted={},this.listenerOpts={},this.touching=!1,this.domTarget=e,this.domHandlers=t}return r})(),gue=(function(r){Ye(e,r);function e(t,i){var n=r.call(this)||this;return n.__pointerCapturing=!1,n.dom=t,n.painterRoot=i,n._localHandlerScope=new A4(t,yh),PE&&(n._globalHandlerScope=new A4(document,UR)),due(n,n._localHandlerScope),n}return e.prototype.dispose=function(){kE(this._localHandlerScope),PE&&kE(this._globalHandlerScope)},e.prototype.setCursor=function(t){this.dom.style&&(this.dom.style.cursor=t||"default")},e.prototype.__togglePointerCapture=function(t){if(this.__mayPointerCapture=null,PE&&+this.__pointerCapturing^+t){this.__pointerCapturing=t;var i=this._globalHandlerScope;t?pue(this,i):kE(i)}},e})(Cc),v$=1;Gr.hasGlobalWindow&&(v$=Math.max(window.devicePixelRatio||window.screen&&window.screen.deviceXDPI/window.screen.logicalXDPI||1,1));var SA=v$,HR=.4,jR="#333",$R="#ccc",vue="#eee",C4=jw,M4=5e-5;function sm(r){return r>M4||r<-M4}var lm=[],V_=[],LE=kl(),OE=Math.abs,np=(function(){function r(){}return r.prototype.getLocalTransform=function(e){return r.getLocalTransform(this,e)},r.prototype.setPosition=function(e){this.x=e[0],this.y=e[1]},r.prototype.setScale=function(e){this.scaleX=e[0],this.scaleY=e[1]},r.prototype.setSkew=function(e){this.skewX=e[0],this.skewY=e[1]},r.prototype.setOrigin=function(e){this.originX=e[0],this.originY=e[1]},r.prototype.needLocalTransform=function(){return sm(this.rotation)||sm(this.x)||sm(this.y)||sm(this.scaleX-1)||sm(this.scaleY-1)||sm(this.skewX)||sm(this.skewY)},r.prototype.updateTransform=function(){var e=this.parent&&this.parent.transform,t=this.needLocalTransform(),i=this.transform;if(!(t||e)){i&&(C4(i),this.invTransform=null);return}i=i||kl(),t?this.getLocalTransform(i):C4(i),e&&(t?zf(i,e,i):MC(i,e)),this.transform=i,this._resolveGlobalScaleRatio(i)},r.prototype._resolveGlobalScaleRatio=function(e){var t=this.globalScaleRatio;if(t!=null&&t!==1){this.getGlobalScale(lm);var i=lm[0]<0?-1:1,n=lm[1]<0?-1:1,a=((lm[0]-i)*t+i)/lm[0]||0,s=((lm[1]-n)*t+n)/lm[1]||0;e[0]*=a,e[1]*=a,e[2]*=s,e[3]*=s}this.invTransform=this.invTransform||kl(),Ey(this.invTransform,e)},r.prototype.getComputedTransform=function(){for(var e=this,t=[];e;)t.push(e),e=e.parent;for(;e=t.pop();)e.updateTransform();return this.transform},r.prototype.setLocalTransform=function(e){if(e){var t=e[0]*e[0]+e[1]*e[1],i=e[2]*e[2]+e[3]*e[3],n=Math.atan2(e[1],e[0]),a=Math.PI/2+n-Math.atan2(e[3],e[2]);i=Math.sqrt(i)*Math.cos(a),t=Math.sqrt(t),this.skewX=a,this.skewY=0,this.rotation=-n,this.x=+e[4],this.y=+e[5],this.scaleX=t,this.scaleY=i,this.originX=0,this.originY=0}},r.prototype.decomposeTransform=function(){if(this.transform){var e=this.parent,t=this.transform;e&&e.transform&&(e.invTransform=e.invTransform||kl(),zf(V_,e.invTransform,t),t=V_);var i=this.originX,n=this.originY;(i||n)&&(LE[4]=i,LE[5]=n,zf(V_,t,LE),V_[4]-=i,V_[5]-=n,t=V_),this.setLocalTransform(t)}},r.prototype.getGlobalScale=function(e){var t=this.transform;return e=e||[],t?(e[0]=Math.sqrt(t[0]*t[0]+t[1]*t[1]),e[1]=Math.sqrt(t[2]*t[2]+t[3]*t[3]),t[0]<0&&(e[0]=-e[0]),t[3]<0&&(e[1]=-e[1]),e):(e[0]=1,e[1]=1,e)},r.prototype.transformCoordToLocal=function(e,t){var i=[e,t],n=this.invTransform;return n&&Ro(i,i,n),i},r.prototype.transformCoordToGlobal=function(e,t){var i=[e,t],n=this.transform;return n&&Ro(i,i,n),i},r.prototype.getLineScale=function(){var e=this.transform;return e&&OE(e[0]-1)>1e-10&&OE(e[3]-1)>1e-10?Math.sqrt(OE(e[0]*e[3]-e[2]*e[1])):1},r.prototype.copyTransform=function(e){m$(this,e)},r.getLocalTransform=function(e,t){t=t||[];var i=e.originX||0,n=e.originY||0,a=e.scaleX,s=e.scaleY,o=e.anchorX,l=e.anchorY,c=e.rotation||0,f=e.x,p=e.y,y=e.skewX?Math.tan(e.skewX):0,b=e.skewY?Math.tan(-e.skewY):0;if(i||n||o||l){var S=i+o,C=n+l;t[4]=-S*a-y*C*s,t[5]=-C*s-b*S*a}else t[4]=t[5]=0;return t[0]=a,t[3]=s,t[1]=b*a,t[2]=y*s,c&&Zg(t,t,c),t[4]+=i+f,t[5]+=n+p,t},r.initDefaultProps=(function(){var e=r.prototype;e.scaleX=e.scaleY=e.globalScaleRatio=1,e.x=e.y=e.originX=e.originY=e.skewX=e.skewY=e.rotation=e.anchorX=e.anchorY=0})(),r})(),Uf=["x","y","originX","originY","anchorX","anchorY","rotation","scaleX","scaleY","skewX","skewY"];function m$(r,e){for(var t=0;t<Uf.length;t++){var i=Uf[t];r[i]=e[i]}}var E4={};function bu(r,e){e=e||Ug;var t=E4[e];t||(t=E4[e]=new $w(500));var i=t.get(r);return i==null&&(i=Ih.measureText(r,e).width,t.put(r,i)),i}function I4(r,e,t,i){var n=bu(r,e),a=PC(e),s=v1(0,n,t),o=u0(0,a,i),l=new Dr(s,o,n,a);return l}function Ww(r,e,t,i){var n=((r||"")+"").split(`
`),a=n.length;if(a===1)return I4(n[0],e,t,i);for(var s=new Dr(0,0,0,0),o=0;o<n.length;o++){var l=I4(n[o],e,t,i);o===0?s.copy(l):s.union(l)}return s}function v1(r,e,t){return t==="right"?r-=e:t==="center"&&(r-=e/2),r}function u0(r,e,t){return t==="middle"?r-=e/2:t==="bottom"&&(r-=e),r}function PC(r){return bu("国",r)}function Rh(r,e){return typeof r=="string"?r.lastIndexOf("%")>=0?parseFloat(r)/100*e:parseFloat(r):r}function TA(r,e,t){var i=e.position||"inside",n=e.distance!=null?e.distance:5,a=t.height,s=t.width,o=a/2,l=t.x,c=t.y,f="left",p="top";if(i instanceof Array)l+=Rh(i[0],t.width),c+=Rh(i[1],t.height),f=null,p=null;else switch(i){case"left":l-=n,c+=o,f="right",p="middle";break;case"right":l+=n+s,c+=o,p="middle";break;case"top":l+=s/2,c-=n,f="center",p="bottom";break;case"bottom":l+=s/2,c+=a+n,f="center";break;case"inside":l+=s/2,c+=o,f="center",p="middle";break;case"insideLeft":l+=n,c+=o,p="middle";break;case"insideRight":l+=s-n,c+=o,f="right",p="middle";break;case"insideTop":l+=s/2,c+=n,f="center";break;case"insideBottom":l+=s/2,c+=a-n,f="center",p="bottom";break;case"insideTopLeft":l+=n,c+=n;break;case"insideTopRight":l+=s-n,c+=n,f="right";break;case"insideBottomLeft":l+=n,c+=a-n,p="bottom";break;case"insideBottomRight":l+=s-n,c+=a-n,f="right",p="bottom";break}return r=r||{},r.x=l,r.y=c,r.align=f,r.verticalAlign=p,r}var NE="__zr_normal__",BE=Uf.concat(["ignore"]),mue=Sc(Uf,function(r,e){return r[e]=!0,r},{ignore:!1}),U_={},yue=new Dr(0,0,0,0),RC=(function(){function r(e){this.id=gk(),this.animators=[],this.currentStates=[],this.states={},this._init(e)}return r.prototype._init=function(e){this.attr(e)},r.prototype.drift=function(e,t,i){switch(this.draggable){case"horizontal":t=0;break;case"vertical":e=0;break}var n=this.transform;n||(n=this.transform=[1,0,0,1,0,0]),n[4]+=e,n[5]+=t,this.decomposeTransform(),this.markRedraw()},r.prototype.beforeUpdate=function(){},r.prototype.afterUpdate=function(){},r.prototype.update=function(){this.updateTransform(),this.__dirty&&this.updateInnerText()},r.prototype.updateInnerText=function(e){var t=this._textContent;if(t&&(!t.ignore||e)){this.textConfig||(this.textConfig={});var i=this.textConfig,n=i.local,a=t.innerTransformable,s=void 0,o=void 0,l=!1;a.parent=n?this:null;var c=!1;if(a.copyTransform(t),i.position!=null){var f=yue;i.layoutRect?f.copy(i.layoutRect):f.copy(this.getBoundingRect()),n||f.applyTransform(this.transform),this.calculateTextPosition?this.calculateTextPosition(U_,i,f):TA(U_,i,f),a.x=U_.x,a.y=U_.y,s=U_.align,o=U_.verticalAlign;var p=i.origin;if(p&&i.rotation!=null){var y=void 0,b=void 0;p==="center"?(y=f.width*.5,b=f.height*.5):(y=Rh(p[0],f.width),b=Rh(p[1],f.height)),c=!0,a.originX=-a.x+y+(n?0:f.x),a.originY=-a.y+b+(n?0:f.y)}}i.rotation!=null&&(a.rotation=i.rotation);var S=i.offset;S&&(a.x+=S[0],a.y+=S[1],c||(a.originX=-S[0],a.originY=-S[1]));var C=i.inside==null?typeof i.position=="string"&&i.position.indexOf("inside")>=0:i.inside,E=this._innerTextDefaultStyle||(this._innerTextDefaultStyle={}),P=void 0,O=void 0,B=void 0;C&&this.canBeInsideText()?(P=i.insideFill,O=i.insideStroke,(P==null||P==="auto")&&(P=this.getInsideTextFill()),(O==null||O==="auto")&&(O=this.getInsideTextStroke(P),B=!0)):(P=i.outsideFill,O=i.outsideStroke,(P==null||P==="auto")&&(P=this.getOutsideFill()),(O==null||O==="auto")&&(O=this.getOutsideStroke(P),B=!0)),P=P||"#000",(P!==E.fill||O!==E.stroke||B!==E.autoStroke||s!==E.align||o!==E.verticalAlign)&&(l=!0,E.fill=P,E.stroke=O,E.autoStroke=B,E.align=s,E.verticalAlign=o,t.setDefaultTextStyle(E)),t.__dirty|=gu,l&&t.dirtyStyle(!0)}},r.prototype.canBeInsideText=function(){return!0},r.prototype.getInsideTextFill=function(){return"#fff"},r.prototype.getInsideTextStroke=function(e){return"#000"},r.prototype.getOutsideFill=function(){return this.__zr&&this.__zr.isDarkMode()?$R:jR},r.prototype.getOutsideStroke=function(e){var t=this.__zr&&this.__zr.getBackgroundColor(),i=typeof t=="string"&&al(t);i||(i=[255,255,255,1]);for(var n=i[3],a=this.__zr.isDarkMode(),s=0;s<3;s++)i[s]=i[s]*n+(a?0:255)*(1-n);return i[3]=1,Ch(i,"rgba")},r.prototype.traverse=function(e,t){},r.prototype.attrKV=function(e,t){e==="textConfig"?this.setTextConfig(t):e==="textContent"?this.setTextContent(t):e==="clipPath"?this.setClipPath(t):e==="extra"?(this.extra=this.extra||{},mt(this.extra,t)):this[e]=t},r.prototype.hide=function(){this.ignore=!0,this.markRedraw()},r.prototype.show=function(){this.ignore=!1,this.markRedraw()},r.prototype.attr=function(e,t){if(typeof e=="string")this.attrKV(e,t);else if(cr(e))for(var i=e,n=qr(i),a=0;a<n.length;a++){var s=n[a];this.attrKV(s,e[s])}return this.markRedraw(),this},r.prototype.saveCurrentToNormalState=function(e){this._innerSaveToNormal(e);for(var t=this._normalState,i=0;i<this.animators.length;i++){var n=this.animators[i],a=n.__fromStateTransition;if(!(n.getLoop()||a&&a!==NE)){var s=n.targetName,o=s?t[s]:t;n.saveTo(o)}}},r.prototype._innerSaveToNormal=function(e){var t=this._normalState;t||(t=this._normalState={}),e.textConfig&&!t.textConfig&&(t.textConfig=this.textConfig),this._savePrimaryToNormal(e,t,BE)},r.prototype._savePrimaryToNormal=function(e,t,i){for(var n=0;n<i.length;n++){var a=i[n];e[a]!=null&&!(a in t)&&(t[a]=this[a])}},r.prototype.hasState=function(){return this.currentStates.length>0},r.prototype.getState=function(e){return this.states[e]},r.prototype.ensureState=function(e){var t=this.states;return t[e]||(t[e]={}),t[e]},r.prototype.clearStates=function(e){this.useState(NE,!1,e)},r.prototype.useState=function(e,t,i,n){var a=e===NE,s=this.hasState();if(!(!s&&a)){var o=this.currentStates,l=this.stateTransition;if(!(Or(o,e)>=0&&(t||o.length===1))){var c;if(this.stateProxy&&!a&&(c=this.stateProxy(e)),c||(c=this.states&&this.states[e]),!c&&!a){SC("State "+e+" not exists.");return}a||this.saveCurrentToNormalState(c);var f=!!(c&&c.hoverLayer||n);f&&this._toggleHoverLayerFlag(!0),this._applyStateObj(e,c,this._normalState,t,!i&&!this.__inHover&&l&&l.duration>0,l);var p=this._textContent,y=this._textGuide;return p&&p.useState(e,t,i,f),y&&y.useState(e,t,i,f),a?(this.currentStates=[],this._normalState={}):t?this.currentStates.push(e):this.currentStates=[e],this._updateAnimationTargets(),this.markRedraw(),!f&&this.__inHover&&(this._toggleHoverLayerFlag(!1),this.__dirty&=~gu),c}}},r.prototype.useStates=function(e,t,i){if(!e.length)this.clearStates();else{var n=[],a=this.currentStates,s=e.length,o=s===a.length;if(o){for(var l=0;l<s;l++)if(e[l]!==a[l]){o=!1;break}}if(o)return;for(var l=0;l<s;l++){var c=e[l],f=void 0;this.stateProxy&&(f=this.stateProxy(c,e)),f||(f=this.states[c]),f&&n.push(f)}var p=n[s-1],y=!!(p&&p.hoverLayer||i);y&&this._toggleHoverLayerFlag(!0);var b=this._mergeStates(n),S=this.stateTransition;this.saveCurrentToNormalState(b),this._applyStateObj(e.join(","),b,this._normalState,!1,!t&&!this.__inHover&&S&&S.duration>0,S);var C=this._textContent,E=this._textGuide;C&&C.useStates(e,t,y),E&&E.useStates(e,t,y),this._updateAnimationTargets(),this.currentStates=e.slice(),this.markRedraw(),!y&&this.__inHover&&(this._toggleHoverLayerFlag(!1),this.__dirty&=~gu)}},r.prototype.isSilent=function(){for(var e=this.silent,t=this.parent;!e&&t;){if(t.silent){e=!0;break}t=t.parent}return e},r.prototype._updateAnimationTargets=function(){for(var e=0;e<this.animators.length;e++){var t=this.animators[e];t.targetName&&t.changeTarget(this[t.targetName])}},r.prototype.removeState=function(e){var t=Or(this.currentStates,e);if(t>=0){var i=this.currentStates.slice();i.splice(t,1),this.useStates(i)}},r.prototype.replaceState=function(e,t,i){var n=this.currentStates.slice(),a=Or(n,e),s=Or(n,t)>=0;a>=0?s?n.splice(a,1):n[a]=t:i&&!s&&n.push(t),this.useStates(n)},r.prototype.toggleState=function(e,t){t?this.useState(e,!0):this.removeState(e)},r.prototype._mergeStates=function(e){for(var t={},i,n=0;n<e.length;n++){var a=e[n];mt(t,a),a.textConfig&&(i=i||{},mt(i,a.textConfig))}return i&&(t.textConfig=i),t},r.prototype._applyStateObj=function(e,t,i,n,a,s){var o=!(t&&n);t&&t.textConfig?(this.textConfig=mt({},n?this.textConfig:i.textConfig),mt(this.textConfig,t.textConfig)):o&&i.textConfig&&(this.textConfig=i.textConfig);for(var l={},c=!1,f=0;f<BE.length;f++){var p=BE[f],y=a&&mue[p];t&&t[p]!=null?y?(c=!0,l[p]=t[p]):this[p]=t[p]:o&&i[p]!=null&&(y?(c=!0,l[p]=i[p]):this[p]=i[p])}if(!a)for(var f=0;f<this.animators.length;f++){var b=this.animators[f],S=b.targetName;b.getLoop()||b.__changeFinalValue(S?(t||i)[S]:t||i)}c&&this._transitionState(e,l,s)},r.prototype._attachComponent=function(e){if(!(e.__zr&&!e.__hostTarget)&&e!==this){var t=this.__zr;t&&e.addSelfToZr(t),e.__zr=t,e.__hostTarget=this}},r.prototype._detachComponent=function(e){e.__zr&&e.removeSelfFromZr(e.__zr),e.__zr=null,e.__hostTarget=null},r.prototype.getClipPath=function(){return this._clipPath},r.prototype.setClipPath=function(e){this._clipPath&&this._clipPath!==e&&this.removeClipPath(),this._attachComponent(e),this._clipPath=e,this.markRedraw()},r.prototype.removeClipPath=function(){var e=this._clipPath;e&&(this._detachComponent(e),this._clipPath=null,this.markRedraw())},r.prototype.getTextContent=function(){return this._textContent},r.prototype.setTextContent=function(e){var t=this._textContent;t!==e&&(t&&t!==e&&this.removeTextContent(),e.innerTransformable=new np,this._attachComponent(e),this._textContent=e,this.markRedraw())},r.prototype.setTextConfig=function(e){this.textConfig||(this.textConfig={}),mt(this.textConfig,e),this.markRedraw()},r.prototype.removeTextConfig=function(){this.textConfig=null,this.markRedraw()},r.prototype.removeTextContent=function(){var e=this._textContent;e&&(e.innerTransformable=null,this._detachComponent(e),this._textContent=null,this._innerTextDefaultStyle=null,this.markRedraw())},r.prototype.getTextGuideLine=function(){return this._textGuide},r.prototype.setTextGuideLine=function(e){this._textGuide&&this._textGuide!==e&&this.removeTextGuideLine(),this._attachComponent(e),this._textGuide=e,this.markRedraw()},r.prototype.removeTextGuideLine=function(){var e=this._textGuide;e&&(this._detachComponent(e),this._textGuide=null,this.markRedraw())},r.prototype.markRedraw=function(){this.__dirty|=gu;var e=this.__zr;e&&(this.__inHover?e.refreshHover():e.refresh()),this.__hostTarget&&this.__hostTarget.markRedraw()},r.prototype.dirty=function(){this.markRedraw()},r.prototype._toggleHoverLayerFlag=function(e){this.__inHover=e;var t=this._textContent,i=this._textGuide;t&&(t.__inHover=e),i&&(i.__inHover=e)},r.prototype.addSelfToZr=function(e){if(this.__zr!==e){this.__zr=e;var t=this.animators;if(t)for(var i=0;i<t.length;i++)e.animation.addAnimator(t[i]);this._clipPath&&this._clipPath.addSelfToZr(e),this._textContent&&this._textContent.addSelfToZr(e),this._textGuide&&this._textGuide.addSelfToZr(e)}},r.prototype.removeSelfFromZr=function(e){if(this.__zr){this.__zr=null;var t=this.animators;if(t)for(var i=0;i<t.length;i++)e.animation.removeAnimator(t[i]);this._clipPath&&this._clipPath.removeSelfFromZr(e),this._textContent&&this._textContent.removeSelfFromZr(e),this._textGuide&&this._textGuide.removeSelfFromZr(e)}},r.prototype.animate=function(e,t,i){var n=e?this[e]:this,a=new Sk(n,t,i);return e&&(a.targetName=e),this.addAnimator(a,e),a},r.prototype.addAnimator=function(e,t){var i=this.__zr,n=this;e.during(function(){n.updateDuringAnimation(t)}).done(function(){var a=n.animators,s=Or(a,e);s>=0&&a.splice(s,1)}),this.animators.push(e),i&&i.animation.addAnimator(e),i&&i.wakeUp()},r.prototype.updateDuringAnimation=function(e){this.markRedraw()},r.prototype.stopAnimation=function(e,t){for(var i=this.animators,n=i.length,a=[],s=0;s<n;s++){var o=i[s];!e||e===o.scope?o.stop(t):a.push(o)}return this.animators=a,this},r.prototype.animateTo=function(e,t,i){zE(this,e,t,i)},r.prototype.animateFrom=function(e,t,i){zE(this,e,t,i,!0)},r.prototype._transitionState=function(e,t,i,n){for(var a=zE(this,t,i,n),s=0;s<a.length;s++)a[s].__fromStateTransition=e},r.prototype.getBoundingRect=function(){return null},r.prototype.getPaintRect=function(){return null},r.initDefaultProps=(function(){var e=r.prototype;e.type="element",e.name="",e.ignore=e.silent=e.isGroup=e.draggable=e.dragging=e.ignoreClip=e.__inHover=!1,e.__dirty=gu;function t(i,n,a,s){Object.defineProperty(e,i,{get:function(){if(!this[n]){var l=this[n]=[];o(this,l)}return this[n]},set:function(l){this[a]=l[0],this[s]=l[1],this[n]=l,o(this,l)}});function o(l,c){Object.defineProperty(c,0,{get:function(){return l[a]},set:function(f){l[a]=f}}),Object.defineProperty(c,1,{get:function(){return l[s]},set:function(f){l[s]=f}})}}Object.defineProperty&&(t("position","_legacyPos","x","y"),t("scale","_legacyScale","scaleX","scaleY"),t("origin","_legacyOrigin","originX","originY"))})(),r})();ha(RC,Cc);ha(RC,np);function zE(r,e,t,i,n){t=t||{};var a=[];y$(r,"",r,e,t,i,a,n);var s=a.length,o=!1,l=t.done,c=t.aborted,f=function(){o=!0,s--,s<=0&&(o?l&&l():c&&c())},p=function(){s--,s<=0&&(o?l&&l():c&&c())};s||l&&l(),a.length>0&&t.during&&a[0].during(function(S,C){t.during(C)});for(var y=0;y<a.length;y++){var b=a[y];f&&b.done(f),p&&b.aborted(p),t.force&&b.duration(t.duration),b.start(t.easing)}return a}function FE(r,e,t){for(var i=0;i<t;i++)r[i]=e[i]}function _ue(r){return es(r[0])}function bue(r,e,t){if(es(e[t]))if(es(r[t])||(r[t]=[]),sl(e[t])){var i=e[t].length;r[t].length!==i&&(r[t]=new e[t].constructor(i),FE(r[t],e[t],i))}else{var n=e[t],a=r[t],s=n.length;if(_ue(n))for(var o=n[0].length,l=0;l<s;l++)a[l]?FE(a[l],n[l],o):a[l]=Array.prototype.slice.call(n[l]);else FE(a,n,s);a.length=n.length}else r[t]=e[t]}function xue(r,e){return r===e||es(r)&&es(e)&&wue(r,e)}function wue(r,e){var t=r.length;if(t!==e.length)return!1;for(var i=0;i<t;i++)if(r[i]!==e[i])return!1;return!0}function y$(r,e,t,i,n,a,s,o){for(var l=qr(i),c=n.duration,f=n.delay,p=n.additive,y=n.setToFinal,b=!cr(a),S=r.animators,C=[],E=0;E<l.length;E++){var P=l[E],O=i[P];if(O!=null&&t[P]!=null&&(b||a[P]))if(cr(O)&&!es(O)&&!Uw(O)){if(e){o||(t[P]=O,r.updateDuringAnimation(e));continue}y$(r,P,t[P],O,n,a&&a[P],s,o)}else C.push(P);else o||(t[P]=O,r.updateDuringAnimation(e),C.push(P))}var B=C.length;if(!p&&B)for(var F=0;F<S.length;F++){var W=S[F];if(W.targetName===e){var $=W.stopTracks(C);if($){var q=Or(S,W);S.splice(q,1)}}}if(n.force||(C=wi(C,function(ae){return!xue(i[ae],t[ae])}),B=C.length),B>0||n.force&&!s.length){var Q=void 0,ee=void 0,te=void 0;if(o){ee={},y&&(Q={});for(var F=0;F<B;F++){var P=C[F];ee[P]=t[P],y?Q[P]=i[P]:t[P]=i[P]}}else if(y){te={};for(var F=0;F<B;F++){var P=C[F];te[P]=V1(t[P]),bue(t,i,P)}}var W=new Sk(t,!1,!1,p?wi(S,function(de){return de.targetName===e}):null);W.targetName=e,n.scope&&(W.scope=n.scope),y&&Q&&W.whenWithKeys(0,Q,C),te&&W.whenWithKeys(0,te,C),W.whenWithKeys(c??500,o?ee:i,C).delay(f||0),r.addAnimator(W,e),s.push(W)}}var mr=(function(r){Ye(e,r);function e(t){var i=r.call(this)||this;return i.isGroup=!0,i._children=[],i.attr(t),i}return e.prototype.childrenRef=function(){return this._children},e.prototype.children=function(){return this._children.slice()},e.prototype.childAt=function(t){return this._children[t]},e.prototype.childOfName=function(t){for(var i=this._children,n=0;n<i.length;n++)if(i[n].name===t)return i[n]},e.prototype.childCount=function(){return this._children.length},e.prototype.add=function(t){return t&&t!==this&&t.parent!==this&&(this._children.push(t),this._doAdd(t)),this},e.prototype.addBefore=function(t,i){if(t&&t!==this&&t.parent!==this&&i&&i.parent===this){var n=this._children,a=n.indexOf(i);a>=0&&(n.splice(a,0,t),this._doAdd(t))}return this},e.prototype.replace=function(t,i){var n=Or(this._children,t);return n>=0&&this.replaceAt(i,n),this},e.prototype.replaceAt=function(t,i){var n=this._children,a=n[i];if(t&&t!==this&&t.parent!==this&&t!==a){n[i]=t,a.parent=null;var s=this.__zr;s&&a.removeSelfFromZr(s),this._doAdd(t)}return this},e.prototype._doAdd=function(t){t.parent&&t.parent.remove(t),t.parent=this;var i=this.__zr;i&&i!==t.__zr&&t.addSelfToZr(i),i&&i.refresh()},e.prototype.remove=function(t){var i=this.__zr,n=this._children,a=Or(n,t);return a<0?this:(n.splice(a,1),t.parent=null,i&&t.removeSelfFromZr(i),i&&i.refresh(),this)},e.prototype.removeAll=function(){for(var t=this._children,i=this.__zr,n=0;n<t.length;n++){var a=t[n];i&&a.removeSelfFromZr(i),a.parent=null}return t.length=0,this},e.prototype.eachChild=function(t,i){for(var n=this._children,a=0;a<n.length;a++){var s=n[a];t.call(i,s,a)}return this},e.prototype.traverse=function(t,i){for(var n=0;n<this._children.length;n++){var a=this._children[n],s=t.call(i,a);a.isGroup&&!s&&a.traverse(t,i)}return this},e.prototype.addSelfToZr=function(t){r.prototype.addSelfToZr.call(this,t);for(var i=0;i<this._children.length;i++){var n=this._children[i];n.addSelfToZr(t)}},e.prototype.removeSelfFromZr=function(t){r.prototype.removeSelfFromZr.call(this,t);for(var i=0;i<this._children.length;i++){var n=this._children[i];n.removeSelfFromZr(t)}},e.prototype.getBoundingRect=function(t){for(var i=new Dr(0,0,0,0),n=t||this._children,a=[],s=null,o=0;o<n.length;o++){var l=n[o];if(!(l.ignore||l.invisible)){var c=l.getBoundingRect(),f=l.getLocalTransform(a);f?(Dr.applyTransform(i,c,f),s=s||i.clone(),s.union(i)):(s=s||c.clone(),s.union(c))}}return s||i},e})(RC);mr.prototype.type="group";/*!
* ZRender, a high performance 2d drawing library.
*
* Copyright (c) 2013, Baidu Inc.
* All rights reserved.
*
* LICENSE
* https://github.com/ecomfe/zrender/blob/master/LICENSE.txt
*/var k2={},Um={};function Sue(r){delete Um[r]}function Tue(r){if(!r)return!1;if(typeof r=="string")return hw(r,1)<HR;if(r.colorStops){for(var e=r.colorStops,t=0,i=e.length,n=0;n<i;n++)t+=hw(e[n].color,1);return t/=i,t<HR}return!1}var Aue=(function(){function r(e,t,i){var n=this;this._sleepAfterStill=10,this._stillFrameAccum=0,this._needsRefresh=!0,this._needsRefreshHover=!0,this._darkMode=!1,i=i||{},this.dom=t,this.id=e;var a=new Nle,s=i.renderer||"canvas";k2[s]||(s=qr(k2)[0]),i.useDirtyRect=i.useDirtyRect==null?!1:i.useDirtyRect;var o=new k2[s](t,a,i,e),l=i.ssr||o.ssrOnly;this.storage=a,this.painter=o;var c=!Gr.node&&!Gr.worker&&!l?new gue(o.getViewportRoot(),o.root):null,f=i.useCoarsePointer,p=f==null||f==="auto"?Gr.touchEventsSupported:!!f,y=44,b;p&&(b=wr(i.pointerSize,y)),this.handler=new Kj(a,o,c,o.root,b),this.animation=new lue({stage:{update:l?null:function(){return n._flush(!0)}}}),l||this.animation.start()}return r.prototype.add=function(e){this._disposed||!e||(this.storage.addRoot(e),e.addSelfToZr(this),this.refresh())},r.prototype.remove=function(e){this._disposed||!e||(this.storage.delRoot(e),e.removeSelfFromZr(this),this.refresh())},r.prototype.configLayer=function(e,t){this._disposed||(this.painter.configLayer&&this.painter.configLayer(e,t),this.refresh())},r.prototype.setBackgroundColor=function(e){this._disposed||(this.painter.setBackgroundColor&&this.painter.setBackgroundColor(e),this.refresh(),this._backgroundColor=e,this._darkMode=Tue(e))},r.prototype.getBackgroundColor=function(){return this._backgroundColor},r.prototype.setDarkMode=function(e){this._darkMode=e},r.prototype.isDarkMode=function(){return this._darkMode},r.prototype.refreshImmediately=function(e){this._disposed||(e||this.animation.update(!0),this._needsRefresh=!1,this.painter.refresh(),this._needsRefresh=!1)},r.prototype.refresh=function(){this._disposed||(this._needsRefresh=!0,this.animation.start())},r.prototype.flush=function(){this._disposed||this._flush(!1)},r.prototype._flush=function(e){var t,i=_0();this._needsRefresh&&(t=!0,this.refreshImmediately(e)),this._needsRefreshHover&&(t=!0,this.refreshHoverImmediately());var n=_0();t?(this._stillFrameAccum=0,this.trigger("rendered",{elapsedTime:n-i})):this._sleepAfterStill>0&&(this._stillFrameAccum++,this._stillFrameAccum>this._sleepAfterStill&&this.animation.stop())},r.prototype.setSleepAfterStill=function(e){this._sleepAfterStill=e},r.prototype.wakeUp=function(){this._disposed||(this.animation.start(),this._stillFrameAccum=0)},r.prototype.refreshHover=function(){this._needsRefreshHover=!0},r.prototype.refreshHoverImmediately=function(){this._disposed||(this._needsRefreshHover=!1,this.painter.refreshHover&&this.painter.getType()==="canvas"&&this.painter.refreshHover())},r.prototype.resize=function(e){this._disposed||(e=e||{},this.painter.resize(e.width,e.height),this.handler.resize())},r.prototype.clearAnimation=function(){this._disposed||this.animation.clear()},r.prototype.getWidth=function(){if(!this._disposed)return this.painter.getWidth()},r.prototype.getHeight=function(){if(!this._disposed)return this.painter.getHeight()},r.prototype.setCursorStyle=function(e){this._disposed||this.handler.setCursorStyle(e)},r.prototype.findHover=function(e,t){if(!this._disposed)return this.handler.findHover(e,t)},r.prototype.on=function(e,t,i){return this._disposed||this.handler.on(e,t,i),this},r.prototype.off=function(e,t){this._disposed||this.handler.off(e,t)},r.prototype.trigger=function(e,t){this._disposed||this.handler.trigger(e,t)},r.prototype.clear=function(){if(!this._disposed){for(var e=this.storage.getRoots(),t=0;t<e.length;t++)e[t]instanceof mr&&e[t].removeSelfFromZr(this);this.storage.delAllRoots(),this.painter.clear()}},r.prototype.dispose=function(){this._disposed||(this.animation.stop(),this.clear(),this.storage.dispose(),this.painter.dispose(),this.handler.dispose(),this.animation=this.storage=this.painter=this.handler=null,this._disposed=!0,Sue(this.id))},r})();function WR(r,e){var t=new Aue(gk(),r,e);return Um[t.id]=t,t}function Cue(r){r.dispose()}function Mue(){for(var r in Um)Um.hasOwnProperty(r)&&Um[r].dispose();Um={}}function Eue(r){return Um[r]}function _$(r,e){k2[r]=e}var GR;function b$(r){if(typeof GR=="function")return GR(r)}function x$(r){GR=r}var Iue="5.6.1";const Pue=Object.freeze(Object.defineProperty({__proto__:null,dispose:Cue,disposeAll:Mue,getElementSSRData:b$,getInstance:Eue,init:WR,registerPainter:_$,registerSSRDataGetter:x$,version:Iue},Symbol.toStringTag,{value:"Module"}));var P4=1e-4,w$=20;function Rue(r){return r.replace(/^\s+|\s+$/g,"")}function Ii(r,e,t,i){var n=e[0],a=e[1],s=t[0],o=t[1],l=a-n,c=o-s;if(l===0)return c===0?s:(s+o)/2;if(i)if(l>0){if(r<=n)return s;if(r>=a)return o}else{if(r>=n)return s;if(r<=a)return o}else{if(r===n)return s;if(r===a)return o}return(r-n)/l*c+s}function Vt(r,e){switch(r){case"center":case"middle":r="50%";break;case"left":case"top":r="0%";break;case"right":case"bottom":r="100%";break}return $t(r)?Rue(r).match(/%$/)?parseFloat(r)/100*e:parseFloat(r):r==null?NaN:+r}function Qn(r,e,t){return e==null&&(e=10),e=Math.min(Math.max(0,e),w$),r=(+r).toFixed(e),t?r:+r}function yu(r){return r.sort(function(e,t){return e-t}),r}function wh(r){if(r=+r,isNaN(r))return 0;if(r>1e-14){for(var e=1,t=0;t<15;t++,e*=10)if(Math.round(r*e)/e===r)return t}return S$(r)}function S$(r){var e=r.toString().toLowerCase(),t=e.indexOf("e"),i=t>0?+e.slice(t+1):0,n=t>0?t:e.length,a=e.indexOf("."),s=a<0?0:n-1-a;return Math.max(0,s-i)}function Tk(r,e){var t=Math.log,i=Math.LN10,n=Math.floor(t(r[1]-r[0])/i),a=Math.round(t(Math.abs(e[1]-e[0]))/i),s=Math.min(Math.max(-n+a,0),20);return isFinite(s)?s:20}function Due(r,e,t){if(!r[e])return 0;var i=T$(r,t);return i[e]||0}function T$(r,e){var t=Sc(r,function(b,S){return b+(isNaN(S)?0:S)},0);if(t===0)return[];for(var i=Math.pow(10,e),n=wt(r,function(b){return(isNaN(b)?0:b)/t*i*100}),a=i*100,s=wt(n,function(b){return Math.floor(b)}),o=Sc(s,function(b,S){return b+S},0),l=wt(n,function(b,S){return b-s[S]});o<a;){for(var c=Number.NEGATIVE_INFINITY,f=null,p=0,y=l.length;p<y;++p)l[p]>c&&(c=l[p],f=p);++s[f],l[f]=0,++o}return wt(s,function(b){return b/i})}function kue(r,e){var t=Math.max(wh(r),wh(e)),i=r+e;return t>w$?i:Qn(i,t)}var XR=9007199254740991;function Ak(r){var e=Math.PI*2;return(r%e+e)%e}function W0(r){return r>-P4&&r<P4}var Lue=/^(?:(\d{4})(?:[-\/](\d{1,2})(?:[-\/](\d{1,2})(?:[T ](\d{1,2})(?::(\d{1,2})(?::(\d{1,2})(?:[.,](\d+))?)?)?(Z|[\+\-]\d\d:?\d\d)?)?)?)?)?$/;function xu(r){if(r instanceof Date)return r;if($t(r)){var e=Lue.exec(r);if(!e)return new Date(NaN);if(e[8]){var t=+e[4]||0;return e[8].toUpperCase()!=="Z"&&(t-=+e[8].slice(0,3)),new Date(Date.UTC(+e[1],+(e[2]||1)-1,+e[3]||1,t,+(e[5]||0),+e[6]||0,e[7]?+e[7].substring(0,3):0))}else return new Date(+e[1],+(e[2]||1)-1,+e[3]||1,+e[4]||0,+(e[5]||0),+e[6]||0,e[7]?+e[7].substring(0,3):0)}else if(r==null)return new Date(NaN);return new Date(Math.round(r))}function A$(r){return Math.pow(10,DC(r))}function DC(r){if(r===0)return 0;var e=Math.floor(Math.log(r)/Math.LN10);return r/Math.pow(10,e)>=10&&e++,e}function Ck(r,e){var t=DC(r),i=Math.pow(10,t),n=r/i,a;return e?n<1.5?a=1:n<2.5?a=2:n<4?a=3:n<7?a=5:a=10:n<1?a=1:n<2?a=2:n<3?a=3:n<5?a=5:a=10,r=a*i,t>=-20?+r.toFixed(t<0?-t:0):r}function L2(r,e){var t=(r.length-1)*e+1,i=Math.floor(t),n=+r[i-1],a=t-i;return a?n+a*(r[i]-n):n}function ZR(r){r.sort(function(l,c){return o(l,c,0)?-1:1});for(var e=-1/0,t=1,i=0;i<r.length;){for(var n=r[i].interval,a=r[i].close,s=0;s<2;s++)n[s]<=e&&(n[s]=e,a[s]=s?1:1-t),e=n[s],t=a[s];n[0]===n[1]&&a[0]*a[1]!==1?r.splice(i,1):i++}return r;function o(l,c,f){return l.interval[f]<c.interval[f]||l.interval[f]===c.interval[f]&&(l.close[f]-c.close[f]===(f?-1:1)||!f&&o(l,c,1))}}function Hf(r){var e=parseFloat(r);return e==r&&(e!==0||!$t(r)||r.indexOf("x")<=0)?e:NaN}function Mk(r){return!isNaN(Hf(r))}function C$(){return Math.round(Math.random()*9)}function M$(r,e){return e===0?r:M$(e,r%e)}function R4(r,e){return r==null?e:e==null?r:r*e/M$(r,e)}function Pi(r){throw new Error(r)}function D4(r,e,t){return(e-r)*t+r}var E$="series\0",I$="\0_ec_\0";function Gi(r){return r instanceof Array?r:r==null?[]:[r]}function vy(r,e,t){if(r){r[e]=r[e]||{},r.emphasis=r.emphasis||{},r.emphasis[e]=r.emphasis[e]||{};for(var i=0,n=t.length;i<n;i++){var a=t[i];!r.emphasis[e].hasOwnProperty(a)&&r[e].hasOwnProperty(a)&&(r.emphasis[e][a]=r[e][a])}}}var k4=["fontStyle","fontWeight","fontSize","fontFamily","rich","tag","color","textBorderColor","textBorderWidth","width","height","lineHeight","align","verticalAlign","baseline","shadowColor","shadowBlur","shadowOffsetX","shadowOffsetY","textShadowColor","textShadowBlur","textShadowOffsetX","textShadowOffsetY","backgroundColor","borderColor","borderWidth","borderRadius","padding"];function ab(r){return cr(r)&&!xt(r)&&!(r instanceof Date)?r.value:r}function Oue(r){return cr(r)&&!(r instanceof Array)}function P$(r,e,t){var i=t==="normalMerge",n=t==="replaceMerge",a=t==="replaceAll";r=r||[],e=(e||[]).slice();var s=Qt();se(e,function(l,c){if(!cr(l)){e[c]=null;return}});var o=Nue(r,s,t);return(i||n)&&Bue(o,r,s,e),i&&zue(o,e),i||n?Fue(o,e,n):a&&Vue(o,e),Uue(o),o}function Nue(r,e,t){var i=[];if(t==="replaceAll")return i;for(var n=0;n<r.length;n++){var a=r[n];a&&a.id!=null&&e.set(a.id,n),i.push({existing:t==="replaceMerge"||dw(a)?null:a,newOption:null,keyInfo:null,brandNew:null})}return i}function Bue(r,e,t,i){se(i,function(n,a){if(!(!n||n.id==null)){var s=U1(n.id),o=t.get(s);if(o!=null){var l=r[o];Is(!l.newOption,'Duplicated option on id "'+s+'".'),l.newOption=n,l.existing=e[o],i[a]=null}}})}function zue(r,e){se(e,function(t,i){if(!(!t||t.name==null))for(var n=0;n<r.length;n++){var a=r[n].existing;if(!r[n].newOption&&a&&(a.id==null||t.id==null)&&!dw(t)&&!dw(a)&&R$("name",a,t)){r[n].newOption=t,e[i]=null;return}}})}function Fue(r,e,t){se(e,function(i){if(i){for(var n,a=0;(n=r[a])&&(n.newOption||dw(n.existing)||n.existing&&i.id!=null&&!R$("id",i,n.existing));)a++;n?(n.newOption=i,n.brandNew=t):r.push({newOption:i,brandNew:t,existing:null,keyInfo:null}),a++}})}function Vue(r,e){se(e,function(t){r.push({newOption:t,brandNew:!0,existing:null,keyInfo:null})})}function Uue(r){var e=Qt();se(r,function(t){var i=t.existing;i&&e.set(i.id,t)}),se(r,function(t){var i=t.newOption;Is(!i||i.id==null||!e.get(i.id)||e.get(i.id)===t,"id duplicates: "+(i&&i.id)),i&&i.id!=null&&e.set(i.id,t),!t.keyInfo&&(t.keyInfo={})}),se(r,function(t,i){var n=t.existing,a=t.newOption,s=t.keyInfo;if(cr(a)){if(s.name=a.name!=null?U1(a.name):n?n.name:E$+i,n)s.id=U1(n.id);else if(a.id!=null)s.id=U1(a.id);else{var o=0;do s.id="\0"+s.name+"\0"+o++;while(e.get(s.id))}e.set(s.id,t)}})}function R$(r,e,t){var i=Za(e[r],null),n=Za(t[r],null);return i!=null&&n!=null&&i===n}function U1(r){return Za(r,"")}function Za(r,e){return r==null?e:$t(r)?r:di(r)||pA(r)?r+"":e}function Ek(r){var e=r.name;return!!(e&&e.indexOf(E$))}function dw(r){return r&&r.id!=null&&U1(r.id).indexOf(I$)===0}function Hue(r){return I$+r}function jue(r,e,t){se(r,function(i){var n=i.newOption;cr(n)&&(i.keyInfo.mainType=e,i.keyInfo.subType=$ue(e,n,i.existing,t))})}function $ue(r,e,t,i){var n=e.type?e.type:t?t.subType:i.determineSubType(r,e);return n}function Wue(r,e){var t={},i={};return n(r||[],t),n(e||[],i,t),[a(t),a(i)];function n(s,o,l){for(var c=0,f=s.length;c<f;c++){var p=Za(s[c].seriesId,null);if(p==null)return;for(var y=Gi(s[c].dataIndex),b=l&&l[p],S=0,C=y.length;S<C;S++){var E=y[S];b&&b[E]?b[E]=null:(o[p]||(o[p]={}))[E]=1}}}function a(s,o){var l=[];for(var c in s)if(s.hasOwnProperty(c)&&s[c]!=null)if(o)l.push(+c);else{var f=a(s[c],!0);f.length&&l.push({seriesId:c,dataIndex:f})}return l}}function my(r,e){if(e.dataIndexInside!=null)return e.dataIndexInside;if(e.dataIndex!=null)return xt(e.dataIndex)?wt(e.dataIndex,function(t){return r.indexOfRawIndex(t)}):r.indexOfRawIndex(e.dataIndex);if(e.name!=null)return xt(e.name)?wt(e.name,function(t){return r.indexOfName(t)}):r.indexOfName(e.name)}function fi(){var r="__ec_inner_"+Gue++;return function(e){return e[r]||(e[r]={})}}var Gue=C$();function H1(r,e,t){var i=Ik(e,t),n=i.mainTypeSpecified,a=i.queryOptionMap,s=i.others,o=s,l=t?t.defaultMainType:null;return!n&&l&&a.set(l,{}),a.each(function(c,f){var p=Gw(r,f,c,{useDefault:l===f,enableAll:t&&t.enableAll!=null?t.enableAll:!0,enableNone:t&&t.enableNone!=null?t.enableNone:!0});o[f+"Models"]=p.models,o[f+"Model"]=p.models[0]}),o}function Ik(r,e){var t;if($t(r)){var i={};i[r+"Index"]=0,t=i}else t=r;var n=Qt(),a={},s=!1;return se(t,function(o,l){if(l==="dataIndex"||l==="dataIndexInside"){a[l]=o;return}var c=l.match(/^(\w+)(Index|Id|Name)$/)||[],f=c[1],p=(c[2]||"").toLowerCase();if(!(!f||!p||e&&e.includeMainTypes&&Or(e.includeMainTypes,f)<0)){s=s||!!f;var y=n.get(f)||n.set(f,{});y[p]=o}}),{mainTypeSpecified:s,queryOptionMap:n,others:a}}var ka={useDefault:!0,enableAll:!1,enableNone:!1},Xue={useDefault:!1,enableAll:!0,enableNone:!0};function Gw(r,e,t,i){i=i||ka;var n=t.index,a=t.id,s=t.name,o={models:null,specified:n!=null||a!=null||s!=null};if(!o.specified){var l=void 0;return o.models=i.useDefault&&(l=r.getComponent(e))?[l]:[],o}return n==="none"||n===!1?(Is(i.enableNone,'`"none"` or `false` is not a valid value on index option.'),o.models=[],o):(n==="all"&&(Is(i.enableAll,'`"all"` is not a valid value on index option.'),n=a=s=null),o.models=r.queryComponents({mainType:e,index:n,id:a,name:s}),o)}function D$(r,e,t){r.setAttribute?r.setAttribute(e,t):r[e]=t}function Zue(r,e){return r.getAttribute?r.getAttribute(e):r[e]}function que(r){return r==="auto"?Gr.domSupported?"html":"richText":r||"html"}function qR(r,e){var t=Qt(),i=[];return se(r,function(n){var a=e(n);(t.get(a)||(i.push(a),t.set(a,[]))).push(n)}),{keys:i,buckets:t}}function k$(r,e,t,i,n){var a=e==null||e==="auto";if(i==null)return i;if(di(i)){var s=D4(t||0,i,n);return Qn(s,a?Math.max(wh(t||0),wh(i)):e)}else{if($t(i))return n<1?t:i;for(var o=[],l=t,c=i,f=Math.max(l?l.length:0,c.length),p=0;p<f;++p){var y=r.getDimensionInfo(p);if(y&&y.type==="ordinal")o[p]=(n<1&&l?l:c)[p];else{var b=l&&l[p]?l[p]:0,S=c[p],s=D4(b,S,n);o[p]=Qn(s,a?Math.max(wh(b),wh(S)):e)}}return o}}var Yue=".",um="___EC__COMPONENT__CONTAINER___",L$="___EC__EXTENDED_CLASS___";function Lf(r){var e={main:"",sub:""};if(r){var t=r.split(Yue);e.main=t[0]||"",e.sub=t[1]||""}return e}function Kue(r){Is(/^[a-zA-Z0-9_]+([.][a-zA-Z0-9_]+)?$/.test(r),'componentType "'+r+'" illegal')}function Que(r){return!!(r&&r[L$])}function Pk(r,e){r.$constructor=r,r.extend=function(t){var i=this,n;return Jue(i)?n=(function(a){Ye(s,a);function s(){return a.apply(this,arguments)||this}return s})(i):(n=function(){(t.$constructor||i).apply(this,arguments)},vk(n,this)),mt(n.prototype,t),n[L$]=!0,n.extend=this.extend,n.superCall=rce,n.superApply=ice,n.superClass=i,n}}function Jue(r){return sr(r)&&/^class\s/.test(Function.prototype.toString.call(r))}function O$(r,e){r.extend=e.extend}var ece=Math.round(Math.random()*10);function tce(r){var e=["__\0is_clz",ece++].join("_");r.prototype[e]=!0,r.isInstance=function(t){return!!(t&&t[e])}}function rce(r,e){for(var t=[],i=2;i<arguments.length;i++)t[i-2]=arguments[i];return this.superClass.prototype[e].apply(r,t)}function ice(r,e,t){return this.superClass.prototype[e].apply(r,t)}function kC(r){var e={};r.registerClass=function(i){var n=i.type||i.prototype.type;if(n){Kue(n),i.prototype.type=n;var a=Lf(n);if(!a.sub)e[a.main]=i;else if(a.sub!==um){var s=t(a);s[a.sub]=i}}return i},r.getClass=function(i,n,a){var s=e[i];if(s&&s[um]&&(s=n?s[n]:null),a&&!s)throw new Error(n?"Component "+i+"."+(n||"")+" is used but not imported.":i+".type should be specified.");return s},r.getClassesByMainType=function(i){var n=Lf(i),a=[],s=e[n.main];return s&&s[um]?se(s,function(o,l){l!==um&&a.push(o)}):a.push(s),a},r.hasClass=function(i){var n=Lf(i);return!!e[n.main]},r.getAllClassMainTypes=function(){var i=[];return se(e,function(n,a){i.push(a)}),i},r.hasSubTypes=function(i){var n=Lf(i),a=e[n.main];return a&&a[um]};function t(i){var n=e[i.main];return(!n||!n[um])&&(n=e[i.main]={},n[um]=!0),n}}function yy(r,e){for(var t=0;t<r.length;t++)r[t][1]||(r[t][1]=r[t][0]);return e=e||!1,function(i,n,a){for(var s={},o=0;o<r.length;o++){var l=r[o][1];if(!(n&&Or(n,l)>=0||a&&Or(a,l)<0)){var c=i.getShallow(l,e);c!=null&&(s[r[o][0]]=c)}}return s}}var nce=[["fill","color"],["shadowBlur"],["shadowOffsetX"],["shadowOffsetY"],["opacity"],["shadowColor"]],ace=yy(nce),oce=(function(){function r(){}return r.prototype.getAreaStyle=function(e,t){return ace(this,e,t)},r})(),YR=new $w(50);function sce(r){if(typeof r=="string"){var e=YR.get(r);return e&&e.image}else return r}function Rk(r,e,t,i,n){if(r)if(typeof r=="string"){if(e&&e.__zrImageSrc===r||!t)return e;var a=YR.get(r),s={hostEl:t,cb:i,cbPayload:n};return a?(e=a.image,!LC(e)&&a.pending.push(s)):(e=Ih.loadImage(r,L4,L4),e.__zrImageSrc=r,YR.put(r,e.__cachedImgObj={image:e,pending:[s]})),e}else return r;else return e}function L4(){var r=this.__cachedImgObj;this.onload=this.onerror=this.__cachedImgObj=null;for(var e=0;e<r.pending.length;e++){var t=r.pending[e],i=t.cb;i&&i(this,t.cbPayload),t.hostEl.dirty()}r.pending.length=0}function LC(r){return r&&r.width&&r.height}var VE=/\{([a-zA-Z0-9_]+)\|([^}]*)\}/g;function lce(r,e,t,i,n){var a={};return N$(a,r,e,t,i,n),a.text}function N$(r,e,t,i,n,a){if(!t){r.text="",r.isTruncated=!1;return}var s=(e+"").split(`
`);a=B$(t,i,n,a);for(var o=!1,l={},c=0,f=s.length;c<f;c++)z$(l,s[c],a),s[c]=l.textLine,o=o||l.isTruncated;r.text=s.join(`
`),r.isTruncated=o}function B$(r,e,t,i){i=i||{};var n=mt({},i);n.font=e,t=wr(t,"..."),n.maxIterations=wr(i.maxIterations,2);var a=n.minChar=wr(i.minChar,0);n.cnCharWidth=bu("国",e);var s=n.ascCharWidth=bu("a",e);n.placeholder=wr(i.placeholder,"");for(var o=r=Math.max(0,r-1),l=0;l<a&&o>=s;l++)o-=s;var c=bu(t,e);return c>o&&(t="",c=0),o=r-c,n.ellipsis=t,n.ellipsisWidth=c,n.contentWidth=o,n.containerWidth=r,n}function z$(r,e,t){var i=t.containerWidth,n=t.font,a=t.contentWidth;if(!i){r.textLine="",r.isTruncated=!1;return}var s=bu(e,n);if(s<=i){r.textLine=e,r.isTruncated=!1;return}for(var o=0;;o++){if(s<=a||o>=t.maxIterations){e+=t.ellipsis;break}var l=o===0?uce(e,a,t.ascCharWidth,t.cnCharWidth):s>0?Math.floor(e.length*a/s):0;e=e.substr(0,l),s=bu(e,n)}e===""&&(e=t.placeholder),r.textLine=e,r.isTruncated=!0}function uce(r,e,t,i){for(var n=0,a=0,s=r.length;a<s&&n<e;a++){var o=r.charCodeAt(a);n+=0<=o&&o<=127?t:i}return a}function cce(r,e){r!=null&&(r+="");var t=e.overflow,i=e.padding,n=e.font,a=t==="truncate",s=PC(n),o=wr(e.lineHeight,s),l=!!e.backgroundColor,c=e.lineOverflow==="truncate",f=!1,p=e.width,y;p!=null&&(t==="break"||t==="breakAll")?y=r?F$(r,e.font,p,t==="breakAll",0).lines:[]:y=r?r.split(`
`):[];var b=y.length*o,S=wr(e.height,b);if(b>S&&c){var C=Math.floor(S/o);f=f||y.length>C,y=y.slice(0,C)}if(r&&a&&p!=null)for(var E=B$(p,n,e.ellipsis,{minChar:e.truncateMinChar,placeholder:e.placeholder}),P={},O=0;O<y.length;O++)z$(P,y[O],E),y[O]=P.textLine,f=f||P.isTruncated;for(var B=S,F=0,O=0;O<y.length;O++)F=Math.max(bu(y[O],n),F);p==null&&(p=F);var W=F;return i&&(B+=i[0]+i[2],W+=i[1]+i[3],p+=i[1]+i[3]),l&&(W=p),{lines:y,height:S,outerWidth:W,outerHeight:B,lineHeight:o,calculatedLineHeight:s,contentWidth:F,contentHeight:b,width:p,isTruncated:f}}var hce=(function(){function r(){}return r})(),O4=(function(){function r(e){this.tokens=[],e&&(this.tokens=e)}return r})(),fce=(function(){function r(){this.width=0,this.height=0,this.contentWidth=0,this.contentHeight=0,this.outerWidth=0,this.outerHeight=0,this.lines=[],this.isTruncated=!1}return r})();function dce(r,e){var t=new fce;if(r!=null&&(r+=""),!r)return t;for(var i=e.width,n=e.height,a=e.overflow,s=(a==="break"||a==="breakAll")&&i!=null?{width:i,accumWidth:0,breakAll:a==="breakAll"}:null,o=VE.lastIndex=0,l;(l=VE.exec(r))!=null;){var c=l.index;c>o&&UE(t,r.substring(o,c),e,s),UE(t,l[2],e,s,l[1]),o=VE.lastIndex}o<r.length&&UE(t,r.substring(o,r.length),e,s);var f=[],p=0,y=0,b=e.padding,S=a==="truncate",C=e.lineOverflow==="truncate",E={};function P(ct,xe,$e){ct.width=xe,ct.lineHeight=$e,p+=$e,y=Math.max(y,xe)}e:for(var O=0;O<t.lines.length;O++){for(var B=t.lines[O],F=0,W=0,$=0;$<B.tokens.length;$++){var q=B.tokens[$],Q=q.styleName&&e.rich[q.styleName]||{},ee=q.textPadding=Q.padding,te=ee?ee[1]+ee[3]:0,ae=q.font=Q.font||e.font;q.contentHeight=PC(ae);var de=wr(Q.height,q.contentHeight);if(q.innerHeight=de,ee&&(de+=ee[0]+ee[2]),q.height=de,q.lineHeight=Th(Q.lineHeight,e.lineHeight,de),q.align=Q&&Q.align||e.align,q.verticalAlign=Q&&Q.verticalAlign||"middle",C&&n!=null&&p+q.lineHeight>n){var ve=t.lines.length;$>0?(B.tokens=B.tokens.slice(0,$),P(B,W,F),t.lines=t.lines.slice(0,O+1)):t.lines=t.lines.slice(0,O),t.isTruncated=t.isTruncated||t.lines.length<ve;break e}var ye=Q.width,Ae=ye==null||ye==="auto";if(typeof ye=="string"&&ye.charAt(ye.length-1)==="%")q.percentWidth=ye,f.push(q),q.contentWidth=bu(q.text,ae);else{if(Ae){var me=Q.backgroundColor,De=me&&me.image;De&&(De=sce(De),LC(De)&&(q.width=Math.max(q.width,De.width*de/De.height)))}var Fe=S&&i!=null?i-W:null;Fe!=null&&Fe<q.width?!Ae||Fe<te?(q.text="",q.width=q.contentWidth=0):(N$(E,q.text,Fe-te,ae,e.ellipsis,{minChar:e.truncateMinChar}),q.text=E.text,t.isTruncated=t.isTruncated||E.isTruncated,q.width=q.contentWidth=bu(q.text,ae)):q.contentWidth=bu(q.text,ae)}q.width+=te,W+=q.width,Q&&(F=Math.max(F,q.lineHeight))}P(B,W,F)}t.outerWidth=t.width=wr(i,y),t.outerHeight=t.height=wr(n,p),t.contentHeight=p,t.contentWidth=y,b&&(t.outerWidth+=b[1]+b[3],t.outerHeight+=b[0]+b[2]);for(var O=0;O<f.length;O++){var q=f[O],je=q.percentWidth;q.width=parseInt(je,10)/100*t.width}return t}function UE(r,e,t,i,n){var a=e==="",s=n&&t.rich[n]||{},o=r.lines,l=s.font||t.font,c=!1,f,p;if(i){var y=s.padding,b=y?y[1]+y[3]:0;if(s.width!=null&&s.width!=="auto"){var S=Rh(s.width,i.width)+b;o.length>0&&S+i.accumWidth>i.width&&(f=e.split(`
`),c=!0),i.accumWidth=S}else{var C=F$(e,l,i.width,i.breakAll,i.accumWidth);i.accumWidth=C.accumWidth+b,p=C.linesWidths,f=C.lines}}else f=e.split(`
`);for(var E=0;E<f.length;E++){var P=f[E],O=new hce;if(O.styleName=n,O.text=P,O.isLineHolder=!P&&!a,typeof s.width=="number"?O.width=s.width:O.width=p?p[E]:bu(P,l),!E&&!c){var B=(o[o.length-1]||(o[0]=new O4)).tokens,F=B.length;F===1&&B[0].isLineHolder?B[0]=O:(P||!F||a)&&B.push(O)}else o.push(new O4([O]))}}function pce(r){var e=r.charCodeAt(0);return e>=32&&e<=591||e>=880&&e<=4351||e>=4608&&e<=5119||e>=7680&&e<=8303}var gce=Sc(",&?/;] ".split(""),function(r,e){return r[e]=!0,r},{});function vce(r){return pce(r)?!!gce[r]:!0}function F$(r,e,t,i,n){for(var a=[],s=[],o="",l="",c=0,f=0,p=0;p<r.length;p++){var y=r.charAt(p);if(y===`
`){l&&(o+=l,f+=c),a.push(o),s.push(f),o="",l="",c=0,f=0;continue}var b=bu(y,e),S=i?!1:!vce(y);if(a.length?f+b>t:n+f+b>t){f?(o||l)&&(S?(o||(o=l,l="",c=0,f=c),a.push(o),s.push(f-c),l+=y,c+=b,o="",f=c):(l&&(o+=l,l="",c=0),a.push(o),s.push(f),o=y,f=b)):S?(a.push(l),s.push(c),l=y,c=b):(a.push(y),s.push(b));continue}f+=b,S?(l+=y,c+=b):(l&&(o+=l,l="",c=0),o+=y)}return!a.length&&!o&&(o=r,l="",c=0),l&&(o+=l),o&&(a.push(o),s.push(f)),a.length===1&&(f+=n),{accumWidth:f,lines:a,linesWidths:s}}var KR="__zr_style_"+Math.round(Math.random()*10),ry={shadowBlur:0,shadowOffsetX:0,shadowOffsetY:0,shadowColor:"#000",opacity:1,blend:"source-over"},OC={style:{shadowBlur:!0,shadowOffsetX:!0,shadowOffsetY:!0,shadowColor:!0,opacity:!0}};ry[KR]=!0;var N4=["z","z2","invisible"],mce=["invisible"],Tc=(function(r){Ye(e,r);function e(t){return r.call(this,t)||this}return e.prototype._init=function(t){for(var i=qr(t),n=0;n<i.length;n++){var a=i[n];a==="style"?this.useStyle(t[a]):r.prototype.attrKV.call(this,a,t[a])}this.style||this.useStyle({})},e.prototype.beforeBrush=function(){},e.prototype.afterBrush=function(){},e.prototype.innerBeforeBrush=function(){},e.prototype.innerAfterBrush=function(){},e.prototype.shouldBePainted=function(t,i,n,a){var s=this.transform;if(this.ignore||this.invisible||this.style.opacity===0||this.culling&&yce(this,t,i)||s&&!s[0]&&!s[3])return!1;if(n&&this.__clipPaths){for(var o=0;o<this.__clipPaths.length;++o)if(this.__clipPaths[o].isZeroArea())return!1}if(a&&this.parent)for(var l=this.parent;l;){if(l.ignore)return!1;l=l.parent}return!0},e.prototype.contain=function(t,i){return this.rectContain(t,i)},e.prototype.traverse=function(t,i){t.call(i,this)},e.prototype.rectContain=function(t,i){var n=this.transformCoordToLocal(t,i),a=this.getBoundingRect();return a.contain(n[0],n[1])},e.prototype.getPaintRect=function(){var t=this._paintRect;if(!this._paintRect||this.__dirty){var i=this.transform,n=this.getBoundingRect(),a=this.style,s=a.shadowBlur||0,o=a.shadowOffsetX||0,l=a.shadowOffsetY||0;t=this._paintRect||(this._paintRect=new Dr(0,0,0,0)),i?Dr.applyTransform(t,n,i):t.copy(n),(s||o||l)&&(t.width+=s*2+Math.abs(o),t.height+=s*2+Math.abs(l),t.x=Math.min(t.x,t.x+o-s),t.y=Math.min(t.y,t.y+l-s));var c=this.dirtyRectTolerance;t.isZero()||(t.x=Math.floor(t.x-c),t.y=Math.floor(t.y-c),t.width=Math.ceil(t.width+1+c*2),t.height=Math.ceil(t.height+1+c*2))}return t},e.prototype.setPrevPaintRect=function(t){t?(this._prevPaintRect=this._prevPaintRect||new Dr(0,0,0,0),this._prevPaintRect.copy(t)):this._prevPaintRect=null},e.prototype.getPrevPaintRect=function(){return this._prevPaintRect},e.prototype.animateStyle=function(t){return this.animate("style",t)},e.prototype.updateDuringAnimation=function(t){t==="style"?this.dirtyStyle():this.markRedraw()},e.prototype.attrKV=function(t,i){t!=="style"?r.prototype.attrKV.call(this,t,i):this.style?this.setStyle(i):this.useStyle(i)},e.prototype.setStyle=function(t,i){return typeof t=="string"?this.style[t]=i:mt(this.style,t),this.dirtyStyle(),this},e.prototype.dirtyStyle=function(t){t||this.markRedraw(),this.__dirty|=p1,this._rect&&(this._rect=null)},e.prototype.dirty=function(){this.dirtyStyle()},e.prototype.styleChanged=function(){return!!(this.__dirty&p1)},e.prototype.styleUpdated=function(){this.__dirty&=~p1},e.prototype.createStyle=function(t){return Hw(ry,t)},e.prototype.useStyle=function(t){t[KR]||(t=this.createStyle(t)),this.__inHover?this.__hoverStyle=t:this.style=t,this.dirtyStyle()},e.prototype.isStyleObject=function(t){return t[KR]},e.prototype._innerSaveToNormal=function(t){r.prototype._innerSaveToNormal.call(this,t);var i=this._normalState;t.style&&!i.style&&(i.style=this._mergeStyle(this.createStyle(),this.style)),this._savePrimaryToNormal(t,i,N4)},e.prototype._applyStateObj=function(t,i,n,a,s,o){r.prototype._applyStateObj.call(this,t,i,n,a,s,o);var l=!(i&&a),c;if(i&&i.style?s?a?c=i.style:(c=this._mergeStyle(this.createStyle(),n.style),this._mergeStyle(c,i.style)):(c=this._mergeStyle(this.createStyle(),a?this.style:n.style),this._mergeStyle(c,i.style)):l&&(c=n.style),c)if(s){var f=this.style;if(this.style=this.createStyle(l?{}:f),l)for(var p=qr(f),y=0;y<p.length;y++){var b=p[y];b in c&&(c[b]=c[b],this.style[b]=f[b])}for(var S=qr(c),y=0;y<S.length;y++){var b=S[y];this.style[b]=this.style[b]}this._transitionState(t,{style:c},o,this.getAnimationStyleProps())}else this.useStyle(c);for(var C=this.__inHover?mce:N4,y=0;y<C.length;y++){var b=C[y];i&&i[b]!=null?this[b]=i[b]:l&&n[b]!=null&&(this[b]=n[b])}},e.prototype._mergeStates=function(t){for(var i=r.prototype._mergeStates.call(this,t),n,a=0;a<t.length;a++){var s=t[a];s.style&&(n=n||{},this._mergeStyle(n,s.style))}return n&&(i.style=n),i},e.prototype._mergeStyle=function(t,i){return mt(t,i),t},e.prototype.getAnimationStyleProps=function(){return OC},e.initDefaultProps=(function(){var t=e.prototype;t.type="displayable",t.invisible=!1,t.z=0,t.z2=0,t.zlevel=0,t.culling=!1,t.cursor="pointer",t.rectHover=!1,t.incremental=!1,t._rect=null,t.dirtyRectTolerance=0,t.__dirty=gu|p1})(),e})(RC),HE=new Dr(0,0,0,0),jE=new Dr(0,0,0,0);function yce(r,e,t){return HE.copy(r.getBoundingRect()),r.transform&&HE.applyTransform(r.transform),jE.width=e,jE.height=t,!HE.intersect(jE)}var Pl=Math.min,Rl=Math.max,$E=Math.sin,WE=Math.cos,cm=Math.PI*2,AT=Xg(),CT=Xg(),MT=Xg();function NC(r,e,t){if(r.length!==0){for(var i=r[0],n=i[0],a=i[0],s=i[1],o=i[1],l=1;l<r.length;l++)i=r[l],n=Pl(n,i[0]),a=Rl(a,i[0]),s=Pl(s,i[1]),o=Rl(o,i[1]);e[0]=n,e[1]=s,t[0]=a,t[1]=o}}function B4(r,e,t,i,n,a){n[0]=Pl(r,t),n[1]=Pl(e,i),a[0]=Rl(r,t),a[1]=Rl(e,i)}var z4=[],F4=[];function _ce(r,e,t,i,n,a,s,o,l,c){var f=r$,p=oo,y=f(r,t,n,s,z4);l[0]=1/0,l[1]=1/0,c[0]=-1/0,c[1]=-1/0;for(var b=0;b<y;b++){var S=p(r,t,n,s,z4[b]);l[0]=Pl(S,l[0]),c[0]=Rl(S,c[0])}y=f(e,i,a,o,F4);for(var b=0;b<y;b++){var C=p(e,i,a,o,F4[b]);l[1]=Pl(C,l[1]),c[1]=Rl(C,c[1])}l[0]=Pl(r,l[0]),c[0]=Rl(r,c[0]),l[0]=Pl(s,l[0]),c[0]=Rl(s,c[0]),l[1]=Pl(e,l[1]),c[1]=Rl(e,c[1]),l[1]=Pl(o,l[1]),c[1]=Rl(o,c[1])}function bce(r,e,t,i,n,a,s,o){var l=n$,c=Po,f=Rl(Pl(l(r,t,n),1),0),p=Rl(Pl(l(e,i,a),1),0),y=c(r,t,n,f),b=c(e,i,a,p);s[0]=Pl(r,n,y),s[1]=Pl(e,a,b),o[0]=Rl(r,n,y),o[1]=Rl(e,a,b)}function xce(r,e,t,i,n,a,s,o,l){var c=rp,f=ip,p=Math.abs(n-a);if(p%cm<1e-4&&p>1e-4){o[0]=r-t,o[1]=e-i,l[0]=r+t,l[1]=e+i;return}if(AT[0]=WE(n)*t+r,AT[1]=$E(n)*i+e,CT[0]=WE(a)*t+r,CT[1]=$E(a)*i+e,c(o,AT,CT),f(l,AT,CT),n=n%cm,n<0&&(n=n+cm),a=a%cm,a<0&&(a=a+cm),n>a&&!s?a+=cm:n<a&&s&&(n+=cm),s){var y=a;a=n,n=y}for(var b=0;b<a;b+=Math.PI/2)b>n&&(MT[0]=WE(b)*t+r,MT[1]=$E(b)*i+e,c(o,MT,o),f(l,MT,l))}var un={M:1,L:2,C:3,Q:4,A:5,Z:6,R:7},hm=[],fm=[],bf=[],lg=[],xf=[],wf=[],GE=Math.min,XE=Math.max,dm=Math.cos,pm=Math.sin,$d=Math.abs,QR=Math.PI,vg=QR*2,ZE=typeof Float32Array<"u",Nx=[];function qE(r){var e=Math.round(r/QR*1e8)/1e8;return e%2*QR}function Dk(r,e){var t=qE(r[0]);t<0&&(t+=vg);var i=t-r[0],n=r[1];n+=i,!e&&n-t>=vg?n=t+vg:e&&t-n>=vg?n=t-vg:!e&&t>n?n=t+(vg-qE(t-n)):e&&t<n&&(n=t-(vg-qE(n-t))),r[0]=t,r[1]=n}var jf=(function(){function r(e){this.dpr=1,this._xi=0,this._yi=0,this._x0=0,this._y0=0,this._len=0,e&&(this._saveData=!1),this._saveData&&(this.data=[])}return r.prototype.increaseVersion=function(){this._version++},r.prototype.getVersion=function(){return this._version},r.prototype.setScale=function(e,t,i){i=i||0,i>0&&(this._ux=$d(i/SA/e)||0,this._uy=$d(i/SA/t)||0)},r.prototype.setDPR=function(e){this.dpr=e},r.prototype.setContext=function(e){this._ctx=e},r.prototype.getContext=function(){return this._ctx},r.prototype.beginPath=function(){return this._ctx&&this._ctx.beginPath(),this.reset(),this},r.prototype.reset=function(){this._saveData&&(this._len=0),this._pathSegLen&&(this._pathSegLen=null,this._pathLen=0),this._version++},r.prototype.moveTo=function(e,t){return this._drawPendingPt(),this.addData(un.M,e,t),this._ctx&&this._ctx.moveTo(e,t),this._x0=e,this._y0=t,this._xi=e,this._yi=t,this},r.prototype.lineTo=function(e,t){var i=$d(e-this._xi),n=$d(t-this._yi),a=i>this._ux||n>this._uy;if(this.addData(un.L,e,t),this._ctx&&a&&this._ctx.lineTo(e,t),a)this._xi=e,this._yi=t,this._pendingPtDist=0;else{var s=i*i+n*n;s>this._pendingPtDist&&(this._pendingPtX=e,this._pendingPtY=t,this._pendingPtDist=s)}return this},r.prototype.bezierCurveTo=function(e,t,i,n,a,s){return this._drawPendingPt(),this.addData(un.C,e,t,i,n,a,s),this._ctx&&this._ctx.bezierCurveTo(e,t,i,n,a,s),this._xi=a,this._yi=s,this},r.prototype.quadraticCurveTo=function(e,t,i,n){return this._drawPendingPt(),this.addData(un.Q,e,t,i,n),this._ctx&&this._ctx.quadraticCurveTo(e,t,i,n),this._xi=i,this._yi=n,this},r.prototype.arc=function(e,t,i,n,a,s){this._drawPendingPt(),Nx[0]=n,Nx[1]=a,Dk(Nx,s),n=Nx[0],a=Nx[1];var o=a-n;return this.addData(un.A,e,t,i,i,n,o,0,s?0:1),this._ctx&&this._ctx.arc(e,t,i,n,a,s),this._xi=dm(a)*i+e,this._yi=pm(a)*i+t,this},r.prototype.arcTo=function(e,t,i,n,a){return this._drawPendingPt(),this._ctx&&this._ctx.arcTo(e,t,i,n,a),this},r.prototype.rect=function(e,t,i,n){return this._drawPendingPt(),this._ctx&&this._ctx.rect(e,t,i,n),this.addData(un.R,e,t,i,n),this},r.prototype.closePath=function(){this._drawPendingPt(),this.addData(un.Z);var e=this._ctx,t=this._x0,i=this._y0;return e&&e.closePath(),this._xi=t,this._yi=i,this},r.prototype.fill=function(e){e&&e.fill(),this.toStatic()},r.prototype.stroke=function(e){e&&e.stroke(),this.toStatic()},r.prototype.len=function(){return this._len},r.prototype.setData=function(e){var t=e.length;!(this.data&&this.data.length===t)&&ZE&&(this.data=new Float32Array(t));for(var i=0;i<t;i++)this.data[i]=e[i];this._len=t},r.prototype.appendPath=function(e){e instanceof Array||(e=[e]);for(var t=e.length,i=0,n=this._len,a=0;a<t;a++)i+=e[a].len();ZE&&this.data instanceof Float32Array&&(this.data=new Float32Array(n+i));for(var a=0;a<t;a++)for(var s=e[a].data,o=0;o<s.length;o++)this.data[n++]=s[o];this._len=n},r.prototype.addData=function(e,t,i,n,a,s,o,l,c){if(this._saveData){var f=this.data;this._len+arguments.length>f.length&&(this._expandData(),f=this.data);for(var p=0;p<arguments.length;p++)f[this._len++]=arguments[p]}},r.prototype._drawPendingPt=function(){this._pendingPtDist>0&&(this._ctx&&this._ctx.lineTo(this._pendingPtX,this._pendingPtY),this._pendingPtDist=0)},r.prototype._expandData=function(){if(!(this.data instanceof Array)){for(var e=[],t=0;t<this._len;t++)e[t]=this.data[t];this.data=e}},r.prototype.toStatic=function(){if(this._saveData){this._drawPendingPt();var e=this.data;e instanceof Array&&(e.length=this._len,ZE&&this._len>11&&(this.data=new Float32Array(e)))}},r.prototype.getBoundingRect=function(){bf[0]=bf[1]=xf[0]=xf[1]=Number.MAX_VALUE,lg[0]=lg[1]=wf[0]=wf[1]=-Number.MAX_VALUE;var e=this.data,t=0,i=0,n=0,a=0,s;for(s=0;s<this._len;){var o=e[s++],l=s===1;switch(l&&(t=e[s],i=e[s+1],n=t,a=i),o){case un.M:t=n=e[s++],i=a=e[s++],xf[0]=n,xf[1]=a,wf[0]=n,wf[1]=a;break;case un.L:B4(t,i,e[s],e[s+1],xf,wf),t=e[s++],i=e[s++];break;case un.C:_ce(t,i,e[s++],e[s++],e[s++],e[s++],e[s],e[s+1],xf,wf),t=e[s++],i=e[s++];break;case un.Q:bce(t,i,e[s++],e[s++],e[s],e[s+1],xf,wf),t=e[s++],i=e[s++];break;case un.A:var c=e[s++],f=e[s++],p=e[s++],y=e[s++],b=e[s++],S=e[s++]+b;s+=1;var C=!e[s++];l&&(n=dm(b)*p+c,a=pm(b)*y+f),xce(c,f,p,y,b,S,C,xf,wf),t=dm(S)*p+c,i=pm(S)*y+f;break;case un.R:n=t=e[s++],a=i=e[s++];var E=e[s++],P=e[s++];B4(n,a,n+E,a+P,xf,wf);break;case un.Z:t=n,i=a;break}rp(bf,bf,xf),ip(lg,lg,wf)}return s===0&&(bf[0]=bf[1]=lg[0]=lg[1]=0),new Dr(bf[0],bf[1],lg[0]-bf[0],lg[1]-bf[1])},r.prototype._calculateLength=function(){var e=this.data,t=this._len,i=this._ux,n=this._uy,a=0,s=0,o=0,l=0;this._pathSegLen||(this._pathSegLen=[]);for(var c=this._pathSegLen,f=0,p=0,y=0;y<t;){var b=e[y++],S=y===1;S&&(a=e[y],s=e[y+1],o=a,l=s);var C=-1;switch(b){case un.M:a=o=e[y++],s=l=e[y++];break;case un.L:{var E=e[y++],P=e[y++],O=E-a,B=P-s;($d(O)>i||$d(B)>n||y===t-1)&&(C=Math.sqrt(O*O+B*B),a=E,s=P);break}case un.C:{var F=e[y++],W=e[y++],E=e[y++],P=e[y++],$=e[y++],q=e[y++];C=Ble(a,s,F,W,E,P,$,q,10),a=$,s=q;break}case un.Q:{var F=e[y++],W=e[y++],E=e[y++],P=e[y++];C=Fle(a,s,F,W,E,P,10),a=E,s=P;break}case un.A:var Q=e[y++],ee=e[y++],te=e[y++],ae=e[y++],de=e[y++],ve=e[y++],ye=ve+de;y+=1,S&&(o=dm(de)*te+Q,l=pm(de)*ae+ee),C=XE(te,ae)*GE(vg,Math.abs(ve)),a=dm(ye)*te+Q,s=pm(ye)*ae+ee;break;case un.R:{o=a=e[y++],l=s=e[y++];var Ae=e[y++],me=e[y++];C=Ae*2+me*2;break}case un.Z:{var O=o-a,B=l-s;C=Math.sqrt(O*O+B*B),a=o,s=l;break}}C>=0&&(c[p++]=C,f+=C)}return this._pathLen=f,f},r.prototype.rebuildPath=function(e,t){var i=this.data,n=this._ux,a=this._uy,s=this._len,o,l,c,f,p,y,b=t<1,S,C,E=0,P=0,O,B=0,F,W;if(!(b&&(this._pathSegLen||this._calculateLength(),S=this._pathSegLen,C=this._pathLen,O=t*C,!O)))e:for(var $=0;$<s;){var q=i[$++],Q=$===1;switch(Q&&(c=i[$],f=i[$+1],o=c,l=f),q!==un.L&&B>0&&(e.lineTo(F,W),B=0),q){case un.M:o=c=i[$++],l=f=i[$++],e.moveTo(c,f);break;case un.L:{p=i[$++],y=i[$++];var ee=$d(p-c),te=$d(y-f);if(ee>n||te>a){if(b){var ae=S[P++];if(E+ae>O){var de=(O-E)/ae;e.lineTo(c*(1-de)+p*de,f*(1-de)+y*de);break e}E+=ae}e.lineTo(p,y),c=p,f=y,B=0}else{var ve=ee*ee+te*te;ve>B&&(F=p,W=y,B=ve)}break}case un.C:{var ye=i[$++],Ae=i[$++],me=i[$++],De=i[$++],Fe=i[$++],je=i[$++];if(b){var ae=S[P++];if(E+ae>O){var de=(O-E)/ae;Hg(c,ye,me,Fe,de,hm),Hg(f,Ae,De,je,de,fm),e.bezierCurveTo(hm[1],fm[1],hm[2],fm[2],hm[3],fm[3]);break e}E+=ae}e.bezierCurveTo(ye,Ae,me,De,Fe,je),c=Fe,f=je;break}case un.Q:{var ye=i[$++],Ae=i[$++],me=i[$++],De=i[$++];if(b){var ae=S[P++];if(E+ae>O){var de=(O-E)/ae;lw(c,ye,me,de,hm),lw(f,Ae,De,de,fm),e.quadraticCurveTo(hm[1],fm[1],hm[2],fm[2]);break e}E+=ae}e.quadraticCurveTo(ye,Ae,me,De),c=me,f=De;break}case un.A:var ct=i[$++],xe=i[$++],$e=i[$++],pt=i[$++],_t=i[$++],Dt=i[$++],qt=i[$++],_r=!i[$++],Kt=$e>pt?$e:pt,zt=$d($e-pt)>.001,yr=_t+Dt,Gt=!1;if(b){var ae=S[P++];E+ae>O&&(yr=_t+Dt*(O-E)/ae,Gt=!0),E+=ae}if(zt&&e.ellipse?e.ellipse(ct,xe,$e,pt,qt,_t,yr,_r):e.arc(ct,xe,Kt,_t,yr,_r),Gt)break e;Q&&(o=dm(_t)*$e+ct,l=pm(_t)*pt+xe),c=dm(yr)*$e+ct,f=pm(yr)*pt+xe;break;case un.R:o=c=i[$],l=f=i[$+1],p=i[$++],y=i[$++];var Jt=i[$++],Tr=i[$++];if(b){var ae=S[P++];if(E+ae>O){var dr=O-E;e.moveTo(p,y),e.lineTo(p+GE(dr,Jt),y),dr-=Jt,dr>0&&e.lineTo(p+Jt,y+GE(dr,Tr)),dr-=Tr,dr>0&&e.lineTo(p+XE(Jt-dr,0),y+Tr),dr-=Jt,dr>0&&e.lineTo(p,y+XE(Tr-dr,0));break e}E+=ae}e.rect(p,y,Jt,Tr);break;case un.Z:if(b){var ae=S[P++];if(E+ae>O){var de=(O-E)/ae;e.lineTo(c*(1-de)+o*de,f*(1-de)+l*de);break e}E+=ae}e.closePath(),c=o,f=l}}},r.prototype.clone=function(){var e=new r,t=this.data;return e.data=t.slice?t.slice():Array.prototype.slice.call(t),e._len=this._len,e},r.CMD=un,r.initDefaultProps=(function(){var e=r.prototype;e._saveData=!0,e._ux=0,e._uy=0,e._pendingPtDist=0,e._version=0})(),r})();function _g(r,e,t,i,n,a,s){if(n===0)return!1;var o=n,l=0,c=r;if(s>e+o&&s>i+o||s<e-o&&s<i-o||a>r+o&&a>t+o||a<r-o&&a<t-o)return!1;if(r!==t)l=(e-i)/(r-t),c=(r*i-t*e)/(r-t);else return Math.abs(a-r)<=o/2;var f=l*a-s+c,p=f*f/(l*l+1);return p<=o/2*o/2}function wce(r,e,t,i,n,a,s,o,l,c,f){if(l===0)return!1;var p=l;if(f>e+p&&f>i+p&&f>a+p&&f>o+p||f<e-p&&f<i-p&&f<a-p&&f<o-p||c>r+p&&c>t+p&&c>n+p&&c>s+p||c<r-p&&c<t-p&&c<n-p&&c<s-p)return!1;var y=i$(r,e,t,i,n,a,s,o,c,f,null);return y<=p/2}function V$(r,e,t,i,n,a,s,o,l){if(s===0)return!1;var c=s;if(l>e+c&&l>i+c&&l>a+c||l<e-c&&l<i-c&&l<a-c||o>r+c&&o>t+c&&o>n+c||o<r-c&&o<t-c&&o<n-c)return!1;var f=a$(r,e,t,i,n,a,o,l,null);return f<=c/2}var V4=Math.PI*2;function _u(r){return r%=V4,r<0&&(r+=V4),r}var Bx=Math.PI*2;function Sce(r,e,t,i,n,a,s,o,l){if(s===0)return!1;var c=s;o-=r,l-=e;var f=Math.sqrt(o*o+l*l);if(f-c>t||f+c<t)return!1;if(Math.abs(i-n)%Bx<1e-4)return!0;if(a){var p=i;i=_u(n),n=_u(p)}else i=_u(i),n=_u(n);i>n&&(n+=Bx);var y=Math.atan2(l,o);return y<0&&(y+=Bx),y>=i&&y<=n||y+Bx>=i&&y+Bx<=n}function Kd(r,e,t,i,n,a){if(a>e&&a>i||a<e&&a<i||i===e)return 0;var s=(a-e)/(i-e),o=i<e?1:-1;(s===1||s===0)&&(o=i<e?.5:-.5);var l=s*(t-r)+r;return l===n?1/0:l>n?o:0}var ug=jf.CMD,gm=Math.PI*2,Tce=1e-4;function Ace(r,e){return Math.abs(r-e)<Tce}var tl=[-1,-1,-1],hc=[-1,-1];function Cce(){var r=hc[0];hc[0]=hc[1],hc[1]=r}function Mce(r,e,t,i,n,a,s,o,l,c){if(c>e&&c>i&&c>a&&c>o||c<e&&c<i&&c<a&&c<o)return 0;var f=_A(e,i,a,o,c,tl);if(f===0)return 0;for(var p=0,y=-1,b=void 0,S=void 0,C=0;C<f;C++){var E=tl[C],P=E===0||E===1?.5:1,O=oo(r,t,n,s,E);O<l||(y<0&&(y=r$(e,i,a,o,hc),hc[1]<hc[0]&&y>1&&Cce(),b=oo(e,i,a,o,hc[0]),y>1&&(S=oo(e,i,a,o,hc[1]))),y===2?E<hc[0]?p+=b<e?P:-P:E<hc[1]?p+=S<b?P:-P:p+=o<S?P:-P:E<hc[0]?p+=b<e?P:-P:p+=o<b?P:-P)}return p}function Ece(r,e,t,i,n,a,s,o){if(o>e&&o>i&&o>a||o<e&&o<i&&o<a)return 0;var l=zle(e,i,a,o,tl);if(l===0)return 0;var c=n$(e,i,a);if(c>=0&&c<=1){for(var f=0,p=Po(e,i,a,c),y=0;y<l;y++){var b=tl[y]===0||tl[y]===1?.5:1,S=Po(r,t,n,tl[y]);S<s||(tl[y]<c?f+=p<e?b:-b:f+=a<p?b:-b)}return f}else{var b=tl[0]===0||tl[0]===1?.5:1,S=Po(r,t,n,tl[0]);return S<s?0:a<e?b:-b}}function Ice(r,e,t,i,n,a,s,o){if(o-=e,o>t||o<-t)return 0;var l=Math.sqrt(t*t-o*o);tl[0]=-l,tl[1]=l;var c=Math.abs(i-n);if(c<1e-4)return 0;if(c>=gm-1e-4){i=0,n=gm;var f=a?1:-1;return s>=tl[0]+r&&s<=tl[1]+r?f:0}if(i>n){var p=i;i=n,n=p}i<0&&(i+=gm,n+=gm);for(var y=0,b=0;b<2;b++){var S=tl[b];if(S+r>s){var C=Math.atan2(o,S),f=a?1:-1;C<0&&(C=gm+C),(C>=i&&C<=n||C+gm>=i&&C+gm<=n)&&(C>Math.PI/2&&C<Math.PI*1.5&&(f=-f),y+=f)}}return y}function U$(r,e,t,i,n){for(var a=r.data,s=r.len(),o=0,l=0,c=0,f=0,p=0,y,b,S=0;S<s;){var C=a[S++],E=S===1;switch(C===ug.M&&S>1&&(t||(o+=Kd(l,c,f,p,i,n))),E&&(l=a[S],c=a[S+1],f=l,p=c),C){case ug.M:f=a[S++],p=a[S++],l=f,c=p;break;case ug.L:if(t){if(_g(l,c,a[S],a[S+1],e,i,n))return!0}else o+=Kd(l,c,a[S],a[S+1],i,n)||0;l=a[S++],c=a[S++];break;case ug.C:if(t){if(wce(l,c,a[S++],a[S++],a[S++],a[S++],a[S],a[S+1],e,i,n))return!0}else o+=Mce(l,c,a[S++],a[S++],a[S++],a[S++],a[S],a[S+1],i,n)||0;l=a[S++],c=a[S++];break;case ug.Q:if(t){if(V$(l,c,a[S++],a[S++],a[S],a[S+1],e,i,n))return!0}else o+=Ece(l,c,a[S++],a[S++],a[S],a[S+1],i,n)||0;l=a[S++],c=a[S++];break;case ug.A:var P=a[S++],O=a[S++],B=a[S++],F=a[S++],W=a[S++],$=a[S++];S+=1;var q=!!(1-a[S++]);y=Math.cos(W)*B+P,b=Math.sin(W)*F+O,E?(f=y,p=b):o+=Kd(l,c,y,b,i,n);var Q=(i-P)*F/B+P;if(t){if(Sce(P,O,F,W,W+$,q,e,Q,n))return!0}else o+=Ice(P,O,F,W,W+$,q,Q,n);l=Math.cos(W+$)*B+P,c=Math.sin(W+$)*F+O;break;case ug.R:f=l=a[S++],p=c=a[S++];var ee=a[S++],te=a[S++];if(y=f+ee,b=p+te,t){if(_g(f,p,y,p,e,i,n)||_g(y,p,y,b,e,i,n)||_g(y,b,f,b,e,i,n)||_g(f,b,f,p,e,i,n))return!0}else o+=Kd(y,p,y,b,i,n),o+=Kd(f,b,f,p,i,n);break;case ug.Z:if(t){if(_g(l,c,f,p,e,i,n))return!0}else o+=Kd(l,c,f,p,i,n);l=f,c=p;break}}return!t&&!Ace(c,p)&&(o+=Kd(l,c,f,p,i,n)||0),o!==0}function Pce(r,e,t){return U$(r,0,!1,e,t)}function Rce(r,e,t,i){return U$(r,e,!0,t,i)}var AA=lr({fill:"#000",stroke:null,strokePercent:1,fillOpacity:1,strokeOpacity:1,lineDashOffset:0,lineWidth:1,lineCap:"butt",miterLimit:10,strokeNoScale:!1,strokeFirst:!1},ry),Dce={style:lr({fill:!0,stroke:!0,strokePercent:!0,fillOpacity:!0,strokeOpacity:!0,lineDashOffset:!0,lineWidth:!0,miterLimit:!0},OC.style)},YE=Uf.concat(["invisible","culling","z","z2","zlevel","parent"]),Xr=(function(r){Ye(e,r);function e(t){return r.call(this,t)||this}return e.prototype.update=function(){var t=this;r.prototype.update.call(this);var i=this.style;if(i.decal){var n=this._decalEl=this._decalEl||new e;n.buildPath===e.prototype.buildPath&&(n.buildPath=function(l){t.buildPath(l,t.shape)}),n.silent=!0;var a=n.style;for(var s in i)a[s]!==i[s]&&(a[s]=i[s]);a.fill=i.fill?i.decal:null,a.decal=null,a.shadowColor=null,i.strokeFirst&&(a.stroke=null);for(var o=0;o<YE.length;++o)n[YE[o]]=this[YE[o]];n.__dirty|=gu}else this._decalEl&&(this._decalEl=null)},e.prototype.getDecalElement=function(){return this._decalEl},e.prototype._init=function(t){var i=qr(t);this.shape=this.getDefaultShape();var n=this.getDefaultStyle();n&&this.useStyle(n);for(var a=0;a<i.length;a++){var s=i[a],o=t[s];s==="style"?this.style?mt(this.style,o):this.useStyle(o):s==="shape"?mt(this.shape,o):r.prototype.attrKV.call(this,s,o)}this.style||this.useStyle({})},e.prototype.getDefaultStyle=function(){return null},e.prototype.getDefaultShape=function(){return{}},e.prototype.canBeInsideText=function(){return this.hasFill()},e.prototype.getInsideTextFill=function(){var t=this.style.fill;if(t!=="none"){if($t(t)){var i=hw(t,0);return i>.5?jR:i>.2?vue:$R}else if(t)return $R}return jR},e.prototype.getInsideTextStroke=function(t){var i=this.style.fill;if($t(i)){var n=this.__zr,a=!!(n&&n.isDarkMode()),s=hw(t,0)<HR;if(a===s)return i}},e.prototype.buildPath=function(t,i,n){},e.prototype.pathUpdated=function(){this.__dirty&=~l0},e.prototype.getUpdatedPathProxy=function(t){return!this.path&&this.createPathProxy(),this.path.beginPath(),this.buildPath(this.path,this.shape,t),this.path},e.prototype.createPathProxy=function(){this.path=new jf(!1)},e.prototype.hasStroke=function(){var t=this.style,i=t.stroke;return!(i==null||i==="none"||!(t.lineWidth>0))},e.prototype.hasFill=function(){var t=this.style,i=t.fill;return i!=null&&i!=="none"},e.prototype.getBoundingRect=function(){var t=this._rect,i=this.style,n=!t;if(n){var a=!1;this.path||(a=!0,this.createPathProxy());var s=this.path;(a||this.__dirty&l0)&&(s.beginPath(),this.buildPath(s,this.shape,!1),this.pathUpdated()),t=s.getBoundingRect()}if(this._rect=t,this.hasStroke()&&this.path&&this.path.len()>0){var o=this._rectStroke||(this._rectStroke=t.clone());if(this.__dirty||n){o.copy(t);var l=i.strokeNoScale?this.getLineScale():1,c=i.lineWidth;if(!this.hasFill()){var f=this.strokeContainThreshold;c=Math.max(c,f??4)}l>1e-10&&(o.width+=c/l,o.height+=c/l,o.x-=c/l/2,o.y-=c/l/2)}return o}return t},e.prototype.contain=function(t,i){var n=this.transformCoordToLocal(t,i),a=this.getBoundingRect(),s=this.style;if(t=n[0],i=n[1],a.contain(t,i)){var o=this.path;if(this.hasStroke()){var l=s.lineWidth,c=s.strokeNoScale?this.getLineScale():1;if(c>1e-10&&(this.hasFill()||(l=Math.max(l,this.strokeContainThreshold)),Rce(o,l/c,t,i)))return!0}if(this.hasFill())return Pce(o,t,i)}return!1},e.prototype.dirtyShape=function(){this.__dirty|=l0,this._rect&&(this._rect=null),this._decalEl&&this._decalEl.dirtyShape(),this.markRedraw()},e.prototype.dirty=function(){this.dirtyStyle(),this.dirtyShape()},e.prototype.animateShape=function(t){return this.animate("shape",t)},e.prototype.updateDuringAnimation=function(t){t==="style"?this.dirtyStyle():t==="shape"?this.dirtyShape():this.markRedraw()},e.prototype.attrKV=function(t,i){t==="shape"?this.setShape(i):r.prototype.attrKV.call(this,t,i)},e.prototype.setShape=function(t,i){var n=this.shape;return n||(n=this.shape={}),typeof t=="string"?n[t]=i:mt(n,t),this.dirtyShape(),this},e.prototype.shapeChanged=function(){return!!(this.__dirty&l0)},e.prototype.createStyle=function(t){return Hw(AA,t)},e.prototype._innerSaveToNormal=function(t){r.prototype._innerSaveToNormal.call(this,t);var i=this._normalState;t.shape&&!i.shape&&(i.shape=mt({},this.shape))},e.prototype._applyStateObj=function(t,i,n,a,s,o){r.prototype._applyStateObj.call(this,t,i,n,a,s,o);var l=!(i&&a),c;if(i&&i.shape?s?a?c=i.shape:(c=mt({},n.shape),mt(c,i.shape)):(c=mt({},a?this.shape:n.shape),mt(c,i.shape)):l&&(c=n.shape),c)if(s){this.shape=mt({},this.shape);for(var f={},p=qr(c),y=0;y<p.length;y++){var b=p[y];typeof c[b]=="object"?this.shape[b]=c[b]:f[b]=c[b]}this._transitionState(t,{shape:f},o)}else this.shape=c,this.dirtyShape()},e.prototype._mergeStates=function(t){for(var i=r.prototype._mergeStates.call(this,t),n,a=0;a<t.length;a++){var s=t[a];s.shape&&(n=n||{},this._mergeStyle(n,s.shape))}return n&&(i.shape=n),i},e.prototype.getAnimationStyleProps=function(){return Dce},e.prototype.isZeroArea=function(){return!1},e.extend=function(t){var i=(function(a){Ye(s,a);function s(o){var l=a.call(this,o)||this;return t.init&&t.init.call(l,o),l}return s.prototype.getDefaultStyle=function(){return hr(t.style)},s.prototype.getDefaultShape=function(){return hr(t.shape)},s})(e);for(var n in t)typeof t[n]=="function"&&(i.prototype[n]=t[n]);return i},e.initDefaultProps=(function(){var t=e.prototype;t.type="path",t.strokeContainThreshold=5,t.segmentIgnoreThreshold=0,t.subPixelOptimize=!1,t.autoBatch=!1,t.__dirty=gu|p1|l0})(),e})(Tc),kce=lr({strokeFirst:!0,font:Ug,x:0,y:0,textAlign:"left",textBaseline:"top",miterLimit:2},AA),G0=(function(r){Ye(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.hasStroke=function(){var t=this.style,i=t.stroke;return i!=null&&i!=="none"&&t.lineWidth>0},e.prototype.hasFill=function(){var t=this.style,i=t.fill;return i!=null&&i!=="none"},e.prototype.createStyle=function(t){return Hw(kce,t)},e.prototype.setBoundingRect=function(t){this._rect=t},e.prototype.getBoundingRect=function(){var t=this.style;if(!this._rect){var i=t.text;i!=null?i+="":i="";var n=Ww(i,t.font,t.textAlign,t.textBaseline);if(n.x+=t.x||0,n.y+=t.y||0,this.hasStroke()){var a=t.lineWidth;n.x-=a/2,n.y-=a/2,n.width+=a,n.height+=a}this._rect=n}return this._rect},e.initDefaultProps=(function(){var t=e.prototype;t.dirtyRectTolerance=10})(),e})(Tc);G0.prototype.type="tspan";var Lce=lr({x:0,y:0},ry),Oce={style:lr({x:!0,y:!0,width:!0,height:!0,sx:!0,sy:!0,sWidth:!0,sHeight:!0},OC.style)};function Nce(r){return!!(r&&typeof r!="string"&&r.width&&r.height)}var go=(function(r){Ye(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.createStyle=function(t){return Hw(Lce,t)},e.prototype._getSize=function(t){var i=this.style,n=i[t];if(n!=null)return n;var a=Nce(i.image)?i.image:this.__image;if(!a)return 0;var s=t==="width"?"height":"width",o=i[s];return o==null?a[t]:a[t]/a[s]*o},e.prototype.getWidth=function(){return this._getSize("width")},e.prototype.getHeight=function(){return this._getSize("height")},e.prototype.getAnimationStyleProps=function(){return Oce},e.prototype.getBoundingRect=function(){var t=this.style;return this._rect||(this._rect=new Dr(t.x||0,t.y||0,this.getWidth(),this.getHeight())),this._rect},e})(Tc);go.prototype.type="image";function Bce(r,e){var t=e.x,i=e.y,n=e.width,a=e.height,s=e.r,o,l,c,f;n<0&&(t=t+n,n=-n),a<0&&(i=i+a,a=-a),typeof s=="number"?o=l=c=f=s:s instanceof Array?s.length===1?o=l=c=f=s[0]:s.length===2?(o=c=s[0],l=f=s[1]):s.length===3?(o=s[0],l=f=s[1],c=s[2]):(o=s[0],l=s[1],c=s[2],f=s[3]):o=l=c=f=0;var p;o+l>n&&(p=o+l,o*=n/p,l*=n/p),c+f>n&&(p=c+f,c*=n/p,f*=n/p),l+c>a&&(p=l+c,l*=a/p,c*=a/p),o+f>a&&(p=o+f,o*=a/p,f*=a/p),r.moveTo(t+o,i),r.lineTo(t+n-l,i),l!==0&&r.arc(t+n-l,i+l,l,-Math.PI/2,0),r.lineTo(t+n,i+a-c),c!==0&&r.arc(t+n-c,i+a-c,c,0,Math.PI/2),r.lineTo(t+f,i+a),f!==0&&r.arc(t+f,i+a-f,f,Math.PI/2,Math.PI),r.lineTo(t,i+o),o!==0&&r.arc(t+o,i+o,o,Math.PI,Math.PI*1.5)}var b0=Math.round;function H$(r,e,t){if(e){var i=e.x1,n=e.x2,a=e.y1,s=e.y2;r.x1=i,r.x2=n,r.y1=a,r.y2=s;var o=t&&t.lineWidth;return o&&(b0(i*2)===b0(n*2)&&(r.x1=r.x2=Hm(i,o,!0)),b0(a*2)===b0(s*2)&&(r.y1=r.y2=Hm(a,o,!0))),r}}function j$(r,e,t){if(e){var i=e.x,n=e.y,a=e.width,s=e.height;r.x=i,r.y=n,r.width=a,r.height=s;var o=t&&t.lineWidth;return o&&(r.x=Hm(i,o,!0),r.y=Hm(n,o,!0),r.width=Math.max(Hm(i+a,o,!1)-r.x,a===0?0:1),r.height=Math.max(Hm(n+s,o,!1)-r.y,s===0?0:1)),r}}function Hm(r,e,t){if(!e)return r;var i=b0(r*2);return(i+b0(e))%2===0?i/2:(i+(t?1:-1))/2}var zce=(function(){function r(){this.x=0,this.y=0,this.width=0,this.height=0}return r})(),Fce={},li=(function(r){Ye(e,r);function e(t){return r.call(this,t)||this}return e.prototype.getDefaultShape=function(){return new zce},e.prototype.buildPath=function(t,i){var n,a,s,o;if(this.subPixelOptimize){var l=j$(Fce,i,this.style);n=l.x,a=l.y,s=l.width,o=l.height,l.r=i.r,i=l}else n=i.x,a=i.y,s=i.width,o=i.height;i.r?Bce(t,i):t.rect(n,a,s,o)},e.prototype.isZeroArea=function(){return!this.shape.width||!this.shape.height},e})(Xr);li.prototype.type="rect";var U4={fill:"#000"},H4=2,Vce={style:lr({fill:!0,stroke:!0,fillOpacity:!0,strokeOpacity:!0,lineWidth:!0,fontSize:!0,lineHeight:!0,width:!0,height:!0,textShadowColor:!0,textShadowBlur:!0,textShadowOffsetX:!0,textShadowOffsetY:!0,backgroundColor:!0,padding:!0,borderColor:!0,borderWidth:!0,borderRadius:!0},OC.style)},si=(function(r){Ye(e,r);function e(t){var i=r.call(this)||this;return i.type="text",i._children=[],i._defaultStyle=U4,i.attr(t),i}return e.prototype.childrenRef=function(){return this._children},e.prototype.update=function(){r.prototype.update.call(this),this.styleChanged()&&this._updateSubTexts();for(var t=0;t<this._children.length;t++){var i=this._children[t];i.zlevel=this.zlevel,i.z=this.z,i.z2=this.z2,i.culling=this.culling,i.cursor=this.cursor,i.invisible=this.invisible}},e.prototype.updateTransform=function(){var t=this.innerTransformable;t?(t.updateTransform(),t.transform&&(this.transform=t.transform)):r.prototype.updateTransform.call(this)},e.prototype.getLocalTransform=function(t){var i=this.innerTransformable;return i?i.getLocalTransform(t):r.prototype.getLocalTransform.call(this,t)},e.prototype.getComputedTransform=function(){return this.__hostTarget&&(this.__hostTarget.getComputedTransform(),this.__hostTarget.updateInnerText(!0)),r.prototype.getComputedTransform.call(this)},e.prototype._updateSubTexts=function(){this._childCursor=0,jce(this.style),this.style.rich?this._updateRichTexts():this._updatePlainTexts(),this._children.length=this._childCursor,this.styleUpdated()},e.prototype.addSelfToZr=function(t){r.prototype.addSelfToZr.call(this,t);for(var i=0;i<this._children.length;i++)this._children[i].__zr=t},e.prototype.removeSelfFromZr=function(t){r.prototype.removeSelfFromZr.call(this,t);for(var i=0;i<this._children.length;i++)this._children[i].__zr=null},e.prototype.getBoundingRect=function(){if(this.styleChanged()&&this._updateSubTexts(),!this._rect){for(var t=new Dr(0,0,0,0),i=this._children,n=[],a=null,s=0;s<i.length;s++){var o=i[s],l=o.getBoundingRect(),c=o.getLocalTransform(n);c?(t.copy(l),t.applyTransform(c),a=a||t.clone(),a.union(t)):(a=a||l.clone(),a.union(l))}this._rect=a||t}return this._rect},e.prototype.setDefaultTextStyle=function(t){this._defaultStyle=t||U4},e.prototype.setTextContent=function(t){},e.prototype._mergeStyle=function(t,i){if(!i)return t;var n=i.rich,a=t.rich||n&&{};return mt(t,i),n&&a?(this._mergeRich(a,n),t.rich=a):a&&(t.rich=a),t},e.prototype._mergeRich=function(t,i){for(var n=qr(i),a=0;a<n.length;a++){var s=n[a];t[s]=t[s]||{},mt(t[s],i[s])}},e.prototype.getAnimationStyleProps=function(){return Vce},e.prototype._getOrCreateChild=function(t){var i=this._children[this._childCursor];return(!i||!(i instanceof t))&&(i=new t),this._children[this._childCursor++]=i,i.__zr=this.__zr,i.parent=this,i},e.prototype._updatePlainTexts=function(){var t=this.style,i=t.font||Ug,n=t.padding,a=q4(t),s=cce(a,t),o=KE(t),l=!!t.backgroundColor,c=s.outerHeight,f=s.outerWidth,p=s.contentWidth,y=s.lines,b=s.lineHeight,S=this._defaultStyle;this.isTruncated=!!s.isTruncated;var C=t.x||0,E=t.y||0,P=t.align||S.align||"left",O=t.verticalAlign||S.verticalAlign||"top",B=C,F=u0(E,s.contentHeight,O);if(o||n){var W=v1(C,f,P),$=u0(E,c,O);o&&this._renderBackground(t,t,W,$,f,c)}F+=b/2,n&&(B=Z4(C,P,n),O==="top"?F+=n[0]:O==="bottom"&&(F-=n[2]));for(var q=0,Q=!1,ee=X4("fill"in t?t.fill:(Q=!0,S.fill)),te=G4("stroke"in t?t.stroke:!l&&(!S.autoStroke||Q)?(q=H4,S.stroke):null),ae=t.textShadowBlur>0,de=t.width!=null&&(t.overflow==="truncate"||t.overflow==="break"||t.overflow==="breakAll"),ve=s.calculatedLineHeight,ye=0;ye<y.length;ye++){var Ae=this._getOrCreateChild(G0),me=Ae.createStyle();Ae.useStyle(me),me.text=y[ye],me.x=B,me.y=F,me.textAlign=P,me.textBaseline="middle",me.opacity=t.opacity,me.strokeFirst=!0,ae&&(me.shadowBlur=t.textShadowBlur||0,me.shadowColor=t.textShadowColor||"transparent",me.shadowOffsetX=t.textShadowOffsetX||0,me.shadowOffsetY=t.textShadowOffsetY||0),me.stroke=te,me.fill=ee,te&&(me.lineWidth=t.lineWidth||q,me.lineDash=t.lineDash,me.lineDashOffset=t.lineDashOffset||0),me.font=i,$4(me,t),F+=b,de&&Ae.setBoundingRect(new Dr(v1(me.x,p,me.textAlign),u0(me.y,ve,me.textBaseline),p,ve))}},e.prototype._updateRichTexts=function(){var t=this.style,i=q4(t),n=dce(i,t),a=n.width,s=n.outerWidth,o=n.outerHeight,l=t.padding,c=t.x||0,f=t.y||0,p=this._defaultStyle,y=t.align||p.align,b=t.verticalAlign||p.verticalAlign;this.isTruncated=!!n.isTruncated;var S=v1(c,s,y),C=u0(f,o,b),E=S,P=C;l&&(E+=l[3],P+=l[0]);var O=E+a;KE(t)&&this._renderBackground(t,t,S,C,s,o);for(var B=!!t.backgroundColor,F=0;F<n.lines.length;F++){for(var W=n.lines[F],$=W.tokens,q=$.length,Q=W.lineHeight,ee=W.width,te=0,ae=E,de=O,ve=q-1,ye=void 0;te<q&&(ye=$[te],!ye.align||ye.align==="left");)this._placeToken(ye,t,Q,P,ae,"left",B),ee-=ye.width,ae+=ye.width,te++;for(;ve>=0&&(ye=$[ve],ye.align==="right");)this._placeToken(ye,t,Q,P,de,"right",B),ee-=ye.width,de-=ye.width,ve--;for(ae+=(a-(ae-E)-(O-de)-ee)/2;te<=ve;)ye=$[te],this._placeToken(ye,t,Q,P,ae+ye.width/2,"center",B),ae+=ye.width,te++;P+=Q}},e.prototype._placeToken=function(t,i,n,a,s,o,l){var c=i.rich[t.styleName]||{};c.text=t.text;var f=t.verticalAlign,p=a+n/2;f==="top"?p=a+t.height/2:f==="bottom"&&(p=a+n-t.height/2);var y=!t.isLineHolder&&KE(c);y&&this._renderBackground(c,i,o==="right"?s-t.width:o==="center"?s-t.width/2:s,p-t.height/2,t.width,t.height);var b=!!c.backgroundColor,S=t.textPadding;S&&(s=Z4(s,o,S),p-=t.height/2-S[0]-t.innerHeight/2);var C=this._getOrCreateChild(G0),E=C.createStyle();C.useStyle(E);var P=this._defaultStyle,O=!1,B=0,F=X4("fill"in c?c.fill:"fill"in i?i.fill:(O=!0,P.fill)),W=G4("stroke"in c?c.stroke:"stroke"in i?i.stroke:!b&&!l&&(!P.autoStroke||O)?(B=H4,P.stroke):null),$=c.textShadowBlur>0||i.textShadowBlur>0;E.text=t.text,E.x=s,E.y=p,$&&(E.shadowBlur=c.textShadowBlur||i.textShadowBlur||0,E.shadowColor=c.textShadowColor||i.textShadowColor||"transparent",E.shadowOffsetX=c.textShadowOffsetX||i.textShadowOffsetX||0,E.shadowOffsetY=c.textShadowOffsetY||i.textShadowOffsetY||0),E.textAlign=o,E.textBaseline="middle",E.font=t.font||Ug,E.opacity=Th(c.opacity,i.opacity,1),$4(E,c),W&&(E.lineWidth=Th(c.lineWidth,i.lineWidth,B),E.lineDash=wr(c.lineDash,i.lineDash),E.lineDashOffset=i.lineDashOffset||0,E.stroke=W),F&&(E.fill=F);var q=t.contentWidth,Q=t.contentHeight;C.setBoundingRect(new Dr(v1(E.x,q,E.textAlign),u0(E.y,Q,E.textBaseline),q,Q))},e.prototype._renderBackground=function(t,i,n,a,s,o){var l=t.backgroundColor,c=t.borderWidth,f=t.borderColor,p=l&&l.image,y=l&&!p,b=t.borderRadius,S=this,C,E;if(y||t.lineHeight||c&&f){C=this._getOrCreateChild(li),C.useStyle(C.createStyle()),C.style.fill=null;var P=C.shape;P.x=n,P.y=a,P.width=s,P.height=o,P.r=b,C.dirtyShape()}if(y){var O=C.style;O.fill=l||null,O.fillOpacity=wr(t.fillOpacity,1)}else if(p){E=this._getOrCreateChild(go),E.onload=function(){S.dirtyStyle()};var B=E.style;B.image=l.image,B.x=n,B.y=a,B.width=s,B.height=o}if(c&&f){var O=C.style;O.lineWidth=c,O.stroke=f,O.strokeOpacity=wr(t.strokeOpacity,1),O.lineDash=t.borderDash,O.lineDashOffset=t.borderDashOffset||0,C.strokeContainThreshold=0,C.hasFill()&&C.hasStroke()&&(O.strokeFirst=!0,O.lineWidth*=2)}var F=(C||E).style;F.shadowBlur=t.shadowBlur||0,F.shadowColor=t.shadowColor||"transparent",F.shadowOffsetX=t.shadowOffsetX||0,F.shadowOffsetY=t.shadowOffsetY||0,F.opacity=Th(t.opacity,i.opacity,1)},e.makeFont=function(t){var i="";return W$(t)&&(i=[t.fontStyle,t.fontWeight,$$(t.fontSize),t.fontFamily||"sans-serif"].join(" ")),i&&mc(i)||t.textFont||t.font},e})(Tc),Uce={left:!0,right:1,center:1},Hce={top:1,bottom:1,middle:1},j4=["fontStyle","fontWeight","fontSize","fontFamily"];function $$(r){return typeof r=="string"&&(r.indexOf("px")!==-1||r.indexOf("rem")!==-1||r.indexOf("em")!==-1)?r:isNaN(+r)?fk+"px":r+"px"}function $4(r,e){for(var t=0;t<j4.length;t++){var i=j4[t],n=e[i];n!=null&&(r[i]=n)}}function W$(r){return r.fontSize!=null||r.fontFamily||r.fontWeight}function jce(r){return W4(r),se(r.rich,W4),r}function W4(r){if(r){r.font=si.makeFont(r);var e=r.align;e==="middle"&&(e="center"),r.align=e==null||Uce[e]?e:"left";var t=r.verticalAlign;t==="center"&&(t="middle"),r.verticalAlign=t==null||Hce[t]?t:"top";var i=r.padding;i&&(r.padding=CC(r.padding))}}function G4(r,e){return r==null||e<=0||r==="transparent"||r==="none"?null:r.image||r.colorStops?"#000":r}function X4(r){return r==null||r==="none"?null:r.image||r.colorStops?"#000":r}function Z4(r,e,t){return e==="right"?r-t[1]:e==="center"?r+t[3]/2-t[1]/2:r+t[3]}function q4(r){var e=r.text;return e!=null&&(e+=""),e}function KE(r){return!!(r.backgroundColor||r.lineHeight||r.borderWidth&&r.borderColor)}var br=fi(),JR=function(r,e,t,i){if(i){var n=br(i);n.dataIndex=t,n.dataType=e,n.seriesIndex=r,n.ssrType="chart",i.type==="group"&&i.traverse(function(a){var s=br(a);s.seriesIndex=r,s.dataIndex=t,s.dataType=e,s.ssrType="chart"})}},Y4=1,K4={},G$=fi(),kk=fi(),Lk=0,Xw=1,BC=2,ll=["emphasis","blur","select"],pw=["normal","emphasis","blur","select"],ob=10,$ce=9,iy="highlight",O2="downplay",j1="select",N2="unselect",$1="toggleSelect";function H_(r){return r!=null&&r!=="none"}function zC(r,e,t){r.onHoverStateChange&&(r.hoverState||0)!==t&&r.onHoverStateChange(e),r.hoverState=t}function X$(r){zC(r,"emphasis",BC)}function Z$(r){r.hoverState===BC&&zC(r,"normal",Lk)}function Ok(r){zC(r,"blur",Xw)}function q$(r){r.hoverState===Xw&&zC(r,"normal",Lk)}function Wce(r){r.selected=!0}function Gce(r){r.selected=!1}function Q4(r,e,t){e(r,t)}function mp(r,e,t){Q4(r,e,t),r.isGroup&&r.traverse(function(i){Q4(i,e,t)})}function CA(r,e){switch(e){case"emphasis":r.hoverState=BC;break;case"normal":r.hoverState=Lk;break;case"blur":r.hoverState=Xw;break;case"select":r.selected=!0}}function Xce(r,e,t,i){for(var n=r.style,a={},s=0;s<e.length;s++){var o=e[s],l=n[o];a[o]=l??(i&&i[o])}for(var s=0;s<r.animators.length;s++){var c=r.animators[s];c.__fromStateTransition&&c.__fromStateTransition.indexOf(t)<0&&c.targetName==="style"&&c.saveTo(a,e)}return a}function Zce(r,e,t,i){var n=t&&Or(t,"select")>=0,a=!1;if(r instanceof Xr){var s=G$(r),o=n&&s.selectFill||s.normalFill,l=n&&s.selectStroke||s.normalStroke;if(H_(o)||H_(l)){i=i||{};var c=i.style||{};c.fill==="inherit"?(a=!0,i=mt({},i),c=mt({},c),c.fill=o):!H_(c.fill)&&H_(o)?(a=!0,i=mt({},i),c=mt({},c),c.fill=xA(o)):!H_(c.stroke)&&H_(l)&&(a||(i=mt({},i),c=mt({},c)),c.stroke=xA(l)),i.style=c}}if(i&&i.z2==null){a||(i=mt({},i));var f=r.z2EmphasisLift;i.z2=r.z2+(f??ob)}return i}function qce(r,e,t){if(t&&t.z2==null){t=mt({},t);var i=r.z2SelectLift;t.z2=r.z2+(i??$ce)}return t}function Yce(r,e,t){var i=Or(r.currentStates,e)>=0,n=r.style.opacity,a=i?null:Xce(r,["opacity"],e,{opacity:1});t=t||{};var s=t.style||{};return s.opacity==null&&(t=mt({},t),s=mt({opacity:i?n:a.opacity*.1},s),t.style=s),t}function QE(r,e){var t=this.states[r];if(this.style){if(r==="emphasis")return Zce(this,r,e,t);if(r==="blur")return Yce(this,r,t);if(r==="select")return qce(this,r,t)}return t}function _y(r){r.stateProxy=QE;var e=r.getTextContent(),t=r.getTextGuideLine();e&&(e.stateProxy=QE),t&&(t.stateProxy=QE)}function J4(r,e){!J$(r,e)&&!r.__highByOuter&&mp(r,X$)}function ez(r,e){!J$(r,e)&&!r.__highByOuter&&mp(r,Z$)}function cp(r,e){r.__highByOuter|=1<<(e||0),mp(r,X$)}function hp(r,e){!(r.__highByOuter&=~(1<<(e||0)))&&mp(r,Z$)}function Y$(r){mp(r,Ok)}function Nk(r){mp(r,q$)}function K$(r){mp(r,Wce)}function Q$(r){mp(r,Gce)}function J$(r,e){return r.__highDownSilentOnTouch&&e.zrByTouch}function e7(r){var e=r.getModel(),t=[],i=[];e.eachComponent(function(n,a){var s=kk(a),o=n==="series",l=o?r.getViewOfSeriesModel(a):r.getViewOfComponentModel(a);!o&&i.push(l),s.isBlured&&(l.group.traverse(function(c){q$(c)}),o&&t.push(a)),s.isBlured=!1}),se(i,function(n){n&&n.toggleBlurSeries&&n.toggleBlurSeries(t,!1,e)})}function e3(r,e,t,i){var n=i.getModel();t=t||"coordinateSystem";function a(c,f){for(var p=0;p<f.length;p++){var y=c.getItemGraphicEl(f[p]);y&&Nk(y)}}if(r!=null&&!(!e||e==="none")){var s=n.getSeriesByIndex(r),o=s.coordinateSystem;o&&o.master&&(o=o.master);var l=[];n.eachSeries(function(c){var f=s===c,p=c.coordinateSystem;p&&p.master&&(p=p.master);var y=p&&o?p===o:f;if(!(t==="series"&&!f||t==="coordinateSystem"&&!y||e==="series"&&f)){var b=i.getViewOfSeriesModel(c);if(b.group.traverse(function(E){E.__highByOuter&&f&&e==="self"||Ok(E)}),es(e))a(c.getData(),e);else if(cr(e))for(var S=qr(e),C=0;C<S.length;C++)a(c.getData(S[C]),e[S[C]]);l.push(c),kk(c).isBlured=!0}}),n.eachComponent(function(c,f){if(c!=="series"){var p=i.getViewOfComponentModel(f);p&&p.toggleBlurSeries&&p.toggleBlurSeries(l,!0,n)}})}}function t3(r,e,t){if(!(r==null||e==null)){var i=t.getModel().getComponent(r,e);if(i){kk(i).isBlured=!0;var n=t.getViewOfComponentModel(i);!n||!n.focusBlurEnabled||n.group.traverse(function(a){Ok(a)})}}}function Kce(r,e,t){var i=r.seriesIndex,n=r.getData(e.dataType);if(n){var a=my(n,e);a=(xt(a)?a[0]:a)||0;var s=n.getItemGraphicEl(a);if(!s)for(var o=n.count(),l=0;!s&&l<o;)s=n.getItemGraphicEl(l++);if(s){var c=br(s);e3(i,c.focus,c.blurScope,t)}else{var f=r.get(["emphasis","focus"]),p=r.get(["emphasis","blurScope"]);f!=null&&e3(i,f,p,t)}}}function Bk(r,e,t,i){var n={focusSelf:!1,dispatchers:null};if(r==null||r==="series"||e==null||t==null)return n;var a=i.getModel().getComponent(r,e);if(!a)return n;var s=i.getViewOfComponentModel(a);if(!s||!s.findHighDownDispatchers)return n;for(var o=s.findHighDownDispatchers(t),l,c=0;c<o.length;c++)if(br(o[c]).focus==="self"){l=!0;break}return{focusSelf:l,dispatchers:o}}function Qce(r,e,t){var i=br(r),n=Bk(i.componentMainType,i.componentIndex,i.componentHighDownName,t),a=n.dispatchers,s=n.focusSelf;a?(s&&t3(i.componentMainType,i.componentIndex,t),se(a,function(o){return J4(o,e)})):(e3(i.seriesIndex,i.focus,i.blurScope,t),i.focus==="self"&&t3(i.componentMainType,i.componentIndex,t),J4(r,e))}function Jce(r,e,t){e7(t);var i=br(r),n=Bk(i.componentMainType,i.componentIndex,i.componentHighDownName,t).dispatchers;n?se(n,function(a){return ez(a,e)}):ez(r,e)}function ehe(r,e,t){if(i3(e)){var i=e.dataType,n=r.getData(i),a=my(n,e);xt(a)||(a=[a]),r[e.type===$1?"toggleSelect":e.type===j1?"select":"unselect"](a,i)}}function tz(r){var e=r.getAllData();se(e,function(t){var i=t.data,n=t.type;i.eachItemGraphicEl(function(a,s){r.isSelected(s,n)?K$(a):Q$(a)})})}function the(r){var e=[];return r.eachSeries(function(t){var i=t.getAllData();se(i,function(n){n.data;var a=n.type,s=t.getSelectedDataIndices();if(s.length>0){var o={dataIndex:s,seriesIndex:t.seriesIndex};a!=null&&(o.dataType=a),e.push(o)}})}),e}function Og(r,e,t){jm(r,!0),mp(r,_y),r3(r,e,t)}function rhe(r){jm(r,!1)}function Hn(r,e,t,i){i?rhe(r):Og(r,e,t)}function r3(r,e,t){var i=br(r);e!=null?(i.focus=e,i.blurScope=t):i.focus&&(i.focus=null)}var rz=["emphasis","blur","select"],ihe={itemStyle:"getItemStyle",lineStyle:"getLineStyle",areaStyle:"getAreaStyle"};function ts(r,e,t,i){t=t||"itemStyle";for(var n=0;n<rz.length;n++){var a=rz[n],s=e.getModel([a,t]),o=r.ensureState(a);o.style=i?i(s):s[ihe[t]]()}}function jm(r,e){var t=e===!1,i=r;r.highDownSilentOnTouch&&(i.__highDownSilentOnTouch=r.highDownSilentOnTouch),(!t||i.__highDownDispatcher)&&(i.__highByOuter=i.__highByOuter||0,i.__highDownDispatcher=!t)}function gw(r){return!!(r&&r.__highDownDispatcher)}function nhe(r,e,t){var i=br(r);i.componentMainType=e.mainType,i.componentIndex=e.componentIndex,i.componentHighDownName=t}function ahe(r){var e=K4[r];return e==null&&Y4<=32&&(e=K4[r]=Y4++),e}function i3(r){var e=r.type;return e===j1||e===N2||e===$1}function iz(r){var e=r.type;return e===iy||e===O2}function ohe(r){var e=G$(r);e.normalFill=r.style.fill,e.normalStroke=r.style.stroke;var t=r.states.select||{};e.selectFill=t.style&&t.style.fill||null,e.selectStroke=t.style&&t.style.stroke||null}var j_=jf.CMD,she=[[],[],[]],nz=Math.sqrt,lhe=Math.atan2;function t7(r,e){if(e){var t=r.data,i=r.len(),n,a,s,o,l,c,f=j_.M,p=j_.C,y=j_.L,b=j_.R,S=j_.A,C=j_.Q;for(s=0,o=0;s<i;){switch(n=t[s++],o=s,a=0,n){case f:a=1;break;case y:a=1;break;case p:a=3;break;case C:a=2;break;case S:var E=e[4],P=e[5],O=nz(e[0]*e[0]+e[1]*e[1]),B=nz(e[2]*e[2]+e[3]*e[3]),F=lhe(-e[1]/B,e[0]/O);t[s]*=O,t[s++]+=E,t[s]*=B,t[s++]+=P,t[s++]*=O,t[s++]*=B,t[s++]+=F,t[s++]+=F,s+=2,o=s;break;case b:c[0]=t[s++],c[1]=t[s++],Ro(c,c,e),t[o++]=c[0],t[o++]=c[1],c[0]+=t[s++],c[1]+=t[s++],Ro(c,c,e),t[o++]=c[0],t[o++]=c[1]}for(l=0;l<a;l++){var W=she[l];W[0]=t[s++],W[1]=t[s++],Ro(W,W,e),t[o++]=W[0],t[o++]=W[1]}}r.increaseVersion()}}var JE=Math.sqrt,ET=Math.sin,IT=Math.cos,zx=Math.PI;function az(r){return Math.sqrt(r[0]*r[0]+r[1]*r[1])}function n3(r,e){return(r[0]*e[0]+r[1]*e[1])/(az(r)*az(e))}function oz(r,e){return(r[0]*e[1]<r[1]*e[0]?-1:1)*Math.acos(n3(r,e))}function sz(r,e,t,i,n,a,s,o,l,c,f){var p=l*(zx/180),y=IT(p)*(r-t)/2+ET(p)*(e-i)/2,b=-1*ET(p)*(r-t)/2+IT(p)*(e-i)/2,S=y*y/(s*s)+b*b/(o*o);S>1&&(s*=JE(S),o*=JE(S));var C=(n===a?-1:1)*JE((s*s*(o*o)-s*s*(b*b)-o*o*(y*y))/(s*s*(b*b)+o*o*(y*y)))||0,E=C*s*b/o,P=C*-o*y/s,O=(r+t)/2+IT(p)*E-ET(p)*P,B=(e+i)/2+ET(p)*E+IT(p)*P,F=oz([1,0],[(y-E)/s,(b-P)/o]),W=[(y-E)/s,(b-P)/o],$=[(-1*y-E)/s,(-1*b-P)/o],q=oz(W,$);if(n3(W,$)<=-1&&(q=zx),n3(W,$)>=1&&(q=0),q<0){var Q=Math.round(q/zx*1e6)/1e6;q=zx*2+Q%2*zx}f.addData(c,O,B,s,o,F,q,p,a)}var uhe=/([mlvhzcqtsa])([^mlvhzcqtsa]*)/ig,che=/-?([0-9]*\.)?[0-9]+([eE]-?[0-9]+)?/g;function hhe(r){var e=new jf;if(!r)return e;var t=0,i=0,n=t,a=i,s,o=jf.CMD,l=r.match(uhe);if(!l)return e;for(var c=0;c<l.length;c++){for(var f=l[c],p=f.charAt(0),y=void 0,b=f.match(che)||[],S=b.length,C=0;C<S;C++)b[C]=parseFloat(b[C]);for(var E=0;E<S;){var P=void 0,O=void 0,B=void 0,F=void 0,W=void 0,$=void 0,q=void 0,Q=t,ee=i,te=void 0,ae=void 0;switch(p){case"l":t+=b[E++],i+=b[E++],y=o.L,e.addData(y,t,i);break;case"L":t=b[E++],i=b[E++],y=o.L,e.addData(y,t,i);break;case"m":t+=b[E++],i+=b[E++],y=o.M,e.addData(y,t,i),n=t,a=i,p="l";break;case"M":t=b[E++],i=b[E++],y=o.M,e.addData(y,t,i),n=t,a=i,p="L";break;case"h":t+=b[E++],y=o.L,e.addData(y,t,i);break;case"H":t=b[E++],y=o.L,e.addData(y,t,i);break;case"v":i+=b[E++],y=o.L,e.addData(y,t,i);break;case"V":i=b[E++],y=o.L,e.addData(y,t,i);break;case"C":y=o.C,e.addData(y,b[E++],b[E++],b[E++],b[E++],b[E++],b[E++]),t=b[E-2],i=b[E-1];break;case"c":y=o.C,e.addData(y,b[E++]+t,b[E++]+i,b[E++]+t,b[E++]+i,b[E++]+t,b[E++]+i),t+=b[E-2],i+=b[E-1];break;case"S":P=t,O=i,te=e.len(),ae=e.data,s===o.C&&(P+=t-ae[te-4],O+=i-ae[te-3]),y=o.C,Q=b[E++],ee=b[E++],t=b[E++],i=b[E++],e.addData(y,P,O,Q,ee,t,i);break;case"s":P=t,O=i,te=e.len(),ae=e.data,s===o.C&&(P+=t-ae[te-4],O+=i-ae[te-3]),y=o.C,Q=t+b[E++],ee=i+b[E++],t+=b[E++],i+=b[E++],e.addData(y,P,O,Q,ee,t,i);break;case"Q":Q=b[E++],ee=b[E++],t=b[E++],i=b[E++],y=o.Q,e.addData(y,Q,ee,t,i);break;case"q":Q=b[E++]+t,ee=b[E++]+i,t+=b[E++],i+=b[E++],y=o.Q,e.addData(y,Q,ee,t,i);break;case"T":P=t,O=i,te=e.len(),ae=e.data,s===o.Q&&(P+=t-ae[te-4],O+=i-ae[te-3]),t=b[E++],i=b[E++],y=o.Q,e.addData(y,P,O,t,i);break;case"t":P=t,O=i,te=e.len(),ae=e.data,s===o.Q&&(P+=t-ae[te-4],O+=i-ae[te-3]),t+=b[E++],i+=b[E++],y=o.Q,e.addData(y,P,O,t,i);break;case"A":B=b[E++],F=b[E++],W=b[E++],$=b[E++],q=b[E++],Q=t,ee=i,t=b[E++],i=b[E++],y=o.A,sz(Q,ee,t,i,$,q,B,F,W,y,e);break;case"a":B=b[E++],F=b[E++],W=b[E++],$=b[E++],q=b[E++],Q=t,ee=i,t+=b[E++],i+=b[E++],y=o.A,sz(Q,ee,t,i,$,q,B,F,W,y,e);break}}(p==="z"||p==="Z")&&(y=o.Z,e.addData(y),t=n,i=a),s=y}return e.toStatic(),e}var r7=(function(r){Ye(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.applyTransform=function(t){},e})(Xr);function i7(r){return r.setData!=null}function n7(r,e){var t=hhe(r),i=mt({},e);return i.buildPath=function(n){if(i7(n)){n.setData(t.data);var a=n.getContext();a&&n.rebuildPath(a,1)}else{var a=n;t.rebuildPath(a,1)}},i.applyTransform=function(n){t7(t,n),this.dirtyShape()},i}function a7(r,e){return new r7(n7(r,e))}function fhe(r,e){var t=n7(r,e),i=(function(n){Ye(a,n);function a(s){var o=n.call(this,s)||this;return o.applyTransform=t.applyTransform,o.buildPath=t.buildPath,o}return a})(r7);return i}function dhe(r,e){for(var t=[],i=r.length,n=0;n<i;n++){var a=r[n];t.push(a.getUpdatedPathProxy(!0))}var s=new Xr(e);return s.createPathProxy(),s.buildPath=function(o){if(i7(o)){o.appendPath(t);var l=o.getContext();l&&o.rebuildPath(l,1)}},s}function zk(r,e){e=e||{};var t=new Xr;return r.shape&&t.setShape(r.shape),t.setStyle(r.style),e.bakeTransform?t7(t.path,r.getComputedTransform()):e.toLocal?t.setLocalTransform(r.getComputedTransform()):t.copyTransform(r),t.buildPath=r.buildPath,t.applyTransform=t.applyTransform,t.z=r.z,t.z2=r.z2,t.zlevel=r.zlevel,t}var phe=(function(){function r(){this.cx=0,this.cy=0,this.r=0}return r})(),$f=(function(r){Ye(e,r);function e(t){return r.call(this,t)||this}return e.prototype.getDefaultShape=function(){return new phe},e.prototype.buildPath=function(t,i){t.moveTo(i.cx+i.r,i.cy),t.arc(i.cx,i.cy,i.r,0,Math.PI*2)},e})(Xr);$f.prototype.type="circle";var ghe=(function(){function r(){this.cx=0,this.cy=0,this.rx=0,this.ry=0}return r})(),Zw=(function(r){Ye(e,r);function e(t){return r.call(this,t)||this}return e.prototype.getDefaultShape=function(){return new ghe},e.prototype.buildPath=function(t,i){var n=.5522848,a=i.cx,s=i.cy,o=i.rx,l=i.ry,c=o*n,f=l*n;t.moveTo(a-o,s),t.bezierCurveTo(a-o,s-f,a-c,s-l,a,s-l),t.bezierCurveTo(a+c,s-l,a+o,s-f,a+o,s),t.bezierCurveTo(a+o,s+f,a+c,s+l,a,s+l),t.bezierCurveTo(a-c,s+l,a-o,s+f,a-o,s),t.closePath()},e})(Xr);Zw.prototype.type="ellipse";var o7=Math.PI,eI=o7*2,vm=Math.sin,$_=Math.cos,vhe=Math.acos,xs=Math.atan2,lz=Math.abs,W1=Math.sqrt,m1=Math.max,Sf=Math.min,mh=1e-4;function mhe(r,e,t,i,n,a,s,o){var l=t-r,c=i-e,f=s-n,p=o-a,y=p*l-f*c;if(!(y*y<mh))return y=(f*(e-a)-p*(r-n))/y,[r+y*l,e+y*c]}function PT(r,e,t,i,n,a,s){var o=r-t,l=e-i,c=(s?a:-a)/W1(o*o+l*l),f=c*l,p=-c*o,y=r+f,b=e+p,S=t+f,C=i+p,E=(y+S)/2,P=(b+C)/2,O=S-y,B=C-b,F=O*O+B*B,W=n-a,$=y*C-S*b,q=(B<0?-1:1)*W1(m1(0,W*W*F-$*$)),Q=($*B-O*q)/F,ee=(-$*O-B*q)/F,te=($*B+O*q)/F,ae=(-$*O+B*q)/F,de=Q-E,ve=ee-P,ye=te-E,Ae=ae-P;return de*de+ve*ve>ye*ye+Ae*Ae&&(Q=te,ee=ae),{cx:Q,cy:ee,x0:-f,y0:-p,x1:Q*(n/W-1),y1:ee*(n/W-1)}}function yhe(r){var e;if(xt(r)){var t=r.length;if(!t)return r;t===1?e=[r[0],r[0],0,0]:t===2?e=[r[0],r[0],r[1],r[1]]:t===3?e=r.concat(r[2]):e=r}else e=[r,r,r,r];return e}function _he(r,e){var t,i=m1(e.r,0),n=m1(e.r0||0,0),a=i>0,s=n>0;if(!(!a&&!s)){if(a||(i=n,n=0),n>i){var o=i;i=n,n=o}var l=e.startAngle,c=e.endAngle;if(!(isNaN(l)||isNaN(c))){var f=e.cx,p=e.cy,y=!!e.clockwise,b=lz(c-l),S=b>eI&&b%eI;if(S>mh&&(b=S),!(i>mh))r.moveTo(f,p);else if(b>eI-mh)r.moveTo(f+i*$_(l),p+i*vm(l)),r.arc(f,p,i,l,c,!y),n>mh&&(r.moveTo(f+n*$_(c),p+n*vm(c)),r.arc(f,p,n,c,l,y));else{var C=void 0,E=void 0,P=void 0,O=void 0,B=void 0,F=void 0,W=void 0,$=void 0,q=void 0,Q=void 0,ee=void 0,te=void 0,ae=void 0,de=void 0,ve=void 0,ye=void 0,Ae=i*$_(l),me=i*vm(l),De=n*$_(c),Fe=n*vm(c),je=b>mh;if(je){var ct=e.cornerRadius;ct&&(t=yhe(ct),C=t[0],E=t[1],P=t[2],O=t[3]);var xe=lz(i-n)/2;if(B=Sf(xe,P),F=Sf(xe,O),W=Sf(xe,C),$=Sf(xe,E),ee=q=m1(B,F),te=Q=m1(W,$),(q>mh||Q>mh)&&(ae=i*$_(c),de=i*vm(c),ve=n*$_(l),ye=n*vm(l),b<o7)){var $e=mhe(Ae,me,ve,ye,ae,de,De,Fe);if($e){var pt=Ae-$e[0],_t=me-$e[1],Dt=ae-$e[0],qt=de-$e[1],_r=1/vm(vhe((pt*Dt+_t*qt)/(W1(pt*pt+_t*_t)*W1(Dt*Dt+qt*qt)))/2),Kt=W1($e[0]*$e[0]+$e[1]*$e[1]);ee=Sf(q,(i-Kt)/(_r+1)),te=Sf(Q,(n-Kt)/(_r-1))}}}if(!je)r.moveTo(f+Ae,p+me);else if(ee>mh){var zt=Sf(P,ee),yr=Sf(O,ee),Gt=PT(ve,ye,Ae,me,i,zt,y),Jt=PT(ae,de,De,Fe,i,yr,y);r.moveTo(f+Gt.cx+Gt.x0,p+Gt.cy+Gt.y0),ee<q&&zt===yr?r.arc(f+Gt.cx,p+Gt.cy,ee,xs(Gt.y0,Gt.x0),xs(Jt.y0,Jt.x0),!y):(zt>0&&r.arc(f+Gt.cx,p+Gt.cy,zt,xs(Gt.y0,Gt.x0),xs(Gt.y1,Gt.x1),!y),r.arc(f,p,i,xs(Gt.cy+Gt.y1,Gt.cx+Gt.x1),xs(Jt.cy+Jt.y1,Jt.cx+Jt.x1),!y),yr>0&&r.arc(f+Jt.cx,p+Jt.cy,yr,xs(Jt.y1,Jt.x1),xs(Jt.y0,Jt.x0),!y))}else r.moveTo(f+Ae,p+me),r.arc(f,p,i,l,c,!y);if(!(n>mh)||!je)r.lineTo(f+De,p+Fe);else if(te>mh){var zt=Sf(C,te),yr=Sf(E,te),Gt=PT(De,Fe,ae,de,n,-yr,y),Jt=PT(Ae,me,ve,ye,n,-zt,y);r.lineTo(f+Gt.cx+Gt.x0,p+Gt.cy+Gt.y0),te<Q&&zt===yr?r.arc(f+Gt.cx,p+Gt.cy,te,xs(Gt.y0,Gt.x0),xs(Jt.y0,Jt.x0),!y):(yr>0&&r.arc(f+Gt.cx,p+Gt.cy,yr,xs(Gt.y0,Gt.x0),xs(Gt.y1,Gt.x1),!y),r.arc(f,p,n,xs(Gt.cy+Gt.y1,Gt.cx+Gt.x1),xs(Jt.cy+Jt.y1,Jt.cx+Jt.x1),y),zt>0&&r.arc(f+Jt.cx,p+Jt.cy,zt,xs(Jt.y1,Jt.x1),xs(Jt.y0,Jt.x0),!y))}else r.lineTo(f+De,p+Fe),r.arc(f,p,n,c,l,y)}r.closePath()}}}var bhe=(function(){function r(){this.cx=0,this.cy=0,this.r0=0,this.r=0,this.startAngle=0,this.endAngle=Math.PI*2,this.clockwise=!0,this.cornerRadius=0}return r})(),Ps=(function(r){Ye(e,r);function e(t){return r.call(this,t)||this}return e.prototype.getDefaultShape=function(){return new bhe},e.prototype.buildPath=function(t,i){_he(t,i)},e.prototype.isZeroArea=function(){return this.shape.startAngle===this.shape.endAngle||this.shape.r===this.shape.r0},e})(Xr);Ps.prototype.type="sector";var xhe=(function(){function r(){this.cx=0,this.cy=0,this.r=0,this.r0=0}return r})(),sb=(function(r){Ye(e,r);function e(t){return r.call(this,t)||this}return e.prototype.getDefaultShape=function(){return new xhe},e.prototype.buildPath=function(t,i){var n=i.cx,a=i.cy,s=Math.PI*2;t.moveTo(n+i.r,a),t.arc(n,a,i.r,0,s,!1),t.moveTo(n+i.r0,a),t.arc(n,a,i.r0,0,s,!0)},e})(Xr);sb.prototype.type="ring";function whe(r,e,t,i){var n=[],a=[],s=[],o=[],l,c,f,p;if(i){f=[1/0,1/0],p=[-1/0,-1/0];for(var y=0,b=r.length;y<b;y++)rp(f,f,r[y]),ip(p,p,r[y]);rp(f,f,i[0]),ip(p,p,i[1])}for(var y=0,b=r.length;y<b;y++){var S=r[y];if(t)l=r[y?y-1:b-1],c=r[(y+1)%b];else if(y===0||y===b-1){n.push(Bf(r[y]));continue}else l=r[y-1],c=r[y+1];Ag(a,c,l),N1(a,a,e);var C=vA(S,l),E=vA(S,c),P=C+E;P!==0&&(C/=P,E/=P),N1(s,a,-C),N1(o,a,E);var O=ER([],S,s),B=ER([],S,o);i&&(ip(O,O,f),rp(O,O,p),ip(B,B,f),rp(B,B,p)),n.push(O),n.push(B)}return t&&n.push(n.shift()),n}function s7(r,e,t){var i=e.smooth,n=e.points;if(n&&n.length>=2){if(i){var a=whe(n,i,t,e.smoothConstraint);r.moveTo(n[0][0],n[0][1]);for(var s=n.length,o=0;o<(t?s:s-1);o++){var l=a[o*2],c=a[o*2+1],f=n[(o+1)%s];r.bezierCurveTo(l[0],l[1],c[0],c[1],f[0],f[1])}}else{r.moveTo(n[0][0],n[0][1]);for(var o=1,p=n.length;o<p;o++)r.lineTo(n[o][0],n[o][1])}t&&r.closePath()}}var She=(function(){function r(){this.points=null,this.smooth=0,this.smoothConstraint=null}return r})(),Rs=(function(r){Ye(e,r);function e(t){return r.call(this,t)||this}return e.prototype.getDefaultShape=function(){return new She},e.prototype.buildPath=function(t,i){s7(t,i,!0)},e})(Xr);Rs.prototype.type="polygon";var The=(function(){function r(){this.points=null,this.percent=1,this.smooth=0,this.smoothConstraint=null}return r})(),ks=(function(r){Ye(e,r);function e(t){return r.call(this,t)||this}return e.prototype.getDefaultStyle=function(){return{stroke:"#000",fill:null}},e.prototype.getDefaultShape=function(){return new The},e.prototype.buildPath=function(t,i){s7(t,i,!1)},e})(Xr);ks.prototype.type="polyline";var Ahe={},Che=(function(){function r(){this.x1=0,this.y1=0,this.x2=0,this.y2=0,this.percent=1}return r})(),qa=(function(r){Ye(e,r);function e(t){return r.call(this,t)||this}return e.prototype.getDefaultStyle=function(){return{stroke:"#000",fill:null}},e.prototype.getDefaultShape=function(){return new Che},e.prototype.buildPath=function(t,i){var n,a,s,o;if(this.subPixelOptimize){var l=H$(Ahe,i,this.style);n=l.x1,a=l.y1,s=l.x2,o=l.y2}else n=i.x1,a=i.y1,s=i.x2,o=i.y2;var c=i.percent;c!==0&&(t.moveTo(n,a),c<1&&(s=n*(1-c)+s*c,o=a*(1-c)+o*c),t.lineTo(s,o))},e.prototype.pointAt=function(t){var i=this.shape;return[i.x1*(1-t)+i.x2*t,i.y1*(1-t)+i.y2*t]},e})(Xr);qa.prototype.type="line";var El=[],Mhe=(function(){function r(){this.x1=0,this.y1=0,this.x2=0,this.y2=0,this.cpx1=0,this.cpy1=0,this.percent=1}return r})();function uz(r,e,t){var i=r.cpx2,n=r.cpy2;return i!=null||n!=null?[(t?v4:oo)(r.x1,r.cpx1,r.cpx2,r.x2,e),(t?v4:oo)(r.y1,r.cpy1,r.cpy2,r.y2,e)]:[(t?kR:Po)(r.x1,r.cpx1,r.x2,e),(t?kR:Po)(r.y1,r.cpy1,r.y2,e)]}var lb=(function(r){Ye(e,r);function e(t){return r.call(this,t)||this}return e.prototype.getDefaultStyle=function(){return{stroke:"#000",fill:null}},e.prototype.getDefaultShape=function(){return new Mhe},e.prototype.buildPath=function(t,i){var n=i.x1,a=i.y1,s=i.x2,o=i.y2,l=i.cpx1,c=i.cpy1,f=i.cpx2,p=i.cpy2,y=i.percent;y!==0&&(t.moveTo(n,a),f==null||p==null?(y<1&&(lw(n,l,s,y,El),l=El[1],s=El[2],lw(a,c,o,y,El),c=El[1],o=El[2]),t.quadraticCurveTo(l,c,s,o)):(y<1&&(Hg(n,l,f,s,y,El),l=El[1],f=El[2],s=El[3],Hg(a,c,p,o,y,El),c=El[1],p=El[2],o=El[3]),t.bezierCurveTo(l,c,f,p,s,o)))},e.prototype.pointAt=function(t){return uz(this.shape,t,!1)},e.prototype.tangentAt=function(t){var i=uz(this.shape,t,!0);return My(i,i)},e})(Xr);lb.prototype.type="bezier-curve";var Ehe=(function(){function r(){this.cx=0,this.cy=0,this.r=0,this.startAngle=0,this.endAngle=Math.PI*2,this.clockwise=!0}return r})(),qw=(function(r){Ye(e,r);function e(t){return r.call(this,t)||this}return e.prototype.getDefaultStyle=function(){return{stroke:"#000",fill:null}},e.prototype.getDefaultShape=function(){return new Ehe},e.prototype.buildPath=function(t,i){var n=i.cx,a=i.cy,s=Math.max(i.r,0),o=i.startAngle,l=i.endAngle,c=i.clockwise,f=Math.cos(o),p=Math.sin(o);t.moveTo(f*s+n,p*s+a),t.arc(n,a,s,o,l,!c)},e})(Xr);qw.prototype.type="arc";var FC=(function(r){Ye(e,r);function e(){var t=r!==null&&r.apply(this,arguments)||this;return t.type="compound",t}return e.prototype._updatePathDirty=function(){for(var t=this.shape.paths,i=this.shapeChanged(),n=0;n<t.length;n++)i=i||t[n].shapeChanged();i&&this.dirtyShape()},e.prototype.beforeBrush=function(){this._updatePathDirty();for(var t=this.shape.paths||[],i=this.getGlobalScale(),n=0;n<t.length;n++)t[n].path||t[n].createPathProxy(),t[n].path.setScale(i[0],i[1],t[n].segmentIgnoreThreshold)},e.prototype.buildPath=function(t,i){for(var n=i.paths||[],a=0;a<n.length;a++)n[a].buildPath(t,n[a].shape,!0)},e.prototype.afterBrush=function(){for(var t=this.shape.paths||[],i=0;i<t.length;i++)t[i].pathUpdated()},e.prototype.getBoundingRect=function(){return this._updatePathDirty.call(this),Xr.prototype.getBoundingRect.call(this)},e})(Xr),l7=(function(){function r(e){this.colorStops=e||[]}return r.prototype.addColorStop=function(e,t){this.colorStops.push({offset:e,color:t})},r})(),ub=(function(r){Ye(e,r);function e(t,i,n,a,s,o){var l=r.call(this,s)||this;return l.x=t??0,l.y=i??0,l.x2=n??1,l.y2=a??0,l.type="linear",l.global=o||!1,l}return e})(l7),Fk=(function(r){Ye(e,r);function e(t,i,n,a,s){var o=r.call(this,a)||this;return o.x=t??.5,o.y=i??.5,o.r=n??.5,o.type="radial",o.global=s||!1,o}return e})(l7),mm=[0,0],ym=[0,0],RT=new Rr,DT=new Rr,MA=(function(){function r(e,t){this._corners=[],this._axes=[],this._origin=[0,0];for(var i=0;i<4;i++)this._corners[i]=new Rr;for(var i=0;i<2;i++)this._axes[i]=new Rr;e&&this.fromBoundingRect(e,t)}return r.prototype.fromBoundingRect=function(e,t){var i=this._corners,n=this._axes,a=e.x,s=e.y,o=a+e.width,l=s+e.height;if(i[0].set(a,s),i[1].set(o,s),i[2].set(o,l),i[3].set(a,l),t)for(var c=0;c<4;c++)i[c].transform(t);Rr.sub(n[0],i[1],i[0]),Rr.sub(n[1],i[3],i[0]),n[0].normalize(),n[1].normalize();for(var c=0;c<2;c++)this._origin[c]=n[c].dot(i[0])},r.prototype.intersect=function(e,t){var i=!0,n=!t;return RT.set(1/0,1/0),DT.set(0,0),!this._intersectCheckOneSide(this,e,RT,DT,n,1)&&(i=!1,n)||!this._intersectCheckOneSide(e,this,RT,DT,n,-1)&&(i=!1,n)||n||Rr.copy(t,i?RT:DT),i},r.prototype._intersectCheckOneSide=function(e,t,i,n,a,s){for(var o=!0,l=0;l<2;l++){var c=this._axes[l];if(this._getProjMinMaxOnAxis(l,e._corners,mm),this._getProjMinMaxOnAxis(l,t._corners,ym),mm[1]<ym[0]||mm[0]>ym[1]){if(o=!1,a)return o;var f=Math.abs(ym[0]-mm[1]),p=Math.abs(mm[0]-ym[1]);Math.min(f,p)>n.len()&&(f<p?Rr.scale(n,c,-f*s):Rr.scale(n,c,p*s))}else if(i){var f=Math.abs(ym[0]-mm[1]),p=Math.abs(mm[0]-ym[1]);Math.min(f,p)<i.len()&&(f<p?Rr.scale(i,c,f*s):Rr.scale(i,c,-p*s))}}return o},r.prototype._getProjMinMaxOnAxis=function(e,t,i){for(var n=this._axes[e],a=this._origin,s=t[0].dot(n)+a[e],o=s,l=s,c=1;c<t.length;c++){var f=t[c].dot(n)+a[e];o=Math.min(f,o),l=Math.max(f,l)}i[0]=o,i[1]=l},r})(),Ihe=[],u7=(function(r){Ye(e,r);function e(){var t=r!==null&&r.apply(this,arguments)||this;return t.notClear=!0,t.incremental=!0,t._displayables=[],t._temporaryDisplayables=[],t._cursor=0,t}return e.prototype.traverse=function(t,i){t.call(i,this)},e.prototype.useStyle=function(){this.style={}},e.prototype.getCursor=function(){return this._cursor},e.prototype.innerAfterBrush=function(){this._cursor=this._displayables.length},e.prototype.clearDisplaybles=function(){this._displayables=[],this._temporaryDisplayables=[],this._cursor=0,this.markRedraw(),this.notClear=!1},e.prototype.clearTemporalDisplayables=function(){this._temporaryDisplayables=[]},e.prototype.addDisplayable=function(t,i){i?this._temporaryDisplayables.push(t):this._displayables.push(t),this.markRedraw()},e.prototype.addDisplayables=function(t,i){i=i||!1;for(var n=0;n<t.length;n++)this.addDisplayable(t[n],i)},e.prototype.getDisplayables=function(){return this._displayables},e.prototype.getTemporalDisplayables=function(){return this._temporaryDisplayables},e.prototype.eachPendingDisplayable=function(t){for(var i=this._cursor;i<this._displayables.length;i++)t&&t(this._displayables[i]);for(var i=0;i<this._temporaryDisplayables.length;i++)t&&t(this._temporaryDisplayables[i])},e.prototype.update=function(){this.updateTransform();for(var t=this._cursor;t<this._displayables.length;t++){var i=this._displayables[t];i.parent=this,i.update(),i.parent=null}for(var t=0;t<this._temporaryDisplayables.length;t++){var i=this._temporaryDisplayables[t];i.parent=this,i.update(),i.parent=null}},e.prototype.getBoundingRect=function(){if(!this._rect){for(var t=new Dr(1/0,1/0,-1/0,-1/0),i=0;i<this._displayables.length;i++){var n=this._displayables[i],a=n.getBoundingRect().clone();n.needLocalTransform()&&a.applyTransform(n.getLocalTransform(Ihe)),t.union(a)}this._rect=t}return this._rect},e.prototype.contain=function(t,i){var n=this.transformCoordToLocal(t,i),a=this.getBoundingRect();if(a.contain(n[0],n[1]))for(var s=0;s<this._displayables.length;s++){var o=this._displayables[s];if(o.contain(t,i))return!0}return!1},e})(Tc),c7=fi();function cb(r,e,t,i,n){var a;if(e&&e.ecModel){var s=e.ecModel.getUpdatePayload();a=s&&s.animation}var o=e&&e.isAnimationEnabled(),l=r==="update";if(o){var c=void 0,f=void 0,p=void 0;i?(c=wr(i.duration,200),f=wr(i.easing,"cubicOut"),p=0):(c=e.getShallow(l?"animationDurationUpdate":"animationDuration"),f=e.getShallow(l?"animationEasingUpdate":"animationEasing"),p=e.getShallow(l?"animationDelayUpdate":"animationDelay")),a&&(a.duration!=null&&(c=a.duration),a.easing!=null&&(f=a.easing),a.delay!=null&&(p=a.delay)),sr(p)&&(p=p(t,n)),sr(c)&&(c=c(t));var y={duration:c||0,delay:p,easing:f};return y}else return null}function Vk(r,e,t,i,n,a,s){var o=!1,l;sr(n)?(s=a,a=n,n=null):cr(n)&&(a=n.cb,s=n.during,o=n.isFrom,l=n.removeOpt,n=n.dataIndex);var c=r==="leave";c||e.stopAnimation("leave");var f=cb(r,i,n,c?l||{}:null,i&&i.getAnimationDelayParams?i.getAnimationDelayParams(e,n):null);if(f&&f.duration>0){var p=f.duration,y=f.delay,b=f.easing,S={duration:p,delay:y||0,easing:b,done:a,force:!!a||!!s,setToFinal:!c,scope:r,during:s};o?e.animateFrom(t,S):e.animateTo(t,S)}else e.stopAnimation(),!o&&e.attr(t),s&&s(1),a&&a()}function vi(r,e,t,i,n,a){Vk("update",r,e,t,i,n,a)}function An(r,e,t,i,n,a){Vk("enter",r,e,t,i,n,a)}function I0(r){if(!r.__zr)return!0;for(var e=0;e<r.animators.length;e++){var t=r.animators[e];if(t.scope==="leave")return!0}return!1}function jg(r,e,t,i,n,a){I0(r)||Vk("leave",r,e,t,i,n,a)}function cz(r,e,t,i){r.removeTextContent(),r.removeTextGuideLine(),jg(r,{style:{opacity:0}},e,t,i)}function vw(r,e,t){function i(){r.parent&&r.parent.remove(r)}r.isGroup?r.traverse(function(n){n.isGroup||cz(n,e,t,i)}):cz(r,e,t,i)}function Dh(r){c7(r).oldStyle=r.style}function Phe(r){return c7(r).oldStyle}var EA=Math.max,IA=Math.min,a3={};function h7(r){return Xr.extend(r)}var Rhe=fhe;function f7(r,e){return Rhe(r,e)}function Mc(r,e){a3[r]=e}function VC(r){if(a3.hasOwnProperty(r))return a3[r]}function Yw(r,e,t,i){var n=a7(r,e);return t&&(i==="center"&&(t=d7(t,n.getBoundingRect())),Hk(n,t)),n}function Uk(r,e,t){var i=new go({style:{image:r,x:e.x,y:e.y,width:e.width,height:e.height},onload:function(n){if(t==="center"){var a={width:n.width,height:n.height};i.setStyle(d7(e,a))}}});return i}function d7(r,e){var t=e.width/e.height,i=r.height*t,n;i<=r.width?n=r.height:(i=r.width,n=i/t);var a=r.x+r.width/2,s=r.y+r.height/2;return{x:a-i/2,y:s-n/2,width:i,height:n}}var vu=dhe;function Hk(r,e){if(r.applyTransform){var t=r.getBoundingRect(),i=t.calculateTransform(e);r.applyTransform(i)}}function X0(r,e){return H$(r,r,{lineWidth:e}),r}function Dhe(r){return j$(r.shape,r.shape,r.style),r}var B2=Hm;function Ng(r,e){for(var t=jw([]);r&&r!==e;)zf(t,r.getLocalTransform(),t),r=r.parent;return t}function Mh(r,e,t){return e&&!es(e)&&(e=np.getLocalTransform(e)),t&&(e=Ey([],e)),Ro([],r,e)}function UC(r,e,t){var i=e[4]===0||e[5]===0||e[0]===0?1:Math.abs(2*e[4]/e[0]),n=e[4]===0||e[5]===0||e[2]===0?1:Math.abs(2*e[4]/e[2]),a=[r==="left"?-i:r==="right"?i:0,r==="top"?-n:r==="bottom"?n:0];return a=Mh(a,e,t),Math.abs(a[0])>Math.abs(a[1])?a[0]>0?"right":"left":a[1]>0?"bottom":"top"}function hz(r){return!r.isGroup}function khe(r){return r.shape!=null}function Kw(r,e,t){if(!r||!e)return;function i(s){var o={};return s.traverse(function(l){hz(l)&&l.anid&&(o[l.anid]=l)}),o}function n(s){var o={x:s.x,y:s.y,rotation:s.rotation};return khe(s)&&(o.shape=mt({},s.shape)),o}var a=i(r);e.traverse(function(s){if(hz(s)&&s.anid){var o=a[s.anid];if(o){var l=n(s);s.attr(n(o)),vi(s,l,t,br(s).dataIndex)}}})}function jk(r,e){return wt(r,function(t){var i=t[0];i=EA(i,e.x),i=IA(i,e.x+e.width);var n=t[1];return n=EA(n,e.y),n=IA(n,e.y+e.height),[i,n]})}function p7(r,e){var t=EA(r.x,e.x),i=IA(r.x+r.width,e.x+e.width),n=EA(r.y,e.y),a=IA(r.y+r.height,e.y+e.height);if(i>=t&&a>=n)return{x:t,y:n,width:i-t,height:a-n}}function hb(r,e,t){var i=mt({rectHover:!0},e),n=i.style={strokeNoScale:!0};if(t=t||{x:-1,y:-1,width:2,height:2},r)return r.indexOf("image://")===0?(n.image=r.slice(8),lr(n,t),new go(i)):Yw(r.replace("path://",""),i,t,"center")}function y1(r,e,t,i,n){for(var a=0,s=n[n.length-1];a<n.length;a++){var o=n[a];if(g7(r,e,t,i,o[0],o[1],s[0],s[1]))return!0;s=o}}function g7(r,e,t,i,n,a,s,o){var l=t-r,c=i-e,f=s-n,p=o-a,y=tI(f,p,l,c);if(Lhe(y))return!1;var b=r-n,S=e-a,C=tI(b,S,l,c)/y;if(C<0||C>1)return!1;var E=tI(b,S,f,p)/y;return!(E<0||E>1)}function tI(r,e,t,i){return r*i-t*e}function Lhe(r){return r<=1e-6&&r>=-1e-6}function Iy(r){var e=r.itemTooltipOption,t=r.componentModel,i=r.itemName,n=$t(e)?{formatter:e}:e,a=t.mainType,s=t.componentIndex,o={componentType:a,name:i,$vars:["name"]};o[a+"Index"]=s;var l=r.formatterParamsExtra;l&&se(qr(l),function(f){Yt(o,f)||(o[f]=l[f],o.$vars.push(f))});var c=br(r.el);c.componentMainType=a,c.componentIndex=s,c.tooltipConfig={name:i,option:lr({content:i,encodeHTMLContent:!0,formatterParams:o},n)}}function fz(r,e){var t;r.isGroup&&(t=e(r)),t||r.traverse(e)}function qg(r,e){if(r)if(xt(r))for(var t=0;t<r.length;t++)fz(r[t],e);else fz(r,e)}Mc("circle",$f);Mc("ellipse",Zw);Mc("sector",Ps);Mc("ring",sb);Mc("polygon",Rs);Mc("polyline",ks);Mc("rect",li);Mc("line",qa);Mc("bezierCurve",lb);Mc("arc",qw);const Py=Object.freeze(Object.defineProperty({__proto__:null,Arc:qw,BezierCurve:lb,BoundingRect:Dr,Circle:$f,CompoundPath:FC,Ellipse:Zw,Group:mr,Image:go,IncrementalDisplayable:u7,Line:qa,LinearGradient:ub,OrientedBoundingRect:MA,Path:Xr,Point:Rr,Polygon:Rs,Polyline:ks,RadialGradient:Fk,Rect:li,Ring:sb,Sector:Ps,Text:si,applyTransform:Mh,clipPointsByRect:jk,clipRectByRect:p7,createIcon:hb,extendPath:f7,extendShape:h7,getShapeClass:VC,getTransform:Ng,groupTransition:Kw,initProps:An,isElementRemoved:I0,lineLineIntersect:g7,linePolygonIntersect:y1,makeImage:Uk,makePath:Yw,mergePath:vu,registerShape:Mc,removeElement:jg,removeElementWithFadeOut:vw,resizePath:Hk,setTooltipConfig:Iy,subPixelOptimize:B2,subPixelOptimizeLine:X0,subPixelOptimizeRect:Dhe,transformDirection:UC,traverseElements:qg,updateProps:vi},Symbol.toStringTag,{value:"Module"}));var HC={};function v7(r,e){for(var t=0;t<ll.length;t++){var i=ll[t],n=e[i],a=r.ensureState(i);a.style=a.style||{},a.style.text=n}var s=r.currentStates.slice();r.clearStates(!0),r.setStyle({text:e.normal}),r.useStates(s,!0)}function o3(r,e,t){var i=r.labelFetcher,n=r.labelDataIndex,a=r.labelDimIndex,s=e.normal,o;i&&(o=i.getFormattedLabel(n,"normal",null,a,s&&s.get("formatter"),t!=null?{interpolatedValue:t}:null)),o==null&&(o=sr(r.defaultText)?r.defaultText(n,r,t):r.defaultText);for(var l={normal:o},c=0;c<ll.length;c++){var f=ll[c],p=e[f];l[f]=wr(i?i.getFormattedLabel(n,f,null,a,p&&p.get("formatter")):null,o)}return l}function rs(r,e,t,i){t=t||HC;for(var n=r instanceof si,a=!1,s=0;s<pw.length;s++){var o=e[pw[s]];if(o&&o.getShallow("show")){a=!0;break}}var l=n?r:r.getTextContent();if(a){n||(l||(l=new si,r.setTextContent(l)),r.stateProxy&&(l.stateProxy=r.stateProxy));var c=o3(t,e),f=e.normal,p=!!f.getShallow("show"),y=cn(f,i&&i.normal,t,!1,!n);y.text=c.normal,n||r.setTextConfig(PA(f,t,!1));for(var s=0;s<ll.length;s++){var b=ll[s],o=e[b];if(o){var S=l.ensureState(b),C=!!wr(o.getShallow("show"),p);if(C!==p&&(S.ignore=!C),S.style=cn(o,i&&i[b],t,!0,!n),S.style.text=c[b],!n){var E=r.ensureState(b);E.textConfig=PA(o,t,!0)}}}l.silent=!!f.getShallow("silent"),l.style.x!=null&&(y.x=l.style.x),l.style.y!=null&&(y.y=l.style.y),l.ignore=!p,l.useStyle(y),l.dirty(),t.enableTextSetter&&(fb(l).setLabelText=function(P){var O=o3(t,e,P);v7(l,O)})}else l&&(l.ignore=!0);r.dirty()}function fo(r,e){e=e||"label";for(var t={normal:r.getModel(e)},i=0;i<ll.length;i++){var n=ll[i];t[n]=r.getModel([n,e])}return t}function cn(r,e,t,i,n){var a={};return Ohe(a,r,t,i,n),e&&mt(a,e),a}function PA(r,e,t){e=e||{};var i={},n,a=r.getShallow("rotate"),s=wr(r.getShallow("distance"),t?null:5),o=r.getShallow("offset");return n=r.getShallow("position")||(t?null:"inside"),n==="outside"&&(n=e.defaultOutsidePosition||"top"),n!=null&&(i.position=n),o!=null&&(i.offset=o),a!=null&&(a*=Math.PI/180,i.rotation=a),s!=null&&(i.distance=s),i.outsideFill=r.get("color")==="inherit"?e.inheritColor||null:"auto",i}function Ohe(r,e,t,i,n){t=t||HC;var a=e.ecModel,s=a&&a.option.textStyle,o=Nhe(e),l;if(o){l={};for(var c in o)if(o.hasOwnProperty(c)){var f=e.getModel(["rich",c]);vz(l[c]={},f,s,t,i,n,!1,!0)}}l&&(r.rich=l);var p=e.get("overflow");p&&(r.overflow=p);var y=e.get("minMargin");y!=null&&(r.margin=y),vz(r,e,s,t,i,n,!0,!1)}function Nhe(r){for(var e;r&&r!==r.ecModel;){var t=(r.option||HC).rich;if(t){e=e||{};for(var i=qr(t),n=0;n<i.length;n++){var a=i[n];e[a]=1}}r=r.parentModel}return e}var dz=["fontStyle","fontWeight","fontSize","fontFamily","textShadowColor","textShadowBlur","textShadowOffsetX","textShadowOffsetY"],pz=["align","lineHeight","width","height","tag","verticalAlign","ellipsis"],gz=["padding","borderWidth","borderRadius","borderDashOffset","backgroundColor","borderColor","shadowColor","shadowBlur","shadowOffsetX","shadowOffsetY"];function vz(r,e,t,i,n,a,s,o){t=!n&&t||HC;var l=i&&i.inheritColor,c=e.getShallow("color"),f=e.getShallow("textBorderColor"),p=wr(e.getShallow("opacity"),t.opacity);(c==="inherit"||c==="auto")&&(l?c=l:c=null),(f==="inherit"||f==="auto")&&(l?f=l:f=null),a||(c=c||t.color,f=f||t.textBorderColor),c!=null&&(r.fill=c),f!=null&&(r.stroke=f);var y=wr(e.getShallow("textBorderWidth"),t.textBorderWidth);y!=null&&(r.lineWidth=y);var b=wr(e.getShallow("textBorderType"),t.textBorderType);b!=null&&(r.lineDash=b);var S=wr(e.getShallow("textBorderDashOffset"),t.textBorderDashOffset);S!=null&&(r.lineDashOffset=S),!n&&p==null&&!o&&(p=i&&i.defaultOpacity),p!=null&&(r.opacity=p),!n&&!a&&r.fill==null&&i.inheritColor&&(r.fill=i.inheritColor);for(var C=0;C<dz.length;C++){var E=dz[C],P=wr(e.getShallow(E),t[E]);P!=null&&(r[E]=P)}for(var C=0;C<pz.length;C++){var E=pz[C],P=e.getShallow(E);P!=null&&(r[E]=P)}if(r.verticalAlign==null){var O=e.getShallow("baseline");O!=null&&(r.verticalAlign=O)}if(!s||!i.disableBox){for(var C=0;C<gz.length;C++){var E=gz[C],P=e.getShallow(E);P!=null&&(r[E]=P)}var B=e.getShallow("borderType");B!=null&&(r.borderDash=B),(r.backgroundColor==="auto"||r.backgroundColor==="inherit")&&l&&(r.backgroundColor=l),(r.borderColor==="auto"||r.borderColor==="inherit")&&l&&(r.borderColor=l)}}function $k(r,e){var t=e&&e.getModel("textStyle");return mc([r.fontStyle||t&&t.getShallow("fontStyle")||"",r.fontWeight||t&&t.getShallow("fontWeight")||"",(r.fontSize||t&&t.getShallow("fontSize")||12)+"px",r.fontFamily||t&&t.getShallow("fontFamily")||"sans-serif"].join(" "))}var fb=fi();function m7(r,e,t,i){if(r){var n=fb(r);n.prevValue=n.value,n.value=t;var a=e.normal;n.valueAnimation=a.get("valueAnimation"),n.valueAnimation&&(n.precision=a.get("precision"),n.defaultInterpolatedText=i,n.statesModels=e)}}function y7(r,e,t,i,n){var a=fb(r);if(!a.valueAnimation||a.prevValue===a.value)return;var s=a.defaultInterpolatedText,o=wr(a.interpolatedValue,a.prevValue),l=a.value;function c(f){var p=k$(t,a.precision,o,l,f);a.interpolatedValue=f===1?null:p;var y=o3({labelDataIndex:e,labelFetcher:n,defaultText:s?s(p):p+""},a.statesModels,p);v7(r,y)}r.percent=0,(a.prevValue==null?An:vi)(r,{percent:1},i,e,null,c)}var Bhe=["textStyle","color"],rI=["fontStyle","fontWeight","fontSize","fontFamily","padding","lineHeight","rich","width","height","overflow"],iI=new si,zhe=(function(){function r(){}return r.prototype.getTextColor=function(e){var t=this.ecModel;return this.getShallow("color")||(!e&&t?t.get(Bhe):null)},r.prototype.getFont=function(){return $k({fontStyle:this.getShallow("fontStyle"),fontWeight:this.getShallow("fontWeight"),fontSize:this.getShallow("fontSize"),fontFamily:this.getShallow("fontFamily")},this.ecModel)},r.prototype.getTextRect=function(e){for(var t={text:e,verticalAlign:this.getShallow("verticalAlign")||this.getShallow("baseline")},i=0;i<rI.length;i++)t[rI[i]]=this.getShallow(rI[i]);return iI.useStyle(t),iI.update(),iI.getBoundingRect()},r})(),_7=[["lineWidth","width"],["stroke","color"],["opacity"],["shadowBlur"],["shadowOffsetX"],["shadowOffsetY"],["shadowColor"],["lineDash","type"],["lineDashOffset","dashOffset"],["lineCap","cap"],["lineJoin","join"],["miterLimit"]],Fhe=yy(_7),Vhe=(function(){function r(){}return r.prototype.getLineStyle=function(e){return Fhe(this,e)},r})(),b7=[["fill","color"],["stroke","borderColor"],["lineWidth","borderWidth"],["opacity"],["shadowBlur"],["shadowOffsetX"],["shadowOffsetY"],["shadowColor"],["lineDash","borderType"],["lineDashOffset","borderDashOffset"],["lineCap","borderCap"],["lineJoin","borderJoin"],["miterLimit","borderMiterLimit"]],Uhe=yy(b7),Hhe=(function(){function r(){}return r.prototype.getItemStyle=function(e,t){return Uhe(this,e,t)},r})(),Si=(function(){function r(e,t,i){this.parentModel=t,this.ecModel=i,this.option=e}return r.prototype.init=function(e,t,i){},r.prototype.mergeOption=function(e,t){Cr(this.option,e,!0)},r.prototype.get=function(e,t){return e==null?this.option:this._doGet(this.parsePath(e),!t&&this.parentModel)},r.prototype.getShallow=function(e,t){var i=this.option,n=i==null?i:i[e];if(n==null&&!t){var a=this.parentModel;a&&(n=a.getShallow(e))}return n},r.prototype.getModel=function(e,t){var i=e!=null,n=i?this.parsePath(e):null,a=i?this._doGet(n):this.option;return t=t||this.parentModel&&this.parentModel.getModel(this.resolveParentPath(n)),new r(a,t,this.ecModel)},r.prototype.isEmpty=function(){return this.option==null},r.prototype.restoreData=function(){},r.prototype.clone=function(){var e=this.constructor;return new e(hr(this.option))},r.prototype.parsePath=function(e){return typeof e=="string"?e.split("."):e},r.prototype.resolveParentPath=function(e){return e},r.prototype.isAnimationEnabled=function(){if(!Gr.node&&this.option){if(this.option.animation!=null)return!!this.option.animation;if(this.parentModel)return this.parentModel.isAnimationEnabled()}},r.prototype._doGet=function(e,t){var i=this.option;if(!e)return i;for(var n=0;n<e.length&&!(e[n]&&(i=i&&typeof i=="object"?i[e[n]]:null,i==null));n++);return i==null&&t&&(i=t._doGet(this.resolveParentPath(e),t.parentModel)),i},r})();Pk(Si);tce(Si);ha(Si,Vhe);ha(Si,Hhe);ha(Si,oce);ha(Si,zhe);var jhe=Math.round(Math.random()*10);function db(r){return[r||"",jhe++].join("_")}function $he(r){var e={};r.registerSubTypeDefaulter=function(t,i){var n=Lf(t);e[n.main]=i},r.determineSubType=function(t,i){var n=i.type;if(!n){var a=Lf(t).main;r.hasSubTypes(t)&&e[a]&&(n=e[a](i))}return n}}function Whe(r,e){r.topologicalTravel=function(a,s,o,l){if(!a.length)return;var c=t(s),f=c.graph,p=c.noEntryList,y={};for(se(a,function(O){y[O]=!0});p.length;){var b=p.pop(),S=f[b],C=!!y[b];C&&(o.call(l,b,S.originalDeps.slice()),delete y[b]),se(S.successor,C?P:E)}se(y,function(){var O="";throw new Error(O)});function E(O){f[O].entryCount--,f[O].entryCount===0&&p.push(O)}function P(O){y[O]=!0,E(O)}};function t(a){var s={},o=[];return se(a,function(l){var c=i(s,l),f=c.originalDeps=e(l),p=n(f,a);c.entryCount=p.length,c.entryCount===0&&o.push(l),se(p,function(y){Or(c.predecessor,y)<0&&c.predecessor.push(y);var b=i(s,y);Or(b.successor,y)<0&&b.successor.push(l)})}),{graph:s,noEntryList:o}}function i(a,s){return a[s]||(a[s]={predecessor:[],successor:[]}),a[s]}function n(a,s){var o=[];return se(a,function(l){Or(s,l)>=0&&o.push(l)}),o}}function Yg(r,e){return Cr(Cr({},r,!0),e,!0)}const Ghe={time:{month:["January","February","March","April","May","June","July","August","September","October","November","December"],monthAbbr:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],dayOfWeek:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],dayOfWeekAbbr:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"]},legend:{selector:{all:"All",inverse:"Inv"}},toolbox:{brush:{title:{rect:"Box Select",polygon:"Lasso Select",lineX:"Horizontally Select",lineY:"Vertically Select",keep:"Keep Selections",clear:"Clear Selections"}},dataView:{title:"Data View",lang:["Data View","Close","Refresh"]},dataZoom:{title:{zoom:"Zoom",back:"Zoom Reset"}},magicType:{title:{line:"Switch to Line Chart",bar:"Switch to Bar Chart",stack:"Stack",tiled:"Tile"}},restore:{title:"Restore"},saveAsImage:{title:"Save as Image",lang:["Right Click to Save Image"]}},series:{typeNames:{pie:"Pie chart",bar:"Bar chart",line:"Line chart",scatter:"Scatter plot",effectScatter:"Ripple scatter plot",radar:"Radar chart",tree:"Tree",treemap:"Treemap",boxplot:"Boxplot",candlestick:"Candlestick",k:"K line chart",heatmap:"Heat map",map:"Map",parallel:"Parallel coordinate map",lines:"Line graph",graph:"Relationship graph",sankey:"Sankey diagram",funnel:"Funnel chart",gauge:"Gauge",pictorialBar:"Pictorial bar",themeRiver:"Theme River Map",sunburst:"Sunburst",custom:"Custom chart",chart:"Chart"}},aria:{general:{withTitle:'This is a chart about "{title}"',withoutTitle:"This is a chart"},series:{single:{prefix:"",withName:" with type {seriesType} named {seriesName}.",withoutName:" with type {seriesType}."},multiple:{prefix:". It consists of {seriesCount} series count.",withName:" The {seriesId} series is a {seriesType} representing {seriesName}.",withoutName:" The {seriesId} series is a {seriesType}.",separator:{middle:"",end:""}}},data:{allData:"The data is as follows: ",partialData:"The first {displayCnt} items are: ",withName:"the data for {name} is {value}",withoutName:"{value}",separator:{middle:", ",end:". "}}}},Xhe={time:{month:["一月","二月","三月","四月","五月","六月","七月","八月","九月","十月","十一月","十二月"],monthAbbr:["1月","2月","3月","4月","5月","6月","7月","8月","9月","10月","11月","12月"],dayOfWeek:["星期日","星期一","星期二","星期三","星期四","星期五","星期六"],dayOfWeekAbbr:["日","一","二","三","四","五","六"]},legend:{selector:{all:"全选",inverse:"反选"}},toolbox:{brush:{title:{rect:"矩形选择",polygon:"圈选",lineX:"横向选择",lineY:"纵向选择",keep:"保持选择",clear:"清除选择"}},dataView:{title:"数据视图",lang:["数据视图","关闭","刷新"]},dataZoom:{title:{zoom:"区域缩放",back:"区域缩放还原"}},magicType:{title:{line:"切换为折线图",bar:"切换为柱状图",stack:"切换为堆叠",tiled:"切换为平铺"}},restore:{title:"还原"},saveAsImage:{title:"保存为图片",lang:["右键另存为图片"]}},series:{typeNames:{pie:"饼图",bar:"柱状图",line:"折线图",scatter:"散点图",effectScatter:"涟漪散点图",radar:"雷达图",tree:"树图",treemap:"矩形树图",boxplot:"箱型图",candlestick:"K线图",k:"K线图",heatmap:"热力图",map:"地图",parallel:"平行坐标图",lines:"线图",graph:"关系图",sankey:"桑基图",funnel:"漏斗图",gauge:"仪表盘图",pictorialBar:"象形柱图",themeRiver:"主题河流图",sunburst:"旭日图",custom:"自定义图表",chart:"图表"}},aria:{general:{withTitle:"这是一个关于“{title}”的图表。",withoutTitle:"这是一个图表，"},series:{single:{prefix:"",withName:"图表类型是{seriesType}，表示{seriesName}。",withoutName:"图表类型是{seriesType}。"},multiple:{prefix:"它由{seriesCount}个图表系列组成。",withName:"第{seriesId}个系列是一个表示{seriesName}的{seriesType}，",withoutName:"第{seriesId}个系列是一个{seriesType}，",separator:{middle:"；",end:"。"}}},data:{allData:"其数据是——",partialData:"其中，前{displayCnt}项是——",withName:"{name}的数据是{value}",withoutName:"{value}",separator:{middle:"，",end:""}}}};var RA="ZH",Wk="EN",P0=Wk,z2={},Gk={},x7=Gr.domSupported?(function(){var r=(document.documentElement.lang||navigator.language||navigator.browserLanguage||P0).toUpperCase();return r.indexOf(RA)>-1?RA:P0})():P0;function Xk(r,e){r=r.toUpperCase(),Gk[r]=new Si(e),z2[r]=e}function Zhe(r){if($t(r)){var e=z2[r.toUpperCase()]||{};return r===RA||r===Wk?hr(e):Cr(hr(e),hr(z2[P0]),!1)}else return Cr(hr(r),hr(z2[P0]),!1)}function s3(r){return Gk[r]}function qhe(){return Gk[P0]}Xk(Wk,Ghe);Xk(RA,Xhe);var Zk=1e3,qk=Zk*60,G1=qk*60,gc=G1*24,mz=gc*365,_1={year:"{yyyy}",month:"{MMM}",day:"{d}",hour:"{HH}:{mm}",minute:"{HH}:{mm}",second:"{HH}:{mm}:{ss}",millisecond:"{HH}:{mm}:{ss} {SSS}",none:"{yyyy}-{MM}-{dd} {HH}:{mm}:{ss} {SSS}"},kT="{yyyy}-{MM}-{dd}",yz={year:"{yyyy}",month:"{yyyy}-{MM}",day:kT,hour:kT+" "+_1.hour,minute:kT+" "+_1.minute,second:kT+" "+_1.second,millisecond:_1.none},nI=["year","month","day","hour","minute","second","millisecond"],w7=["year","half-year","quarter","month","week","half-week","day","half-day","quarter-day","hour","minute","second","millisecond"];function rl(r,e){return r+="","0000".substr(0,e-r.length)+r}function R0(r){switch(r){case"half-year":case"quarter":return"month";case"week":case"half-week":return"day";case"half-day":case"quarter-day":return"hour";default:return r}}function Yhe(r){return r===R0(r)}function Khe(r){switch(r){case"year":case"month":return"day";case"millisecond":return"millisecond";default:return"second"}}function Qw(r,e,t,i){var n=xu(r),a=n[Yk(t)](),s=n[D0(t)]()+1,o=Math.floor((s-1)/3)+1,l=n[jC(t)](),c=n["get"+(t?"UTC":"")+"Day"](),f=n[mw(t)](),p=(f-1)%12+1,y=n[$C(t)](),b=n[WC(t)](),S=n[GC(t)](),C=f>=12?"pm":"am",E=C.toUpperCase(),P=i instanceof Si?i:s3(i||x7)||qhe(),O=P.getModel("time"),B=O.get("month"),F=O.get("monthAbbr"),W=O.get("dayOfWeek"),$=O.get("dayOfWeekAbbr");return(e||"").replace(/{a}/g,C+"").replace(/{A}/g,E+"").replace(/{yyyy}/g,a+"").replace(/{yy}/g,rl(a%100+"",2)).replace(/{Q}/g,o+"").replace(/{MMMM}/g,B[s-1]).replace(/{MMM}/g,F[s-1]).replace(/{MM}/g,rl(s,2)).replace(/{M}/g,s+"").replace(/{dd}/g,rl(l,2)).replace(/{d}/g,l+"").replace(/{eeee}/g,W[c]).replace(/{ee}/g,$[c]).replace(/{e}/g,c+"").replace(/{HH}/g,rl(f,2)).replace(/{H}/g,f+"").replace(/{hh}/g,rl(p+"",2)).replace(/{h}/g,p+"").replace(/{mm}/g,rl(y,2)).replace(/{m}/g,y+"").replace(/{ss}/g,rl(b,2)).replace(/{s}/g,b+"").replace(/{SSS}/g,rl(S,3)).replace(/{S}/g,S+"")}function Qhe(r,e,t,i,n){var a=null;if($t(t))a=t;else if(sr(t))a=t(r.value,e,{level:r.level});else{var s=mt({},_1);if(r.level>0)for(var o=0;o<nI.length;++o)s[nI[o]]="{primary|"+s[nI[o]]+"}";var l=t?t.inherit===!1?t:lr(t,s):s,c=S7(r.value,n);if(l[c])a=l[c];else if(l.inherit){for(var f=w7.indexOf(c),o=f-1;o>=0;--o)if(l[c]){a=l[c];break}a=a||s.none}if(xt(a)){var p=r.level==null?0:r.level>=0?r.level:a.length+r.level;p=Math.min(p,a.length-1),a=a[p]}}return Qw(new Date(r.value),a,n,i)}function S7(r,e){var t=xu(r),i=t[D0(e)]()+1,n=t[jC(e)](),a=t[mw(e)](),s=t[$C(e)](),o=t[WC(e)](),l=t[GC(e)](),c=l===0,f=c&&o===0,p=f&&s===0,y=p&&a===0,b=y&&n===1,S=b&&i===1;return S?"year":b?"month":y?"day":p?"hour":f?"minute":c?"second":"millisecond"}function _z(r,e,t){var i=di(r)?xu(r):r;switch(e=e||S7(r,t),e){case"year":return i[Yk(t)]();case"half-year":return i[D0(t)]()>=6?1:0;case"quarter":return Math.floor((i[D0(t)]()+1)/4);case"month":return i[D0(t)]();case"day":return i[jC(t)]();case"half-day":return i[mw(t)]()/24;case"hour":return i[mw(t)]();case"minute":return i[$C(t)]();case"second":return i[WC(t)]();case"millisecond":return i[GC(t)]()}}function Yk(r){return r?"getUTCFullYear":"getFullYear"}function D0(r){return r?"getUTCMonth":"getMonth"}function jC(r){return r?"getUTCDate":"getDate"}function mw(r){return r?"getUTCHours":"getHours"}function $C(r){return r?"getUTCMinutes":"getMinutes"}function WC(r){return r?"getUTCSeconds":"getSeconds"}function GC(r){return r?"getUTCMilliseconds":"getMilliseconds"}function Jhe(r){return r?"setUTCFullYear":"setFullYear"}function T7(r){return r?"setUTCMonth":"setMonth"}function A7(r){return r?"setUTCDate":"setDate"}function C7(r){return r?"setUTCHours":"setHours"}function M7(r){return r?"setUTCMinutes":"setMinutes"}function E7(r){return r?"setUTCSeconds":"setSeconds"}function I7(r){return r?"setUTCMilliseconds":"setMilliseconds"}function efe(r,e,t,i,n,a,s,o){var l=new si({style:{text:r,font:e,align:t,verticalAlign:i,padding:n,rich:a,overflow:s?"truncate":null,lineHeight:o}});return l.getBoundingRect()}function Kk(r){if(!Mk(r))return $t(r)?r:"-";var e=(r+"").split(".");return e[0].replace(/(\d{1,3})(?=(?:\d{3})+(?!\d))/g,"$1,")+(e.length>1?"."+e[1]:"")}function Qk(r,e){return r=(r||"").toLowerCase().replace(/-(.)/g,function(t,i){return i.toUpperCase()}),e&&r&&(r=r.charAt(0).toUpperCase()+r.slice(1)),r}var Ry=CC;function l3(r,e,t){var i="{yyyy}-{MM}-{dd} {HH}:{mm}:{ss}";function n(f){return f&&mc(f)?f:"-"}function a(f){return!!(f!=null&&!isNaN(f)&&isFinite(f))}var s=e==="time",o=r instanceof Date;if(s||o){var l=s?xu(r):r;if(isNaN(+l)){if(o)return"-"}else return Qw(l,i,t)}if(e==="ordinal")return pA(r)?n(r):di(r)&&a(r)?r+"":"-";var c=Hf(r);return a(c)?Kk(c):pA(r)?n(r):typeof r=="boolean"?r+"":"-"}var bz=["a","b","c","d","e","f","g"],aI=function(r,e){return"{"+r+(e??"")+"}"};function Jk(r,e,t){xt(e)||(e=[e]);var i=e.length;if(!i)return"";for(var n=e[0].$vars||[],a=0;a<n.length;a++){var s=bz[a];r=r.replace(aI(s),aI(s,0))}for(var o=0;o<i;o++)for(var l=0;l<n.length;l++){var c=e[o][n[l]];r=r.replace(aI(bz[l],o),t?Ms(c):c)}return r}function tfe(r,e,t){return se(e,function(i,n){r=r.replace("{"+n+"}",i)}),r}function P7(r,e){var t=$t(r)?{color:r,extraCssText:e}:r||{},i=t.color,n=t.type;e=t.extraCssText;var a=t.renderMode||"html";if(!i)return"";if(a==="html")return n==="subItem"?'<span style="display:inline-block;vertical-align:middle;margin-right:8px;margin-left:3px;border-radius:4px;width:4px;height:4px;background-color:'+Ms(i)+";"+(e||"")+'"></span>':'<span style="display:inline-block;margin-right:4px;border-radius:10px;width:10px;height:10px;background-color:'+Ms(i)+";"+(e||"")+'"></span>';var s=t.markerId||"markerX";return{renderMode:a,content:"{"+s+"|}  ",style:n==="subItem"?{width:4,height:4,borderRadius:2,backgroundColor:i}:{width:10,height:10,borderRadius:5,backgroundColor:i}}}function rfe(r,e,t){(r==="week"||r==="month"||r==="quarter"||r==="half-year"||r==="year")&&(r=`MM-dd
yyyy`);var i=xu(e),n=t?"getUTC":"get",a=i[n+"FullYear"](),s=i[n+"Month"]()+1,o=i[n+"Date"](),l=i[n+"Hours"](),c=i[n+"Minutes"](),f=i[n+"Seconds"](),p=i[n+"Milliseconds"]();return r=r.replace("MM",rl(s,2)).replace("M",s).replace("yyyy",a).replace("yy",rl(a%100+"",2)).replace("dd",rl(o,2)).replace("d",o).replace("hh",rl(l,2)).replace("h",l).replace("mm",rl(c,2)).replace("m",c).replace("ss",rl(f,2)).replace("s",f).replace("SSS",rl(p,3)),r}function ife(r){return r&&r.charAt(0).toUpperCase()+r.substr(1)}function by(r,e){return e=e||"transparent",$t(r)?r:cr(r)&&r.colorStops&&(r.colorStops[0]||{}).color||e}function DA(r,e){if(e==="_blank"||e==="blank"){var t=window.open();t.opener=null,t.location.href=r}else window.open(r,e)}var F2=se,R7=["left","right","top","bottom","width","height"],$m=[["width","left","right"],["height","top","bottom"]];function eL(r,e,t,i,n){var a=0,s=0;i==null&&(i=1/0),n==null&&(n=1/0);var o=0;e.eachChild(function(l,c){var f=l.getBoundingRect(),p=e.childAt(c+1),y=p&&p.getBoundingRect(),b,S;if(r==="horizontal"){var C=f.width+(y?-y.x+f.x:0);b=a+C,b>i||l.newline?(a=0,b=C,s+=o+t,o=f.height):o=Math.max(o,f.height)}else{var E=f.height+(y?-y.y+f.y:0);S=s+E,S>n||l.newline?(a+=o+t,s=0,S=E,o=f.width):o=Math.max(o,f.width)}l.newline||(l.x=a,l.y=s,l.markRedraw(),r==="horizontal"?a=b+t:s=S+t)})}var ny=eL;Sr(eL,"vertical");Sr(eL,"horizontal");function nfe(r,e,t){var i=e.width,n=e.height,a=Vt(r.left,i),s=Vt(r.top,n),o=Vt(r.right,i),l=Vt(r.bottom,n);return(isNaN(a)||isNaN(parseFloat(r.left)))&&(a=0),(isNaN(o)||isNaN(parseFloat(r.right)))&&(o=i),(isNaN(s)||isNaN(parseFloat(r.top)))&&(s=0),(isNaN(l)||isNaN(parseFloat(r.bottom)))&&(l=n),t=Ry(t||0),{width:Math.max(o-a-t[1]-t[3],0),height:Math.max(l-s-t[0]-t[2],0)}}function La(r,e,t){t=Ry(t||0);var i=e.width,n=e.height,a=Vt(r.left,i),s=Vt(r.top,n),o=Vt(r.right,i),l=Vt(r.bottom,n),c=Vt(r.width,i),f=Vt(r.height,n),p=t[2]+t[0],y=t[1]+t[3],b=r.aspect;switch(isNaN(c)&&(c=i-o-y-a),isNaN(f)&&(f=n-l-p-s),b!=null&&(isNaN(c)&&isNaN(f)&&(b>i/n?c=i*.8:f=n*.8),isNaN(c)&&(c=b*f),isNaN(f)&&(f=c/b)),isNaN(a)&&(a=i-o-c-y),isNaN(s)&&(s=n-l-f-p),r.left||r.right){case"center":a=i/2-c/2-t[3];break;case"right":a=i-c-y;break}switch(r.top||r.bottom){case"middle":case"center":s=n/2-f/2-t[0];break;case"bottom":s=n-f-p;break}a=a||0,s=s||0,isNaN(c)&&(c=i-y-a-(o||0)),isNaN(f)&&(f=n-p-s-(l||0));var S=new Dr(a+t[3],s+t[0],c,f);return S.margin=t,S}function XC(r,e,t,i,n,a){var s=!n||!n.hv||n.hv[0],o=!n||!n.hv||n.hv[1],l=n&&n.boundingMode||"all";if(a=a||r,a.x=r.x,a.y=r.y,!s&&!o)return!1;var c;if(l==="raw")c=r.type==="group"?new Dr(0,0,+e.width||0,+e.height||0):r.getBoundingRect();else if(c=r.getBoundingRect(),r.needLocalTransform()){var f=r.getLocalTransform();c=c.clone(),c.applyTransform(f)}var p=La(lr({width:c.width,height:c.height},e),t,i),y=s?p.x-c.x:0,b=o?p.y-c.y:0;return l==="raw"?(a.x=y,a.y=b):(a.x+=y,a.y+=b),a===r&&r.markRedraw(),!0}function afe(r,e){return r[$m[e][0]]!=null||r[$m[e][1]]!=null&&r[$m[e][2]]!=null}function yw(r){var e=r.layoutMode||r.constructor.layoutMode;return cr(e)?e:e?{type:e}:null}function $g(r,e,t){var i=t&&t.ignoreSize;!xt(i)&&(i=[i,i]);var n=s($m[0],0),a=s($m[1],1);c($m[0],r,n),c($m[1],r,a);function s(f,p){var y={},b=0,S={},C=0,E=2;if(F2(f,function(B){S[B]=r[B]}),F2(f,function(B){o(e,B)&&(y[B]=S[B]=e[B]),l(y,B)&&b++,l(S,B)&&C++}),i[p])return l(e,f[1])?S[f[2]]=null:l(e,f[2])&&(S[f[1]]=null),S;if(C===E||!b)return S;if(b>=E)return y;for(var P=0;P<f.length;P++){var O=f[P];if(!o(y,O)&&o(r,O)){y[O]=r[O];break}}return y}function o(f,p){return f.hasOwnProperty(p)}function l(f,p){return f[p]!=null&&f[p]!=="auto"}function c(f,p,y){F2(f,function(b){p[b]=y[b]})}}function pb(r){return D7({},r)}function D7(r,e){return e&&r&&F2(R7,function(t){e.hasOwnProperty(t)&&(r[t]=e[t])}),r}var ofe=fi(),Wr=(function(r){Ye(e,r);function e(t,i,n){var a=r.call(this,t,i,n)||this;return a.uid=db("ec_cpt_model"),a}return e.prototype.init=function(t,i,n){this.mergeDefaultAndTheme(t,n)},e.prototype.mergeDefaultAndTheme=function(t,i){var n=yw(this),a=n?pb(t):{},s=i.getTheme();Cr(t,s.get(this.mainType)),Cr(t,this.getDefaultOption()),n&&$g(t,a,n)},e.prototype.mergeOption=function(t,i){Cr(this.option,t,!0);var n=yw(this);n&&$g(this.option,t,n)},e.prototype.optionUpdated=function(t,i){},e.prototype.getDefaultOption=function(){var t=this.constructor;if(!Que(t))return t.defaultOption;var i=ofe(this);if(!i.defaultOption){for(var n=[],a=t;a;){var s=a.prototype.defaultOption;s&&n.push(s),a=a.superClass}for(var o={},l=n.length-1;l>=0;l--)o=Cr(o,n[l],!0);i.defaultOption=o}return i.defaultOption},e.prototype.getReferringComponents=function(t,i){var n=t+"Index",a=t+"Id";return Gw(this.ecModel,t,{index:this.get(n,!0),id:this.get(a,!0)},i)},e.prototype.getBoxLayoutParams=function(){var t=this;return{left:t.get("left"),top:t.get("top"),right:t.get("right"),bottom:t.get("bottom"),width:t.get("width"),height:t.get("height")}},e.prototype.getZLevelKey=function(){return""},e.prototype.setZLevel=function(t){this.option.zlevel=t},e.protoInitialize=(function(){var t=e.prototype;t.type="component",t.id="",t.name="",t.mainType="",t.subType="",t.componentIndex=0})(),e})(Si);O$(Wr,Si);kC(Wr);$he(Wr);Whe(Wr,sfe);function sfe(r){var e=[];return se(Wr.getClassesByMainType(r),function(t){e=e.concat(t.dependencies||t.prototype.dependencies||[])}),e=wt(e,function(t){return Lf(t).main}),r!=="dataset"&&Or(e,"dataset")<=0&&e.unshift("dataset"),e}var k7="";typeof navigator<"u"&&(k7=navigator.platform||"");var W_="rgba(0, 0, 0, 0.2)";const lfe={darkMode:"auto",colorBy:"series",color:["#5470c6","#91cc75","#fac858","#ee6666","#73c0de","#3ba272","#fc8452","#9a60b4","#ea7ccc"],gradientColor:["#f6efa6","#d88273","#bf444c"],aria:{decal:{decals:[{color:W_,dashArrayX:[1,0],dashArrayY:[2,5],symbolSize:1,rotation:Math.PI/6},{color:W_,symbol:"circle",dashArrayX:[[8,8],[0,8,8,0]],dashArrayY:[6,0],symbolSize:.8},{color:W_,dashArrayX:[1,0],dashArrayY:[4,3],rotation:-Math.PI/4},{color:W_,dashArrayX:[[6,6],[0,6,6,0]],dashArrayY:[6,0]},{color:W_,dashArrayX:[[1,0],[1,6]],dashArrayY:[1,0,6,0],rotation:Math.PI/4},{color:W_,symbol:"triangle",dashArrayX:[[9,9],[0,9,9,0]],dashArrayY:[7,2],symbolSize:.75}]}},textStyle:{fontFamily:k7.match(/^Win/)?"Microsoft YaHei":"sans-serif",fontSize:12,fontStyle:"normal",fontWeight:"normal"},blendMode:null,stateAnimation:{duration:300,easing:"cubicOut"},animation:"auto",animationDuration:1e3,animationDurationUpdate:500,animationEasing:"cubicInOut",animationEasingUpdate:"cubicInOut",animationThreshold:2e3,progressiveThreshold:3e3,progressive:400,hoverLayerThreshold:3e3,useUTC:!1};var L7=Qt(["tooltip","label","itemName","itemId","itemGroupId","itemChildGroupId","seriesName"]),Ec="original",Ds="arrayRows",Ic="objectRows",Wf="keyedColumns",Bg="typedArray",O7="unknown",Ff="column",gb="row",Jo={Must:1,Might:2,Not:3},N7=fi();function ufe(r){N7(r).datasetMap=Qt()}function B7(r,e,t){var i={},n=rL(e);if(!n||!r)return i;var a=[],s=[],o=e.ecModel,l=N7(o).datasetMap,c=n.uid+"_"+t.seriesLayoutBy,f,p;r=r.slice(),se(r,function(C,E){var P=cr(C)?C:r[E]={name:C};P.type==="ordinal"&&f==null&&(f=E,p=S(P)),i[P.name]=[]});var y=l.get(c)||l.set(c,{categoryWayDim:p,valueWayDim:0});se(r,function(C,E){var P=C.name,O=S(C);if(f==null){var B=y.valueWayDim;b(i[P],B,O),b(s,B,O),y.valueWayDim+=O}else if(f===E)b(i[P],0,O),b(a,0,O);else{var B=y.categoryWayDim;b(i[P],B,O),b(s,B,O),y.categoryWayDim+=O}});function b(C,E,P){for(var O=0;O<P;O++)C.push(E+O)}function S(C){var E=C.dimsDef;return E?E.length:1}return a.length&&(i.itemName=a),s.length&&(i.seriesName=s),i}function tL(r,e,t){var i={},n=rL(r);if(!n)return i;var a=e.sourceFormat,s=e.dimensionsDefine,o;(a===Ic||a===Wf)&&se(s,function(f,p){(cr(f)?f.name:f)==="name"&&(o=p)});var l=(function(){for(var f={},p={},y=[],b=0,S=Math.min(5,t);b<S;b++){var C=F7(e.data,a,e.seriesLayoutBy,s,e.startIndex,b);y.push(C);var E=C===Jo.Not;if(E&&f.v==null&&b!==o&&(f.v=b),(f.n==null||f.n===f.v||!E&&y[f.n]===Jo.Not)&&(f.n=b),P(f)&&y[f.n]!==Jo.Not)return f;E||(C===Jo.Might&&p.v==null&&b!==o&&(p.v=b),(p.n==null||p.n===p.v)&&(p.n=b))}function P(O){return O.v!=null&&O.n!=null}return P(f)?f:P(p)?p:null})();if(l){i.value=[l.v];var c=o??l.n;i.itemName=[c],i.seriesName=[c]}return i}function rL(r){var e=r.get("data",!0);if(!e)return Gw(r.ecModel,"dataset",{index:r.get("datasetIndex",!0),id:r.get("datasetId",!0)},ka).models[0]}function cfe(r){return!r.get("transform",!0)&&!r.get("fromTransformResult",!0)?[]:Gw(r.ecModel,"dataset",{index:r.get("fromDatasetIndex",!0),id:r.get("fromDatasetId",!0)},ka).models}function z7(r,e){return F7(r.data,r.sourceFormat,r.seriesLayoutBy,r.dimensionsDefine,r.startIndex,e)}function F7(r,e,t,i,n,a){var s,o=5;if(sl(r))return Jo.Not;var l,c;if(i){var f=i[a];cr(f)?(l=f.name,c=f.type):$t(f)&&(l=f)}if(c!=null)return c==="ordinal"?Jo.Must:Jo.Not;if(e===Ds){var p=r;if(t===gb){for(var y=p[a],b=0;b<(y||[]).length&&b<o;b++)if((s=F(y[n+b]))!=null)return s}else for(var b=0;b<p.length&&b<o;b++){var S=p[n+b];if(S&&(s=F(S[a]))!=null)return s}}else if(e===Ic){var C=r;if(!l)return Jo.Not;for(var b=0;b<C.length&&b<o;b++){var E=C[b];if(E&&(s=F(E[l]))!=null)return s}}else if(e===Wf){var P=r;if(!l)return Jo.Not;var y=P[l];if(!y||sl(y))return Jo.Not;for(var b=0;b<y.length&&b<o;b++)if((s=F(y[b]))!=null)return s}else if(e===Ec)for(var O=r,b=0;b<O.length&&b<o;b++){var E=O[b],B=ab(E);if(!xt(B))return Jo.Not;if((s=F(B[a]))!=null)return s}function F(W){var $=$t(W);if(W!=null&&Number.isFinite(Number(W))&&W!=="")return $?Jo.Might:Jo.Not;if($&&W!=="-")return Jo.Must}return Jo.Not}var u3=Qt();function hfe(r,e){Is(u3.get(r)==null&&e),u3.set(r,e)}function ffe(r,e,t){var i=u3.get(e);if(!i)return t;var n=i(r);return n?t.concat(n):t}var xz=fi(),dfe=fi(),iL=(function(){function r(){}return r.prototype.getColorFromPalette=function(e,t,i){var n=Gi(this.get("color",!0)),a=this.get("colorLayer",!0);return V7(this,xz,n,a,e,t,i)},r.prototype.clearColorPalette=function(){gfe(this,xz)},r})();function c3(r,e,t,i){var n=Gi(r.get(["aria","decal","decals"]));return V7(r,dfe,n,null,e,t,i)}function pfe(r,e){for(var t=r.length,i=0;i<t;i++)if(r[i].length>e)return r[i];return r[t-1]}function V7(r,e,t,i,n,a,s){a=a||r;var o=e(a),l=o.paletteIdx||0,c=o.paletteNameMap=o.paletteNameMap||{};if(c.hasOwnProperty(n))return c[n];var f=s==null||!i?t:pfe(i,s);if(f=f||t,!(!f||!f.length)){var p=f[l];return n&&(c[n]=p),o.paletteIdx=(l+1)%f.length,p}}function gfe(r,e){e(r).paletteIdx=0,e(r).paletteNameMap={}}var LT,Fx,wz,Sz="\0_ec_inner",vfe=1,nL=(function(r){Ye(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.init=function(t,i,n,a,s,o){a=a||{},this.option=null,this._theme=new Si(a),this._locale=new Si(s),this._optionManager=o},e.prototype.setOption=function(t,i,n){var a=Cz(i);this._optionManager.setOption(t,n,a),this._resetOption(null,a)},e.prototype.resetOption=function(t,i){return this._resetOption(t,Cz(i))},e.prototype._resetOption=function(t,i){var n=!1,a=this._optionManager;if(!t||t==="recreate"){var s=a.mountOption(t==="recreate");!this.option||t==="recreate"?wz(this,s):(this.restoreData(),this._mergeOption(s,i)),n=!0}if((t==="timeline"||t==="media")&&this.restoreData(),!t||t==="recreate"||t==="timeline"){var o=a.getTimelineOption(this);o&&(n=!0,this._mergeOption(o,i))}if(!t||t==="recreate"||t==="media"){var l=a.getMediaOption(this);l.length&&se(l,function(c){n=!0,this._mergeOption(c,i)},this)}return n},e.prototype.mergeOption=function(t){this._mergeOption(t,null)},e.prototype._mergeOption=function(t,i){var n=this.option,a=this._componentsMap,s=this._componentsCount,o=[],l=Qt(),c=i&&i.replaceMergeMainTypeMap;ufe(this),se(t,function(p,y){p!=null&&(Wr.hasClass(y)?y&&(o.push(y),l.set(y,!0)):n[y]=n[y]==null?hr(p):Cr(n[y],p,!0))}),c&&c.each(function(p,y){Wr.hasClass(y)&&!l.get(y)&&(o.push(y),l.set(y,!0))}),Wr.topologicalTravel(o,Wr.getAllClassMainTypes(),f,this);function f(p){var y=ffe(this,p,Gi(t[p])),b=a.get(p),S=b?c&&c.get(p)?"replaceMerge":"normalMerge":"replaceAll",C=P$(b,y,S);jue(C,p,Wr),n[p]=null,a.set(p,null),s.set(p,0);var E=[],P=[],O=0,B;se(C,function(F,W){var $=F.existing,q=F.newOption;if(!q)$&&($.mergeOption({},this),$.optionUpdated({},!1));else{var Q=p==="series",ee=Wr.getClass(p,F.keyInfo.subType,!Q);if(!ee)return;if(p==="tooltip"){if(B)return;B=!0}if($&&$.constructor===ee)$.name=F.keyInfo.name,$.mergeOption(q,this),$.optionUpdated(q,!1);else{var te=mt({componentIndex:W},F.keyInfo);$=new ee(q,this,this,te),mt($,te),F.brandNew&&($.__requireNewView=!0),$.init(q,this,this),$.optionUpdated(null,!0)}}$?(E.push($.option),P.push($),O++):(E.push(void 0),P.push(void 0))},this),n[p]=E,a.set(p,P),s.set(p,O),p==="series"&&LT(this)}this._seriesIndices||LT(this)},e.prototype.getOption=function(){var t=hr(this.option);return se(t,function(i,n){if(Wr.hasClass(n)){for(var a=Gi(i),s=a.length,o=!1,l=s-1;l>=0;l--)a[l]&&!dw(a[l])?o=!0:(a[l]=null,!o&&s--);a.length=s,t[n]=a}}),delete t[Sz],t},e.prototype.getTheme=function(){return this._theme},e.prototype.getLocaleModel=function(){return this._locale},e.prototype.setUpdatePayload=function(t){this._payload=t},e.prototype.getUpdatePayload=function(){return this._payload},e.prototype.getComponent=function(t,i){var n=this._componentsMap.get(t);if(n){var a=n[i||0];if(a)return a;if(i==null){for(var s=0;s<n.length;s++)if(n[s])return n[s]}}},e.prototype.queryComponents=function(t){var i=t.mainType;if(!i)return[];var n=t.index,a=t.id,s=t.name,o=this._componentsMap.get(i);if(!o||!o.length)return[];var l;return n!=null?(l=[],se(Gi(n),function(c){o[c]&&l.push(o[c])})):a!=null?l=Tz("id",a,o):s!=null?l=Tz("name",s,o):l=wi(o,function(c){return!!c}),Az(l,t)},e.prototype.findComponents=function(t){var i=t.query,n=t.mainType,a=o(i),s=a?this.queryComponents(a):wi(this._componentsMap.get(n),function(c){return!!c});return l(Az(s,t));function o(c){var f=n+"Index",p=n+"Id",y=n+"Name";return c&&(c[f]!=null||c[p]!=null||c[y]!=null)?{mainType:n,index:c[f],id:c[p],name:c[y]}:null}function l(c){return t.filter?wi(c,t.filter):c}},e.prototype.eachComponent=function(t,i,n){var a=this._componentsMap;if(sr(t)){var s=i,o=t;a.each(function(p,y){for(var b=0;p&&b<p.length;b++){var S=p[b];S&&o.call(s,y,S,S.componentIndex)}})}else for(var l=$t(t)?a.get(t):cr(t)?this.findComponents(t):null,c=0;l&&c<l.length;c++){var f=l[c];f&&i.call(n,f,f.componentIndex)}},e.prototype.getSeriesByName=function(t){var i=Za(t,null);return wi(this._componentsMap.get("series"),function(n){return!!n&&i!=null&&n.name===i})},e.prototype.getSeriesByIndex=function(t){return this._componentsMap.get("series")[t]},e.prototype.getSeriesByType=function(t){return wi(this._componentsMap.get("series"),function(i){return!!i&&i.subType===t})},e.prototype.getSeries=function(){return wi(this._componentsMap.get("series"),function(t){return!!t})},e.prototype.getSeriesCount=function(){return this._componentsCount.get("series")},e.prototype.eachSeries=function(t,i){Fx(this),se(this._seriesIndices,function(n){var a=this._componentsMap.get("series")[n];t.call(i,a,n)},this)},e.prototype.eachRawSeries=function(t,i){se(this._componentsMap.get("series"),function(n){n&&t.call(i,n,n.componentIndex)})},e.prototype.eachSeriesByType=function(t,i,n){Fx(this),se(this._seriesIndices,function(a){var s=this._componentsMap.get("series")[a];s.subType===t&&i.call(n,s,a)},this)},e.prototype.eachRawSeriesByType=function(t,i,n){return se(this.getSeriesByType(t),i,n)},e.prototype.isSeriesFiltered=function(t){return Fx(this),this._seriesIndicesMap.get(t.componentIndex)==null},e.prototype.getCurrentSeriesIndices=function(){return(this._seriesIndices||[]).slice()},e.prototype.filterSeries=function(t,i){Fx(this);var n=[];se(this._seriesIndices,function(a){var s=this._componentsMap.get("series")[a];t.call(i,s,a)&&n.push(a)},this),this._seriesIndices=n,this._seriesIndicesMap=Qt(n)},e.prototype.restoreData=function(t){LT(this);var i=this._componentsMap,n=[];i.each(function(a,s){Wr.hasClass(s)&&n.push(s)}),Wr.topologicalTravel(n,Wr.getAllClassMainTypes(),function(a){se(i.get(a),function(s){s&&(a!=="series"||!mfe(s,t))&&s.restoreData()})})},e.internalField=(function(){LT=function(t){var i=t._seriesIndices=[];se(t._componentsMap.get("series"),function(n){n&&i.push(n.componentIndex)}),t._seriesIndicesMap=Qt(i)},Fx=function(t){},wz=function(t,i){t.option={},t.option[Sz]=vfe,t._componentsMap=Qt({series:[]}),t._componentsCount=Qt();var n=i.aria;cr(n)&&n.enabled==null&&(n.enabled=!0),yfe(i,t._theme.option),Cr(i,lfe,!1),t._mergeOption(i,null)}})(),e})(Si);function mfe(r,e){if(e){var t=e.seriesIndex,i=e.seriesId,n=e.seriesName;return t!=null&&r.componentIndex!==t||i!=null&&r.id!==i||n!=null&&r.name!==n}}function yfe(r,e){var t=r.color&&!r.colorLayer;se(e,function(i,n){n==="colorLayer"&&t||Wr.hasClass(n)||(typeof i=="object"?r[n]=r[n]?Cr(r[n],i,!1):hr(i):r[n]==null&&(r[n]=i))})}function Tz(r,e,t){if(xt(e)){var i=Qt();return se(e,function(a){if(a!=null){var s=Za(a,null);s!=null&&i.set(a,!0)}}),wi(t,function(a){return a&&i.get(a[r])})}else{var n=Za(e,null);return wi(t,function(a){return a&&n!=null&&a[r]===n})}}function Az(r,e){return e.hasOwnProperty("subType")?wi(r,function(t){return t&&t.subType===e.subType}):r}function Cz(r){var e=Qt();return r&&se(Gi(r.replaceMerge),function(t){e.set(t,!0)}),{replaceMergeMainTypeMap:e}}ha(nL,iL);var _fe=["getDom","getZr","getWidth","getHeight","getDevicePixelRatio","dispatchAction","isSSR","isDisposed","on","off","getDataURL","getConnectedDataURL","getOption","getId","updateLabelLayout"],U7=(function(){function r(e){se(_fe,function(t){this[t]=Xt(e[t],e)},this)}return r})(),oI={},vb=(function(){function r(){this._coordinateSystems=[]}return r.prototype.create=function(e,t){var i=[];se(oI,function(n,a){var s=n.create(e,t);i=i.concat(s||[])}),this._coordinateSystems=i},r.prototype.update=function(e,t){se(this._coordinateSystems,function(i){i.update&&i.update(e,t)})},r.prototype.getCoordinateSystems=function(){return this._coordinateSystems.slice()},r.register=function(e,t){oI[e]=t},r.get=function(e){return oI[e]},r})(),bfe=/^(min|max)?(.+)$/,xfe=(function(){function r(e){this._timelineOptions=[],this._mediaList=[],this._currentMediaIndices=[],this._api=e}return r.prototype.setOption=function(e,t,i){e&&(se(Gi(e.series),function(s){s&&s.data&&sl(s.data)&&ow(s.data)}),se(Gi(e.dataset),function(s){s&&s.source&&sl(s.source)&&ow(s.source)})),e=hr(e);var n=this._optionBackup,a=wfe(e,t,!n);this._newBaseOption=a.baseOption,n?(a.timelineOptions.length&&(n.timelineOptions=a.timelineOptions),a.mediaList.length&&(n.mediaList=a.mediaList),a.mediaDefault&&(n.mediaDefault=a.mediaDefault)):this._optionBackup=a},r.prototype.mountOption=function(e){var t=this._optionBackup;return this._timelineOptions=t.timelineOptions,this._mediaList=t.mediaList,this._mediaDefault=t.mediaDefault,this._currentMediaIndices=[],hr(e?t.baseOption:this._newBaseOption)},r.prototype.getTimelineOption=function(e){var t,i=this._timelineOptions;if(i.length){var n=e.getComponent("timeline");n&&(t=hr(i[n.getCurrentIndex()]))}return t},r.prototype.getMediaOption=function(e){var t=this._api.getWidth(),i=this._api.getHeight(),n=this._mediaList,a=this._mediaDefault,s=[],o=[];if(!n.length&&!a)return o;for(var l=0,c=n.length;l<c;l++)Sfe(n[l].query,t,i)&&s.push(l);return!s.length&&a&&(s=[-1]),s.length&&!Afe(s,this._currentMediaIndices)&&(o=wt(s,function(f){return hr(f===-1?a.option:n[f].option)})),this._currentMediaIndices=s,o},r})();function wfe(r,e,t){var i=[],n,a,s=r.baseOption,o=r.timeline,l=r.options,c=r.media,f=!!r.media,p=!!(l||o||s&&s.timeline);s?(a=s,a.timeline||(a.timeline=o)):((p||f)&&(r.options=r.media=null),a=r),f&&xt(c)&&se(c,function(b){b&&b.option&&(b.query?i.push(b):n||(n=b))}),y(a),se(l,function(b){return y(b)}),se(i,function(b){return y(b.option)});function y(b){se(e,function(S){S(b,t)})}return{baseOption:a,timelineOptions:l||[],mediaDefault:n,mediaList:i}}function Sfe(r,e,t){var i={width:e,height:t,aspectratio:e/t},n=!0;return se(r,function(a,s){var o=s.match(bfe);if(!(!o||!o[1]||!o[2])){var l=o[1],c=o[2].toLowerCase();Tfe(i[c],a,l)||(n=!1)}}),n}function Tfe(r,e,t){return t==="min"?r>=e:t==="max"?r<=e:r===e}function Afe(r,e){return r.join(",")===e.join(",")}var ph=se,_w=cr,Mz=["areaStyle","lineStyle","nodeStyle","linkStyle","chordStyle","label","labelLine"];function sI(r){var e=r&&r.itemStyle;if(e)for(var t=0,i=Mz.length;t<i;t++){var n=Mz[t],a=e.normal,s=e.emphasis;a&&a[n]&&(r[n]=r[n]||{},r[n].normal?Cr(r[n].normal,a[n]):r[n].normal=a[n],a[n]=null),s&&s[n]&&(r[n]=r[n]||{},r[n].emphasis?Cr(r[n].emphasis,s[n]):r[n].emphasis=s[n],s[n]=null)}}function Cs(r,e,t){if(r&&r[e]&&(r[e].normal||r[e].emphasis)){var i=r[e].normal,n=r[e].emphasis;i&&(t?(r[e].normal=r[e].emphasis=null,lr(r[e],i)):r[e]=i),n&&(r.emphasis=r.emphasis||{},r.emphasis[e]=n,n.focus&&(r.emphasis.focus=n.focus),n.blurScope&&(r.emphasis.blurScope=n.blurScope))}}function b1(r){Cs(r,"itemStyle"),Cs(r,"lineStyle"),Cs(r,"areaStyle"),Cs(r,"label"),Cs(r,"labelLine"),Cs(r,"upperLabel"),Cs(r,"edgeLabel")}function Da(r,e){var t=_w(r)&&r[e],i=_w(t)&&t.textStyle;if(i)for(var n=0,a=k4.length;n<a;n++){var s=k4[n];i.hasOwnProperty(s)&&(t[s]=i[s])}}function cc(r){r&&(b1(r),Da(r,"label"),r.emphasis&&Da(r.emphasis,"label"))}function Cfe(r){if(_w(r)){sI(r),b1(r),Da(r,"label"),Da(r,"upperLabel"),Da(r,"edgeLabel"),r.emphasis&&(Da(r.emphasis,"label"),Da(r.emphasis,"upperLabel"),Da(r.emphasis,"edgeLabel"));var e=r.markPoint;e&&(sI(e),cc(e));var t=r.markLine;t&&(sI(t),cc(t));var i=r.markArea;i&&cc(i);var n=r.data;if(r.type==="graph"){n=n||r.nodes;var a=r.links||r.edges;if(a&&!sl(a))for(var s=0;s<a.length;s++)cc(a[s]);se(r.categories,function(c){b1(c)})}if(n&&!sl(n))for(var s=0;s<n.length;s++)cc(n[s]);if(e=r.markPoint,e&&e.data)for(var o=e.data,s=0;s<o.length;s++)cc(o[s]);if(t=r.markLine,t&&t.data)for(var l=t.data,s=0;s<l.length;s++)xt(l[s])?(cc(l[s][0]),cc(l[s][1])):cc(l[s]);r.type==="gauge"?(Da(r,"axisLabel"),Da(r,"title"),Da(r,"detail")):r.type==="treemap"?(Cs(r.breadcrumb,"itemStyle"),se(r.levels,function(c){b1(c)})):r.type==="tree"&&b1(r.leaves)}}function Wd(r){return xt(r)?r:r?[r]:[]}function Ez(r){return(xt(r)?r[0]:r)||{}}function Mfe(r,e){ph(Wd(r.series),function(i){_w(i)&&Cfe(i)});var t=["xAxis","yAxis","radiusAxis","angleAxis","singleAxis","parallelAxis","radar"];e&&t.push("valueAxis","categoryAxis","logAxis","timeAxis"),ph(t,function(i){ph(Wd(r[i]),function(n){n&&(Da(n,"axisLabel"),Da(n.axisPointer,"label"))})}),ph(Wd(r.parallel),function(i){var n=i&&i.parallelAxisDefault;Da(n,"axisLabel"),Da(n&&n.axisPointer,"label")}),ph(Wd(r.calendar),function(i){Cs(i,"itemStyle"),Da(i,"dayLabel"),Da(i,"monthLabel"),Da(i,"yearLabel")}),ph(Wd(r.radar),function(i){Da(i,"name"),i.name&&i.axisName==null&&(i.axisName=i.name,delete i.name),i.nameGap!=null&&i.axisNameGap==null&&(i.axisNameGap=i.nameGap,delete i.nameGap)}),ph(Wd(r.geo),function(i){_w(i)&&(cc(i),ph(Wd(i.regions),function(n){cc(n)}))}),ph(Wd(r.timeline),function(i){cc(i),Cs(i,"label"),Cs(i,"itemStyle"),Cs(i,"controlStyle",!0);var n=i.data;xt(n)&&se(n,function(a){cr(a)&&(Cs(a,"label"),Cs(a,"itemStyle"))})}),ph(Wd(r.toolbox),function(i){Cs(i,"iconStyle"),ph(i.feature,function(n){Cs(n,"iconStyle")})}),Da(Ez(r.axisPointer),"label"),Da(Ez(r.tooltip).axisPointer,"label")}function Efe(r,e){for(var t=e.split(","),i=r,n=0;n<t.length&&(i=i&&i[t[n]],i!=null);n++);return i}function Ife(r,e,t,i){for(var n=e.split(","),a=r,s,o=0;o<n.length-1;o++)s=n[o],a[s]==null&&(a[s]={}),a=a[s];a[n[o]]==null&&(a[n[o]]=t)}function Iz(r){r&&se(Pfe,function(e){e[0]in r&&!(e[1]in r)&&(r[e[1]]=r[e[0]])})}var Pfe=[["x","left"],["y","top"],["x2","right"],["y2","bottom"]],Rfe=["grid","geo","parallel","legend","toolbox","title","visualMap","dataZoom","timeline"],lI=[["borderRadius","barBorderRadius"],["borderColor","barBorderColor"],["borderWidth","barBorderWidth"]];function Vx(r){var e=r&&r.itemStyle;if(e)for(var t=0;t<lI.length;t++){var i=lI[t][1],n=lI[t][0];e[i]!=null&&(e[n]=e[i])}}function Pz(r){r&&r.alignTo==="edge"&&r.margin!=null&&r.edgeDistance==null&&(r.edgeDistance=r.margin)}function Rz(r){r&&r.downplay&&!r.blur&&(r.blur=r.downplay)}function Dfe(r){r&&r.focusNodeAdjacency!=null&&(r.emphasis=r.emphasis||{},r.emphasis.focus==null&&(r.emphasis.focus="adjacency"))}function H7(r,e){if(r)for(var t=0;t<r.length;t++)e(r[t]),r[t]&&H7(r[t].children,e)}function j7(r,e){Mfe(r,e),r.series=Gi(r.series),se(r.series,function(t){if(cr(t)){var i=t.type;if(i==="line")t.clipOverflow!=null&&(t.clip=t.clipOverflow);else if(i==="pie"||i==="gauge"){t.clockWise!=null&&(t.clockwise=t.clockWise),Pz(t.label);var n=t.data;if(n&&!sl(n))for(var a=0;a<n.length;a++)Pz(n[a]);t.hoverOffset!=null&&(t.emphasis=t.emphasis||{},(t.emphasis.scaleSize=null)&&(t.emphasis.scaleSize=t.hoverOffset))}else if(i==="gauge"){var s=Efe(t,"pointer.color");s!=null&&Ife(t,"itemStyle.color",s)}else if(i==="bar"){Vx(t),Vx(t.backgroundStyle),Vx(t.emphasis);var n=t.data;if(n&&!sl(n))for(var a=0;a<n.length;a++)typeof n[a]=="object"&&(Vx(n[a]),Vx(n[a]&&n[a].emphasis))}else if(i==="sunburst"){var o=t.highlightPolicy;o&&(t.emphasis=t.emphasis||{},t.emphasis.focus||(t.emphasis.focus=o)),Rz(t),H7(t.data,Rz)}else i==="graph"||i==="sankey"?Dfe(t):i==="map"&&(t.mapType&&!t.map&&(t.map=t.mapType),t.mapLocation&&lr(t,t.mapLocation));t.hoverAnimation!=null&&(t.emphasis=t.emphasis||{},t.emphasis&&t.emphasis.scale==null&&(t.emphasis.scale=t.hoverAnimation)),Iz(t)}}),r.dataRange&&(r.visualMap=r.dataRange),se(Rfe,function(t){var i=r[t];i&&(xt(i)||(i=[i]),se(i,function(n){Iz(n)}))})}function kfe(r){var e=Qt();r.eachSeries(function(t){var i=t.get("stack");if(i){var n=e.get(i)||e.set(i,[]),a=t.getData(),s={stackResultDimension:a.getCalculationInfo("stackResultDimension"),stackedOverDimension:a.getCalculationInfo("stackedOverDimension"),stackedDimension:a.getCalculationInfo("stackedDimension"),stackedByDimension:a.getCalculationInfo("stackedByDimension"),isStackedByIndex:a.getCalculationInfo("isStackedByIndex"),data:a,seriesModel:t};if(!s.stackedDimension||!(s.isStackedByIndex||s.stackedByDimension))return;n.length&&a.setCalculationInfo("stackedOnSeries",n[n.length-1].seriesModel),n.push(s)}}),e.each(Lfe)}function Lfe(r){se(r,function(e,t){var i=[],n=[NaN,NaN],a=[e.stackResultDimension,e.stackedOverDimension],s=e.data,o=e.isStackedByIndex,l=e.seriesModel.get("stackStrategy")||"samesign";s.modify(a,function(c,f,p){var y=s.get(e.stackedDimension,p);if(isNaN(y))return n;var b,S;o?S=s.getRawIndex(p):b=s.get(e.stackedByDimension,p);for(var C=NaN,E=t-1;E>=0;E--){var P=r[E];if(o||(S=P.data.rawIndexOf(P.stackedByDimension,b)),S>=0){var O=P.data.getByRawIndex(P.stackResultDimension,S);if(l==="all"||l==="positive"&&O>0||l==="negative"&&O<0||l==="samesign"&&y>=0&&O>0||l==="samesign"&&y<=0&&O<0){y=kue(y,O),C=O;break}}}return i[0]=y,i[1]=C,i})})}var ZC=(function(){function r(e){this.data=e.data||(e.sourceFormat===Wf?{}:[]),this.sourceFormat=e.sourceFormat||O7,this.seriesLayoutBy=e.seriesLayoutBy||Ff,this.startIndex=e.startIndex||0,this.dimensionsDetectedCount=e.dimensionsDetectedCount,this.metaRawOption=e.metaRawOption;var t=this.dimensionsDefine=e.dimensionsDefine;if(t)for(var i=0;i<t.length;i++){var n=t[i];n.type==null&&z7(this,i)===Jo.Must&&(n.type="ordinal")}}return r})();function aL(r){return r instanceof ZC}function h3(r,e,t){t=t||$7(r);var i=e.seriesLayoutBy,n=Nfe(r,t,i,e.sourceHeader,e.dimensions),a=new ZC({data:r,sourceFormat:t,seriesLayoutBy:i,dimensionsDefine:n.dimensionsDefine,startIndex:n.startIndex,dimensionsDetectedCount:n.dimensionsDetectedCount,metaRawOption:hr(e)});return a}function oL(r){return new ZC({data:r,sourceFormat:sl(r)?Bg:Ec})}function Ofe(r){return new ZC({data:r.data,sourceFormat:r.sourceFormat,seriesLayoutBy:r.seriesLayoutBy,dimensionsDefine:hr(r.dimensionsDefine),startIndex:r.startIndex,dimensionsDetectedCount:r.dimensionsDetectedCount})}function $7(r){var e=O7;if(sl(r))e=Bg;else if(xt(r)){r.length===0&&(e=Ds);for(var t=0,i=r.length;t<i;t++){var n=r[t];if(n!=null){if(xt(n)||sl(n)){e=Ds;break}else if(cr(n)){e=Ic;break}}}}else if(cr(r)){for(var a in r)if(Yt(r,a)&&es(r[a])){e=Wf;break}}return e}function Nfe(r,e,t,i,n){var a,s;if(!r)return{dimensionsDefine:Dz(n),startIndex:s,dimensionsDetectedCount:a};if(e===Ds){var o=r;i==="auto"||i==null?kz(function(c){c!=null&&c!=="-"&&($t(c)?s==null&&(s=1):s=0)},t,o,10):s=di(i)?i:i?1:0,!n&&s===1&&(n=[],kz(function(c,f){n[f]=c!=null?c+"":""},t,o,1/0)),a=n?n.length:t===gb?o.length:o[0]?o[0].length:null}else if(e===Ic)n||(n=Bfe(r));else if(e===Wf)n||(n=[],se(r,function(c,f){n.push(f)}));else if(e===Ec){var l=ab(r[0]);a=xt(l)&&l.length||1}return{startIndex:s,dimensionsDefine:Dz(n),dimensionsDetectedCount:a}}function Bfe(r){for(var e=0,t;e<r.length&&!(t=r[e++]););if(t)return qr(t)}function Dz(r){if(r){var e=Qt();return wt(r,function(t,i){t=cr(t)?t:{name:t};var n={name:t.name,displayName:t.displayName,type:t.type};if(n.name==null)return n;n.name+="",n.displayName==null&&(n.displayName=n.name);var a=e.get(n.name);return a?n.name+="-"+a.count++:e.set(n.name,{count:1}),n})}}function kz(r,e,t,i){if(e===gb)for(var n=0;n<t.length&&n<i;n++)r(t[n]?t[n][0]:null,n);else for(var a=t[0]||[],n=0;n<a.length&&n<i;n++)r(a[n],n)}function W7(r){var e=r.sourceFormat;return e===Ic||e===Wf}var _m,bm,xm,Lz,Oz,G7=(function(){function r(e,t){var i=aL(e)?e:oL(e);this._source=i;var n=this._data=i.data;i.sourceFormat===Bg&&(this._offset=0,this._dimSize=t,this._data=n),Oz(this,n,i)}return r.prototype.getSource=function(){return this._source},r.prototype.count=function(){return 0},r.prototype.getItem=function(e,t){},r.prototype.appendData=function(e){},r.prototype.clean=function(){},r.protoInitialize=(function(){var e=r.prototype;e.pure=!1,e.persistent=!0})(),r.internalField=(function(){var e;Oz=function(s,o,l){var c=l.sourceFormat,f=l.seriesLayoutBy,p=l.startIndex,y=l.dimensionsDefine,b=Lz[sL(c,f)];if(mt(s,b),c===Bg)s.getItem=t,s.count=n,s.fillStorage=i;else{var S=X7(c,f);s.getItem=Xt(S,null,o,p,y);var C=Z7(c,f);s.count=Xt(C,null,o,p,y)}};var t=function(s,o){s=s-this._offset,o=o||[];for(var l=this._data,c=this._dimSize,f=c*s,p=0;p<c;p++)o[p]=l[f+p];return o},i=function(s,o,l,c){for(var f=this._data,p=this._dimSize,y=0;y<p;y++){for(var b=c[y],S=b[0]==null?1/0:b[0],C=b[1]==null?-1/0:b[1],E=o-s,P=l[y],O=0;O<E;O++){var B=f[O*p+y];P[s+O]=B,B<S&&(S=B),B>C&&(C=B)}b[0]=S,b[1]=C}},n=function(){return this._data?this._data.length/this._dimSize:0};Lz=(e={},e[Ds+"_"+Ff]={pure:!0,appendData:a},e[Ds+"_"+gb]={pure:!0,appendData:function(){throw new Error('Do not support appendData when set seriesLayoutBy: "row".')}},e[Ic]={pure:!0,appendData:a},e[Wf]={pure:!0,appendData:function(s){var o=this._data;se(s,function(l,c){for(var f=o[c]||(o[c]=[]),p=0;p<(l||[]).length;p++)f.push(l[p])})}},e[Ec]={appendData:a},e[Bg]={persistent:!1,pure:!0,appendData:function(s){this._data=s},clean:function(){this._offset+=this.count(),this._data=null}},e);function a(s){for(var o=0;o<s.length;o++)this._data.push(s[o])}})(),r})(),Nz=function(r,e,t,i){return r[i]},zfe=(_m={},_m[Ds+"_"+Ff]=function(r,e,t,i){return r[i+e]},_m[Ds+"_"+gb]=function(r,e,t,i,n){i+=e;for(var a=n||[],s=r,o=0;o<s.length;o++){var l=s[o];a[o]=l?l[i]:null}return a},_m[Ic]=Nz,_m[Wf]=function(r,e,t,i,n){for(var a=n||[],s=0;s<t.length;s++){var o=t[s].name,l=r[o];a[s]=l?l[i]:null}return a},_m[Ec]=Nz,_m);function X7(r,e){var t=zfe[sL(r,e)];return t}var Bz=function(r,e,t){return r.length},Ffe=(bm={},bm[Ds+"_"+Ff]=function(r,e,t){return Math.max(0,r.length-e)},bm[Ds+"_"+gb]=function(r,e,t){var i=r[0];return i?Math.max(0,i.length-e):0},bm[Ic]=Bz,bm[Wf]=function(r,e,t){var i=t[0].name,n=r[i];return n?n.length:0},bm[Ec]=Bz,bm);function Z7(r,e){var t=Ffe[sL(r,e)];return t}var uI=function(r,e,t){return r[e]},Vfe=(xm={},xm[Ds]=uI,xm[Ic]=function(r,e,t){return r[t]},xm[Wf]=uI,xm[Ec]=function(r,e,t){var i=ab(r);return i instanceof Array?i[e]:i},xm[Bg]=uI,xm);function q7(r){var e=Vfe[r];return e}function sL(r,e){return r===Ds?r+"_"+e:r}function Z0(r,e,t){if(r){var i=r.getRawDataItem(e);if(i!=null){var n=r.getStore(),a=n.getSource().sourceFormat;if(t!=null){var s=r.getDimensionIndex(t),o=n.getDimensionProperty(s);return q7(a)(i,s,o)}else{var l=i;return a===Ec&&(l=ab(i)),l}}}}var Ufe=/\{@(.+?)\}/g,qC=(function(){function r(){}return r.prototype.getDataParams=function(e,t){var i=this.getData(t),n=this.getRawValue(e,t),a=i.getRawIndex(e),s=i.getName(e),o=i.getRawDataItem(e),l=i.getItemVisual(e,"style"),c=l&&l[i.getItemVisual(e,"drawType")||"fill"],f=l&&l.stroke,p=this.mainType,y=p==="series",b=i.userOutput&&i.userOutput.get();return{componentType:p,componentSubType:this.subType,componentIndex:this.componentIndex,seriesType:y?this.subType:null,seriesIndex:this.seriesIndex,seriesId:y?this.id:null,seriesName:y?this.name:null,name:s,dataIndex:a,data:o,dataType:t,value:n,color:c,borderColor:f,dimensionNames:b?b.fullDimensions:null,encode:b?b.encode:null,$vars:["seriesName","name","value"]}},r.prototype.getFormattedLabel=function(e,t,i,n,a,s){t=t||"normal";var o=this.getData(i),l=this.getDataParams(e,i);if(s&&(l.value=s.interpolatedValue),n!=null&&xt(l.value)&&(l.value=l.value[n]),!a){var c=o.getItemModel(e);a=c.get(t==="normal"?["label","formatter"]:[t,"label","formatter"])}if(sr(a))return l.status=t,l.dimensionIndex=n,a(l);if($t(a)){var f=Jk(a,l);return f.replace(Ufe,function(p,y){var b=y.length,S=y;S.charAt(0)==="["&&S.charAt(b-1)==="]"&&(S=+S.slice(1,b-1));var C=Z0(o,e,S);if(s&&xt(s.interpolatedValue)){var E=o.getDimensionIndex(S);E>=0&&(C=s.interpolatedValue[E])}return C!=null?C+"":""})}},r.prototype.getRawValue=function(e,t){return Z0(this.getData(t),e)},r.prototype.formatTooltip=function(e,t,i){},r})();function zz(r){var e,t;return cr(r)?r.type&&(t=r):e=r,{text:e,frag:t}}function X1(r){return new Hfe(r)}var Hfe=(function(){function r(e){e=e||{},this._reset=e.reset,this._plan=e.plan,this._count=e.count,this._onDirty=e.onDirty,this._dirty=!0}return r.prototype.perform=function(e){var t=this._upstream,i=e&&e.skip;if(this._dirty&&t){var n=this.context;n.data=n.outputData=t.context.outputData}this.__pipeline&&(this.__pipeline.currentTask=this);var a;this._plan&&!i&&(a=this._plan(this.context));var s=f(this._modBy),o=this._modDataCount||0,l=f(e&&e.modBy),c=e&&e.modDataCount||0;(s!==l||o!==c)&&(a="reset");function f(O){return!(O>=1)&&(O=1),O}var p;(this._dirty||a==="reset")&&(this._dirty=!1,p=this._doReset(i)),this._modBy=l,this._modDataCount=c;var y=e&&e.step;if(t?this._dueEnd=t._outputDueEnd:this._dueEnd=this._count?this._count(this.context):1/0,this._progress){var b=this._dueIndex,S=Math.min(y!=null?this._dueIndex+y:1/0,this._dueEnd);if(!i&&(p||b<S)){var C=this._progress;if(xt(C))for(var E=0;E<C.length;E++)this._doProgress(C[E],b,S,l,c);else this._doProgress(C,b,S,l,c)}this._dueIndex=S;var P=this._settedOutputEnd!=null?this._settedOutputEnd:S;this._outputDueEnd=P}else this._dueIndex=this._outputDueEnd=this._settedOutputEnd!=null?this._settedOutputEnd:this._dueEnd;return this.unfinished()},r.prototype.dirty=function(){this._dirty=!0,this._onDirty&&this._onDirty(this.context)},r.prototype._doProgress=function(e,t,i,n,a){Fz.reset(t,i,n,a),this._callingProgress=e,this._callingProgress({start:t,end:i,count:i-t,next:Fz.next},this.context)},r.prototype._doReset=function(e){this._dueIndex=this._outputDueEnd=this._dueEnd=0,this._settedOutputEnd=null;var t,i;!e&&this._reset&&(t=this._reset(this.context),t&&t.progress&&(i=t.forceFirstProgress,t=t.progress),xt(t)&&!t.length&&(t=null)),this._progress=t,this._modBy=this._modDataCount=null;var n=this._downstream;return n&&n.dirty(),i},r.prototype.unfinished=function(){return this._progress&&this._dueIndex<this._dueEnd},r.prototype.pipe=function(e){(this._downstream!==e||this._dirty)&&(this._downstream=e,e._upstream=this,e.dirty())},r.prototype.dispose=function(){this._disposed||(this._upstream&&(this._upstream._downstream=null),this._downstream&&(this._downstream._upstream=null),this._dirty=!1,this._disposed=!0)},r.prototype.getUpstream=function(){return this._upstream},r.prototype.getDownstream=function(){return this._downstream},r.prototype.setOutputEnd=function(e){this._outputDueEnd=this._settedOutputEnd=e},r})(),Fz=(function(){var r,e,t,i,n,a={reset:function(l,c,f,p){e=l,r=c,t=f,i=p,n=Math.ceil(i/t),a.next=t>1&&i>0?o:s}};return a;function s(){return e<r?e++:null}function o(){var l=e%n*t+Math.ceil(e/n),c=e>=r?null:l<i?l:e;return e++,c}})();function zg(r,e){var t=e&&e.type;return t==="ordinal"?r:(t==="time"&&!di(r)&&r!=null&&r!=="-"&&(r=+xu(r)),r==null||r===""?NaN:Number(r))}var jfe=Qt({number:function(r){return parseFloat(r)},time:function(r){return+xu(r)},trim:function(r){return $t(r)?mc(r):r}});function Y7(r){return jfe.get(r)}var K7={lt:function(r,e){return r<e},lte:function(r,e){return r<=e},gt:function(r,e){return r>e},gte:function(r,e){return r>=e}},$fe=(function(){function r(e,t){if(!di(t)){var i="";Pi(i)}this._opFn=K7[e],this._rvalFloat=Hf(t)}return r.prototype.evaluate=function(e){return di(e)?this._opFn(e,this._rvalFloat):this._opFn(Hf(e),this._rvalFloat)},r})(),Q7=(function(){function r(e,t){var i=e==="desc";this._resultLT=i?1:-1,t==null&&(t=i?"min":"max"),this._incomparable=t==="min"?-1/0:1/0}return r.prototype.evaluate=function(e,t){var i=di(e)?e:Hf(e),n=di(t)?t:Hf(t),a=isNaN(i),s=isNaN(n);if(a&&(i=this._incomparable),s&&(n=this._incomparable),a&&s){var o=$t(e),l=$t(t);o&&(i=l?e:0),l&&(n=o?t:0)}return i<n?this._resultLT:i>n?-this._resultLT:0},r})(),Wfe=(function(){function r(e,t){this._rval=t,this._isEQ=e,this._rvalTypeof=typeof t,this._rvalFloat=Hf(t)}return r.prototype.evaluate=function(e){var t=e===this._rval;if(!t){var i=typeof e;i!==this._rvalTypeof&&(i==="number"||this._rvalTypeof==="number")&&(t=Hf(e)===this._rvalFloat)}return this._isEQ?t:!t},r})();function Gfe(r,e){return r==="eq"||r==="ne"?new Wfe(r==="eq",e):Yt(K7,r)?new $fe(r,e):null}var Xfe=(function(){function r(){}return r.prototype.getRawData=function(){throw new Error("not supported")},r.prototype.getRawDataItem=function(e){throw new Error("not supported")},r.prototype.cloneRawData=function(){},r.prototype.getDimensionInfo=function(e){},r.prototype.cloneAllDimensionInfo=function(){},r.prototype.count=function(){},r.prototype.retrieveValue=function(e,t){},r.prototype.retrieveValueFromItem=function(e,t){},r.prototype.convertValue=function(e,t){return zg(e,t)},r})();function Zfe(r,e){var t=new Xfe,i=r.data,n=t.sourceFormat=r.sourceFormat,a=r.startIndex,s="";r.seriesLayoutBy!==Ff&&Pi(s);var o=[],l={},c=r.dimensionsDefine;if(c)se(c,function(C,E){var P=C.name,O={index:E,name:P,displayName:C.displayName};if(o.push(O),P!=null){var B="";Yt(l,P)&&Pi(B),l[P]=O}});else for(var f=0;f<r.dimensionsDetectedCount;f++)o.push({index:f});var p=X7(n,Ff);e.__isBuiltIn&&(t.getRawDataItem=function(C){return p(i,a,o,C)},t.getRawData=Xt(qfe,null,r)),t.cloneRawData=Xt(Yfe,null,r);var y=Z7(n,Ff);t.count=Xt(y,null,i,a,o);var b=q7(n);t.retrieveValue=function(C,E){var P=p(i,a,o,C);return S(P,E)};var S=t.retrieveValueFromItem=function(C,E){if(C!=null){var P=o[E];if(P)return b(C,E,P.name)}};return t.getDimensionInfo=Xt(Kfe,null,o,l),t.cloneAllDimensionInfo=Xt(Qfe,null,o),t}function qfe(r){var e=r.sourceFormat;if(!lL(e)){var t="";Pi(t)}return r.data}function Yfe(r){var e=r.sourceFormat,t=r.data;if(!lL(e)){var i="";Pi(i)}if(e===Ds){for(var n=[],a=0,s=t.length;a<s;a++)n.push(t[a].slice());return n}else if(e===Ic){for(var n=[],a=0,s=t.length;a<s;a++)n.push(mt({},t[a]));return n}}function Kfe(r,e,t){if(t!=null){if(di(t)||!isNaN(t)&&!Yt(e,t))return r[t];if(Yt(e,t))return e[t]}}function Qfe(r){return hr(r)}var J7=Qt();function Jfe(r){r=hr(r);var e=r.type,t="";e||Pi(t);var i=e.split(":");i.length!==2&&Pi(t);var n=!1;i[0]==="echarts"&&(e=i[1],n=!0),r.__isBuiltIn=n,J7.set(e,r)}function ede(r,e,t){var i=Gi(r),n=i.length,a="";n||Pi(a);for(var s=0,o=n;s<o;s++){var l=i[s];e=tde(l,e),s!==o-1&&(e.length=Math.max(e.length,1))}return e}function tde(r,e,t,i){var n="";e.length||Pi(n),cr(r)||Pi(n);var a=r.type,s=J7.get(a);s||Pi(n);var o=wt(e,function(c){return Zfe(c,s)}),l=Gi(s.transform({upstream:o[0],upstreamList:o,config:hr(r.config)}));return wt(l,function(c,f){var p="";cr(c)||Pi(p),c.data||Pi(p);var y=$7(c.data);lL(y)||Pi(p);var b,S=e[0];if(S&&f===0&&!c.dimensions){var C=S.startIndex;C&&(c.data=S.data.slice(0,C).concat(c.data)),b={seriesLayoutBy:Ff,sourceHeader:C,dimensions:S.metaRawOption.dimensions}}else b={seriesLayoutBy:Ff,sourceHeader:0,dimensions:c.dimensions};return h3(c.data,b,null)})}function lL(r){return r===Ds||r===Ic}var YC="undefined",rde=typeof Uint32Array===YC?Array:Uint32Array,ide=typeof Uint16Array===YC?Array:Uint16Array,e9=typeof Int32Array===YC?Array:Int32Array,Vz=typeof Float64Array===YC?Array:Float64Array,t9={float:Vz,int:e9,ordinal:Array,number:Array,time:Vz},cI;function G_(r){return r>65535?rde:ide}function X_(){return[1/0,-1/0]}function nde(r){var e=r.constructor;return e===Array?r.slice():new e(r)}function Uz(r,e,t,i,n){var a=t9[t||"float"];if(n){var s=r[e],o=s&&s.length;if(o!==i){for(var l=new a(i),c=0;c<o;c++)l[c]=s[c];r[e]=l}}else r[e]=new a(i)}var f3=(function(){function r(){this._chunks=[],this._rawExtent=[],this._extent=[],this._count=0,this._rawCount=0,this._calcDimNameToIdx=Qt()}return r.prototype.initData=function(e,t,i){this._provider=e,this._chunks=[],this._indices=null,this.getRawIndex=this._getRawIdxIdentity;var n=e.getSource(),a=this.defaultDimValueGetter=cI[n.sourceFormat];this._dimValueGetter=i||a,this._rawExtent=[],W7(n),this._dimensions=wt(t,function(s){return{type:s.type,property:s.property}}),this._initDataFromProvider(0,e.count())},r.prototype.getProvider=function(){return this._provider},r.prototype.getSource=function(){return this._provider.getSource()},r.prototype.ensureCalculationDimension=function(e,t){var i=this._calcDimNameToIdx,n=this._dimensions,a=i.get(e);if(a!=null){if(n[a].type===t)return a}else a=n.length;return n[a]={type:t},i.set(e,a),this._chunks[a]=new t9[t||"float"](this._rawCount),this._rawExtent[a]=X_(),a},r.prototype.collectOrdinalMeta=function(e,t){var i=this._chunks[e],n=this._dimensions[e],a=this._rawExtent,s=n.ordinalOffset||0,o=i.length;s===0&&(a[e]=X_());for(var l=a[e],c=s;c<o;c++){var f=i[c]=t.parseAndCollect(i[c]);isNaN(f)||(l[0]=Math.min(f,l[0]),l[1]=Math.max(f,l[1]))}n.ordinalMeta=t,n.ordinalOffset=o,n.type="ordinal"},r.prototype.getOrdinalMeta=function(e){var t=this._dimensions[e],i=t.ordinalMeta;return i},r.prototype.getDimensionProperty=function(e){var t=this._dimensions[e];return t&&t.property},r.prototype.appendData=function(e){var t=this._provider,i=this.count();t.appendData(e);var n=t.count();return t.persistent||(n+=i),i<n&&this._initDataFromProvider(i,n,!0),[i,n]},r.prototype.appendValues=function(e,t){for(var i=this._chunks,n=this._dimensions,a=n.length,s=this._rawExtent,o=this.count(),l=o+Math.max(e.length,t||0),c=0;c<a;c++){var f=n[c];Uz(i,c,f.type,l,!0)}for(var p=[],y=o;y<l;y++)for(var b=y-o,S=0;S<a;S++){var f=n[S],C=cI.arrayRows.call(this,e[b]||p,f.property,b,S);i[S][y]=C;var E=s[S];C<E[0]&&(E[0]=C),C>E[1]&&(E[1]=C)}return this._rawCount=this._count=l,{start:o,end:l}},r.prototype._initDataFromProvider=function(e,t,i){for(var n=this._provider,a=this._chunks,s=this._dimensions,o=s.length,l=this._rawExtent,c=wt(s,function(O){return O.property}),f=0;f<o;f++){var p=s[f];l[f]||(l[f]=X_()),Uz(a,f,p.type,t,i)}if(n.fillStorage)n.fillStorage(e,t,a,l);else for(var y=[],b=e;b<t;b++){y=n.getItem(b,y);for(var S=0;S<o;S++){var C=a[S],E=this._dimValueGetter(y,c[S],b,S);C[b]=E;var P=l[S];E<P[0]&&(P[0]=E),E>P[1]&&(P[1]=E)}}!n.persistent&&n.clean&&n.clean(),this._rawCount=this._count=t,this._extent=[]},r.prototype.count=function(){return this._count},r.prototype.get=function(e,t){if(!(t>=0&&t<this._count))return NaN;var i=this._chunks[e];return i?i[this.getRawIndex(t)]:NaN},r.prototype.getValues=function(e,t){var i=[],n=[];if(t==null){t=e,e=[];for(var a=0;a<this._dimensions.length;a++)n.push(a)}else n=e;for(var a=0,s=n.length;a<s;a++)i.push(this.get(n[a],t));return i},r.prototype.getByRawIndex=function(e,t){if(!(t>=0&&t<this._rawCount))return NaN;var i=this._chunks[e];return i?i[t]:NaN},r.prototype.getSum=function(e){var t=this._chunks[e],i=0;if(t)for(var n=0,a=this.count();n<a;n++){var s=this.get(e,n);isNaN(s)||(i+=s)}return i},r.prototype.getMedian=function(e){var t=[];this.each([e],function(a){isNaN(a)||t.push(a)});var i=t.sort(function(a,s){return a-s}),n=this.count();return n===0?0:n%2===1?i[(n-1)/2]:(i[n/2]+i[n/2-1])/2},r.prototype.indexOfRawIndex=function(e){if(e>=this._rawCount||e<0)return-1;if(!this._indices)return e;var t=this._indices,i=t[e];if(i!=null&&i<this._count&&i===e)return e;for(var n=0,a=this._count-1;n<=a;){var s=(n+a)/2|0;if(t[s]<e)n=s+1;else if(t[s]>e)a=s-1;else return s}return-1},r.prototype.indicesOfNearest=function(e,t,i){var n=this._chunks,a=n[e],s=[];if(!a)return s;i==null&&(i=1/0);for(var o=1/0,l=-1,c=0,f=0,p=this.count();f<p;f++){var y=this.getRawIndex(f),b=t-a[y],S=Math.abs(b);S<=i&&((S<o||S===o&&b>=0&&l<0)&&(o=S,l=b,c=0),b===l&&(s[c++]=f))}return s.length=c,s},r.prototype.getIndices=function(){var e,t=this._indices;if(t){var i=t.constructor,n=this._count;if(i===Array){e=new i(n);for(var a=0;a<n;a++)e[a]=t[a]}else e=new i(t.buffer,0,n)}else{var i=G_(this._rawCount);e=new i(this.count());for(var a=0;a<e.length;a++)e[a]=a}return e},r.prototype.filter=function(e,t){if(!this._count)return this;for(var i=this.clone(),n=i.count(),a=G_(i._rawCount),s=new a(n),o=[],l=e.length,c=0,f=e[0],p=i._chunks,y=0;y<n;y++){var b=void 0,S=i.getRawIndex(y);if(l===0)b=t(y);else if(l===1){var C=p[f][S];b=t(C,y)}else{for(var E=0;E<l;E++)o[E]=p[e[E]][S];o[E]=y,b=t.apply(null,o)}b&&(s[c++]=S)}return c<n&&(i._indices=s),i._count=c,i._extent=[],i._updateGetRawIdx(),i},r.prototype.selectRange=function(e){var t=this.clone(),i=t._count;if(!i)return this;var n=qr(e),a=n.length;if(!a)return this;var s=t.count(),o=G_(t._rawCount),l=new o(s),c=0,f=n[0],p=e[f][0],y=e[f][1],b=t._chunks,S=!1;if(!t._indices){var C=0;if(a===1){for(var E=b[n[0]],P=0;P<i;P++){var O=E[P];(O>=p&&O<=y||isNaN(O))&&(l[c++]=C),C++}S=!0}else if(a===2){for(var E=b[n[0]],B=b[n[1]],F=e[n[1]][0],W=e[n[1]][1],P=0;P<i;P++){var O=E[P],$=B[P];(O>=p&&O<=y||isNaN(O))&&($>=F&&$<=W||isNaN($))&&(l[c++]=C),C++}S=!0}}if(!S)if(a===1)for(var P=0;P<s;P++){var q=t.getRawIndex(P),O=b[n[0]][q];(O>=p&&O<=y||isNaN(O))&&(l[c++]=q)}else for(var P=0;P<s;P++){for(var Q=!0,q=t.getRawIndex(P),ee=0;ee<a;ee++){var te=n[ee],O=b[te][q];(O<e[te][0]||O>e[te][1])&&(Q=!1)}Q&&(l[c++]=t.getRawIndex(P))}return c<s&&(t._indices=l),t._count=c,t._extent=[],t._updateGetRawIdx(),t},r.prototype.map=function(e,t){var i=this.clone(e);return this._updateDims(i,e,t),i},r.prototype.modify=function(e,t){this._updateDims(this,e,t)},r.prototype._updateDims=function(e,t,i){for(var n=e._chunks,a=[],s=t.length,o=e.count(),l=[],c=e._rawExtent,f=0;f<t.length;f++)c[t[f]]=X_();for(var p=0;p<o;p++){for(var y=e.getRawIndex(p),b=0;b<s;b++)l[b]=n[t[b]][y];l[s]=p;var S=i&&i.apply(null,l);if(S!=null){typeof S!="object"&&(a[0]=S,S=a);for(var f=0;f<S.length;f++){var C=t[f],E=S[f],P=c[C],O=n[C];O&&(O[y]=E),E<P[0]&&(P[0]=E),E>P[1]&&(P[1]=E)}}}},r.prototype.lttbDownSample=function(e,t){var i=this.clone([e],!0),n=i._chunks,a=n[e],s=this.count(),o=0,l=Math.floor(1/t),c=this.getRawIndex(0),f,p,y,b=new(G_(this._rawCount))(Math.min((Math.ceil(s/l)+2)*2,s));b[o++]=c;for(var S=1;S<s-1;S+=l){for(var C=Math.min(S+l,s-1),E=Math.min(S+l*2,s),P=(E+C)/2,O=0,B=C;B<E;B++){var F=this.getRawIndex(B),W=a[F];isNaN(W)||(O+=W)}O/=E-C;var $=S,q=Math.min(S+l,s),Q=S-1,ee=a[c];f=-1,y=$;for(var te=-1,ae=0,B=$;B<q;B++){var F=this.getRawIndex(B),W=a[F];if(isNaN(W)){ae++,te<0&&(te=F);continue}p=Math.abs((Q-P)*(W-ee)-(Q-B)*(O-ee)),p>f&&(f=p,y=F)}ae>0&&ae<q-$&&(b[o++]=Math.min(te,y),y=Math.max(te,y)),b[o++]=y,c=y}return b[o++]=this.getRawIndex(s-1),i._count=o,i._indices=b,i.getRawIndex=this._getRawIdx,i},r.prototype.minmaxDownSample=function(e,t){for(var i=this.clone([e],!0),n=i._chunks,a=Math.floor(1/t),s=n[e],o=this.count(),l=new(G_(this._rawCount))(Math.ceil(o/a)*2),c=0,f=0;f<o;f+=a){var p=f,y=s[this.getRawIndex(p)],b=f,S=s[this.getRawIndex(b)],C=a;f+a>o&&(C=o-f);for(var E=0;E<C;E++){var P=this.getRawIndex(f+E),O=s[P];O<y&&(y=O,p=f+E),O>S&&(S=O,b=f+E)}var B=this.getRawIndex(p),F=this.getRawIndex(b);p<b?(l[c++]=B,l[c++]=F):(l[c++]=F,l[c++]=B)}return i._count=c,i._indices=l,i._updateGetRawIdx(),i},r.prototype.downSample=function(e,t,i,n){for(var a=this.clone([e],!0),s=a._chunks,o=[],l=Math.floor(1/t),c=s[e],f=this.count(),p=a._rawExtent[e]=X_(),y=new(G_(this._rawCount))(Math.ceil(f/l)),b=0,S=0;S<f;S+=l){l>f-S&&(l=f-S,o.length=l);for(var C=0;C<l;C++){var E=this.getRawIndex(S+C);o[C]=c[E]}var P=i(o),O=this.getRawIndex(Math.min(S+n(o,P)||0,f-1));c[O]=P,P<p[0]&&(p[0]=P),P>p[1]&&(p[1]=P),y[b++]=O}return a._count=b,a._indices=y,a._updateGetRawIdx(),a},r.prototype.each=function(e,t){if(this._count)for(var i=e.length,n=this._chunks,a=0,s=this.count();a<s;a++){var o=this.getRawIndex(a);switch(i){case 0:t(a);break;case 1:t(n[e[0]][o],a);break;case 2:t(n[e[0]][o],n[e[1]][o],a);break;default:for(var l=0,c=[];l<i;l++)c[l]=n[e[l]][o];c[l]=a,t.apply(null,c)}}},r.prototype.getDataExtent=function(e){var t=this._chunks[e],i=X_();if(!t)return i;var n=this.count(),a=!this._indices,s;if(a)return this._rawExtent[e].slice();if(s=this._extent[e],s)return s.slice();s=i;for(var o=s[0],l=s[1],c=0;c<n;c++){var f=this.getRawIndex(c),p=t[f];p<o&&(o=p),p>l&&(l=p)}return s=[o,l],this._extent[e]=s,s},r.prototype.getRawDataItem=function(e){var t=this.getRawIndex(e);if(this._provider.persistent)return this._provider.getItem(t);for(var i=[],n=this._chunks,a=0;a<n.length;a++)i.push(n[a][t]);return i},r.prototype.clone=function(e,t){var i=new r,n=this._chunks,a=e&&Sc(e,function(o,l){return o[l]=!0,o},{});if(a)for(var s=0;s<n.length;s++)i._chunks[s]=a[s]?nde(n[s]):n[s];else i._chunks=n;return this._copyCommonProps(i),t||(i._indices=this._cloneIndices()),i._updateGetRawIdx(),i},r.prototype._copyCommonProps=function(e){e._count=this._count,e._rawCount=this._rawCount,e._provider=this._provider,e._dimensions=this._dimensions,e._extent=hr(this._extent),e._rawExtent=hr(this._rawExtent)},r.prototype._cloneIndices=function(){if(this._indices){var e=this._indices.constructor,t=void 0;if(e===Array){var i=this._indices.length;t=new e(i);for(var n=0;n<i;n++)t[n]=this._indices[n]}else t=new e(this._indices);return t}return null},r.prototype._getRawIdxIdentity=function(e){return e},r.prototype._getRawIdx=function(e){return e<this._count&&e>=0?this._indices[e]:-1},r.prototype._updateGetRawIdx=function(){this.getRawIndex=this._indices?this._getRawIdx:this._getRawIdxIdentity},r.internalField=(function(){function e(t,i,n,a){return zg(t[a],this._dimensions[a])}cI={arrayRows:e,objectRows:function(t,i,n,a){return zg(t[i],this._dimensions[a])},keyedColumns:e,original:function(t,i,n,a){var s=t&&(t.value==null?t:t.value);return zg(s instanceof Array?s[a]:s,this._dimensions[a])},typedArray:function(t,i,n,a){return t[a]}}})(),r})(),r9=(function(){function r(e){this._sourceList=[],this._storeList=[],this._upstreamSignList=[],this._versionSignBase=0,this._dirty=!0,this._sourceHost=e}return r.prototype.dirty=function(){this._setLocalSource([],[]),this._storeList=[],this._dirty=!0},r.prototype._setLocalSource=function(e,t){this._sourceList=e,this._upstreamSignList=t,this._versionSignBase++,this._versionSignBase>9e10&&(this._versionSignBase=0)},r.prototype._getVersionSign=function(){return this._sourceHost.uid+"_"+this._versionSignBase},r.prototype.prepareSource=function(){this._isDirty()&&(this._createSource(),this._dirty=!1)},r.prototype._createSource=function(){this._setLocalSource([],[]);var e=this._sourceHost,t=this._getUpstreamSourceManagers(),i=!!t.length,n,a;if(OT(e)){var s=e,o=void 0,l=void 0,c=void 0;if(i){var f=t[0];f.prepareSource(),c=f.getSource(),o=c.data,l=c.sourceFormat,a=[f._getVersionSign()]}else o=s.get("data",!0),l=sl(o)?Bg:Ec,a=[];var p=this._getSourceMetaRawOption()||{},y=c&&c.metaRawOption||{},b=wr(p.seriesLayoutBy,y.seriesLayoutBy)||null,S=wr(p.sourceHeader,y.sourceHeader),C=wr(p.dimensions,y.dimensions),E=b!==y.seriesLayoutBy||!!S!=!!y.sourceHeader||C;n=E?[h3(o,{seriesLayoutBy:b,sourceHeader:S,dimensions:C},l)]:[]}else{var P=e;if(i){var O=this._applyTransform(t);n=O.sourceList,a=O.upstreamSignList}else{var B=P.get("source",!0);n=[h3(B,this._getSourceMetaRawOption(),null)],a=[]}}this._setLocalSource(n,a)},r.prototype._applyTransform=function(e){var t=this._sourceHost,i=t.get("transform",!0),n=t.get("fromTransformResult",!0);if(n!=null){var a="";e.length!==1&&jz(a)}var s,o=[],l=[];return se(e,function(c){c.prepareSource();var f=c.getSource(n||0),p="";n!=null&&!f&&jz(p),o.push(f),l.push(c._getVersionSign())}),i?s=ede(i,o,{datasetIndex:t.componentIndex}):n!=null&&(s=[Ofe(o[0])]),{sourceList:s,upstreamSignList:l}},r.prototype._isDirty=function(){if(this._dirty)return!0;for(var e=this._getUpstreamSourceManagers(),t=0;t<e.length;t++){var i=e[t];if(i._isDirty()||this._upstreamSignList[t]!==i._getVersionSign())return!0}},r.prototype.getSource=function(e){e=e||0;var t=this._sourceList[e];if(!t){var i=this._getUpstreamSourceManagers();return i[0]&&i[0].getSource(e)}return t},r.prototype.getSharedDataStore=function(e){var t=e.makeStoreSchema();return this._innerGetDataStore(t.dimensions,e.source,t.hash)},r.prototype._innerGetDataStore=function(e,t,i){var n=0,a=this._storeList,s=a[n];s||(s=a[n]={});var o=s[i];if(!o){var l=this._getUpstreamSourceManagers()[0];OT(this._sourceHost)&&l?o=l._innerGetDataStore(e,t,i):(o=new f3,o.initData(new G7(t,e.length),e)),s[i]=o}return o},r.prototype._getUpstreamSourceManagers=function(){var e=this._sourceHost;if(OT(e)){var t=rL(e);return t?[t.getSourceManager()]:[]}else return wt(cfe(e),function(i){return i.getSourceManager()})},r.prototype._getSourceMetaRawOption=function(){var e=this._sourceHost,t,i,n;if(OT(e))t=e.get("seriesLayoutBy",!0),i=e.get("sourceHeader",!0),n=e.get("dimensions",!0);else if(!this._getUpstreamSourceManagers().length){var a=e;t=a.get("seriesLayoutBy",!0),i=a.get("sourceHeader",!0),n=a.get("dimensions",!0)}return{seriesLayoutBy:t,sourceHeader:i,dimensions:n}},r})();function Hz(r){var e=r.option.transform;e&&ow(r.option.transform)}function OT(r){return r.mainType==="series"}function jz(r){throw new Error(r)}var ade="line-height:1";function i9(r){var e=r.lineHeight;return e==null?ade:"line-height:"+Ms(e+"")+"px"}function n9(r,e){var t=r.color||"#6e7079",i=r.fontSize||12,n=r.fontWeight||"400",a=r.color||"#464646",s=r.fontSize||14,o=r.fontWeight||"900";return e==="html"?{nameStyle:"font-size:"+Ms(i+"")+"px;color:"+Ms(t)+";font-weight:"+Ms(n+""),valueStyle:"font-size:"+Ms(s+"")+"px;color:"+Ms(a)+";font-weight:"+Ms(o+"")}:{nameStyle:{fontSize:i,fill:t,fontWeight:n},valueStyle:{fontSize:s,fill:a,fontWeight:o}}}var ode=[0,10,20,30],sde=["",`
`,`

`,`


`];function po(r,e){return e.type=r,e}function d3(r){return r.type==="section"}function a9(r){return d3(r)?lde:ude}function o9(r){if(d3(r)){var e=0,t=r.blocks.length,i=t>1||t>0&&!r.noHeader;return se(r.blocks,function(n){var a=o9(n);a>=e&&(e=a+ +(i&&(!a||d3(n)&&!n.noHeader)))}),e}return 0}function lde(r,e,t,i){var n=e.noHeader,a=cde(o9(e)),s=[],o=e.blocks||[];Is(!o||xt(o)),o=o||[];var l=r.orderMode;if(e.sortBlocks&&l){o=o.slice();var c={valueAsc:"asc",valueDesc:"desc"};if(Yt(c,l)){var f=new Q7(c[l],null);o.sort(function(C,E){return f.evaluate(C.sortParam,E.sortParam)})}else l==="seriesDesc"&&o.reverse()}se(o,function(C,E){var P=e.valueFormatter,O=a9(C)(P?mt(mt({},r),{valueFormatter:P}):r,C,E>0?a.html:0,i);O!=null&&s.push(O)});var p=r.renderMode==="richText"?s.join(a.richText):p3(i,s.join(""),n?t:a.html);if(n)return p;var y=l3(e.header,"ordinal",r.useUTC),b=n9(i,r.renderMode).nameStyle,S=i9(i);return r.renderMode==="richText"?s9(r,y,b)+a.richText+p:p3(i,'<div style="'+b+";"+S+';">'+Ms(y)+"</div>"+p,t)}function ude(r,e,t,i){var n=r.renderMode,a=e.noName,s=e.noValue,o=!e.markerType,l=e.name,c=r.useUTC,f=e.valueFormatter||r.valueFormatter||function(F){return F=xt(F)?F:[F],wt(F,function(W,$){return l3(W,xt(b)?b[$]:b,c)})};if(!(a&&s)){var p=o?"":r.markupStyleCreator.makeTooltipMarker(e.markerType,e.markerColor||"#333",n),y=a?"":l3(l,"ordinal",c),b=e.valueType,S=s?[]:f(e.value,e.dataIndex),C=!o||!a,E=!o&&a,P=n9(i,n),O=P.nameStyle,B=P.valueStyle;return n==="richText"?(o?"":p)+(a?"":s9(r,y,O))+(s?"":dde(r,S,C,E,B)):p3(i,(o?"":p)+(a?"":hde(y,!o,O))+(s?"":fde(S,C,E,B)),t)}}function $z(r,e,t,i,n,a){if(r){var s=a9(r),o={useUTC:n,renderMode:t,orderMode:i,markupStyleCreator:e,valueFormatter:r.valueFormatter};return s(o,r,0,a)}}function cde(r){return{html:ode[r],richText:sde[r]}}function p3(r,e,t){var i='<div style="clear:both"></div>',n="margin: "+t+"px 0 0",a=i9(r);return'<div style="'+n+";"+a+';">'+e+i+"</div>"}function hde(r,e,t){var i=e?"margin-left:2px":"";return'<span style="'+t+";"+i+'">'+Ms(r)+"</span>"}function fde(r,e,t,i){var n=t?"10px":"20px",a=e?"float:right;margin-left:"+n:"";return r=xt(r)?r:[r],'<span style="'+a+";"+i+'">'+wt(r,function(s){return Ms(s)}).join("&nbsp;&nbsp;")+"</span>"}function s9(r,e,t){return r.markupStyleCreator.wrapRichTextStyle(e,t)}function dde(r,e,t,i,n){var a=[n],s=i?10:20;return t&&a.push({padding:[0,0,0,s],align:"right"}),r.markupStyleCreator.wrapRichTextStyle(xt(e)?e.join("  "):e,a)}function l9(r,e){var t=r.getData().getItemVisual(e,"style"),i=t[r.visualDrawType];return by(i)}function u9(r,e){var t=r.get("padding");return t??(e==="richText"?[8,10]:10)}var hI=(function(){function r(){this.richTextStyles={},this._nextStyleNameId=C$()}return r.prototype._generateStyleName=function(){return"__EC_aUTo_"+this._nextStyleNameId++},r.prototype.makeTooltipMarker=function(e,t,i){var n=i==="richText"?this._generateStyleName():null,a=P7({color:t,type:e,renderMode:i,markerId:n});return $t(a)?a:(this.richTextStyles[n]=a.style,a.content)},r.prototype.wrapRichTextStyle=function(e,t){var i={};xt(t)?se(t,function(a){return mt(i,a)}):mt(i,t);var n=this._generateStyleName();return this.richTextStyles[n]=i,"{"+n+"|"+e+"}"},r})();function c9(r){var e=r.series,t=r.dataIndex,i=r.multipleSeries,n=e.getData(),a=n.mapDimensionsAll("defaultedTooltip"),s=a.length,o=e.getRawValue(t),l=xt(o),c=l9(e,t),f,p,y,b;if(s>1||l&&!s){var S=pde(o,e,t,a,c);f=S.inlineValues,p=S.inlineValueTypes,y=S.blocks,b=S.inlineValues[0]}else if(s){var C=n.getDimensionInfo(a[0]);b=f=Z0(n,t,a[0]),p=C.type}else b=f=l?o[0]:o;var E=Ek(e),P=E&&e.name||"",O=n.getName(t),B=i?P:O;return po("section",{header:P,noHeader:i||!E,sortParam:b,blocks:[po("nameValue",{markerType:"item",markerColor:c,name:B,noName:!mc(B),value:f,valueType:p,dataIndex:t})].concat(y||[])})}function pde(r,e,t,i,n){var a=e.getData(),s=Sc(r,function(p,y,b){var S=a.getDimensionInfo(b);return p=p||S&&S.tooltip!==!1&&S.displayName!=null},!1),o=[],l=[],c=[];i.length?se(i,function(p){f(Z0(a,t,p),p)}):se(r,f);function f(p,y){var b=a.getDimensionInfo(y);!b||b.otherDims.tooltip===!1||(s?c.push(po("nameValue",{markerType:"subItem",markerColor:n,name:b.displayName,value:p,valueType:b.type})):(o.push(p),l.push(b.type)))}return{inlineValues:o,inlineValueTypes:l,blocks:c}}var cg=fi();function NT(r,e){return r.getName(e)||r.getId(e)}var V2="__universalTransitionEnabled",Xi=(function(r){Ye(e,r);function e(){var t=r!==null&&r.apply(this,arguments)||this;return t._selectedDataIndicesMap={},t}return e.prototype.init=function(t,i,n){this.seriesIndex=this.componentIndex,this.dataTask=X1({count:vde,reset:mde}),this.dataTask.context={model:this},this.mergeDefaultAndTheme(t,n);var a=cg(this).sourceManager=new r9(this);a.prepareSource();var s=this.getInitialData(t,n);Gz(s,this),this.dataTask.context.data=s,cg(this).dataBeforeProcessed=s,Wz(this),this._initSelectedMapFromData(s)},e.prototype.mergeDefaultAndTheme=function(t,i){var n=yw(this),a=n?pb(t):{},s=this.subType;Wr.hasClass(s)&&(s+="Series"),Cr(t,i.getTheme().get(this.subType)),Cr(t,this.getDefaultOption()),vy(t,"label",["show"]),this.fillDataTextStyle(t.data),n&&$g(t,a,n)},e.prototype.mergeOption=function(t,i){t=Cr(this.option,t,!0),this.fillDataTextStyle(t.data);var n=yw(this);n&&$g(this.option,t,n);var a=cg(this).sourceManager;a.dirty(),a.prepareSource();var s=this.getInitialData(t,i);Gz(s,this),this.dataTask.dirty(),this.dataTask.context.data=s,cg(this).dataBeforeProcessed=s,Wz(this),this._initSelectedMapFromData(s)},e.prototype.fillDataTextStyle=function(t){if(t&&!sl(t))for(var i=["show"],n=0;n<t.length;n++)t[n]&&t[n].label&&vy(t[n],"label",i)},e.prototype.getInitialData=function(t,i){},e.prototype.appendData=function(t){var i=this.getRawData();i.appendData(t.data)},e.prototype.getData=function(t){var i=g3(this);if(i){var n=i.context.data;return t==null||!n.getLinkedData?n:n.getLinkedData(t)}else return cg(this).data},e.prototype.getAllData=function(){var t=this.getData();return t&&t.getLinkedDataAll?t.getLinkedDataAll():[{data:t}]},e.prototype.setData=function(t){var i=g3(this);if(i){var n=i.context;n.outputData=t,i!==this.dataTask&&(n.data=t)}cg(this).data=t},e.prototype.getEncode=function(){var t=this.get("encode",!0);if(t)return Qt(t)},e.prototype.getSourceManager=function(){return cg(this).sourceManager},e.prototype.getSource=function(){return this.getSourceManager().getSource()},e.prototype.getRawData=function(){return cg(this).dataBeforeProcessed},e.prototype.getColorBy=function(){var t=this.get("colorBy");return t||"series"},e.prototype.isColorBySeries=function(){return this.getColorBy()==="series"},e.prototype.getBaseAxis=function(){var t=this.coordinateSystem;return t&&t.getBaseAxis&&t.getBaseAxis()},e.prototype.formatTooltip=function(t,i,n){return c9({series:this,dataIndex:t,multipleSeries:i})},e.prototype.isAnimationEnabled=function(){var t=this.ecModel;if(Gr.node&&!(t&&t.ssr))return!1;var i=this.getShallow("animation");return i&&this.getData().count()>this.getShallow("animationThreshold")&&(i=!1),!!i},e.prototype.restoreData=function(){this.dataTask.dirty()},e.prototype.getColorFromPalette=function(t,i,n){var a=this.ecModel,s=iL.prototype.getColorFromPalette.call(this,t,i,n);return s||(s=a.getColorFromPalette(t,i,n)),s},e.prototype.coordDimToDataDim=function(t){return this.getRawData().mapDimensionsAll(t)},e.prototype.getProgressive=function(){return this.get("progressive")},e.prototype.getProgressiveThreshold=function(){return this.get("progressiveThreshold")},e.prototype.select=function(t,i){this._innerSelect(this.getData(i),t)},e.prototype.unselect=function(t,i){var n=this.option.selectedMap;if(n){var a=this.option.selectedMode,s=this.getData(i);if(a==="series"||n==="all"){this.option.selectedMap={},this._selectedDataIndicesMap={};return}for(var o=0;o<t.length;o++){var l=t[o],c=NT(s,l);n[c]=!1,this._selectedDataIndicesMap[c]=-1}}},e.prototype.toggleSelect=function(t,i){for(var n=[],a=0;a<t.length;a++)n[0]=t[a],this.isSelected(t[a],i)?this.unselect(n,i):this.select(n,i)},e.prototype.getSelectedDataIndices=function(){if(this.option.selectedMap==="all")return[].slice.call(this.getData().getIndices());for(var t=this._selectedDataIndicesMap,i=qr(t),n=[],a=0;a<i.length;a++){var s=t[i[a]];s>=0&&n.push(s)}return n},e.prototype.isSelected=function(t,i){var n=this.option.selectedMap;if(!n)return!1;var a=this.getData(i);return(n==="all"||n[NT(a,t)])&&!a.getItemModel(t).get(["select","disabled"])},e.prototype.isUniversalTransitionEnabled=function(){if(this[V2])return!0;var t=this.option.universalTransition;return t?t===!0?!0:t&&t.enabled:!1},e.prototype._innerSelect=function(t,i){var n,a,s=this.option,o=s.selectedMode,l=i.length;if(!(!o||!l)){if(o==="series")s.selectedMap="all";else if(o==="multiple"){cr(s.selectedMap)||(s.selectedMap={});for(var c=s.selectedMap,f=0;f<l;f++){var p=i[f],y=NT(t,p);c[y]=!0,this._selectedDataIndicesMap[y]=t.getRawIndex(p)}}else if(o==="single"||o===!0){var b=i[l-1],y=NT(t,b);s.selectedMap=(n={},n[y]=!0,n),this._selectedDataIndicesMap=(a={},a[y]=t.getRawIndex(b),a)}}},e.prototype._initSelectedMapFromData=function(t){if(!this.option.selectedMap){var i=[];t.hasItemOption&&t.each(function(n){var a=t.getRawDataItem(n);a&&a.selected&&i.push(n)}),i.length>0&&this._innerSelect(t,i)}},e.registerClass=function(t){return Wr.registerClass(t)},e.protoInitialize=(function(){var t=e.prototype;t.type="series.__base__",t.seriesIndex=0,t.ignoreStyleOnData=!1,t.hasSymbolVisual=!1,t.defaultSymbol="circle",t.visualStyleAccessPath="itemStyle",t.visualDrawType="fill"})(),e})(Wr);ha(Xi,qC);ha(Xi,iL);O$(Xi,Wr);function Wz(r){var e=r.name;Ek(r)||(r.name=gde(r)||e)}function gde(r){var e=r.getRawData(),t=e.mapDimensionsAll("seriesName"),i=[];return se(t,function(n){var a=e.getDimensionInfo(n);a.displayName&&i.push(a.displayName)}),i.join(" ")}function vde(r){return r.model.getRawData().count()}function mde(r){var e=r.model;return e.setData(e.getRawData().cloneShallow()),yde}function yde(r,e){e.outputData&&r.end>e.outputData.count()&&e.model.getRawData().cloneShallow(e.outputData)}function Gz(r,e){se($0(r.CHANGABLE_METHODS,r.DOWNSAMPLE_METHODS),function(t){r.wrapMethod(t,Sr(_de,e))})}function _de(r,e){var t=g3(r);return t&&t.setOutputEnd((e||this).count()),e}function g3(r){var e=(r.ecModel||{}).scheduler,t=e&&e.getPipeline(r.uid);if(t){var i=t.currentTask;if(i){var n=i.agentStubMap;n&&(i=n.get(r.uid))}return i}}var vn=(function(){function r(){this.group=new mr,this.uid=db("viewComponent")}return r.prototype.init=function(e,t){},r.prototype.render=function(e,t,i,n){},r.prototype.dispose=function(e,t){},r.prototype.updateView=function(e,t,i,n){},r.prototype.updateLayout=function(e,t,i,n){},r.prototype.updateVisual=function(e,t,i,n){},r.prototype.toggleBlurSeries=function(e,t,i){},r.prototype.eachRendered=function(e){var t=this.group;t&&t.traverse(e)},r})();Pk(vn);kC(vn);function mb(){var r=fi();return function(e){var t=r(e),i=e.pipelineContext,n=!!t.large,a=!!t.progressiveRender,s=t.large=!!(i&&i.large),o=t.progressiveRender=!!(i&&i.progressiveRender);return(n!==s||a!==o)&&"reset"}}var h9=fi(),bde=mb(),Fi=(function(){function r(){this.group=new mr,this.uid=db("viewChart"),this.renderTask=X1({plan:xde,reset:wde}),this.renderTask.context={view:this}}return r.prototype.init=function(e,t){},r.prototype.render=function(e,t,i,n){},r.prototype.highlight=function(e,t,i,n){var a=e.getData(n&&n.dataType);a&&Zz(a,n,"emphasis")},r.prototype.downplay=function(e,t,i,n){var a=e.getData(n&&n.dataType);a&&Zz(a,n,"normal")},r.prototype.remove=function(e,t){this.group.removeAll()},r.prototype.dispose=function(e,t){},r.prototype.updateView=function(e,t,i,n){this.render(e,t,i,n)},r.prototype.updateLayout=function(e,t,i,n){this.render(e,t,i,n)},r.prototype.updateVisual=function(e,t,i,n){this.render(e,t,i,n)},r.prototype.eachRendered=function(e){qg(this.group,e)},r.markUpdateMethod=function(e,t){h9(e).updateMethod=t},r.protoInitialize=(function(){var e=r.prototype;e.type="chart"})(),r})();function Xz(r,e,t){r&&gw(r)&&(e==="emphasis"?cp:hp)(r,t)}function Zz(r,e,t){var i=my(r,e),n=e&&e.highlightKey!=null?ahe(e.highlightKey):null;i!=null?se(Gi(i),function(a){Xz(r.getItemGraphicEl(a),t,n)}):r.eachItemGraphicEl(function(a){Xz(a,t,n)})}Pk(Fi);kC(Fi);function xde(r){return bde(r.model)}function wde(r){var e=r.model,t=r.ecModel,i=r.api,n=r.payload,a=e.pipelineContext.progressiveRender,s=r.view,o=n&&h9(n).updateMethod,l=a?"incrementalPrepareRender":o&&s[o]?o:"render";return l!=="render"&&s[l](e,t,i,n),Sde[l]}var Sde={incrementalPrepareRender:{progress:function(r,e){e.view.incrementalRender(r,e.model,e.ecModel,e.api,e.payload)}},render:{forceFirstProgress:!0,progress:function(r,e){e.view.render(e.model,e.ecModel,e.api,e.payload)}}},kA="\0__throttleOriginMethod",qz="\0__throttleRate",Yz="\0__throttleType";function KC(r,e,t){var i,n=0,a=0,s=null,o,l,c,f;e=e||0;function p(){a=new Date().getTime(),s=null,r.apply(l,c||[])}var y=function(){for(var b=[],S=0;S<arguments.length;S++)b[S]=arguments[S];i=new Date().getTime(),l=this,c=b;var C=f||e,E=f||t;f=null,o=i-(E?n:a)-C,clearTimeout(s),E?s=setTimeout(p,C):o>=0?p():s=setTimeout(p,-o),n=i};return y.clear=function(){s&&(clearTimeout(s),s=null)},y.debounceNextCall=function(b){f=b},y}function yb(r,e,t,i){var n=r[e];if(n){var a=n[kA]||n,s=n[Yz],o=n[qz];if(o!==t||s!==i){if(t==null||!i)return r[e]=a;n=r[e]=KC(a,t,i==="debounce"),n[kA]=a,n[Yz]=i,n[qz]=t}return n}}function bw(r,e){var t=r[e];t&&t[kA]&&(t.clear&&t.clear(),r[e]=t[kA])}var Kz=fi(),Qz={itemStyle:yy(b7,!0),lineStyle:yy(_7,!0)},Tde={lineStyle:"stroke",itemStyle:"fill"};function f9(r,e){var t=r.visualStyleMapper||Qz[e];return t||(console.warn("Unknown style type '"+e+"'."),Qz.itemStyle)}function d9(r,e){var t=r.visualDrawType||Tde[e];return t||(console.warn("Unknown style type '"+e+"'."),"fill")}var Ade={createOnAllSeries:!0,performRawSeries:!0,reset:function(r,e){var t=r.getData(),i=r.visualStyleAccessPath||"itemStyle",n=r.getModel(i),a=f9(r,i),s=a(n),o=n.getShallow("decal");o&&(t.setVisual("decal",o),o.dirty=!0);var l=d9(r,i),c=s[l],f=sr(c)?c:null,p=s.fill==="auto"||s.stroke==="auto";if(!s[l]||f||p){var y=r.getColorFromPalette(r.name,null,e.getSeriesCount());s[l]||(s[l]=y,t.setVisual("colorFromPalette",!0)),s.fill=s.fill==="auto"||sr(s.fill)?y:s.fill,s.stroke=s.stroke==="auto"||sr(s.stroke)?y:s.stroke}if(t.setVisual("style",s),t.setVisual("drawType",l),!e.isSeriesFiltered(r)&&f)return t.setVisual("colorFromPalette",!1),{dataEach:function(b,S){var C=r.getDataParams(S),E=mt({},s);E[l]=f(C),b.setItemVisual(S,"style",E)}}}},Ux=new Si,Cde={createOnAllSeries:!0,performRawSeries:!0,reset:function(r,e){if(!(r.ignoreStyleOnData||e.isSeriesFiltered(r))){var t=r.getData(),i=r.visualStyleAccessPath||"itemStyle",n=f9(r,i),a=t.getVisual("drawType");return{dataEach:t.hasItemOption?function(s,o){var l=s.getRawDataItem(o);if(l&&l[i]){Ux.option=l[i];var c=n(Ux),f=s.ensureUniqueItemVisual(o,"style");mt(f,c),Ux.option.decal&&(s.setItemVisual(o,"decal",Ux.option.decal),Ux.option.decal.dirty=!0),a in c&&s.setItemVisual(o,"colorFromPalette",!1)}}:null}}}},Mde={performRawSeries:!0,overallReset:function(r){var e=Qt();r.eachSeries(function(t){var i=t.getColorBy();if(!t.isColorBySeries()){var n=t.type+"-"+i,a=e.get(n);a||(a={},e.set(n,a)),Kz(t).scope=a}}),r.eachSeries(function(t){if(!(t.isColorBySeries()||r.isSeriesFiltered(t))){var i=t.getRawData(),n={},a=t.getData(),s=Kz(t).scope,o=t.visualStyleAccessPath||"itemStyle",l=d9(t,o);a.each(function(c){var f=a.getRawIndex(c);n[f]=c}),i.each(function(c){var f=n[c],p=a.getItemVisual(f,"colorFromPalette");if(p){var y=a.ensureUniqueItemVisual(f,"style"),b=i.getName(c)||c+"",S=i.count();y[l]=t.getColorFromPalette(b,s,S)}})}})}},BT=Math.PI;function Ede(r,e){e=e||{},lr(e,{text:"loading",textColor:"#000",fontSize:12,fontWeight:"normal",fontStyle:"normal",fontFamily:"sans-serif",maskColor:"rgba(255, 255, 255, 0.8)",showSpinner:!0,color:"#5470c6",spinnerRadius:10,lineWidth:5,zlevel:0});var t=new mr,i=new li({style:{fill:e.maskColor},zlevel:e.zlevel,z:1e4});t.add(i);var n=new si({style:{text:e.text,fill:e.textColor,fontSize:e.fontSize,fontWeight:e.fontWeight,fontStyle:e.fontStyle,fontFamily:e.fontFamily},zlevel:e.zlevel,z:10001}),a=new li({style:{fill:"none"},textContent:n,textConfig:{position:"right",distance:10},zlevel:e.zlevel,z:10001});t.add(a);var s;return e.showSpinner&&(s=new qw({shape:{startAngle:-BT/2,endAngle:-BT/2+.1,r:e.spinnerRadius},style:{stroke:e.color,lineCap:"round",lineWidth:e.lineWidth},zlevel:e.zlevel,z:10001}),s.animateShape(!0).when(1e3,{endAngle:BT*3/2}).start("circularInOut"),s.animateShape(!0).when(1e3,{startAngle:BT*3/2}).delay(300).start("circularInOut"),t.add(s)),t.resize=function(){var o=n.getBoundingRect().width,l=e.showSpinner?e.spinnerRadius:0,c=(r.getWidth()-l*2-(e.showSpinner&&o?10:0)-o)/2-(e.showSpinner&&o?0:5+o/2)+(e.showSpinner?0:o/2)+(o?0:l),f=r.getHeight()/2;e.showSpinner&&s.setShape({cx:c,cy:f}),a.setShape({x:c-l,y:f-l,width:l*2,height:l*2}),i.setShape({x:0,y:0,width:r.getWidth(),height:r.getHeight()})},t.resize(),t}var p9=(function(){function r(e,t,i,n){this._stageTaskMap=Qt(),this.ecInstance=e,this.api=t,i=this._dataProcessorHandlers=i.slice(),n=this._visualHandlers=n.slice(),this._allHandlers=i.concat(n)}return r.prototype.restoreData=function(e,t){e.restoreData(t),this._stageTaskMap.each(function(i){var n=i.overallTask;n&&n.dirty()})},r.prototype.getPerformArgs=function(e,t){if(e.__pipeline){var i=this._pipelineMap.get(e.__pipeline.id),n=i.context,a=!t&&i.progressiveEnabled&&(!n||n.progressiveRender)&&e.__idxInPipeline>i.blockIndex,s=a?i.step:null,o=n&&n.modDataCount,l=o!=null?Math.ceil(o/s):null;return{step:s,modBy:l,modDataCount:o}}},r.prototype.getPipeline=function(e){return this._pipelineMap.get(e)},r.prototype.updateStreamModes=function(e,t){var i=this._pipelineMap.get(e.uid),n=e.getData(),a=n.count(),s=i.progressiveEnabled&&t.incrementalPrepareRender&&a>=i.threshold,o=e.get("large")&&a>=e.get("largeThreshold"),l=e.get("progressiveChunkMode")==="mod"?a:null;e.pipelineContext=i.context={progressiveRender:s,modDataCount:l,large:o}},r.prototype.restorePipelines=function(e){var t=this,i=t._pipelineMap=Qt();e.eachSeries(function(n){var a=n.getProgressive(),s=n.uid;i.set(s,{id:s,head:null,tail:null,threshold:n.getProgressiveThreshold(),progressiveEnabled:a&&!(n.preventIncremental&&n.preventIncremental()),blockIndex:-1,step:Math.round(a||700),count:0}),t._pipe(n,n.dataTask)})},r.prototype.prepareStageTasks=function(){var e=this._stageTaskMap,t=this.api.getModel(),i=this.api;se(this._allHandlers,function(n){var a=e.get(n.uid)||e.set(n.uid,{}),s="";Is(!(n.reset&&n.overallReset),s),n.reset&&this._createSeriesStageTask(n,a,t,i),n.overallReset&&this._createOverallStageTask(n,a,t,i)},this)},r.prototype.prepareView=function(e,t,i,n){var a=e.renderTask,s=a.context;s.model=t,s.ecModel=i,s.api=n,a.__block=!e.incrementalPrepareRender,this._pipe(t,a)},r.prototype.performDataProcessorTasks=function(e,t){this._performStageTasks(this._dataProcessorHandlers,e,t,{block:!0})},r.prototype.performVisualTasks=function(e,t,i){this._performStageTasks(this._visualHandlers,e,t,i)},r.prototype._performStageTasks=function(e,t,i,n){n=n||{};var a=!1,s=this;se(e,function(l,c){if(!(n.visualType&&n.visualType!==l.visualType)){var f=s._stageTaskMap.get(l.uid),p=f.seriesTaskMap,y=f.overallTask;if(y){var b,S=y.agentStubMap;S.each(function(E){o(n,E)&&(E.dirty(),b=!0)}),b&&y.dirty(),s.updatePayload(y,i);var C=s.getPerformArgs(y,n.block);S.each(function(E){E.perform(C)}),y.perform(C)&&(a=!0)}else p&&p.each(function(E,P){o(n,E)&&E.dirty();var O=s.getPerformArgs(E,n.block);O.skip=!l.performRawSeries&&t.isSeriesFiltered(E.context.model),s.updatePayload(E,i),E.perform(O)&&(a=!0)})}});function o(l,c){return l.setDirty&&(!l.dirtyMap||l.dirtyMap.get(c.__pipeline.id))}this.unfinished=a||this.unfinished},r.prototype.performSeriesTasks=function(e){var t;e.eachSeries(function(i){t=i.dataTask.perform()||t}),this.unfinished=t||this.unfinished},r.prototype.plan=function(){this._pipelineMap.each(function(e){var t=e.tail;do{if(t.__block){e.blockIndex=t.__idxInPipeline;break}t=t.getUpstream()}while(t)})},r.prototype.updatePayload=function(e,t){t!=="remain"&&(e.context.payload=t)},r.prototype._createSeriesStageTask=function(e,t,i,n){var a=this,s=t.seriesTaskMap,o=t.seriesTaskMap=Qt(),l=e.seriesType,c=e.getTargetSeries;e.createOnAllSeries?i.eachRawSeries(f):l?i.eachRawSeriesByType(l,f):c&&c(i,n).each(f);function f(p){var y=p.uid,b=o.set(y,s&&s.get(y)||X1({plan:kde,reset:Lde,count:Nde}));b.context={model:p,ecModel:i,api:n,useClearVisual:e.isVisual&&!e.isLayout,plan:e.plan,reset:e.reset,scheduler:a},a._pipe(p,b)}},r.prototype._createOverallStageTask=function(e,t,i,n){var a=this,s=t.overallTask=t.overallTask||X1({reset:Ide});s.context={ecModel:i,api:n,overallReset:e.overallReset,scheduler:a};var o=s.agentStubMap,l=s.agentStubMap=Qt(),c=e.seriesType,f=e.getTargetSeries,p=!0,y=!1,b="";Is(!e.createOnAllSeries,b),c?i.eachRawSeriesByType(c,S):f?f(i,n).each(S):(p=!1,se(i.getSeries(),S));function S(C){var E=C.uid,P=l.set(E,o&&o.get(E)||(y=!0,X1({reset:Pde,onDirty:Dde})));P.context={model:C,overallProgress:p},P.agent=s,P.__block=p,a._pipe(C,P)}y&&s.dirty()},r.prototype._pipe=function(e,t){var i=e.uid,n=this._pipelineMap.get(i);!n.head&&(n.head=t),n.tail&&n.tail.pipe(t),n.tail=t,t.__idxInPipeline=n.count++,t.__pipeline=n},r.wrapStageHandler=function(e,t){return sr(e)&&(e={overallReset:e,seriesType:Bde(e)}),e.uid=db("stageHandler"),t&&(e.visualType=t),e},r})();function Ide(r){r.overallReset(r.ecModel,r.api,r.payload)}function Pde(r){return r.overallProgress&&Rde}function Rde(){this.agent.dirty(),this.getDownstream().dirty()}function Dde(){this.agent&&this.agent.dirty()}function kde(r){return r.plan?r.plan(r.model,r.ecModel,r.api,r.payload):null}function Lde(r){r.useClearVisual&&r.data.clearAllVisual();var e=r.resetDefines=Gi(r.reset(r.model,r.ecModel,r.api,r.payload));return e.length>1?wt(e,function(t,i){return g9(i)}):Ode}var Ode=g9(0);function g9(r){return function(e,t){var i=t.data,n=t.resetDefines[r];if(n&&n.dataEach)for(var a=e.start;a<e.end;a++)n.dataEach(i,a);else n&&n.progress&&n.progress(e,i)}}function Nde(r){return r.data.count()}function Bde(r){LA=null;try{r(xw,v9)}catch{}return LA}var xw={},v9={},LA;m9(xw,nL);m9(v9,U7);xw.eachSeriesByType=xw.eachRawSeriesByType=function(r){LA=r};xw.eachComponent=function(r){r.mainType==="series"&&r.subType&&(LA=r.subType)};function m9(r,e){for(var t in e.prototype)r[t]=ca}var Jz=["#37A2DA","#32C5E9","#67E0E3","#9FE6B8","#FFDB5C","#ff9f7f","#fb7293","#E062AE","#E690D1","#e7bcf3","#9d96f5","#8378EA","#96BFFF"];const zde={color:Jz,colorLayer:[["#37A2DA","#ffd85c","#fd7b5f"],["#37A2DA","#67E0E3","#FFDB5C","#ff9f7f","#E062AE","#9d96f5"],["#37A2DA","#32C5E9","#9FE6B8","#FFDB5C","#ff9f7f","#fb7293","#e7bcf3","#8378EA","#96BFFF"],Jz]};var Ss="#B9B8CE",eF="#100C2A",zT=function(){return{axisLine:{lineStyle:{color:Ss}},splitLine:{lineStyle:{color:"#484753"}},splitArea:{areaStyle:{color:["rgba(255,255,255,0.02)","rgba(255,255,255,0.05)"]}},minorSplitLine:{lineStyle:{color:"#20203B"}}}},tF=["#4992ff","#7cffb2","#fddd60","#ff6e76","#58d9f9","#05c091","#ff8a45","#8d48e3","#dd79ff"],y9={darkMode:!0,color:tF,backgroundColor:eF,axisPointer:{lineStyle:{color:"#817f91"},crossStyle:{color:"#817f91"},label:{color:"#fff"}},legend:{textStyle:{color:Ss},pageTextStyle:{color:Ss}},textStyle:{color:Ss},title:{textStyle:{color:"#EEF1FA"},subtextStyle:{color:"#B9B8CE"}},toolbox:{iconStyle:{borderColor:Ss}},dataZoom:{borderColor:"#71708A",textStyle:{color:Ss},brushStyle:{color:"rgba(135,163,206,0.3)"},handleStyle:{color:"#353450",borderColor:"#C5CBE3"},moveHandleStyle:{color:"#B0B6C3",opacity:.3},fillerColor:"rgba(135,163,206,0.2)",emphasis:{handleStyle:{borderColor:"#91B7F2",color:"#4D587D"},moveHandleStyle:{color:"#636D9A",opacity:.7}},dataBackground:{lineStyle:{color:"#71708A",width:1},areaStyle:{color:"#71708A"}},selectedDataBackground:{lineStyle:{color:"#87A3CE"},areaStyle:{color:"#87A3CE"}}},visualMap:{textStyle:{color:Ss}},timeline:{lineStyle:{color:Ss},label:{color:Ss},controlStyle:{color:Ss,borderColor:Ss}},calendar:{itemStyle:{color:eF},dayLabel:{color:Ss},monthLabel:{color:Ss},yearLabel:{color:Ss}},timeAxis:zT(),logAxis:zT(),valueAxis:zT(),categoryAxis:zT(),line:{symbol:"circle"},graph:{color:tF},gauge:{title:{color:Ss},axisLine:{lineStyle:{color:[[1,"rgba(207,212,219,0.2)"]]}},axisLabel:{color:Ss},detail:{color:"#EEF1FA"}},candlestick:{itemStyle:{color:"#f64e56",color0:"#54ea92",borderColor:"#f64e56",borderColor0:"#54ea92"}}};y9.categoryAxis.splitLine.show=!1;var Fde=(function(){function r(){}return r.prototype.normalizeQuery=function(e){var t={},i={},n={};if($t(e)){var a=Lf(e);t.mainType=a.main||null,t.subType=a.sub||null}else{var s=["Index","Name","Id"],o={name:1,dataIndex:1,dataType:1};se(e,function(l,c){for(var f=!1,p=0;p<s.length;p++){var y=s[p],b=c.lastIndexOf(y);if(b>0&&b===c.length-y.length){var S=c.slice(0,b);S!=="data"&&(t.mainType=S,t[y.toLowerCase()]=l,f=!0)}}o.hasOwnProperty(c)&&(i[c]=l,f=!0),f||(n[c]=l)})}return{cptQuery:t,dataQuery:i,otherQuery:n}},r.prototype.filter=function(e,t){var i=this.eventInfo;if(!i)return!0;var n=i.targetEl,a=i.packedEvent,s=i.model,o=i.view;if(!s||!o)return!0;var l=t.cptQuery,c=t.dataQuery;return f(l,s,"mainType")&&f(l,s,"subType")&&f(l,s,"index","componentIndex")&&f(l,s,"name")&&f(l,s,"id")&&f(c,a,"name")&&f(c,a,"dataIndex")&&f(c,a,"dataType")&&(!o.filterForExposedEvent||o.filterForExposedEvent(e,t.otherQuery,n,a));function f(p,y,b,S){return p[b]==null||y[S||b]===p[b]}},r.prototype.afterTrigger=function(){this.eventInfo=null},r})(),v3=["symbol","symbolSize","symbolRotate","symbolOffset"],rF=v3.concat(["symbolKeepAspect"]),Vde={createOnAllSeries:!0,performRawSeries:!0,reset:function(r,e){var t=r.getData();if(r.legendIcon&&t.setVisual("legendIcon",r.legendIcon),!r.hasSymbolVisual)return;for(var i={},n={},a=!1,s=0;s<v3.length;s++){var o=v3[s],l=r.get(o);sr(l)?(a=!0,n[o]=l):i[o]=l}if(i.symbol=i.symbol||r.defaultSymbol,t.setVisual(mt({legendIcon:r.legendIcon||i.symbol,symbolKeepAspect:r.get("symbolKeepAspect")},i)),e.isSeriesFiltered(r))return;var c=qr(n);function f(p,y){for(var b=r.getRawValue(y),S=r.getDataParams(y),C=0;C<c.length;C++){var E=c[C];p.setItemVisual(y,E,n[E](b,S))}}return{dataEach:a?f:null}}},Ude={createOnAllSeries:!0,performRawSeries:!0,reset:function(r,e){if(!r.hasSymbolVisual||e.isSeriesFiltered(r))return;var t=r.getData();function i(n,a){for(var s=n.getItemModel(a),o=0;o<rF.length;o++){var l=rF[o],c=s.getShallow(l,!0);c!=null&&n.setItemVisual(a,l,c)}}return{dataEach:t.hasItemOption?i:null}}};function uL(r,e,t){switch(t){case"color":var i=r.getItemVisual(e,"style");return i[r.getVisual("drawType")];case"opacity":return r.getItemVisual(e,"style").opacity;case"symbol":case"symbolSize":case"liftZ":return r.getItemVisual(e,t)}}function Jw(r,e){switch(e){case"color":var t=r.getVisual("style");return t[r.getVisual("drawType")];case"opacity":return r.getVisual("style").opacity;case"symbol":case"symbolSize":case"liftZ":return r.getVisual(e)}}function _9(r,e,t,i){switch(t){case"color":var n=r.ensureUniqueItemVisual(e,"style");n[r.getVisual("drawType")]=i,r.setItemVisual(e,"colorFromPalette",!1);break;case"opacity":r.ensureUniqueItemVisual(e,"style").opacity=i;break;case"symbol":case"symbolSize":case"liftZ":r.setItemVisual(e,t,i);break}}function b9(r,e){function t(i,n){var a=[];return i.eachComponent({mainType:"series",subType:r,query:n},function(s){a.push(s.seriesIndex)}),a}se([[r+"ToggleSelect","toggleSelect"],[r+"Select","select"],[r+"UnSelect","unselect"]],function(i){e(i[0],function(n,a,s){n=mt({},n),s.dispatchAction(mt(n,{type:i[1],seriesIndex:t(a,n)}))})})}function Z_(r,e,t,i,n){var a=r+e;t.isSilent(a)||i.eachComponent({mainType:"series",subType:"pie"},function(s){for(var o=s.seriesIndex,l=s.option.selectedMap,c=n.selected,f=0;f<c.length;f++)if(c[f].seriesIndex===o){var p=s.getData(),y=my(p,n.fromActionPayload);t.trigger(a,{type:a,seriesId:s.id,name:xt(y)?p.getName(y[0]):p.getName(y),selected:$t(l)?l:mt({},l)})}})}function Hde(r,e,t){r.on("selectchanged",function(i){var n=t.getModel();i.isFromClick?(Z_("map","selectchanged",e,n,i),Z_("pie","selectchanged",e,n,i)):i.fromAction==="select"?(Z_("map","selected",e,n,i),Z_("pie","selected",e,n,i)):i.fromAction==="unselect"&&(Z_("map","unselected",e,n,i),Z_("pie","unselected",e,n,i))})}function Wm(r,e,t){for(var i;r&&!(e(r)&&(i=r,t));)r=r.__hostTarget||r.parent;return i}var jde=Math.round(Math.random()*9),$de=typeof Object.defineProperty=="function",Wde=(function(){function r(){this._id="__ec_inner_"+jde++}return r.prototype.get=function(e){return this._guard(e)[this._id]},r.prototype.set=function(e,t){var i=this._guard(e);return $de?Object.defineProperty(i,this._id,{value:t,enumerable:!1,configurable:!0}):i[this._id]=t,this},r.prototype.delete=function(e){return this.has(e)?(delete this._guard(e)[this._id],!0):!1},r.prototype.has=function(e){return!!this._guard(e)[this._id]},r.prototype._guard=function(e){if(e!==Object(e))throw TypeError("Value of WeakMap is not a non-null object.");return e},r})(),Gde=Xr.extend({type:"triangle",shape:{cx:0,cy:0,width:0,height:0},buildPath:function(r,e){var t=e.cx,i=e.cy,n=e.width/2,a=e.height/2;r.moveTo(t,i-a),r.lineTo(t+n,i+a),r.lineTo(t-n,i+a),r.closePath()}}),Xde=Xr.extend({type:"diamond",shape:{cx:0,cy:0,width:0,height:0},buildPath:function(r,e){var t=e.cx,i=e.cy,n=e.width/2,a=e.height/2;r.moveTo(t,i-a),r.lineTo(t+n,i),r.lineTo(t,i+a),r.lineTo(t-n,i),r.closePath()}}),Zde=Xr.extend({type:"pin",shape:{x:0,y:0,width:0,height:0},buildPath:function(r,e){var t=e.x,i=e.y,n=e.width/5*3,a=Math.max(n,e.height),s=n/2,o=s*s/(a-s),l=i-a+s+o,c=Math.asin(o/s),f=Math.cos(c)*s,p=Math.sin(c),y=Math.cos(c),b=s*.6,S=s*.7;r.moveTo(t-f,l+o),r.arc(t,l,s,Math.PI-c,Math.PI*2+c),r.bezierCurveTo(t+f-p*b,l+o+y*b,t,i-S,t,i),r.bezierCurveTo(t,i-S,t-f+p*b,l+o+y*b,t-f,l+o),r.closePath()}}),qde=Xr.extend({type:"arrow",shape:{x:0,y:0,width:0,height:0},buildPath:function(r,e){var t=e.height,i=e.width,n=e.x,a=e.y,s=i/3*2;r.moveTo(n,a),r.lineTo(n+s,a+t),r.lineTo(n,a+t/4*3),r.lineTo(n-s,a+t),r.lineTo(n,a),r.closePath()}}),Yde={line:qa,rect:li,roundRect:li,square:li,circle:$f,diamond:Xde,pin:Zde,arrow:qde,triangle:Gde},Kde={line:function(r,e,t,i,n){n.x1=r,n.y1=e+i/2,n.x2=r+t,n.y2=e+i/2},rect:function(r,e,t,i,n){n.x=r,n.y=e,n.width=t,n.height=i},roundRect:function(r,e,t,i,n){n.x=r,n.y=e,n.width=t,n.height=i,n.r=Math.min(t,i)/4},square:function(r,e,t,i,n){var a=Math.min(t,i);n.x=r,n.y=e,n.width=a,n.height=a},circle:function(r,e,t,i,n){n.cx=r+t/2,n.cy=e+i/2,n.r=Math.min(t,i)/2},diamond:function(r,e,t,i,n){n.cx=r+t/2,n.cy=e+i/2,n.width=t,n.height=i},pin:function(r,e,t,i,n){n.x=r+t/2,n.y=e+i/2,n.width=t,n.height=i},arrow:function(r,e,t,i,n){n.x=r+t/2,n.y=e+i/2,n.width=t,n.height=i},triangle:function(r,e,t,i,n){n.cx=r+t/2,n.cy=e+i/2,n.width=t,n.height=i}},OA={};se(Yde,function(r,e){OA[e]=new r});var Qde=Xr.extend({type:"symbol",shape:{symbolType:"",x:0,y:0,width:0,height:0},calculateTextPosition:function(r,e,t){var i=TA(r,e,t),n=this.shape;return n&&n.symbolType==="pin"&&e.position==="inside"&&(i.y=t.y+t.height*.4),i},buildPath:function(r,e,t){var i=e.symbolType;if(i!=="none"){var n=OA[i];n||(i="rect",n=OA[i]),Kde[i](e.x,e.y,e.width,e.height,n.shape),n.buildPath(r,n.shape,t)}}});function Jde(r,e){if(this.type!=="image"){var t=this.style;this.__isEmptyBrush?(t.stroke=r,t.fill=e||"#fff",t.lineWidth=2):this.shape.symbolType==="line"?t.stroke=r:t.fill=r,this.markRedraw()}}function Aa(r,e,t,i,n,a,s){var o=r.indexOf("empty")===0;o&&(r=r.substr(5,1).toLowerCase()+r.substr(6));var l;return r.indexOf("image://")===0?l=Uk(r.slice(8),new Dr(e,t,i,n),s?"center":"cover"):r.indexOf("path://")===0?l=Yw(r.slice(7),{},new Dr(e,t,i,n),s?"center":"cover"):l=new Qde({shape:{symbolType:r,x:e,y:t,width:i,height:n}}),l.__isEmptyBrush=o,l.setColor=Jde,a&&l.setColor(a),l}function _b(r){return xt(r)||(r=[+r,+r]),[r[0]||0,r[1]||0]}function Dy(r,e){if(r!=null)return xt(r)||(r=[r,r]),[Vt(r[0],e[0])||0,Vt(wr(r[1],r[0]),e[1])||0]}function Gm(r){return isFinite(r)}function epe(r,e,t){var i=e.x==null?0:e.x,n=e.x2==null?1:e.x2,a=e.y==null?0:e.y,s=e.y2==null?0:e.y2;e.global||(i=i*t.width+t.x,n=n*t.width+t.x,a=a*t.height+t.y,s=s*t.height+t.y),i=Gm(i)?i:0,n=Gm(n)?n:1,a=Gm(a)?a:0,s=Gm(s)?s:0;var o=r.createLinearGradient(i,a,n,s);return o}function tpe(r,e,t){var i=t.width,n=t.height,a=Math.min(i,n),s=e.x==null?.5:e.x,o=e.y==null?.5:e.y,l=e.r==null?.5:e.r;e.global||(s=s*i+t.x,o=o*n+t.y,l=l*a),s=Gm(s)?s:.5,o=Gm(o)?o:.5,l=l>=0&&Gm(l)?l:.5;var c=r.createRadialGradient(s,o,0,s,o,l);return c}function m3(r,e,t){for(var i=e.type==="radial"?tpe(r,e,t):epe(r,e,t),n=e.colorStops,a=0;a<n.length;a++)i.addColorStop(n[a].offset,n[a].color);return i}function rpe(r,e){if(r===e||!r&&!e)return!1;if(!r||!e||r.length!==e.length)return!0;for(var t=0;t<r.length;t++)if(r[t]!==e[t])return!0;return!1}function FT(r){return parseInt(r,10)}function x0(r,e,t){var i=["width","height"][e],n=["clientWidth","clientHeight"][e],a=["paddingLeft","paddingTop"][e],s=["paddingRight","paddingBottom"][e];if(t[i]!=null&&t[i]!=="auto")return parseFloat(t[i]);var o=document.defaultView.getComputedStyle(r);return(r[n]||FT(o[i])||FT(r.style[i]))-(FT(o[a])||0)-(FT(o[s])||0)|0}function ipe(r,e){return!r||r==="solid"||!(e>0)?null:r==="dashed"?[4*e,2*e]:r==="dotted"?[e]:di(r)?[r]:xt(r)?r:null}function cL(r){var e=r.style,t=e.lineDash&&e.lineWidth>0&&ipe(e.lineDash,e.lineWidth),i=e.lineDashOffset;if(t){var n=e.strokeNoScale&&r.getLineScale?r.getLineScale():1;n&&n!==1&&(t=wt(t,function(a){return a/n}),i/=n)}return[t,i]}var npe=new jf(!0);function NA(r){var e=r.stroke;return!(e==null||e==="none"||!(r.lineWidth>0))}function iF(r){return typeof r=="string"&&r!=="none"}function BA(r){var e=r.fill;return e!=null&&e!=="none"}function nF(r,e){if(e.fillOpacity!=null&&e.fillOpacity!==1){var t=r.globalAlpha;r.globalAlpha=e.fillOpacity*e.opacity,r.fill(),r.globalAlpha=t}else r.fill()}function aF(r,e){if(e.strokeOpacity!=null&&e.strokeOpacity!==1){var t=r.globalAlpha;r.globalAlpha=e.strokeOpacity*e.opacity,r.stroke(),r.globalAlpha=t}else r.stroke()}function y3(r,e,t){var i=Rk(e.image,e.__image,t);if(LC(i)){var n=r.createPattern(i,e.repeat||"repeat");if(typeof DOMMatrix=="function"&&n&&n.setTransform){var a=new DOMMatrix;a.translateSelf(e.x||0,e.y||0),a.rotateSelf(0,0,(e.rotation||0)*O1),a.scaleSelf(e.scaleX||1,e.scaleY||1),n.setTransform(a)}return n}}function ape(r,e,t,i){var n,a=NA(t),s=BA(t),o=t.strokePercent,l=o<1,c=!e.path;(!e.silent||l)&&c&&e.createPathProxy();var f=e.path||npe,p=e.__dirty;if(!i){var y=t.fill,b=t.stroke,S=s&&!!y.colorStops,C=a&&!!b.colorStops,E=s&&!!y.image,P=a&&!!b.image,O=void 0,B=void 0,F=void 0,W=void 0,$=void 0;(S||C)&&($=e.getBoundingRect()),S&&(O=p?m3(r,y,$):e.__canvasFillGradient,e.__canvasFillGradient=O),C&&(B=p?m3(r,b,$):e.__canvasStrokeGradient,e.__canvasStrokeGradient=B),E&&(F=p||!e.__canvasFillPattern?y3(r,y,e):e.__canvasFillPattern,e.__canvasFillPattern=F),P&&(W=p||!e.__canvasStrokePattern?y3(r,b,e):e.__canvasStrokePattern,e.__canvasStrokePattern=F),S?r.fillStyle=O:E&&(F?r.fillStyle=F:s=!1),C?r.strokeStyle=B:P&&(W?r.strokeStyle=W:a=!1)}var q=e.getGlobalScale();f.setScale(q[0],q[1],e.segmentIgnoreThreshold);var Q,ee;r.setLineDash&&t.lineDash&&(n=cL(e),Q=n[0],ee=n[1]);var te=!0;(c||p&l0)&&(f.setDPR(r.dpr),l?f.setContext(null):(f.setContext(r),te=!1),f.reset(),e.buildPath(f,e.shape,i),f.toStatic(),e.pathUpdated()),te&&f.rebuildPath(r,l?o:1),Q&&(r.setLineDash(Q),r.lineDashOffset=ee),i||(t.strokeFirst?(a&&aF(r,t),s&&nF(r,t)):(s&&nF(r,t),a&&aF(r,t))),Q&&r.setLineDash([])}function ope(r,e,t){var i=e.__image=Rk(t.image,e.__image,e,e.onload);if(!(!i||!LC(i))){var n=t.x||0,a=t.y||0,s=e.getWidth(),o=e.getHeight(),l=i.width/i.height;if(s==null&&o!=null?s=o*l:o==null&&s!=null?o=s/l:s==null&&o==null&&(s=i.width,o=i.height),t.sWidth&&t.sHeight){var c=t.sx||0,f=t.sy||0;r.drawImage(i,c,f,t.sWidth,t.sHeight,n,a,s,o)}else if(t.sx&&t.sy){var c=t.sx,f=t.sy,p=s-c,y=o-f;r.drawImage(i,c,f,p,y,n,a,s,o)}else r.drawImage(i,n,a,s,o)}}function spe(r,e,t){var i,n=t.text;if(n!=null&&(n+=""),n){r.font=t.font||Ug,r.textAlign=t.textAlign,r.textBaseline=t.textBaseline;var a=void 0,s=void 0;r.setLineDash&&t.lineDash&&(i=cL(e),a=i[0],s=i[1]),a&&(r.setLineDash(a),r.lineDashOffset=s),t.strokeFirst?(NA(t)&&r.strokeText(n,t.x,t.y),BA(t)&&r.fillText(n,t.x,t.y)):(BA(t)&&r.fillText(n,t.x,t.y),NA(t)&&r.strokeText(n,t.x,t.y)),a&&r.setLineDash([])}}var oF=["shadowBlur","shadowOffsetX","shadowOffsetY"],sF=[["lineCap","butt"],["lineJoin","miter"],["miterLimit",10]];function x9(r,e,t,i,n){var a=!1;if(!i&&(t=t||{},e===t))return!1;if(i||e.opacity!==t.opacity){Dl(r,n),a=!0;var s=Math.max(Math.min(e.opacity,1),0);r.globalAlpha=isNaN(s)?ry.opacity:s}(i||e.blend!==t.blend)&&(a||(Dl(r,n),a=!0),r.globalCompositeOperation=e.blend||ry.blend);for(var o=0;o<oF.length;o++){var l=oF[o];(i||e[l]!==t[l])&&(a||(Dl(r,n),a=!0),r[l]=r.dpr*(e[l]||0))}return(i||e.shadowColor!==t.shadowColor)&&(a||(Dl(r,n),a=!0),r.shadowColor=e.shadowColor||ry.shadowColor),a}function lF(r,e,t,i,n){var a=ww(e,n.inHover),s=i?null:t&&ww(t,n.inHover)||{};if(a===s)return!1;var o=x9(r,a,s,i,n);if((i||a.fill!==s.fill)&&(o||(Dl(r,n),o=!0),iF(a.fill)&&(r.fillStyle=a.fill)),(i||a.stroke!==s.stroke)&&(o||(Dl(r,n),o=!0),iF(a.stroke)&&(r.strokeStyle=a.stroke)),(i||a.opacity!==s.opacity)&&(o||(Dl(r,n),o=!0),r.globalAlpha=a.opacity==null?1:a.opacity),e.hasStroke()){var l=a.lineWidth,c=l/(a.strokeNoScale&&e.getLineScale?e.getLineScale():1);r.lineWidth!==c&&(o||(Dl(r,n),o=!0),r.lineWidth=c)}for(var f=0;f<sF.length;f++){var p=sF[f],y=p[0];(i||a[y]!==s[y])&&(o||(Dl(r,n),o=!0),r[y]=a[y]||p[1])}return o}function lpe(r,e,t,i,n){return x9(r,ww(e,n.inHover),t&&ww(t,n.inHover),i,n)}function w9(r,e){var t=e.transform,i=r.dpr||1;t?r.setTransform(i*t[0],i*t[1],i*t[2],i*t[3],i*t[4],i*t[5]):r.setTransform(i,0,0,i,0,0)}function upe(r,e,t){for(var i=!1,n=0;n<r.length;n++){var a=r[n];i=i||a.isZeroArea(),w9(e,a),e.beginPath(),a.buildPath(e,a.shape),e.clip()}t.allClipped=i}function cpe(r,e){return r&&e?r[0]!==e[0]||r[1]!==e[1]||r[2]!==e[2]||r[3]!==e[3]||r[4]!==e[4]||r[5]!==e[5]:!(!r&&!e)}var uF=1,cF=2,hF=3,fF=4;function hpe(r){var e=BA(r),t=NA(r);return!(r.lineDash||!(+e^+t)||e&&typeof r.fill!="string"||t&&typeof r.stroke!="string"||r.strokePercent<1||r.strokeOpacity<1||r.fillOpacity<1)}function Dl(r,e){e.batchFill&&r.fill(),e.batchStroke&&r.stroke(),e.batchFill="",e.batchStroke=""}function ww(r,e){return e&&r.__hoverStyle||r.style}function hL(r,e){Xm(r,e,{inHover:!1,viewWidth:0,viewHeight:0},!0)}function Xm(r,e,t,i){var n=e.transform;if(!e.shouldBePainted(t.viewWidth,t.viewHeight,!1,!1)){e.__dirty&=~gu,e.__isRendered=!1;return}var a=e.__clipPaths,s=t.prevElClipPaths,o=!1,l=!1;if((!s||rpe(a,s))&&(s&&s.length&&(Dl(r,t),r.restore(),l=o=!0,t.prevElClipPaths=null,t.allClipped=!1,t.prevEl=null),a&&a.length&&(Dl(r,t),r.save(),upe(a,r,t),o=!0),t.prevElClipPaths=a),t.allClipped){e.__isRendered=!1;return}e.beforeBrush&&e.beforeBrush(),e.innerBeforeBrush();var c=t.prevEl;c||(l=o=!0);var f=e instanceof Xr&&e.autoBatch&&hpe(e.style);o||cpe(n,c.transform)?(Dl(r,t),w9(r,e)):f||Dl(r,t);var p=ww(e,t.inHover);e instanceof Xr?(t.lastDrawType!==uF&&(l=!0,t.lastDrawType=uF),lF(r,e,c,l,t),(!f||!t.batchFill&&!t.batchStroke)&&r.beginPath(),ape(r,e,p,f),f&&(t.batchFill=p.fill||"",t.batchStroke=p.stroke||"")):e instanceof G0?(t.lastDrawType!==hF&&(l=!0,t.lastDrawType=hF),lF(r,e,c,l,t),spe(r,e,p)):e instanceof go?(t.lastDrawType!==cF&&(l=!0,t.lastDrawType=cF),lpe(r,e,c,l,t),ope(r,e,p)):e.getTemporalDisplayables&&(t.lastDrawType!==fF&&(l=!0,t.lastDrawType=fF),fpe(r,e,t)),f&&i&&Dl(r,t),e.innerAfterBrush(),e.afterBrush&&e.afterBrush(),t.prevEl=e,e.__dirty=0,e.__isRendered=!0}function fpe(r,e,t){var i=e.getDisplayables(),n=e.getTemporalDisplayables();r.save();var a={prevElClipPaths:null,prevEl:null,allClipped:!1,viewWidth:t.viewWidth,viewHeight:t.viewHeight,inHover:t.inHover},s,o;for(s=e.getCursor(),o=i.length;s<o;s++){var l=i[s];l.beforeBrush&&l.beforeBrush(),l.innerBeforeBrush(),Xm(r,l,a,s===o-1),l.innerAfterBrush(),l.afterBrush&&l.afterBrush(),a.prevEl=l}for(var c=0,f=n.length;c<f;c++){var l=n[c];l.beforeBrush&&l.beforeBrush(),l.innerBeforeBrush(),Xm(r,l,a,c===f-1),l.innerAfterBrush(),l.afterBrush&&l.afterBrush(),a.prevEl=l}e.clearTemporalDisplayables(),e.notClear=!0,r.restore()}var fI=new Wde,dF=new $w(100),pF=["symbol","symbolSize","symbolKeepAspect","color","backgroundColor","dashArrayX","dashArrayY","maxTileWidth","maxTileHeight"];function q0(r,e){if(r==="none")return null;var t=e.getDevicePixelRatio(),i=e.getZr(),n=i.painter.type==="svg";r.dirty&&fI.delete(r);var a=fI.get(r);if(a)return a;var s=lr(r,{symbol:"rect",symbolSize:1,symbolKeepAspect:!0,color:"rgba(0, 0, 0, 0.2)",backgroundColor:null,dashArrayX:5,dashArrayY:5,rotation:0,maxTileWidth:512,maxTileHeight:512});s.backgroundColor==="none"&&(s.backgroundColor=null);var o={repeat:"repeat"};return l(o),o.rotation=s.rotation,o.scaleX=o.scaleY=n?1:1/t,fI.set(r,o),r.dirty=!1,o;function l(c){for(var f=[t],p=!0,y=0;y<pF.length;++y){var b=s[pF[y]];if(b!=null&&!xt(b)&&!$t(b)&&!di(b)&&typeof b!="boolean"){p=!1;break}f.push(b)}var S;if(p){S=f.join(",")+(n?"-svg":"");var C=dF.get(S);C&&(n?c.svgElement=C:c.image=C)}var E=T9(s.dashArrayX),P=dpe(s.dashArrayY),O=S9(s.symbol),B=ppe(E),F=A9(P),W=!n&&Ih.createCanvas(),$=n&&{tag:"g",attrs:{},key:"dcl",children:[]},q=ee(),Q;W&&(W.width=q.width*t,W.height=q.height*t,Q=W.getContext("2d")),te(),p&&dF.put(S,W||$),c.image=W,c.svgElement=$,c.svgWidth=q.width,c.svgHeight=q.height;function ee(){for(var ae=1,de=0,ve=B.length;de<ve;++de)ae=R4(ae,B[de]);for(var ye=1,de=0,ve=O.length;de<ve;++de)ye=R4(ye,O[de].length);ae*=ye;var Ae=F*B.length*O.length;return{width:Math.max(1,Math.min(ae,s.maxTileWidth)),height:Math.max(1,Math.min(Ae,s.maxTileHeight))}}function te(){Q&&(Q.clearRect(0,0,W.width,W.height),s.backgroundColor&&(Q.fillStyle=s.backgroundColor,Q.fillRect(0,0,W.width,W.height)));for(var ae=0,de=0;de<P.length;++de)ae+=P[de];if(ae<=0)return;for(var ve=-F,ye=0,Ae=0,me=0;ve<q.height;){if(ye%2===0){for(var De=Ae/2%O.length,Fe=0,je=0,ct=0;Fe<q.width*2;){for(var xe=0,de=0;de<E[me].length;++de)xe+=E[me][de];if(xe<=0)break;if(je%2===0){var $e=(1-s.symbolSize)*.5,pt=Fe+E[me][je]*$e,_t=ve+P[ye]*$e,Dt=E[me][je]*s.symbolSize,qt=P[ye]*s.symbolSize,_r=ct/2%O[De].length;Kt(pt,_t,Dt,qt,O[De][_r])}Fe+=E[me][je],++ct,++je,je===E[me].length&&(je=0)}++me,me===E.length&&(me=0)}ve+=P[ye],++Ae,++ye,ye===P.length&&(ye=0)}function Kt(zt,yr,Gt,Jt,Tr){var dr=n?1:t,$r=Aa(Tr,zt*dr,yr*dr,Gt*dr,Jt*dr,s.color,s.symbolKeepAspect);if(n){var ii=i.painter.renderOneToVNode($r);ii&&$.children.push(ii)}else hL(Q,$r)}}}}function S9(r){if(!r||r.length===0)return[["rect"]];if($t(r))return[[r]];for(var e=!0,t=0;t<r.length;++t)if(!$t(r[t])){e=!1;break}if(e)return S9([r]);for(var i=[],t=0;t<r.length;++t)$t(r[t])?i.push([r[t]]):i.push(r[t]);return i}function T9(r){if(!r||r.length===0)return[[0,0]];if(di(r)){var e=Math.ceil(r);return[[e,e]]}for(var t=!0,i=0;i<r.length;++i)if(!di(r[i])){t=!1;break}if(t)return T9([r]);for(var n=[],i=0;i<r.length;++i)if(di(r[i])){var e=Math.ceil(r[i]);n.push([e,e])}else{var e=wt(r[i],function(o){return Math.ceil(o)});e.length%2===1?n.push(e.concat(e)):n.push(e)}return n}function dpe(r){if(!r||typeof r=="object"&&r.length===0)return[0,0];if(di(r)){var e=Math.ceil(r);return[e,e]}var t=wt(r,function(i){return Math.ceil(i)});return r.length%2?t.concat(t):t}function ppe(r){return wt(r,function(e){return A9(e)})}function A9(r){for(var e=0,t=0;t<r.length;++t)e+=r[t];return r.length%2===1?e*2:e}function gpe(r,e){r.eachRawSeries(function(t){if(!r.isSeriesFiltered(t)){var i=t.getData();i.hasItemVisual()&&i.each(function(s){var o=i.getItemVisual(s,"decal");if(o){var l=i.ensureUniqueItemVisual(s,"style");l.decal=q0(o,e)}});var n=i.getVisual("decal");if(n){var a=i.getVisual("style");a.decal=q0(n,e)}}})}var _h=new Cc,C9={};function vpe(r,e){C9[r]=e}function M9(r){return C9[r]}var mpe="5.6.0",ype={zrender:"5.6.1"},_pe=1,bpe=800,xpe=900,wpe=1e3,Spe=2e3,Tpe=5e3,E9=1e3,Ape=1100,fL=2e3,I9=3e3,Cpe=4e3,QC=4500,Mpe=4600,Epe=5e3,Ipe=6e3,P9=7e3,R9={PROCESSOR:{FILTER:wpe,SERIES_FILTER:bpe,STATISTIC:Tpe},VISUAL:{LAYOUT:E9,PROGRESSIVE_LAYOUT:Ape,GLOBAL:fL,CHART:I9,POST_CHART_LAYOUT:Mpe,COMPONENT:Cpe,BRUSH:Epe,CHART_ITEM:QC,ARIA:Ipe,DECAL:P9}},ws="__flagInMainProcess",Il="__pendingUpdate",dI="__needsUpdateStatus",gF=/^[a-zA-Z0-9_]+$/,pI="__connectUpdateStatus",vF=0,Ppe=1,Rpe=2;function D9(r){return function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];if(this.isDisposed()){this.id;return}return L9(this,r,e)}}function k9(r){return function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return L9(this,r,e)}}function L9(r,e,t){return t[0]=t[0]&&t[0].toLowerCase(),Cc.prototype[e].apply(r,t)}var O9=(function(r){Ye(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e})(Cc),N9=O9.prototype;N9.on=k9("on");N9.off=k9("off");var q_,gI,VT,hg,vI,mI,yI,Hx,jx,mF,yF,_I,_F,UT,bF,B9,nc,xF,zA=(function(r){Ye(e,r);function e(t,i,n){var a=r.call(this,new Fde)||this;a._chartsViews=[],a._chartsMap={},a._componentsViews=[],a._componentsMap={},a._pendingActions=[],n=n||{},$t(i)&&(i=z9[i]),a._dom=t;var s="canvas",o="auto",l=!1;n.ssr&&x$(function(y){var b=br(y),S=b.dataIndex;if(S!=null){var C=Qt();return C.set("series_index",b.seriesIndex),C.set("data_index",S),b.ssrType&&C.set("ssr_type",b.ssrType),C}});var c=a._zr=WR(t,{renderer:n.renderer||s,devicePixelRatio:n.devicePixelRatio,width:n.width,height:n.height,ssr:n.ssr,useDirtyRect:wr(n.useDirtyRect,l),useCoarsePointer:wr(n.useCoarsePointer,o),pointerSize:n.pointerSize});a._ssr=n.ssr,a._throttledZrFlush=KC(Xt(c.flush,c),17),i=hr(i),i&&j7(i,!0),a._theme=i,a._locale=Zhe(n.locale||x7),a._coordSysMgr=new vb;var f=a._api=bF(a);function p(y,b){return y.__prio-b.__prio}return I2(VA,p),I2(_3,p),a._scheduler=new p9(a,f,_3,VA),a._messageCenter=new O9,a._initEvents(),a.resize=Xt(a.resize,a),c.animation.on("frame",a._onframe,a),mF(c,a),yF(c,a),ow(a),a}return e.prototype._onframe=function(){if(!this._disposed){xF(this);var t=this._scheduler;if(this[Il]){var i=this[Il].silent;this[ws]=!0;try{q_(this),hg.update.call(this,null,this[Il].updateParams)}catch(l){throw this[ws]=!1,this[Il]=null,l}this._zr.flush(),this[ws]=!1,this[Il]=null,Hx.call(this,i),jx.call(this,i)}else if(t.unfinished){var n=_pe,a=this._model,s=this._api;t.unfinished=!1;do{var o=+new Date;t.performSeriesTasks(a),t.performDataProcessorTasks(a),mI(this,a),t.performVisualTasks(a),UT(this,this._model,s,"remain",{}),n-=+new Date-o}while(n>0&&t.unfinished);t.unfinished||this._zr.flush()}}},e.prototype.getDom=function(){return this._dom},e.prototype.getId=function(){return this.id},e.prototype.getZr=function(){return this._zr},e.prototype.isSSR=function(){return this._ssr},e.prototype.setOption=function(t,i,n){if(!this[ws]){if(this._disposed){this.id;return}var a,s,o;if(cr(i)&&(n=i.lazyUpdate,a=i.silent,s=i.replaceMerge,o=i.transition,i=i.notMerge),this[ws]=!0,!this._model||i){var l=new xfe(this._api),c=this._theme,f=this._model=new nL;f.scheduler=this._scheduler,f.ssr=this._ssr,f.init(null,null,null,c,this._locale,l)}this._model.setOption(t,{replaceMerge:s},b3);var p={seriesTransition:o,optionChanged:!0};if(n)this[Il]={silent:a,updateParams:p},this[ws]=!1,this.getZr().wakeUp();else{try{q_(this),hg.update.call(this,null,p)}catch(y){throw this[Il]=null,this[ws]=!1,y}this._ssr||this._zr.flush(),this[Il]=null,this[ws]=!1,Hx.call(this,a),jx.call(this,a)}}},e.prototype.setTheme=function(){},e.prototype.getModel=function(){return this._model},e.prototype.getOption=function(){return this._model&&this._model.getOption()},e.prototype.getWidth=function(){return this._zr.getWidth()},e.prototype.getHeight=function(){return this._zr.getHeight()},e.prototype.getDevicePixelRatio=function(){return this._zr.painter.dpr||Gr.hasGlobalWindow&&window.devicePixelRatio||1},e.prototype.getRenderedCanvas=function(t){return this.renderToCanvas(t)},e.prototype.renderToCanvas=function(t){t=t||{};var i=this._zr.painter;return i.getRenderedCanvas({backgroundColor:t.backgroundColor||this._model.get("backgroundColor"),pixelRatio:t.pixelRatio||this.getDevicePixelRatio()})},e.prototype.renderToSVGString=function(t){t=t||{};var i=this._zr.painter;return i.renderToString({useViewBox:t.useViewBox})},e.prototype.getSvgDataURL=function(){if(Gr.svgSupported){var t=this._zr,i=t.storage.getDisplayList();return se(i,function(n){n.stopAnimation(null,!0)}),t.painter.toDataURL()}},e.prototype.getDataURL=function(t){if(this._disposed){this.id;return}t=t||{};var i=t.excludeComponents,n=this._model,a=[],s=this;se(i,function(l){n.eachComponent({mainType:l},function(c){var f=s._componentsMap[c.__viewId];f.group.ignore||(a.push(f),f.group.ignore=!0)})});var o=this._zr.painter.getType()==="svg"?this.getSvgDataURL():this.renderToCanvas(t).toDataURL("image/"+(t&&t.type||"png"));return se(a,function(l){l.group.ignore=!1}),o},e.prototype.getConnectedDataURL=function(t){if(this._disposed){this.id;return}var i=t.type==="svg",n=this.group,a=Math.min,s=Math.max,o=1/0;if(UA[n]){var l=o,c=o,f=-o,p=-o,y=[],b=t&&t.pixelRatio||this.getDevicePixelRatio();se(ay,function(B,F){if(B.group===n){var W=i?B.getZr().painter.getSvgDom().innerHTML:B.renderToCanvas(hr(t)),$=B.getDom().getBoundingClientRect();l=a($.left,l),c=a($.top,c),f=s($.right,f),p=s($.bottom,p),y.push({dom:W,left:$.left,top:$.top})}}),l*=b,c*=b,f*=b,p*=b;var S=f-l,C=p-c,E=Ih.createCanvas(),P=WR(E,{renderer:i?"svg":"canvas"});if(P.resize({width:S,height:C}),i){var O="";return se(y,function(B){var F=B.left-l,W=B.top-c;O+='<g transform="translate('+F+","+W+')">'+B.dom+"</g>"}),P.painter.getSvgRoot().innerHTML=O,t.connectedBackgroundColor&&P.painter.setBackgroundColor(t.connectedBackgroundColor),P.refreshImmediately(),P.painter.toDataURL()}else return t.connectedBackgroundColor&&P.add(new li({shape:{x:0,y:0,width:S,height:C},style:{fill:t.connectedBackgroundColor}})),se(y,function(B){var F=new go({style:{x:B.left*b-l,y:B.top*b-c,image:B.dom}});P.add(F)}),P.refreshImmediately(),E.toDataURL("image/"+(t&&t.type||"png"))}else return this.getDataURL(t)},e.prototype.convertToPixel=function(t,i){return vI(this,"convertToPixel",t,i)},e.prototype.convertFromPixel=function(t,i){return vI(this,"convertFromPixel",t,i)},e.prototype.containPixel=function(t,i){if(this._disposed){this.id;return}var n=this._model,a,s=H1(n,t);return se(s,function(o,l){l.indexOf("Models")>=0&&se(o,function(c){var f=c.coordinateSystem;if(f&&f.containPoint)a=a||!!f.containPoint(i);else if(l==="seriesModels"){var p=this._chartsMap[c.__viewId];p&&p.containPoint&&(a=a||p.containPoint(i,c))}},this)},this),!!a},e.prototype.getVisual=function(t,i){var n=this._model,a=H1(n,t,{defaultMainType:"series"}),s=a.seriesModel,o=s.getData(),l=a.hasOwnProperty("dataIndexInside")?a.dataIndexInside:a.hasOwnProperty("dataIndex")?o.indexOfRawIndex(a.dataIndex):null;return l!=null?uL(o,l,i):Jw(o,i)},e.prototype.getViewOfComponentModel=function(t){return this._componentsMap[t.__viewId]},e.prototype.getViewOfSeriesModel=function(t){return this._chartsMap[t.__viewId]},e.prototype._initEvents=function(){var t=this;se(Dpe,function(i){var n=function(a){var s=t.getModel(),o=a.target,l,c=i==="globalout";if(c?l={}:o&&Wm(o,function(S){var C=br(S);if(C&&C.dataIndex!=null){var E=C.dataModel||s.getSeriesByIndex(C.seriesIndex);return l=E&&E.getDataParams(C.dataIndex,C.dataType,o)||{},!0}else if(C.eventData)return l=mt({},C.eventData),!0},!0),l){var f=l.componentType,p=l.componentIndex;(f==="markLine"||f==="markPoint"||f==="markArea")&&(f="series",p=l.seriesIndex);var y=f&&p!=null&&s.getComponent(f,p),b=y&&t[y.mainType==="series"?"_chartsMap":"_componentsMap"][y.__viewId];l.event=a,l.type=i,t._$eventProcessor.eventInfo={targetEl:o,packedEvent:l,model:y,view:b},t.trigger(i,l)}};n.zrEventfulCallAtLast=!0,t._zr.on(i,n,t)}),se(Z1,function(i,n){t._messageCenter.on(n,function(a){this.trigger(n,a)},t)}),se(["selectchanged"],function(i){t._messageCenter.on(i,function(n){this.trigger(i,n)},t)}),Hde(this._messageCenter,this,this._api)},e.prototype.isDisposed=function(){return this._disposed},e.prototype.clear=function(){if(this._disposed){this.id;return}this.setOption({series:[]},!0)},e.prototype.dispose=function(){if(this._disposed){this.id;return}this._disposed=!0;var t=this.getDom();t&&D$(this.getDom(),pL,"");var i=this,n=i._api,a=i._model;se(i._componentsViews,function(s){s.dispose(a,n)}),se(i._chartsViews,function(s){s.dispose(a,n)}),i._zr.dispose(),i._dom=i._model=i._chartsMap=i._componentsMap=i._chartsViews=i._componentsViews=i._scheduler=i._api=i._zr=i._throttledZrFlush=i._theme=i._coordSysMgr=i._messageCenter=null,delete ay[i.id]},e.prototype.resize=function(t){if(!this[ws]){if(this._disposed){this.id;return}this._zr.resize(t);var i=this._model;if(this._loadingFX&&this._loadingFX.resize(),!!i){var n=i.resetOption("media"),a=t&&t.silent;this[Il]&&(a==null&&(a=this[Il].silent),n=!0,this[Il]=null),this[ws]=!0;try{n&&q_(this),hg.update.call(this,{type:"resize",animation:mt({duration:0},t&&t.animation)})}catch(s){throw this[ws]=!1,s}this[ws]=!1,Hx.call(this,a),jx.call(this,a)}}},e.prototype.showLoading=function(t,i){if(this._disposed){this.id;return}if(cr(t)&&(i=t,t=""),t=t||"default",this.hideLoading(),!!x3[t]){var n=x3[t](this._api,i),a=this._zr;this._loadingFX=n,a.add(n)}},e.prototype.hideLoading=function(){if(this._disposed){this.id;return}this._loadingFX&&this._zr.remove(this._loadingFX),this._loadingFX=null},e.prototype.makeActionFromEvent=function(t){var i=mt({},t);return i.type=Z1[t.type],i},e.prototype.dispatchAction=function(t,i){if(this._disposed){this.id;return}if(cr(i)||(i={silent:!!i}),!!FA[t.type]&&this._model){if(this[ws]){this._pendingActions.push(t);return}var n=i.silent;yI.call(this,t,n);var a=i.flush;a?this._zr.flush():a!==!1&&Gr.browser.weChat&&this._throttledZrFlush(),Hx.call(this,n),jx.call(this,n)}},e.prototype.updateLabelLayout=function(){_h.trigger("series:layoutlabels",this._model,this._api,{updatedSeries:[]})},e.prototype.appendData=function(t){if(this._disposed){this.id;return}var i=t.seriesIndex,n=this.getModel(),a=n.getSeriesByIndex(i);a.appendData(t),this._scheduler.unfinished=!0,this.getZr().wakeUp()},e.internalField=(function(){q_=function(p){var y=p._scheduler;y.restorePipelines(p._model),y.prepareStageTasks(),gI(p,!0),gI(p,!1),y.plan()},gI=function(p,y){for(var b=p._model,S=p._scheduler,C=y?p._componentsViews:p._chartsViews,E=y?p._componentsMap:p._chartsMap,P=p._zr,O=p._api,B=0;B<C.length;B++)C[B].__alive=!1;y?b.eachComponent(function($,q){$!=="series"&&F(q)}):b.eachSeries(F);function F($){var q=$.__requireNewView;$.__requireNewView=!1;var Q="_ec_"+$.id+"_"+$.type,ee=!q&&E[Q];if(!ee){var te=Lf($.type),ae=y?vn.getClass(te.main,te.sub):Fi.getClass(te.sub);ee=new ae,ee.init(b,O),E[Q]=ee,C.push(ee),P.add(ee.group)}$.__viewId=ee.__id=Q,ee.__alive=!0,ee.__model=$,ee.group.__ecComponentInfo={mainType:$.mainType,index:$.componentIndex},!y&&S.prepareView(ee,$,b,O)}for(var B=0;B<C.length;){var W=C[B];W.__alive?B++:(!y&&W.renderTask.dispose(),P.remove(W.group),W.dispose(b,O),C.splice(B,1),E[W.__id]===W&&delete E[W.__id],W.__id=W.group.__ecComponentInfo=null)}},VT=function(p,y,b,S,C){var E=p._model;if(E.setUpdatePayload(b),!S){se([].concat(p._componentsViews).concat(p._chartsViews),W);return}var P={};P[S+"Id"]=b[S+"Id"],P[S+"Index"]=b[S+"Index"],P[S+"Name"]=b[S+"Name"];var O={mainType:S,query:P};C&&(O.subType=C);var B=b.excludeSeriesId,F;B!=null&&(F=Qt(),se(Gi(B),function($){var q=Za($,null);q!=null&&F.set(q,!0)})),E&&E.eachComponent(O,function($){var q=F&&F.get($.id)!=null;if(!q)if(iz(b))if($ instanceof Xi)b.type===iy&&!b.notBlur&&!$.get(["emphasis","disabled"])&&Kce($,b,p._api);else{var Q=Bk($.mainType,$.componentIndex,b.name,p._api),ee=Q.focusSelf,te=Q.dispatchers;b.type===iy&&ee&&!b.notBlur&&t3($.mainType,$.componentIndex,p._api),te&&se(te,function(ae){b.type===iy?cp(ae):hp(ae)})}else i3(b)&&$ instanceof Xi&&(ehe($,b,p._api),tz($),nc(p))},p),E&&E.eachComponent(O,function($){var q=F&&F.get($.id)!=null;q||W(p[S==="series"?"_chartsMap":"_componentsMap"][$.__viewId])},p);function W($){$&&$.__alive&&$[y]&&$[y]($.__model,E,p._api,b)}},hg={prepareAndUpdate:function(p){q_(this),hg.update.call(this,p,{optionChanged:p.newOption!=null})},update:function(p,y){var b=this._model,S=this._api,C=this._zr,E=this._coordSysMgr,P=this._scheduler;if(b){b.setUpdatePayload(p),P.restoreData(b,p),P.performSeriesTasks(b),E.create(b,S),P.performDataProcessorTasks(b,p),mI(this,b),E.update(b,S),t(b),P.performVisualTasks(b,p),_I(this,b,S,p,y);var O=b.get("backgroundColor")||"transparent",B=b.get("darkMode");C.setBackgroundColor(O),B!=null&&B!=="auto"&&C.setDarkMode(B),_h.trigger("afterupdate",b,S)}},updateTransform:function(p){var y=this,b=this._model,S=this._api;if(b){b.setUpdatePayload(p);var C=[];b.eachComponent(function(P,O){if(P!=="series"){var B=y.getViewOfComponentModel(O);if(B&&B.__alive)if(B.updateTransform){var F=B.updateTransform(O,b,S,p);F&&F.update&&C.push(B)}else C.push(B)}});var E=Qt();b.eachSeries(function(P){var O=y._chartsMap[P.__viewId];if(O.updateTransform){var B=O.updateTransform(P,b,S,p);B&&B.update&&E.set(P.uid,1)}else E.set(P.uid,1)}),t(b),this._scheduler.performVisualTasks(b,p,{setDirty:!0,dirtyMap:E}),UT(this,b,S,p,{},E),_h.trigger("afterupdate",b,S)}},updateView:function(p){var y=this._model;y&&(y.setUpdatePayload(p),Fi.markUpdateMethod(p,"updateView"),t(y),this._scheduler.performVisualTasks(y,p,{setDirty:!0}),_I(this,y,this._api,p,{}),_h.trigger("afterupdate",y,this._api))},updateVisual:function(p){var y=this,b=this._model;b&&(b.setUpdatePayload(p),b.eachSeries(function(S){S.getData().clearAllVisual()}),Fi.markUpdateMethod(p,"updateVisual"),t(b),this._scheduler.performVisualTasks(b,p,{visualType:"visual",setDirty:!0}),b.eachComponent(function(S,C){if(S!=="series"){var E=y.getViewOfComponentModel(C);E&&E.__alive&&E.updateVisual(C,b,y._api,p)}}),b.eachSeries(function(S){var C=y._chartsMap[S.__viewId];C.updateVisual(S,b,y._api,p)}),_h.trigger("afterupdate",b,this._api))},updateLayout:function(p){hg.update.call(this,p)}},vI=function(p,y,b,S){if(p._disposed){p.id;return}for(var C=p._model,E=p._coordSysMgr.getCoordinateSystems(),P,O=H1(C,b),B=0;B<E.length;B++){var F=E[B];if(F[y]&&(P=F[y](C,O,S))!=null)return P}},mI=function(p,y){var b=p._chartsMap,S=p._scheduler;y.eachSeries(function(C){S.updateStreamModes(C,b[C.__viewId])})},yI=function(p,y){var b=this,S=this.getModel(),C=p.type,E=p.escapeConnect,P=FA[C],O=P.actionInfo,B=(O.update||"update").split(":"),F=B.pop(),W=B[0]!=null&&Lf(B[0]);this[ws]=!0;var $=[p],q=!1;p.batch&&(q=!0,$=wt(p.batch,function(ye){return ye=lr(mt({},ye),p),ye.batch=null,ye}));var Q=[],ee,te=i3(p),ae=iz(p);if(ae&&e7(this._api),se($,function(ye){if(ee=P.action(ye,b._model,b._api),ee=ee||mt({},ye),ee.type=O.event||ee.type,Q.push(ee),ae){var Ae=Ik(p),me=Ae.queryOptionMap,De=Ae.mainTypeSpecified,Fe=De?me.keys()[0]:"series";VT(b,F,ye,Fe),nc(b)}else te?(VT(b,F,ye,"series"),nc(b)):W&&VT(b,F,ye,W.main,W.sub)}),F!=="none"&&!ae&&!te&&!W)try{this[Il]?(q_(this),hg.update.call(this,p),this[Il]=null):hg[F].call(this,p)}catch(ye){throw this[ws]=!1,ye}if(q?ee={type:O.event||C,escapeConnect:E,batch:Q}:ee=Q[0],this[ws]=!1,!y){var de=this._messageCenter;if(de.trigger(ee.type,ee),te){var ve={type:"selectchanged",escapeConnect:E,selected:the(S),isFromClick:p.isFromClick||!1,fromAction:p.type,fromActionPayload:p};de.trigger(ve.type,ve)}}},Hx=function(p){for(var y=this._pendingActions;y.length;){var b=y.shift();yI.call(this,b,p)}},jx=function(p){!p&&this.trigger("updated")},mF=function(p,y){p.on("rendered",function(b){y.trigger("rendered",b),p.animation.isFinished()&&!y[Il]&&!y._scheduler.unfinished&&!y._pendingActions.length&&y.trigger("finished")})},yF=function(p,y){p.on("mouseover",function(b){var S=b.target,C=Wm(S,gw);C&&(Qce(C,b,y._api),nc(y))}).on("mouseout",function(b){var S=b.target,C=Wm(S,gw);C&&(Jce(C,b,y._api),nc(y))}).on("click",function(b){var S=b.target,C=Wm(S,function(O){return br(O).dataIndex!=null},!0);if(C){var E=C.selected?"unselect":"select",P=br(C);y._api.dispatchAction({type:E,dataType:P.dataType,dataIndexInside:P.dataIndex,seriesIndex:P.seriesIndex,isFromClick:!0})}})};function t(p){p.clearColorPalette(),p.eachSeries(function(y){y.clearColorPalette()})}function i(p){var y=[],b=[],S=!1;if(p.eachComponent(function(O,B){var F=B.get("zlevel")||0,W=B.get("z")||0,$=B.getZLevelKey();S=S||!!$,(O==="series"?b:y).push({zlevel:F,z:W,idx:B.componentIndex,type:O,key:$})}),S){var C=y.concat(b),E,P;I2(C,function(O,B){return O.zlevel===B.zlevel?O.z-B.z:O.zlevel-B.zlevel}),se(C,function(O){var B=p.getComponent(O.type,O.idx),F=O.zlevel,W=O.key;E!=null&&(F=Math.max(E,F)),W?(F===E&&W!==P&&F++,P=W):P&&(F===E&&F++,P=""),E=F,B.setZLevel(F)})}}_I=function(p,y,b,S,C){i(y),_F(p,y,b,S,C),se(p._chartsViews,function(E){E.__alive=!1}),UT(p,y,b,S,C),se(p._chartsViews,function(E){E.__alive||E.remove(y,b)})},_F=function(p,y,b,S,C,E){se(E||p._componentsViews,function(P){var O=P.__model;c(O,P),P.render(O,y,b,S),o(O,P),f(O,P)})},UT=function(p,y,b,S,C,E){var P=p._scheduler;C=mt(C||{},{updatedSeries:y.getSeries()}),_h.trigger("series:beforeupdate",y,b,C);var O=!1;y.eachSeries(function(B){var F=p._chartsMap[B.__viewId];F.__alive=!0;var W=F.renderTask;P.updatePayload(W,S),c(B,F),E&&E.get(B.uid)&&W.dirty(),W.perform(P.getPerformArgs(W))&&(O=!0),F.group.silent=!!B.get("silent"),s(B,F),tz(B)}),P.unfinished=O||P.unfinished,_h.trigger("series:layoutlabels",y,b,C),_h.trigger("series:transition",y,b,C),y.eachSeries(function(B){var F=p._chartsMap[B.__viewId];o(B,F),f(B,F)}),a(p,y),_h.trigger("series:afterupdate",y,b,C)},nc=function(p){p[dI]=!0,p.getZr().wakeUp()},xF=function(p){p[dI]&&(p.getZr().storage.traverse(function(y){I0(y)||n(y)}),p[dI]=!1)};function n(p){for(var y=[],b=p.currentStates,S=0;S<b.length;S++){var C=b[S];C==="emphasis"||C==="blur"||C==="select"||y.push(C)}p.selected&&p.states.select&&y.push("select"),p.hoverState===BC&&p.states.emphasis?y.push("emphasis"):p.hoverState===Xw&&p.states.blur&&y.push("blur"),p.useStates(y)}function a(p,y){var b=p._zr,S=b.storage,C=0;S.traverse(function(E){E.isGroup||C++}),C>y.get("hoverLayerThreshold")&&!Gr.node&&!Gr.worker&&y.eachSeries(function(E){if(!E.preventUsingHoverLayer){var P=p._chartsMap[E.__viewId];P.__alive&&P.eachRendered(function(O){O.states.emphasis&&(O.states.emphasis.hoverLayer=!0)})}})}function s(p,y){var b=p.get("blendMode")||null;y.eachRendered(function(S){S.isGroup||(S.style.blend=b)})}function o(p,y){if(!p.preventAutoZ){var b=p.get("z")||0,S=p.get("zlevel")||0;y.eachRendered(function(C){return l(C,b,S,-1/0),!0})}}function l(p,y,b,S){var C=p.getTextContent(),E=p.getTextGuideLine(),P=p.isGroup;if(P)for(var O=p.childrenRef(),B=0;B<O.length;B++)S=Math.max(l(O[B],y,b,S),S);else p.z=y,p.zlevel=b,S=Math.max(p.z2,S);if(C&&(C.z=y,C.zlevel=b,isFinite(S)&&(C.z2=S+2)),E){var F=p.textGuideLineConfig;E.z=y,E.zlevel=b,isFinite(S)&&(E.z2=S+(F&&F.showAbove?1:-1))}return S}function c(p,y){y.eachRendered(function(b){if(!I0(b)){var S=b.getTextContent(),C=b.getTextGuideLine();b.stateTransition&&(b.stateTransition=null),S&&S.stateTransition&&(S.stateTransition=null),C&&C.stateTransition&&(C.stateTransition=null),b.hasState()?(b.prevStates=b.currentStates,b.clearStates()):b.prevStates&&(b.prevStates=null)}})}function f(p,y){var b=p.getModel("stateAnimation"),S=p.isAnimationEnabled(),C=b.get("duration"),E=C>0?{duration:C,delay:b.get("delay"),easing:b.get("easing")}:null;y.eachRendered(function(P){if(P.states&&P.states.emphasis){if(I0(P))return;if(P instanceof Xr&&ohe(P),P.__dirty){var O=P.prevStates;O&&P.useStates(O)}if(S){P.stateTransition=E;var B=P.getTextContent(),F=P.getTextGuideLine();B&&(B.stateTransition=E),F&&(F.stateTransition=E)}P.__dirty&&n(P)}})}bF=function(p){return new((function(y){Ye(b,y);function b(){return y!==null&&y.apply(this,arguments)||this}return b.prototype.getCoordinateSystems=function(){return p._coordSysMgr.getCoordinateSystems()},b.prototype.getComponentByElement=function(S){for(;S;){var C=S.__ecComponentInfo;if(C!=null)return p._model.getComponent(C.mainType,C.index);S=S.parent}},b.prototype.enterEmphasis=function(S,C){cp(S,C),nc(p)},b.prototype.leaveEmphasis=function(S,C){hp(S,C),nc(p)},b.prototype.enterBlur=function(S){Y$(S),nc(p)},b.prototype.leaveBlur=function(S){Nk(S),nc(p)},b.prototype.enterSelect=function(S){K$(S),nc(p)},b.prototype.leaveSelect=function(S){Q$(S),nc(p)},b.prototype.getModel=function(){return p.getModel()},b.prototype.getViewOfComponentModel=function(S){return p.getViewOfComponentModel(S)},b.prototype.getViewOfSeriesModel=function(S){return p.getViewOfSeriesModel(S)},b})(U7))(p)},B9=function(p){function y(b,S){for(var C=0;C<b.length;C++){var E=b[C];E[pI]=S}}se(Z1,function(b,S){p._messageCenter.on(S,function(C){if(UA[p.group]&&p[pI]!==vF){if(C&&C.escapeConnect)return;var E=p.makeActionFromEvent(C),P=[];se(ay,function(O){O!==p&&O.group===p.group&&P.push(O)}),y(P,vF),se(P,function(O){O[pI]!==Ppe&&O.dispatchAction(E)}),y(P,Rpe)}})})}})(),e})(Cc),dL=zA.prototype;dL.on=D9("on");dL.off=D9("off");dL.one=function(r,e,t){var i=this;function n(){for(var a=[],s=0;s<arguments.length;s++)a[s]=arguments[s];e&&e.apply&&e.apply(this,a),i.off(r,n)}this.on.call(this,r,n,t)};var Dpe=["click","dblclick","mouseover","mouseout","mousemove","mousedown","mouseup","globalout","contextmenu"];var FA={},Z1={},_3=[],b3=[],VA=[],z9={},x3={},ay={},UA={},kpe=+new Date-0,Lpe=+new Date-0,pL="_echarts_instance_";function Ope(r,e,t){var i=!(t&&t.ssr);if(i){var n=gL(r);if(n)return n}var a=new zA(r,e,t);return a.id="ec_"+kpe++,ay[a.id]=a,i&&D$(r,pL,a.id),B9(a),_h.trigger("afterinit",a),a}function Npe(r){if(xt(r)){var e=r;r=null,se(e,function(t){t.group!=null&&(r=t.group)}),r=r||"g_"+Lpe++,se(e,function(t){t.group=r})}return UA[r]=!0,r}function F9(r){UA[r]=!1}var Bpe=F9;function zpe(r){$t(r)?r=ay[r]:r instanceof zA||(r=gL(r)),r instanceof zA&&!r.isDisposed()&&r.dispose()}function gL(r){return ay[Zue(r,pL)]}function Fpe(r){return ay[r]}function vL(r,e){z9[r]=e}function mL(r){Or(b3,r)<0&&b3.push(r)}function yL(r,e){_L(_3,r,e,Spe)}function V9(r){JC("afterinit",r)}function U9(r){JC("afterupdate",r)}function JC(r,e){_h.on(r,e)}function Lh(r,e,t){sr(e)&&(t=e,e="");var i=cr(r)?r.type:[r,r={event:e}][0];r.event=(r.event||i).toLowerCase(),e=r.event,!Z1[e]&&(Is(gF.test(i)&&gF.test(e)),FA[i]||(FA[i]={action:t,actionInfo:r}),Z1[e]=i)}function H9(r,e){vb.register(r,e)}function Vpe(r){var e=vb.get(r);if(e)return e.getDimensionsInfo?e.getDimensionsInfo():e.dimensions.slice()}function j9(r,e){_L(VA,r,e,E9,"layout")}function Kg(r,e){_L(VA,r,e,I9,"visual")}var wF=[];function _L(r,e,t,i,n){if((sr(e)||cr(e))&&(t=e,e=i),!(Or(wF,t)>=0)){wF.push(t);var a=p9.wrapStageHandler(t,n);a.__prio=e,a.__raw=t,r.push(a)}}function bL(r,e){x3[r]=e}function Upe(r){Bj({createCanvas:r})}function $9(r,e,t){var i=M9("registerMap");i&&i(r,e,t)}function Hpe(r){var e=M9("getMap");return e&&e(r)}var W9=Jfe;Kg(fL,Ade);Kg(QC,Cde);Kg(QC,Mde);Kg(fL,Vde);Kg(QC,Ude);Kg(P9,gpe);mL(j7);yL(xpe,kfe);bL("default",Ede);Lh({type:iy,event:iy,update:iy},ca);Lh({type:O2,event:O2,update:O2},ca);Lh({type:j1,event:j1,update:j1},ca);Lh({type:N2,event:N2,update:N2},ca);Lh({type:$1,event:$1,update:$1},ca);vL("light",zde);vL("dark",y9);var jpe={},SF=[],$pe={registerPreprocessor:mL,registerProcessor:yL,registerPostInit:V9,registerPostUpdate:U9,registerUpdateLifecycle:JC,registerAction:Lh,registerCoordinateSystem:H9,registerLayout:j9,registerVisual:Kg,registerTransform:W9,registerLoading:bL,registerMap:$9,registerImpl:vpe,PRIORITY:R9,ComponentModel:Wr,ComponentView:vn,SeriesModel:Xi,ChartView:Fi,registerComponentModel:function(r){Wr.registerClass(r)},registerComponentView:function(r){vn.registerClass(r)},registerSeriesModel:function(r){Xi.registerClass(r)},registerChartView:function(r){Fi.registerClass(r)},registerSubTypeDefaulter:function(r,e){Wr.registerSubTypeDefaulter(r,e)},registerPainter:function(r,e){_$(r,e)}};function Vr(r){if(xt(r)){se(r,function(e){Vr(e)});return}Or(SF,r)>=0||(SF.push(r),sr(r)&&(r={install:r}),r.install($pe))}function $x(r){return r==null?0:r.length||1}function TF(r){return r}var fp=(function(){function r(e,t,i,n,a,s){this._old=e,this._new=t,this._oldKeyGetter=i||TF,this._newKeyGetter=n||TF,this.context=a,this._diffModeMultiple=s==="multiple"}return r.prototype.add=function(e){return this._add=e,this},r.prototype.update=function(e){return this._update=e,this},r.prototype.updateManyToOne=function(e){return this._updateManyToOne=e,this},r.prototype.updateOneToMany=function(e){return this._updateOneToMany=e,this},r.prototype.updateManyToMany=function(e){return this._updateManyToMany=e,this},r.prototype.remove=function(e){return this._remove=e,this},r.prototype.execute=function(){this[this._diffModeMultiple?"_executeMultiple":"_executeOneToOne"]()},r.prototype._executeOneToOne=function(){var e=this._old,t=this._new,i={},n=new Array(e.length),a=new Array(t.length);this._initIndexMap(e,null,n,"_oldKeyGetter"),this._initIndexMap(t,i,a,"_newKeyGetter");for(var s=0;s<e.length;s++){var o=n[s],l=i[o],c=$x(l);if(c>1){var f=l.shift();l.length===1&&(i[o]=l[0]),this._update&&this._update(f,s)}else c===1?(i[o]=null,this._update&&this._update(l,s)):this._remove&&this._remove(s)}this._performRestAdd(a,i)},r.prototype._executeMultiple=function(){var e=this._old,t=this._new,i={},n={},a=[],s=[];this._initIndexMap(e,i,a,"_oldKeyGetter"),this._initIndexMap(t,n,s,"_newKeyGetter");for(var o=0;o<a.length;o++){var l=a[o],c=i[l],f=n[l],p=$x(c),y=$x(f);if(p>1&&y===1)this._updateManyToOne&&this._updateManyToOne(f,c),n[l]=null;else if(p===1&&y>1)this._updateOneToMany&&this._updateOneToMany(f,c),n[l]=null;else if(p===1&&y===1)this._update&&this._update(f,c),n[l]=null;else if(p>1&&y>1)this._updateManyToMany&&this._updateManyToMany(f,c),n[l]=null;else if(p>1)for(var b=0;b<p;b++)this._remove&&this._remove(c[b]);else this._remove&&this._remove(c)}this._performRestAdd(s,n)},r.prototype._performRestAdd=function(e,t){for(var i=0;i<e.length;i++){var n=e[i],a=t[n],s=$x(a);if(s>1)for(var o=0;o<s;o++)this._add&&this._add(a[o]);else s===1&&this._add&&this._add(a);t[n]=null}},r.prototype._initIndexMap=function(e,t,i,n){for(var a=this._diffModeMultiple,s=0;s<e.length;s++){var o="_ec_"+this[n](e[s],s);if(a||(i[s]=o),!!t){var l=t[o],c=$x(l);c===0?(t[o]=s,a&&i.push(o)):c===1?t[o]=[l,s]:l.push(s)}}},r})(),Wpe=(function(){function r(e,t){this._encode=e,this._schema=t}return r.prototype.get=function(){return{fullDimensions:this._getFullDimensionNames(),encode:this._encode}},r.prototype._getFullDimensionNames=function(){return this._cachedDimNames||(this._cachedDimNames=this._schema?this._schema.makeOutputDimensionNames():[]),this._cachedDimNames},r})();function Gpe(r,e){var t={},i=t.encode={},n=Qt(),a=[],s=[],o={};se(r.dimensions,function(y){var b=r.getDimensionInfo(y),S=b.coordDim;if(S){var C=b.coordDimIndex;bI(i,S)[C]=y,b.isExtraCoord||(n.set(S,1),Xpe(b.type)&&(a[0]=y),bI(o,S)[C]=r.getDimensionIndex(b.name)),b.defaultTooltip&&s.push(y)}L7.each(function(E,P){var O=bI(i,P),B=b.otherDims[P];B!=null&&B!==!1&&(O[B]=b.name)})});var l=[],c={};n.each(function(y,b){var S=i[b];c[b]=S[0],l=l.concat(S)}),t.dataDimsOnCoord=l,t.dataDimIndicesOnCoord=wt(l,function(y){return r.getDimensionInfo(y).storeDimIndex}),t.encodeFirstDimNotExtra=c;var f=i.label;f&&f.length&&(a=f.slice());var p=i.tooltip;return p&&p.length?s=p.slice():s.length||(s=a.slice()),i.defaultedLabel=a,i.defaultedTooltip=s,t.userOutput=new Wpe(o,e),t}function bI(r,e){return r.hasOwnProperty(e)||(r[e]=[]),r[e]}function HA(r){return r==="category"?"ordinal":r==="time"?"time":"float"}function Xpe(r){return!(r==="ordinal"||r==="time")}var U2=(function(){function r(e){this.otherDims={},e!=null&&mt(this,e)}return r})(),Zpe=fi(),qpe={float:"f",int:"i",ordinal:"o",number:"n",time:"t"},G9=(function(){function r(e){this.dimensions=e.dimensions,this._dimOmitted=e.dimensionOmitted,this.source=e.source,this._fullDimCount=e.fullDimensionCount,this._updateDimOmitted(e.dimensionOmitted)}return r.prototype.isDimensionOmitted=function(){return this._dimOmitted},r.prototype._updateDimOmitted=function(e){this._dimOmitted=e,e&&(this._dimNameMap||(this._dimNameMap=q9(this.source)))},r.prototype.getSourceDimensionIndex=function(e){return wr(this._dimNameMap.get(e),-1)},r.prototype.getSourceDimension=function(e){var t=this.source.dimensionsDefine;if(t)return t[e]},r.prototype.makeStoreSchema=function(){for(var e=this._fullDimCount,t=W7(this.source),i=!Y9(e),n="",a=[],s=0,o=0;s<e;s++){var l=void 0,c=void 0,f=void 0,p=this.dimensions[o];if(p&&p.storeDimIndex===s)l=t?p.name:null,c=p.type,f=p.ordinalMeta,o++;else{var y=this.getSourceDimension(s);y&&(l=t?y.name:null,c=y.type)}a.push({property:l,type:c,ordinalMeta:f}),t&&l!=null&&(!p||!p.isCalculationCoord)&&(n+=i?l.replace(/\`/g,"`1").replace(/\$/g,"`2"):l),n+="$",n+=qpe[c]||"f",f&&(n+=f.uid),n+="$"}var b=this.source,S=[b.seriesLayoutBy,b.startIndex,n].join("$$");return{dimensions:a,hash:S}},r.prototype.makeOutputDimensionNames=function(){for(var e=[],t=0,i=0;t<this._fullDimCount;t++){var n=void 0,a=this.dimensions[i];if(a&&a.storeDimIndex===t)a.isCalculationCoord||(n=a.name),i++;else{var s=this.getSourceDimension(t);s&&(n=s.name)}e.push(n)}return e},r.prototype.appendCalculationDimension=function(e){this.dimensions.push(e),e.isCalculationCoord=!0,this._fullDimCount++,this._updateDimOmitted(!0)},r})();function X9(r){return r instanceof G9}function Z9(r){for(var e=Qt(),t=0;t<(r||[]).length;t++){var i=r[t],n=cr(i)?i.name:i;n!=null&&e.get(n)==null&&e.set(n,t)}return e}function q9(r){var e=Zpe(r);return e.dimNameMap||(e.dimNameMap=Z9(r.dimensionsDefine))}function Y9(r){return r>30}var Wx=cr,fg=wt,Ype=typeof Int32Array>"u"?Array:Int32Array,Kpe="e\0\0",AF=-1,Qpe=["hasItemOption","_nameList","_idList","_invertedIndicesMap","_dimSummary","userOutput","_rawData","_dimValueGetter","_nameDimIdx","_idDimIdx","_nameRepeatCount"],Jpe=["_approximateExtent"],CF,HT,Gx,Xx,xI,Zx,wI,Es=(function(){function r(e,t){this.type="list",this._dimOmitted=!1,this._nameList=[],this._idList=[],this._visual={},this._layout={},this._itemVisuals=[],this._itemLayouts=[],this._graphicEls=[],this._approximateExtent={},this._calculationInfo={},this.hasItemOption=!1,this.TRANSFERABLE_METHODS=["cloneShallow","downSample","minmaxDownSample","lttbDownSample","map"],this.CHANGABLE_METHODS=["filterSelf","selectRange"],this.DOWNSAMPLE_METHODS=["downSample","minmaxDownSample","lttbDownSample"];var i,n=!1;X9(e)?(i=e.dimensions,this._dimOmitted=e.isDimensionOmitted(),this._schema=e):(n=!0,i=e),i=i||["x","y"];for(var a={},s=[],o={},l=!1,c={},f=0;f<i.length;f++){var p=i[f],y=$t(p)?new U2({name:p}):p instanceof U2?p:new U2(p),b=y.name;y.type=y.type||"float",y.coordDim||(y.coordDim=b,y.coordDimIndex=0);var S=y.otherDims=y.otherDims||{};s.push(b),a[b]=y,c[b]!=null&&(l=!0),y.createInvertedIndices&&(o[b]=[]),S.itemName===0&&(this._nameDimIdx=f),S.itemId===0&&(this._idDimIdx=f),n&&(y.storeDimIndex=f)}if(this.dimensions=s,this._dimInfos=a,this._initGetDimensionInfo(l),this.hostModel=t,this._invertedIndicesMap=o,this._dimOmitted){var C=this._dimIdxToName=Qt();se(s,function(E){C.set(a[E].storeDimIndex,E)})}}return r.prototype.getDimension=function(e){var t=this._recognizeDimIndex(e);if(t==null)return e;if(t=e,!this._dimOmitted)return this.dimensions[t];var i=this._dimIdxToName.get(t);if(i!=null)return i;var n=this._schema.getSourceDimension(t);if(n)return n.name},r.prototype.getDimensionIndex=function(e){var t=this._recognizeDimIndex(e);if(t!=null)return t;if(e==null)return-1;var i=this._getDimInfo(e);return i?i.storeDimIndex:this._dimOmitted?this._schema.getSourceDimensionIndex(e):-1},r.prototype._recognizeDimIndex=function(e){if(di(e)||e!=null&&!isNaN(e)&&!this._getDimInfo(e)&&(!this._dimOmitted||this._schema.getSourceDimensionIndex(e)<0))return+e},r.prototype._getStoreDimIndex=function(e){var t=this.getDimensionIndex(e);return t},r.prototype.getDimensionInfo=function(e){return this._getDimInfo(this.getDimension(e))},r.prototype._initGetDimensionInfo=function(e){var t=this._dimInfos;this._getDimInfo=e?function(i){return t.hasOwnProperty(i)?t[i]:void 0}:function(i){return t[i]}},r.prototype.getDimensionsOnCoord=function(){return this._dimSummary.dataDimsOnCoord.slice()},r.prototype.mapDimension=function(e,t){var i=this._dimSummary;if(t==null)return i.encodeFirstDimNotExtra[e];var n=i.encode[e];return n?n[t]:null},r.prototype.mapDimensionsAll=function(e){var t=this._dimSummary,i=t.encode[e];return(i||[]).slice()},r.prototype.getStore=function(){return this._store},r.prototype.initData=function(e,t,i){var n=this,a;if(e instanceof f3&&(a=e),!a){var s=this.dimensions,o=aL(e)||es(e)?new G7(e,s.length):e;a=new f3;var l=fg(s,function(c){return{type:n._dimInfos[c].type,property:c}});a.initData(o,l,i)}this._store=a,this._nameList=(t||[]).slice(),this._idList=[],this._nameRepeatCount={},this._doInit(0,a.count()),this._dimSummary=Gpe(this,this._schema),this.userOutput=this._dimSummary.userOutput},r.prototype.appendData=function(e){var t=this._store.appendData(e);this._doInit(t[0],t[1])},r.prototype.appendValues=function(e,t){var i=this._store.appendValues(e,t&&t.length),n=i.start,a=i.end,s=this._shouldMakeIdFromName();if(this._updateOrdinalMeta(),t)for(var o=n;o<a;o++){var l=o-n;this._nameList[o]=t[l],s&&wI(this,o)}},r.prototype._updateOrdinalMeta=function(){for(var e=this._store,t=this.dimensions,i=0;i<t.length;i++){var n=this._dimInfos[t[i]];n.ordinalMeta&&e.collectOrdinalMeta(n.storeDimIndex,n.ordinalMeta)}},r.prototype._shouldMakeIdFromName=function(){var e=this._store.getProvider();return this._idDimIdx==null&&e.getSource().sourceFormat!==Bg&&!e.fillStorage},r.prototype._doInit=function(e,t){if(!(e>=t)){var i=this._store,n=i.getProvider();this._updateOrdinalMeta();var a=this._nameList,s=this._idList,o=n.getSource().sourceFormat,l=o===Ec;if(l&&!n.pure)for(var c=[],f=e;f<t;f++){var p=n.getItem(f,c);if(!this.hasItemOption&&Oue(p)&&(this.hasItemOption=!0),p){var y=p.name;a[f]==null&&y!=null&&(a[f]=Za(y,null));var b=p.id;s[f]==null&&b!=null&&(s[f]=Za(b,null))}}if(this._shouldMakeIdFromName())for(var f=e;f<t;f++)wI(this,f);CF(this)}},r.prototype.getApproximateExtent=function(e){return this._approximateExtent[e]||this._store.getDataExtent(this._getStoreDimIndex(e))},r.prototype.setApproximateExtent=function(e,t){t=this.getDimension(t),this._approximateExtent[t]=e.slice()},r.prototype.getCalculationInfo=function(e){return this._calculationInfo[e]},r.prototype.setCalculationInfo=function(e,t){Wx(e)?mt(this._calculationInfo,e):this._calculationInfo[e]=t},r.prototype.getName=function(e){var t=this.getRawIndex(e),i=this._nameList[t];return i==null&&this._nameDimIdx!=null&&(i=Gx(this,this._nameDimIdx,t)),i==null&&(i=""),i},r.prototype._getCategory=function(e,t){var i=this._store.get(e,t),n=this._store.getOrdinalMeta(e);return n?n.categories[i]:i},r.prototype.getId=function(e){return HT(this,this.getRawIndex(e))},r.prototype.count=function(){return this._store.count()},r.prototype.get=function(e,t){var i=this._store,n=this._dimInfos[e];if(n)return i.get(n.storeDimIndex,t)},r.prototype.getByRawIndex=function(e,t){var i=this._store,n=this._dimInfos[e];if(n)return i.getByRawIndex(n.storeDimIndex,t)},r.prototype.getIndices=function(){return this._store.getIndices()},r.prototype.getDataExtent=function(e){return this._store.getDataExtent(this._getStoreDimIndex(e))},r.prototype.getSum=function(e){return this._store.getSum(this._getStoreDimIndex(e))},r.prototype.getMedian=function(e){return this._store.getMedian(this._getStoreDimIndex(e))},r.prototype.getValues=function(e,t){var i=this,n=this._store;return xt(e)?n.getValues(fg(e,function(a){return i._getStoreDimIndex(a)}),t):n.getValues(e)},r.prototype.hasValue=function(e){for(var t=this._dimSummary.dataDimIndicesOnCoord,i=0,n=t.length;i<n;i++)if(isNaN(this._store.get(t[i],e)))return!1;return!0},r.prototype.indexOfName=function(e){for(var t=0,i=this._store.count();t<i;t++)if(this.getName(t)===e)return t;return-1},r.prototype.getRawIndex=function(e){return this._store.getRawIndex(e)},r.prototype.indexOfRawIndex=function(e){return this._store.indexOfRawIndex(e)},r.prototype.rawIndexOf=function(e,t){var i=e&&this._invertedIndicesMap[e],n=i&&i[t];return n==null||isNaN(n)?AF:n},r.prototype.indicesOfNearest=function(e,t,i){return this._store.indicesOfNearest(this._getStoreDimIndex(e),t,i)},r.prototype.each=function(e,t,i){sr(e)&&(i=t,t=e,e=[]);var n=i||this,a=fg(Xx(e),this._getStoreDimIndex,this);this._store.each(a,n?Xt(t,n):t)},r.prototype.filterSelf=function(e,t,i){sr(e)&&(i=t,t=e,e=[]);var n=i||this,a=fg(Xx(e),this._getStoreDimIndex,this);return this._store=this._store.filter(a,n?Xt(t,n):t),this},r.prototype.selectRange=function(e){var t=this,i={},n=qr(e);return se(n,function(a){var s=t._getStoreDimIndex(a);i[s]=e[a]}),this._store=this._store.selectRange(i),this},r.prototype.mapArray=function(e,t,i){sr(e)&&(i=t,t=e,e=[]),i=i||this;var n=[];return this.each(e,function(){n.push(t&&t.apply(this,arguments))},i),n},r.prototype.map=function(e,t,i,n){var a=i||n||this,s=fg(Xx(e),this._getStoreDimIndex,this),o=Zx(this);return o._store=this._store.map(s,a?Xt(t,a):t),o},r.prototype.modify=function(e,t,i,n){var a=i||n||this,s=fg(Xx(e),this._getStoreDimIndex,this);this._store.modify(s,a?Xt(t,a):t)},r.prototype.downSample=function(e,t,i,n){var a=Zx(this);return a._store=this._store.downSample(this._getStoreDimIndex(e),t,i,n),a},r.prototype.minmaxDownSample=function(e,t){var i=Zx(this);return i._store=this._store.minmaxDownSample(this._getStoreDimIndex(e),t),i},r.prototype.lttbDownSample=function(e,t){var i=Zx(this);return i._store=this._store.lttbDownSample(this._getStoreDimIndex(e),t),i},r.prototype.getRawDataItem=function(e){return this._store.getRawDataItem(e)},r.prototype.getItemModel=function(e){var t=this.hostModel,i=this.getRawDataItem(e);return new Si(i,t,t&&t.ecModel)},r.prototype.diff=function(e){var t=this;return new fp(e?e.getStore().getIndices():[],this.getStore().getIndices(),function(i){return HT(e,i)},function(i){return HT(t,i)})},r.prototype.getVisual=function(e){var t=this._visual;return t&&t[e]},r.prototype.setVisual=function(e,t){this._visual=this._visual||{},Wx(e)?mt(this._visual,e):this._visual[e]=t},r.prototype.getItemVisual=function(e,t){var i=this._itemVisuals[e],n=i&&i[t];return n??this.getVisual(t)},r.prototype.hasItemVisual=function(){return this._itemVisuals.length>0},r.prototype.ensureUniqueItemVisual=function(e,t){var i=this._itemVisuals,n=i[e];n||(n=i[e]={});var a=n[t];return a==null&&(a=this.getVisual(t),xt(a)?a=a.slice():Wx(a)&&(a=mt({},a)),n[t]=a),a},r.prototype.setItemVisual=function(e,t,i){var n=this._itemVisuals[e]||{};this._itemVisuals[e]=n,Wx(t)?mt(n,t):n[t]=i},r.prototype.clearAllVisual=function(){this._visual={},this._itemVisuals=[]},r.prototype.setLayout=function(e,t){Wx(e)?mt(this._layout,e):this._layout[e]=t},r.prototype.getLayout=function(e){return this._layout[e]},r.prototype.getItemLayout=function(e){return this._itemLayouts[e]},r.prototype.setItemLayout=function(e,t,i){this._itemLayouts[e]=i?mt(this._itemLayouts[e]||{},t):t},r.prototype.clearItemLayouts=function(){this._itemLayouts.length=0},r.prototype.setItemGraphicEl=function(e,t){var i=this.hostModel&&this.hostModel.seriesIndex;JR(i,this.dataType,e,t),this._graphicEls[e]=t},r.prototype.getItemGraphicEl=function(e){return this._graphicEls[e]},r.prototype.eachItemGraphicEl=function(e,t){se(this._graphicEls,function(i,n){i&&e&&e.call(t,i,n)})},r.prototype.cloneShallow=function(e){return e||(e=new r(this._schema?this._schema:fg(this.dimensions,this._getDimInfo,this),this.hostModel)),xI(e,this),e._store=this._store,e},r.prototype.wrapMethod=function(e,t){var i=this[e];sr(i)&&(this.__wrappedMethods=this.__wrappedMethods||[],this.__wrappedMethods.push(e),this[e]=function(){var n=i.apply(this,arguments);return t.apply(this,[n].concat(AC(arguments)))})},r.internalField=(function(){CF=function(e){var t=e._invertedIndicesMap;se(t,function(i,n){var a=e._dimInfos[n],s=a.ordinalMeta,o=e._store;if(s){i=t[n]=new Ype(s.categories.length);for(var l=0;l<i.length;l++)i[l]=AF;for(var l=0;l<o.count();l++)i[o.get(a.storeDimIndex,l)]=l}})},Gx=function(e,t,i){return Za(e._getCategory(t,i),null)},HT=function(e,t){var i=e._idList[t];return i==null&&e._idDimIdx!=null&&(i=Gx(e,e._idDimIdx,t)),i==null&&(i=Kpe+t),i},Xx=function(e){return xt(e)||(e=e!=null?[e]:[]),e},Zx=function(e){var t=new r(e._schema?e._schema:fg(e.dimensions,e._getDimInfo,e),e.hostModel);return xI(t,e),t},xI=function(e,t){se(Qpe.concat(t.__wrappedMethods||[]),function(i){t.hasOwnProperty(i)&&(e[i]=t[i])}),e.__wrappedMethods=t.__wrappedMethods,se(Jpe,function(i){e[i]=hr(t[i])}),e._calculationInfo=mt({},t._calculationInfo)},wI=function(e,t){var i=e._nameList,n=e._idList,a=e._nameDimIdx,s=e._idDimIdx,o=i[t],l=n[t];if(o==null&&a!=null&&(i[t]=o=Gx(e,a,t)),l==null&&s!=null&&(n[t]=l=Gx(e,s,t)),l==null&&o!=null){var c=e._nameRepeatCount,f=c[o]=(c[o]||0)+1;l=o,f>1&&(l+="__ec__"+f),n[t]=l}}})(),r})();function ege(r,e){return bb(r,e).dimensions}function bb(r,e){aL(r)||(r=oL(r)),e=e||{};var t=e.coordDimensions||[],i=e.dimensionsDefine||r.dimensionsDefine||[],n=Qt(),a=[],s=rge(r,t,i,e.dimensionsCount),o=e.canOmitUnusedDimensions&&Y9(s),l=i===r.dimensionsDefine,c=l?q9(r):Z9(i),f=e.encodeDefine;!f&&e.encodeDefaulter&&(f=e.encodeDefaulter(r,s));for(var p=Qt(f),y=new e9(s),b=0;b<y.length;b++)y[b]=-1;function S(ee){var te=y[ee];if(te<0){var ae=i[ee],de=cr(ae)?ae:{name:ae},ve=new U2,ye=de.name;ye!=null&&c.get(ye)!=null&&(ve.name=ve.displayName=ye),de.type!=null&&(ve.type=de.type),de.displayName!=null&&(ve.displayName=de.displayName);var Ae=a.length;return y[ee]=Ae,ve.storeDimIndex=ee,a.push(ve),ve}return a[te]}if(!o)for(var b=0;b<s;b++)S(b);p.each(function(ee,te){var ae=Gi(ee).slice();if(ae.length===1&&!$t(ae[0])&&ae[0]<0){p.set(te,!1);return}var de=p.set(te,[]);se(ae,function(ve,ye){var Ae=$t(ve)?c.get(ve):ve;Ae!=null&&Ae<s&&(de[ye]=Ae,E(S(Ae),te,ye))})});var C=0;se(t,function(ee){var te,ae,de,ve;if($t(ee))te=ee,ve={};else{ve=ee,te=ve.name;var ye=ve.ordinalMeta;ve.ordinalMeta=null,ve=mt({},ve),ve.ordinalMeta=ye,ae=ve.dimsDef,de=ve.otherDims,ve.name=ve.coordDim=ve.coordDimIndex=ve.dimsDef=ve.otherDims=null}var Ae=p.get(te);if(Ae!==!1){if(Ae=Gi(Ae),!Ae.length)for(var me=0;me<(ae&&ae.length||1);me++){for(;C<s&&S(C).coordDim!=null;)C++;C<s&&Ae.push(C++)}se(Ae,function(De,Fe){var je=S(De);if(l&&ve.type!=null&&(je.type=ve.type),E(lr(je,ve),te,Fe),je.name==null&&ae){var ct=ae[Fe];!cr(ct)&&(ct={name:ct}),je.name=je.displayName=ct.name,je.defaultTooltip=ct.defaultTooltip}de&&lr(je.otherDims,de)})}});function E(ee,te,ae){L7.get(te)!=null?ee.otherDims[te]=ae:(ee.coordDim=te,ee.coordDimIndex=ae,n.set(te,!0))}var P=e.generateCoord,O=e.generateCoordCount,B=O!=null;O=P?O||1:0;var F=P||"value";function W(ee){ee.name==null&&(ee.name=ee.coordDim)}if(o)se(a,function(ee){W(ee)}),a.sort(function(ee,te){return ee.storeDimIndex-te.storeDimIndex});else for(var $=0;$<s;$++){var q=S($),Q=q.coordDim;Q==null&&(q.coordDim=ige(F,n,B),q.coordDimIndex=0,(!P||O<=0)&&(q.isExtraCoord=!0),O--),W(q),q.type==null&&(z7(r,$)===Jo.Must||q.isExtraCoord&&(q.otherDims.itemName!=null||q.otherDims.seriesName!=null))&&(q.type="ordinal")}return tge(a),new G9({source:r,dimensions:a,fullDimensionCount:s,dimensionOmitted:o})}function tge(r){for(var e=Qt(),t=0;t<r.length;t++){var i=r[t],n=i.name,a=e.get(n)||0;a>0&&(i.name=n+(a-1)),a++,e.set(n,a)}}function rge(r,e,t,i){var n=Math.max(r.dimensionsDetectedCount||1,e.length,t.length,i||0);return se(e,function(a){var s;cr(a)&&(s=a.dimsDef)&&(n=Math.max(n,s.length))}),n}function ige(r,e,t){if(t||e.hasKey(r)){for(var i=0;e.hasKey(r+i);)i++;r+=i}return e.set(r,!0),r}var nge=(function(){function r(e){this.coordSysDims=[],this.axisMap=Qt(),this.categoryAxisMap=Qt(),this.coordSysName=e}return r})();function age(r){var e=r.get("coordinateSystem"),t=new nge(e),i=oge[e];if(i)return i(r,t,t.axisMap,t.categoryAxisMap),t}var oge={cartesian2d:function(r,e,t,i){var n=r.getReferringComponents("xAxis",ka).models[0],a=r.getReferringComponents("yAxis",ka).models[0];e.coordSysDims=["x","y"],t.set("x",n),t.set("y",a),Y_(n)&&(i.set("x",n),e.firstCategoryDimIndex=0),Y_(a)&&(i.set("y",a),e.firstCategoryDimIndex==null&&(e.firstCategoryDimIndex=1))},singleAxis:function(r,e,t,i){var n=r.getReferringComponents("singleAxis",ka).models[0];e.coordSysDims=["single"],t.set("single",n),Y_(n)&&(i.set("single",n),e.firstCategoryDimIndex=0)},polar:function(r,e,t,i){var n=r.getReferringComponents("polar",ka).models[0],a=n.findAxisModel("radiusAxis"),s=n.findAxisModel("angleAxis");e.coordSysDims=["radius","angle"],t.set("radius",a),t.set("angle",s),Y_(a)&&(i.set("radius",a),e.firstCategoryDimIndex=0),Y_(s)&&(i.set("angle",s),e.firstCategoryDimIndex==null&&(e.firstCategoryDimIndex=1))},geo:function(r,e,t,i){e.coordSysDims=["lng","lat"]},parallel:function(r,e,t,i){var n=r.ecModel,a=n.getComponent("parallel",r.get("parallelIndex")),s=e.coordSysDims=a.dimensions.slice();se(a.parallelAxisIndex,function(o,l){var c=n.getComponent("parallelAxis",o),f=s[l];t.set(f,c),Y_(c)&&(i.set(f,c),e.firstCategoryDimIndex==null&&(e.firstCategoryDimIndex=l))})}};function Y_(r){return r.get("type")==="category"}function K9(r,e,t){t=t||{};var i=t.byIndex,n=t.stackedCoordDimension,a,s,o;sge(e)?a=e:(s=e.schema,a=s.dimensions,o=e.store);var l=!!(r&&r.get("stack")),c,f,p,y;if(se(a,function(O,B){$t(O)&&(a[B]=O={name:O}),l&&!O.isExtraCoord&&(!i&&!c&&O.ordinalMeta&&(c=O),!f&&O.type!=="ordinal"&&O.type!=="time"&&(!n||n===O.coordDim)&&(f=O))}),f&&!i&&!c&&(i=!0),f){p="__\0ecstackresult_"+r.id,y="__\0ecstackedover_"+r.id,c&&(c.createInvertedIndices=!0);var b=f.coordDim,S=f.type,C=0;se(a,function(O){O.coordDim===b&&C++});var E={name:p,coordDim:b,coordDimIndex:C,type:S,isExtraCoord:!0,isCalculationCoord:!0,storeDimIndex:a.length},P={name:y,coordDim:y,coordDimIndex:C+1,type:S,isExtraCoord:!0,isCalculationCoord:!0,storeDimIndex:a.length+1};s?(o&&(E.storeDimIndex=o.ensureCalculationDimension(y,S),P.storeDimIndex=o.ensureCalculationDimension(p,S)),s.appendCalculationDimension(E),s.appendCalculationDimension(P)):(a.push(E),a.push(P))}return{stackedDimension:f&&f.name,stackedByDimension:c&&c.name,isStackedByIndex:i,stackedOverDimension:y,stackResultDimension:p}}function sge(r){return!X9(r.schema)}function dp(r,e){return!!e&&e===r.getCalculationInfo("stackedDimension")}function xL(r,e){return dp(r,e)?r.getCalculationInfo("stackResultDimension"):e}function lge(r,e){var t=r.get("coordinateSystem"),i=vb.get(t),n;return e&&e.coordSysDims&&(n=wt(e.coordSysDims,function(a){var s={name:a},o=e.axisMap.get(a);if(o){var l=o.get("type");s.type=HA(l)}return s})),n||(n=i&&(i.getDimensionsInfo?i.getDimensionsInfo():i.dimensions.slice())||["x","y"]),n}function uge(r,e,t){var i,n;return t&&se(r,function(a,s){var o=a.coordDim,l=t.categoryAxisMap.get(o);l&&(i==null&&(i=s),a.ordinalMeta=l.getOrdinalMeta(),e&&(a.createInvertedIndices=!0)),a.otherDims.itemName!=null&&(n=!0)}),!n&&i!=null&&(r[i].otherDims.itemName=0),i}function Gf(r,e,t){t=t||{};var i=e.getSourceManager(),n,a=!1;r?(a=!0,n=oL(r)):(n=i.getSource(),a=n.sourceFormat===Ec);var s=age(e),o=lge(e,s),l=t.useEncodeDefaulter,c=sr(l)?l:l?Sr(B7,o,e):null,f={coordDimensions:o,generateCoord:t.generateCoord,encodeDefine:e.getEncode(),encodeDefaulter:c,canOmitUnusedDimensions:!a},p=bb(n,f),y=uge(p.dimensions,t.createInvertedIndices,s),b=a?null:i.getSharedDataStore(p),S=K9(e,{schema:p,store:b}),C=new Es(p,e);C.setCalculationInfo(S);var E=y!=null&&cge(n)?function(P,O,B,F){return F===y?B:this.defaultDimValueGetter(P,O,B,F)}:null;return C.hasItemOption=!1,C.initData(a?n:b,null,E),C}function cge(r){if(r.sourceFormat===Ec){var e=hge(r.data||[]);return!xt(ab(e))}}function hge(r){for(var e=0;e<r.length&&r[e]==null;)e++;return r[e]}var Xf=(function(){function r(e){this._setting=e||{},this._extent=[1/0,-1/0]}return r.prototype.getSetting=function(e){return this._setting[e]},r.prototype.unionExtent=function(e){var t=this._extent;e[0]<t[0]&&(t[0]=e[0]),e[1]>t[1]&&(t[1]=e[1])},r.prototype.unionExtentFromData=function(e,t){this.unionExtent(e.getApproximateExtent(t))},r.prototype.getExtent=function(){return this._extent.slice()},r.prototype.setExtent=function(e,t){var i=this._extent;isNaN(e)||(i[0]=e),isNaN(t)||(i[1]=t)},r.prototype.isInExtentRange=function(e){return this._extent[0]<=e&&this._extent[1]>=e},r.prototype.isBlank=function(){return this._isBlank},r.prototype.setBlank=function(e){this._isBlank=e},r})();kC(Xf);var fge=0,w3=(function(){function r(e){this.categories=e.categories||[],this._needCollect=e.needCollect,this._deduplication=e.deduplication,this.uid=++fge}return r.createByAxisModel=function(e){var t=e.option,i=t.data,n=i&&wt(i,dge);return new r({categories:n,needCollect:!n,deduplication:t.dedplication!==!1})},r.prototype.getOrdinal=function(e){return this._getOrCreateMap().get(e)},r.prototype.parseAndCollect=function(e){var t,i=this._needCollect;if(!$t(e)&&!i)return e;if(i&&!this._deduplication)return t=this.categories.length,this.categories[t]=e,t;var n=this._getOrCreateMap();return t=n.get(e),t==null&&(i?(t=this.categories.length,this.categories[t]=e,n.set(e,t)):t=NaN),t},r.prototype._getOrCreateMap=function(){return this._map||(this._map=Qt(this.categories))},r})();function dge(r){return cr(r)&&r.value!=null?r.value:r+""}function S3(r){return r.type==="interval"||r.type==="log"}function pge(r,e,t,i){var n={},a=r[1]-r[0],s=n.interval=Ck(a/e,!0);t!=null&&s<t&&(s=n.interval=t),i!=null&&s>i&&(s=n.interval=i);var o=n.intervalPrecision=Q9(s),l=n.niceTickExtent=[Qn(Math.ceil(r[0]/s)*s,o),Qn(Math.floor(r[1]/s)*s,o)];return gge(l,r),n}function SI(r){var e=Math.pow(10,DC(r)),t=r/e;return t?t===2?t=3:t===3?t=5:t*=2:t=1,Qn(t*e)}function Q9(r){return wh(r)+2}function MF(r,e,t){r[e]=Math.max(Math.min(r[e],t[1]),t[0])}function gge(r,e){!isFinite(r[0])&&(r[0]=e[0]),!isFinite(r[1])&&(r[1]=e[1]),MF(r,0,e),MF(r,1,e),r[0]>r[1]&&(r[0]=r[1])}function eM(r,e){return r>=e[0]&&r<=e[1]}function tM(r,e){return e[1]===e[0]?.5:(r-e[0])/(e[1]-e[0])}function rM(r,e){return r*(e[1]-e[0])+e[0]}var iM=(function(r){Ye(e,r);function e(t){var i=r.call(this,t)||this;i.type="ordinal";var n=i.getSetting("ordinalMeta");return n||(n=new w3({})),xt(n)&&(n=new w3({categories:wt(n,function(a){return cr(a)?a.value:a})})),i._ordinalMeta=n,i._extent=i.getSetting("extent")||[0,n.categories.length-1],i}return e.prototype.parse=function(t){return t==null?NaN:$t(t)?this._ordinalMeta.getOrdinal(t):Math.round(t)},e.prototype.contain=function(t){return t=this.parse(t),eM(t,this._extent)&&this._ordinalMeta.categories[t]!=null},e.prototype.normalize=function(t){return t=this._getTickNumber(this.parse(t)),tM(t,this._extent)},e.prototype.scale=function(t){return t=Math.round(rM(t,this._extent)),this.getRawOrdinalNumber(t)},e.prototype.getTicks=function(){for(var t=[],i=this._extent,n=i[0];n<=i[1];)t.push({value:n}),n++;return t},e.prototype.getMinorTicks=function(t){},e.prototype.setSortInfo=function(t){if(t==null){this._ordinalNumbersByTick=this._ticksByOrdinalNumber=null;return}for(var i=t.ordinalNumbers,n=this._ordinalNumbersByTick=[],a=this._ticksByOrdinalNumber=[],s=0,o=this._ordinalMeta.categories.length,l=Math.min(o,i.length);s<l;++s){var c=i[s];n[s]=c,a[c]=s}for(var f=0;s<o;++s){for(;a[f]!=null;)f++;n.push(f),a[f]=s}},e.prototype._getTickNumber=function(t){var i=this._ticksByOrdinalNumber;return i&&t>=0&&t<i.length?i[t]:t},e.prototype.getRawOrdinalNumber=function(t){var i=this._ordinalNumbersByTick;return i&&t>=0&&t<i.length?i[t]:t},e.prototype.getLabel=function(t){if(!this.isBlank()){var i=this.getRawOrdinalNumber(t.value),n=this._ordinalMeta.categories[i];return n==null?"":n+""}},e.prototype.count=function(){return this._extent[1]-this._extent[0]+1},e.prototype.unionExtentFromData=function(t,i){this.unionExtent(t.getApproximateExtent(i))},e.prototype.isInExtentRange=function(t){return t=this._getTickNumber(t),this._extent[0]<=t&&this._extent[1]>=t},e.prototype.getOrdinalMeta=function(){return this._ordinalMeta},e.prototype.calcNiceTicks=function(){},e.prototype.calcNiceExtent=function(){},e.type="ordinal",e})(Xf);Xf.registerClass(iM);var wm=Qn,pp=(function(r){Ye(e,r);function e(){var t=r!==null&&r.apply(this,arguments)||this;return t.type="interval",t._interval=0,t._intervalPrecision=2,t}return e.prototype.parse=function(t){return t},e.prototype.contain=function(t){return eM(t,this._extent)},e.prototype.normalize=function(t){return tM(t,this._extent)},e.prototype.scale=function(t){return rM(t,this._extent)},e.prototype.setExtent=function(t,i){var n=this._extent;isNaN(t)||(n[0]=parseFloat(t)),isNaN(i)||(n[1]=parseFloat(i))},e.prototype.unionExtent=function(t){var i=this._extent;t[0]<i[0]&&(i[0]=t[0]),t[1]>i[1]&&(i[1]=t[1]),this.setExtent(i[0],i[1])},e.prototype.getInterval=function(){return this._interval},e.prototype.setInterval=function(t){this._interval=t,this._niceExtent=this._extent.slice(),this._intervalPrecision=Q9(t)},e.prototype.getTicks=function(t){var i=this._interval,n=this._extent,a=this._niceExtent,s=this._intervalPrecision,o=[];if(!i)return o;var l=1e4;n[0]<a[0]&&(t?o.push({value:wm(a[0]-i,s)}):o.push({value:n[0]}));for(var c=a[0];c<=a[1]&&(o.push({value:c}),c=wm(c+i,s),c!==o[o.length-1].value);)if(o.length>l)return[];var f=o.length?o[o.length-1].value:a[1];return n[1]>f&&(t?o.push({value:wm(f+i,s)}):o.push({value:n[1]})),o},e.prototype.getMinorTicks=function(t){for(var i=this.getTicks(!0),n=[],a=this.getExtent(),s=1;s<i.length;s++){for(var o=i[s],l=i[s-1],c=0,f=[],p=o.value-l.value,y=p/t;c<t-1;){var b=wm(l.value+(c+1)*y);b>a[0]&&b<a[1]&&f.push(b),c++}n.push(f)}return n},e.prototype.getLabel=function(t,i){if(t==null)return"";var n=i&&i.precision;n==null?n=wh(t.value)||0:n==="auto"&&(n=this._intervalPrecision);var a=wm(t.value,n,!0);return Kk(a)},e.prototype.calcNiceTicks=function(t,i,n){t=t||5;var a=this._extent,s=a[1]-a[0];if(isFinite(s)){s<0&&(s=-s,a.reverse());var o=pge(a,t,i,n);this._intervalPrecision=o.intervalPrecision,this._interval=o.interval,this._niceExtent=o.niceTickExtent}},e.prototype.calcNiceExtent=function(t){var i=this._extent;if(i[0]===i[1])if(i[0]!==0){var n=Math.abs(i[0]);t.fixMax||(i[1]+=n/2),i[0]-=n/2}else i[1]=1;var a=i[1]-i[0];isFinite(a)||(i[0]=0,i[1]=1),this.calcNiceTicks(t.splitNumber,t.minInterval,t.maxInterval);var s=this._interval;t.fixMin||(i[0]=wm(Math.floor(i[0]/s)*s)),t.fixMax||(i[1]=wm(Math.ceil(i[1]/s)*s))},e.prototype.setNiceExtent=function(t,i){this._niceExtent=[t,i]},e.type="interval",e})(Xf);Xf.registerClass(pp);var J9=typeof Float32Array<"u",vge=J9?Float32Array:Array;function Of(r){return xt(r)?J9?new Float32Array(r):r:new vge(r)}var T3="__ec_stack_";function eW(r){return r.get("stack")||T3+r.seriesIndex}function wL(r){return r.dim+r.index}function mge(r){var e=[],t=r.axis,i="axis0";if(t.type==="category"){for(var n=t.getBandWidth(),a=0;a<r.count;a++)e.push(lr({bandWidth:n,axisKey:i,stackId:T3+a},r));for(var s=iW(e),o=[],a=0;a<r.count;a++){var l=s[i][T3+a];l.offsetCenter=l.offset+l.width/2,o.push(l)}return o}}function tW(r,e){var t=[];return e.eachSeriesByType(r,function(i){oW(i)&&t.push(i)}),t}function yge(r){var e={};se(r,function(l){var c=l.coordinateSystem,f=c.getBaseAxis();if(!(f.type!=="time"&&f.type!=="value"))for(var p=l.getData(),y=f.dim+"_"+f.index,b=p.getDimensionIndex(p.mapDimension(f.dim)),S=p.getStore(),C=0,E=S.count();C<E;++C){var P=S.get(b,C);e[y]?e[y].push(P):e[y]=[P]}});var t={};for(var i in e)if(e.hasOwnProperty(i)){var n=e[i];if(n){n.sort(function(l,c){return l-c});for(var a=null,s=1;s<n.length;++s){var o=n[s]-n[s-1];o>0&&(a=a===null?o:Math.min(a,o))}t[i]=a}}return t}function rW(r){var e=yge(r),t=[];return se(r,function(i){var n=i.coordinateSystem,a=n.getBaseAxis(),s=a.getExtent(),o;if(a.type==="category")o=a.getBandWidth();else if(a.type==="value"||a.type==="time"){var l=a.dim+"_"+a.index,c=e[l],f=Math.abs(s[1]-s[0]),p=a.scale.getExtent(),y=Math.abs(p[1]-p[0]);o=c?f/y*c:f}else{var b=i.getData();o=Math.abs(s[1]-s[0])/b.count()}var S=Vt(i.get("barWidth"),o),C=Vt(i.get("barMaxWidth"),o),E=Vt(i.get("barMinWidth")||(sW(i)?.5:1),o),P=i.get("barGap"),O=i.get("barCategoryGap");t.push({bandWidth:o,barWidth:S,barMaxWidth:C,barMinWidth:E,barGap:P,barCategoryGap:O,axisKey:wL(a),stackId:eW(i)})}),iW(t)}function iW(r){var e={};se(r,function(i,n){var a=i.axisKey,s=i.bandWidth,o=e[a]||{bandWidth:s,remainedWidth:s,autoWidthCount:0,categoryGap:null,gap:"20%",stacks:{}},l=o.stacks;e[a]=o;var c=i.stackId;l[c]||o.autoWidthCount++,l[c]=l[c]||{width:0,maxWidth:0};var f=i.barWidth;f&&!l[c].width&&(l[c].width=f,f=Math.min(o.remainedWidth,f),o.remainedWidth-=f);var p=i.barMaxWidth;p&&(l[c].maxWidth=p);var y=i.barMinWidth;y&&(l[c].minWidth=y);var b=i.barGap;b!=null&&(o.gap=b);var S=i.barCategoryGap;S!=null&&(o.categoryGap=S)});var t={};return se(e,function(i,n){t[n]={};var a=i.stacks,s=i.bandWidth,o=i.categoryGap;if(o==null){var l=qr(a).length;o=Math.max(35-l*4,15)+"%"}var c=Vt(o,s),f=Vt(i.gap,1),p=i.remainedWidth,y=i.autoWidthCount,b=(p-c)/(y+(y-1)*f);b=Math.max(b,0),se(a,function(P){var O=P.maxWidth,B=P.minWidth;if(P.width){var F=P.width;O&&(F=Math.min(F,O)),B&&(F=Math.max(F,B)),P.width=F,p-=F+f*F,y--}else{var F=b;O&&O<F&&(F=Math.min(O,p)),B&&B>F&&(F=B),F!==b&&(P.width=F,p-=F+f*F,y--)}}),b=(p-c)/(y+(y-1)*f),b=Math.max(b,0);var S=0,C;se(a,function(P,O){P.width||(P.width=b),C=P,S+=P.width*(1+f)}),C&&(S-=C.width*f);var E=-S/2;se(a,function(P,O){t[n][O]=t[n][O]||{bandWidth:s,offset:E,width:P.width},E+=P.width*(1+f)})}),t}function _ge(r,e,t){if(r&&e){var i=r[wL(e)];return i}}function nW(r,e){var t=tW(r,e),i=rW(t);se(t,function(n){var a=n.getData(),s=n.coordinateSystem,o=s.getBaseAxis(),l=eW(n),c=i[wL(o)][l],f=c.offset,p=c.width;a.setLayout({bandWidth:c.bandWidth,offset:f,size:p})})}function aW(r){return{seriesType:r,plan:mb(),reset:function(e){if(oW(e)){var t=e.getData(),i=e.coordinateSystem,n=i.getBaseAxis(),a=i.getOtherAxis(n),s=t.getDimensionIndex(t.mapDimension(a.dim)),o=t.getDimensionIndex(t.mapDimension(n.dim)),l=e.get("showBackground",!0),c=t.mapDimension(a.dim),f=t.getCalculationInfo("stackResultDimension"),p=dp(t,c)&&!!t.getCalculationInfo("stackedOnSeries"),y=a.isHorizontal(),b=bge(n,a),S=sW(e),C=e.get("barMinHeight")||0,E=f&&t.getDimensionIndex(f),P=t.getLayout("size"),O=t.getLayout("offset");return{progress:function(B,F){for(var W=B.count,$=S&&Of(W*3),q=S&&l&&Of(W*3),Q=S&&Of(W),ee=i.master.getRect(),te=y?ee.width:ee.height,ae,de=F.getStore(),ve=0;(ae=B.next())!=null;){var ye=de.get(p?E:s,ae),Ae=de.get(o,ae),me=b,De=void 0;p&&(De=+ye-de.get(s,ae));var Fe=void 0,je=void 0,ct=void 0,xe=void 0;if(y){var $e=i.dataToPoint([ye,Ae]);if(p){var pt=i.dataToPoint([De,Ae]);me=pt[0]}Fe=me,je=$e[1]+O,ct=$e[0]-me,xe=P,Math.abs(ct)<C&&(ct=(ct<0?-1:1)*C)}else{var $e=i.dataToPoint([Ae,ye]);if(p){var pt=i.dataToPoint([Ae,De]);me=pt[1]}Fe=$e[0]+O,je=me,ct=P,xe=$e[1]-me,Math.abs(xe)<C&&(xe=(xe<=0?-1:1)*C)}S?($[ve]=Fe,$[ve+1]=je,$[ve+2]=y?ct:xe,q&&(q[ve]=y?ee.x:Fe,q[ve+1]=y?je:ee.y,q[ve+2]=te),Q[ae]=ae):F.setItemLayout(ae,{x:Fe,y:je,width:ct,height:xe}),ve+=3}S&&F.setLayout({largePoints:$,largeDataIndices:Q,largeBackgroundPoints:q,valueAxisHorizontal:y})}}}}}}function oW(r){return r.coordinateSystem&&r.coordinateSystem.type==="cartesian2d"}function sW(r){return r.pipelineContext&&r.pipelineContext.large}function bge(r,e){var t=e.model.get("startValue");return t||(t=0),e.toGlobalCoord(e.dataToCoord(e.type==="log"?t>0?t:1:t))}var xge=function(r,e,t,i){for(;t<i;){var n=t+i>>>1;r[n][1]<e?t=n+1:i=n}return t},SL=(function(r){Ye(e,r);function e(t){var i=r.call(this,t)||this;return i.type="time",i}return e.prototype.getLabel=function(t){var i=this.getSetting("useUTC");return Qw(t.value,yz[Khe(R0(this._minLevelUnit))]||yz.second,i,this.getSetting("locale"))},e.prototype.getFormattedLabel=function(t,i,n){var a=this.getSetting("useUTC"),s=this.getSetting("locale");return Qhe(t,i,n,s,a)},e.prototype.getTicks=function(){var t=this._interval,i=this._extent,n=[];if(!t)return n;n.push({value:i[0],level:0});var a=this.getSetting("useUTC"),s=Ege(this._minLevelUnit,this._approxInterval,a,i);return n=n.concat(s),n.push({value:i[1],level:0}),n},e.prototype.calcNiceExtent=function(t){var i=this._extent;if(i[0]===i[1]&&(i[0]-=gc,i[1]+=gc),i[1]===-1/0&&i[0]===1/0){var n=new Date;i[1]=+new Date(n.getFullYear(),n.getMonth(),n.getDate()),i[0]=i[1]-gc}this.calcNiceTicks(t.splitNumber,t.minInterval,t.maxInterval)},e.prototype.calcNiceTicks=function(t,i,n){t=t||10;var a=this._extent,s=a[1]-a[0];this._approxInterval=s/t,i!=null&&this._approxInterval<i&&(this._approxInterval=i),n!=null&&this._approxInterval>n&&(this._approxInterval=n);var o=jT.length,l=Math.min(xge(jT,this._approxInterval,0,o),o-1);this._interval=jT[l][1],this._minLevelUnit=jT[Math.max(l-1,0)][0]},e.prototype.parse=function(t){return di(t)?t:+xu(t)},e.prototype.contain=function(t){return eM(this.parse(t),this._extent)},e.prototype.normalize=function(t){return tM(this.parse(t),this._extent)},e.prototype.scale=function(t){return rM(t,this._extent)},e.type="time",e})(pp),jT=[["second",Zk],["minute",qk],["hour",G1],["quarter-day",G1*6],["half-day",G1*12],["day",gc*1.2],["half-week",gc*3.5],["week",gc*7],["month",gc*31],["quarter",gc*95],["half-year",mz/2],["year",mz]];function wge(r,e,t,i){var n=xu(e),a=xu(t),s=function(S){return _z(n,S,i)===_z(a,S,i)},o=function(){return s("year")},l=function(){return o()&&s("month")},c=function(){return l()&&s("day")},f=function(){return c()&&s("hour")},p=function(){return f()&&s("minute")},y=function(){return p()&&s("second")},b=function(){return y()&&s("millisecond")};switch(r){case"year":return o();case"month":return l();case"day":return c();case"hour":return f();case"minute":return p();case"second":return y();case"millisecond":return b()}}function Sge(r,e){return r/=gc,r>16?16:r>7.5?7:r>3.5?4:r>1.5?2:1}function Tge(r){var e=30*gc;return r/=e,r>6?6:r>3?3:r>2?2:1}function Age(r){return r/=G1,r>12?12:r>6?6:r>3.5?4:r>2?2:1}function EF(r,e){return r/=e?qk:Zk,r>30?30:r>20?20:r>15?15:r>10?10:r>5?5:r>2?2:1}function Cge(r){return Ck(r,!0)}function Mge(r,e,t){var i=new Date(r);switch(R0(e)){case"year":case"month":i[T7(t)](0);case"day":i[A7(t)](1);case"hour":i[C7(t)](0);case"minute":i[M7(t)](0);case"second":i[E7(t)](0),i[I7(t)](0)}return i.getTime()}function Ege(r,e,t,i){var n=1e4,a=w7,s=0;function o(te,ae,de,ve,ye,Ae,me){for(var De=new Date(ae),Fe=ae,je=De[ve]();Fe<de&&Fe<=i[1];)me.push({value:Fe}),je+=te,De[ye](je),Fe=De.getTime();me.push({value:Fe,notAdd:!0})}function l(te,ae,de){var ve=[],ye=!ae.length;if(!wge(R0(te),i[0],i[1],t)){ye&&(ae=[{value:Mge(new Date(i[0]),te,t)},{value:i[1]}]);for(var Ae=0;Ae<ae.length-1;Ae++){var me=ae[Ae].value,De=ae[Ae+1].value;if(me!==De){var Fe=void 0,je=void 0,ct=void 0,xe=!1;switch(te){case"year":Fe=Math.max(1,Math.round(e/gc/365)),je=Yk(t),ct=Jhe(t);break;case"half-year":case"quarter":case"month":Fe=Tge(e),je=D0(t),ct=T7(t);break;case"week":case"half-week":case"day":Fe=Sge(e),je=jC(t),ct=A7(t),xe=!0;break;case"half-day":case"quarter-day":case"hour":Fe=Age(e),je=mw(t),ct=C7(t);break;case"minute":Fe=EF(e,!0),je=$C(t),ct=M7(t);break;case"second":Fe=EF(e,!1),je=WC(t),ct=E7(t);break;case"millisecond":Fe=Cge(e),je=GC(t),ct=I7(t);break}o(Fe,me,De,je,ct,xe,ve),te==="year"&&de.length>1&&Ae===0&&de.unshift({value:de[0].value-Fe})}}for(var Ae=0;Ae<ve.length;Ae++)de.push(ve[Ae]);return ve}}for(var c=[],f=[],p=0,y=0,b=0;b<a.length&&s++<n;++b){var S=R0(a[b]);if(Yhe(a[b])){l(a[b],c[c.length-1]||[],f);var C=a[b+1]?R0(a[b+1]):null;if(S!==C){if(f.length){y=p,f.sort(function(te,ae){return te.value-ae.value});for(var E=[],P=0;P<f.length;++P){var O=f[P].value;(P===0||f[P-1].value!==O)&&(E.push(f[P]),O>=i[0]&&O<=i[1]&&p++)}var B=(i[1]-i[0])/e;if(p>B*1.5&&y>B/1.5||(c.push(E),p>B||r===a[b]))break}f=[]}}}for(var F=wi(wt(c,function(te){return wi(te,function(ae){return ae.value>=i[0]&&ae.value<=i[1]&&!ae.notAdd})}),function(te){return te.length>0}),W=[],$=F.length-1,b=0;b<F.length;++b)for(var q=F[b],Q=0;Q<q.length;++Q)W.push({value:q[Q].value,level:$-b});W.sort(function(te,ae){return te.value-ae.value});for(var ee=[],b=0;b<W.length;++b)(b===0||W[b].value!==W[b-1].value)&&ee.push(W[b]);return ee}Xf.registerClass(SL);var IF=Xf.prototype,q1=pp.prototype,Ige=Qn,Pge=Math.floor,Rge=Math.ceil,$T=Math.pow,gh=Math.log,TL=(function(r){Ye(e,r);function e(){var t=r!==null&&r.apply(this,arguments)||this;return t.type="log",t.base=10,t._originalScale=new pp,t._interval=0,t}return e.prototype.getTicks=function(t){var i=this._originalScale,n=this._extent,a=i.getExtent(),s=q1.getTicks.call(this,t);return wt(s,function(o){var l=o.value,c=Qn($T(this.base,l));return c=l===n[0]&&this._fixMin?WT(c,a[0]):c,c=l===n[1]&&this._fixMax?WT(c,a[1]):c,{value:c}},this)},e.prototype.setExtent=function(t,i){var n=gh(this.base);t=gh(Math.max(0,t))/n,i=gh(Math.max(0,i))/n,q1.setExtent.call(this,t,i)},e.prototype.getExtent=function(){var t=this.base,i=IF.getExtent.call(this);i[0]=$T(t,i[0]),i[1]=$T(t,i[1]);var n=this._originalScale,a=n.getExtent();return this._fixMin&&(i[0]=WT(i[0],a[0])),this._fixMax&&(i[1]=WT(i[1],a[1])),i},e.prototype.unionExtent=function(t){this._originalScale.unionExtent(t);var i=this.base;t[0]=gh(t[0])/gh(i),t[1]=gh(t[1])/gh(i),IF.unionExtent.call(this,t)},e.prototype.unionExtentFromData=function(t,i){this.unionExtent(t.getApproximateExtent(i))},e.prototype.calcNiceTicks=function(t){t=t||10;var i=this._extent,n=i[1]-i[0];if(!(n===1/0||n<=0)){var a=A$(n),s=t/n*a;for(s<=.5&&(a*=10);!isNaN(a)&&Math.abs(a)<1&&Math.abs(a)>0;)a*=10;var o=[Qn(Rge(i[0]/a)*a),Qn(Pge(i[1]/a)*a)];this._interval=a,this._niceExtent=o}},e.prototype.calcNiceExtent=function(t){q1.calcNiceExtent.call(this,t),this._fixMin=t.fixMin,this._fixMax=t.fixMax},e.prototype.parse=function(t){return t},e.prototype.contain=function(t){return t=gh(t)/gh(this.base),eM(t,this._extent)},e.prototype.normalize=function(t){return t=gh(t)/gh(this.base),tM(t,this._extent)},e.prototype.scale=function(t){return t=rM(t,this._extent),$T(this.base,t)},e.type="log",e})(Xf),lW=TL.prototype;lW.getMinorTicks=q1.getMinorTicks;lW.getLabel=q1.getLabel;function WT(r,e){return Ige(r,wh(e))}Xf.registerClass(TL);var Dge=(function(){function r(e,t,i){this._prepareParams(e,t,i)}return r.prototype._prepareParams=function(e,t,i){i[1]<i[0]&&(i=[NaN,NaN]),this._dataMin=i[0],this._dataMax=i[1];var n=this._isOrdinal=e.type==="ordinal";this._needCrossZero=e.type==="interval"&&t.getNeedCrossZero&&t.getNeedCrossZero();var a=t.get("min",!0);a==null&&(a=t.get("startValue",!0));var s=this._modelMinRaw=a;sr(s)?this._modelMinNum=GT(e,s({min:i[0],max:i[1]})):s!=="dataMin"&&(this._modelMinNum=GT(e,s));var o=this._modelMaxRaw=t.get("max",!0);if(sr(o)?this._modelMaxNum=GT(e,o({min:i[0],max:i[1]})):o!=="dataMax"&&(this._modelMaxNum=GT(e,o)),n)this._axisDataLen=t.getCategories().length;else{var l=t.get("boundaryGap"),c=xt(l)?l:[l||0,l||0];typeof c[0]=="boolean"||typeof c[1]=="boolean"?this._boundaryGapInner=[0,0]:this._boundaryGapInner=[Rh(c[0],1),Rh(c[1],1)]}},r.prototype.calculate=function(){var e=this._isOrdinal,t=this._dataMin,i=this._dataMax,n=this._axisDataLen,a=this._boundaryGapInner,s=e?null:i-t||Math.abs(t),o=this._modelMinRaw==="dataMin"?t:this._modelMinNum,l=this._modelMaxRaw==="dataMax"?i:this._modelMaxNum,c=o!=null,f=l!=null;o==null&&(o=e?n?0:NaN:t-a[0]*s),l==null&&(l=e?n?n-1:NaN:i+a[1]*s),(o==null||!isFinite(o))&&(o=NaN),(l==null||!isFinite(l))&&(l=NaN);var p=j0(o)||j0(l)||e&&!n;this._needCrossZero&&(o>0&&l>0&&!c&&(o=0),o<0&&l<0&&!f&&(l=0));var y=this._determinedMin,b=this._determinedMax;return y!=null&&(o=y,c=!0),b!=null&&(l=b,f=!0),{min:o,max:l,minFixed:c,maxFixed:f,isBlank:p}},r.prototype.modifyDataMinMax=function(e,t){this[Lge[e]]=t},r.prototype.setDeterminedMinMax=function(e,t){var i=kge[e];this[i]=t},r.prototype.freeze=function(){this.frozen=!0},r})(),kge={min:"_determinedMin",max:"_determinedMax"},Lge={min:"_dataMin",max:"_dataMax"};function uW(r,e,t){var i=r.rawExtentInfo;return i||(i=new Dge(r,e,t),r.rawExtentInfo=i,i)}function GT(r,e){return e==null?null:j0(e)?NaN:r.parse(e)}function cW(r,e){var t=r.type,i=uW(r,e,r.getExtent()).calculate();r.setBlank(i.isBlank);var n=i.min,a=i.max,s=e.ecModel;if(s&&t==="time"){var o=tW("bar",s),l=!1;if(se(o,function(p){l=l||p.getBaseAxis()===e.axis}),l){var c=rW(o),f=Oge(n,a,e,c);n=f.min,a=f.max}}return{extent:[n,a],fixMin:i.minFixed,fixMax:i.maxFixed}}function Oge(r,e,t,i){var n=t.axis.getExtent(),a=Math.abs(n[1]-n[0]),s=_ge(i,t.axis);if(s===void 0)return{min:r,max:e};var o=1/0;se(s,function(b){o=Math.min(b.offset,o)});var l=-1/0;se(s,function(b){l=Math.max(b.offset+b.width,l)}),o=Math.abs(o),l=Math.abs(l);var c=o+l,f=e-r,p=1-(o+l)/a,y=f/p-f;return e+=y*(l/c),r-=y*(o/c),{min:r,max:e}}function xy(r,e){var t=e,i=cW(r,t),n=i.extent,a=t.get("splitNumber");r instanceof TL&&(r.base=t.get("logBase"));var s=r.type,o=t.get("interval"),l=s==="interval"||s==="time";r.setExtent(n[0],n[1]),r.calcNiceExtent({splitNumber:a,fixMin:i.fixMin,fixMax:i.fixMax,minInterval:l?t.get("minInterval"):null,maxInterval:l?t.get("maxInterval"):null}),o!=null&&r.setInterval&&r.setInterval(o)}function eS(r,e){if(e=e||r.get("type"),e)switch(e){case"category":return new iM({ordinalMeta:r.getOrdinalMeta?r.getOrdinalMeta():r.getCategories(),extent:[1/0,-1/0]});case"time":return new SL({locale:r.ecModel.getLocaleModel(),useUTC:r.ecModel.get("useUTC")});default:return new(Xf.getClass(e)||pp)}}function Nge(r){var e=r.scale.getExtent(),t=e[0],i=e[1];return!(t>0&&i>0||t<0&&i<0)}function xb(r){var e=r.getLabelModel().get("formatter"),t=r.type==="category"?r.scale.getExtent()[0]:null;return r.scale.type==="time"?(function(i){return function(n,a){return r.scale.getFormattedLabel(n,a,i)}})(e):$t(e)?(function(i){return function(n){var a=r.scale.getLabel(n),s=i.replace("{value}",a??"");return s}})(e):sr(e)?(function(i){return function(n,a){return t!=null&&(a=n.value-t),i(AL(r,n),a,n.level!=null?{level:n.level}:null)}})(e):function(i){return r.scale.getLabel(i)}}function AL(r,e){return r.type==="category"?r.scale.getLabel(e):e.value}function Bge(r){var e=r.model,t=r.scale;if(!(!e.get(["axisLabel","show"])||t.isBlank())){var i,n,a=t.getExtent();t instanceof iM?n=t.count():(i=t.getTicks(),n=i.length);var s=r.getLabelModel(),o=xb(r),l,c=1;n>40&&(c=Math.ceil(n/40));for(var f=0;f<n;f+=c){var p=i?i[f]:{value:a[0]+f},y=o(p,f),b=s.getTextRect(y),S=zge(b,s.get("rotate")||0);l?l.union(S):l=S}return l}}function zge(r,e){var t=e*Math.PI/180,i=r.width,n=r.height,a=i*Math.abs(Math.cos(t))+Math.abs(n*Math.sin(t)),s=i*Math.abs(Math.sin(t))+Math.abs(n*Math.cos(t)),o=new Dr(r.x,r.y,a,s);return o}function CL(r){var e=r.get("interval");return e??"auto"}function hW(r){return r.type==="category"&&CL(r.getLabelModel())===0}function jA(r,e){var t={};return se(r.mapDimensionsAll(e),function(i){t[xL(r,i)]=!0}),qr(t)}function Fge(r,e,t){e&&se(jA(e,t),function(i){var n=e.getApproximateExtent(i);n[0]<r[0]&&(r[0]=n[0]),n[1]>r[1]&&(r[1]=n[1])})}var wb=(function(){function r(){}return r.prototype.getNeedCrossZero=function(){var e=this.option;return!e.scale},r.prototype.getCoordSysModel=function(){},r})();function Vge(r){return Gf(null,r)}var Uge={isDimensionStacked:dp,enableDataStack:K9,getStackedDimension:xL};function Hge(r,e){var t=e;e instanceof Si||(t=new Si(e));var i=eS(t);return i.setExtent(r[0],r[1]),xy(i,t),i}function jge(r){ha(r,wb)}function $ge(r,e){return e=e||{},cn(r,null,null,e.state!=="normal")}const Wge=Object.freeze(Object.defineProperty({__proto__:null,createDimensions:ege,createList:Vge,createScale:Hge,createSymbol:Aa,createTextStyle:$ge,dataStack:Uge,enableHoverEmphasis:Og,getECData:br,getLayoutRect:La,mixinAxisModelCommonMethods:jge},Symbol.toStringTag,{value:"Module"}));var Gge=1e-8;function PF(r,e){return Math.abs(r-e)<Gge}function Lm(r,e,t){var i=0,n=r[0];if(!n)return!1;for(var a=1;a<r.length;a++){var s=r[a];i+=Kd(n[0],n[1],s[0],s[1],e,t),n=s}var o=r[0];return(!PF(n[0],o[0])||!PF(n[1],o[1]))&&(i+=Kd(n[0],n[1],o[0],o[1],e,t)),i!==0}var Xge=[];function TI(r,e){for(var t=0;t<r.length;t++)Ro(r[t],r[t],e)}function RF(r,e,t,i){for(var n=0;n<r.length;n++){var a=r[n];i&&(a=i.project(a)),a&&isFinite(a[0])&&isFinite(a[1])&&(rp(e,e,a),ip(t,t,a))}}function Zge(r){for(var e=0,t=0,i=0,n=r.length,a=r[n-1][0],s=r[n-1][1],o=0;o<n;o++){var l=r[o][0],c=r[o][1],f=a*c-l*s;e+=f,t+=(a+l)*f,i+=(s+c)*f,a=l,s=c}return e?[t/e/3,i/e/3,e]:[r[0][0]||0,r[0][1]||0]}var fW=(function(){function r(e){this.name=e}return r.prototype.setCenter=function(e){this._center=e},r.prototype.getCenter=function(){var e=this._center;return e||(e=this._center=this.calcCenter()),e},r})(),DF=(function(){function r(e,t){this.type="polygon",this.exterior=e,this.interiors=t}return r})(),kF=(function(){function r(e){this.type="linestring",this.points=e}return r})(),dW=(function(r){Ye(e,r);function e(t,i,n){var a=r.call(this,t)||this;return a.type="geoJSON",a.geometries=i,a._center=n&&[n[0],n[1]],a}return e.prototype.calcCenter=function(){for(var t=this.geometries,i,n=0,a=0;a<t.length;a++){var s=t[a],o=s.exterior,l=o&&o.length;l>n&&(i=s,n=l)}if(i)return Zge(i.exterior);var c=this.getBoundingRect();return[c.x+c.width/2,c.y+c.height/2]},e.prototype.getBoundingRect=function(t){var i=this._rect;if(i&&!t)return i;var n=[1/0,1/0],a=[-1/0,-1/0],s=this.geometries;return se(s,function(o){o.type==="polygon"?RF(o.exterior,n,a,t):se(o.points,function(l){RF(l,n,a,t)})}),isFinite(n[0])&&isFinite(n[1])&&isFinite(a[0])&&isFinite(a[1])||(n[0]=n[1]=a[0]=a[1]=0),i=new Dr(n[0],n[1],a[0]-n[0],a[1]-n[1]),t||(this._rect=i),i},e.prototype.contain=function(t){var i=this.getBoundingRect(),n=this.geometries;if(!i.contain(t[0],t[1]))return!1;e:for(var a=0,s=n.length;a<s;a++){var o=n[a];if(o.type==="polygon"){var l=o.exterior,c=o.interiors;if(Lm(l,t[0],t[1])){for(var f=0;f<(c?c.length:0);f++)if(Lm(c[f],t[0],t[1]))continue e;return!0}}}return!1},e.prototype.transformTo=function(t,i,n,a){var s=this.getBoundingRect(),o=s.width/s.height;n?a||(a=n/o):n=o*a;for(var l=new Dr(t,i,n,a),c=s.calculateTransform(l),f=this.geometries,p=0;p<f.length;p++){var y=f[p];y.type==="polygon"?(TI(y.exterior,c),se(y.interiors,function(b){TI(b,c)})):se(y.points,function(b){TI(b,c)})}s=this._rect,s.copy(l),this._center=[s.x+s.width/2,s.y+s.height/2]},e.prototype.cloneShallow=function(t){t==null&&(t=this.name);var i=new e(t,this.geometries,this._center);return i._rect=this._rect,i.transformTo=null,i},e})(fW),qge=(function(r){Ye(e,r);function e(t,i){var n=r.call(this,t)||this;return n.type="geoSVG",n._elOnlyForCalculate=i,n}return e.prototype.calcCenter=function(){for(var t=this._elOnlyForCalculate,i=t.getBoundingRect(),n=[i.x+i.width/2,i.y+i.height/2],a=jw(Xge),s=t;s&&!s.isGeoSVGGraphicRoot;)zf(a,s.getLocalTransform(),a),s=s.parent;return Ey(a,a),Ro(n,n,a),n},e})(fW);function Yge(r){if(!r.UTF8Encoding)return r;var e=r,t=e.UTF8Scale;t==null&&(t=1024);var i=e.features;return se(i,function(n){var a=n.geometry,s=a.encodeOffsets,o=a.coordinates;if(s)switch(a.type){case"LineString":a.coordinates=pW(o,s,t);break;case"Polygon":AI(o,s,t);break;case"MultiLineString":AI(o,s,t);break;case"MultiPolygon":se(o,function(l,c){return AI(l,s[c],t)})}}),e.UTF8Encoding=!1,e}function AI(r,e,t){for(var i=0;i<r.length;i++)r[i]=pW(r[i],e[i],t)}function pW(r,e,t){for(var i=[],n=e[0],a=e[1],s=0;s<r.length;s+=2){var o=r.charCodeAt(s)-64,l=r.charCodeAt(s+1)-64;o=o>>1^-(o&1),l=l>>1^-(l&1),o+=n,l+=a,n=o,a=l,i.push([o/t,l/t])}return i}function A3(r,e){return r=Yge(r),wt(wi(r.features,function(t){return t.geometry&&t.properties&&t.geometry.coordinates.length>0}),function(t){var i=t.properties,n=t.geometry,a=[];switch(n.type){case"Polygon":var s=n.coordinates;a.push(new DF(s[0],s.slice(1)));break;case"MultiPolygon":se(n.coordinates,function(l){l[0]&&a.push(new DF(l[0],l.slice(1)))});break;case"LineString":a.push(new kF([n.coordinates]));break;case"MultiLineString":a.push(new kF(n.coordinates))}var o=new dW(i[e||"name"],a,i.cp);return o.properties=i,o})}const Kge=Object.freeze(Object.defineProperty({__proto__:null,MAX_SAFE_INTEGER:XR,asc:yu,getPercentWithPrecision:Due,getPixelPrecision:Tk,getPrecision:wh,getPrecisionSafe:S$,isNumeric:Mk,isRadianAroundZero:W0,linearMap:Ii,nice:Ck,numericToNumber:Hf,parseDate:xu,quantile:L2,quantity:A$,quantityExponent:DC,reformIntervals:ZR,remRadian:Ak,round:Qn},Symbol.toStringTag,{value:"Module"})),Qge=Object.freeze(Object.defineProperty({__proto__:null,format:Qw,parse:xu},Symbol.toStringTag,{value:"Module"})),Jge=Object.freeze(Object.defineProperty({__proto__:null,Arc:qw,BezierCurve:lb,BoundingRect:Dr,Circle:$f,CompoundPath:FC,Ellipse:Zw,Group:mr,Image:go,IncrementalDisplayable:u7,Line:qa,LinearGradient:ub,Polygon:Rs,Polyline:ks,RadialGradient:Fk,Rect:li,Ring:sb,Sector:Ps,Text:si,clipPointsByRect:jk,clipRectByRect:p7,createIcon:hb,extendPath:f7,extendShape:h7,getShapeClass:VC,getTransform:Ng,initProps:An,makeImage:Uk,makePath:Yw,mergePath:vu,registerShape:Mc,resizePath:Hk,updateProps:vi},Symbol.toStringTag,{value:"Module"})),eve=Object.freeze(Object.defineProperty({__proto__:null,addCommas:Kk,capitalFirst:ife,encodeHTML:Ms,formatTime:rfe,formatTpl:Jk,getTextRect:efe,getTooltipMarker:P7,normalizeCssArray:Ry,toCamelCase:Qk,truncateText:lce},Symbol.toStringTag,{value:"Module"})),tve=Object.freeze(Object.defineProperty({__proto__:null,bind:Xt,clone:hr,curry:Sr,defaults:lr,each:se,extend:mt,filter:wi,indexOf:Or,inherits:vk,isArray:xt,isFunction:sr,isObject:cr,isString:$t,map:wt,merge:Cr,reduce:Sc},Symbol.toStringTag,{value:"Module"}));var Sw=fi();function gW(r,e){var t=wt(e,function(i){return r.scale.parse(i)});return r.type==="time"&&t.length>0&&(t.sort(),t.unshift(t[0]),t.push(t[t.length-1])),t}function rve(r){var e=r.getLabelModel().get("customValues");if(e){var t=xb(r),i=r.scale.getExtent(),n=gW(r,e),a=wi(n,function(s){return s>=i[0]&&s<=i[1]});return{labels:wt(a,function(s){var o={value:s};return{formattedLabel:t(o),rawLabel:r.scale.getLabel(o),tickValue:s}})}}return r.type==="category"?nve(r):ove(r)}function ive(r,e){var t=r.getTickModel().get("customValues");if(t){var i=r.scale.getExtent(),n=gW(r,t);return{ticks:wi(n,function(a){return a>=i[0]&&a<=i[1]})}}return r.type==="category"?ave(r,e):{ticks:wt(r.scale.getTicks(),function(a){return a.value})}}function nve(r){var e=r.getLabelModel(),t=vW(r,e);return!e.get("show")||r.scale.isBlank()?{labels:[],labelCategoryInterval:t.labelCategoryInterval}:t}function vW(r,e){var t=mW(r,"labels"),i=CL(e),n=yW(t,i);if(n)return n;var a,s;return sr(i)?a=xW(r,i):(s=i==="auto"?sve(r):i,a=bW(r,s)),_W(t,i,{labels:a,labelCategoryInterval:s})}function ave(r,e){var t=mW(r,"ticks"),i=CL(e),n=yW(t,i);if(n)return n;var a,s;if((!e.get("show")||r.scale.isBlank())&&(a=[]),sr(i))a=xW(r,i,!0);else if(i==="auto"){var o=vW(r,r.getLabelModel());s=o.labelCategoryInterval,a=wt(o.labels,function(l){return l.tickValue})}else s=i,a=bW(r,s,!0);return _W(t,i,{ticks:a,tickCategoryInterval:s})}function ove(r){var e=r.scale.getTicks(),t=xb(r);return{labels:wt(e,function(i,n){return{level:i.level,formattedLabel:t(i,n),rawLabel:r.scale.getLabel(i),tickValue:i.value}})}}function mW(r,e){return Sw(r)[e]||(Sw(r)[e]=[])}function yW(r,e){for(var t=0;t<r.length;t++)if(r[t].key===e)return r[t].value}function _W(r,e,t){return r.push({key:e,value:t}),t}function sve(r){var e=Sw(r).autoInterval;return e??(Sw(r).autoInterval=r.calculateCategoryInterval())}function lve(r){var e=uve(r),t=xb(r),i=(e.axisRotate-e.labelRotate)/180*Math.PI,n=r.scale,a=n.getExtent(),s=n.count();if(a[1]-a[0]<1)return 0;var o=1;s>40&&(o=Math.max(1,Math.floor(s/40)));for(var l=a[0],c=r.dataToCoord(l+1)-r.dataToCoord(l),f=Math.abs(c*Math.cos(i)),p=Math.abs(c*Math.sin(i)),y=0,b=0;l<=a[1];l+=o){var S=0,C=0,E=Ww(t({value:l}),e.font,"center","top");S=E.width*1.3,C=E.height*1.3,y=Math.max(y,S,7),b=Math.max(b,C,7)}var P=y/f,O=b/p;isNaN(P)&&(P=1/0),isNaN(O)&&(O=1/0);var B=Math.max(0,Math.floor(Math.min(P,O))),F=Sw(r.model),W=r.getExtent(),$=F.lastAutoInterval,q=F.lastTickCount;return $!=null&&q!=null&&Math.abs($-B)<=1&&Math.abs(q-s)<=1&&$>B&&F.axisExtent0===W[0]&&F.axisExtent1===W[1]?B=$:(F.lastTickCount=s,F.lastAutoInterval=B,F.axisExtent0=W[0],F.axisExtent1=W[1]),B}function uve(r){var e=r.getLabelModel();return{axisRotate:r.getRotate?r.getRotate():r.isHorizontal&&!r.isHorizontal()?90:0,labelRotate:e.get("rotate")||0,font:e.getFont()}}function bW(r,e,t){var i=xb(r),n=r.scale,a=n.getExtent(),s=r.getLabelModel(),o=[],l=Math.max((e||0)+1,1),c=a[0],f=n.count();c!==0&&l>1&&f/l>2&&(c=Math.round(Math.ceil(c/l)*l));var p=hW(r),y=s.get("showMinLabel")||p,b=s.get("showMaxLabel")||p;y&&c!==a[0]&&C(a[0]);for(var S=c;S<=a[1];S+=l)C(S);b&&S-l!==a[1]&&C(a[1]);function C(E){var P={value:E};o.push(t?E:{formattedLabel:i(P),rawLabel:n.getLabel(P),tickValue:E})}return o}function xW(r,e,t){var i=r.scale,n=xb(r),a=[];return se(i.getTicks(),function(s){var o=i.getLabel(s),l=s.value;e(s.value,o)&&a.push(t?l:{formattedLabel:n(s),rawLabel:o,tickValue:l})}),a}var LF=[0,1],Pc=(function(){function r(e,t,i){this.onBand=!1,this.inverse=!1,this.dim=e,this.scale=t,this._extent=i||[0,0]}return r.prototype.contain=function(e){var t=this._extent,i=Math.min(t[0],t[1]),n=Math.max(t[0],t[1]);return e>=i&&e<=n},r.prototype.containData=function(e){return this.scale.contain(e)},r.prototype.getExtent=function(){return this._extent.slice()},r.prototype.getPixelPrecision=function(e){return Tk(e||this.scale.getExtent(),this._extent)},r.prototype.setExtent=function(e,t){var i=this._extent;i[0]=e,i[1]=t},r.prototype.dataToCoord=function(e,t){var i=this._extent,n=this.scale;return e=n.normalize(e),this.onBand&&n.type==="ordinal"&&(i=i.slice(),OF(i,n.count())),Ii(e,LF,i,t)},r.prototype.coordToData=function(e,t){var i=this._extent,n=this.scale;this.onBand&&n.type==="ordinal"&&(i=i.slice(),OF(i,n.count()));var a=Ii(e,i,LF,t);return this.scale.scale(a)},r.prototype.pointToData=function(e,t){},r.prototype.getTicksCoords=function(e){e=e||{};var t=e.tickModel||this.getTickModel(),i=ive(this,t),n=i.ticks,a=wt(n,function(o){return{coord:this.dataToCoord(this.scale.type==="ordinal"?this.scale.getRawOrdinalNumber(o):o),tickValue:o}},this),s=t.get("alignWithLabel");return cve(this,a,s,e.clamp),a},r.prototype.getMinorTicksCoords=function(){if(this.scale.type==="ordinal")return[];var e=this.model.getModel("minorTick"),t=e.get("splitNumber");t>0&&t<100||(t=5);var i=this.scale.getMinorTicks(t),n=wt(i,function(a){return wt(a,function(s){return{coord:this.dataToCoord(s),tickValue:s}},this)},this);return n},r.prototype.getViewLabels=function(){return rve(this).labels},r.prototype.getLabelModel=function(){return this.model.getModel("axisLabel")},r.prototype.getTickModel=function(){return this.model.getModel("axisTick")},r.prototype.getBandWidth=function(){var e=this._extent,t=this.scale.getExtent(),i=t[1]-t[0]+(this.onBand?1:0);i===0&&(i=1);var n=Math.abs(e[1]-e[0]);return Math.abs(n)/i},r.prototype.calculateCategoryInterval=function(){return lve(this)},r})();function OF(r,e){var t=r[1]-r[0],i=e,n=t/i/2;r[0]+=n,r[1]-=n}function cve(r,e,t,i){var n=e.length;if(!r.onBand||t||!n)return;var a=r.getExtent(),s,o;if(n===1)e[0].coord=a[0],s=e[1]={coord:a[1],tickValue:e[0].tickValue};else{var l=e[n-1].tickValue-e[0].tickValue,c=(e[n-1].coord-e[0].coord)/l;se(e,function(b){b.coord-=c/2});var f=r.scale.getExtent();o=1+f[1]-e[n-1].tickValue,s={coord:e[n-1].coord+c*o,tickValue:f[1]+1},e.push(s)}var p=a[0]>a[1];y(e[0].coord,a[0])&&(i?e[0].coord=a[0]:e.shift()),i&&y(a[0],e[0].coord)&&e.unshift({coord:a[0]}),y(a[1],s.coord)&&(i?s.coord=a[1]:e.pop()),i&&y(s.coord,a[1])&&e.push({coord:a[1]});function y(b,S){return b=Qn(b),S=Qn(S),p?b>S:b<S}}function hve(r){var e=Wr.extend(r);return Wr.registerClass(e),e}function fve(r){var e=vn.extend(r);return vn.registerClass(e),e}function dve(r){var e=Xi.extend(r);return Xi.registerClass(e),e}function pve(r){var e=Fi.extend(r);return Fi.registerClass(e),e}var qx=Math.PI*2,Sm=jf.CMD,gve=["top","right","bottom","left"];function vve(r,e,t,i,n){var a=t.width,s=t.height;switch(r){case"top":i.set(t.x+a/2,t.y-e),n.set(0,-1);break;case"bottom":i.set(t.x+a/2,t.y+s+e),n.set(0,1);break;case"left":i.set(t.x-e,t.y+s/2),n.set(-1,0);break;case"right":i.set(t.x+a+e,t.y+s/2),n.set(1,0);break}}function mve(r,e,t,i,n,a,s,o,l){s-=r,o-=e;var c=Math.sqrt(s*s+o*o);s/=c,o/=c;var f=s*t+r,p=o*t+e;if(Math.abs(i-n)%qx<1e-4)return l[0]=f,l[1]=p,c-t;if(a){var y=i;i=_u(n),n=_u(y)}else i=_u(i),n=_u(n);i>n&&(n+=qx);var b=Math.atan2(o,s);if(b<0&&(b+=qx),b>=i&&b<=n||b+qx>=i&&b+qx<=n)return l[0]=f,l[1]=p,c-t;var S=t*Math.cos(i)+r,C=t*Math.sin(i)+e,E=t*Math.cos(n)+r,P=t*Math.sin(n)+e,O=(S-s)*(S-s)+(C-o)*(C-o),B=(E-s)*(E-s)+(P-o)*(P-o);return O<B?(l[0]=S,l[1]=C,Math.sqrt(O)):(l[0]=E,l[1]=P,Math.sqrt(B))}function $A(r,e,t,i,n,a,s,o){var l=n-r,c=a-e,f=t-r,p=i-e,y=Math.sqrt(f*f+p*p);f/=y,p/=y;var b=l*f+c*p,S=b/y;o&&(S=Math.min(Math.max(S,0),1)),S*=y;var C=s[0]=r+S*f,E=s[1]=e+S*p;return Math.sqrt((C-n)*(C-n)+(E-a)*(E-a))}function wW(r,e,t,i,n,a,s){t<0&&(r=r+t,t=-t),i<0&&(e=e+i,i=-i);var o=r+t,l=e+i,c=s[0]=Math.min(Math.max(n,r),o),f=s[1]=Math.min(Math.max(a,e),l);return Math.sqrt((c-n)*(c-n)+(f-a)*(f-a))}var bh=[];function yve(r,e,t){var i=wW(e.x,e.y,e.width,e.height,r.x,r.y,bh);return t.set(bh[0],bh[1]),i}function _ve(r,e,t){for(var i=0,n=0,a=0,s=0,o,l,c=1/0,f=e.data,p=r.x,y=r.y,b=0;b<f.length;){var S=f[b++];b===1&&(i=f[b],n=f[b+1],a=i,s=n);var C=c;switch(S){case Sm.M:a=f[b++],s=f[b++],i=a,n=s;break;case Sm.L:C=$A(i,n,f[b],f[b+1],p,y,bh,!0),i=f[b++],n=f[b++];break;case Sm.C:C=i$(i,n,f[b++],f[b++],f[b++],f[b++],f[b],f[b+1],p,y,bh),i=f[b++],n=f[b++];break;case Sm.Q:C=a$(i,n,f[b++],f[b++],f[b],f[b+1],p,y,bh),i=f[b++],n=f[b++];break;case Sm.A:var E=f[b++],P=f[b++],O=f[b++],B=f[b++],F=f[b++],W=f[b++];b+=1;var $=!!(1-f[b++]);o=Math.cos(F)*O+E,l=Math.sin(F)*B+P,b<=1&&(a=o,s=l);var q=(p-E)*B/O+E;C=mve(E,P,B,F,F+W,$,q,y,bh),i=Math.cos(F+W)*O+E,n=Math.sin(F+W)*B+P;break;case Sm.R:a=i=f[b++],s=n=f[b++];var Q=f[b++],ee=f[b++];C=wW(a,s,Q,ee,p,y,bh);break;case Sm.Z:C=$A(i,n,a,s,p,y,bh,!0),i=a,n=s;break}C<c&&(c=C,t.set(bh[0],bh[1]))}return c}var Sh=new Rr,gn=new Rr,Ta=new Rr,Nf=new Rr,Rf=new Rr;function NF(r,e){if(r){var t=r.getTextGuideLine(),i=r.getTextContent();if(i&&t){var n=r.textGuideLineConfig||{},a=[[0,0],[0,0],[0,0]],s=n.candidates||gve,o=i.getBoundingRect().clone();o.applyTransform(i.getComputedTransform());var l=1/0,c=n.anchor,f=r.getComputedTransform(),p=f&&Ey([],f),y=e.get("length2")||0;c&&Ta.copy(c);for(var b=0;b<s.length;b++){var S=s[b];vve(S,0,o,Sh,Nf),Rr.scaleAndAdd(gn,Sh,Nf,y),gn.transform(p);var C=r.getBoundingRect(),E=c?c.distance(gn):r instanceof Xr?_ve(gn,r.path,Ta):yve(gn,C,Ta);E<l&&(l=E,gn.transform(f),Ta.transform(f),Ta.toArray(a[0]),gn.toArray(a[1]),Sh.toArray(a[2]))}SW(a,e.get("minTurnAngle")),t.setShape({points:a})}}}var WA=[],il=new Rr;function SW(r,e){if(e<=180&&e>0){e=e/180*Math.PI,Sh.fromArray(r[0]),gn.fromArray(r[1]),Ta.fromArray(r[2]),Rr.sub(Nf,Sh,gn),Rr.sub(Rf,Ta,gn);var t=Nf.len(),i=Rf.len();if(!(t<.001||i<.001)){Nf.scale(1/t),Rf.scale(1/i);var n=Nf.dot(Rf),a=Math.cos(e);if(a<n){var s=$A(gn.x,gn.y,Ta.x,Ta.y,Sh.x,Sh.y,WA,!1);il.fromArray(WA),il.scaleAndAdd(Rf,s/Math.tan(Math.PI-e));var o=Ta.x!==gn.x?(il.x-gn.x)/(Ta.x-gn.x):(il.y-gn.y)/(Ta.y-gn.y);if(isNaN(o))return;o<0?Rr.copy(il,gn):o>1&&Rr.copy(il,Ta),il.toArray(r[1])}}}}function bve(r,e,t){if(t<=180&&t>0){t=t/180*Math.PI,Sh.fromArray(r[0]),gn.fromArray(r[1]),Ta.fromArray(r[2]),Rr.sub(Nf,gn,Sh),Rr.sub(Rf,Ta,gn);var i=Nf.len(),n=Rf.len();if(!(i<.001||n<.001)){Nf.scale(1/i),Rf.scale(1/n);var a=Nf.dot(e),s=Math.cos(t);if(a<s){var o=$A(gn.x,gn.y,Ta.x,Ta.y,Sh.x,Sh.y,WA,!1);il.fromArray(WA);var l=Math.PI/2,c=Math.acos(Rf.dot(e)),f=l+c-t;if(f>=l)Rr.copy(il,Ta);else{il.scaleAndAdd(Rf,o/Math.tan(Math.PI/2-f));var p=Ta.x!==gn.x?(il.x-gn.x)/(Ta.x-gn.x):(il.y-gn.y)/(Ta.y-gn.y);if(isNaN(p))return;p<0?Rr.copy(il,gn):p>1&&Rr.copy(il,Ta)}il.toArray(r[1])}}}}function CI(r,e,t,i){var n=t==="normal",a=n?r:r.ensureState(t);a.ignore=e;var s=i.get("smooth");s&&s===!0&&(s=.3),a.shape=a.shape||{},s>0&&(a.shape.smooth=s);var o=i.getModel("lineStyle").getLineStyle();n?r.useStyle(o):a.style=o}function xve(r,e){var t=e.smooth,i=e.points;if(i)if(r.moveTo(i[0][0],i[0][1]),t>0&&i.length>=3){var n=tp(i[0],i[1]),a=tp(i[1],i[2]);if(!n||!a){r.lineTo(i[1][0],i[1][1]),r.lineTo(i[2][0],i[2][1]);return}var s=Math.min(n,a)*t,o=B1([],i[1],i[0],s/n),l=B1([],i[1],i[2],s/a),c=B1([],o,l,.5);r.bezierCurveTo(o[0],o[1],o[0],o[1],c[0],c[1]),r.bezierCurveTo(l[0],l[1],l[0],l[1],i[2][0],i[2][1])}else for(var f=1;f<i.length;f++)r.lineTo(i[f][0],i[f][1])}function ML(r,e,t){var i=r.getTextGuideLine(),n=r.getTextContent();if(!n){i&&r.removeTextGuideLine();return}for(var a=e.normal,s=a.get("show"),o=n.ignore,l=0;l<pw.length;l++){var c=pw[l],f=e[c],p=c==="normal";if(f){var y=f.get("show"),b=p?o:wr(n.states[c]&&n.states[c].ignore,o);if(b||!wr(y,s)){var S=p?i:i&&i.states[c];S&&(S.ignore=!0),i&&CI(i,!0,c,f);continue}i||(i=new ks,r.setTextGuideLine(i),!p&&(o||!s)&&CI(i,!0,"normal",e.normal),r.stateProxy&&(i.stateProxy=r.stateProxy)),CI(i,!1,c,f)}}if(i){lr(i.style,t),i.style.fill=null;var C=a.get("showAbove"),E=r.textGuideLineConfig=r.textGuideLineConfig||{};E.showAbove=C||!1,i.buildPath=xve}}function EL(r,e){e=e||"labelLine";for(var t={normal:r.getModel(e)},i=0;i<ll.length;i++){var n=ll[i];t[n]=r.getModel([n,e])}return t}function TW(r){for(var e=[],t=0;t<r.length;t++){var i=r[t];if(!i.defaultAttr.ignore){var n=i.label,a=n.getComputedTransform(),s=n.getBoundingRect(),o=!a||a[1]<1e-5&&a[2]<1e-5,l=n.style.margin||0,c=s.clone();c.applyTransform(a),c.x-=l/2,c.y-=l/2,c.width+=l,c.height+=l;var f=o?new MA(s,a):null;e.push({label:n,labelLine:i.labelLine,rect:c,localRect:s,obb:f,priority:i.priority,defaultAttr:i.defaultAttr,layoutOption:i.computedLayoutOption,axisAligned:o,transform:a})}}return e}function AW(r,e,t,i,n,a){var s=r.length;if(s<2)return;r.sort(function($,q){return $.rect[e]-q.rect[e]});for(var o=0,l,c=!1,f=0;f<s;f++){var p=r[f],y=p.rect;l=y[e]-o,l<0&&(y[e]-=l,p.label[e]-=l,c=!0),o=y[e]+y[t]}var b=r[0],S=r[s-1],C,E;P(),C<0&&F(-C,.8),E<0&&F(E,.8),P(),O(C,E,1),O(E,C,-1),P(),C<0&&W(-C),E<0&&W(E);function P(){C=b.rect[e]-i,E=n-S.rect[e]-S.rect[t]}function O($,q,Q){if($<0){var ee=Math.min(q,-$);if(ee>0){B(ee*Q,0,s);var te=ee+$;te<0&&F(-te*Q,1)}else F(-$*Q,1)}}function B($,q,Q){$!==0&&(c=!0);for(var ee=q;ee<Q;ee++){var te=r[ee],ae=te.rect;ae[e]+=$,te.label[e]+=$}}function F($,q){for(var Q=[],ee=0,te=1;te<s;te++){var ae=r[te-1].rect,de=Math.max(r[te].rect[e]-ae[e]-ae[t],0);Q.push(de),ee+=de}if(ee){var ve=Math.min(Math.abs($)/ee,q);if($>0)for(var te=0;te<s-1;te++){var ye=Q[te]*ve;B(ye,0,te+1)}else for(var te=s-1;te>0;te--){var ye=Q[te-1]*ve;B(-ye,te,s)}}}function W($){var q=$<0?-1:1;$=Math.abs($);for(var Q=Math.ceil($/(s-1)),ee=0;ee<s-1;ee++)if(q>0?B(Q,0,ee+1):B(-Q,s-ee-1,s),$-=Q,$<=0)return}return c}function wve(r,e,t,i){return AW(r,"x","width",e,t)}function CW(r,e,t,i){return AW(r,"y","height",e,t)}function MW(r){var e=[];r.sort(function(C,E){return E.priority-C.priority});var t=new Dr(0,0,0,0);function i(C){if(!C.ignore){var E=C.ensureState("emphasis");E.ignore==null&&(E.ignore=!1)}C.ignore=!0}for(var n=0;n<r.length;n++){var a=r[n],s=a.axisAligned,o=a.localRect,l=a.transform,c=a.label,f=a.labelLine;t.copy(a.rect),t.width-=.1,t.height-=.1,t.x+=.05,t.y+=.05;for(var p=a.obb,y=!1,b=0;b<e.length;b++){var S=e[b];if(t.intersect(S.rect)){if(s&&S.axisAligned){y=!0;break}if(S.obb||(S.obb=new MA(S.localRect,S.transform)),p||(p=new MA(o,l)),p.intersect(S.obb)){y=!0;break}}}y?(i(c),f&&i(f)):(c.attr("ignore",a.defaultAttr.ignore),f&&f.attr("ignore",a.defaultAttr.labelGuideIgnore),e.push(a))}}function Sve(r){if(r){for(var e=[],t=0;t<r.length;t++)e.push(r[t].slice());return e}}function Tve(r,e){var t=r.label,i=e&&e.getTextGuideLine();return{dataIndex:r.dataIndex,dataType:r.dataType,seriesIndex:r.seriesModel.seriesIndex,text:r.label.style.text,rect:r.hostRect,labelRect:r.rect,align:t.style.align,verticalAlign:t.style.verticalAlign,labelLinePoints:Sve(i&&i.shape.points)}}var BF=["align","verticalAlign","width","height","fontSize"],el=new np,MI=fi(),Ave=fi();function XT(r,e,t){for(var i=0;i<t.length;i++){var n=t[i];e[n]!=null&&(r[n]=e[n])}}var ZT=["x","y","rotation"],Cve=(function(){function r(){this._labelList=[],this._chartViewList=[]}return r.prototype.clearLabels=function(){this._labelList=[],this._chartViewList=[]},r.prototype._addLabel=function(e,t,i,n,a){var s=n.style,o=n.__hostTarget,l=o.textConfig||{},c=n.getComputedTransform(),f=n.getBoundingRect().plain();Dr.applyTransform(f,f,c),c?el.setLocalTransform(c):(el.x=el.y=el.rotation=el.originX=el.originY=0,el.scaleX=el.scaleY=1),el.rotation=_u(el.rotation);var p=n.__hostTarget,y;if(p){y=p.getBoundingRect().plain();var b=p.getComputedTransform();Dr.applyTransform(y,y,b)}var S=y&&p.getTextGuideLine();this._labelList.push({label:n,labelLine:S,seriesModel:i,dataIndex:e,dataType:t,layoutOption:a,computedLayoutOption:null,rect:f,hostRect:y,priority:y?y.width*y.height:0,defaultAttr:{ignore:n.ignore,labelGuideIgnore:S&&S.ignore,x:el.x,y:el.y,scaleX:el.scaleX,scaleY:el.scaleY,rotation:el.rotation,style:{x:s.x,y:s.y,align:s.align,verticalAlign:s.verticalAlign,width:s.width,height:s.height,fontSize:s.fontSize},cursor:n.cursor,attachedPos:l.position,attachedRot:l.rotation}})},r.prototype.addLabelsOfSeries=function(e){var t=this;this._chartViewList.push(e);var i=e.__model,n=i.get("labelLayout");(sr(n)||qr(n).length)&&e.group.traverse(function(a){if(a.ignore)return!0;var s=a.getTextContent(),o=br(a);s&&!s.disableLabelLayout&&t._addLabel(o.dataIndex,o.dataType,i,s,n)})},r.prototype.updateLayoutConfig=function(e){var t=e.getWidth(),i=e.getHeight();function n(B,F){return function(){NF(B,F)}}for(var a=0;a<this._labelList.length;a++){var s=this._labelList[a],o=s.label,l=o.__hostTarget,c=s.defaultAttr,f=void 0;sr(s.layoutOption)?f=s.layoutOption(Tve(s,l)):f=s.layoutOption,f=f||{},s.computedLayoutOption=f;var p=Math.PI/180;l&&l.setTextConfig({local:!1,position:f.x!=null||f.y!=null?null:c.attachedPos,rotation:f.rotate!=null?f.rotate*p:c.attachedRot,offset:[f.dx||0,f.dy||0]});var y=!1;if(f.x!=null?(o.x=Vt(f.x,t),o.setStyle("x",0),y=!0):(o.x=c.x,o.setStyle("x",c.style.x)),f.y!=null?(o.y=Vt(f.y,i),o.setStyle("y",0),y=!0):(o.y=c.y,o.setStyle("y",c.style.y)),f.labelLinePoints){var b=l.getTextGuideLine();b&&(b.setShape({points:f.labelLinePoints}),y=!1)}var S=MI(o);S.needsUpdateLabelLine=y,o.rotation=f.rotate!=null?f.rotate*p:c.rotation,o.scaleX=c.scaleX,o.scaleY=c.scaleY;for(var C=0;C<BF.length;C++){var E=BF[C];o.setStyle(E,f[E]!=null?f[E]:c.style[E])}if(f.draggable){if(o.draggable=!0,o.cursor="move",l){var P=s.seriesModel;if(s.dataIndex!=null){var O=s.seriesModel.getData(s.dataType);P=O.getItemModel(s.dataIndex)}o.on("drag",n(l,P.getModel("labelLine")))}}else o.off("drag"),o.cursor=c.cursor}},r.prototype.layout=function(e){var t=e.getWidth(),i=e.getHeight(),n=TW(this._labelList),a=wi(n,function(l){return l.layoutOption.moveOverlap==="shiftX"}),s=wi(n,function(l){return l.layoutOption.moveOverlap==="shiftY"});wve(a,0,t),CW(s,0,i);var o=wi(n,function(l){return l.layoutOption.hideOverlap});MW(o)},r.prototype.processLabelsOverall=function(){var e=this;se(this._chartViewList,function(t){var i=t.__model,n=t.ignoreLabelLineUpdate,a=i.isAnimationEnabled();t.group.traverse(function(s){if(s.ignore&&!s.forceLabelAnimation)return!0;var o=!n,l=s.getTextContent();!o&&l&&(o=MI(l).needsUpdateLabelLine),o&&e._updateLabelLine(s,i),a&&e._animateLabels(s,i)})})},r.prototype._updateLabelLine=function(e,t){var i=e.getTextContent(),n=br(e),a=n.dataIndex;if(i&&a!=null){var s=t.getData(n.dataType),o=s.getItemModel(a),l={},c=s.getItemVisual(a,"style");if(c){var f=s.getVisual("drawType");l.stroke=c[f]}var p=o.getModel("labelLine");ML(e,EL(o),l),NF(e,p)}},r.prototype._animateLabels=function(e,t){var i=e.getTextContent(),n=e.getTextGuideLine();if(i&&(e.forceLabelAnimation||!i.ignore&&!i.invisible&&!e.disableLabelAnimation&&!I0(e))){var a=MI(i),s=a.oldLayout,o=br(e),l=o.dataIndex,c={x:i.x,y:i.y,rotation:i.rotation},f=t.getData(o.dataType);if(s){i.attr(s);var y=e.prevStates;y&&(Or(y,"select")>=0&&i.attr(a.oldLayoutSelect),Or(y,"emphasis")>=0&&i.attr(a.oldLayoutEmphasis)),vi(i,c,t,l)}else if(i.attr(c),!fb(i).valueAnimation){var p=wr(i.style.opacity,1);i.style.opacity=0,An(i,{style:{opacity:p}},t,l)}if(a.oldLayout=c,i.states.select){var b=a.oldLayoutSelect={};XT(b,c,ZT),XT(b,i.states.select,ZT)}if(i.states.emphasis){var S=a.oldLayoutEmphasis={};XT(S,c,ZT),XT(S,i.states.emphasis,ZT)}y7(i,l,f,t,t)}if(n&&!n.ignore&&!n.invisible){var a=Ave(n),s=a.oldLayout,C={points:n.shape.points};s?(n.attr({shape:s}),vi(n,{shape:C},t)):(n.setShape(C),n.style.strokePercent=0,An(n,{style:{strokePercent:1}},t)),a.oldLayout=C}},r})(),EI=fi();function Mve(r){r.registerUpdateLifecycle("series:beforeupdate",function(e,t,i){var n=EI(t).labelManager;n||(n=EI(t).labelManager=new Cve),n.clearLabels()}),r.registerUpdateLifecycle("series:layoutlabels",function(e,t,i){var n=EI(t).labelManager;i.updatedSeries.forEach(function(a){n.addLabelsOfSeries(t.getViewOfSeriesModel(a))}),n.updateLayoutConfig(t),n.layout(t),n.processLabelsOverall()})}var II=Math.sin,PI=Math.cos,EW=Math.PI,Tm=Math.PI*2,Eve=180/EW,IW=(function(){function r(){}return r.prototype.reset=function(e){this._start=!0,this._d=[],this._str="",this._p=Math.pow(10,e||4)},r.prototype.moveTo=function(e,t){this._add("M",e,t)},r.prototype.lineTo=function(e,t){this._add("L",e,t)},r.prototype.bezierCurveTo=function(e,t,i,n,a,s){this._add("C",e,t,i,n,a,s)},r.prototype.quadraticCurveTo=function(e,t,i,n){this._add("Q",e,t,i,n)},r.prototype.arc=function(e,t,i,n,a,s){this.ellipse(e,t,i,i,0,n,a,s)},r.prototype.ellipse=function(e,t,i,n,a,s,o,l){var c=o-s,f=!l,p=Math.abs(c),y=Eg(p-Tm)||(f?c>=Tm:-c>=Tm),b=c>0?c%Tm:c%Tm+Tm,S=!1;y?S=!0:Eg(p)?S=!1:S=b>=EW==!!f;var C=e+i*PI(s),E=t+n*II(s);this._start&&this._add("M",C,E);var P=Math.round(a*Eve);if(y){var O=1/this._p,B=(f?1:-1)*(Tm-O);this._add("A",i,n,P,1,+f,e+i*PI(s+B),t+n*II(s+B)),O>.01&&this._add("A",i,n,P,0,+f,C,E)}else{var F=e+i*PI(o),W=t+n*II(o);this._add("A",i,n,P,+S,+f,F,W)}},r.prototype.rect=function(e,t,i,n){this._add("M",e,t),this._add("l",i,0),this._add("l",0,n),this._add("l",-i,0),this._add("Z")},r.prototype.closePath=function(){this._d.length>0&&this._add("Z")},r.prototype._add=function(e,t,i,n,a,s,o,l,c){for(var f=[],p=this._p,y=1;y<arguments.length;y++){var b=arguments[y];if(isNaN(b)){this._invalid=!0;return}f.push(Math.round(b*p)/p)}this._d.push(e+f.join(" ")),this._start=e==="Z"},r.prototype.generateStr=function(){this._str=this._invalid?"":this._d.join(""),this._d=[]},r.prototype.getStr=function(){return this._str},r})(),IL="none",Ive=Math.round;function Pve(r){var e=r.fill;return e!=null&&e!==IL}function Rve(r){var e=r.stroke;return e!=null&&e!==IL}var C3=["lineCap","miterLimit","lineJoin"],Dve=wt(C3,function(r){return"stroke-"+r.toLowerCase()});function kve(r,e,t,i){var n=e.opacity==null?1:e.opacity;if(t instanceof go){r("opacity",n);return}if(Pve(e)){var a=fw(e.fill);r("fill",a.color);var s=e.fillOpacity!=null?e.fillOpacity*a.opacity*n:a.opacity*n;s<1&&r("fill-opacity",s)}else r("fill",IL);if(Rve(e)){var o=fw(e.stroke);r("stroke",o.color);var l=e.strokeNoScale?t.getLineScale():1,c=l?(e.lineWidth||0)/l:0,f=e.strokeOpacity!=null?e.strokeOpacity*o.opacity*n:o.opacity*n,p=e.strokeFirst;if(c!==1&&r("stroke-width",c),p&&r("paint-order",p?"stroke":"fill"),f<1&&r("stroke-opacity",f),e.lineDash){var y=cL(t),b=y[0],S=y[1];b&&(S=Ive(S||0),r("stroke-dasharray",b.join(",")),(S||i)&&r("stroke-dashoffset",S))}for(var C=0;C<C3.length;C++){var E=C3[C];if(e[E]!==AA[E]){var P=e[E]||AA[E];P&&r(Dve[C],P)}}}}var PW="http://www.w3.org/2000/svg",RW="http://www.w3.org/1999/xlink",Lve="http://www.w3.org/2000/xmlns/",Ove="http://www.w3.org/XML/1998/namespace",zF="ecmeta_";function DW(r){return document.createElementNS(PW,r)}function co(r,e,t,i,n){return{tag:r,attrs:t||{},children:i,text:n,key:e}}function Nve(r,e){var t=[];if(e)for(var i in e){var n=e[i],a=i;n!==!1&&(n!==!0&&n!=null&&(a+='="'+n+'"'),t.push(a))}return"<"+r+" "+t.join(" ")+">"}function Bve(r){return"</"+r+">"}function PL(r,e){e=e||{};var t=e.newline?`
`:"";function i(n){var a=n.children,s=n.tag,o=n.attrs,l=n.text;return Nve(s,o)+(s!=="style"?Ms(l):l||"")+(a?""+t+wt(a,function(c){return i(c)}).join(t)+t:"")+Bve(s)}return i(r)}function zve(r,e,t){t=t||{};var i=t.newline?`
`:"",n=" {"+i,a=i+"}",s=wt(qr(r),function(l){return l+n+wt(qr(r[l]),function(c){return c+":"+r[l][c]+";"}).join(i)+a}).join(i),o=wt(qr(e),function(l){return"@keyframes "+l+n+wt(qr(e[l]),function(c){return c+n+wt(qr(e[l][c]),function(f){var p=e[l][c][f];return f==="d"&&(p='path("'+p+'")'),f+":"+p+";"}).join(i)+a}).join(i)+a}).join(i);return!s&&!o?"":["<![CDATA[",s,o,"]]>"].join(i)}function M3(r){return{zrId:r,shadowCache:{},patternCache:{},gradientCache:{},clipPathCache:{},defs:{},cssNodes:{},cssAnims:{},cssStyleCache:{},cssAnimIdx:0,shadowIdx:0,gradientIdx:0,patternIdx:0,clipPathIdx:0}}function FF(r,e,t,i){return co("svg","root",{width:r,height:e,xmlns:PW,"xmlns:xlink":RW,version:"1.1",baseProfile:"full",viewBox:i?"0 0 "+r+" "+e:!1},t)}var Fve=0;function kW(){return Fve++}var VF={cubicIn:"0.32,0,0.67,0",cubicOut:"0.33,1,0.68,1",cubicInOut:"0.65,0,0.35,1",quadraticIn:"0.11,0,0.5,0",quadraticOut:"0.5,1,0.89,1",quadraticInOut:"0.45,0,0.55,1",quarticIn:"0.5,0,0.75,0",quarticOut:"0.25,1,0.5,1",quarticInOut:"0.76,0,0.24,1",quinticIn:"0.64,0,0.78,0",quinticOut:"0.22,1,0.36,1",quinticInOut:"0.83,0,0.17,1",sinusoidalIn:"0.12,0,0.39,0",sinusoidalOut:"0.61,1,0.88,1",sinusoidalInOut:"0.37,0,0.63,1",exponentialIn:"0.7,0,0.84,0",exponentialOut:"0.16,1,0.3,1",exponentialInOut:"0.87,0,0.13,1",circularIn:"0.55,0,1,0.45",circularOut:"0,0.55,0.45,1",circularInOut:"0.85,0,0.15,1"},Mm="transform-origin";function Vve(r,e,t){var i=mt({},r.shape);mt(i,e),r.buildPath(t,i);var n=new IW;return n.reset(f$(r)),t.rebuildPath(n,1),n.generateStr(),n.getStr()}function Uve(r,e){var t=e.originX,i=e.originY;(t||i)&&(r[Mm]=t+"px "+i+"px")}var Hve={fill:"fill",opacity:"opacity",lineWidth:"stroke-width",lineDashOffset:"stroke-dashoffset"};function LW(r,e){var t=e.zrId+"-ani-"+e.cssAnimIdx++;return e.cssAnims[t]=r,t}function jve(r,e,t){var i=r.shape.paths,n={},a,s;if(se(i,function(l){var c=M3(t.zrId);c.animation=!0,nM(l,{},c,!0);var f=c.cssAnims,p=c.cssNodes,y=qr(f),b=y.length;if(b){s=y[b-1];var S=f[s];for(var C in S){var E=S[C];n[C]=n[C]||{d:""},n[C].d+=E.d||""}for(var P in p){var O=p[P].animation;O.indexOf(s)>=0&&(a=O)}}}),!!a){e.d=!1;var o=LW(n,t);return a.replace(s,o)}}function UF(r){return $t(r)?VF[r]?"cubic-bezier("+VF[r]+")":bk(r)?r:"":""}function nM(r,e,t,i){var n=r.animators,a=n.length,s=[];if(r instanceof FC){var o=jve(r,e,t);if(o)s.push(o);else if(!a)return}else if(!a)return;for(var l={},c=0;c<a;c++){var f=n[c],p=[f.getMaxTime()/1e3+"s"],y=UF(f.getClip().easing),b=f.getDelay();y?p.push(y):p.push("linear"),b&&p.push(b/1e3+"s"),f.getLoop()&&p.push("infinite");var S=p.join(" ");l[S]=l[S]||[S,[]],l[S][1].push(f)}function C(O){var B=O[1],F=B.length,W={},$={},q={},Q="animation-timing-function";function ee(Kt,zt,yr){for(var Gt=Kt.getTracks(),Jt=Kt.getMaxTime(),Tr=0;Tr<Gt.length;Tr++){var dr=Gt[Tr];if(dr.needsAnimate()){var $r=dr.keyframes,ii=dr.propName;if(yr&&(ii=yr(ii)),ii)for(var Zi=0;Zi<$r.length;Zi++){var In=$r[Zi],Li=Math.round(In.time/Jt*100)+"%",Oa=UF(In.easing),Na=In.rawValue;($t(Na)||di(Na))&&(zt[Li]=zt[Li]||{},zt[Li][ii]=In.rawValue,Oa&&(zt[Li][Q]=Oa))}}}}for(var te=0;te<F;te++){var ae=B[te],de=ae.targetName;de?de==="shape"&&ee(ae,$):!i&&ee(ae,W)}for(var ve in W){var ye={};m$(ye,r),mt(ye,W[ve]);var Ae=d$(ye),me=W[ve][Q];q[ve]=Ae?{transform:Ae}:{},Uve(q[ve],ye),me&&(q[ve][Q]=me)}var De,Fe=!0;for(var ve in $){q[ve]=q[ve]||{};var je=!De,me=$[ve][Q];je&&(De=new jf);var ct=De.len();De.reset(),q[ve].d=Vve(r,$[ve],De);var xe=De.len();if(!je&&ct!==xe){Fe=!1;break}me&&(q[ve][Q]=me)}if(!Fe)for(var ve in q)delete q[ve].d;if(!i)for(var te=0;te<F;te++){var ae=B[te],de=ae.targetName;de==="style"&&ee(ae,q,function(Gt){return Hve[Gt]})}for(var $e=qr(q),pt=!0,_t,te=1;te<$e.length;te++){var Dt=$e[te-1],qt=$e[te];if(q[Dt][Mm]!==q[qt][Mm]){pt=!1;break}_t=q[Dt][Mm]}if(pt&&_t){for(var ve in q)q[ve][Mm]&&delete q[ve][Mm];e[Mm]=_t}if(wi($e,function(Kt){return qr(q[Kt]).length>0}).length){var _r=LW(q,t);return _r+" "+O[0]+" both"}}for(var E in l){var o=C(l[E]);o&&s.push(o)}if(s.length){var P=t.zrId+"-cls-"+kW();t.cssNodes["."+P]={animation:s.join(",")},e.class=P}}function $ve(r,e,t){if(!r.ignore)if(r.isSilent()){var i={"pointer-events":"none"};HF(i,e,t)}else{var n=r.states.emphasis&&r.states.emphasis.style?r.states.emphasis.style:{},a=n.fill;if(!a){var s=r.style&&r.style.fill,o=r.states.select&&r.states.select.style&&r.states.select.style.fill,l=r.currentStates.indexOf("select")>=0&&o||s;l&&(a=xA(l))}var c=n.lineWidth;if(c){var f=!n.strokeNoScale&&r.transform?r.transform[0]:1;c=c/f}var i={cursor:"pointer"};a&&(i.fill=a),n.stroke&&(i.stroke=n.stroke),c&&(i["stroke-width"]=c),HF(i,e,t)}}function HF(r,e,t,i){var n=JSON.stringify(r),a=t.cssStyleCache[n];a||(a=t.zrId+"-cls-"+kW(),t.cssStyleCache[n]=a,t.cssNodes["."+a+":hover"]=r),e.class=e.class?e.class+" "+a:a}var Tw=Math.round;function OW(r){return r&&$t(r.src)}function NW(r){return r&&sr(r.toDataURL)}function RL(r,e,t,i){kve(function(n,a){var s=n==="fill"||n==="stroke";s&&h$(a)?zW(e,r,n,i):s&&wk(a)?FW(t,r,n,i):r[n]=a,s&&i.ssr&&a==="none"&&(r["pointer-events"]="visible")},e,t,!1),Kve(t,r,i)}function DL(r,e){var t=b$(e);t&&(t.each(function(i,n){i!=null&&(r[(zF+n).toLowerCase()]=i+"")}),e.isSilent()&&(r[zF+"silent"]="true"))}function jF(r){return Eg(r[0]-1)&&Eg(r[1])&&Eg(r[2])&&Eg(r[3]-1)}function Wve(r){return Eg(r[4])&&Eg(r[5])}function kL(r,e,t){if(e&&!(Wve(e)&&jF(e))){var i=1e4;r.transform=jF(e)?"translate("+Tw(e[4]*i)/i+" "+Tw(e[5]*i)/i+")":Yle(e)}}function $F(r,e,t){for(var i=r.points,n=[],a=0;a<i.length;a++)n.push(Tw(i[a][0]*t)/t),n.push(Tw(i[a][1]*t)/t);e.points=n.join(" ")}function WF(r){return!r.smooth}function Gve(r){var e=wt(r,function(t){return typeof t=="string"?[t,t]:t});return function(t,i,n){for(var a=0;a<e.length;a++){var s=e[a],o=t[s[0]];o!=null&&(i[s[1]]=Tw(o*n)/n)}}}var Xve={circle:[Gve(["cx","cy","r"])],polyline:[$F,WF],polygon:[$F,WF]};function Zve(r){for(var e=r.animators,t=0;t<e.length;t++)if(e[t].targetName==="shape")return!0;return!1}function BW(r,e){var t=r.style,i=r.shape,n=Xve[r.type],a={},s=e.animation,o="path",l=r.style.strokePercent,c=e.compress&&f$(r)||4;if(n&&!e.willUpdate&&!(n[1]&&!n[1](i))&&!(s&&Zve(r))&&!(l<1)){o=r.type;var f=Math.pow(10,c);n[0](i,a,f)}else{var p=!r.path||r.shapeChanged();r.path||r.createPathProxy();var y=r.path;p&&(y.beginPath(),r.buildPath(y,r.shape),r.pathUpdated());var b=y.getVersion(),S=r,C=S.__svgPathBuilder;(S.__svgPathVersion!==b||!C||l!==S.__svgPathStrokePercent)&&(C||(C=S.__svgPathBuilder=new IW),C.reset(c),y.rebuildPath(C,l),C.generateStr(),S.__svgPathVersion=b,S.__svgPathStrokePercent=l),a.d=C.getStr()}return kL(a,r.transform),RL(a,t,r,e),DL(a,r),e.animation&&nM(r,a,e),e.emphasis&&$ve(r,a,e),co(o,r.id+"",a)}function qve(r,e){var t=r.style,i=t.image;if(i&&!$t(i)&&(OW(i)?i=i.src:NW(i)&&(i=i.toDataURL())),!!i){var n=t.x||0,a=t.y||0,s=t.width,o=t.height,l={href:i,width:s,height:o};return n&&(l.x=n),a&&(l.y=a),kL(l,r.transform),RL(l,t,r,e),DL(l,r),e.animation&&nM(r,l,e),co("image",r.id+"",l)}}function Yve(r,e){var t=r.style,i=t.text;if(i!=null&&(i+=""),!(!i||isNaN(t.x)||isNaN(t.y))){var n=t.font||Ug,a=t.x||0,s=Qle(t.y||0,PC(n),t.textBaseline),o=Kle[t.textAlign]||t.textAlign,l={"dominant-baseline":"central","text-anchor":o};if(W$(t)){var c="",f=t.fontStyle,p=$$(t.fontSize);if(!parseFloat(p))return;var y=t.fontFamily||Nj,b=t.fontWeight;c+="font-size:"+p+";font-family:"+y+";",f&&f!=="normal"&&(c+="font-style:"+f+";"),b&&b!=="normal"&&(c+="font-weight:"+b+";"),l.style=c}else l.style="font: "+n;return i.match(/\s/)&&(l["xml:space"]="preserve"),a&&(l.x=a),s&&(l.y=s),kL(l,r.transform),RL(l,t,r,e),DL(l,r),e.animation&&nM(r,l,e),co("text",r.id+"",l,void 0,i)}}function GF(r,e){if(r instanceof Xr)return BW(r,e);if(r instanceof go)return qve(r,e);if(r instanceof G0)return Yve(r,e)}function Kve(r,e,t){var i=r.style;if(Jle(i)){var n=eue(r),a=t.shadowCache,s=a[n];if(!s){var o=r.getGlobalScale(),l=o[0],c=o[1];if(!l||!c)return;var f=i.shadowOffsetX||0,p=i.shadowOffsetY||0,y=i.shadowBlur,b=fw(i.shadowColor),S=b.opacity,C=b.color,E=y/2/l,P=y/2/c,O=E+" "+P;s=t.zrId+"-s"+t.shadowIdx++,t.defs[s]=co("filter",s,{id:s,x:"-100%",y:"-100%",width:"300%",height:"300%"},[co("feDropShadow","",{dx:f/l,dy:p/c,stdDeviation:O,"flood-color":C,"flood-opacity":S})]),a[n]=s}e.filter=IC(s)}}function zW(r,e,t,i){var n=r[t],a,s={gradientUnits:n.global?"userSpaceOnUse":"objectBoundingBox"};if(u$(n))a="linearGradient",s.x1=n.x,s.y1=n.y,s.x2=n.x2,s.y2=n.y2;else if(c$(n))a="radialGradient",s.cx=wr(n.x,.5),s.cy=wr(n.y,.5),s.r=wr(n.r,.5);else return;for(var o=n.colorStops,l=[],c=0,f=o.length;c<f;++c){var p=NR(o[c].offset)*100+"%",y=o[c].color,b=fw(y),S=b.color,C=b.opacity,E={offset:p};E["stop-color"]=S,C<1&&(E["stop-opacity"]=C),l.push(co("stop",c+"",E))}var P=co(a,"",s,l),O=PL(P),B=i.gradientCache,F=B[O];F||(F=i.zrId+"-g"+i.gradientIdx++,B[O]=F,s.id=F,i.defs[F]=co(a,F,s,l)),e[t]=IC(F)}function FW(r,e,t,i){var n=r.style[t],a=r.getBoundingRect(),s={},o=n.repeat,l=o==="no-repeat",c=o==="repeat-x",f=o==="repeat-y",p;if(l$(n)){var y=n.imageWidth,b=n.imageHeight,S=void 0,C=n.image;if($t(C)?S=C:OW(C)?S=C.src:NW(C)&&(S=C.toDataURL()),typeof Image>"u"){var E="Image width/height must been given explictly in svg-ssr renderer.";Is(y,E),Is(b,E)}else if(y==null||b==null){var P=function(te,ae){if(te){var de=te.elm,ve=y||ae.width,ye=b||ae.height;te.tag==="pattern"&&(c?(ye=1,ve/=a.width):f&&(ve=1,ye/=a.height)),te.attrs.width=ve,te.attrs.height=ye,de&&(de.setAttribute("width",ve),de.setAttribute("height",ye))}},O=Rk(S,null,r,function(te){l||P($,te),P(p,te)});O&&O.width&&O.height&&(y=y||O.width,b=b||O.height)}p=co("image","img",{href:S,width:y,height:b}),s.width=y,s.height=b}else n.svgElement&&(p=hr(n.svgElement),s.width=n.svgWidth,s.height=n.svgHeight);if(p){var B,F;l?B=F=1:c?(F=1,B=s.width/a.width):f?(B=1,F=s.height/a.height):s.patternUnits="userSpaceOnUse",B!=null&&!isNaN(B)&&(s.width=B),F!=null&&!isNaN(F)&&(s.height=F);var W=d$(n);W&&(s.patternTransform=W);var $=co("pattern","",s,[p]),q=PL($),Q=i.patternCache,ee=Q[q];ee||(ee=i.zrId+"-p"+i.patternIdx++,Q[q]=ee,s.id=ee,$=i.defs[ee]=co("pattern",ee,s,[p])),e[t]=IC(ee)}}function Qve(r,e,t){var i=t.clipPathCache,n=t.defs,a=i[r.id];if(!a){a=t.zrId+"-c"+t.clipPathIdx++;var s={id:a};i[r.id]=a,n[a]=co("clipPath",a,s,[BW(r,t)])}e["clip-path"]=IC(a)}function XF(r){return document.createTextNode(r)}function Om(r,e,t){r.insertBefore(e,t)}function ZF(r,e){r.removeChild(e)}function qF(r,e){r.appendChild(e)}function VW(r){return r.parentNode}function UW(r){return r.nextSibling}function RI(r,e){r.textContent=e}var YF=58,Jve=120,eme=co("","");function E3(r){return r===void 0}function Ef(r){return r!==void 0}function tme(r,e,t){for(var i={},n=e;n<=t;++n){var a=r[n].key;a!==void 0&&(i[a]=n)}return i}function x1(r,e){var t=r.key===e.key,i=r.tag===e.tag;return i&&t}function Aw(r){var e,t=r.children,i=r.tag;if(Ef(i)){var n=r.elm=DW(i);if(LL(eme,r),xt(t))for(e=0;e<t.length;++e){var a=t[e];a!=null&&qF(n,Aw(a))}else Ef(r.text)&&!cr(r.text)&&qF(n,XF(r.text))}else r.elm=XF(r.text);return r.elm}function HW(r,e,t,i,n){for(;i<=n;++i){var a=t[i];a!=null&&Om(r,Aw(a),e)}}function GA(r,e,t,i){for(;t<=i;++t){var n=e[t];if(n!=null)if(Ef(n.tag)){var a=VW(n.elm);ZF(a,n.elm)}else ZF(r,n.elm)}}function LL(r,e){var t,i=e.elm,n=r&&r.attrs||{},a=e.attrs||{};if(n!==a){for(t in a){var s=a[t],o=n[t];o!==s&&(s===!0?i.setAttribute(t,""):s===!1?i.removeAttribute(t):t==="style"?i.style.cssText=s:t.charCodeAt(0)!==Jve?i.setAttribute(t,s):t==="xmlns:xlink"||t==="xmlns"?i.setAttributeNS(Lve,t,s):t.charCodeAt(3)===YF?i.setAttributeNS(Ove,t,s):t.charCodeAt(5)===YF?i.setAttributeNS(RW,t,s):i.setAttribute(t,s))}for(t in n)t in a||i.removeAttribute(t)}}function rme(r,e,t){for(var i=0,n=0,a=e.length-1,s=e[0],o=e[a],l=t.length-1,c=t[0],f=t[l],p,y,b,S;i<=a&&n<=l;)s==null?s=e[++i]:o==null?o=e[--a]:c==null?c=t[++n]:f==null?f=t[--l]:x1(s,c)?(c0(s,c),s=e[++i],c=t[++n]):x1(o,f)?(c0(o,f),o=e[--a],f=t[--l]):x1(s,f)?(c0(s,f),Om(r,s.elm,UW(o.elm)),s=e[++i],f=t[--l]):x1(o,c)?(c0(o,c),Om(r,o.elm,s.elm),o=e[--a],c=t[++n]):(E3(p)&&(p=tme(e,i,a)),y=p[c.key],E3(y)?Om(r,Aw(c),s.elm):(b=e[y],b.tag!==c.tag?Om(r,Aw(c),s.elm):(c0(b,c),e[y]=void 0,Om(r,b.elm,s.elm))),c=t[++n]);(i<=a||n<=l)&&(i>a?(S=t[l+1]==null?null:t[l+1].elm,HW(r,S,t,n,l)):GA(r,e,i,a))}function c0(r,e){var t=e.elm=r.elm,i=r.children,n=e.children;r!==e&&(LL(r,e),E3(e.text)?Ef(i)&&Ef(n)?i!==n&&rme(t,i,n):Ef(n)?(Ef(r.text)&&RI(t,""),HW(t,null,n,0,n.length-1)):Ef(i)?GA(t,i,0,i.length-1):Ef(r.text)&&RI(t,""):r.text!==e.text&&(Ef(i)&&GA(t,i,0,i.length-1),RI(t,e.text)))}function ime(r,e){if(x1(r,e))c0(r,e);else{var t=r.elm,i=VW(t);Aw(e),i!==null&&(Om(i,e.elm,UW(t)),GA(i,[r],0,0))}return e}var nme=0,ame=(function(){function r(e,t,i){if(this.type="svg",this.refreshHover=KF(),this.configLayer=KF(),this.storage=t,this._opts=i=mt({},i),this.root=e,this._id="zr"+nme++,this._oldVNode=FF(i.width,i.height),e&&!i.ssr){var n=this._viewport=document.createElement("div");n.style.cssText="position:relative;overflow:hidden";var a=this._svgDom=this._oldVNode.elm=DW("svg");LL(null,this._oldVNode),n.appendChild(a),e.appendChild(n)}this.resize(i.width,i.height)}return r.prototype.getType=function(){return this.type},r.prototype.getViewportRoot=function(){return this._viewport},r.prototype.getViewportRootOffset=function(){var e=this.getViewportRoot();if(e)return{offsetLeft:e.offsetLeft||0,offsetTop:e.offsetTop||0}},r.prototype.getSvgDom=function(){return this._svgDom},r.prototype.refresh=function(){if(this.root){var e=this.renderToVNode({willUpdate:!0});e.attrs.style="position:absolute;left:0;top:0;user-select:none",ime(this._oldVNode,e),this._oldVNode=e}},r.prototype.renderOneToVNode=function(e){return GF(e,M3(this._id))},r.prototype.renderToVNode=function(e){e=e||{};var t=this.storage.getDisplayList(!0),i=this._width,n=this._height,a=M3(this._id);a.animation=e.animation,a.willUpdate=e.willUpdate,a.compress=e.compress,a.emphasis=e.emphasis,a.ssr=this._opts.ssr;var s=[],o=this._bgVNode=ome(i,n,this._backgroundColor,a);o&&s.push(o);var l=e.compress?null:this._mainVNode=co("g","main",{},[]);this._paintList(t,a,l?l.children:s),l&&s.push(l);var c=wt(qr(a.defs),function(y){return a.defs[y]});if(c.length&&s.push(co("defs","defs",{},c)),e.animation){var f=zve(a.cssNodes,a.cssAnims,{newline:!0});if(f){var p=co("style","stl",{},[],f);s.push(p)}}return FF(i,n,s,e.useViewBox)},r.prototype.renderToString=function(e){return e=e||{},PL(this.renderToVNode({animation:wr(e.cssAnimation,!0),emphasis:wr(e.cssEmphasis,!0),willUpdate:!1,compress:!0,useViewBox:wr(e.useViewBox,!0)}),{newline:!0})},r.prototype.setBackgroundColor=function(e){this._backgroundColor=e},r.prototype.getSvgRoot=function(){return this._mainVNode&&this._mainVNode.elm},r.prototype._paintList=function(e,t,i){for(var n=e.length,a=[],s=0,o,l,c=0,f=0;f<n;f++){var p=e[f];if(!p.invisible){var y=p.__clipPaths,b=y&&y.length||0,S=l&&l.length||0,C=void 0;for(C=Math.max(b-1,S-1);C>=0&&!(y&&l&&y[C]===l[C]);C--);for(var E=S-1;E>C;E--)s--,o=a[s-1];for(var P=C+1;P<b;P++){var O={};Qve(y[P],O,t);var B=co("g","clip-g-"+c++,O,[]);(o?o.children:i).push(B),a[s++]=B,o=B}l=y;var F=GF(p,t);F&&(o?o.children:i).push(F)}}},r.prototype.resize=function(e,t){var i=this._opts,n=this.root,a=this._viewport;if(e!=null&&(i.width=e),t!=null&&(i.height=t),n&&a&&(a.style.display="none",e=x0(n,0,i),t=x0(n,1,i),a.style.display=""),this._width!==e||this._height!==t){if(this._width=e,this._height=t,a){var s=a.style;s.width=e+"px",s.height=t+"px"}if(wk(this._backgroundColor))this.refresh();else{var o=this._svgDom;o&&(o.setAttribute("width",e),o.setAttribute("height",t));var l=this._bgVNode&&this._bgVNode.elm;l&&(l.setAttribute("width",e),l.setAttribute("height",t))}}},r.prototype.getWidth=function(){return this._width},r.prototype.getHeight=function(){return this._height},r.prototype.dispose=function(){this.root&&(this.root.innerHTML=""),this._svgDom=this._viewport=this.storage=this._oldVNode=this._bgVNode=this._mainVNode=null},r.prototype.clear=function(){this._svgDom&&(this._svgDom.innerHTML=null),this._oldVNode=null},r.prototype.toDataURL=function(e){var t=this.renderToString(),i="data:image/svg+xml;";return e?(t=rue(t),t&&i+"base64,"+t):i+"charset=UTF-8,"+encodeURIComponent(t)},r})();function KF(r){return function(){}}function ome(r,e,t,i){var n;if(t&&t!=="none")if(n=co("rect","bg",{width:r,height:e,x:"0",y:"0"}),h$(t))zW({fill:t},n.attrs,"fill",i);else if(wk(t))FW({style:{fill:t},dirty:ca,getBoundingRect:function(){return{width:r,height:e}}},n.attrs,"fill",i);else{var a=fw(t),s=a.color,o=a.opacity;n.attrs.fill=s,o<1&&(n.attrs["fill-opacity"]=o)}return n}function sme(r){r.registerPainter("svg",ame)}function QF(r,e,t){var i=Ih.createCanvas(),n=e.getWidth(),a=e.getHeight(),s=i.style;return s&&(s.position="absolute",s.left="0",s.top="0",s.width=n+"px",s.height=a+"px",i.setAttribute("data-zr-dom-id",r)),i.width=n*t,i.height=a*t,i}var DI=(function(r){Ye(e,r);function e(t,i,n){var a=r.call(this)||this;a.motionBlur=!1,a.lastFrameAlpha=.7,a.dpr=1,a.virtual=!1,a.config={},a.incremental=!1,a.zlevel=0,a.maxRepaintRectCount=5,a.__dirty=!0,a.__firstTimePaint=!0,a.__used=!1,a.__drawIndex=0,a.__startIndex=0,a.__endIndex=0,a.__prevStartIndex=null,a.__prevEndIndex=null;var s;n=n||SA,typeof t=="string"?s=QF(t,i,n):cr(t)&&(s=t,t=s.id),a.id=t,a.dom=s;var o=s.style;return o&&(mk(s),s.onselectstart=function(){return!1},o.padding="0",o.margin="0",o.borderWidth="0"),a.painter=i,a.dpr=n,a}return e.prototype.getElementCount=function(){return this.__endIndex-this.__startIndex},e.prototype.afterBrush=function(){this.__prevStartIndex=this.__startIndex,this.__prevEndIndex=this.__endIndex},e.prototype.initContext=function(){this.ctx=this.dom.getContext("2d"),this.ctx.dpr=this.dpr},e.prototype.setUnpainted=function(){this.__firstTimePaint=!0},e.prototype.createBackBuffer=function(){var t=this.dpr;this.domBack=QF("back-"+this.id,this.painter,t),this.ctxBack=this.domBack.getContext("2d"),t!==1&&this.ctxBack.scale(t,t)},e.prototype.createRepaintRects=function(t,i,n,a){if(this.__firstTimePaint)return this.__firstTimePaint=!1,null;var s=[],o=this.maxRepaintRectCount,l=!1,c=new Dr(0,0,0,0);function f(O){if(!(!O.isFinite()||O.isZero()))if(s.length===0){var B=new Dr(0,0,0,0);B.copy(O),s.push(B)}else{for(var F=!1,W=1/0,$=0,q=0;q<s.length;++q){var Q=s[q];if(Q.intersect(O)){var ee=new Dr(0,0,0,0);ee.copy(Q),ee.union(O),s[q]=ee,F=!0;break}else if(l){c.copy(O),c.union(Q);var te=O.width*O.height,ae=Q.width*Q.height,de=c.width*c.height,ve=de-te-ae;ve<W&&(W=ve,$=q)}}if(l&&(s[$].union(O),F=!0),!F){var B=new Dr(0,0,0,0);B.copy(O),s.push(B)}l||(l=s.length>=o)}}for(var p=this.__startIndex;p<this.__endIndex;++p){var y=t[p];if(y){var b=y.shouldBePainted(n,a,!0,!0),S=y.__isRendered&&(y.__dirty&gu||!b)?y.getPrevPaintRect():null;S&&f(S);var C=b&&(y.__dirty&gu||!y.__isRendered)?y.getPaintRect():null;C&&f(C)}}for(var p=this.__prevStartIndex;p<this.__prevEndIndex;++p){var y=i[p],b=y&&y.shouldBePainted(n,a,!0,!0);if(y&&(!b||!y.__zr)&&y.__isRendered){var S=y.getPrevPaintRect();S&&f(S)}}var E;do{E=!1;for(var p=0;p<s.length;){if(s[p].isZero()){s.splice(p,1);continue}for(var P=p+1;P<s.length;)s[p].intersect(s[P])?(E=!0,s[p].union(s[P]),s.splice(P,1)):P++;p++}}while(E);return this._paintRects=s,s},e.prototype.debugGetPaintRects=function(){return(this._paintRects||[]).slice()},e.prototype.resize=function(t,i){var n=this.dpr,a=this.dom,s=a.style,o=this.domBack;s&&(s.width=t+"px",s.height=i+"px"),a.width=t*n,a.height=i*n,o&&(o.width=t*n,o.height=i*n,n!==1&&this.ctxBack.scale(n,n))},e.prototype.clear=function(t,i,n){var a=this.dom,s=this.ctx,o=a.width,l=a.height;i=i||this.clearColor;var c=this.motionBlur&&!t,f=this.lastFrameAlpha,p=this.dpr,y=this;c&&(this.domBack||this.createBackBuffer(),this.ctxBack.globalCompositeOperation="copy",this.ctxBack.drawImage(a,0,0,o/p,l/p));var b=this.domBack;function S(C,E,P,O){if(s.clearRect(C,E,P,O),i&&i!=="transparent"){var B=void 0;if(Uw(i)){var F=i.global||i.__width===P&&i.__height===O;B=F&&i.__canvasGradient||m3(s,i,{x:0,y:0,width:P,height:O}),i.__canvasGradient=B,i.__width=P,i.__height=O}else Uj(i)&&(i.scaleX=i.scaleX||p,i.scaleY=i.scaleY||p,B=y3(s,i,{dirty:function(){y.setUnpainted(),y.painter.refresh()}}));s.save(),s.fillStyle=B||i,s.fillRect(C,E,P,O),s.restore()}c&&(s.save(),s.globalAlpha=f,s.drawImage(b,C,E,P,O),s.restore())}!n||c?S(0,0,o,l):n.length&&se(n,function(C){S(C.x*p,C.y*p,C.width*p,C.height*p)})},e})(Cc),JF=1e5,Am=314159,qT=.01,lme=.001;function ume(r){return r?r.__builtin__?!0:!(typeof r.resize!="function"||typeof r.refresh!="function"):!1}function cme(r,e){var t=document.createElement("div");return t.style.cssText=["position:relative","width:"+r+"px","height:"+e+"px","padding:0","margin:0","border-width:0"].join(";")+";",t}var hme=(function(){function r(e,t,i,n){this.type="canvas",this._zlevelList=[],this._prevDisplayList=[],this._layers={},this._layerConfig={},this._needsManuallyCompositing=!1,this.type="canvas";var a=!e.nodeName||e.nodeName.toUpperCase()==="CANVAS";this._opts=i=mt({},i||{}),this.dpr=i.devicePixelRatio||SA,this._singleCanvas=a,this.root=e;var s=e.style;s&&(mk(e),e.innerHTML=""),this.storage=t;var o=this._zlevelList;this._prevDisplayList=[];var l=this._layers;if(a){var f=e,p=f.width,y=f.height;i.width!=null&&(p=i.width),i.height!=null&&(y=i.height),this.dpr=i.devicePixelRatio||1,f.width=p*this.dpr,f.height=y*this.dpr,this._width=p,this._height=y;var b=new DI(f,this,this.dpr);b.__builtin__=!0,b.initContext(),l[Am]=b,b.zlevel=Am,o.push(Am),this._domRoot=e}else{this._width=x0(e,0,i),this._height=x0(e,1,i);var c=this._domRoot=cme(this._width,this._height);e.appendChild(c)}}return r.prototype.getType=function(){return"canvas"},r.prototype.isSingleCanvas=function(){return this._singleCanvas},r.prototype.getViewportRoot=function(){return this._domRoot},r.prototype.getViewportRootOffset=function(){var e=this.getViewportRoot();if(e)return{offsetLeft:e.offsetLeft||0,offsetTop:e.offsetTop||0}},r.prototype.refresh=function(e){var t=this.storage.getDisplayList(!0),i=this._prevDisplayList,n=this._zlevelList;this._redrawId=Math.random(),this._paintList(t,i,e,this._redrawId);for(var a=0;a<n.length;a++){var s=n[a],o=this._layers[s];if(!o.__builtin__&&o.refresh){var l=a===0?this._backgroundColor:null;o.refresh(l)}}return this._opts.useDirtyRect&&(this._prevDisplayList=t.slice()),this},r.prototype.refreshHover=function(){this._paintHoverList(this.storage.getDisplayList(!1))},r.prototype._paintHoverList=function(e){var t=e.length,i=this._hoverlayer;if(i&&i.clear(),!!t){for(var n={inHover:!0,viewWidth:this._width,viewHeight:this._height},a,s=0;s<t;s++){var o=e[s];o.__inHover&&(i||(i=this._hoverlayer=this.getLayer(JF)),a||(a=i.ctx,a.save()),Xm(a,o,n,s===t-1))}a&&a.restore()}},r.prototype.getHoverLayer=function(){return this.getLayer(JF)},r.prototype.paintOne=function(e,t){hL(e,t)},r.prototype._paintList=function(e,t,i,n){if(this._redrawId===n){i=i||!1,this._updateLayerStatus(e);var a=this._doPaintList(e,t,i),s=a.finished,o=a.needsRefreshHover;if(this._needsManuallyCompositing&&this._compositeManually(),o&&this._paintHoverList(e),s)this.eachLayer(function(c){c.afterBrush&&c.afterBrush()});else{var l=this;mA(function(){l._paintList(e,t,i,n)})}}},r.prototype._compositeManually=function(){var e=this.getLayer(Am).ctx,t=this._domRoot.width,i=this._domRoot.height;e.clearRect(0,0,t,i),this.eachBuiltinLayer(function(n){n.virtual&&e.drawImage(n.dom,0,0,t,i)})},r.prototype._doPaintList=function(e,t,i){for(var n=this,a=[],s=this._opts.useDirtyRect,o=0;o<this._zlevelList.length;o++){var l=this._zlevelList[o],c=this._layers[l];c.__builtin__&&c!==this._hoverlayer&&(c.__dirty||i)&&a.push(c)}for(var f=!0,p=!1,y=function(C){var E=a[C],P=E.ctx,O=s&&E.createRepaintRects(e,t,b._width,b._height),B=i?E.__startIndex:E.__drawIndex,F=!i&&E.incremental&&Date.now,W=F&&Date.now(),$=E.zlevel===b._zlevelList[0]?b._backgroundColor:null;if(E.__startIndex===E.__endIndex)E.clear(!1,$,O);else if(B===E.__startIndex){var q=e[B];(!q.incremental||!q.notClear||i)&&E.clear(!1,$,O)}B===-1&&(console.error("For some unknown reason. drawIndex is -1"),B=E.__startIndex);var Q,ee=function(ve){var ye={inHover:!1,allClipped:!1,prevEl:null,viewWidth:n._width,viewHeight:n._height};for(Q=B;Q<E.__endIndex;Q++){var Ae=e[Q];if(Ae.__inHover&&(p=!0),n._doPaintEl(Ae,E,s,ve,ye,Q===E.__endIndex-1),F){var me=Date.now()-W;if(me>15)break}}ye.prevElClipPaths&&P.restore()};if(O)if(O.length===0)Q=E.__endIndex;else for(var te=b.dpr,ae=0;ae<O.length;++ae){var de=O[ae];P.save(),P.beginPath(),P.rect(de.x*te,de.y*te,de.width*te,de.height*te),P.clip(),ee(de),P.restore()}else P.save(),ee(),P.restore();E.__drawIndex=Q,E.__drawIndex<E.__endIndex&&(f=!1)},b=this,S=0;S<a.length;S++)y(S);return Gr.wxa&&se(this._layers,function(C){C&&C.ctx&&C.ctx.draw&&C.ctx.draw()}),{finished:f,needsRefreshHover:p}},r.prototype._doPaintEl=function(e,t,i,n,a,s){var o=t.ctx;if(i){var l=e.getPaintRect();(!n||l&&l.intersect(n))&&(Xm(o,e,a,s),e.setPrevPaintRect(l))}else Xm(o,e,a,s)},r.prototype.getLayer=function(e,t){this._singleCanvas&&!this._needsManuallyCompositing&&(e=Am);var i=this._layers[e];return i||(i=new DI("zr_"+e,this,this.dpr),i.zlevel=e,i.__builtin__=!0,this._layerConfig[e]?Cr(i,this._layerConfig[e],!0):this._layerConfig[e-qT]&&Cr(i,this._layerConfig[e-qT],!0),t&&(i.virtual=t),this.insertLayer(e,i),i.initContext()),i},r.prototype.insertLayer=function(e,t){var i=this._layers,n=this._zlevelList,a=n.length,s=this._domRoot,o=null,l=-1;if(!i[e]&&ume(t)){if(a>0&&e>n[0]){for(l=0;l<a-1&&!(n[l]<e&&n[l+1]>e);l++);o=i[n[l]]}if(n.splice(l+1,0,e),i[e]=t,!t.virtual)if(o){var c=o.dom;c.nextSibling?s.insertBefore(t.dom,c.nextSibling):s.appendChild(t.dom)}else s.firstChild?s.insertBefore(t.dom,s.firstChild):s.appendChild(t.dom);t.painter||(t.painter=this)}},r.prototype.eachLayer=function(e,t){for(var i=this._zlevelList,n=0;n<i.length;n++){var a=i[n];e.call(t,this._layers[a],a)}},r.prototype.eachBuiltinLayer=function(e,t){for(var i=this._zlevelList,n=0;n<i.length;n++){var a=i[n],s=this._layers[a];s.__builtin__&&e.call(t,s,a)}},r.prototype.eachOtherLayer=function(e,t){for(var i=this._zlevelList,n=0;n<i.length;n++){var a=i[n],s=this._layers[a];s.__builtin__||e.call(t,s,a)}},r.prototype.getLayers=function(){return this._layers},r.prototype._updateLayerStatus=function(e){this.eachBuiltinLayer(function(p,y){p.__dirty=p.__used=!1});function t(p){a&&(a.__endIndex!==p&&(a.__dirty=!0),a.__endIndex=p)}if(this._singleCanvas)for(var i=1;i<e.length;i++){var n=e[i];if(n.zlevel!==e[i-1].zlevel||n.incremental){this._needsManuallyCompositing=!0;break}}var a=null,s=0,o,l;for(l=0;l<e.length;l++){var n=e[l],c=n.zlevel,f=void 0;o!==c&&(o=c,s=0),n.incremental?(f=this.getLayer(c+lme,this._needsManuallyCompositing),f.incremental=!0,s=1):f=this.getLayer(c+(s>0?qT:0),this._needsManuallyCompositing),f.__builtin__||SC("ZLevel "+c+" has been used by unkown layer "+f.id),f!==a&&(f.__used=!0,f.__startIndex!==l&&(f.__dirty=!0),f.__startIndex=l,f.incremental?f.__drawIndex=-1:f.__drawIndex=l,t(l),a=f),n.__dirty&gu&&!n.__inHover&&(f.__dirty=!0,f.incremental&&f.__drawIndex<0&&(f.__drawIndex=l))}t(l),this.eachBuiltinLayer(function(p,y){!p.__used&&p.getElementCount()>0&&(p.__dirty=!0,p.__startIndex=p.__endIndex=p.__drawIndex=0),p.__dirty&&p.__drawIndex<0&&(p.__drawIndex=p.__startIndex)})},r.prototype.clear=function(){return this.eachBuiltinLayer(this._clearLayer),this},r.prototype._clearLayer=function(e){e.clear()},r.prototype.setBackgroundColor=function(e){this._backgroundColor=e,se(this._layers,function(t){t.setUnpainted()})},r.prototype.configLayer=function(e,t){if(t){var i=this._layerConfig;i[e]?Cr(i[e],t,!0):i[e]=t;for(var n=0;n<this._zlevelList.length;n++){var a=this._zlevelList[n];if(a===e||a===e+qT){var s=this._layers[a];Cr(s,i[e],!0)}}}},r.prototype.delLayer=function(e){var t=this._layers,i=this._zlevelList,n=t[e];n&&(n.dom.parentNode.removeChild(n.dom),delete t[e],i.splice(Or(i,e),1))},r.prototype.resize=function(e,t){if(this._domRoot.style){var i=this._domRoot;i.style.display="none";var n=this._opts,a=this.root;if(e!=null&&(n.width=e),t!=null&&(n.height=t),e=x0(a,0,n),t=x0(a,1,n),i.style.display="",this._width!==e||t!==this._height){i.style.width=e+"px",i.style.height=t+"px";for(var s in this._layers)this._layers.hasOwnProperty(s)&&this._layers[s].resize(e,t);this.refresh(!0)}this._width=e,this._height=t}else{if(e==null||t==null)return;this._width=e,this._height=t,this.getLayer(Am).resize(e,t)}return this},r.prototype.clearLayer=function(e){var t=this._layers[e];t&&t.clear()},r.prototype.dispose=function(){this.root.innerHTML="",this.root=this.storage=this._domRoot=this._layers=null},r.prototype.getRenderedCanvas=function(e){if(e=e||{},this._singleCanvas&&!this._compositeManually)return this._layers[Am].dom;var t=new DI("image",this,e.pixelRatio||this.dpr);t.initContext(),t.clear(!1,e.backgroundColor||this._backgroundColor);var i=t.ctx;if(e.pixelRatio<=this.dpr){this.refresh();var n=t.dom.width,a=t.dom.height;this.eachLayer(function(p){p.__builtin__?i.drawImage(p.dom,0,0,n,a):p.renderToCanvas&&(i.save(),p.renderToCanvas(i),i.restore())})}else for(var s={inHover:!1,viewWidth:this._width,viewHeight:this._height},o=this.storage.getDisplayList(!0),l=0,c=o.length;l<c;l++){var f=o[l];Xm(i,f,s,l===c-1)}return t.dom},r.prototype.getWidth=function(){return this._width},r.prototype.getHeight=function(){return this._height},r})();function fme(r){r.registerPainter("canvas",hme)}var dme=(function(r){Ye(e,r);function e(){var t=r!==null&&r.apply(this,arguments)||this;return t.type=e.type,t.hasSymbolVisual=!0,t}return e.prototype.getInitialData=function(t){return Gf(null,this,{useEncodeDefaulter:!0})},e.prototype.getLegendIcon=function(t){var i=new mr,n=Aa("line",0,t.itemHeight/2,t.itemWidth,0,t.lineStyle.stroke,!1);i.add(n),n.setStyle(t.lineStyle);var a=this.getData().getVisual("symbol"),s=this.getData().getVisual("symbolRotate"),o=a==="none"?"circle":a,l=t.itemHeight*.8,c=Aa(o,(t.itemWidth-l)/2,(t.itemHeight-l)/2,l,l,t.itemStyle.fill);i.add(c),c.setStyle(t.itemStyle);var f=t.iconRotate==="inherit"?s:t.iconRotate||0;return c.rotation=f*Math.PI/180,c.setOrigin([t.itemWidth/2,t.itemHeight/2]),o.indexOf("empty")>-1&&(c.style.stroke=c.style.fill,c.style.fill="#fff",c.style.lineWidth=2),i},e.type="series.line",e.dependencies=["grid","polar"],e.defaultOption={z:3,coordinateSystem:"cartesian2d",legendHoverLink:!0,clip:!0,label:{position:"top"},endLabel:{show:!1,valueAnimation:!0,distance:8},lineStyle:{width:2,type:"solid"},emphasis:{scale:!0},step:!1,smooth:!1,smoothMonotone:null,symbol:"emptyCircle",symbolSize:4,symbolRotate:null,showSymbol:!0,showAllSymbol:"auto",connectNulls:!1,sampling:"none",animationEasing:"linear",progressive:0,hoverLayerThreshold:1/0,universalTransition:{divideShape:"clone"},triggerLineEvent:!1},e})(Xi);function Y0(r,e){var t=r.mapDimensionsAll("defaultedLabel"),i=t.length;if(i===1){var n=Z0(r,e,t[0]);return n!=null?n+"":null}else if(i){for(var a=[],s=0;s<t.length;s++)a.push(Z0(r,e,t[s]));return a.join(" ")}}function jW(r,e){var t=r.mapDimensionsAll("defaultedLabel");if(!xt(e))return e+"";for(var i=[],n=0;n<t.length;n++){var a=r.getDimensionIndex(t[n]);a>=0&&i.push(e[a])}return i.join(" ")}var tS=(function(r){Ye(e,r);function e(t,i,n,a){var s=r.call(this)||this;return s.updateData(t,i,n,a),s}return e.prototype._createSymbol=function(t,i,n,a,s){this.removeAll();var o=Aa(t,-1,-1,2,2,null,s);o.attr({z2:100,culling:!0,scaleX:a[0]/2,scaleY:a[1]/2}),o.drift=pme,this._symbolType=t,this.add(o)},e.prototype.stopSymbolAnimation=function(t){this.childAt(0).stopAnimation(null,t)},e.prototype.getSymbolType=function(){return this._symbolType},e.prototype.getSymbolPath=function(){return this.childAt(0)},e.prototype.highlight=function(){cp(this.childAt(0))},e.prototype.downplay=function(){hp(this.childAt(0))},e.prototype.setZ=function(t,i){var n=this.childAt(0);n.zlevel=t,n.z=i},e.prototype.setDraggable=function(t,i){var n=this.childAt(0);n.draggable=t,n.cursor=!i&&t?"move":n.cursor},e.prototype.updateData=function(t,i,n,a){this.silent=!1;var s=t.getItemVisual(i,"symbol")||"circle",o=t.hostModel,l=e.getSymbolSize(t,i),c=s!==this._symbolType,f=a&&a.disableAnimation;if(c){var p=t.getItemVisual(i,"symbolKeepAspect");this._createSymbol(s,t,i,l,p)}else{var y=this.childAt(0);y.silent=!1;var b={scaleX:l[0]/2,scaleY:l[1]/2};f?y.attr(b):vi(y,b,o,i),Dh(y)}if(this._updateCommon(t,i,l,n,a),c){var y=this.childAt(0);if(!f){var b={scaleX:this._sizeX,scaleY:this._sizeY,style:{opacity:y.style.opacity}};y.scaleX=y.scaleY=0,y.style.opacity=0,An(y,b,o,i)}}f&&this.childAt(0).stopAnimation("leave")},e.prototype._updateCommon=function(t,i,n,a,s){var o=this.childAt(0),l=t.hostModel,c,f,p,y,b,S,C,E,P;if(a&&(c=a.emphasisItemStyle,f=a.blurItemStyle,p=a.selectItemStyle,y=a.focus,b=a.blurScope,C=a.labelStatesModels,E=a.hoverScale,P=a.cursorStyle,S=a.emphasisDisabled),!a||t.hasItemOption){var O=a&&a.itemModel?a.itemModel:t.getItemModel(i),B=O.getModel("emphasis");c=B.getModel("itemStyle").getItemStyle(),p=O.getModel(["select","itemStyle"]).getItemStyle(),f=O.getModel(["blur","itemStyle"]).getItemStyle(),y=B.get("focus"),b=B.get("blurScope"),S=B.get("disabled"),C=fo(O),E=B.getShallow("scale"),P=O.getShallow("cursor")}var F=t.getItemVisual(i,"symbolRotate");o.attr("rotation",(F||0)*Math.PI/180||0);var W=Dy(t.getItemVisual(i,"symbolOffset"),n);W&&(o.x=W[0],o.y=W[1]),P&&o.attr("cursor",P);var $=t.getItemVisual(i,"style"),q=$.fill;if(o instanceof go){var Q=o.style;o.useStyle(mt({image:Q.image,x:Q.x,y:Q.y,width:Q.width,height:Q.height},$))}else o.__isEmptyBrush?o.useStyle(mt({},$)):o.useStyle($),o.style.decal=null,o.setColor(q,s&&s.symbolInnerColor),o.style.strokeNoScale=!0;var ee=t.getItemVisual(i,"liftZ"),te=this._z2;ee!=null?te==null&&(this._z2=o.z2,o.z2+=ee):te!=null&&(o.z2=te,this._z2=null);var ae=s&&s.useNameLabel;rs(o,C,{labelFetcher:l,labelDataIndex:i,defaultText:de,inheritColor:q,defaultOpacity:$.opacity});function de(Ae){return ae?t.getName(Ae):Y0(t,Ae)}this._sizeX=n[0]/2,this._sizeY=n[1]/2;var ve=o.ensureState("emphasis");ve.style=c,o.ensureState("select").style=p,o.ensureState("blur").style=f;var ye=E==null||E===!0?Math.max(1.1,3/this._sizeY):isFinite(E)&&E>0?+E:1;ve.scaleX=this._sizeX*ye,ve.scaleY=this._sizeY*ye,this.setSymbolScale(1),Hn(this,y,b,S)},e.prototype.setSymbolScale=function(t){this.scaleX=this.scaleY=t},e.prototype.fadeOut=function(t,i,n){var a=this.childAt(0),s=br(this).dataIndex,o=n&&n.animation;if(this.silent=a.silent=!0,n&&n.fadeLabel){var l=a.getTextContent();l&&jg(l,{style:{opacity:0}},i,{dataIndex:s,removeOpt:o,cb:function(){a.removeTextContent()}})}else a.removeTextContent();jg(a,{style:{opacity:0},scaleX:0,scaleY:0},i,{dataIndex:s,cb:t,removeOpt:o})},e.getSymbolSize=function(t,i){return _b(t.getItemVisual(i,"symbolSize"))},e})(mr);function pme(r,e){this.parent.drift(r,e)}function kI(r,e,t,i){return e&&!isNaN(e[0])&&!isNaN(e[1])&&!(i.isIgnore&&i.isIgnore(t))&&!(i.clipShape&&!i.clipShape.contain(e[0],e[1]))&&r.getItemVisual(t,"symbol")!=="none"}function e5(r){return r!=null&&!cr(r)&&(r={isIgnore:r}),r||{}}function t5(r){var e=r.hostModel,t=e.getModel("emphasis");return{emphasisItemStyle:t.getModel("itemStyle").getItemStyle(),blurItemStyle:e.getModel(["blur","itemStyle"]).getItemStyle(),selectItemStyle:e.getModel(["select","itemStyle"]).getItemStyle(),focus:t.get("focus"),blurScope:t.get("blurScope"),emphasisDisabled:t.get("disabled"),hoverScale:t.get("scale"),labelStatesModels:fo(e),cursorStyle:e.get("cursor")}}var rS=(function(){function r(e){this.group=new mr,this._SymbolCtor=e||tS}return r.prototype.updateData=function(e,t){this._progressiveEls=null,t=e5(t);var i=this.group,n=e.hostModel,a=this._data,s=this._SymbolCtor,o=t.disableAnimation,l=t5(e),c={disableAnimation:o},f=t.getSymbolPoint||function(p){return e.getItemLayout(p)};a||i.removeAll(),e.diff(a).add(function(p){var y=f(p);if(kI(e,y,p,t)){var b=new s(e,p,l,c);b.setPosition(y),e.setItemGraphicEl(p,b),i.add(b)}}).update(function(p,y){var b=a.getItemGraphicEl(y),S=f(p);if(!kI(e,S,p,t)){i.remove(b);return}var C=e.getItemVisual(p,"symbol")||"circle",E=b&&b.getSymbolType&&b.getSymbolType();if(!b||E&&E!==C)i.remove(b),b=new s(e,p,l,c),b.setPosition(S);else{b.updateData(e,p,l,c);var P={x:S[0],y:S[1]};o?b.attr(P):vi(b,P,n)}i.add(b),e.setItemGraphicEl(p,b)}).remove(function(p){var y=a.getItemGraphicEl(p);y&&y.fadeOut(function(){i.remove(y)},n)}).execute(),this._getSymbolPoint=f,this._data=e},r.prototype.updateLayout=function(){var e=this,t=this._data;t&&t.eachItemGraphicEl(function(i,n){var a=e._getSymbolPoint(n);i.setPosition(a),i.markRedraw()})},r.prototype.incrementalPrepareUpdate=function(e){this._seriesScope=t5(e),this._data=null,this.group.removeAll()},r.prototype.incrementalUpdate=function(e,t,i){this._progressiveEls=[],i=e5(i);function n(l){l.isGroup||(l.incremental=!0,l.ensureState("emphasis").hoverLayer=!0)}for(var a=e.start;a<e.end;a++){var s=t.getItemLayout(a);if(kI(t,s,a,i)){var o=new this._SymbolCtor(t,a,this._seriesScope);o.traverse(n),o.setPosition(s),this.group.add(o),t.setItemGraphicEl(a,o),this._progressiveEls.push(o)}}},r.prototype.eachRendered=function(e){qg(this._progressiveEls||this.group,e)},r.prototype.remove=function(e){var t=this.group,i=this._data;i&&e?i.eachItemGraphicEl(function(n){n.fadeOut(function(){t.remove(n)},i.hostModel)}):t.removeAll()},r})();function $W(r,e,t){var i=r.getBaseAxis(),n=r.getOtherAxis(i),a=gme(n,t),s=i.dim,o=n.dim,l=e.mapDimension(o),c=e.mapDimension(s),f=o==="x"||o==="radius"?1:0,p=wt(r.dimensions,function(S){return e.mapDimension(S)}),y=!1,b=e.getCalculationInfo("stackResultDimension");return dp(e,p[0])&&(y=!0,p[0]=b),dp(e,p[1])&&(y=!0,p[1]=b),{dataDimsForPoint:p,valueStart:a,valueAxisDim:o,baseAxisDim:s,stacked:!!y,valueDim:l,baseDim:c,baseDataOffset:f,stackedOverDimension:e.getCalculationInfo("stackedOverDimension")}}function gme(r,e){var t=0,i=r.scale.getExtent();return e==="start"?t=i[0]:e==="end"?t=i[1]:di(e)&&!isNaN(e)?t=e:i[0]>0?t=i[0]:i[1]<0&&(t=i[1]),t}function WW(r,e,t,i){var n=NaN;r.stacked&&(n=t.get(t.getCalculationInfo("stackedOverDimension"),i)),isNaN(n)&&(n=r.valueStart);var a=r.baseDataOffset,s=[];return s[a]=t.get(r.baseDim,i),s[1-a]=n,e.dataToPoint(s)}function vme(r,e){var t=[];return e.diff(r).add(function(i){t.push({cmd:"+",idx:i})}).update(function(i,n){t.push({cmd:"=",idx:n,idx1:i})}).remove(function(i){t.push({cmd:"-",idx:i})}).execute(),t}function mme(r,e,t,i,n,a,s,o){for(var l=vme(r,e),c=[],f=[],p=[],y=[],b=[],S=[],C=[],E=$W(n,e,s),P=r.getLayout("points")||[],O=e.getLayout("points")||[],B=0;B<l.length;B++){var F=l[B],W=!0,$=void 0,q=void 0;switch(F.cmd){case"=":$=F.idx*2,q=F.idx1*2;var Q=P[$],ee=P[$+1],te=O[q],ae=O[q+1];(isNaN(Q)||isNaN(ee))&&(Q=te,ee=ae),c.push(Q,ee),f.push(te,ae),p.push(t[$],t[$+1]),y.push(i[q],i[q+1]),C.push(e.getRawIndex(F.idx1));break;case"+":var de=F.idx,ve=E.dataDimsForPoint,ye=n.dataToPoint([e.get(ve[0],de),e.get(ve[1],de)]);q=de*2,c.push(ye[0],ye[1]),f.push(O[q],O[q+1]);var Ae=WW(E,n,e,de);p.push(Ae[0],Ae[1]),y.push(i[q],i[q+1]),C.push(e.getRawIndex(de));break;case"-":W=!1}W&&(b.push(F),S.push(S.length))}S.sort(function(Dt,qt){return C[Dt]-C[qt]});for(var me=c.length,De=Of(me),Fe=Of(me),je=Of(me),ct=Of(me),xe=[],B=0;B<S.length;B++){var $e=S[B],pt=B*2,_t=$e*2;De[pt]=c[_t],De[pt+1]=c[_t+1],Fe[pt]=f[_t],Fe[pt+1]=f[_t+1],je[pt]=p[_t],je[pt+1]=p[_t+1],ct[pt]=y[_t],ct[pt+1]=y[_t+1],xe[B]=b[$e]}return{current:De,next:Fe,stackedOnCurrent:je,stackedOnNext:ct,status:xe}}var dg=Math.min,pg=Math.max;function oy(r,e){return isNaN(r)||isNaN(e)}function I3(r,e,t,i,n,a,s,o,l){for(var c,f,p,y,b,S,C=t,E=0;E<i;E++){var P=e[C*2],O=e[C*2+1];if(C>=n||C<0)break;if(oy(P,O)){if(l){C+=a;continue}break}if(C===t)r[a>0?"moveTo":"lineTo"](P,O),p=P,y=O;else{var B=P-c,F=O-f;if(B*B+F*F<.5){C+=a;continue}if(s>0){for(var W=C+a,$=e[W*2],q=e[W*2+1];$===P&&q===O&&E<i;)E++,W+=a,C+=a,$=e[W*2],q=e[W*2+1],P=e[C*2],O=e[C*2+1],B=P-c,F=O-f;var Q=E+1;if(l)for(;oy($,q)&&Q<i;)Q++,W+=a,$=e[W*2],q=e[W*2+1];var ee=.5,te=0,ae=0,de=void 0,ve=void 0;if(Q>=i||oy($,q))b=P,S=O;else{te=$-c,ae=q-f;var ye=P-c,Ae=$-P,me=O-f,De=q-O,Fe=void 0,je=void 0;if(o==="x"){Fe=Math.abs(ye),je=Math.abs(Ae);var ct=te>0?1:-1;b=P-ct*Fe*s,S=O,de=P+ct*je*s,ve=O}else if(o==="y"){Fe=Math.abs(me),je=Math.abs(De);var xe=ae>0?1:-1;b=P,S=O-xe*Fe*s,de=P,ve=O+xe*je*s}else Fe=Math.sqrt(ye*ye+me*me),je=Math.sqrt(Ae*Ae+De*De),ee=je/(je+Fe),b=P-te*s*(1-ee),S=O-ae*s*(1-ee),de=P+te*s*ee,ve=O+ae*s*ee,de=dg(de,pg($,P)),ve=dg(ve,pg(q,O)),de=pg(de,dg($,P)),ve=pg(ve,dg(q,O)),te=de-P,ae=ve-O,b=P-te*Fe/je,S=O-ae*Fe/je,b=dg(b,pg(c,P)),S=dg(S,pg(f,O)),b=pg(b,dg(c,P)),S=pg(S,dg(f,O)),te=P-b,ae=O-S,de=P+te*je/Fe,ve=O+ae*je/Fe}r.bezierCurveTo(p,y,b,S,P,O),p=de,y=ve}else r.lineTo(P,O)}c=P,f=O,C+=a}return E}var GW=(function(){function r(){this.smooth=0,this.smoothConstraint=!0}return r})(),yme=(function(r){Ye(e,r);function e(t){var i=r.call(this,t)||this;return i.type="ec-polyline",i}return e.prototype.getDefaultStyle=function(){return{stroke:"#000",fill:null}},e.prototype.getDefaultShape=function(){return new GW},e.prototype.buildPath=function(t,i){var n=i.points,a=0,s=n.length/2;if(i.connectNulls){for(;s>0&&oy(n[s*2-2],n[s*2-1]);s--);for(;a<s&&oy(n[a*2],n[a*2+1]);a++);}for(;a<s;)a+=I3(t,n,a,s,s,1,i.smooth,i.smoothMonotone,i.connectNulls)+1},e.prototype.getPointOn=function(t,i){this.path||(this.createPathProxy(),this.buildPath(this.path,this.shape));for(var n=this.path,a=n.data,s=jf.CMD,o,l,c=i==="x",f=[],p=0;p<a.length;){var y=a[p++],b=void 0,S=void 0,C=void 0,E=void 0,P=void 0,O=void 0,B=void 0;switch(y){case s.M:o=a[p++],l=a[p++];break;case s.L:if(b=a[p++],S=a[p++],B=c?(t-o)/(b-o):(t-l)/(S-l),B<=1&&B>=0){var F=c?(S-l)*B+l:(b-o)*B+o;return c?[t,F]:[F,t]}o=b,l=S;break;case s.C:b=a[p++],S=a[p++],C=a[p++],E=a[p++],P=a[p++],O=a[p++];var W=c?_A(o,b,C,P,t,f):_A(l,S,E,O,t,f);if(W>0)for(var $=0;$<W;$++){var q=f[$];if(q<=1&&q>=0){var F=c?oo(l,S,E,O,q):oo(o,b,C,P,q);return c?[t,F]:[F,t]}}o=P,l=O;break}}},e})(Xr),_me=(function(r){Ye(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e})(GW),XW=(function(r){Ye(e,r);function e(t){var i=r.call(this,t)||this;return i.type="ec-polygon",i}return e.prototype.getDefaultShape=function(){return new _me},e.prototype.buildPath=function(t,i){var n=i.points,a=i.stackedOnPoints,s=0,o=n.length/2,l=i.smoothMonotone;if(i.connectNulls){for(;o>0&&oy(n[o*2-2],n[o*2-1]);o--);for(;s<o&&oy(n[s*2],n[s*2+1]);s++);}for(;s<o;){var c=I3(t,n,s,o,o,1,i.smooth,l,i.connectNulls);I3(t,a,s+c-1,c,o,-1,i.stackedOnSmooth,l,i.connectNulls),s+=c+1,t.closePath()}},e})(Xr);function ZW(r,e,t,i,n){var a=r.getArea(),s=a.x,o=a.y,l=a.width,c=a.height,f=t.get(["lineStyle","width"])||0;s-=f/2,o-=f/2,l+=f,c+=f,l=Math.ceil(l),s!==Math.floor(s)&&(s=Math.floor(s),l++);var p=new li({shape:{x:s,y:o,width:l,height:c}});if(e){var y=r.getBaseAxis(),b=y.isHorizontal(),S=y.inverse;b?(S&&(p.shape.x+=l),p.shape.width=0):(S||(p.shape.y+=c),p.shape.height=0);var C=sr(n)?function(E){n(E,p)}:null;An(p,{shape:{width:l,height:c,x:s,y:o}},t,null,i,C)}return p}function qW(r,e,t){var i=r.getArea(),n=Qn(i.r0,1),a=Qn(i.r,1),s=new Ps({shape:{cx:Qn(r.cx,1),cy:Qn(r.cy,1),r0:n,r:a,startAngle:i.startAngle,endAngle:i.endAngle,clockwise:i.clockwise}});if(e){var o=r.getBaseAxis().dim==="angle";o?s.shape.endAngle=i.startAngle:s.shape.r=n,An(s,{shape:{endAngle:i.endAngle,r:a}},t)}return s}function iS(r,e,t,i,n){if(r){if(r.type==="polar")return qW(r,e,t);if(r.type==="cartesian2d")return ZW(r,e,t,i,n)}else return null;return null}function ky(r,e){return r.type===e}function r5(r,e){if(r.length===e.length){for(var t=0;t<r.length;t++)if(r[t]!==e[t])return;return!0}}function i5(r){for(var e=1/0,t=1/0,i=-1/0,n=-1/0,a=0;a<r.length;){var s=r[a++],o=r[a++];isNaN(s)||(e=Math.min(s,e),i=Math.max(s,i)),isNaN(o)||(t=Math.min(o,t),n=Math.max(o,n))}return[[e,t],[i,n]]}function n5(r,e){var t=i5(r),i=t[0],n=t[1],a=i5(e),s=a[0],o=a[1];return Math.max(Math.abs(i[0]-s[0]),Math.abs(i[1]-s[1]),Math.abs(n[0]-o[0]),Math.abs(n[1]-o[1]))}function a5(r){return di(r)?r:r?.5:0}function bme(r,e,t){if(!t.valueDim)return[];for(var i=e.count(),n=Of(i*2),a=0;a<i;a++){var s=WW(t,r,e,a);n[a*2]=s[0],n[a*2+1]=s[1]}return n}function gg(r,e,t,i,n){var a=t.getBaseAxis(),s=a.dim==="x"||a.dim==="radius"?0:1,o=[],l=0,c=[],f=[],p=[],y=[];if(n){for(l=0;l<r.length;l+=2){var b=e||r;!isNaN(b[l])&&!isNaN(b[l+1])&&y.push(r[l],r[l+1])}r=y}for(l=0;l<r.length-2;l+=2)switch(p[0]=r[l+2],p[1]=r[l+3],f[0]=r[l],f[1]=r[l+1],o.push(f[0],f[1]),i){case"end":c[s]=p[s],c[1-s]=f[1-s],o.push(c[0],c[1]);break;case"middle":var S=(f[s]+p[s])/2,C=[];c[s]=C[s]=S,c[1-s]=f[1-s],C[1-s]=p[1-s],o.push(c[0],c[1]),o.push(C[0],C[1]);break;default:c[s]=f[s],c[1-s]=p[1-s],o.push(c[0],c[1])}return o.push(r[l++],r[l++]),o}function xme(r,e){var t=[],i=r.length,n,a;function s(f,p,y){var b=f.coord,S=(y-b)/(p.coord-b),C=xk(S,[f.color,p.color]);return{coord:y,color:C}}for(var o=0;o<i;o++){var l=r[o],c=l.coord;if(c<0)n=l;else if(c>e){a?t.push(s(a,l,e)):n&&t.push(s(n,l,0),s(n,l,e));break}else n&&(t.push(s(n,l,0)),n=null),t.push(l),a=l}return t}function wme(r,e,t){var i=r.getVisual("visualMeta");if(!(!i||!i.length||!r.count())&&e.type==="cartesian2d"){for(var n,a,s=i.length-1;s>=0;s--){var o=r.getDimensionInfo(i[s].dimension);if(n=o&&o.coordDim,n==="x"||n==="y"){a=i[s];break}}if(a){var l=e.getAxis(n),c=wt(a.stops,function(B){return{coord:l.toGlobalCoord(l.dataToCoord(B.value)),color:B.color}}),f=c.length,p=a.outerColors.slice();f&&c[0].coord>c[f-1].coord&&(c.reverse(),p.reverse());var y=xme(c,n==="x"?t.getWidth():t.getHeight()),b=y.length;if(!b&&f)return c[0].coord<0?p[1]?p[1]:c[f-1].color:p[0]?p[0]:c[0].color;var S=10,C=y[0].coord-S,E=y[b-1].coord+S,P=E-C;if(P<.001)return"transparent";se(y,function(B){B.offset=(B.coord-C)/P}),y.push({offset:b?y[b-1].offset:.5,color:p[1]||"transparent"}),y.unshift({offset:b?y[0].offset:.5,color:p[0]||"transparent"});var O=new ub(0,0,0,0,y,!0);return O[n]=C,O[n+"2"]=E,O}}}function Sme(r,e,t){var i=r.get("showAllSymbol"),n=i==="auto";if(!(i&&!n)){var a=t.getAxesByScale("ordinal")[0];if(a&&!(n&&Tme(a,e))){var s=e.mapDimension(a.dim),o={};return se(a.getViewLabels(),function(l){var c=a.scale.getRawOrdinalNumber(l.tickValue);o[c]=1}),function(l){return!o.hasOwnProperty(e.get(s,l))}}}}function Tme(r,e){var t=r.getExtent(),i=Math.abs(t[1]-t[0])/r.scale.count();isNaN(i)&&(i=0);for(var n=e.count(),a=Math.max(1,Math.round(n/5)),s=0;s<n;s+=a)if(tS.getSymbolSize(e,s)[r.isHorizontal()?1:0]*1.5>i)return!1;return!0}function Ame(r,e){return isNaN(r)||isNaN(e)}function Cme(r){for(var e=r.length/2;e>0&&Ame(r[e*2-2],r[e*2-1]);e--);return e-1}function o5(r,e){return[r[e*2],r[e*2+1]]}function Mme(r,e,t){for(var i=r.length/2,n=t==="x"?0:1,a,s,o=0,l=-1,c=0;c<i;c++)if(s=r[c*2+n],!(isNaN(s)||isNaN(r[c*2+1-n]))){if(c===0){a=s;continue}if(a<=e&&s>=e||a>=e&&s<=e){l=c;break}o=c,a=s}return{range:[o,l],t:(e-a)/(s-a)}}function YW(r){if(r.get(["endLabel","show"]))return!0;for(var e=0;e<ll.length;e++)if(r.get([ll[e],"endLabel","show"]))return!0;return!1}function LI(r,e,t,i){if(ky(e,"cartesian2d")){var n=i.getModel("endLabel"),a=n.get("valueAnimation"),s=i.getData(),o={lastFrameIndex:0},l=YW(i)?function(b,S){r._endLabelOnDuring(b,S,s,o,a,n,e)}:null,c=e.getBaseAxis().isHorizontal(),f=ZW(e,t,i,function(){var b=r._endLabel;b&&t&&o.originalX!=null&&b.attr({x:o.originalX,y:o.originalY})},l);if(!i.get("clip",!0)){var p=f.shape,y=Math.max(p.width,p.height);c?(p.y-=y,p.height+=y*2):(p.x-=y,p.width+=y*2)}return l&&l(1,f),f}else return qW(e,t,i)}function Eme(r,e){var t=e.getBaseAxis(),i=t.isHorizontal(),n=t.inverse,a=i?n?"right":"left":"center",s=i?"middle":n?"top":"bottom";return{normal:{align:r.get("align")||a,verticalAlign:r.get("verticalAlign")||s}}}var Ime=(function(r){Ye(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.init=function(){var t=new mr,i=new rS;this.group.add(i.group),this._symbolDraw=i,this._lineGroup=t,this._changePolyState=Xt(this._changePolyState,this)},e.prototype.render=function(t,i,n){var a=t.coordinateSystem,s=this.group,o=t.getData(),l=t.getModel("lineStyle"),c=t.getModel("areaStyle"),f=o.getLayout("points")||[],p=a.type==="polar",y=this._coordSys,b=this._symbolDraw,S=this._polyline,C=this._polygon,E=this._lineGroup,P=!i.ssr&&t.get("animation"),O=!c.isEmpty(),B=c.get("origin"),F=$W(a,o,B),W=O&&bme(a,o,F),$=t.get("showSymbol"),q=t.get("connectNulls"),Q=$&&!p&&Sme(t,o,a),ee=this._data;ee&&ee.eachItemGraphicEl(function(Dt,qt){Dt.__temp&&(s.remove(Dt),ee.setItemGraphicEl(qt,null))}),$||b.remove(),s.add(E);var te=p?!1:t.get("step"),ae;a&&a.getArea&&t.get("clip",!0)&&(ae=a.getArea(),ae.width!=null?(ae.x-=.1,ae.y-=.1,ae.width+=.2,ae.height+=.2):ae.r0&&(ae.r0-=.5,ae.r+=.5)),this._clipShapeForSymbol=ae;var de=wme(o,a,n)||o.getVisual("style")[o.getVisual("drawType")];if(!(S&&y.type===a.type&&te===this._step))$&&b.updateData(o,{isIgnore:Q,clipShape:ae,disableAnimation:!0,getSymbolPoint:function(Dt){return[f[Dt*2],f[Dt*2+1]]}}),P&&this._initSymbolLabelAnimation(o,a,ae),te&&(W&&(W=gg(W,f,a,te,q)),f=gg(f,null,a,te,q)),S=this._newPolyline(f),O?C=this._newPolygon(f,W):C&&(E.remove(C),C=this._polygon=null),p||this._initOrUpdateEndLabel(t,a,by(de)),E.setClipPath(LI(this,a,!0,t));else{O&&!C?C=this._newPolygon(f,W):C&&!O&&(E.remove(C),C=this._polygon=null),p||this._initOrUpdateEndLabel(t,a,by(de));var ve=E.getClipPath();if(ve){var ye=LI(this,a,!1,t);An(ve,{shape:ye.shape},t)}else E.setClipPath(LI(this,a,!0,t));$&&b.updateData(o,{isIgnore:Q,clipShape:ae,disableAnimation:!0,getSymbolPoint:function(Dt){return[f[Dt*2],f[Dt*2+1]]}}),(!r5(this._stackedOnPoints,W)||!r5(this._points,f))&&(P?this._doUpdateAnimation(o,W,a,n,te,B,q):(te&&(W&&(W=gg(W,f,a,te,q)),f=gg(f,null,a,te,q)),S.setShape({points:f}),C&&C.setShape({points:f,stackedOnPoints:W})))}var Ae=t.getModel("emphasis"),me=Ae.get("focus"),De=Ae.get("blurScope"),Fe=Ae.get("disabled");if(S.useStyle(lr(l.getLineStyle(),{fill:"none",stroke:de,lineJoin:"bevel"})),ts(S,t,"lineStyle"),S.style.lineWidth>0&&t.get(["emphasis","lineStyle","width"])==="bolder"){var je=S.getState("emphasis").style;je.lineWidth=+S.style.lineWidth+1}br(S).seriesIndex=t.seriesIndex,Hn(S,me,De,Fe);var ct=a5(t.get("smooth")),xe=t.get("smoothMonotone");if(S.setShape({smooth:ct,smoothMonotone:xe,connectNulls:q}),C){var $e=o.getCalculationInfo("stackedOnSeries"),pt=0;C.useStyle(lr(c.getAreaStyle(),{fill:de,opacity:.7,lineJoin:"bevel",decal:o.getVisual("style").decal})),$e&&(pt=a5($e.get("smooth"))),C.setShape({smooth:ct,stackedOnSmooth:pt,smoothMonotone:xe,connectNulls:q}),ts(C,t,"areaStyle"),br(C).seriesIndex=t.seriesIndex,Hn(C,me,De,Fe)}var _t=this._changePolyState;o.eachItemGraphicEl(function(Dt){Dt&&(Dt.onHoverStateChange=_t)}),this._polyline.onHoverStateChange=_t,this._data=o,this._coordSys=a,this._stackedOnPoints=W,this._points=f,this._step=te,this._valueOrigin=B,t.get("triggerLineEvent")&&(this.packEventData(t,S),C&&this.packEventData(t,C))},e.prototype.packEventData=function(t,i){br(i).eventData={componentType:"series",componentSubType:"line",componentIndex:t.componentIndex,seriesIndex:t.seriesIndex,seriesName:t.name,seriesType:"line"}},e.prototype.highlight=function(t,i,n,a){var s=t.getData(),o=my(s,a);if(this._changePolyState("emphasis"),!(o instanceof Array)&&o!=null&&o>=0){var l=s.getLayout("points"),c=s.getItemGraphicEl(o);if(!c){var f=l[o*2],p=l[o*2+1];if(isNaN(f)||isNaN(p)||this._clipShapeForSymbol&&!this._clipShapeForSymbol.contain(f,p))return;var y=t.get("zlevel")||0,b=t.get("z")||0;c=new tS(s,o),c.x=f,c.y=p,c.setZ(y,b);var S=c.getSymbolPath().getTextContent();S&&(S.zlevel=y,S.z=b,S.z2=this._polyline.z2+1),c.__temp=!0,s.setItemGraphicEl(o,c),c.stopSymbolAnimation(!0),this.group.add(c)}c.highlight()}else Fi.prototype.highlight.call(this,t,i,n,a)},e.prototype.downplay=function(t,i,n,a){var s=t.getData(),o=my(s,a);if(this._changePolyState("normal"),o!=null&&o>=0){var l=s.getItemGraphicEl(o);l&&(l.__temp?(s.setItemGraphicEl(o,null),this.group.remove(l)):l.downplay())}else Fi.prototype.downplay.call(this,t,i,n,a)},e.prototype._changePolyState=function(t){var i=this._polygon;CA(this._polyline,t),i&&CA(i,t)},e.prototype._newPolyline=function(t){var i=this._polyline;return i&&this._lineGroup.remove(i),i=new yme({shape:{points:t},segmentIgnoreThreshold:2,z2:10}),this._lineGroup.add(i),this._polyline=i,i},e.prototype._newPolygon=function(t,i){var n=this._polygon;return n&&this._lineGroup.remove(n),n=new XW({shape:{points:t,stackedOnPoints:i},segmentIgnoreThreshold:2}),this._lineGroup.add(n),this._polygon=n,n},e.prototype._initSymbolLabelAnimation=function(t,i,n){var a,s,o=i.getBaseAxis(),l=o.inverse;i.type==="cartesian2d"?(a=o.isHorizontal(),s=!1):i.type==="polar"&&(a=o.dim==="angle",s=!0);var c=t.hostModel,f=c.get("animationDuration");sr(f)&&(f=f(null));var p=c.get("animationDelay")||0,y=sr(p)?p(null):p;t.eachItemGraphicEl(function(b,S){var C=b;if(C){var E=[b.x,b.y],P=void 0,O=void 0,B=void 0;if(n)if(s){var F=n,W=i.pointToCoord(E);a?(P=F.startAngle,O=F.endAngle,B=-W[1]/180*Math.PI):(P=F.r0,O=F.r,B=W[0])}else{var $=n;a?(P=$.x,O=$.x+$.width,B=b.x):(P=$.y+$.height,O=$.y,B=b.y)}var q=O===P?0:(B-P)/(O-P);l&&(q=1-q);var Q=sr(p)?p(S):f*q+y,ee=C.getSymbolPath(),te=ee.getTextContent();C.attr({scaleX:0,scaleY:0}),C.animateTo({scaleX:1,scaleY:1},{duration:200,setToFinal:!0,delay:Q}),te&&te.animateFrom({style:{opacity:0}},{duration:300,delay:Q}),ee.disableLabelAnimation=!0}})},e.prototype._initOrUpdateEndLabel=function(t,i,n){var a=t.getModel("endLabel");if(YW(t)){var s=t.getData(),o=this._polyline,l=s.getLayout("points");if(!l){o.removeTextContent(),this._endLabel=null;return}var c=this._endLabel;c||(c=this._endLabel=new si({z2:200}),c.ignoreClip=!0,o.setTextContent(this._endLabel),o.disableLabelAnimation=!0);var f=Cme(l);f>=0&&(rs(o,fo(t,"endLabel"),{inheritColor:n,labelFetcher:t,labelDataIndex:f,defaultText:function(p,y,b){return b!=null?jW(s,b):Y0(s,p)},enableTextSetter:!0},Eme(a,i)),o.textConfig.position=null)}else this._endLabel&&(this._polyline.removeTextContent(),this._endLabel=null)},e.prototype._endLabelOnDuring=function(t,i,n,a,s,o,l){var c=this._endLabel,f=this._polyline;if(c){t<1&&a.originalX==null&&(a.originalX=c.x,a.originalY=c.y);var p=n.getLayout("points"),y=n.hostModel,b=y.get("connectNulls"),S=o.get("precision"),C=o.get("distance")||0,E=l.getBaseAxis(),P=E.isHorizontal(),O=E.inverse,B=i.shape,F=O?P?B.x:B.y+B.height:P?B.x+B.width:B.y,W=(P?C:0)*(O?-1:1),$=(P?0:-C)*(O?-1:1),q=P?"x":"y",Q=Mme(p,F,q),ee=Q.range,te=ee[1]-ee[0],ae=void 0;if(te>=1){if(te>1&&!b){var de=o5(p,ee[0]);c.attr({x:de[0]+W,y:de[1]+$}),s&&(ae=y.getRawValue(ee[0]))}else{var de=f.getPointOn(F,q);de&&c.attr({x:de[0]+W,y:de[1]+$});var ve=y.getRawValue(ee[0]),ye=y.getRawValue(ee[1]);s&&(ae=k$(n,S,ve,ye,Q.t))}a.lastFrameIndex=ee[0]}else{var Ae=t===1||a.lastFrameIndex>0?ee[0]:0,de=o5(p,Ae);s&&(ae=y.getRawValue(Ae)),c.attr({x:de[0]+W,y:de[1]+$})}if(s){var me=fb(c);typeof me.setLabelText=="function"&&me.setLabelText(ae)}}},e.prototype._doUpdateAnimation=function(t,i,n,a,s,o,l){var c=this._polyline,f=this._polygon,p=t.hostModel,y=mme(this._data,t,this._stackedOnPoints,i,this._coordSys,n,this._valueOrigin),b=y.current,S=y.stackedOnCurrent,C=y.next,E=y.stackedOnNext;if(s&&(S=gg(y.stackedOnCurrent,y.current,n,s,l),b=gg(y.current,null,n,s,l),E=gg(y.stackedOnNext,y.next,n,s,l),C=gg(y.next,null,n,s,l)),n5(b,C)>3e3||f&&n5(S,E)>3e3){c.stopAnimation(),c.setShape({points:C}),f&&(f.stopAnimation(),f.setShape({points:C,stackedOnPoints:E}));return}c.shape.__points=y.current,c.shape.points=b;var P={shape:{points:C}};y.current!==b&&(P.shape.__points=y.next),c.stopAnimation(),vi(c,P,p),f&&(f.setShape({points:b,stackedOnPoints:S}),f.stopAnimation(),vi(f,{shape:{stackedOnPoints:E}},p),c.shape.points!==f.shape.points&&(f.shape.points=c.shape.points));for(var O=[],B=y.status,F=0;F<B.length;F++){var W=B[F].cmd;if(W==="="){var $=t.getItemGraphicEl(B[F].idx1);$&&O.push({el:$,ptIdx:F})}}c.animators&&c.animators.length&&c.animators[0].during(function(){f&&f.dirtyShape();for(var q=c.shape.__points,Q=0;Q<O.length;Q++){var ee=O[Q].el,te=O[Q].ptIdx*2;ee.x=q[te],ee.y=q[te+1],ee.markRedraw()}})},e.prototype.remove=function(t){var i=this.group,n=this._data;this._lineGroup.removeAll(),this._symbolDraw.remove(!0),n&&n.eachItemGraphicEl(function(a,s){a.__temp&&(i.remove(a),n.setItemGraphicEl(s,null))}),this._polyline=this._polygon=this._coordSys=this._points=this._stackedOnPoints=this._endLabel=this._data=null},e.type="line",e})(Fi);function nS(r,e){return{seriesType:r,plan:mb(),reset:function(t){var i=t.getData(),n=t.coordinateSystem,a=t.pipelineContext,s=e||a.large;if(n){var o=wt(n.dimensions,function(b){return i.mapDimension(b)}).slice(0,2),l=o.length,c=i.getCalculationInfo("stackResultDimension");dp(i,o[0])&&(o[0]=c),dp(i,o[1])&&(o[1]=c);var f=i.getStore(),p=i.getDimensionIndex(o[0]),y=i.getDimensionIndex(o[1]);return l&&{progress:function(b,S){for(var C=b.end-b.start,E=s&&Of(C*l),P=[],O=[],B=b.start,F=0;B<b.end;B++){var W=void 0;if(l===1){var $=f.get(p,B);W=n.dataToPoint($,null,O)}else P[0]=f.get(p,B),P[1]=f.get(y,B),W=n.dataToPoint(P,null,O);s?(E[F++]=W[0],E[F++]=W[1]):S.setItemLayout(B,W.slice())}s&&S.setLayout("points",E)}}}}}}var Pme={average:function(r){for(var e=0,t=0,i=0;i<r.length;i++)isNaN(r[i])||(e+=r[i],t++);return t===0?NaN:e/t},sum:function(r){for(var e=0,t=0;t<r.length;t++)e+=r[t]||0;return e},max:function(r){for(var e=-1/0,t=0;t<r.length;t++)r[t]>e&&(e=r[t]);return isFinite(e)?e:NaN},min:function(r){for(var e=1/0,t=0;t<r.length;t++)r[t]<e&&(e=r[t]);return isFinite(e)?e:NaN},nearest:function(r){return r[0]}},Rme=function(r){return Math.round(r.length/2)};function KW(r){return{seriesType:r,reset:function(e,t,i){var n=e.getData(),a=e.get("sampling"),s=e.coordinateSystem,o=n.count();if(o>10&&s.type==="cartesian2d"&&a){var l=s.getBaseAxis(),c=s.getOtherAxis(l),f=l.getExtent(),p=i.getDevicePixelRatio(),y=Math.abs(f[1]-f[0])*(p||1),b=Math.round(o/y);if(isFinite(b)&&b>1){a==="lttb"?e.setData(n.lttbDownSample(n.mapDimension(c.dim),1/b)):a==="minmax"&&e.setData(n.minmaxDownSample(n.mapDimension(c.dim),1/b));var S=void 0;$t(a)?S=Pme[a]:sr(a)&&(S=a),S&&e.setData(n.downSample(n.mapDimension(c.dim),1/b,S,Rme))}}}}}function Dme(r){r.registerChartView(Ime),r.registerSeriesModel(dme),r.registerLayout(nS("line",!0)),r.registerVisual({seriesType:"line",reset:function(e){var t=e.getData(),i=e.getModel("lineStyle").getLineStyle();i&&!i.stroke&&(i.stroke=t.getVisual("style").fill),t.setVisual("legendLineStyle",i)}}),r.registerProcessor(r.PRIORITY.PROCESSOR.STATISTIC,KW("line"))}var Cw=(function(r){Ye(e,r);function e(){var t=r!==null&&r.apply(this,arguments)||this;return t.type=e.type,t}return e.prototype.getInitialData=function(t,i){return Gf(null,this,{useEncodeDefaulter:!0})},e.prototype.getMarkerPosition=function(t,i,n){var a=this.coordinateSystem;if(a&&a.clampData){var s=a.clampData(t),o=a.dataToPoint(s);if(n)se(a.getAxes(),function(y,b){if(y.type==="category"&&i!=null){var S=y.getTicksCoords(),C=y.getTickModel().get("alignWithLabel"),E=s[b],P=i[b]==="x1"||i[b]==="y1";if(P&&!C&&(E+=1),S.length<2)return;if(S.length===2){o[b]=y.toGlobalCoord(y.getExtent()[P?1:0]);return}for(var O=void 0,B=void 0,F=1,W=0;W<S.length;W++){var $=S[W].coord,q=W===S.length-1?S[W-1].tickValue+F:S[W].tickValue;if(q===E){B=$;break}else if(q<E)O=$;else if(O!=null&&q>E){B=($+O)/2;break}W===1&&(F=q-S[0].tickValue)}B==null&&(O?O&&(B=S[S.length-1].coord):B=S[0].coord),o[b]=y.toGlobalCoord(B)}});else{var l=this.getData(),c=l.getLayout("offset"),f=l.getLayout("size"),p=a.getBaseAxis().isHorizontal()?0:1;o[p]+=c+f/2}return o}return[NaN,NaN]},e.type="series.__base_bar__",e.defaultOption={z:2,coordinateSystem:"cartesian2d",legendHoverLink:!0,barMinHeight:0,barMinAngle:0,large:!1,largeThreshold:400,progressive:3e3,progressiveChunkMode:"mod"},e})(Xi);Xi.registerClass(Cw);var kme=(function(r){Ye(e,r);function e(){var t=r!==null&&r.apply(this,arguments)||this;return t.type=e.type,t}return e.prototype.getInitialData=function(){return Gf(null,this,{useEncodeDefaulter:!0,createInvertedIndices:!!this.get("realtimeSort",!0)||null})},e.prototype.getProgressive=function(){return this.get("large")?this.get("progressive"):!1},e.prototype.getProgressiveThreshold=function(){var t=this.get("progressiveThreshold"),i=this.get("largeThreshold");return i>t&&(t=i),t},e.prototype.brushSelector=function(t,i,n){return n.rect(i.getItemLayout(t))},e.type="series.bar",e.dependencies=["grid","polar"],e.defaultOption=Yg(Cw.defaultOption,{clip:!0,roundCap:!1,showBackground:!1,backgroundStyle:{color:"rgba(180, 180, 180, 0.2)",borderColor:null,borderWidth:0,borderType:"solid",borderRadius:0,shadowBlur:0,shadowColor:null,shadowOffsetX:0,shadowOffsetY:0,opacity:1},select:{itemStyle:{borderColor:"#212121"}},realtimeSort:!1}),e})(Cw),Lme=(function(){function r(){this.cx=0,this.cy=0,this.r0=0,this.r=0,this.startAngle=0,this.endAngle=Math.PI*2,this.clockwise=!0}return r})(),XA=(function(r){Ye(e,r);function e(t){var i=r.call(this,t)||this;return i.type="sausage",i}return e.prototype.getDefaultShape=function(){return new Lme},e.prototype.buildPath=function(t,i){var n=i.cx,a=i.cy,s=Math.max(i.r0||0,0),o=Math.max(i.r,0),l=(o-s)*.5,c=s+l,f=i.startAngle,p=i.endAngle,y=i.clockwise,b=Math.PI*2,S=y?p-f<b:f-p<b;S||(f=p-(y?b:-b));var C=Math.cos(f),E=Math.sin(f),P=Math.cos(p),O=Math.sin(p);S?(t.moveTo(C*s+n,E*s+a),t.arc(C*c+n,E*c+a,l,-Math.PI+f,f,!y)):t.moveTo(C*o+n,E*o+a),t.arc(n,a,o,f,p,!y),t.arc(P*c+n,O*c+a,l,p-Math.PI*2,p-Math.PI,!y),s!==0&&t.arc(n,a,s,p,f,y)},e})(Xr);function Ome(r,e){e=e||{};var t=e.isRoundCap;return function(i,n,a){var s=n.position;if(!s||s instanceof Array)return TA(i,n,a);var o=r(s),l=n.distance!=null?n.distance:5,c=this.shape,f=c.cx,p=c.cy,y=c.r,b=c.r0,S=(y+b)/2,C=c.startAngle,E=c.endAngle,P=(C+E)/2,O=t?Math.abs(y-b)/2:0,B=Math.cos,F=Math.sin,W=f+y*B(C),$=p+y*F(C),q="left",Q="top";switch(o){case"startArc":W=f+(b-l)*B(P),$=p+(b-l)*F(P),q="center",Q="top";break;case"insideStartArc":W=f+(b+l)*B(P),$=p+(b+l)*F(P),q="center",Q="bottom";break;case"startAngle":W=f+S*B(C)+YT(C,l+O,!1),$=p+S*F(C)+KT(C,l+O,!1),q="right",Q="middle";break;case"insideStartAngle":W=f+S*B(C)+YT(C,-l+O,!1),$=p+S*F(C)+KT(C,-l+O,!1),q="left",Q="middle";break;case"middle":W=f+S*B(P),$=p+S*F(P),q="center",Q="middle";break;case"endArc":W=f+(y+l)*B(P),$=p+(y+l)*F(P),q="center",Q="bottom";break;case"insideEndArc":W=f+(y-l)*B(P),$=p+(y-l)*F(P),q="center",Q="top";break;case"endAngle":W=f+S*B(E)+YT(E,l+O,!0),$=p+S*F(E)+KT(E,l+O,!0),q="left",Q="middle";break;case"insideEndAngle":W=f+S*B(E)+YT(E,-l+O,!0),$=p+S*F(E)+KT(E,-l+O,!0),q="right",Q="middle";break;default:return TA(i,n,a)}return i=i||{},i.x=W,i.y=$,i.align=q,i.verticalAlign=Q,i}}function Nme(r,e,t,i){if(di(i)){r.setTextConfig({rotation:i});return}else if(xt(e)){r.setTextConfig({rotation:0});return}var n=r.shape,a=n.clockwise?n.startAngle:n.endAngle,s=n.clockwise?n.endAngle:n.startAngle,o=(a+s)/2,l,c=t(e);switch(c){case"startArc":case"insideStartArc":case"middle":case"insideEndArc":case"endArc":l=o;break;case"startAngle":case"insideStartAngle":l=a;break;case"endAngle":case"insideEndAngle":l=s;break;default:r.setTextConfig({rotation:0});return}var f=Math.PI*1.5-l;c==="middle"&&f>Math.PI/2&&f<Math.PI*1.5&&(f-=Math.PI),r.setTextConfig({rotation:f})}function YT(r,e,t){return e*Math.sin(r)*(t?-1:1)}function KT(r,e,t){return e*Math.cos(r)*(t?1:-1)}function Zm(r,e,t){var i=r.get("borderRadius");if(i==null)return t?{cornerRadius:0}:null;xt(i)||(i=[i,i,i,i]);var n=Math.abs(e.r||0-e.r0||0);return{cornerRadius:wt(i,function(a){return Rh(a,n)})}}var OI=Math.max,NI=Math.min;function Bme(r,e){var t=r.getArea&&r.getArea();if(ky(r,"cartesian2d")){var i=r.getBaseAxis();if(i.type!=="category"||!i.onBand){var n=e.getLayout("bandWidth");i.isHorizontal()?(t.x-=n,t.width+=n*2):(t.y-=n,t.height+=n*2)}}return t}var zme=(function(r){Ye(e,r);function e(){var t=r.call(this)||this;return t.type=e.type,t._isFirstFrame=!0,t}return e.prototype.render=function(t,i,n,a){this._model=t,this._removeOnRenderedListener(n),this._updateDrawMode(t);var s=t.get("coordinateSystem");(s==="cartesian2d"||s==="polar")&&(this._progressiveEls=null,this._isLargeDraw?this._renderLarge(t,i,n):this._renderNormal(t,i,n,a))},e.prototype.incrementalPrepareRender=function(t){this._clear(),this._updateDrawMode(t),this._updateLargeClip(t)},e.prototype.incrementalRender=function(t,i){this._progressiveEls=[],this._incrementalRenderLarge(t,i)},e.prototype.eachRendered=function(t){qg(this._progressiveEls||this.group,t)},e.prototype._updateDrawMode=function(t){var i=t.pipelineContext.large;(this._isLargeDraw==null||i!==this._isLargeDraw)&&(this._isLargeDraw=i,this._clear())},e.prototype._renderNormal=function(t,i,n,a){var s=this.group,o=t.getData(),l=this._data,c=t.coordinateSystem,f=c.getBaseAxis(),p;c.type==="cartesian2d"?p=f.isHorizontal():c.type==="polar"&&(p=f.dim==="angle");var y=t.isAnimationEnabled()?t:null,b=Fme(t,c);b&&this._enableRealtimeSort(b,o,n);var S=t.get("clip",!0)||b,C=Bme(c,o);s.removeClipPath();var E=t.get("roundCap",!0),P=t.get("showBackground",!0),O=t.getModel("backgroundStyle"),B=O.get("borderRadius")||0,F=[],W=this._backgroundEls,$=a&&a.isInitSort,q=a&&a.type==="changeAxisOrder";function Q(ae){var de=QT[c.type](o,ae),ve=Gme(c,p,de);return ve.useStyle(O.getItemStyle()),c.type==="cartesian2d"?ve.setShape("r",B):ve.setShape("cornerRadius",B),F[ae]=ve,ve}o.diff(l).add(function(ae){var de=o.getItemModel(ae),ve=QT[c.type](o,ae,de);if(P&&Q(ae),!(!o.hasValue(ae)||!h5[c.type](ve))){var ye=!1;S&&(ye=s5[c.type](C,ve));var Ae=l5[c.type](t,o,ae,ve,p,y,f.model,!1,E);b&&(Ae.forceLabelAnimation=!0),f5(Ae,o,ae,de,ve,t,p,c.type==="polar"),$?Ae.attr({shape:ve}):b?u5(b,y,Ae,ve,ae,p,!1,!1):An(Ae,{shape:ve},t,ae),o.setItemGraphicEl(ae,Ae),s.add(Ae),Ae.ignore=ye}}).update(function(ae,de){var ve=o.getItemModel(ae),ye=QT[c.type](o,ae,ve);if(P){var Ae=void 0;W.length===0?Ae=Q(de):(Ae=W[de],Ae.useStyle(O.getItemStyle()),c.type==="cartesian2d"?Ae.setShape("r",B):Ae.setShape("cornerRadius",B),F[ae]=Ae);var me=QT[c.type](o,ae),De=JW(p,me,c);vi(Ae,{shape:De},y,ae)}var Fe=l.getItemGraphicEl(de);if(!o.hasValue(ae)||!h5[c.type](ye)){s.remove(Fe);return}var je=!1;if(S&&(je=s5[c.type](C,ye),je&&s.remove(Fe)),Fe?Dh(Fe):Fe=l5[c.type](t,o,ae,ye,p,y,f.model,!!Fe,E),b&&(Fe.forceLabelAnimation=!0),q){var ct=Fe.getTextContent();if(ct){var xe=fb(ct);xe.prevValue!=null&&(xe.prevValue=xe.value)}}else f5(Fe,o,ae,ve,ye,t,p,c.type==="polar");$?Fe.attr({shape:ye}):b?u5(b,y,Fe,ye,ae,p,!0,q):vi(Fe,{shape:ye},t,ae,null),o.setItemGraphicEl(ae,Fe),Fe.ignore=je,s.add(Fe)}).remove(function(ae){var de=l.getItemGraphicEl(ae);de&&vw(de,t,ae)}).execute();var ee=this._backgroundGroup||(this._backgroundGroup=new mr);ee.removeAll();for(var te=0;te<F.length;++te)ee.add(F[te]);s.add(ee),this._backgroundEls=F,this._data=o},e.prototype._renderLarge=function(t,i,n){this._clear(),p5(t,this.group),this._updateLargeClip(t)},e.prototype._incrementalRenderLarge=function(t,i){this._removeBackground(),p5(i,this.group,this._progressiveEls,!0)},e.prototype._updateLargeClip=function(t){var i=t.get("clip",!0)&&iS(t.coordinateSystem,!1,t),n=this.group;i?n.setClipPath(i):n.removeClipPath()},e.prototype._enableRealtimeSort=function(t,i,n){var a=this;if(i.count()){var s=t.baseAxis;if(this._isFirstFrame)this._dispatchInitSort(i,t,n),this._isFirstFrame=!1;else{var o=function(l){var c=i.getItemGraphicEl(l),f=c&&c.shape;return f&&Math.abs(s.isHorizontal()?f.height:f.width)||0};this._onRendered=function(){a._updateSortWithinSameData(i,o,s,n)},n.getZr().on("rendered",this._onRendered)}}},e.prototype._dataSort=function(t,i,n){var a=[];return t.each(t.mapDimension(i.dim),function(s,o){var l=n(o);l=l??NaN,a.push({dataIndex:o,mappedValue:l,ordinalNumber:s})}),a.sort(function(s,o){return o.mappedValue-s.mappedValue}),{ordinalNumbers:wt(a,function(s){return s.ordinalNumber})}},e.prototype._isOrderChangedWithinSameData=function(t,i,n){for(var a=n.scale,s=t.mapDimension(n.dim),o=Number.MAX_VALUE,l=0,c=a.getOrdinalMeta().categories.length;l<c;++l){var f=t.rawIndexOf(s,a.getRawOrdinalNumber(l)),p=f<0?Number.MIN_VALUE:i(t.indexOfRawIndex(f));if(p>o)return!0;o=p}return!1},e.prototype._isOrderDifferentInView=function(t,i){for(var n=i.scale,a=n.getExtent(),s=Math.max(0,a[0]),o=Math.min(a[1],n.getOrdinalMeta().categories.length-1);s<=o;++s)if(t.ordinalNumbers[s]!==n.getRawOrdinalNumber(s))return!0},e.prototype._updateSortWithinSameData=function(t,i,n,a){if(this._isOrderChangedWithinSameData(t,i,n)){var s=this._dataSort(t,n,i);this._isOrderDifferentInView(s,n)&&(this._removeOnRenderedListener(a),a.dispatchAction({type:"changeAxisOrder",componentType:n.dim+"Axis",axisId:n.index,sortInfo:s}))}},e.prototype._dispatchInitSort=function(t,i,n){var a=i.baseAxis,s=this._dataSort(t,a,function(o){return t.get(t.mapDimension(i.otherAxis.dim),o)});n.dispatchAction({type:"changeAxisOrder",componentType:a.dim+"Axis",isInitSort:!0,axisId:a.index,sortInfo:s})},e.prototype.remove=function(t,i){this._clear(this._model),this._removeOnRenderedListener(i)},e.prototype.dispose=function(t,i){this._removeOnRenderedListener(i)},e.prototype._removeOnRenderedListener=function(t){this._onRendered&&(t.getZr().off("rendered",this._onRendered),this._onRendered=null)},e.prototype._clear=function(t){var i=this.group,n=this._data;t&&t.isAnimationEnabled()&&n&&!this._isLargeDraw?(this._removeBackground(),this._backgroundEls=[],n.eachItemGraphicEl(function(a){vw(a,t,br(a).dataIndex)})):i.removeAll(),this._data=null,this._isFirstFrame=!0},e.prototype._removeBackground=function(){this.group.remove(this._backgroundGroup),this._backgroundGroup=null},e.type="bar",e})(Fi),s5={cartesian2d:function(r,e){var t=e.width<0?-1:1,i=e.height<0?-1:1;t<0&&(e.x+=e.width,e.width=-e.width),i<0&&(e.y+=e.height,e.height=-e.height);var n=r.x+r.width,a=r.y+r.height,s=OI(e.x,r.x),o=NI(e.x+e.width,n),l=OI(e.y,r.y),c=NI(e.y+e.height,a),f=o<s,p=c<l;return e.x=f&&s>n?o:s,e.y=p&&l>a?c:l,e.width=f?0:o-s,e.height=p?0:c-l,t<0&&(e.x+=e.width,e.width=-e.width),i<0&&(e.y+=e.height,e.height=-e.height),f||p},polar:function(r,e){var t=e.r0<=e.r?1:-1;if(t<0){var i=e.r;e.r=e.r0,e.r0=i}var n=NI(e.r,r.r),a=OI(e.r0,r.r0);e.r=n,e.r0=a;var s=n-a<0;if(t<0){var i=e.r;e.r=e.r0,e.r0=i}return s}},l5={cartesian2d:function(r,e,t,i,n,a,s,o,l){var c=new li({shape:mt({},i),z2:1});if(c.__dataIndex=t,c.name="item",a){var f=c.shape,p=n?"height":"width";f[p]=0}return c},polar:function(r,e,t,i,n,a,s,o,l){var c=!n&&l?XA:Ps,f=new c({shape:i,z2:1});f.name="item";var p=QW(n);if(f.calculateTextPosition=Ome(p,{isRoundCap:c===XA}),a){var y=f.shape,b=n?"r":"endAngle",S={};y[b]=n?i.r0:i.startAngle,S[b]=i[b],(o?vi:An)(f,{shape:S},a)}return f}};function Fme(r,e){var t=r.get("realtimeSort",!0),i=e.getBaseAxis();if(t&&i.type==="category"&&e.type==="cartesian2d")return{baseAxis:i,otherAxis:e.getOtherAxis(i)}}function u5(r,e,t,i,n,a,s,o){var l,c;a?(c={x:i.x,width:i.width},l={y:i.y,height:i.height}):(c={y:i.y,height:i.height},l={x:i.x,width:i.width}),o||(s?vi:An)(t,{shape:l},e,n,null);var f=e?r.baseAxis.model:null;(s?vi:An)(t,{shape:c},f,n)}function c5(r,e){for(var t=0;t<e.length;t++)if(!isFinite(r[e[t]]))return!0;return!1}var Vme=["x","y","width","height"],Ume=["cx","cy","r","startAngle","endAngle"],h5={cartesian2d:function(r){return!c5(r,Vme)},polar:function(r){return!c5(r,Ume)}},QT={cartesian2d:function(r,e,t){var i=r.getItemLayout(e),n=t?jme(t,i):0,a=i.width>0?1:-1,s=i.height>0?1:-1;return{x:i.x+a*n/2,y:i.y+s*n/2,width:i.width-a*n,height:i.height-s*n}},polar:function(r,e,t){var i=r.getItemLayout(e);return{cx:i.cx,cy:i.cy,r0:i.r0,r:i.r,startAngle:i.startAngle,endAngle:i.endAngle,clockwise:i.clockwise}}};function Hme(r){return r.startAngle!=null&&r.endAngle!=null&&r.startAngle===r.endAngle}function QW(r){return(function(e){var t=e?"Arc":"Angle";return function(i){switch(i){case"start":case"insideStart":case"end":case"insideEnd":return i+t;default:return i}}})(r)}function f5(r,e,t,i,n,a,s,o){var l=e.getItemVisual(t,"style");if(o){if(!a.get("roundCap")){var f=r.shape,p=Zm(i.getModel("itemStyle"),f,!0);mt(f,p),r.setShape(f)}}else{var c=i.get(["itemStyle","borderRadius"])||0;r.setShape("r",c)}r.useStyle(l);var y=i.getShallow("cursor");y&&r.attr("cursor",y);var b=o?s?n.r>=n.r0?"endArc":"startArc":n.endAngle>=n.startAngle?"endAngle":"startAngle":s?n.height>=0?"bottom":"top":n.width>=0?"right":"left",S=fo(i);rs(r,S,{labelFetcher:a,labelDataIndex:t,defaultText:Y0(a.getData(),t),inheritColor:l.fill,defaultOpacity:l.opacity,defaultOutsidePosition:b});var C=r.getTextContent();if(o&&C){var E=i.get(["label","position"]);r.textConfig.inside=E==="middle"?!0:null,Nme(r,E==="outside"?b:E,QW(s),i.get(["label","rotate"]))}m7(C,S,a.getRawValue(t),function(O){return jW(e,O)});var P=i.getModel(["emphasis"]);Hn(r,P.get("focus"),P.get("blurScope"),P.get("disabled")),ts(r,i),Hme(n)&&(r.style.fill="none",r.style.stroke="none",se(r.states,function(O){O.style&&(O.style.fill=O.style.stroke="none")}))}function jme(r,e){var t=r.get(["itemStyle","borderColor"]);if(!t||t==="none")return 0;var i=r.get(["itemStyle","borderWidth"])||0,n=isNaN(e.width)?Number.MAX_VALUE:Math.abs(e.width),a=isNaN(e.height)?Number.MAX_VALUE:Math.abs(e.height);return Math.min(i,n,a)}var $me=(function(){function r(){}return r})(),d5=(function(r){Ye(e,r);function e(t){var i=r.call(this,t)||this;return i.type="largeBar",i}return e.prototype.getDefaultShape=function(){return new $me},e.prototype.buildPath=function(t,i){for(var n=i.points,a=this.baseDimIdx,s=1-this.baseDimIdx,o=[],l=[],c=this.barWidth,f=0;f<n.length;f+=3)l[a]=c,l[s]=n[f+2],o[a]=n[f+a],o[s]=n[f+s],t.rect(o[0],o[1],l[0],l[1])},e})(Xr);function p5(r,e,t,i){var n=r.getData(),a=n.getLayout("valueAxisHorizontal")?1:0,s=n.getLayout("largeDataIndices"),o=n.getLayout("size"),l=r.getModel("backgroundStyle"),c=n.getLayout("largeBackgroundPoints");if(c){var f=new d5({shape:{points:c},incremental:!!i,silent:!0,z2:0});f.baseDimIdx=a,f.largeDataIndices=s,f.barWidth=o,f.useStyle(l.getItemStyle()),e.add(f),t&&t.push(f)}var p=new d5({shape:{points:n.getLayout("largePoints")},incremental:!!i,ignoreCoarsePointer:!0,z2:1});p.baseDimIdx=a,p.largeDataIndices=s,p.barWidth=o,e.add(p),p.useStyle(n.getVisual("style")),p.style.stroke=null,br(p).seriesIndex=r.seriesIndex,r.get("silent")||(p.on("mousedown",g5),p.on("mousemove",g5)),t&&t.push(p)}var g5=KC(function(r){var e=this,t=Wme(e,r.offsetX,r.offsetY);br(e).dataIndex=t>=0?t:null},30,!1);function Wme(r,e,t){for(var i=r.baseDimIdx,n=1-i,a=r.shape.points,s=r.largeDataIndices,o=[],l=[],c=r.barWidth,f=0,p=a.length/3;f<p;f++){var y=f*3;if(l[i]=c,l[n]=a[y+2],o[i]=a[y+i],o[n]=a[y+n],l[n]<0&&(o[n]+=l[n],l[n]=-l[n]),e>=o[0]&&e<=o[0]+l[0]&&t>=o[1]&&t<=o[1]+l[1])return s[f]}return-1}function JW(r,e,t){if(ky(t,"cartesian2d")){var i=e,n=t.getArea();return{x:r?i.x:n.x,y:r?n.y:i.y,width:r?i.width:n.width,height:r?n.height:i.height}}else{var n=t.getArea(),a=e;return{cx:n.cx,cy:n.cy,r0:r?n.r0:a.r0,r:r?n.r:a.r,startAngle:r?a.startAngle:0,endAngle:r?a.endAngle:Math.PI*2}}}function Gme(r,e,t){var i=r.type==="polar"?Ps:li;return new i({shape:JW(e,t,r),silent:!0,z2:0})}function Xme(r){r.registerChartView(zme),r.registerSeriesModel(kme),r.registerLayout(r.PRIORITY.VISUAL.LAYOUT,Sr(nW,"bar")),r.registerLayout(r.PRIORITY.VISUAL.PROGRESSIVE_LAYOUT,aW("bar")),r.registerProcessor(r.PRIORITY.PROCESSOR.STATISTIC,KW("bar")),r.registerAction({type:"changeAxisOrder",event:"changeAxisOrder",update:"update"},function(e,t){var i=e.componentType||"series";t.eachComponent({mainType:i,query:e},function(n){e.sortInfo&&n.axis.setCategorySortInfo(e.sortInfo)})})}var v5=Math.PI*2,JT=Math.PI/180;function eG(r,e){return La(r.getBoxLayoutParams(),{width:e.getWidth(),height:e.getHeight()})}function tG(r,e){var t=eG(r,e),i=r.get("center"),n=r.get("radius");xt(n)||(n=[0,n]);var a=Vt(t.width,e.getWidth()),s=Vt(t.height,e.getHeight()),o=Math.min(a,s),l=Vt(n[0],o/2),c=Vt(n[1],o/2),f,p,y=r.coordinateSystem;if(y){var b=y.dataToPoint(i);f=b[0]||0,p=b[1]||0}else xt(i)||(i=[i,i]),f=Vt(i[0],a)+t.x,p=Vt(i[1],s)+t.y;return{cx:f,cy:p,r0:l,r:c}}function Zme(r,e,t){e.eachSeriesByType(r,function(i){var n=i.getData(),a=n.mapDimension("value"),s=eG(i,t),o=tG(i,t),l=o.cx,c=o.cy,f=o.r,p=o.r0,y=-i.get("startAngle")*JT,b=i.get("endAngle"),S=i.get("padAngle")*JT;b=b==="auto"?y-v5:-b*JT;var C=i.get("minAngle")*JT,E=C+S,P=0;n.each(a,function(De){!isNaN(De)&&P++});var O=n.getSum(a),B=Math.PI/(O||P)*2,F=i.get("clockwise"),W=i.get("roseType"),$=i.get("stillShowZeroSum"),q=n.getDataExtent(a);q[0]=0;var Q=F?1:-1,ee=[y,b],te=Q*S/2;Dk(ee,!F),y=ee[0],b=ee[1];var ae=rG(i);ae.startAngle=y,ae.endAngle=b,ae.clockwise=F;var de=Math.abs(b-y),ve=de,ye=0,Ae=y;if(n.setLayout({viewRect:s,r:f}),n.each(a,function(De,Fe){var je;if(isNaN(De)){n.setItemLayout(Fe,{angle:NaN,startAngle:NaN,endAngle:NaN,clockwise:F,cx:l,cy:c,r0:p,r:W?NaN:f});return}W!=="area"?je=O===0&&$?B:De*B:je=de/P,je<E?(je=E,ve-=E):ye+=De;var ct=Ae+Q*je,xe=0,$e=0;S>je?(xe=Ae+Q*je/2,$e=xe):(xe=Ae+te,$e=ct-te),n.setItemLayout(Fe,{angle:je,startAngle:xe,endAngle:$e,clockwise:F,cx:l,cy:c,r0:p,r:W?Ii(De,q,[p,f]):f}),Ae=ct}),ve<v5&&P)if(ve<=.001){var me=de/P;n.each(a,function(De,Fe){if(!isNaN(De)){var je=n.getItemLayout(Fe);je.angle=me;var ct=0,xe=0;me<S?(ct=y+Q*(Fe+1/2)*me,xe=ct):(ct=y+Q*Fe*me+te,xe=y+Q*(Fe+1)*me-te),je.startAngle=ct,je.endAngle=xe}})}else B=ve/ye,Ae=y,n.each(a,function(De,Fe){if(!isNaN(De)){var je=n.getItemLayout(Fe),ct=je.angle===E?E:De*B,xe=0,$e=0;ct<S?(xe=Ae+Q*ct/2,$e=xe):(xe=Ae+te,$e=Ae+Q*ct-te),je.startAngle=xe,je.endAngle=$e,Ae+=Q*ct}})})}var rG=fi();function aS(r){return{seriesType:r,reset:function(e,t){var i=t.findComponents({mainType:"legend"});if(!(!i||!i.length)){var n=e.getData();n.filterSelf(function(a){for(var s=n.getName(a),o=0;o<i.length;o++)if(!i[o].isSelected(s))return!1;return!0})}}}}var qme=Math.PI/180;function m5(r,e,t,i,n,a,s,o,l,c){if(r.length<2)return;function f(C){for(var E=C.rB,P=E*E,O=0;O<C.list.length;O++){var B=C.list[O],F=Math.abs(B.label.y-t),W=i+B.len,$=W*W,q=Math.sqrt(Math.abs((1-F*F/P)*$)),Q=e+(q+B.len2)*n,ee=Q-B.label.x,te=B.targetTextWidth-ee*n;iG(B,te,!0),B.label.x=Q}}function p(C){for(var E={list:[],maxY:0},P={list:[],maxY:0},O=0;O<C.length;O++)if(C[O].labelAlignTo==="none"){var B=C[O],F=B.label.y>t?P:E,W=Math.abs(B.label.y-t);if(W>=F.maxY){var $=B.label.x-e-B.len2*n,q=i+B.len,Q=Math.abs($)<q?Math.sqrt(W*W/(1-$*$/q/q)):q;F.rB=Q,F.maxY=W}F.list.push(B)}f(E),f(P)}for(var y=r.length,b=0;b<y;b++)if(r[b].position==="outer"&&r[b].labelAlignTo==="labelLine"){var S=r[b].label.x-c;r[b].linePoints[1][0]+=S,r[b].label.x=c}CW(r,l,l+s)&&p(r)}function Yme(r,e,t,i,n,a,s,o){for(var l=[],c=[],f=Number.MAX_VALUE,p=-Number.MAX_VALUE,y=0;y<r.length;y++){var b=r[y].label;BI(r[y])||(b.x<e?(f=Math.min(f,b.x),l.push(r[y])):(p=Math.max(p,b.x),c.push(r[y])))}for(var y=0;y<r.length;y++){var S=r[y];if(!BI(S)&&S.linePoints){if(S.labelStyleWidth!=null)continue;var b=S.label,C=S.linePoints,E=void 0;S.labelAlignTo==="edge"?b.x<e?E=C[2][0]-S.labelDistance-s-S.edgeDistance:E=s+n-S.edgeDistance-C[2][0]-S.labelDistance:S.labelAlignTo==="labelLine"?b.x<e?E=f-s-S.bleedMargin:E=s+n-p-S.bleedMargin:b.x<e?E=b.x-s-S.bleedMargin:E=s+n-b.x-S.bleedMargin,S.targetTextWidth=E,iG(S,E)}}m5(c,e,t,i,1,n,a,s,o,p),m5(l,e,t,i,-1,n,a,s,o,f);for(var y=0;y<r.length;y++){var S=r[y];if(!BI(S)&&S.linePoints){var b=S.label,C=S.linePoints,P=S.labelAlignTo==="edge",O=b.style.padding,B=O?O[1]+O[3]:0,F=b.style.backgroundColor?0:B,W=S.rect.width+F,$=C[1][0]-C[2][0];P?b.x<e?C[2][0]=s+S.edgeDistance+W+S.labelDistance:C[2][0]=s+n-S.edgeDistance-W-S.labelDistance:(b.x<e?C[2][0]=b.x+S.labelDistance:C[2][0]=b.x-S.labelDistance,C[1][0]=C[2][0]+$),C[1][1]=C[2][1]=b.y}}}function iG(r,e,t){if(t===void 0&&(t=!1),r.labelStyleWidth==null){var i=r.label,n=i.style,a=r.rect,s=n.backgroundColor,o=n.padding,l=o?o[1]+o[3]:0,c=n.overflow,f=a.width+(s?0:l);if(e<f||t){var p=a.height;if(c&&c.match("break")){i.setStyle("backgroundColor",null),i.setStyle("width",e-l);var y=i.getBoundingRect();i.setStyle("width",Math.ceil(y.width)),i.setStyle("backgroundColor",s)}else{var b=e-l,S=e<f?b:t?b>r.unconstrainedWidth?null:b:null;i.setStyle("width",S)}var C=i.getBoundingRect();a.width=C.width;var E=(i.style.margin||0)+2.1;a.height=C.height+E,a.y-=(a.height-p)/2}}}function BI(r){return r.position==="center"}function Kme(r){var e=r.getData(),t=[],i,n,a=!1,s=(r.get("minShowLabelAngle")||0)*qme,o=e.getLayout("viewRect"),l=e.getLayout("r"),c=o.width,f=o.x,p=o.y,y=o.height;function b($){$.ignore=!0}function S($){if(!$.ignore)return!0;for(var q in $.states)if($.states[q].ignore===!1)return!0;return!1}e.each(function($){var q=e.getItemGraphicEl($),Q=q.shape,ee=q.getTextContent(),te=q.getTextGuideLine(),ae=e.getItemModel($),de=ae.getModel("label"),ve=de.get("position")||ae.get(["emphasis","label","position"]),ye=de.get("distanceToLabelLine"),Ae=de.get("alignTo"),me=Vt(de.get("edgeDistance"),c),De=de.get("bleedMargin"),Fe=ae.getModel("labelLine"),je=Fe.get("length");je=Vt(je,c);var ct=Fe.get("length2");if(ct=Vt(ct,c),Math.abs(Q.endAngle-Q.startAngle)<s){se(ee.states,b),ee.ignore=!0,te&&(se(te.states,b),te.ignore=!0);return}if(S(ee)){var xe=(Q.startAngle+Q.endAngle)/2,$e=Math.cos(xe),pt=Math.sin(xe),_t,Dt,qt,_r;i=Q.cx,n=Q.cy;var Kt=ve==="inside"||ve==="inner";if(ve==="center")_t=Q.cx,Dt=Q.cy,_r="center";else{var zt=(Kt?(Q.r+Q.r0)/2*$e:Q.r*$e)+i,yr=(Kt?(Q.r+Q.r0)/2*pt:Q.r*pt)+n;if(_t=zt+$e*3,Dt=yr+pt*3,!Kt){var Gt=zt+$e*(je+l-Q.r),Jt=yr+pt*(je+l-Q.r),Tr=Gt+($e<0?-1:1)*ct,dr=Jt;Ae==="edge"?_t=$e<0?f+me:f+c-me:_t=Tr+($e<0?-ye:ye),Dt=dr,qt=[[zt,yr],[Gt,Jt],[Tr,dr]]}_r=Kt?"center":Ae==="edge"?$e>0?"right":"left":$e>0?"left":"right"}var $r=Math.PI,ii=0,Zi=de.get("rotate");if(di(Zi))ii=Zi*($r/180);else if(ve==="center")ii=0;else if(Zi==="radial"||Zi===!0){var In=$e<0?-xe+$r:-xe;ii=In}else if(Zi==="tangential"&&ve!=="outside"&&ve!=="outer"){var Li=Math.atan2($e,pt);Li<0&&(Li=$r*2+Li);var Oa=pt>0;Oa&&(Li=$r+Li),ii=Li-$r}if(a=!!ii,ee.x=_t,ee.y=Dt,ee.rotation=ii,ee.setStyle({verticalAlign:"middle"}),Kt){ee.setStyle({align:_r});var vo=ee.states.select;vo&&(vo.x+=ee.x,vo.y+=ee.y)}else{var Na=ee.getBoundingRect().clone();Na.applyTransform(ee.getComputedTransform());var Ls=(ee.style.margin||0)+2.1;Na.y-=Ls/2,Na.height+=Ls,t.push({label:ee,labelLine:te,position:ve,len:je,len2:ct,minTurnAngle:Fe.get("minTurnAngle"),maxSurfaceAngle:Fe.get("maxSurfaceAngle"),surfaceNormal:new Rr($e,pt),linePoints:qt,textAlign:_r,labelDistance:ye,labelAlignTo:Ae,edgeDistance:me,bleedMargin:De,rect:Na,unconstrainedWidth:Na.width,labelStyleWidth:ee.style.width})}q.setTextConfig({inside:Kt})}}),!a&&r.get("avoidLabelOverlap")&&Yme(t,i,n,l,c,y,f,p);for(var C=0;C<t.length;C++){var E=t[C],P=E.label,O=E.labelLine,B=isNaN(P.x)||isNaN(P.y);if(P){P.setStyle({align:E.textAlign}),B&&(se(P.states,b),P.ignore=!0);var F=P.states.select;F&&(F.x+=P.x,F.y+=P.y)}if(O){var W=E.linePoints;B||!W?(se(O.states,b),O.ignore=!0):(SW(W,E.minTurnAngle),bve(W,E.surfaceNormal,E.maxSurfaceAngle),O.setShape({points:W}),P.__hostTarget.textGuideLineConfig={anchor:new Rr(W[0][0],W[0][1])})}}}var Qme=(function(r){Ye(e,r);function e(t,i,n){var a=r.call(this)||this;a.z2=2;var s=new si;return a.setTextContent(s),a.updateData(t,i,n,!0),a}return e.prototype.updateData=function(t,i,n,a){var s=this,o=t.hostModel,l=t.getItemModel(i),c=l.getModel("emphasis"),f=t.getItemLayout(i),p=mt(Zm(l.getModel("itemStyle"),f,!0),f);if(isNaN(p.startAngle)){s.setShape(p);return}if(a){s.setShape(p);var y=o.getShallow("animationType");o.ecModel.ssr?(An(s,{scaleX:0,scaleY:0},o,{dataIndex:i,isFrom:!0}),s.originX=p.cx,s.originY=p.cy):y==="scale"?(s.shape.r=f.r0,An(s,{shape:{r:f.r}},o,i)):n!=null?(s.setShape({startAngle:n,endAngle:n}),An(s,{shape:{startAngle:f.startAngle,endAngle:f.endAngle}},o,i)):(s.shape.endAngle=f.startAngle,vi(s,{shape:{endAngle:f.endAngle}},o,i))}else Dh(s),vi(s,{shape:p},o,i);s.useStyle(t.getItemVisual(i,"style")),ts(s,l);var b=(f.startAngle+f.endAngle)/2,S=o.get("selectedOffset"),C=Math.cos(b)*S,E=Math.sin(b)*S,P=l.getShallow("cursor");P&&s.attr("cursor",P),this._updateLabel(o,t,i),s.ensureState("emphasis").shape=mt({r:f.r+(c.get("scale")&&c.get("scaleSize")||0)},Zm(c.getModel("itemStyle"),f)),mt(s.ensureState("select"),{x:C,y:E,shape:Zm(l.getModel(["select","itemStyle"]),f)}),mt(s.ensureState("blur"),{shape:Zm(l.getModel(["blur","itemStyle"]),f)});var O=s.getTextGuideLine(),B=s.getTextContent();O&&mt(O.ensureState("select"),{x:C,y:E}),mt(B.ensureState("select"),{x:C,y:E}),Hn(this,c.get("focus"),c.get("blurScope"),c.get("disabled"))},e.prototype._updateLabel=function(t,i,n){var a=this,s=i.getItemModel(n),o=s.getModel("labelLine"),l=i.getItemVisual(n,"style"),c=l&&l.fill,f=l&&l.opacity;rs(a,fo(s),{labelFetcher:i.hostModel,labelDataIndex:n,inheritColor:c,defaultOpacity:f,defaultText:t.getFormattedLabel(n,"normal")||i.getName(n)});var p=a.getTextContent();a.setTextConfig({position:null,rotation:null}),p.attr({z2:10});var y=t.get(["label","position"]);if(y!=="outside"&&y!=="outer")a.removeTextGuideLine();else{var b=this.getTextGuideLine();b||(b=new ks,this.setTextGuideLine(b)),ML(this,EL(s),{stroke:c,opacity:Th(o.get(["lineStyle","opacity"]),f,1)})}},e})(Ps),Jme=(function(r){Ye(e,r);function e(){var t=r!==null&&r.apply(this,arguments)||this;return t.ignoreLabelLineUpdate=!0,t}return e.prototype.render=function(t,i,n,a){var s=t.getData(),o=this._data,l=this.group,c;if(!o&&s.count()>0){for(var f=s.getItemLayout(0),p=1;isNaN(f&&f.startAngle)&&p<s.count();++p)f=s.getItemLayout(p);f&&(c=f.startAngle)}if(this._emptyCircleSector&&l.remove(this._emptyCircleSector),s.count()===0&&t.get("showEmptyCircle")){var y=rG(t),b=new Ps({shape:mt(tG(t,n),y)});b.useStyle(t.getModel("emptyCircleStyle").getItemStyle()),this._emptyCircleSector=b,l.add(b)}s.diff(o).add(function(S){var C=new Qme(s,S,c);s.setItemGraphicEl(S,C),l.add(C)}).update(function(S,C){var E=o.getItemGraphicEl(C);E.updateData(s,S,c),E.off("click"),l.add(E),s.setItemGraphicEl(S,E)}).remove(function(S){var C=o.getItemGraphicEl(S);vw(C,t,S)}).execute(),Kme(t),t.get("animationTypeUpdate")!=="expansion"&&(this._data=s)},e.prototype.dispose=function(){},e.prototype.containPoint=function(t,i){var n=i.getData(),a=n.getItemLayout(0);if(a){var s=t[0]-a.cx,o=t[1]-a.cy,l=Math.sqrt(s*s+o*o);return l<=a.r&&l>=a.r0}},e.type="pie",e})(Fi);function Sb(r,e,t){e=xt(e)&&{coordDimensions:e}||mt({encodeDefine:r.getEncode()},e);var i=r.getSource(),n=bb(i,e).dimensions,a=new Es(n,r);return a.initData(i,t),a}var oS=(function(){function r(e,t){this._getDataWithEncodedVisual=e,this._getRawData=t}return r.prototype.getAllNames=function(){var e=this._getRawData();return e.mapArray(e.getName)},r.prototype.containName=function(e){var t=this._getRawData();return t.indexOfName(e)>=0},r.prototype.indexOfName=function(e){var t=this._getDataWithEncodedVisual();return t.indexOfName(e)},r.prototype.getItemVisual=function(e,t){var i=this._getDataWithEncodedVisual();return i.getItemVisual(e,t)},r})(),eye=fi(),tye=(function(r){Ye(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.init=function(t){r.prototype.init.apply(this,arguments),this.legendVisualProvider=new oS(Xt(this.getData,this),Xt(this.getRawData,this)),this._defaultLabelLine(t)},e.prototype.mergeOption=function(){r.prototype.mergeOption.apply(this,arguments)},e.prototype.getInitialData=function(){return Sb(this,{coordDimensions:["value"],encodeDefaulter:Sr(tL,this)})},e.prototype.getDataParams=function(t){var i=this.getData(),n=eye(i),a=n.seats;if(!a){var s=[];i.each(i.mapDimension("value"),function(l){s.push(l)}),a=n.seats=T$(s,i.hostModel.get("percentPrecision"))}var o=r.prototype.getDataParams.call(this,t);return o.percent=a[t]||0,o.$vars.push("percent"),o},e.prototype._defaultLabelLine=function(t){vy(t,"labelLine",["show"]);var i=t.labelLine,n=t.emphasis.labelLine;i.show=i.show&&t.label.show,n.show=n.show&&t.emphasis.label.show},e.type="series.pie",e.defaultOption={z:2,legendHoverLink:!0,colorBy:"data",center:["50%","50%"],radius:[0,"75%"],clockwise:!0,startAngle:90,endAngle:"auto",padAngle:0,minAngle:0,minShowLabelAngle:0,selectedOffset:10,percentPrecision:2,stillShowZeroSum:!0,left:0,top:0,right:0,bottom:0,width:null,height:null,label:{rotate:0,show:!0,overflow:"truncate",position:"outer",alignTo:"none",edgeDistance:"25%",bleedMargin:10,distanceToLabelLine:5},labelLine:{show:!0,length:15,length2:15,smooth:!1,minTurnAngle:90,maxSurfaceAngle:90,lineStyle:{width:1,type:"solid"}},itemStyle:{borderWidth:1,borderJoin:"round"},showEmptyCircle:!0,emptyCircleStyle:{color:"lightgray",opacity:1},labelLayout:{hideOverlap:!0},emphasis:{scale:!0,scaleSize:5},avoidLabelOverlap:!0,animationType:"expansion",animationDuration:1e3,animationTypeUpdate:"transition",animationEasingUpdate:"cubicInOut",animationDurationUpdate:500,animationEasing:"cubicInOut"},e})(Xi);function rye(r){return{seriesType:r,reset:function(e,t){var i=e.getData();i.filterSelf(function(n){var a=i.mapDimension("value"),s=i.get(a,n);return!(di(s)&&!isNaN(s)&&s<0)})}}}function iye(r){r.registerChartView(Jme),r.registerSeriesModel(tye),b9("pie",r.registerAction),r.registerLayout(Sr(Zme,"pie")),r.registerProcessor(aS("pie")),r.registerProcessor(rye("pie"))}var nye=(function(r){Ye(e,r);function e(){var t=r!==null&&r.apply(this,arguments)||this;return t.type=e.type,t.hasSymbolVisual=!0,t}return e.prototype.getInitialData=function(t,i){return Gf(null,this,{useEncodeDefaulter:!0})},e.prototype.getProgressive=function(){var t=this.option.progressive;return t??(this.option.large?5e3:this.get("progressive"))},e.prototype.getProgressiveThreshold=function(){var t=this.option.progressiveThreshold;return t??(this.option.large?1e4:this.get("progressiveThreshold"))},e.prototype.brushSelector=function(t,i,n){return n.point(i.getItemLayout(t))},e.prototype.getZLevelKey=function(){return this.getData().count()>this.getProgressiveThreshold()?this.id:""},e.type="series.scatter",e.dependencies=["grid","polar","geo","singleAxis","calendar"],e.defaultOption={coordinateSystem:"cartesian2d",z:2,legendHoverLink:!0,symbolSize:10,large:!1,largeThreshold:2e3,itemStyle:{opacity:.8},emphasis:{scale:!0},clip:!0,select:{itemStyle:{borderColor:"#212121"}},universalTransition:{divideShape:"clone"}},e})(Xi),nG=4,aye=(function(){function r(){}return r})(),oye=(function(r){Ye(e,r);function e(t){var i=r.call(this,t)||this;return i._off=0,i.hoverDataIdx=-1,i}return e.prototype.getDefaultShape=function(){return new aye},e.prototype.reset=function(){this.notClear=!1,this._off=0},e.prototype.buildPath=function(t,i){var n=i.points,a=i.size,s=this.symbolProxy,o=s.shape,l=t.getContext?t.getContext():t,c=l&&a[0]<nG,f=this.softClipShape,p;if(c){this._ctx=l;return}for(this._ctx=null,p=this._off;p<n.length;){var y=n[p++],b=n[p++];isNaN(y)||isNaN(b)||f&&!f.contain(y,b)||(o.x=y-a[0]/2,o.y=b-a[1]/2,o.width=a[0],o.height=a[1],s.buildPath(t,o,!0))}this.incremental&&(this._off=p,this.notClear=!0)},e.prototype.afterBrush=function(){var t=this.shape,i=t.points,n=t.size,a=this._ctx,s=this.softClipShape,o;if(a){for(o=this._off;o<i.length;){var l=i[o++],c=i[o++];isNaN(l)||isNaN(c)||s&&!s.contain(l,c)||a.fillRect(l-n[0]/2,c-n[1]/2,n[0],n[1])}this.incremental&&(this._off=o,this.notClear=!0)}},e.prototype.findDataIndex=function(t,i){for(var n=this.shape,a=n.points,s=n.size,o=Math.max(s[0],4),l=Math.max(s[1],4),c=a.length/2-1;c>=0;c--){var f=c*2,p=a[f]-o/2,y=a[f+1]-l/2;if(t>=p&&i>=y&&t<=p+o&&i<=y+l)return c}return-1},e.prototype.contain=function(t,i){var n=this.transformCoordToLocal(t,i),a=this.getBoundingRect();if(t=n[0],i=n[1],a.contain(t,i)){var s=this.hoverDataIdx=this.findDataIndex(t,i);return s>=0}return this.hoverDataIdx=-1,!1},e.prototype.getBoundingRect=function(){var t=this._rect;if(!t){for(var i=this.shape,n=i.points,a=i.size,s=a[0],o=a[1],l=1/0,c=1/0,f=-1/0,p=-1/0,y=0;y<n.length;){var b=n[y++],S=n[y++];l=Math.min(b,l),f=Math.max(b,f),c=Math.min(S,c),p=Math.max(S,p)}t=this._rect=new Dr(l-s/2,c-o/2,f-l+s,p-c+o)}return t},e})(Xr),sye=(function(){function r(){this.group=new mr}return r.prototype.updateData=function(e,t){this._clear();var i=this._create();i.setShape({points:e.getLayout("points")}),this._setCommon(i,e,t)},r.prototype.updateLayout=function(e){var t=e.getLayout("points");this.group.eachChild(function(i){if(i.startIndex!=null){var n=(i.endIndex-i.startIndex)*2,a=i.startIndex*4*2;t=new Float32Array(t.buffer,a,n)}i.setShape("points",t),i.reset()})},r.prototype.incrementalPrepareUpdate=function(e){this._clear()},r.prototype.incrementalUpdate=function(e,t,i){var n=this._newAdded[0],a=t.getLayout("points"),s=n&&n.shape.points;if(s&&s.length<2e4){var o=s.length,l=new Float32Array(o+a.length);l.set(s),l.set(a,o),n.endIndex=e.end,n.setShape({points:l})}else{this._newAdded=[];var c=this._create();c.startIndex=e.start,c.endIndex=e.end,c.incremental=!0,c.setShape({points:a}),this._setCommon(c,t,i)}},r.prototype.eachRendered=function(e){this._newAdded[0]&&e(this._newAdded[0])},r.prototype._create=function(){var e=new oye({cursor:"default"});return e.ignoreCoarsePointer=!0,this.group.add(e),this._newAdded.push(e),e},r.prototype._setCommon=function(e,t,i){var n=t.hostModel;i=i||{};var a=t.getVisual("symbolSize");e.setShape("size",a instanceof Array?a:[a,a]),e.softClipShape=i.clipShape||null,e.symbolProxy=Aa(t.getVisual("symbol"),0,0,0,0),e.setColor=e.symbolProxy.setColor;var s=e.shape.size[0]<nG;e.useStyle(n.getModel("itemStyle").getItemStyle(s?["color","shadowBlur","shadowColor"]:["color"]));var o=t.getVisual("style"),l=o&&o.fill;l&&e.setColor(l);var c=br(e);c.seriesIndex=n.seriesIndex,e.on("mousemove",function(f){c.dataIndex=null;var p=e.hoverDataIdx;p>=0&&(c.dataIndex=p+(e.startIndex||0))})},r.prototype.remove=function(){this._clear()},r.prototype._clear=function(){this._newAdded=[],this.group.removeAll()},r})(),lye=(function(r){Ye(e,r);function e(){var t=r!==null&&r.apply(this,arguments)||this;return t.type=e.type,t}return e.prototype.render=function(t,i,n){var a=t.getData(),s=this._updateSymbolDraw(a,t);s.updateData(a,{clipShape:this._getClipShape(t)}),this._finished=!0},e.prototype.incrementalPrepareRender=function(t,i,n){var a=t.getData(),s=this._updateSymbolDraw(a,t);s.incrementalPrepareUpdate(a),this._finished=!1},e.prototype.incrementalRender=function(t,i,n){this._symbolDraw.incrementalUpdate(t,i.getData(),{clipShape:this._getClipShape(i)}),this._finished=t.end===i.getData().count()},e.prototype.updateTransform=function(t,i,n){var a=t.getData();if(this.group.dirty(),!this._finished||a.count()>1e4)return{update:!0};var s=nS("").reset(t,i,n);s.progress&&s.progress({start:0,end:a.count(),count:a.count()},a),this._symbolDraw.updateLayout(a)},e.prototype.eachRendered=function(t){this._symbolDraw&&this._symbolDraw.eachRendered(t)},e.prototype._getClipShape=function(t){if(t.get("clip",!0)){var i=t.coordinateSystem;return i&&i.getArea&&i.getArea(.1)}},e.prototype._updateSymbolDraw=function(t,i){var n=this._symbolDraw,a=i.pipelineContext,s=a.large;return(!n||s!==this._isLargeDraw)&&(n&&n.remove(),n=this._symbolDraw=s?new sye:new rS,this._isLargeDraw=s,this.group.removeAll()),this.group.add(n.group),n},e.prototype.remove=function(t,i){this._symbolDraw&&this._symbolDraw.remove(!0),this._symbolDraw=null},e.prototype.dispose=function(){},e.type="scatter",e})(Fi),uye=(function(r){Ye(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.type="grid",e.dependencies=["xAxis","yAxis"],e.layoutMode="box",e.defaultOption={show:!1,z:0,left:"10%",top:60,right:"10%",bottom:70,containLabel:!1,backgroundColor:"rgba(0,0,0,0)",borderWidth:1,borderColor:"#ccc"},e})(Wr),P3=(function(r){Ye(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.getCoordSysModel=function(){return this.getReferringComponents("grid",ka).models[0]},e.type="cartesian2dAxis",e})(Wr);ha(P3,wb);var aG={show:!0,z:0,inverse:!1,name:"",nameLocation:"end",nameRotate:null,nameTruncate:{maxWidth:null,ellipsis:"...",placeholder:"."},nameTextStyle:{},nameGap:15,silent:!1,triggerEvent:!1,tooltip:{show:!1},axisPointer:{},axisLine:{show:!0,onZero:!0,onZeroAxisIndex:null,lineStyle:{color:"#6E7079",width:1,type:"solid"},symbol:["none","none"],symbolSize:[10,15]},axisTick:{show:!0,inside:!1,length:5,lineStyle:{width:1}},axisLabel:{show:!0,inside:!1,rotate:0,showMinLabel:null,showMaxLabel:null,margin:8,fontSize:12},splitLine:{show:!0,showMinLine:!0,showMaxLine:!0,lineStyle:{color:["#E0E6F1"],width:1,type:"solid"}},splitArea:{show:!1,areaStyle:{color:["rgba(250,250,250,0.2)","rgba(210,219,238,0.2)"]}}},cye=Cr({boundaryGap:!0,deduplication:null,splitLine:{show:!1},axisTick:{alignWithLabel:!1,interval:"auto"},axisLabel:{interval:"auto"}},aG),OL=Cr({boundaryGap:[0,0],axisLine:{show:"auto"},axisTick:{show:"auto"},splitNumber:5,minorTick:{show:!1,splitNumber:5,length:3,lineStyle:{}},minorSplitLine:{show:!1,lineStyle:{color:"#F4F7FD",width:1}}},aG),hye=Cr({splitNumber:6,axisLabel:{showMinLabel:!1,showMaxLabel:!1,rich:{primary:{fontWeight:"bold"}}},splitLine:{show:!1}},OL),fye=lr({logBase:10},OL);const oG={category:cye,value:OL,time:hye,log:fye};var dye={value:1,category:1,time:1,log:1};function K0(r,e,t,i){se(dye,function(n,a){var s=Cr(Cr({},oG[a],!0),i,!0),o=(function(l){Ye(c,l);function c(){var f=l!==null&&l.apply(this,arguments)||this;return f.type=e+"Axis."+a,f}return c.prototype.mergeDefaultAndTheme=function(f,p){var y=yw(this),b=y?pb(f):{},S=p.getTheme();Cr(f,S.get(a+"Axis")),Cr(f,this.getDefaultOption()),f.type=y5(f),y&&$g(f,b,y)},c.prototype.optionUpdated=function(){var f=this.option;f.type==="category"&&(this.__ordinalMeta=w3.createByAxisModel(this))},c.prototype.getCategories=function(f){var p=this.option;if(p.type==="category")return f?p.data:this.__ordinalMeta.categories},c.prototype.getOrdinalMeta=function(){return this.__ordinalMeta},c.type=e+"Axis."+a,c.defaultOption=s,c})(t);r.registerComponentModel(o)}),r.registerSubTypeDefaulter(e+"Axis",y5)}function y5(r){return r.type||(r.data?"category":"value")}var pye=(function(){function r(e){this.type="cartesian",this._dimList=[],this._axes={},this.name=e||""}return r.prototype.getAxis=function(e){return this._axes[e]},r.prototype.getAxes=function(){return wt(this._dimList,function(e){return this._axes[e]},this)},r.prototype.getAxesByScale=function(e){return e=e.toLowerCase(),wi(this.getAxes(),function(t){return t.scale.type===e})},r.prototype.addAxis=function(e){var t=e.dim;this._axes[t]=e,this._dimList.push(t)},r})(),R3=["x","y"];function _5(r){return r.type==="interval"||r.type==="time"}var gye=(function(r){Ye(e,r);function e(){var t=r!==null&&r.apply(this,arguments)||this;return t.type="cartesian2d",t.dimensions=R3,t}return e.prototype.calcAffineTransform=function(){this._transform=this._invTransform=null;var t=this.getAxis("x").scale,i=this.getAxis("y").scale;if(!(!_5(t)||!_5(i))){var n=t.getExtent(),a=i.getExtent(),s=this.dataToPoint([n[0],a[0]]),o=this.dataToPoint([n[1],a[1]]),l=n[1]-n[0],c=a[1]-a[0];if(!(!l||!c)){var f=(o[0]-s[0])/l,p=(o[1]-s[1])/c,y=s[0]-n[0]*f,b=s[1]-a[0]*p,S=this._transform=[f,0,0,p,y,b];this._invTransform=Ey([],S)}}},e.prototype.getBaseAxis=function(){return this.getAxesByScale("ordinal")[0]||this.getAxesByScale("time")[0]||this.getAxis("x")},e.prototype.containPoint=function(t){var i=this.getAxis("x"),n=this.getAxis("y");return i.contain(i.toLocalCoord(t[0]))&&n.contain(n.toLocalCoord(t[1]))},e.prototype.containData=function(t){return this.getAxis("x").containData(t[0])&&this.getAxis("y").containData(t[1])},e.prototype.containZone=function(t,i){var n=this.dataToPoint(t),a=this.dataToPoint(i),s=this.getArea(),o=new Dr(n[0],n[1],a[0]-n[0],a[1]-n[1]);return s.intersect(o)},e.prototype.dataToPoint=function(t,i,n){n=n||[];var a=t[0],s=t[1];if(this._transform&&a!=null&&isFinite(a)&&s!=null&&isFinite(s))return Ro(n,t,this._transform);var o=this.getAxis("x"),l=this.getAxis("y");return n[0]=o.toGlobalCoord(o.dataToCoord(a,i)),n[1]=l.toGlobalCoord(l.dataToCoord(s,i)),n},e.prototype.clampData=function(t,i){var n=this.getAxis("x").scale,a=this.getAxis("y").scale,s=n.getExtent(),o=a.getExtent(),l=n.parse(t[0]),c=a.parse(t[1]);return i=i||[],i[0]=Math.min(Math.max(Math.min(s[0],s[1]),l),Math.max(s[0],s[1])),i[1]=Math.min(Math.max(Math.min(o[0],o[1]),c),Math.max(o[0],o[1])),i},e.prototype.pointToData=function(t,i){var n=[];if(this._invTransform)return Ro(n,t,this._invTransform);var a=this.getAxis("x"),s=this.getAxis("y");return n[0]=a.coordToData(a.toLocalCoord(t[0]),i),n[1]=s.coordToData(s.toLocalCoord(t[1]),i),n},e.prototype.getOtherAxis=function(t){return this.getAxis(t.dim==="x"?"y":"x")},e.prototype.getArea=function(t){t=t||0;var i=this.getAxis("x").getGlobalExtent(),n=this.getAxis("y").getGlobalExtent(),a=Math.min(i[0],i[1])-t,s=Math.min(n[0],n[1])-t,o=Math.max(i[0],i[1])-a+t,l=Math.max(n[0],n[1])-s+t;return new Dr(a,s,o,l)},e})(pye),vye=(function(r){Ye(e,r);function e(t,i,n,a,s){var o=r.call(this,t,i,n)||this;return o.index=0,o.type=a||"value",o.position=s||"bottom",o}return e.prototype.isHorizontal=function(){var t=this.position;return t==="top"||t==="bottom"},e.prototype.getGlobalExtent=function(t){var i=this.getExtent();return i[0]=this.toGlobalCoord(i[0]),i[1]=this.toGlobalCoord(i[1]),t&&i[0]>i[1]&&i.reverse(),i},e.prototype.pointToData=function(t,i){return this.coordToData(this.toLocalCoord(t[this.dim==="x"?0:1]),i)},e.prototype.setCategorySortInfo=function(t){if(this.type!=="category")return!1;this.model.option.categorySortInfo=t,this.scale.setSortInfo(t)},e})(Pc);function D3(r,e,t){t=t||{};var i=r.coordinateSystem,n=e.axis,a={},s=n.getAxesOnZeroOf()[0],o=n.position,l=s?"onZero":o,c=n.dim,f=i.getRect(),p=[f.x,f.x+f.width,f.y,f.y+f.height],y={left:0,right:1,top:0,bottom:1,onZero:2},b=e.get("offset")||0,S=c==="x"?[p[2]-b,p[3]+b]:[p[0]-b,p[1]+b];if(s){var C=s.toGlobalCoord(s.dataToCoord(0));S[y.onZero]=Math.max(Math.min(C,S[1]),S[0])}a.position=[c==="y"?S[y[l]]:p[0],c==="x"?S[y[l]]:p[3]],a.rotation=Math.PI/2*(c==="x"?0:1);var E={top:-1,bottom:1,left:-1,right:1};a.labelDirection=a.tickDirection=a.nameDirection=E[o],a.labelOffset=s?S[y[o]]-S[y.onZero]:0,e.get(["axisTick","inside"])&&(a.tickDirection=-a.tickDirection),uo(t.labelInside,e.get(["axisLabel","inside"]))&&(a.labelDirection=-a.labelDirection);var P=e.get(["axisLabel","rotate"]);return a.labelRotate=l==="top"?-P:P,a.z2=1,a}function b5(r){return r.get("coordinateSystem")==="cartesian2d"}function x5(r){var e={xAxisModel:null,yAxisModel:null};return se(e,function(t,i){var n=i.replace(/Model$/,""),a=r.getReferringComponents(n,ka).models[0];e[i]=a}),e}var zI=Math.log;function sG(r,e,t){var i=pp.prototype,n=i.getTicks.call(t),a=i.getTicks.call(t,!0),s=n.length-1,o=i.getInterval.call(t),l=cW(r,e),c=l.extent,f=l.fixMin,p=l.fixMax;if(r.type==="log"){var y=zI(r.base);c=[zI(c[0])/y,zI(c[1])/y]}r.setExtent(c[0],c[1]),r.calcNiceExtent({splitNumber:s,fixMin:f,fixMax:p});var b=i.getExtent.call(r);f&&(c[0]=b[0]),p&&(c[1]=b[1]);var S=i.getInterval.call(r),C=c[0],E=c[1];if(f&&p)S=(E-C)/s;else if(f)for(E=c[0]+S*s;E<c[1]&&isFinite(E)&&isFinite(c[1]);)S=SI(S),E=c[0]+S*s;else if(p)for(C=c[1]-S*s;C>c[0]&&isFinite(C)&&isFinite(c[0]);)S=SI(S),C=c[1]-S*s;else{var P=r.getTicks().length-1;P>s&&(S=SI(S));var O=S*s;E=Math.ceil(c[1]/S)*S,C=Qn(E-O),C<0&&c[0]>=0?(C=0,E=Qn(O)):E>0&&c[1]<=0&&(E=0,C=-Qn(O))}var B=(n[0].value-a[0].value)/o,F=(n[s].value-a[s].value)/o;i.setExtent.call(r,C+S*B,E+S*F),i.setInterval.call(r,S),(B||F)&&i.setNiceExtent.call(r,C+S,E-S)}var mye=(function(){function r(e,t,i){this.type="grid",this._coordsMap={},this._coordsList=[],this._axesMap={},this._axesList=[],this.axisPointerEnabled=!0,this.dimensions=R3,this._initCartesian(e,t,i),this.model=e}return r.prototype.getRect=function(){return this._rect},r.prototype.update=function(e,t){var i=this._axesMap;this._updateScale(e,this.model);function n(s){var o,l=qr(s),c=l.length;if(c){for(var f=[],p=c-1;p>=0;p--){var y=+l[p],b=s[y],S=b.model,C=b.scale;S3(C)&&S.get("alignTicks")&&S.get("interval")==null?f.push(b):(xy(C,S),S3(C)&&(o=b))}f.length&&(o||(o=f.pop(),xy(o.scale,o.model)),se(f,function(E){sG(E.scale,E.model,o.scale)}))}}n(i.x),n(i.y);var a={};se(i.x,function(s){w5(i,"y",s,a)}),se(i.y,function(s){w5(i,"x",s,a)}),this.resize(this.model,t)},r.prototype.resize=function(e,t,i){var n=e.getBoxLayoutParams(),a=!i&&e.get("containLabel"),s=La(n,{width:t.getWidth(),height:t.getHeight()});this._rect=s;var o=this._axesList;l(),a&&(se(o,function(c){if(!c.model.get(["axisLabel","inside"])){var f=Bge(c);if(f){var p=c.isHorizontal()?"height":"width",y=c.model.get(["axisLabel","margin"]);s[p]-=f[p]+y,c.position==="top"?s.y+=f.height+y:c.position==="left"&&(s.x+=f.width+y)}}}),l()),se(this._coordsList,function(c){c.calcAffineTransform()});function l(){se(o,function(c){var f=c.isHorizontal(),p=f?[0,s.width]:[0,s.height],y=c.inverse?1:0;c.setExtent(p[y],p[1-y]),yye(c,f?s.x:s.y)})}},r.prototype.getAxis=function(e,t){var i=this._axesMap[e];if(i!=null)return i[t||0]},r.prototype.getAxes=function(){return this._axesList.slice()},r.prototype.getCartesian=function(e,t){if(e!=null&&t!=null){var i="x"+e+"y"+t;return this._coordsMap[i]}cr(e)&&(t=e.yAxisIndex,e=e.xAxisIndex);for(var n=0,a=this._coordsList;n<a.length;n++)if(a[n].getAxis("x").index===e||a[n].getAxis("y").index===t)return a[n]},r.prototype.getCartesians=function(){return this._coordsList.slice()},r.prototype.convertToPixel=function(e,t,i){var n=this._findConvertTarget(t);return n.cartesian?n.cartesian.dataToPoint(i):n.axis?n.axis.toGlobalCoord(n.axis.dataToCoord(i)):null},r.prototype.convertFromPixel=function(e,t,i){var n=this._findConvertTarget(t);return n.cartesian?n.cartesian.pointToData(i):n.axis?n.axis.coordToData(n.axis.toLocalCoord(i)):null},r.prototype._findConvertTarget=function(e){var t=e.seriesModel,i=e.xAxisModel||t&&t.getReferringComponents("xAxis",ka).models[0],n=e.yAxisModel||t&&t.getReferringComponents("yAxis",ka).models[0],a=e.gridModel,s=this._coordsList,o,l;if(t)o=t.coordinateSystem,Or(s,o)<0&&(o=null);else if(i&&n)o=this.getCartesian(i.componentIndex,n.componentIndex);else if(i)l=this.getAxis("x",i.componentIndex);else if(n)l=this.getAxis("y",n.componentIndex);else if(a){var c=a.coordinateSystem;c===this&&(o=this._coordsList[0])}return{cartesian:o,axis:l}},r.prototype.containPoint=function(e){var t=this._coordsList[0];if(t)return t.containPoint(e)},r.prototype._initCartesian=function(e,t,i){var n=this,a=this,s={left:!1,right:!1,top:!1,bottom:!1},o={x:{},y:{}},l={x:0,y:0};if(t.eachComponent("xAxis",c("x"),this),t.eachComponent("yAxis",c("y"),this),!l.x||!l.y){this._axesMap={},this._axesList=[];return}this._axesMap=o,se(o.x,function(f,p){se(o.y,function(y,b){var S="x"+p+"y"+b,C=new gye(S);C.master=n,C.model=e,n._coordsMap[S]=C,n._coordsList.push(C),C.addAxis(f),C.addAxis(y)})});function c(f){return function(p,y){if(FI(p,e)){var b=p.get("position");f==="x"?b!=="top"&&b!=="bottom"&&(b=s.bottom?"top":"bottom"):b!=="left"&&b!=="right"&&(b=s.left?"right":"left"),s[b]=!0;var S=new vye(f,eS(p),[0,0],p.get("type"),b),C=S.type==="category";S.onBand=C&&p.get("boundaryGap"),S.inverse=p.get("inverse"),p.axis=S,S.model=p,S.grid=a,S.index=y,a._axesList.push(S),o[f][y]=S,l[f]++}}}},r.prototype._updateScale=function(e,t){se(this._axesList,function(n){if(n.scale.setExtent(1/0,-1/0),n.type==="category"){var a=n.model.get("categorySortInfo");n.scale.setSortInfo(a)}}),e.eachSeries(function(n){if(b5(n)){var a=x5(n),s=a.xAxisModel,o=a.yAxisModel;if(!FI(s,t)||!FI(o,t))return;var l=this.getCartesian(s.componentIndex,o.componentIndex),c=n.getData(),f=l.getAxis("x"),p=l.getAxis("y");i(c,f),i(c,p)}},this);function i(n,a){se(jA(n,a.dim),function(s){a.scale.unionExtentFromData(n,s)})}},r.prototype.getTooltipAxes=function(e){var t=[],i=[];return se(this.getCartesians(),function(n){var a=e!=null&&e!=="auto"?n.getAxis(e):n.getBaseAxis(),s=n.getOtherAxis(a);Or(t,a)<0&&t.push(a),Or(i,s)<0&&i.push(s)}),{baseAxes:t,otherAxes:i}},r.create=function(e,t){var i=[];return e.eachComponent("grid",function(n,a){var s=new r(n,e,t);s.name="grid_"+a,s.resize(n,t,!0),n.coordinateSystem=s,i.push(s)}),e.eachSeries(function(n){if(b5(n)){var a=x5(n),s=a.xAxisModel,o=a.yAxisModel,l=s.getCoordSysModel(),c=l.coordinateSystem;n.coordinateSystem=c.getCartesian(s.componentIndex,o.componentIndex)}}),i},r.dimensions=R3,r})();function FI(r,e){return r.getCoordSysModel()===e}function w5(r,e,t,i){t.getAxesOnZeroOf=function(){return a?[a]:[]};var n=r[e],a,s=t.model,o=s.get(["axisLine","onZero"]),l=s.get(["axisLine","onZeroAxisIndex"]);if(!o)return;if(l!=null)S5(n[l])&&(a=n[l]);else for(var c in n)if(n.hasOwnProperty(c)&&S5(n[c])&&!i[f(n[c])]){a=n[c];break}a&&(i[f(a)]=!0);function f(p){return p.dim+"_"+p.index}}function S5(r){return r&&r.type!=="category"&&r.type!=="time"&&Nge(r)}function yye(r,e){var t=r.getExtent(),i=t[0]+t[1];r.toGlobalCoord=r.dim==="x"?function(n){return n+e}:function(n){return i-n+e},r.toLocalCoord=r.dim==="x"?function(n){return n-e}:function(n){return i-n+e}}var Ig=Math.PI,ol=(function(){function r(e,t){this.group=new mr,this.opt=t,this.axisModel=e,lr(t,{labelOffset:0,nameDirection:1,tickDirection:1,labelDirection:1,silent:!0,handleAutoShown:function(){return!0}});var i=new mr({x:t.position[0],y:t.position[1],rotation:t.rotation});i.updateTransform(),this._transformGroup=i}return r.prototype.hasBuilder=function(e){return!!T5[e]},r.prototype.add=function(e){T5[e](this.opt,this.axisModel,this.group,this._transformGroup)},r.prototype.getGroup=function(){return this.group},r.innerTextLayout=function(e,t,i){var n=Ak(t-e),a,s;return W0(n)?(s=i>0?"top":"bottom",a="center"):W0(n-Ig)?(s=i>0?"bottom":"top",a="center"):(s="middle",n>0&&n<Ig?a=i>0?"right":"left":a=i>0?"left":"right"),{rotation:n,textAlign:a,textVerticalAlign:s}},r.makeAxisEventDataBase=function(e){var t={componentType:e.mainType,componentIndex:e.componentIndex};return t[e.mainType+"Index"]=e.componentIndex,t},r.isLabelSilent=function(e){var t=e.get("tooltip");return e.get("silent")||!(e.get("triggerEvent")||t&&t.show)},r})(),T5={axisLine:function(r,e,t,i){var n=e.get(["axisLine","show"]);if(n==="auto"&&r.handleAutoShown&&(n=r.handleAutoShown("axisLine")),!!n){var a=e.axis.getExtent(),s=i.transform,o=[a[0],0],l=[a[1],0],c=o[0]>l[0];s&&(Ro(o,o,s),Ro(l,l,s));var f=mt({lineCap:"round"},e.getModel(["axisLine","lineStyle"]).getLineStyle()),p=new qa({shape:{x1:o[0],y1:o[1],x2:l[0],y2:l[1]},style:f,strokeContainThreshold:r.strokeContainThreshold||5,silent:!0,z2:1});X0(p.shape,p.style.lineWidth),p.anid="line",t.add(p);var y=e.get(["axisLine","symbol"]);if(y!=null){var b=e.get(["axisLine","symbolSize"]);$t(y)&&(y=[y,y]),($t(b)||di(b))&&(b=[b,b]);var S=Dy(e.get(["axisLine","symbolOffset"])||0,b),C=b[0],E=b[1];se([{rotate:r.rotation+Math.PI/2,offset:S[0],r:0},{rotate:r.rotation-Math.PI/2,offset:S[1],r:Math.sqrt((o[0]-l[0])*(o[0]-l[0])+(o[1]-l[1])*(o[1]-l[1]))}],function(P,O){if(y[O]!=="none"&&y[O]!=null){var B=Aa(y[O],-C/2,-E/2,C,E,f.stroke,!0),F=P.r+P.offset,W=c?l:o;B.attr({rotation:P.rotate,x:W[0]+F*Math.cos(r.rotation),y:W[1]-F*Math.sin(r.rotation),silent:!0,z2:11}),t.add(B)}})}}},axisTickLabel:function(r,e,t,i){var n=xye(t,i,e,r),a=Sye(t,i,e,r);if(bye(e,a,n),wye(t,i,e,r.tickDirection),e.get(["axisLabel","hideOverlap"])){var s=TW(wt(a,function(o){return{label:o,priority:o.z2,defaultAttr:{ignore:o.ignore}}}));MW(s)}},axisName:function(r,e,t,i){var n=uo(r.axisName,e.get("name"));if(n){var a=e.get("nameLocation"),s=r.nameDirection,o=e.getModel("nameTextStyle"),l=e.get("nameGap")||0,c=e.axis.getExtent(),f=c[0]>c[1]?-1:1,p=[a==="start"?c[0]-f*l:a==="end"?c[1]+f*l:(c[0]+c[1])/2,C5(a)?r.labelOffset+s*l:0],y,b=e.get("nameRotate");b!=null&&(b=b*Ig/180);var S;C5(a)?y=ol.innerTextLayout(r.rotation,b??r.rotation,s):(y=_ye(r.rotation,a,b||0,c),S=r.axisNameAvailableWidth,S!=null&&(S=Math.abs(S/Math.sin(y.rotation)),!isFinite(S)&&(S=null)));var C=o.getFont(),E=e.get("nameTruncate",!0)||{},P=E.ellipsis,O=uo(r.nameTruncateMaxWidth,E.maxWidth,S),B=new si({x:p[0],y:p[1],rotation:y.rotation,silent:ol.isLabelSilent(e),style:cn(o,{text:n,font:C,overflow:"truncate",width:O,ellipsis:P,fill:o.getTextColor()||e.get(["axisLine","lineStyle","color"]),align:o.get("align")||y.textAlign,verticalAlign:o.get("verticalAlign")||y.textVerticalAlign}),z2:1});if(Iy({el:B,componentModel:e,itemName:n}),B.__fullText=n,B.anid="name",e.get("triggerEvent")){var F=ol.makeAxisEventDataBase(e);F.targetType="axisName",F.name=n,br(B).eventData=F}i.add(B),B.updateTransform(),t.add(B),B.decomposeTransform()}}};function _ye(r,e,t,i){var n=Ak(t-r),a,s,o=i[0]>i[1],l=e==="start"&&!o||e!=="start"&&o;return W0(n-Ig/2)?(s=l?"bottom":"top",a="center"):W0(n-Ig*1.5)?(s=l?"top":"bottom",a="center"):(s="middle",n<Ig*1.5&&n>Ig/2?a=l?"left":"right":a=l?"right":"left"),{rotation:n,textAlign:a,textVerticalAlign:s}}function bye(r,e,t){if(!hW(r.axis)){var i=r.get(["axisLabel","showMinLabel"]),n=r.get(["axisLabel","showMaxLabel"]);e=e||[],t=t||[];var a=e[0],s=e[1],o=e[e.length-1],l=e[e.length-2],c=t[0],f=t[1],p=t[t.length-1],y=t[t.length-2];i===!1?(ac(a),ac(c)):A5(a,s)&&(i?(ac(s),ac(f)):(ac(a),ac(c))),n===!1?(ac(o),ac(p)):A5(l,o)&&(n?(ac(l),ac(y)):(ac(o),ac(p)))}}function ac(r){r&&(r.ignore=!0)}function A5(r,e){var t=r&&r.getBoundingRect().clone(),i=e&&e.getBoundingRect().clone();if(!(!t||!i)){var n=jw([]);return Zg(n,n,-r.rotation),t.applyTransform(zf([],n,r.getLocalTransform())),i.applyTransform(zf([],n,e.getLocalTransform())),t.intersect(i)}}function C5(r){return r==="middle"||r==="center"}function lG(r,e,t,i,n){for(var a=[],s=[],o=[],l=0;l<r.length;l++){var c=r[l].coord;s[0]=c,s[1]=0,o[0]=c,o[1]=t,e&&(Ro(s,s,e),Ro(o,o,e));var f=new qa({shape:{x1:s[0],y1:s[1],x2:o[0],y2:o[1]},style:i,z2:2,autoBatch:!0,silent:!0});X0(f.shape,f.style.lineWidth),f.anid=n+"_"+r[l].tickValue,a.push(f)}return a}function xye(r,e,t,i){var n=t.axis,a=t.getModel("axisTick"),s=a.get("show");if(s==="auto"&&i.handleAutoShown&&(s=i.handleAutoShown("axisTick")),!(!s||n.scale.isBlank())){for(var o=a.getModel("lineStyle"),l=i.tickDirection*a.get("length"),c=n.getTicksCoords(),f=lG(c,e.transform,l,lr(o.getLineStyle(),{stroke:t.get(["axisLine","lineStyle","color"])}),"ticks"),p=0;p<f.length;p++)r.add(f[p]);return f}}function wye(r,e,t,i){var n=t.axis,a=t.getModel("minorTick");if(!(!a.get("show")||n.scale.isBlank())){var s=n.getMinorTicksCoords();if(s.length)for(var o=a.getModel("lineStyle"),l=i*a.get("length"),c=lr(o.getLineStyle(),lr(t.getModel("axisTick").getLineStyle(),{stroke:t.get(["axisLine","lineStyle","color"])})),f=0;f<s.length;f++)for(var p=lG(s[f],e.transform,l,c,"minorticks_"+f),y=0;y<p.length;y++)r.add(p[y])}}function Sye(r,e,t,i){var n=t.axis,a=uo(i.axisLabelShow,t.get(["axisLabel","show"]));if(!(!a||n.scale.isBlank())){var s=t.getModel("axisLabel"),o=s.get("margin"),l=n.getViewLabels(),c=(uo(i.labelRotate,s.get("rotate"))||0)*Ig/180,f=ol.innerTextLayout(i.rotation,c,i.labelDirection),p=t.getCategories&&t.getCategories(!0),y=[],b=ol.isLabelSilent(t),S=t.get("triggerEvent");return se(l,function(C,E){var P=n.scale.type==="ordinal"?n.scale.getRawOrdinalNumber(C.tickValue):C.tickValue,O=C.formattedLabel,B=C.rawLabel,F=s;if(p&&p[P]){var W=p[P];cr(W)&&W.textStyle&&(F=new Si(W.textStyle,s,t.ecModel))}var $=F.getTextColor()||t.get(["axisLine","lineStyle","color"]),q=n.dataToCoord(P),Q=F.getShallow("align",!0)||f.textAlign,ee=wr(F.getShallow("alignMinLabel",!0),Q),te=wr(F.getShallow("alignMaxLabel",!0),Q),ae=F.getShallow("verticalAlign",!0)||F.getShallow("baseline",!0)||f.textVerticalAlign,de=wr(F.getShallow("verticalAlignMinLabel",!0),ae),ve=wr(F.getShallow("verticalAlignMaxLabel",!0),ae),ye=new si({x:q,y:i.labelOffset+i.labelDirection*o,rotation:f.rotation,silent:b,z2:10+(C.level||0),style:cn(F,{text:O,align:E===0?ee:E===l.length-1?te:Q,verticalAlign:E===0?de:E===l.length-1?ve:ae,fill:sr($)?$(n.type==="category"?B:n.type==="value"?P+"":P,E):$})});if(ye.anid="label_"+P,Iy({el:ye,componentModel:t,itemName:O,formatterParamsExtra:{isTruncated:function(){return ye.isTruncated},value:B,tickIndex:E}}),S){var Ae=ol.makeAxisEventDataBase(t);Ae.targetType="axisLabel",Ae.value=B,Ae.tickIndex=E,n.type==="category"&&(Ae.dataIndex=P),br(ye).eventData=Ae}e.add(ye),ye.updateTransform(),y.push(ye),r.add(ye),ye.decomposeTransform()}),y}}function Tye(r,e){var t={axesInfo:{},seriesInvolved:!1,coordSysAxesInfo:{},coordSysMap:{}};return Aye(t,r,e),t.seriesInvolved&&Mye(t,r),t}function Aye(r,e,t){var i=e.getComponent("tooltip"),n=e.getComponent("axisPointer"),a=n.get("link",!0)||[],s=[];se(t.getCoordinateSystems(),function(o){if(!o.axisPointerEnabled)return;var l=Mw(o.model),c=r.coordSysAxesInfo[l]={};r.coordSysMap[l]=o;var f=o.model,p=f.getModel("tooltip",i);if(se(o.getAxes(),Sr(C,!1,null)),o.getTooltipAxes&&i&&p.get("show")){var y=p.get("trigger")==="axis",b=p.get(["axisPointer","type"])==="cross",S=o.getTooltipAxes(p.get(["axisPointer","axis"]));(y||b)&&se(S.baseAxes,Sr(C,b?"cross":!0,y)),b&&se(S.otherAxes,Sr(C,"cross",!1))}function C(E,P,O){var B=O.model.getModel("axisPointer",n),F=B.get("show");if(!(!F||F==="auto"&&!E&&!k3(B))){P==null&&(P=B.get("triggerTooltip")),B=E?Cye(O,p,n,e,E,P):B;var W=B.get("snap"),$=B.get("triggerEmphasis"),q=Mw(O.model),Q=P||W||O.type==="category",ee=r.axesInfo[q]={key:q,axis:O,coordSys:o,axisPointerModel:B,triggerTooltip:P,triggerEmphasis:$,involveSeries:Q,snap:W,useHandle:k3(B),seriesModels:[],linkGroup:null};c[q]=ee,r.seriesInvolved=r.seriesInvolved||Q;var te=Eye(a,O);if(te!=null){var ae=s[te]||(s[te]={axesInfo:{}});ae.axesInfo[q]=ee,ae.mapper=a[te].mapper,ee.linkGroup=ae}}}})}function Cye(r,e,t,i,n,a){var s=e.getModel("axisPointer"),o=["type","snap","lineStyle","shadowStyle","label","animation","animationDurationUpdate","animationEasingUpdate","z"],l={};se(o,function(y){l[y]=hr(s.get(y))}),l.snap=r.type!=="category"&&!!a,s.get("type")==="cross"&&(l.type="line");var c=l.label||(l.label={});if(c.show==null&&(c.show=!1),n==="cross"){var f=s.get(["label","show"]);if(c.show=f??!0,!a){var p=l.lineStyle=s.get("crossStyle");p&&lr(c,p.textStyle)}}return r.model.getModel("axisPointer",new Si(l,t,i))}function Mye(r,e){e.eachSeries(function(t){var i=t.coordinateSystem,n=t.get(["tooltip","trigger"],!0),a=t.get(["tooltip","show"],!0);!i||n==="none"||n===!1||n==="item"||a===!1||t.get(["axisPointer","show"],!0)===!1||se(r.coordSysAxesInfo[Mw(i.model)],function(s){var o=s.axis;i.getAxis(o.dim)===o&&(s.seriesModels.push(t),s.seriesDataCount==null&&(s.seriesDataCount=0),s.seriesDataCount+=t.getData().count())})})}function Eye(r,e){for(var t=e.model,i=e.dim,n=0;n<r.length;n++){var a=r[n]||{};if(VI(a[i+"AxisId"],t.id)||VI(a[i+"AxisIndex"],t.componentIndex)||VI(a[i+"AxisName"],t.name))return n}}function VI(r,e){return r==="all"||xt(r)&&Or(r,e)>=0||r===e}function Iye(r){var e=NL(r);if(e){var t=e.axisPointerModel,i=e.axis.scale,n=t.option,a=t.get("status"),s=t.get("value");s!=null&&(s=i.parse(s));var o=k3(t);a==null&&(n.status=o?"show":"hide");var l=i.getExtent().slice();l[0]>l[1]&&l.reverse(),(s==null||s>l[1])&&(s=l[1]),s<l[0]&&(s=l[0]),n.value=s,o&&(n.status=e.axis.scale.isBlank()?"hide":"show")}}function NL(r){var e=(r.ecModel.getComponent("axisPointer")||{}).coordSysAxesInfo;return e&&e.axesInfo[Mw(r)]}function Pye(r){var e=NL(r);return e&&e.axisPointerModel}function k3(r){return!!r.get(["handle","show"])}function Mw(r){return r.type+"||"+r.id}var M5={},Ly=(function(r){Ye(e,r);function e(){var t=r!==null&&r.apply(this,arguments)||this;return t.type=e.type,t}return e.prototype.render=function(t,i,n,a){this.axisPointerClass&&Iye(t),r.prototype.render.apply(this,arguments),this._doUpdateAxisPointerClass(t,n,!0)},e.prototype.updateAxisPointer=function(t,i,n,a){this._doUpdateAxisPointerClass(t,n,!1)},e.prototype.remove=function(t,i){var n=this._axisPointer;n&&n.remove(i)},e.prototype.dispose=function(t,i){this._disposeAxisPointer(i),r.prototype.dispose.apply(this,arguments)},e.prototype._doUpdateAxisPointerClass=function(t,i,n){var a=e.getAxisPointerClass(this.axisPointerClass);if(a){var s=Pye(t);s?(this._axisPointer||(this._axisPointer=new a)).render(t,s,i,n):this._disposeAxisPointer(i)}},e.prototype._disposeAxisPointer=function(t){this._axisPointer&&this._axisPointer.dispose(t),this._axisPointer=null},e.registerAxisPointerClass=function(t,i){M5[t]=i},e.getAxisPointerClass=function(t){return t&&M5[t]},e.type="axis",e})(vn),L3=fi();function uG(r,e,t,i){var n=t.axis;if(!n.scale.isBlank()){var a=t.getModel("splitArea"),s=a.getModel("areaStyle"),o=s.get("color"),l=i.coordinateSystem.getRect(),c=n.getTicksCoords({tickModel:a,clamp:!0});if(c.length){var f=o.length,p=L3(r).splitAreaColors,y=Qt(),b=0;if(p)for(var S=0;S<c.length;S++){var C=p.get(c[S].tickValue);if(C!=null){b=(C+(f-1)*S)%f;break}}var E=n.toGlobalCoord(c[0].coord),P=s.getAreaStyle();o=xt(o)?o:[o];for(var S=1;S<c.length;S++){var O=n.toGlobalCoord(c[S].coord),B=void 0,F=void 0,W=void 0,$=void 0;n.isHorizontal()?(B=E,F=l.y,W=O-B,$=l.height,E=B+W):(B=l.x,F=E,W=l.width,$=O-F,E=F+$);var q=c[S-1].tickValue;q!=null&&y.set(q,b),e.add(new li({anid:q!=null?"area_"+q:null,shape:{x:B,y:F,width:W,height:$},style:lr({fill:o[b]},P),autoBatch:!0,silent:!0})),b=(b+1)%f}L3(r).splitAreaColors=y}}}function cG(r){L3(r).splitAreaColors=null}var Rye=["axisLine","axisTickLabel","axisName"],Dye=["splitArea","splitLine","minorSplitLine"],hG=(function(r){Ye(e,r);function e(){var t=r!==null&&r.apply(this,arguments)||this;return t.type=e.type,t.axisPointerClass="CartesianAxisPointer",t}return e.prototype.render=function(t,i,n,a){this.group.removeAll();var s=this._axisGroup;if(this._axisGroup=new mr,this.group.add(this._axisGroup),!!t.get("show")){var o=t.getCoordSysModel(),l=D3(o,t),c=new ol(t,mt({handleAutoShown:function(p){for(var y=o.coordinateSystem.getCartesians(),b=0;b<y.length;b++)if(S3(y[b].getOtherAxis(t.axis).scale))return!0;return!1}},l));se(Rye,c.add,c),this._axisGroup.add(c.getGroup()),se(Dye,function(p){t.get([p,"show"])&&kye[p](this,this._axisGroup,t,o)},this);var f=a&&a.type==="changeAxisOrder"&&a.isInitSort;f||Kw(s,this._axisGroup,t),r.prototype.render.call(this,t,i,n,a)}},e.prototype.remove=function(){cG(this)},e.type="cartesianAxis",e})(Ly),kye={splitLine:function(r,e,t,i){var n=t.axis;if(!n.scale.isBlank()){var a=t.getModel("splitLine"),s=a.getModel("lineStyle"),o=s.get("color"),l=a.get("showMinLine")!==!1,c=a.get("showMaxLine")!==!1;o=xt(o)?o:[o];for(var f=i.coordinateSystem.getRect(),p=n.isHorizontal(),y=0,b=n.getTicksCoords({tickModel:a}),S=[],C=[],E=s.getLineStyle(),P=0;P<b.length;P++){var O=n.toGlobalCoord(b[P].coord);if(!(P===0&&!l||P===b.length-1&&!c)){var B=b[P].tickValue;p?(S[0]=O,S[1]=f.y,C[0]=O,C[1]=f.y+f.height):(S[0]=f.x,S[1]=O,C[0]=f.x+f.width,C[1]=O);var F=y++%o.length,W=new qa({anid:B!=null?"line_"+B:null,autoBatch:!0,shape:{x1:S[0],y1:S[1],x2:C[0],y2:C[1]},style:lr({stroke:o[F]},E),silent:!0});X0(W.shape,E.lineWidth),e.add(W)}}}},minorSplitLine:function(r,e,t,i){var n=t.axis,a=t.getModel("minorSplitLine"),s=a.getModel("lineStyle"),o=i.coordinateSystem.getRect(),l=n.isHorizontal(),c=n.getMinorTicksCoords();if(c.length)for(var f=[],p=[],y=s.getLineStyle(),b=0;b<c.length;b++)for(var S=0;S<c[b].length;S++){var C=n.toGlobalCoord(c[b][S].coord);l?(f[0]=C,f[1]=o.y,p[0]=C,p[1]=o.y+o.height):(f[0]=o.x,f[1]=C,p[0]=o.x+o.width,p[1]=C);var E=new qa({anid:"minor_line_"+c[b][S].tickValue,autoBatch:!0,shape:{x1:f[0],y1:f[1],x2:p[0],y2:p[1]},style:y,silent:!0});X0(E.shape,y.lineWidth),e.add(E)}},splitArea:function(r,e,t,i){uG(r,e,t,i)}},fG=(function(r){Ye(e,r);function e(){var t=r!==null&&r.apply(this,arguments)||this;return t.type=e.type,t}return e.type="xAxis",e})(hG),Lye=(function(r){Ye(e,r);function e(){var t=r!==null&&r.apply(this,arguments)||this;return t.type=fG.type,t}return e.type="yAxis",e})(hG),Oye=(function(r){Ye(e,r);function e(){var t=r!==null&&r.apply(this,arguments)||this;return t.type="grid",t}return e.prototype.render=function(t,i){this.group.removeAll(),t.get("show")&&this.group.add(new li({shape:t.coordinateSystem.getRect(),style:lr({fill:t.get("backgroundColor")},t.getItemStyle()),silent:!0,z2:-1}))},e.type="grid",e})(vn),E5={offset:0};function dG(r){r.registerComponentView(Oye),r.registerComponentModel(uye),r.registerCoordinateSystem("cartesian2d",mye),K0(r,"x",P3,E5),K0(r,"y",P3,E5),r.registerComponentView(fG),r.registerComponentView(Lye),r.registerPreprocessor(function(e){e.xAxis&&e.yAxis&&!e.grid&&(e.grid={})})}function Nye(r){Vr(dG),r.registerSeriesModel(nye),r.registerChartView(lye),r.registerLayout(nS("scatter"))}function Bye(r){r.eachSeriesByType("radar",function(e){var t=e.getData(),i=[],n=e.coordinateSystem;if(n){var a=n.getIndicatorAxes();se(a,function(s,o){t.each(t.mapDimension(a[o].dim),function(l,c){i[c]=i[c]||[];var f=n.dataToPoint(l,o);i[c][o]=I5(f)?f:P5(n)})}),t.each(function(s){var o=Vj(i[s],function(l){return I5(l)})||P5(n);i[s].push(o.slice()),t.setItemLayout(s,i[s])})}})}function I5(r){return!isNaN(r[0])&&!isNaN(r[1])}function P5(r){return[r.cx,r.cy]}function zye(r){var e=r.polar;if(e){xt(e)||(e=[e]);var t=[];se(e,function(i,n){i.indicator?(i.type&&!i.shape&&(i.shape=i.type),r.radar=r.radar||[],xt(r.radar)||(r.radar=[r.radar]),r.radar.push(i)):t.push(i)}),r.polar=t}se(r.series,function(i){i&&i.type==="radar"&&i.polarIndex&&(i.radarIndex=i.polarIndex)})}var Fye=(function(r){Ye(e,r);function e(){var t=r!==null&&r.apply(this,arguments)||this;return t.type=e.type,t}return e.prototype.render=function(t,i,n){var a=t.coordinateSystem,s=this.group,o=t.getData(),l=this._data;function c(y,b){var S=y.getItemVisual(b,"symbol")||"circle";if(S!=="none"){var C=_b(y.getItemVisual(b,"symbolSize")),E=Aa(S,-1,-1,2,2),P=y.getItemVisual(b,"symbolRotate")||0;return E.attr({style:{strokeNoScale:!0},z2:100,scaleX:C[0]/2,scaleY:C[1]/2,rotation:P*Math.PI/180||0}),E}}function f(y,b,S,C,E,P){S.removeAll();for(var O=0;O<b.length-1;O++){var B=c(C,E);B&&(B.__dimIdx=O,y[O]?(B.setPosition(y[O]),Py[P?"initProps":"updateProps"](B,{x:b[O][0],y:b[O][1]},t,E)):B.setPosition(b[O]),S.add(B))}}function p(y){return wt(y,function(b){return[a.cx,a.cy]})}o.diff(l).add(function(y){var b=o.getItemLayout(y);if(b){var S=new Rs,C=new ks,E={shape:{points:b}};S.shape.points=p(b),C.shape.points=p(b),An(S,E,t,y),An(C,E,t,y);var P=new mr,O=new mr;P.add(C),P.add(S),P.add(O),f(C.shape.points,b,O,o,y,!0),o.setItemGraphicEl(y,P)}}).update(function(y,b){var S=l.getItemGraphicEl(b),C=S.childAt(0),E=S.childAt(1),P=S.childAt(2),O={shape:{points:o.getItemLayout(y)}};O.shape.points&&(f(C.shape.points,O.shape.points,P,o,y,!1),Dh(E),Dh(C),vi(C,O,t),vi(E,O,t),o.setItemGraphicEl(y,S))}).remove(function(y){s.remove(l.getItemGraphicEl(y))}).execute(),o.eachItemGraphicEl(function(y,b){var S=o.getItemModel(b),C=y.childAt(0),E=y.childAt(1),P=y.childAt(2),O=o.getItemVisual(b,"style"),B=O.fill;s.add(y),C.useStyle(lr(S.getModel("lineStyle").getLineStyle(),{fill:"none",stroke:B})),ts(C,S,"lineStyle"),ts(E,S,"areaStyle");var F=S.getModel("areaStyle"),W=F.isEmpty()&&F.parentModel.isEmpty();E.ignore=W,se(["emphasis","select","blur"],function(Q){var ee=S.getModel([Q,"areaStyle"]),te=ee.isEmpty()&&ee.parentModel.isEmpty();E.ensureState(Q).ignore=te&&W}),E.useStyle(lr(F.getAreaStyle(),{fill:B,opacity:.7,decal:O.decal}));var $=S.getModel("emphasis"),q=$.getModel("itemStyle").getItemStyle();P.eachChild(function(Q){if(Q instanceof go){var ee=Q.style;Q.useStyle(mt({image:ee.image,x:ee.x,y:ee.y,width:ee.width,height:ee.height},O))}else Q.useStyle(O),Q.setColor(B),Q.style.strokeNoScale=!0;var te=Q.ensureState("emphasis");te.style=hr(q);var ae=o.getStore().get(o.getDimensionIndex(Q.__dimIdx),b);(ae==null||isNaN(ae))&&(ae=""),rs(Q,fo(S),{labelFetcher:o.hostModel,labelDataIndex:b,labelDimIndex:Q.__dimIdx,defaultText:ae,inheritColor:B,defaultOpacity:O.opacity})}),Hn(y,$.get("focus"),$.get("blurScope"),$.get("disabled"))}),this._data=o},e.prototype.remove=function(){this.group.removeAll(),this._data=null},e.type="radar",e})(Fi),Vye=(function(r){Ye(e,r);function e(){var t=r!==null&&r.apply(this,arguments)||this;return t.type=e.type,t.hasSymbolVisual=!0,t}return e.prototype.init=function(t){r.prototype.init.apply(this,arguments),this.legendVisualProvider=new oS(Xt(this.getData,this),Xt(this.getRawData,this))},e.prototype.getInitialData=function(t,i){return Sb(this,{generateCoord:"indicator_",generateCoordCount:1/0})},e.prototype.formatTooltip=function(t,i,n){var a=this.getData(),s=this.coordinateSystem,o=s.getIndicatorAxes(),l=this.getData().getName(t),c=l===""?this.name:l,f=l9(this,t);return po("section",{header:c,sortBlocks:!0,blocks:wt(o,function(p){var y=a.get(a.mapDimension(p.dim),t);return po("nameValue",{markerType:"subItem",markerColor:f,name:p.name,value:y,sortParam:y})})})},e.prototype.getTooltipPosition=function(t){if(t!=null){for(var i=this.getData(),n=this.coordinateSystem,a=i.getValues(wt(n.dimensions,function(c){return i.mapDimension(c)}),t),s=0,o=a.length;s<o;s++)if(!isNaN(a[s])){var l=n.getIndicatorAxes();return n.coordToPoint(l[s].dataToCoord(a[s]),s)}}},e.type="series.radar",e.dependencies=["radar"],e.defaultOption={z:2,colorBy:"data",coordinateSystem:"radar",legendHoverLink:!0,radarIndex:0,lineStyle:{width:2,type:"solid",join:"round"},label:{position:"top"},symbolSize:8},e})(Xi),Yx=oG.value;function e2(r,e){return lr({show:e},r)}var Uye=(function(r){Ye(e,r);function e(){var t=r!==null&&r.apply(this,arguments)||this;return t.type=e.type,t}return e.prototype.optionUpdated=function(){var t=this.get("boundaryGap"),i=this.get("splitNumber"),n=this.get("scale"),a=this.get("axisLine"),s=this.get("axisTick"),o=this.get("axisLabel"),l=this.get("axisName"),c=this.get(["axisName","show"]),f=this.get(["axisName","formatter"]),p=this.get("axisNameGap"),y=this.get("triggerEvent"),b=wt(this.get("indicator")||[],function(S){S.max!=null&&S.max>0&&!S.min?S.min=0:S.min!=null&&S.min<0&&!S.max&&(S.max=0);var C=l;S.color!=null&&(C=lr({color:S.color},l));var E=Cr(hr(S),{boundaryGap:t,splitNumber:i,scale:n,axisLine:a,axisTick:s,axisLabel:o,name:S.text,showName:c,nameLocation:"end",nameGap:p,nameTextStyle:C,triggerEvent:y},!1);if($t(f)){var P=E.name;E.name=f.replace("{value}",P??"")}else sr(f)&&(E.name=f(E.name,E));var O=new Si(E,null,this.ecModel);return ha(O,wb.prototype),O.mainType="radar",O.componentIndex=this.componentIndex,O},this);this._indicatorModels=b},e.prototype.getIndicatorModels=function(){return this._indicatorModels},e.type="radar",e.defaultOption={z:0,center:["50%","50%"],radius:"75%",startAngle:90,axisName:{show:!0},boundaryGap:[0,0],splitNumber:5,axisNameGap:15,scale:!1,shape:"polygon",axisLine:Cr({lineStyle:{color:"#bbb"}},Yx.axisLine),axisLabel:e2(Yx.axisLabel,!1),axisTick:e2(Yx.axisTick,!1),splitLine:e2(Yx.splitLine,!0),splitArea:e2(Yx.splitArea,!0),indicator:[]},e})(Wr),Hye=["axisLine","axisTickLabel","axisName"],jye=(function(r){Ye(e,r);function e(){var t=r!==null&&r.apply(this,arguments)||this;return t.type=e.type,t}return e.prototype.render=function(t,i,n){var a=this.group;a.removeAll(),this._buildAxes(t),this._buildSplitLineAndArea(t)},e.prototype._buildAxes=function(t){var i=t.coordinateSystem,n=i.getIndicatorAxes(),a=wt(n,function(s){var o=s.model.get("showName")?s.name:"",l=new ol(s.model,{axisName:o,position:[i.cx,i.cy],rotation:s.angle,labelDirection:-1,tickDirection:-1,nameDirection:1});return l});se(a,function(s){se(Hye,s.add,s),this.group.add(s.getGroup())},this)},e.prototype._buildSplitLineAndArea=function(t){var i=t.coordinateSystem,n=i.getIndicatorAxes();if(!n.length)return;var a=t.get("shape"),s=t.getModel("splitLine"),o=t.getModel("splitArea"),l=s.getModel("lineStyle"),c=o.getModel("areaStyle"),f=s.get("show"),p=o.get("show"),y=l.get("color"),b=c.get("color"),S=xt(y)?y:[y],C=xt(b)?b:[b],E=[],P=[];function O(Ae,me,De){var Fe=De%me.length;return Ae[Fe]=Ae[Fe]||[],Fe}if(a==="circle")for(var B=n[0].getTicksCoords(),F=i.cx,W=i.cy,$=0;$<B.length;$++){if(f){var q=O(E,S,$);E[q].push(new $f({shape:{cx:F,cy:W,r:B[$].coord}}))}if(p&&$<B.length-1){var q=O(P,C,$);P[q].push(new sb({shape:{cx:F,cy:W,r0:B[$].coord,r:B[$+1].coord}}))}}else for(var Q,ee=wt(n,function(Ae,me){var De=Ae.getTicksCoords();return Q=Q==null?De.length-1:Math.min(De.length-1,Q),wt(De,function(Fe){return i.coordToPoint(Fe.coord,me)})}),te=[],$=0;$<=Q;$++){for(var ae=[],de=0;de<n.length;de++)ae.push(ee[de][$]);if(ae[0]&&ae.push(ae[0].slice()),f){var q=O(E,S,$);E[q].push(new ks({shape:{points:ae}}))}if(p&&te){var q=O(P,C,$-1);P[q].push(new Rs({shape:{points:ae.concat(te)}}))}te=ae.slice().reverse()}var ve=l.getLineStyle(),ye=c.getAreaStyle();se(P,function(Ae,me){this.group.add(vu(Ae,{style:lr({stroke:"none",fill:C[me%C.length]},ye),silent:!0}))},this),se(E,function(Ae,me){this.group.add(vu(Ae,{style:lr({fill:"none",stroke:S[me%S.length]},ve),silent:!0}))},this)},e.type="radar",e})(vn),$ye=(function(r){Ye(e,r);function e(t,i,n){var a=r.call(this,t,i,n)||this;return a.type="value",a.angle=0,a.name="",a}return e})(Pc),Wye=(function(){function r(e,t,i){this.dimensions=[],this._model=e,this._indicatorAxes=wt(e.getIndicatorModels(),function(n,a){var s="indicator_"+a,o=new $ye(s,new pp);return o.name=n.get("name"),o.model=n,n.axis=o,this.dimensions.push(s),o},this),this.resize(e,i)}return r.prototype.getIndicatorAxes=function(){return this._indicatorAxes},r.prototype.dataToPoint=function(e,t){var i=this._indicatorAxes[t];return this.coordToPoint(i.dataToCoord(e),t)},r.prototype.coordToPoint=function(e,t){var i=this._indicatorAxes[t],n=i.angle,a=this.cx+e*Math.cos(n),s=this.cy-e*Math.sin(n);return[a,s]},r.prototype.pointToData=function(e){var t=e[0]-this.cx,i=e[1]-this.cy,n=Math.sqrt(t*t+i*i);t/=n,i/=n;for(var a=Math.atan2(-i,t),s=1/0,o,l=-1,c=0;c<this._indicatorAxes.length;c++){var f=this._indicatorAxes[c],p=Math.abs(a-f.angle);p<s&&(o=f,l=c,s=p)}return[l,+(o&&o.coordToData(n))]},r.prototype.resize=function(e,t){var i=e.get("center"),n=t.getWidth(),a=t.getHeight(),s=Math.min(n,a)/2;this.cx=Vt(i[0],n),this.cy=Vt(i[1],a),this.startAngle=e.get("startAngle")*Math.PI/180;var o=e.get("radius");($t(o)||di(o))&&(o=[0,o]),this.r0=Vt(o[0],s),this.r=Vt(o[1],s),se(this._indicatorAxes,function(l,c){l.setExtent(this.r0,this.r);var f=this.startAngle+c*Math.PI*2/this._indicatorAxes.length;f=Math.atan2(Math.sin(f),Math.cos(f)),l.angle=f},this)},r.prototype.update=function(e,t){var i=this._indicatorAxes,n=this._model;se(i,function(o){o.scale.setExtent(1/0,-1/0)}),e.eachSeriesByType("radar",function(o,l){if(!(o.get("coordinateSystem")!=="radar"||e.getComponent("radar",o.get("radarIndex"))!==n)){var c=o.getData();se(i,function(f){f.scale.unionExtentFromData(c,c.mapDimension(f.dim))})}},this);var a=n.get("splitNumber"),s=new pp;s.setExtent(0,a),s.setInterval(1),se(i,function(o,l){sG(o.scale,o.model,s)})},r.prototype.convertToPixel=function(e,t,i){return console.warn("Not implemented."),null},r.prototype.convertFromPixel=function(e,t,i){return console.warn("Not implemented."),null},r.prototype.containPoint=function(e){return console.warn("Not implemented."),!1},r.create=function(e,t){var i=[];return e.eachComponent("radar",function(n){var a=new r(n,e,t);i.push(a),n.coordinateSystem=a}),e.eachSeriesByType("radar",function(n){n.get("coordinateSystem")==="radar"&&(n.coordinateSystem=i[n.get("radarIndex")||0])}),i},r.dimensions=[],r})();function Gye(r){r.registerCoordinateSystem("radar",Wye),r.registerComponentModel(Uye),r.registerComponentView(jye),r.registerVisual({seriesType:"radar",reset:function(e){var t=e.getData();t.each(function(i){t.setItemVisual(i,"legendIcon","roundRect")}),t.setVisual("legendIcon","roundRect")}})}function Xye(r){Vr(Gye),r.registerChartView(Fye),r.registerSeriesModel(Vye),r.registerLayout(Bye),r.registerProcessor(aS("radar")),r.registerPreprocessor(zye)}var R5="\0_ec_interaction_mutex";function Zye(r,e,t){var i=BL(r);i[e]=t}function qye(r,e,t){var i=BL(r),n=i[e];n===t&&(i[e]=null)}function D5(r,e){return!!BL(r)[e]}function BL(r){return r[R5]||(r[R5]={})}Lh({type:"takeGlobalCursor",event:"globalCursorTaken",update:"update"},ca);var sS=(function(r){Ye(e,r);function e(t){var i=r.call(this)||this;i._zr=t;var n=Xt(i._mousedownHandler,i),a=Xt(i._mousemoveHandler,i),s=Xt(i._mouseupHandler,i),o=Xt(i._mousewheelHandler,i),l=Xt(i._pinchHandler,i);return i.enable=function(c,f){this.disable(),this._opt=lr(hr(f)||{},{zoomOnMouseWheel:!0,moveOnMouseMove:!0,moveOnMouseWheel:!1,preventDefaultMouseMove:!0}),c==null&&(c=!0),(c===!0||c==="move"||c==="pan")&&(t.on("mousedown",n),t.on("mousemove",a),t.on("mouseup",s)),(c===!0||c==="scale"||c==="zoom")&&(t.on("mousewheel",o),t.on("pinch",l))},i.disable=function(){t.off("mousedown",n),t.off("mousemove",a),t.off("mouseup",s),t.off("mousewheel",o),t.off("pinch",l)},i}return e.prototype.isDragging=function(){return this._dragging},e.prototype.isPinching=function(){return this._pinching},e.prototype.setPointerChecker=function(t){this.pointerChecker=t},e.prototype.dispose=function(){this.disable()},e.prototype._mousedownHandler=function(t){if(!l4(t)){for(var i=t.target;i;){if(i.draggable)return;i=i.__hostTarget||i.parent}var n=t.offsetX,a=t.offsetY;this.pointerChecker&&this.pointerChecker(t,n,a)&&(this._x=n,this._y=a,this._dragging=!0)}},e.prototype._mousemoveHandler=function(t){if(!(!this._dragging||!H2("moveOnMouseMove",t,this._opt)||t.gestureEvent==="pinch"||D5(this._zr,"globalPan"))){var i=t.offsetX,n=t.offsetY,a=this._x,s=this._y,o=i-a,l=n-s;this._x=i,this._y=n,this._opt.preventDefaultMouseMove&&up(t.event),pG(this,"pan","moveOnMouseMove",t,{dx:o,dy:l,oldX:a,oldY:s,newX:i,newY:n,isAvailableBehavior:null})}},e.prototype._mouseupHandler=function(t){l4(t)||(this._dragging=!1)},e.prototype._mousewheelHandler=function(t){var i=H2("zoomOnMouseWheel",t,this._opt),n=H2("moveOnMouseWheel",t,this._opt),a=t.wheelDelta,s=Math.abs(a),o=t.offsetX,l=t.offsetY;if(!(a===0||!i&&!n)){if(i){var c=s>3?1.4:s>1?1.2:1.1,f=a>0?c:1/c;UI(this,"zoom","zoomOnMouseWheel",t,{scale:f,originX:o,originY:l,isAvailableBehavior:null})}if(n){var p=Math.abs(a),y=(a>0?1:-1)*(p>3?.4:p>1?.15:.05);UI(this,"scrollMove","moveOnMouseWheel",t,{scrollDelta:y,originX:o,originY:l,isAvailableBehavior:null})}}},e.prototype._pinchHandler=function(t){if(!D5(this._zr,"globalPan")){var i=t.pinchScale>1?1.1:1/1.1;UI(this,"zoom",null,t,{scale:i,originX:t.pinchX,originY:t.pinchY,isAvailableBehavior:null})}},e})(Cc);function UI(r,e,t,i,n){r.pointerChecker&&r.pointerChecker(i,n.originX,n.originY)&&(up(i.event),pG(r,e,t,i,n))}function pG(r,e,t,i,n){n.isAvailableBehavior=Xt(H2,null,t,i),r.trigger(e,n)}function H2(r,e,t){var i=t[r];return!r||i&&(!$t(i)||e.event[i+"Key"])}function zL(r,e,t){var i=r.target;i.x+=e,i.y+=t,i.dirty()}function FL(r,e,t,i){var n=r.target,a=r.zoomLimit,s=r.zoom=r.zoom||1;if(s*=e,a){var o=a.min||0,l=a.max||1/0;s=Math.max(Math.min(l,s),o)}var c=s/r.zoom;r.zoom=s,n.x-=(t-n.x)*(c-1),n.y-=(i-n.y)*(c-1),n.scaleX*=c,n.scaleY*=c,n.dirty()}var Yye={axisPointer:1,tooltip:1,brush:1};function aM(r,e,t){var i=e.getComponentByElement(r.topTarget),n=i&&i.coordinateSystem;return i&&i!==t&&!Yye.hasOwnProperty(i.mainType)&&n&&n.model!==t}function gG(r){if($t(r)){var e=new DOMParser;r=e.parseFromString(r,"text/xml")}var t=r;for(t.nodeType===9&&(t=t.firstChild);t.nodeName.toLowerCase()!=="svg"||t.nodeType!==1;)t=t.nextSibling;return t}var HI,ZA={fill:"fill",stroke:"stroke","stroke-width":"lineWidth",opacity:"opacity","fill-opacity":"fillOpacity","stroke-opacity":"strokeOpacity","stroke-dasharray":"lineDash","stroke-dashoffset":"lineDashOffset","stroke-linecap":"lineCap","stroke-linejoin":"lineJoin","stroke-miterlimit":"miterLimit","font-family":"fontFamily","font-size":"fontSize","font-style":"fontStyle","font-weight":"fontWeight","text-anchor":"textAlign",visibility:"visibility",display:"display"},k5=qr(ZA),qA={"alignment-baseline":"textBaseline","stop-color":"stopColor"},L5=qr(qA),Kye=(function(){function r(){this._defs={},this._root=null}return r.prototype.parse=function(e,t){t=t||{};var i=gG(e);this._defsUsePending=[];var n=new mr;this._root=n;var a=[],s=i.getAttribute("viewBox")||"",o=parseFloat(i.getAttribute("width")||t.width),l=parseFloat(i.getAttribute("height")||t.height);isNaN(o)&&(o=null),isNaN(l)&&(l=null),fu(i,n,null,!0,!1);for(var c=i.firstChild;c;)this._parseNode(c,n,a,null,!1,!1),c=c.nextSibling;e_e(this._defs,this._defsUsePending),this._defsUsePending=[];var f,p;if(s){var y=oM(s);y.length>=4&&(f={x:parseFloat(y[0]||0),y:parseFloat(y[1]||0),width:parseFloat(y[2]),height:parseFloat(y[3])})}if(f&&o!=null&&l!=null&&(p=mG(f,{x:0,y:0,width:o,height:l}),!t.ignoreViewBox)){var b=n;n=new mr,n.add(b),b.scaleX=b.scaleY=p.scale,b.x=p.x,b.y=p.y}return!t.ignoreRootClip&&o!=null&&l!=null&&n.setClipPath(new li({shape:{x:0,y:0,width:o,height:l}})),{root:n,width:o,height:l,viewBoxRect:f,viewBoxTransform:p,named:a}},r.prototype._parseNode=function(e,t,i,n,a,s){var o=e.nodeName.toLowerCase(),l,c=n;if(o==="defs"&&(a=!0),o==="text"&&(s=!0),o==="defs"||o==="switch")l=t;else{if(!a){var f=HI[o];if(f&&Yt(HI,o)){l=f.call(this,e,t);var p=e.getAttribute("name");if(p){var y={name:p,namedFrom:null,svgNodeTagLower:o,el:l};i.push(y),o==="g"&&(c=y)}else n&&i.push({name:n.name,namedFrom:n,svgNodeTagLower:o,el:l});t.add(l)}}var b=O5[o];if(b&&Yt(O5,o)){var S=b.call(this,e),C=e.getAttribute("id");C&&(this._defs[C]=S)}}if(l&&l.isGroup)for(var E=e.firstChild;E;)E.nodeType===1?this._parseNode(E,l,i,c,a,s):E.nodeType===3&&s&&this._parseText(E,l),E=E.nextSibling},r.prototype._parseText=function(e,t){var i=new G0({style:{text:e.textContent},silent:!0,x:this._textX||0,y:this._textY||0});oc(t,i),fu(e,i,this._defsUsePending,!1,!1),Qye(i,t);var n=i.style,a=n.fontSize;a&&a<9&&(n.fontSize=9,i.scaleX*=a/9,i.scaleY*=a/9);var s=(n.fontSize||n.fontFamily)&&[n.fontStyle,n.fontWeight,(n.fontSize||12)+"px",n.fontFamily||"sans-serif"].join(" ");n.font=s;var o=i.getBoundingRect();return this._textX+=o.width,t.add(i),i},r.internalField=(function(){HI={g:function(e,t){var i=new mr;return oc(t,i),fu(e,i,this._defsUsePending,!1,!1),i},rect:function(e,t){var i=new li;return oc(t,i),fu(e,i,this._defsUsePending,!1,!1),i.setShape({x:parseFloat(e.getAttribute("x")||"0"),y:parseFloat(e.getAttribute("y")||"0"),width:parseFloat(e.getAttribute("width")||"0"),height:parseFloat(e.getAttribute("height")||"0")}),i.silent=!0,i},circle:function(e,t){var i=new $f;return oc(t,i),fu(e,i,this._defsUsePending,!1,!1),i.setShape({cx:parseFloat(e.getAttribute("cx")||"0"),cy:parseFloat(e.getAttribute("cy")||"0"),r:parseFloat(e.getAttribute("r")||"0")}),i.silent=!0,i},line:function(e,t){var i=new qa;return oc(t,i),fu(e,i,this._defsUsePending,!1,!1),i.setShape({x1:parseFloat(e.getAttribute("x1")||"0"),y1:parseFloat(e.getAttribute("y1")||"0"),x2:parseFloat(e.getAttribute("x2")||"0"),y2:parseFloat(e.getAttribute("y2")||"0")}),i.silent=!0,i},ellipse:function(e,t){var i=new Zw;return oc(t,i),fu(e,i,this._defsUsePending,!1,!1),i.setShape({cx:parseFloat(e.getAttribute("cx")||"0"),cy:parseFloat(e.getAttribute("cy")||"0"),rx:parseFloat(e.getAttribute("rx")||"0"),ry:parseFloat(e.getAttribute("ry")||"0")}),i.silent=!0,i},polygon:function(e,t){var i=e.getAttribute("points"),n;i&&(n=z5(i));var a=new Rs({shape:{points:n||[]},silent:!0});return oc(t,a),fu(e,a,this._defsUsePending,!1,!1),a},polyline:function(e,t){var i=e.getAttribute("points"),n;i&&(n=z5(i));var a=new ks({shape:{points:n||[]},silent:!0});return oc(t,a),fu(e,a,this._defsUsePending,!1,!1),a},image:function(e,t){var i=new go;return oc(t,i),fu(e,i,this._defsUsePending,!1,!1),i.setStyle({image:e.getAttribute("xlink:href")||e.getAttribute("href"),x:+e.getAttribute("x"),y:+e.getAttribute("y"),width:+e.getAttribute("width"),height:+e.getAttribute("height")}),i.silent=!0,i},text:function(e,t){var i=e.getAttribute("x")||"0",n=e.getAttribute("y")||"0",a=e.getAttribute("dx")||"0",s=e.getAttribute("dy")||"0";this._textX=parseFloat(i)+parseFloat(a),this._textY=parseFloat(n)+parseFloat(s);var o=new mr;return oc(t,o),fu(e,o,this._defsUsePending,!1,!0),o},tspan:function(e,t){var i=e.getAttribute("x"),n=e.getAttribute("y");i!=null&&(this._textX=parseFloat(i)),n!=null&&(this._textY=parseFloat(n));var a=e.getAttribute("dx")||"0",s=e.getAttribute("dy")||"0",o=new mr;return oc(t,o),fu(e,o,this._defsUsePending,!1,!0),this._textX+=parseFloat(a),this._textY+=parseFloat(s),o},path:function(e,t){var i=e.getAttribute("d")||"",n=a7(i);return oc(t,n),fu(e,n,this._defsUsePending,!1,!1),n.silent=!0,n}}})(),r})(),O5={lineargradient:function(r){var e=parseInt(r.getAttribute("x1")||"0",10),t=parseInt(r.getAttribute("y1")||"0",10),i=parseInt(r.getAttribute("x2")||"10",10),n=parseInt(r.getAttribute("y2")||"0",10),a=new ub(e,t,i,n);return N5(r,a),B5(r,a),a},radialgradient:function(r){var e=parseInt(r.getAttribute("cx")||"0",10),t=parseInt(r.getAttribute("cy")||"0",10),i=parseInt(r.getAttribute("r")||"0",10),n=new Fk(e,t,i);return N5(r,n),B5(r,n),n}};function N5(r,e){var t=r.getAttribute("gradientUnits");t==="userSpaceOnUse"&&(e.global=!0)}function B5(r,e){for(var t=r.firstChild;t;){if(t.nodeType===1&&t.nodeName.toLocaleLowerCase()==="stop"){var i=t.getAttribute("offset"),n=void 0;i&&i.indexOf("%")>0?n=parseInt(i,10)/100:i?n=parseFloat(i):n=0;var a={};vG(t,a,a);var s=a.stopColor||t.getAttribute("stop-color")||"#000000";e.colorStops.push({offset:n,color:s})}t=t.nextSibling}}function oc(r,e){r&&r.__inheritedStyle&&(e.__inheritedStyle||(e.__inheritedStyle={}),lr(e.__inheritedStyle,r.__inheritedStyle))}function z5(r){for(var e=oM(r),t=[],i=0;i<e.length;i+=2){var n=parseFloat(e[i]),a=parseFloat(e[i+1]);t.push([n,a])}return t}function fu(r,e,t,i,n){var a=e,s=a.__inheritedStyle=a.__inheritedStyle||{},o={};r.nodeType===1&&(i_e(r,e),vG(r,s,o),i||n_e(r,s,o)),a.style=a.style||{},s.fill!=null&&(a.style.fill=F5(a,"fill",s.fill,t)),s.stroke!=null&&(a.style.stroke=F5(a,"stroke",s.stroke,t)),se(["lineWidth","opacity","fillOpacity","strokeOpacity","miterLimit","fontSize"],function(l){s[l]!=null&&(a.style[l]=parseFloat(s[l]))}),se(["lineDashOffset","lineCap","lineJoin","fontWeight","fontFamily","fontStyle","textAlign"],function(l){s[l]!=null&&(a.style[l]=s[l])}),n&&(a.__selfStyle=o),s.lineDash&&(a.style.lineDash=wt(oM(s.lineDash),function(l){return parseFloat(l)})),(s.visibility==="hidden"||s.visibility==="collapse")&&(a.invisible=!0),s.display==="none"&&(a.ignore=!0)}function Qye(r,e){var t=e.__selfStyle;if(t){var i=t.textBaseline,n=i;!i||i==="auto"||i==="baseline"?n="alphabetic":i==="before-edge"||i==="text-before-edge"?n="top":i==="after-edge"||i==="text-after-edge"?n="bottom":(i==="central"||i==="mathematical")&&(n="middle"),r.style.textBaseline=n}var a=e.__inheritedStyle;if(a){var s=a.textAlign,o=s;s&&(s==="middle"&&(o="center"),r.style.textAlign=o)}}var Jye=/^url\(\s*#(.*?)\)/;function F5(r,e,t,i){var n=t&&t.match(Jye);if(n){var a=mc(n[1]);i.push([r,e,a]);return}return t==="none"&&(t=null),t}function e_e(r,e){for(var t=0;t<e.length;t++){var i=e[t];i[0].style[i[1]]=r[i[2]]}}var t_e=/-?([0-9]*\.)?[0-9]+([eE]-?[0-9]+)?/g;function oM(r){return r.match(t_e)||[]}var r_e=/(translate|scale|rotate|skewX|skewY|matrix)\(([\-\s0-9\.eE,]*)\)/g,jI=Math.PI/180;function i_e(r,e){var t=r.getAttribute("transform");if(t){t=t.replace(/,/g," ");var i=[],n=null;t.replace(r_e,function(p,y,b){return i.push(y,b),""});for(var a=i.length-1;a>0;a-=2){var s=i[a],o=i[a-1],l=oM(s);switch(n=n||kl(),o){case"translate":Ph(n,n,[parseFloat(l[0]),parseFloat(l[1]||"0")]);break;case"scale":EC(n,n,[parseFloat(l[0]),parseFloat(l[1]||l[0])]);break;case"rotate":Zg(n,n,-parseFloat(l[0])*jI,[parseFloat(l[1]||"0"),parseFloat(l[2]||"0")]);break;case"skewX":var c=Math.tan(parseFloat(l[0])*jI);zf(n,[1,0,c,1,0,0],n);break;case"skewY":var f=Math.tan(parseFloat(l[0])*jI);zf(n,[1,f,0,1,0,0],n);break;case"matrix":n[0]=parseFloat(l[0]),n[1]=parseFloat(l[1]),n[2]=parseFloat(l[2]),n[3]=parseFloat(l[3]),n[4]=parseFloat(l[4]),n[5]=parseFloat(l[5]);break}}e.setLocalTransform(n)}}var V5=/([^\s:;]+)\s*:\s*([^:;]+)/g;function vG(r,e,t){var i=r.getAttribute("style");if(i){V5.lastIndex=0;for(var n;(n=V5.exec(i))!=null;){var a=n[1],s=Yt(ZA,a)?ZA[a]:null;s&&(e[s]=n[2]);var o=Yt(qA,a)?qA[a]:null;o&&(t[o]=n[2])}}}function n_e(r,e,t){for(var i=0;i<k5.length;i++){var n=k5[i],a=r.getAttribute(n);a!=null&&(e[ZA[n]]=a)}for(var i=0;i<L5.length;i++){var n=L5[i],a=r.getAttribute(n);a!=null&&(t[qA[n]]=a)}}function mG(r,e){var t=e.width/r.width,i=e.height/r.height,n=Math.min(t,i);return{scale:n,x:-(r.x+r.width/2)*n+(e.x+e.width/2),y:-(r.y+r.height/2)*n+(e.y+e.height/2)}}function a_e(r,e){var t=new Kye;return t.parse(r,e)}var o_e=Qt(["rect","circle","line","ellipse","polygon","polyline","path","text","tspan","g"]),s_e=(function(){function r(e,t){this.type="geoSVG",this._usedGraphicMap=Qt(),this._freedGraphics=[],this._mapName=e,this._parsedXML=gG(t)}return r.prototype.load=function(){var e=this._firstGraphic;if(!e){e=this._firstGraphic=this._buildGraphic(this._parsedXML),this._freedGraphics.push(e),this._boundingRect=this._firstGraphic.boundingRect.clone();var t=u_e(e.named),i=t.regions,n=t.regionsMap;this._regions=i,this._regionsMap=n}return{boundingRect:this._boundingRect,regions:this._regions,regionsMap:this._regionsMap}},r.prototype._buildGraphic=function(e){var t,i;try{t=e&&a_e(e,{ignoreViewBox:!0,ignoreRootClip:!0})||{},i=t.root,Is(i!=null)}catch(E){throw new Error(`Invalid svg format
`+E.message)}var n=new mr;n.add(i),n.isGeoSVGGraphicRoot=!0;var a=t.width,s=t.height,o=t.viewBoxRect,l=this._boundingRect;if(!l){var c=void 0,f=void 0,p=void 0,y=void 0;if(a!=null?(c=0,p=a):o&&(c=o.x,p=o.width),s!=null?(f=0,y=s):o&&(f=o.y,y=o.height),c==null||f==null){var b=i.getBoundingRect();c==null&&(c=b.x,p=b.width),f==null&&(f=b.y,y=b.height)}l=this._boundingRect=new Dr(c,f,p,y)}if(o){var S=mG(o,l);i.scaleX=i.scaleY=S.scale,i.x=S.x,i.y=S.y}n.setClipPath(new li({shape:l.plain()}));var C=[];return se(t.named,function(E){o_e.get(E.svgNodeTagLower)!=null&&(C.push(E),l_e(E.el))}),{root:n,boundingRect:l,named:C}},r.prototype.useGraphic=function(e){var t=this._usedGraphicMap,i=t.get(e);return i||(i=this._freedGraphics.pop()||this._buildGraphic(this._parsedXML),t.set(e,i),i)},r.prototype.freeGraphic=function(e){var t=this._usedGraphicMap,i=t.get(e);i&&(t.removeKey(e),this._freedGraphics.push(i))},r})();function l_e(r){r.silent=!1,r.isGroup&&r.traverse(function(e){e.silent=!1})}function u_e(r){var e=[],t=Qt();return se(r,function(i){if(i.namedFrom==null){var n=new qge(i.name,i.el);e.push(n),t.set(i.name,n)}}),{regions:e,regionsMap:t}}var O3=[126,25],U5="南海诸岛",Em=[[[0,3.5],[7,11.2],[15,11.9],[30,7],[42,.7],[52,.7],[56,7.7],[59,.7],[64,.7],[64,0],[5,0],[0,3.5]],[[13,16.1],[19,14.7],[16,21.7],[11,23.1],[13,16.1]],[[12,32.2],[14,38.5],[15,38.5],[13,32.2],[12,32.2]],[[16,47.6],[12,53.2],[13,53.2],[18,47.6],[16,47.6]],[[6,64.4],[8,70],[9,70],[8,64.4],[6,64.4]],[[23,82.6],[29,79.8],[30,79.8],[25,82.6],[23,82.6]],[[37,70.7],[43,62.3],[44,62.3],[39,70.7],[37,70.7]],[[48,51.1],[51,45.5],[53,45.5],[50,51.1],[48,51.1]],[[51,35],[51,28.7],[53,28.7],[53,35],[51,35]],[[52,22.4],[55,17.5],[56,17.5],[53,22.4],[52,22.4]],[[58,12.6],[62,7],[63,7],[60,12.6],[58,12.6]],[[0,3.5],[0,93.1],[64,93.1],[64,0],[63,0],[63,92.4],[1,92.4],[1,3.5],[0,3.5]]];for(var Cm=0;Cm<Em.length;Cm++)for(var K_=0;K_<Em[Cm].length;K_++)Em[Cm][K_][0]/=10.5,Em[Cm][K_][1]/=-10.5/.75,Em[Cm][K_][0]+=O3[0],Em[Cm][K_][1]+=O3[1];function c_e(r,e){if(r==="china"){for(var t=0;t<e.length;t++)if(e[t].name===U5)return;e.push(new dW(U5,wt(Em,function(i){return{type:"polygon",exterior:i}}),O3))}}var h_e={南海诸岛:[32,80],广东:[0,-10],香港:[10,5],澳门:[-10,10],天津:[5,5]};function f_e(r,e){if(r==="china"){var t=h_e[e.name];if(t){var i=e.getCenter();i[0]+=t[0]/10.5,i[1]+=-t[1]/(10.5/.75),e.setCenter(i)}}}var d_e=[[[123.45165252685547,25.73527164402261],[123.49731445312499,25.73527164402261],[123.49731445312499,25.750734064600884],[123.45165252685547,25.750734064600884],[123.45165252685547,25.73527164402261]]];function p_e(r,e){r==="china"&&e.name==="台湾"&&e.geometries.push({type:"polygon",exterior:d_e[0]})}var g_e="name",v_e=(function(){function r(e,t,i){this.type="geoJSON",this._parsedMap=Qt(),this._mapName=e,this._specialAreas=i,this._geoJSON=y_e(t)}return r.prototype.load=function(e,t){t=t||g_e;var i=this._parsedMap.get(t);if(!i){var n=this._parseToRegions(t);i=this._parsedMap.set(t,{regions:n,boundingRect:m_e(n)})}var a=Qt(),s=[];return se(i.regions,function(o){var l=o.name;e&&Yt(e,l)&&(o=o.cloneShallow(l=e[l])),s.push(o),a.set(l,o)}),{regions:s,boundingRect:i.boundingRect||new Dr(0,0,0,0),regionsMap:a}},r.prototype._parseToRegions=function(e){var t=this._mapName,i=this._geoJSON,n;try{n=i?A3(i,e):[]}catch(a){throw new Error(`Invalid geoJson format
`+a.message)}return c_e(t,n),se(n,function(a){var s=a.name;f_e(t,a),p_e(t,a);var o=this._specialAreas&&this._specialAreas[s];o&&a.transformTo(o.left,o.top,o.width,o.height)},this),n},r.prototype.getMapForUser=function(){return{geoJson:this._geoJSON,geoJSON:this._geoJSON,specialAreas:this._specialAreas}},r})();function m_e(r){for(var e,t=0;t<r.length;t++){var i=r[t].getBoundingRect();e=e||i.clone(),e.union(i)}return e}function y_e(r){return $t(r)?typeof JSON<"u"&&JSON.parse?JSON.parse(r):new Function("return ("+r+");")():r}var Kx=Qt();const gp={registerMap:function(r,e,t){if(e.svg){var i=new s_e(r,e.svg);Kx.set(r,i)}else{var n=e.geoJson||e.geoJSON;n&&!e.features?t=e.specialAreas:n=e;var i=new v_e(r,n,t);Kx.set(r,i)}},getGeoResource:function(r){return Kx.get(r)},getMapForUser:function(r){var e=Kx.get(r);return e&&e.type==="geoJSON"&&e.getMapForUser()},load:function(r,e,t){var i=Kx.get(r);if(i)return i.load(e,t)}};var VL=["rect","circle","line","ellipse","polygon","polyline","path"],__e=Qt(VL),b_e=Qt(VL.concat(["g"])),x_e=Qt(VL.concat(["g"])),yG=fi();function t2(r){var e=r.getItemStyle(),t=r.get("areaColor");return t!=null&&(e.fill=t),e}function H5(r){var e=r.style;e&&(e.stroke=e.stroke||e.fill,e.fill=null)}var _G=(function(){function r(e){var t=new mr;this.uid=db("ec_map_draw"),this._controller=new sS(e.getZr()),this._controllerHost={target:t},this.group=t,t.add(this._regionsGroup=new mr),t.add(this._svgGroup=new mr)}return r.prototype.draw=function(e,t,i,n,a){var s=e.mainType==="geo",o=e.getData&&e.getData();s&&t.eachComponent({mainType:"series",subType:"map"},function(P){!o&&P.getHostGeoModel()===e&&(o=P.getData())});var l=e.coordinateSystem,c=this._regionsGroup,f=this.group,p=l.getTransformInfo(),y=p.raw,b=p.roam,S=!c.childAt(0)||a;S?(f.x=b.x,f.y=b.y,f.scaleX=b.scaleX,f.scaleY=b.scaleY,f.dirty()):vi(f,b,e);var C=o&&o.getVisual("visualMeta")&&o.getVisual("visualMeta").length>0,E={api:i,geo:l,mapOrGeoModel:e,data:o,isVisualEncodedByVisualMap:C,isGeo:s,transformInfoRaw:y};l.resourceType==="geoJSON"?this._buildGeoJSON(E):l.resourceType==="geoSVG"&&this._buildSVG(E),this._updateController(e,t,i),this._updateMapSelectHandler(e,c,i,n)},r.prototype._buildGeoJSON=function(e){var t=this._regionsGroupByName=Qt(),i=Qt(),n=this._regionsGroup,a=e.transformInfoRaw,s=e.mapOrGeoModel,o=e.data,l=e.geo.projection,c=l&&l.stream;function f(b,S){return S&&(b=S(b)),b&&[b[0]*a.scaleX+a.x,b[1]*a.scaleY+a.y]}function p(b){for(var S=[],C=!c&&l&&l.project,E=0;E<b.length;++E){var P=f(b[E],C);P&&S.push(P)}return S}function y(b){return{shape:{points:p(b)}}}n.removeAll(),se(e.geo.regions,function(b){var S=b.name,C=t.get(S),E=i.get(S)||{},P=E.dataIdx,O=E.regionModel;if(!C){C=t.set(S,new mr),n.add(C),P=o?o.indexOfName(S):null,O=e.isGeo?s.getRegionModel(S):o?o.getItemModel(P):null;var B=O.get("silent",!0);B!=null&&(C.silent=B),i.set(S,{dataIdx:P,regionModel:O})}var F=[],W=[];se(b.geometries,function(Q){if(Q.type==="polygon"){var ee=[Q.exterior].concat(Q.interiors||[]);c&&(ee=Z5(ee,c)),se(ee,function(ae){F.push(new Rs(y(ae)))})}else{var te=Q.points;c&&(te=Z5(te,c,!0)),se(te,function(ae){W.push(new ks(y(ae)))})}});var $=f(b.getCenter(),l&&l.project);function q(Q,ee){if(Q.length){var te=new FC({culling:!0,segmentIgnoreThreshold:1,shape:{paths:Q}});C.add(te),j5(e,te,P,O),$5(e,te,S,O,s,P,$),ee&&(H5(te),se(te.states,H5))}}q(F),q(W,!0)}),t.each(function(b,S){var C=i.get(S),E=C.dataIdx,P=C.regionModel;W5(e,b,S,P,s,E),G5(e,b,S,P,s),X5(e,b,S,P,s)},this)},r.prototype._buildSVG=function(e){var t=e.geo.map,i=e.transformInfoRaw;this._svgGroup.x=i.x,this._svgGroup.y=i.y,this._svgGroup.scaleX=i.scaleX,this._svgGroup.scaleY=i.scaleY,this._svgResourceChanged(t)&&(this._freeSVG(),this._useSVG(t));var n=this._svgDispatcherMap=Qt(),a=!1;se(this._svgGraphicRecord.named,function(s){var o=s.name,l=e.mapOrGeoModel,c=e.data,f=s.svgNodeTagLower,p=s.el,y=c?c.indexOfName(o):null,b=l.getRegionModel(o);__e.get(f)!=null&&p instanceof Tc&&j5(e,p,y,b),p instanceof Tc&&(p.culling=!0);var S=b.get("silent",!0);if(S!=null&&(p.silent=S),p.z2EmphasisLift=0,!s.namedFrom&&(x_e.get(f)!=null&&$5(e,p,o,b,l,y,null),W5(e,p,o,b,l,y),G5(e,p,o,b,l),b_e.get(f)!=null)){var C=X5(e,p,o,b,l);C==="self"&&(a=!0);var E=n.get(o)||n.set(o,[]);E.push(p)}},this),this._enableBlurEntireSVG(a,e)},r.prototype._enableBlurEntireSVG=function(e,t){if(e&&t.isGeo){var i=t.mapOrGeoModel.getModel(["blur","itemStyle"]).getItemStyle(),n=i.opacity;this._svgGraphicRecord.root.traverse(function(a){if(!a.isGroup){_y(a);var s=a.ensureState("blur").style||{};s.opacity==null&&n!=null&&(s.opacity=n),a.ensureState("emphasis")}})}},r.prototype.remove=function(){this._regionsGroup.removeAll(),this._regionsGroupByName=null,this._svgGroup.removeAll(),this._freeSVG(),this._controller.dispose(),this._controllerHost=null},r.prototype.findHighDownDispatchers=function(e,t){if(e==null)return[];var i=t.coordinateSystem;if(i.resourceType==="geoJSON"){var n=this._regionsGroupByName;if(n){var a=n.get(e);return a?[a]:[]}}else if(i.resourceType==="geoSVG")return this._svgDispatcherMap&&this._svgDispatcherMap.get(e)||[]},r.prototype._svgResourceChanged=function(e){return this._svgMapName!==e},r.prototype._useSVG=function(e){var t=gp.getGeoResource(e);if(t&&t.type==="geoSVG"){var i=t.useGraphic(this.uid);this._svgGroup.add(i.root),this._svgGraphicRecord=i,this._svgMapName=e}},r.prototype._freeSVG=function(){var e=this._svgMapName;if(e!=null){var t=gp.getGeoResource(e);t&&t.type==="geoSVG"&&t.freeGraphic(this.uid),this._svgGraphicRecord=null,this._svgDispatcherMap=null,this._svgGroup.removeAll(),this._svgMapName=null}},r.prototype._updateController=function(e,t,i){var n=e.coordinateSystem,a=this._controller,s=this._controllerHost;s.zoomLimit=e.get("scaleLimit"),s.zoom=n.getZoom(),a.enable(e.get("roam")||!1);var o=e.mainType;function l(){var c={type:"geoRoam",componentType:o};return c[o+"Id"]=e.id,c}a.off("pan").on("pan",function(c){this._mouseDownFlag=!1,zL(s,c.dx,c.dy),i.dispatchAction(mt(l(),{dx:c.dx,dy:c.dy,animation:{duration:0}}))},this),a.off("zoom").on("zoom",function(c){this._mouseDownFlag=!1,FL(s,c.scale,c.originX,c.originY),i.dispatchAction(mt(l(),{totalZoom:s.zoom,zoom:c.scale,originX:c.originX,originY:c.originY,animation:{duration:0}}))},this),a.setPointerChecker(function(c,f,p){return n.containPoint([f,p])&&!aM(c,i,e)})},r.prototype.resetForLabelLayout=function(){this.group.traverse(function(e){var t=e.getTextContent();t&&(t.ignore=yG(t).ignore)})},r.prototype._updateMapSelectHandler=function(e,t,i,n){var a=this;t.off("mousedown"),t.off("click"),e.get("selectedMode")&&(t.on("mousedown",function(){a._mouseDownFlag=!0}),t.on("click",function(s){a._mouseDownFlag&&(a._mouseDownFlag=!1)}))},r})();function j5(r,e,t,i){var n=i.getModel("itemStyle"),a=i.getModel(["emphasis","itemStyle"]),s=i.getModel(["blur","itemStyle"]),o=i.getModel(["select","itemStyle"]),l=t2(n),c=t2(a),f=t2(o),p=t2(s),y=r.data;if(y){var b=y.getItemVisual(t,"style"),S=y.getItemVisual(t,"decal");r.isVisualEncodedByVisualMap&&b.fill&&(l.fill=b.fill),S&&(l.decal=q0(S,r.api))}e.setStyle(l),e.style.strokeNoScale=!0,e.ensureState("emphasis").style=c,e.ensureState("select").style=f,e.ensureState("blur").style=p,_y(e)}function $5(r,e,t,i,n,a,s){var o=r.data,l=r.isGeo,c=o&&isNaN(o.get(o.mapDimension("value"),a)),f=o&&o.getItemLayout(a);if(l||c||f&&f.showLabel){var p=l?t:a,y=void 0;(!o||a>=0)&&(y=n);var b=s?{normal:{align:"center",verticalAlign:"middle"}}:null;rs(e,fo(i),{labelFetcher:y,labelDataIndex:p,defaultText:t},b);var S=e.getTextContent();if(S&&(yG(S).ignore=S.ignore,e.textConfig&&s)){var C=e.getBoundingRect().clone();e.textConfig.layoutRect=C,e.textConfig.position=[(s[0]-C.x)/C.width*100+"%",(s[1]-C.y)/C.height*100+"%"]}e.disableLabelAnimation=!0}else e.removeTextContent(),e.removeTextConfig(),e.disableLabelAnimation=null}function W5(r,e,t,i,n,a){r.data?r.data.setItemGraphicEl(a,e):br(e).eventData={componentType:"geo",componentIndex:n.componentIndex,geoIndex:n.componentIndex,name:t,region:i&&i.option||{}}}function G5(r,e,t,i,n){r.data||Iy({el:e,componentModel:n,itemName:t,itemTooltipOption:i.get("tooltip")})}function X5(r,e,t,i,n){e.highDownSilentOnTouch=!!n.get("selectedMode");var a=i.getModel("emphasis"),s=a.get("focus");return Hn(e,s,a.get("blurScope"),a.get("disabled")),r.isGeo&&nhe(e,n,t),s}function Z5(r,e,t){var i=[],n;function a(){n=[]}function s(){n.length&&(i.push(n),n=[])}var o=e({polygonStart:a,polygonEnd:s,lineStart:a,lineEnd:s,point:function(l,c){isFinite(l)&&isFinite(c)&&n.push([l,c])},sphere:function(){}});return!t&&o.polygonStart(),se(r,function(l){o.lineStart();for(var c=0;c<l.length;c++)o.point(l[c][0],l[c][1]);o.lineEnd()}),!t&&o.polygonEnd(),i}var w_e=(function(r){Ye(e,r);function e(){var t=r!==null&&r.apply(this,arguments)||this;return t.type=e.type,t}return e.prototype.render=function(t,i,n,a){if(!(a&&a.type==="mapToggleSelect"&&a.from===this.uid)){var s=this.group;if(s.removeAll(),!t.getHostGeoModel()){if(this._mapDraw&&a&&a.type==="geoRoam"&&this._mapDraw.resetForLabelLayout(),a&&a.type==="geoRoam"&&a.componentType==="series"&&a.seriesId===t.id){var o=this._mapDraw;o&&s.add(o.group)}else if(t.needsDrawMap){var o=this._mapDraw||new _G(n);s.add(o.group),o.draw(t,i,n,this,a),this._mapDraw=o}else this._mapDraw&&this._mapDraw.remove(),this._mapDraw=null;t.get("showLegendSymbol")&&i.getComponent("legend")&&this._renderSymbols(t,i,n)}}},e.prototype.remove=function(){this._mapDraw&&this._mapDraw.remove(),this._mapDraw=null,this.group.removeAll()},e.prototype.dispose=function(){this._mapDraw&&this._mapDraw.remove(),this._mapDraw=null},e.prototype._renderSymbols=function(t,i,n){var a=t.originalData,s=this.group;a.each(a.mapDimension("value"),function(o,l){if(!isNaN(o)){var c=a.getItemLayout(l);if(!(!c||!c.point)){var f=c.point,p=c.offset,y=new $f({style:{fill:t.getData().getVisual("style").fill},shape:{cx:f[0]+p*9,cy:f[1],r:3},silent:!0,z2:8+(p?0:ob+1)});if(!p){var b=t.mainSeries.getData(),S=a.getName(l),C=b.indexOfName(S),E=a.getItemModel(l),P=E.getModel("label"),O=b.getItemGraphicEl(C);rs(y,fo(E),{labelFetcher:{getFormattedLabel:function(B,F){return t.getFormattedLabel(C,F)}},defaultText:S}),y.disableLabelAnimation=!0,P.get("position")||y.setTextConfig({position:"bottom"}),O.onHoverStateChange=function(B){CA(y,B)}}s.add(y)}}})},e.type="map",e})(Fi),S_e=(function(r){Ye(e,r);function e(){var t=r!==null&&r.apply(this,arguments)||this;return t.type=e.type,t.needsDrawMap=!1,t.seriesGroup=[],t.getTooltipPosition=function(i){if(i!=null){var n=this.getData().getName(i),a=this.coordinateSystem,s=a.getRegion(n);return s&&a.dataToPoint(s.getCenter())}},t}return e.prototype.getInitialData=function(t){for(var i=Sb(this,{coordDimensions:["value"],encodeDefaulter:Sr(tL,this)}),n=Qt(),a=[],s=0,o=i.count();s<o;s++){var l=i.getName(s);n.set(l,s)}var c=gp.load(this.getMapType(),this.option.nameMap,this.option.nameProperty);return se(c.regions,function(f){var p=f.name,y=n.get(p),b=f.properties&&f.properties.echartsStyle,S;y==null?(S={name:p},a.push(S)):S=i.getRawDataItem(y),b&&Cr(S,b)}),i.appendData(a),i},e.prototype.getHostGeoModel=function(){var t=this.option.geoIndex;return t!=null?this.ecModel.getComponent("geo",t):null},e.prototype.getMapType=function(){return(this.getHostGeoModel()||this).option.map},e.prototype.getRawValue=function(t){var i=this.getData();return i.get(i.mapDimension("value"),t)},e.prototype.getRegionModel=function(t){var i=this.getData();return i.getItemModel(i.indexOfName(t))},e.prototype.formatTooltip=function(t,i,n){for(var a=this.getData(),s=this.getRawValue(t),o=a.getName(t),l=this.seriesGroup,c=[],f=0;f<l.length;f++){var p=l[f].originalData.indexOfName(o),y=a.mapDimension("value");isNaN(l[f].originalData.get(y,p))||c.push(l[f].name)}return po("section",{header:c.join(", "),noHeader:!c.length,blocks:[po("nameValue",{name:o,value:s})]})},e.prototype.setZoom=function(t){this.option.zoom=t},e.prototype.setCenter=function(t){this.option.center=t},e.prototype.getLegendIcon=function(t){var i=t.icon||"roundRect",n=Aa(i,0,0,t.itemWidth,t.itemHeight,t.itemStyle.fill);return n.setStyle(t.itemStyle),n.style.stroke="none",i.indexOf("empty")>-1&&(n.style.stroke=n.style.fill,n.style.fill="#fff",n.style.lineWidth=2),n},e.type="series.map",e.dependencies=["geo"],e.layoutMode="box",e.defaultOption={z:2,coordinateSystem:"geo",map:"",left:"center",top:"center",aspectScale:null,showLegendSymbol:!0,boundingCoords:null,center:null,zoom:1,scaleLimit:null,selectedMode:!0,label:{show:!1,color:"#000"},itemStyle:{borderWidth:.5,borderColor:"#444",areaColor:"#eee"},emphasis:{label:{show:!0,color:"rgb(100,0,0)"},itemStyle:{areaColor:"rgba(255,215,0,0.8)"}},select:{label:{show:!0,color:"rgb(100,0,0)"},itemStyle:{color:"rgba(255,215,0,0.8)"}},nameProperty:"name"},e})(Xi);function T_e(r,e){var t={};return se(r,function(i){i.each(i.mapDimension("value"),function(n,a){var s="ec-"+i.getName(a);t[s]=t[s]||[],isNaN(n)||t[s].push(n)})}),r[0].map(r[0].mapDimension("value"),function(i,n){for(var a="ec-"+r[0].getName(n),s=0,o=1/0,l=-1/0,c=t[a].length,f=0;f<c;f++)o=Math.min(o,t[a][f]),l=Math.max(l,t[a][f]),s+=t[a][f];var p;return e==="min"?p=o:e==="max"?p=l:e==="average"?p=s/c:p=s,c===0?NaN:p})}function A_e(r){var e={};r.eachSeriesByType("map",function(t){var i=t.getHostGeoModel(),n=i?"o"+i.id:"i"+t.getMapType();(e[n]=e[n]||[]).push(t)}),se(e,function(t,i){for(var n=T_e(wt(t,function(s){return s.getData()}),t[0].get("mapValueCalculation")),a=0;a<t.length;a++)t[a].originalData=t[a].getData();for(var a=0;a<t.length;a++)t[a].seriesGroup=t,t[a].needsDrawMap=a===0&&!t[a].getHostGeoModel(),t[a].setData(n.cloneShallow()),t[a].mainSeries=t[0]})}function C_e(r){var e={};r.eachSeriesByType("map",function(t){var i=t.getMapType();if(!(t.getHostGeoModel()||e[i])){var n={};se(t.seriesGroup,function(s){var o=s.coordinateSystem,l=s.originalData;s.get("showLegendSymbol")&&r.getComponent("legend")&&l.each(l.mapDimension("value"),function(c,f){var p=l.getName(f),y=o.getRegion(p);if(!(!y||isNaN(c))){var b=n[p]||0,S=o.dataToPoint(y.getCenter());n[p]=b+1,l.setItemLayout(f,{point:S,offset:b})}})});var a=t.getData();a.each(function(s){var o=a.getName(s),l=a.getItemLayout(s)||{};l.showLabel=!n[o],a.setItemLayout(s,l)}),e[i]=!0}})}var q5=Ro,lS=(function(r){Ye(e,r);function e(t){var i=r.call(this)||this;return i.type="view",i.dimensions=["x","y"],i._roamTransformable=new np,i._rawTransformable=new np,i.name=t,i}return e.prototype.setBoundingRect=function(t,i,n,a){return this._rect=new Dr(t,i,n,a),this._rect},e.prototype.getBoundingRect=function(){return this._rect},e.prototype.setViewRect=function(t,i,n,a){this._transformTo(t,i,n,a),this._viewRect=new Dr(t,i,n,a)},e.prototype._transformTo=function(t,i,n,a){var s=this.getBoundingRect(),o=this._rawTransformable;o.transform=s.calculateTransform(new Dr(t,i,n,a));var l=o.parent;o.parent=null,o.decomposeTransform(),o.parent=l,this._updateTransform()},e.prototype.setCenter=function(t,i){t&&(this._center=[Vt(t[0],i.getWidth()),Vt(t[1],i.getHeight())],this._updateCenterAndZoom())},e.prototype.setZoom=function(t){t=t||1;var i=this.zoomLimit;i&&(i.max!=null&&(t=Math.min(i.max,t)),i.min!=null&&(t=Math.max(i.min,t))),this._zoom=t,this._updateCenterAndZoom()},e.prototype.getDefaultCenter=function(){var t=this.getBoundingRect(),i=t.x+t.width/2,n=t.y+t.height/2;return[i,n]},e.prototype.getCenter=function(){return this._center||this.getDefaultCenter()},e.prototype.getZoom=function(){return this._zoom||1},e.prototype.getRoamTransform=function(){return this._roamTransformable.getLocalTransform()},e.prototype._updateCenterAndZoom=function(){var t=this._rawTransformable.getLocalTransform(),i=this._roamTransformable,n=this.getDefaultCenter(),a=this.getCenter(),s=this.getZoom();a=Ro([],a,t),n=Ro([],n,t),i.originX=a[0],i.originY=a[1],i.x=n[0]-a[0],i.y=n[1]-a[1],i.scaleX=i.scaleY=s,this._updateTransform()},e.prototype._updateTransform=function(){var t=this._roamTransformable,i=this._rawTransformable;i.parent=t,t.updateTransform(),i.updateTransform(),MC(this.transform||(this.transform=[]),i.transform||kl()),this._rawTransform=i.getLocalTransform(),this.invTransform=this.invTransform||[],Ey(this.invTransform,this.transform),this.decomposeTransform()},e.prototype.getTransformInfo=function(){var t=this._rawTransformable,i=this._roamTransformable,n=new np;return n.transform=i.transform,n.decomposeTransform(),{roam:{x:n.x,y:n.y,scaleX:n.scaleX,scaleY:n.scaleY},raw:{x:t.x,y:t.y,scaleX:t.scaleX,scaleY:t.scaleY}}},e.prototype.getViewRect=function(){return this._viewRect},e.prototype.getViewRectAfterRoam=function(){var t=this.getBoundingRect().clone();return t.applyTransform(this.transform),t},e.prototype.dataToPoint=function(t,i,n){var a=i?this._rawTransform:this.transform;return n=n||[],a?q5(n,t,a):As(n,t)},e.prototype.pointToData=function(t){var i=this.invTransform;return i?q5([],t,i):[t[0],t[1]]},e.prototype.convertToPixel=function(t,i,n){var a=Y5(i);return a===this?a.dataToPoint(n):null},e.prototype.convertFromPixel=function(t,i,n){var a=Y5(i);return a===this?a.pointToData(n):null},e.prototype.containPoint=function(t){return this.getViewRectAfterRoam().contain(t[0],t[1])},e.dimensions=["x","y"],e})(np);function Y5(r){var e=r.seriesModel;return e?e.coordinateSystem:null}var M_e={geoJSON:{aspectScale:.75,invertLongitute:!0},geoSVG:{aspectScale:1,invertLongitute:!1}},bG=["lng","lat"],N3=(function(r){Ye(e,r);function e(t,i,n){var a=r.call(this,t)||this;a.dimensions=bG,a.type="geo",a._nameCoordMap=Qt(),a.map=i;var s=n.projection,o=gp.load(i,n.nameMap,n.nameProperty),l=gp.getGeoResource(i);a.resourceType=l?l.type:null;var c=a.regions=o.regions,f=M_e[l.type];a._regionsMap=o.regionsMap,a.regions=o.regions,a.projection=s;var p;if(s)for(var y=0;y<c.length;y++){var b=c[y].getBoundingRect(s);p=p||b.clone(),p.union(b)}else p=o.boundingRect;return a.setBoundingRect(p.x,p.y,p.width,p.height),a.aspectScale=s?1:wr(n.aspectScale,f.aspectScale),a._invertLongitute=s?!1:f.invertLongitute,a}return e.prototype._transformTo=function(t,i,n,a){var s=this.getBoundingRect(),o=this._invertLongitute;s=s.clone(),o&&(s.y=-s.y-s.height);var l=this._rawTransformable;l.transform=s.calculateTransform(new Dr(t,i,n,a));var c=l.parent;l.parent=null,l.decomposeTransform(),l.parent=c,o&&(l.scaleY=-l.scaleY),this._updateTransform()},e.prototype.getRegion=function(t){return this._regionsMap.get(t)},e.prototype.getRegionByCoord=function(t){for(var i=this.regions,n=0;n<i.length;n++){var a=i[n];if(a.type==="geoJSON"&&a.contain(t))return i[n]}},e.prototype.addGeoCoord=function(t,i){this._nameCoordMap.set(t,i)},e.prototype.getGeoCoord=function(t){var i=this._regionsMap.get(t);return this._nameCoordMap.get(t)||i&&i.getCenter()},e.prototype.dataToPoint=function(t,i,n){if($t(t)&&(t=this.getGeoCoord(t)),t){var a=this.projection;return a&&(t=a.project(t)),t&&this.projectedToPoint(t,i,n)}},e.prototype.pointToData=function(t){var i=this.projection;return i&&(t=i.unproject(t)),t&&this.pointToProjected(t)},e.prototype.pointToProjected=function(t){return r.prototype.pointToData.call(this,t)},e.prototype.projectedToPoint=function(t,i,n){return r.prototype.dataToPoint.call(this,t,i,n)},e.prototype.convertToPixel=function(t,i,n){var a=K5(i);return a===this?a.dataToPoint(n):null},e.prototype.convertFromPixel=function(t,i,n){var a=K5(i);return a===this?a.pointToData(n):null},e})(lS);ha(N3,lS);function K5(r){var e=r.geoModel,t=r.seriesModel;return e?e.coordinateSystem:t?t.coordinateSystem||(t.getReferringComponents("geo",ka).models[0]||{}).coordinateSystem:null}function Q5(r,e){var t=r.get("boundingCoords");if(t!=null){var i=t[0],n=t[1];if(isFinite(i[0])&&isFinite(i[1])&&isFinite(n[0])&&isFinite(n[1])){var a=this.projection;if(a){var s=i[0],o=i[1],l=n[0],c=n[1];i=[1/0,1/0],n=[-1/0,-1/0];var f=function($,q,Q,ee){for(var te=Q-$,ae=ee-q,de=0;de<=100;de++){var ve=de/100,ye=a.project([$+te*ve,q+ae*ve]);rp(i,i,ye),ip(n,n,ye)}};f(s,o,l,o),f(l,o,l,c),f(l,c,s,c),f(s,c,l,o)}this.setBoundingRect(i[0],i[1],n[0]-i[0],n[1]-i[1])}}var p=this.getBoundingRect(),y=r.get("layoutCenter"),b=r.get("layoutSize"),S=e.getWidth(),C=e.getHeight(),E=p.width/p.height*this.aspectScale,P=!1,O,B;y&&b&&(O=[Vt(y[0],S),Vt(y[1],C)],B=Vt(b,Math.min(S,C)),!isNaN(O[0])&&!isNaN(O[1])&&!isNaN(B)&&(P=!0));var F;if(P)F={},E>1?(F.width=B,F.height=B/E):(F.height=B,F.width=B*E),F.y=O[1]-F.height/2,F.x=O[0]-F.width/2;else{var W=r.getBoxLayoutParams();W.aspect=E,F=La(W,{width:S,height:C})}this.setViewRect(F.x,F.y,F.width,F.height),this.setCenter(r.get("center"),e),this.setZoom(r.get("zoom"))}function E_e(r,e){se(e.get("geoCoord"),function(t,i){r.addGeoCoord(i,t)})}var I_e=(function(){function r(){this.dimensions=bG}return r.prototype.create=function(e,t){var i=[];function n(s){return{nameProperty:s.get("nameProperty"),aspectScale:s.get("aspectScale"),projection:s.get("projection")}}e.eachComponent("geo",function(s,o){var l=s.get("map"),c=new N3(l+o,l,mt({nameMap:s.get("nameMap")},n(s)));c.zoomLimit=s.get("scaleLimit"),i.push(c),s.coordinateSystem=c,c.model=s,c.resize=Q5,c.resize(s,t)}),e.eachSeries(function(s){var o=s.get("coordinateSystem");if(o==="geo"){var l=s.get("geoIndex")||0;s.coordinateSystem=i[l]}});var a={};return e.eachSeriesByType("map",function(s){if(!s.getHostGeoModel()){var o=s.getMapType();a[o]=a[o]||[],a[o].push(s)}}),se(a,function(s,o){var l=wt(s,function(f){return f.get("nameMap")}),c=new N3(o,o,mt({nameMap:TC(l)},n(s[0])));c.zoomLimit=uo.apply(null,wt(s,function(f){return f.get("scaleLimit")})),i.push(c),c.resize=Q5,c.resize(s[0],t),se(s,function(f){f.coordinateSystem=c,E_e(c,f)})}),i},r.prototype.getFilledRegions=function(e,t,i,n){for(var a=(e||[]).slice(),s=Qt(),o=0;o<a.length;o++)s.set(a[o].name,a[o]);var l=gp.load(t,i,n);return se(l.regions,function(c){var f=c.name,p=s.get(f),y=c.properties&&c.properties.echartsStyle;p||(p={name:f},a.push(p)),y&&Cr(p,y)}),a},r})(),xG=new I_e,P_e=(function(r){Ye(e,r);function e(){var t=r!==null&&r.apply(this,arguments)||this;return t.type=e.type,t}return e.prototype.init=function(t,i,n){var a=gp.getGeoResource(t.map);if(a&&a.type==="geoJSON"){var s=t.itemStyle=t.itemStyle||{};"color"in s||(s.color="#eee")}this.mergeDefaultAndTheme(t,n),vy(t,"label",["show"])},e.prototype.optionUpdated=function(){var t=this,i=this.option;i.regions=xG.getFilledRegions(i.regions,i.map,i.nameMap,i.nameProperty);var n={};this._optionModelMap=Sc(i.regions||[],function(a,s){var o=s.name;return o&&(a.set(o,new Si(s,t,t.ecModel)),s.selected&&(n[o]=!0)),a},Qt()),i.selectedMap||(i.selectedMap=n)},e.prototype.getRegionModel=function(t){return this._optionModelMap.get(t)||new Si(null,this,this.ecModel)},e.prototype.getFormattedLabel=function(t,i){var n=this.getRegionModel(t),a=i==="normal"?n.get(["label","formatter"]):n.get(["emphasis","label","formatter"]),s={name:t};if(sr(a))return s.status=i,a(s);if($t(a))return a.replace("{a}",t??"")},e.prototype.setZoom=function(t){this.option.zoom=t},e.prototype.setCenter=function(t){this.option.center=t},e.prototype.select=function(t){var i=this.option,n=i.selectedMode;if(n){n!=="multiple"&&(i.selectedMap=null);var a=i.selectedMap||(i.selectedMap={});a[t]=!0}},e.prototype.unSelect=function(t){var i=this.option.selectedMap;i&&(i[t]=!1)},e.prototype.toggleSelected=function(t){this[this.isSelected(t)?"unSelect":"select"](t)},e.prototype.isSelected=function(t){var i=this.option.selectedMap;return!!(i&&i[t])},e.type="geo",e.layoutMode="box",e.defaultOption={z:0,show:!0,left:"center",top:"center",aspectScale:null,silent:!1,map:"",boundingCoords:null,center:null,zoom:1,scaleLimit:null,label:{show:!1,color:"#000"},itemStyle:{borderWidth:.5,borderColor:"#444"},emphasis:{label:{show:!0,color:"rgb(100,0,0)"},itemStyle:{color:"rgba(255,215,0,0.8)"}},select:{label:{show:!0,color:"rgb(100,0,0)"},itemStyle:{color:"rgba(255,215,0,0.8)"}},regions:[]},e})(Wr);function J5(r,e){return r.pointToProjected?r.pointToProjected(e):r.pointToData(e)}function UL(r,e,t,i){var n=r.getZoom(),a=r.getCenter(),s=e.zoom,o=r.projectedToPoint?r.projectedToPoint(a):r.dataToPoint(a);if(e.dx!=null&&e.dy!=null&&(o[0]-=e.dx,o[1]-=e.dy,r.setCenter(J5(r,o),i)),s!=null){if(t){var l=t.min||0,c=t.max||1/0;s=Math.max(Math.min(n*s,c),l)/n}r.scaleX*=s,r.scaleY*=s;var f=(e.originX-r.x)*(s-1),p=(e.originY-r.y)*(s-1);r.x-=f,r.y-=p,r.updateTransform(),r.setCenter(J5(r,o),i),r.setZoom(s*n)}return{center:r.getCenter(),zoom:r.getZoom()}}var R_e=(function(r){Ye(e,r);function e(){var t=r!==null&&r.apply(this,arguments)||this;return t.type=e.type,t.focusBlurEnabled=!0,t}return e.prototype.init=function(t,i){this._api=i},e.prototype.render=function(t,i,n,a){if(this._model=t,!t.get("show")){this._mapDraw&&this._mapDraw.remove(),this._mapDraw=null;return}this._mapDraw||(this._mapDraw=new _G(n));var s=this._mapDraw;s.draw(t,i,n,this,a),s.group.on("click",this._handleRegionClick,this),s.group.silent=t.get("silent"),this.group.add(s.group),this.updateSelectStatus(t,i,n)},e.prototype._handleRegionClick=function(t){var i;Wm(t.target,function(n){return(i=br(n).eventData)!=null},!0),i&&this._api.dispatchAction({type:"geoToggleSelect",geoId:this._model.id,name:i.name})},e.prototype.updateSelectStatus=function(t,i,n){var a=this;this._mapDraw.group.traverse(function(s){var o=br(s).eventData;if(o)return a._model.isSelected(o.name)?n.enterSelect(s):n.leaveSelect(s),!0})},e.prototype.findHighDownDispatchers=function(t){return this._mapDraw&&this._mapDraw.findHighDownDispatchers(t,this._model)},e.prototype.dispose=function(){this._mapDraw&&this._mapDraw.remove()},e.type="geo",e})(vn);function D_e(r,e,t){gp.registerMap(r,e,t)}function wG(r){r.registerCoordinateSystem("geo",xG),r.registerComponentModel(P_e),r.registerComponentView(R_e),r.registerImpl("registerMap",D_e),r.registerImpl("getMap",function(t){return gp.getMapForUser(t)});function e(t,i){i.update="geo:updateSelectStatus",r.registerAction(i,function(n,a){var s={},o=[];return a.eachComponent({mainType:"geo",query:n},function(l){l[t](n.name);var c=l.coordinateSystem;se(c.regions,function(p){s[p.name]=l.isSelected(p.name)||!1});var f=[];se(s,function(p,y){s[y]&&f.push(y)}),o.push({geoIndex:l.componentIndex,name:f})}),{selected:s,allSelected:o,name:n.name}})}e("toggleSelected",{type:"geoToggleSelect",event:"geoselectchanged"}),e("select",{type:"geoSelect",event:"geoselected"}),e("unSelect",{type:"geoUnSelect",event:"geounselected"}),r.registerAction({type:"geoRoam",event:"geoRoam",update:"updateTransform"},function(t,i,n){var a=t.componentType||"series";i.eachComponent({mainType:a,query:t},function(s){var o=s.coordinateSystem;if(o.type==="geo"){var l=UL(o,t,s.get("scaleLimit"),n);s.setCenter&&s.setCenter(l.center),s.setZoom&&s.setZoom(l.zoom),a==="series"&&se(s.seriesGroup,function(c){c.setCenter(l.center),c.setZoom(l.zoom)})}})})}function k_e(r){Vr(wG),r.registerChartView(w_e),r.registerSeriesModel(S_e),r.registerLayout(C_e),r.registerProcessor(r.PRIORITY.PROCESSOR.STATISTIC,A_e),b9("map",r.registerAction)}function L_e(r){var e=r;e.hierNode={defaultAncestor:null,ancestor:e,prelim:0,modifier:0,change:0,shift:0,i:0,thread:null};for(var t=[e],i,n;i=t.pop();)if(n=i.children,i.isExpand&&n.length)for(var a=n.length,s=a-1;s>=0;s--){var o=n[s];o.hierNode={defaultAncestor:null,ancestor:o,prelim:0,modifier:0,change:0,shift:0,i:s,thread:null},t.push(o)}}function O_e(r,e){var t=r.isExpand?r.children:[],i=r.parentNode.children,n=r.hierNode.i?i[r.hierNode.i-1]:null;if(t.length){z_e(r);var a=(t[0].hierNode.prelim+t[t.length-1].hierNode.prelim)/2;n?(r.hierNode.prelim=n.hierNode.prelim+e(r,n),r.hierNode.modifier=r.hierNode.prelim-a):r.hierNode.prelim=a}else n&&(r.hierNode.prelim=n.hierNode.prelim+e(r,n));r.parentNode.hierNode.defaultAncestor=F_e(r,n,r.parentNode.hierNode.defaultAncestor||i[0],e)}function N_e(r){var e=r.hierNode.prelim+r.parentNode.hierNode.modifier;r.setLayout({x:e},!0),r.hierNode.modifier+=r.parentNode.hierNode.modifier}function e6(r){return arguments.length?r:H_e}function w1(r,e){return r-=Math.PI/2,{x:e*Math.cos(r),y:e*Math.sin(r)}}function B_e(r,e){return La(r.getBoxLayoutParams(),{width:e.getWidth(),height:e.getHeight()})}function z_e(r){for(var e=r.children,t=e.length,i=0,n=0;--t>=0;){var a=e[t];a.hierNode.prelim+=i,a.hierNode.modifier+=i,n+=a.hierNode.change,i+=a.hierNode.shift+n}}function F_e(r,e,t,i){if(e){for(var n=r,a=r,s=a.parentNode.children[0],o=e,l=n.hierNode.modifier,c=a.hierNode.modifier,f=s.hierNode.modifier,p=o.hierNode.modifier;o=$I(o),a=WI(a),o&&a;){n=$I(n),s=WI(s),n.hierNode.ancestor=r;var y=o.hierNode.prelim+p-a.hierNode.prelim-c+i(o,a);y>0&&(U_e(V_e(o,r,t),r,y),c+=y,l+=y),p+=o.hierNode.modifier,c+=a.hierNode.modifier,l+=n.hierNode.modifier,f+=s.hierNode.modifier}o&&!$I(n)&&(n.hierNode.thread=o,n.hierNode.modifier+=p-l),a&&!WI(s)&&(s.hierNode.thread=a,s.hierNode.modifier+=c-f,t=r)}return t}function $I(r){var e=r.children;return e.length&&r.isExpand?e[e.length-1]:r.hierNode.thread}function WI(r){var e=r.children;return e.length&&r.isExpand?e[0]:r.hierNode.thread}function V_e(r,e,t){return r.hierNode.ancestor.parentNode===e.parentNode?r.hierNode.ancestor:t}function U_e(r,e,t){var i=t/(e.hierNode.i-r.hierNode.i);e.hierNode.change-=i,e.hierNode.shift+=t,e.hierNode.modifier+=t,e.hierNode.prelim+=t,r.hierNode.change+=i}function H_e(r,e){return r.parentNode===e.parentNode?1:2}var j_e=(function(){function r(){this.parentPoint=[],this.childPoints=[]}return r})(),$_e=(function(r){Ye(e,r);function e(t){return r.call(this,t)||this}return e.prototype.getDefaultStyle=function(){return{stroke:"#000",fill:null}},e.prototype.getDefaultShape=function(){return new j_e},e.prototype.buildPath=function(t,i){var n=i.childPoints,a=n.length,s=i.parentPoint,o=n[0],l=n[a-1];if(a===1){t.moveTo(s[0],s[1]),t.lineTo(o[0],o[1]);return}var c=i.orient,f=c==="TB"||c==="BT"?0:1,p=1-f,y=Vt(i.forkPosition,1),b=[];b[f]=s[f],b[p]=s[p]+(l[p]-s[p])*y,t.moveTo(s[0],s[1]),t.lineTo(b[0],b[1]),t.moveTo(o[0],o[1]),b[f]=o[f],t.lineTo(b[0],b[1]),b[f]=l[f],t.lineTo(b[0],b[1]),t.lineTo(l[0],l[1]);for(var S=1;S<a-1;S++){var C=n[S];t.moveTo(C[0],C[1]),b[f]=C[f],t.lineTo(b[0],b[1])}},e})(Xr),W_e=(function(r){Ye(e,r);function e(){var t=r!==null&&r.apply(this,arguments)||this;return t.type=e.type,t._mainGroup=new mr,t}return e.prototype.init=function(t,i){this._controller=new sS(i.getZr()),this._controllerHost={target:this.group},this.group.add(this._mainGroup)},e.prototype.render=function(t,i,n){var a=t.getData(),s=t.layoutInfo,o=this._mainGroup,l=t.get("layout");l==="radial"?(o.x=s.x+s.width/2,o.y=s.y+s.height/2):(o.x=s.x,o.y=s.y),this._updateViewCoordSys(t,n),this._updateController(t,i,n);var c=this._data;a.diff(c).add(function(f){t6(a,f)&&r6(a,f,null,o,t)}).update(function(f,p){var y=c.getItemGraphicEl(p);if(!t6(a,f)){y&&n6(c,p,y,o,t);return}r6(a,f,y,o,t)}).remove(function(f){var p=c.getItemGraphicEl(f);p&&n6(c,f,p,o,t)}).execute(),this._nodeScaleRatio=t.get("nodeScaleRatio"),this._updateNodeAndLinkScale(t),t.get("expandAndCollapse")===!0&&a.eachItemGraphicEl(function(f,p){f.off("click").on("click",function(){n.dispatchAction({type:"treeExpandAndCollapse",seriesId:t.id,dataIndex:p})})}),this._data=a},e.prototype._updateViewCoordSys=function(t,i){var n=t.getData(),a=[];n.each(function(p){var y=n.getItemLayout(p);y&&!isNaN(y.x)&&!isNaN(y.y)&&a.push([+y.x,+y.y])});var s=[],o=[];NC(a,s,o);var l=this._min,c=this._max;o[0]-s[0]===0&&(s[0]=l?l[0]:s[0]-1,o[0]=c?c[0]:o[0]+1),o[1]-s[1]===0&&(s[1]=l?l[1]:s[1]-1,o[1]=c?c[1]:o[1]+1);var f=t.coordinateSystem=new lS;f.zoomLimit=t.get("scaleLimit"),f.setBoundingRect(s[0],s[1],o[0]-s[0],o[1]-s[1]),f.setCenter(t.get("center"),i),f.setZoom(t.get("zoom")),this.group.attr({x:f.x,y:f.y,scaleX:f.scaleX,scaleY:f.scaleY}),this._min=s,this._max=o},e.prototype._updateController=function(t,i,n){var a=this,s=this._controller,o=this._controllerHost,l=this.group;s.setPointerChecker(function(c,f,p){var y=l.getBoundingRect();return y.applyTransform(l.transform),y.contain(f,p)&&!aM(c,n,t)}),s.enable(t.get("roam")),o.zoomLimit=t.get("scaleLimit"),o.zoom=t.coordinateSystem.getZoom(),s.off("pan").off("zoom").on("pan",function(c){zL(o,c.dx,c.dy),n.dispatchAction({seriesId:t.id,type:"treeRoam",dx:c.dx,dy:c.dy})}).on("zoom",function(c){FL(o,c.scale,c.originX,c.originY),n.dispatchAction({seriesId:t.id,type:"treeRoam",zoom:c.scale,originX:c.originX,originY:c.originY}),a._updateNodeAndLinkScale(t),n.updateLabelLayout()})},e.prototype._updateNodeAndLinkScale=function(t){var i=t.getData(),n=this._getNodeGlobalScale(t);i.eachItemGraphicEl(function(a,s){a.setSymbolScale(n)})},e.prototype._getNodeGlobalScale=function(t){var i=t.coordinateSystem;if(i.type!=="view")return 1;var n=this._nodeScaleRatio,a=i.scaleX||1,s=i.getZoom(),o=(s-1)*n+1;return o/a},e.prototype.dispose=function(){this._controller&&this._controller.dispose(),this._controllerHost=null},e.prototype.remove=function(){this._mainGroup.removeAll(),this._data=null},e.type="tree",e})(Fi);function t6(r,e){var t=r.getItemLayout(e);return t&&!isNaN(t.x)&&!isNaN(t.y)}function r6(r,e,t,i,n){var a=!t,s=r.tree.getNodeByDataIndex(e),o=s.getModel(),l=s.getVisual("style").fill,c=s.isExpand===!1&&s.children.length!==0?l:"#fff",f=r.tree.root,p=s.parentNode===f?s:s.parentNode||s,y=r.getItemGraphicEl(p.dataIndex),b=p.getLayout(),S=y?{x:y.__oldX,y:y.__oldY,rawX:y.__radialOldRawX,rawY:y.__radialOldRawY}:b,C=s.getLayout();a?(t=new tS(r,e,null,{symbolInnerColor:c,useNameLabel:!0}),t.x=S.x,t.y=S.y):t.updateData(r,e,null,{symbolInnerColor:c,useNameLabel:!0}),t.__radialOldRawX=t.__radialRawX,t.__radialOldRawY=t.__radialRawY,t.__radialRawX=C.rawX,t.__radialRawY=C.rawY,i.add(t),r.setItemGraphicEl(e,t),t.__oldX=t.x,t.__oldY=t.y,vi(t,{x:C.x,y:C.y},n);var E=t.getSymbolPath();if(n.get("layout")==="radial"){var P=f.children[0],O=P.getLayout(),B=P.children.length,F=void 0,W=void 0;if(C.x===O.x&&s.isExpand===!0&&P.children.length){var $={x:(P.children[0].getLayout().x+P.children[B-1].getLayout().x)/2,y:(P.children[0].getLayout().y+P.children[B-1].getLayout().y)/2};F=Math.atan2($.y-O.y,$.x-O.x),F<0&&(F=Math.PI*2+F),W=$.x<O.x,W&&(F=F-Math.PI)}else F=Math.atan2(C.y-O.y,C.x-O.x),F<0&&(F=Math.PI*2+F),s.children.length===0||s.children.length!==0&&s.isExpand===!1?(W=C.x<O.x,W&&(F=F-Math.PI)):(W=C.x>O.x,W||(F=F-Math.PI));var q=W?"left":"right",Q=o.getModel("label"),ee=Q.get("rotate"),te=ee*(Math.PI/180),ae=E.getTextContent();ae&&(E.setTextConfig({position:Q.get("position")||q,rotation:ee==null?-F:te,origin:"center"}),ae.setStyle("verticalAlign","middle"))}var de=o.get(["emphasis","focus"]),ve=de==="relative"?$0(s.getAncestorsIndices(),s.getDescendantIndices()):de==="ancestor"?s.getAncestorsIndices():de==="descendant"?s.getDescendantIndices():null;ve&&(br(t).focus=ve),G_e(n,s,f,t,S,b,C,i),t.__edge&&(t.onHoverStateChange=function(ye){if(ye!=="blur"){var Ae=s.parentNode&&r.getItemGraphicEl(s.parentNode.dataIndex);Ae&&Ae.hoverState===Xw||CA(t.__edge,ye)}})}function G_e(r,e,t,i,n,a,s,o){var l=e.getModel(),c=r.get("edgeShape"),f=r.get("layout"),p=r.getOrient(),y=r.get(["lineStyle","curveness"]),b=r.get("edgeForkPosition"),S=l.getModel("lineStyle").getLineStyle(),C=i.__edge;if(c==="curve")e.parentNode&&e.parentNode!==t&&(C||(C=i.__edge=new lb({shape:B3(f,p,y,n,n)})),vi(C,{shape:B3(f,p,y,a,s)},r));else if(c==="polyline"&&f==="orthogonal"&&e!==t&&e.children&&e.children.length!==0&&e.isExpand===!0){for(var E=e.children,P=[],O=0;O<E.length;O++){var B=E[O].getLayout();P.push([B.x,B.y])}C||(C=i.__edge=new $_e({shape:{parentPoint:[s.x,s.y],childPoints:[[s.x,s.y]],orient:p,forkPosition:b}})),vi(C,{shape:{parentPoint:[s.x,s.y],childPoints:P}},r)}C&&!(c==="polyline"&&!e.isExpand)&&(C.useStyle(lr({strokeNoScale:!0,fill:null},S)),ts(C,l,"lineStyle"),_y(C),o.add(C))}function i6(r,e,t,i,n){var a=e.tree.root,s=SG(a,r),o=s.source,l=s.sourceLayout,c=e.getItemGraphicEl(r.dataIndex);if(c){var f=e.getItemGraphicEl(o.dataIndex),p=f.__edge,y=c.__edge||(o.isExpand===!1||o.children.length===1?p:void 0),b=i.get("edgeShape"),S=i.get("layout"),C=i.get("orient"),E=i.get(["lineStyle","curveness"]);y&&(b==="curve"?jg(y,{shape:B3(S,C,E,l,l),style:{opacity:0}},i,{cb:function(){t.remove(y)},removeOpt:n}):b==="polyline"&&i.get("layout")==="orthogonal"&&jg(y,{shape:{parentPoint:[l.x,l.y],childPoints:[[l.x,l.y]]},style:{opacity:0}},i,{cb:function(){t.remove(y)},removeOpt:n}))}}function SG(r,e){for(var t=e.parentNode===r?e:e.parentNode||e,i;i=t.getLayout(),i==null;)t=t.parentNode===r?t:t.parentNode||t;return{source:t,sourceLayout:i}}function n6(r,e,t,i,n){var a=r.tree.getNodeByDataIndex(e),s=r.tree.root,o=SG(s,a).sourceLayout,l={duration:n.get("animationDurationUpdate"),easing:n.get("animationEasingUpdate")};jg(t,{x:o.x+1,y:o.y+1},n,{cb:function(){i.remove(t),r.setItemGraphicEl(e,null)},removeOpt:l}),t.fadeOut(null,r.hostModel,{fadeLabel:!0,animation:l}),a.children.forEach(function(c){i6(c,r,i,n,l)}),i6(a,r,i,n,l)}function B3(r,e,t,i,n){var a,s,o,l,c,f,p,y;if(r==="radial"){c=i.rawX,p=i.rawY,f=n.rawX,y=n.rawY;var b=w1(c,p),S=w1(c,p+(y-p)*t),C=w1(f,y+(p-y)*t),E=w1(f,y);return{x1:b.x||0,y1:b.y||0,x2:E.x||0,y2:E.y||0,cpx1:S.x||0,cpy1:S.y||0,cpx2:C.x||0,cpy2:C.y||0}}else c=i.x,p=i.y,f=n.x,y=n.y,(e==="LR"||e==="RL")&&(a=c+(f-c)*t,s=p,o=f+(c-f)*t,l=y),(e==="TB"||e==="BT")&&(a=c,s=p+(y-p)*t,o=f,l=y+(p-y)*t);return{x1:c,y1:p,x2:f,y2:y,cpx1:a,cpy1:s,cpx2:o,cpy2:l}}var xc=fi();function TG(r){var e=r.mainData,t=r.datas;t||(t={main:e},r.datasAttr={main:"data"}),r.datas=r.mainData=null,AG(e,t,r),se(t,function(i){se(e.TRANSFERABLE_METHODS,function(n){i.wrapMethod(n,Sr(X_e,r))})}),e.wrapMethod("cloneShallow",Sr(q_e,r)),se(e.CHANGABLE_METHODS,function(i){e.wrapMethod(i,Sr(Z_e,r))}),Is(t[e.dataType]===e)}function X_e(r,e){if(Q_e(this)){var t=mt({},xc(this).datas);t[this.dataType]=e,AG(e,t,r)}else HL(e,this.dataType,xc(this).mainData,r);return e}function Z_e(r,e){return r.struct&&r.struct.update(),e}function q_e(r,e){return se(xc(e).datas,function(t,i){t!==e&&HL(t.cloneShallow(),i,e,r)}),e}function Y_e(r){var e=xc(this).mainData;return r==null||e==null?e:xc(e).datas[r]}function K_e(){var r=xc(this).mainData;return r==null?[{data:r}]:wt(qr(xc(r).datas),function(e){return{type:e,data:xc(r).datas[e]}})}function Q_e(r){return xc(r).mainData===r}function AG(r,e,t){xc(r).datas={},se(e,function(i,n){HL(i,n,r,t)})}function HL(r,e,t,i){xc(t).datas[e]=r,xc(r).mainData=t,r.dataType=e,i.struct&&(r[i.structAttr]=i.struct,i.struct[i.datasAttr[e]]=r),r.getLinkedData=Y_e,r.getLinkedDataAll=K_e}var J_e=(function(){function r(e,t){this.depth=0,this.height=0,this.dataIndex=-1,this.children=[],this.viewChildren=[],this.isExpand=!1,this.name=e||"",this.hostTree=t}return r.prototype.isRemoved=function(){return this.dataIndex<0},r.prototype.eachNode=function(e,t,i){sr(e)&&(i=t,t=e,e=null),e=e||{},$t(e)&&(e={order:e});var n=e.order||"preorder",a=this[e.attr||"children"],s;n==="preorder"&&(s=t.call(i,this));for(var o=0;!s&&o<a.length;o++)a[o].eachNode(e,t,i);n==="postorder"&&t.call(i,this)},r.prototype.updateDepthAndHeight=function(e){var t=0;this.depth=e;for(var i=0;i<this.children.length;i++){var n=this.children[i];n.updateDepthAndHeight(e+1),n.height>t&&(t=n.height)}this.height=t+1},r.prototype.getNodeById=function(e){if(this.getId()===e)return this;for(var t=0,i=this.children,n=i.length;t<n;t++){var a=i[t].getNodeById(e);if(a)return a}},r.prototype.contains=function(e){if(e===this)return!0;for(var t=0,i=this.children,n=i.length;t<n;t++){var a=i[t].contains(e);if(a)return a}},r.prototype.getAncestors=function(e){for(var t=[],i=e?this:this.parentNode;i;)t.push(i),i=i.parentNode;return t.reverse(),t},r.prototype.getAncestorsIndices=function(){for(var e=[],t=this;t;)e.push(t.dataIndex),t=t.parentNode;return e.reverse(),e},r.prototype.getDescendantIndices=function(){var e=[];return this.eachNode(function(t){e.push(t.dataIndex)}),e},r.prototype.getValue=function(e){var t=this.hostTree.data;return t.getStore().get(t.getDimensionIndex(e||"value"),this.dataIndex)},r.prototype.setLayout=function(e,t){this.dataIndex>=0&&this.hostTree.data.setItemLayout(this.dataIndex,e,t)},r.prototype.getLayout=function(){return this.hostTree.data.getItemLayout(this.dataIndex)},r.prototype.getModel=function(e){if(!(this.dataIndex<0)){var t=this.hostTree,i=t.data.getItemModel(this.dataIndex);return i.getModel(e)}},r.prototype.getLevelModel=function(){return(this.hostTree.levelModels||[])[this.depth]},r.prototype.setVisual=function(e,t){this.dataIndex>=0&&this.hostTree.data.setItemVisual(this.dataIndex,e,t)},r.prototype.getVisual=function(e){return this.hostTree.data.getItemVisual(this.dataIndex,e)},r.prototype.getRawIndex=function(){return this.hostTree.data.getRawIndex(this.dataIndex)},r.prototype.getId=function(){return this.hostTree.data.getId(this.dataIndex)},r.prototype.getChildIndex=function(){if(this.parentNode){for(var e=this.parentNode.children,t=0;t<e.length;++t)if(e[t]===this)return t;return-1}return-1},r.prototype.isAncestorOf=function(e){for(var t=e.parentNode;t;){if(t===this)return!0;t=t.parentNode}return!1},r.prototype.isDescendantOf=function(e){return e!==this&&e.isAncestorOf(this)},r})(),jL=(function(){function r(e){this.type="tree",this._nodes=[],this.hostModel=e}return r.prototype.eachNode=function(e,t,i){this.root.eachNode(e,t,i)},r.prototype.getNodeByDataIndex=function(e){var t=this.data.getRawIndex(e);return this._nodes[t]},r.prototype.getNodeById=function(e){return this.root.getNodeById(e)},r.prototype.update=function(){for(var e=this.data,t=this._nodes,i=0,n=t.length;i<n;i++)t[i].dataIndex=-1;for(var i=0,n=e.count();i<n;i++)t[e.getRawIndex(i)].dataIndex=i},r.prototype.clearLayouts=function(){this.data.clearItemLayouts()},r.createTree=function(e,t,i){var n=new r(t),a=[],s=1;o(e);function o(f,p){var y=f.value;s=Math.max(s,xt(y)?y.length:1),a.push(f);var b=new J_e(Za(f.name,""),n);p?e0e(b,p):n.root=b,n._nodes.push(b);var S=f.children;if(S)for(var C=0;C<S.length;C++)o(S[C],b)}n.root.updateDepthAndHeight(0);var l=bb(a,{coordDimensions:["value"],dimensionsCount:s}).dimensions,c=new Es(l,t);return c.initData(a),i&&i(c),TG({mainData:c,struct:n,structAttr:"tree"}),n.update(),n},r})();function e0e(r,e){var t=e.children;r.parentNode!==e&&(t.push(r),r.parentNode=e)}function Ew(r,e,t){if(r&&Or(e,r.type)>=0){var i=t.getData().tree.root,n=r.targetNode;if($t(n)&&(n=i.getNodeById(n)),n&&i.contains(n))return{node:n};var a=r.targetNodeId;if(a!=null&&(n=i.getNodeById(a)))return{node:n}}}function CG(r){for(var e=[];r;)r=r.parentNode,r&&e.push(r);return e.reverse()}function $L(r,e){var t=CG(r);return Or(t,e)>=0}function sM(r,e){for(var t=[];r;){var i=r.dataIndex;t.push({name:r.name,dataIndex:i,value:e.getRawValue(i)}),r=r.parentNode}return t.reverse(),t}var t0e=(function(r){Ye(e,r);function e(){var t=r!==null&&r.apply(this,arguments)||this;return t.hasSymbolVisual=!0,t.ignoreStyleOnData=!0,t}return e.prototype.getInitialData=function(t){var i={name:t.name,children:t.data},n=t.leaves||{},a=new Si(n,this,this.ecModel),s=jL.createTree(i,this,o);function o(p){p.wrapMethod("getItemModel",function(y,b){var S=s.getNodeByDataIndex(b);return S&&S.children.length&&S.isExpand||(y.parentModel=a),y})}var l=0;s.eachNode("preorder",function(p){p.depth>l&&(l=p.depth)});var c=t.expandAndCollapse,f=c&&t.initialTreeDepth>=0?t.initialTreeDepth:l;return s.root.eachNode("preorder",function(p){var y=p.hostTree.data.getRawDataItem(p.dataIndex);p.isExpand=y&&y.collapsed!=null?!y.collapsed:p.depth<=f}),s.data},e.prototype.getOrient=function(){var t=this.get("orient");return t==="horizontal"?t="LR":t==="vertical"&&(t="TB"),t},e.prototype.setZoom=function(t){this.option.zoom=t},e.prototype.setCenter=function(t){this.option.center=t},e.prototype.formatTooltip=function(t,i,n){for(var a=this.getData().tree,s=a.root.children[0],o=a.getNodeByDataIndex(t),l=o.getValue(),c=o.name;o&&o!==s;)c=o.parentNode.name+"."+c,o=o.parentNode;return po("nameValue",{name:c,value:l,noValue:isNaN(l)||l==null})},e.prototype.getDataParams=function(t){var i=r.prototype.getDataParams.apply(this,arguments),n=this.getData().tree.getNodeByDataIndex(t);return i.treeAncestors=sM(n,this),i.collapsed=!n.isExpand,i},e.type="series.tree",e.layoutMode="box",e.defaultOption={z:2,coordinateSystem:"view",left:"12%",top:"12%",right:"12%",bottom:"12%",layout:"orthogonal",edgeShape:"curve",edgeForkPosition:"50%",roam:!1,nodeScaleRatio:.4,center:null,zoom:1,orient:"LR",symbol:"emptyCircle",symbolSize:7,expandAndCollapse:!0,initialTreeDepth:2,lineStyle:{color:"#ccc",width:1.5,curveness:.5},itemStyle:{color:"lightsteelblue",borderWidth:1.5},label:{show:!0},animationEasing:"linear",animationDuration:700,animationDurationUpdate:500},e})(Xi);function r0e(r,e,t){for(var i=[r],n=[],a;a=i.pop();)if(n.push(a),a.isExpand){var s=a.children;if(s.length)for(var o=0;o<s.length;o++)i.push(s[o])}for(;a=n.pop();)e(a,t)}function Qx(r,e){for(var t=[r],i;i=t.pop();)if(e(i),i.isExpand){var n=i.children;if(n.length)for(var a=n.length-1;a>=0;a--)t.push(n[a])}}function i0e(r,e){r.eachSeriesByType("tree",function(t){n0e(t,e)})}function n0e(r,e){var t=B_e(r,e);r.layoutInfo=t;var i=r.get("layout"),n=0,a=0,s=null;i==="radial"?(n=2*Math.PI,a=Math.min(t.height,t.width)/2,s=e6(function(B,F){return(B.parentNode===F.parentNode?1:2)/B.depth})):(n=t.width,a=t.height,s=e6());var o=r.getData().tree.root,l=o.children[0];if(l){L_e(o),r0e(l,O_e,s),o.hierNode.modifier=-l.hierNode.prelim,Qx(l,N_e);var c=l,f=l,p=l;Qx(l,function(B){var F=B.getLayout().x;F<c.getLayout().x&&(c=B),F>f.getLayout().x&&(f=B),B.depth>p.depth&&(p=B)});var y=c===f?1:s(c,f)/2,b=y-c.getLayout().x,S=0,C=0,E=0,P=0;if(i==="radial")S=n/(f.getLayout().x+y+b),C=a/(p.depth-1||1),Qx(l,function(B){E=(B.getLayout().x+b)*S,P=(B.depth-1)*C;var F=w1(E,P);B.setLayout({x:F.x,y:F.y,rawX:E,rawY:P},!0)});else{var O=r.getOrient();O==="RL"||O==="LR"?(C=a/(f.getLayout().x+y+b),S=n/(p.depth-1||1),Qx(l,function(B){P=(B.getLayout().x+b)*C,E=O==="LR"?(B.depth-1)*S:n-(B.depth-1)*S,B.setLayout({x:E,y:P},!0)})):(O==="TB"||O==="BT")&&(S=n/(f.getLayout().x+y+b),C=a/(p.depth-1||1),Qx(l,function(B){E=(B.getLayout().x+b)*S,P=O==="TB"?(B.depth-1)*C:a-(B.depth-1)*C,B.setLayout({x:E,y:P},!0)}))}}}function a0e(r){r.eachSeriesByType("tree",function(e){var t=e.getData(),i=t.tree;i.eachNode(function(n){var a=n.getModel(),s=a.getModel("itemStyle").getItemStyle(),o=t.ensureUniqueItemVisual(n.dataIndex,"style");mt(o,s)})})}function o0e(r){r.registerAction({type:"treeExpandAndCollapse",event:"treeExpandAndCollapse",update:"update"},function(e,t){t.eachComponent({mainType:"series",subType:"tree",query:e},function(i){var n=e.dataIndex,a=i.getData().tree,s=a.getNodeByDataIndex(n);s.isExpand=!s.isExpand})}),r.registerAction({type:"treeRoam",event:"treeRoam",update:"none"},function(e,t,i){t.eachComponent({mainType:"series",subType:"tree",query:e},function(n){var a=n.coordinateSystem,s=UL(a,e,void 0,i);n.setCenter&&n.setCenter(s.center),n.setZoom&&n.setZoom(s.zoom)})})}function s0e(r){r.registerChartView(W_e),r.registerSeriesModel(t0e),r.registerLayout(i0e),r.registerVisual(a0e),o0e(r)}var a6=["treemapZoomToNode","treemapRender","treemapMove"];function l0e(r){for(var e=0;e<a6.length;e++)r.registerAction({type:a6[e],update:"updateView"},ca);r.registerAction({type:"treemapRootToNode",update:"updateView"},function(t,i){i.eachComponent({mainType:"series",subType:"treemap",query:t},n);function n(a,s){var o=["treemapZoomToNode","treemapRootToNode"],l=Ew(t,o,a);if(l){var c=a.getViewRoot();c&&(t.direction=$L(c,l.node)?"rollUp":"drillDown"),a.resetViewRoot(l.node)}}})}function MG(r){var e=r.getData(),t=e.tree,i={};t.eachNode(function(n){for(var a=n;a&&a.depth>1;)a=a.parentNode;var s=c3(r.ecModel,a.name||a.dataIndex+"",i);n.setVisual("decal",s)})}var u0e=(function(r){Ye(e,r);function e(){var t=r!==null&&r.apply(this,arguments)||this;return t.type=e.type,t.preventUsingHoverLayer=!0,t}return e.prototype.getInitialData=function(t,i){var n={name:t.name,children:t.data};EG(n);var a=t.levels||[],s=this.designatedVisualItemStyle={},o=new Si({itemStyle:s},this,i);a=t.levels=c0e(a,i);var l=wt(a||[],function(p){return new Si(p,o,i)},this),c=jL.createTree(n,this,f);function f(p){p.wrapMethod("getItemModel",function(y,b){var S=c.getNodeByDataIndex(b),C=S?l[S.depth]:null;return y.parentModel=C||o,y})}return c.data},e.prototype.optionUpdated=function(){this.resetViewRoot()},e.prototype.formatTooltip=function(t,i,n){var a=this.getData(),s=this.getRawValue(t),o=a.getName(t);return po("nameValue",{name:o,value:s})},e.prototype.getDataParams=function(t){var i=r.prototype.getDataParams.apply(this,arguments),n=this.getData().tree.getNodeByDataIndex(t);return i.treeAncestors=sM(n,this),i.treePathInfo=i.treeAncestors,i},e.prototype.setLayoutInfo=function(t){this.layoutInfo=this.layoutInfo||{},mt(this.layoutInfo,t)},e.prototype.mapIdToIndex=function(t){var i=this._idIndexMap;i||(i=this._idIndexMap=Qt(),this._idIndexMapCount=0);var n=i.get(t);return n==null&&i.set(t,n=this._idIndexMapCount++),n},e.prototype.getViewRoot=function(){return this._viewRoot},e.prototype.resetViewRoot=function(t){t?this._viewRoot=t:t=this._viewRoot;var i=this.getRawData().tree.root;(!t||t!==i&&!i.contains(t))&&(this._viewRoot=i)},e.prototype.enableAriaDecal=function(){MG(this)},e.type="series.treemap",e.layoutMode="box",e.defaultOption={progressive:0,left:"center",top:"middle",width:"80%",height:"80%",sort:!0,clipWindow:"origin",squareRatio:.5*(1+Math.sqrt(5)),leafDepth:null,drillDownIcon:"▶",zoomToNodeRatio:.32*.32,scaleLimit:null,roam:!0,nodeClick:"zoomToNode",animation:!0,animationDurationUpdate:900,animationEasing:"quinticInOut",breadcrumb:{show:!0,height:22,left:"center",top:"bottom",emptyItemWidth:25,itemStyle:{color:"rgba(0,0,0,0.7)",textStyle:{color:"#fff"}},emphasis:{itemStyle:{color:"rgba(0,0,0,0.9)"}}},label:{show:!0,distance:0,padding:5,position:"inside",color:"#fff",overflow:"truncate"},upperLabel:{show:!1,position:[0,"50%"],height:20,overflow:"truncate",verticalAlign:"middle"},itemStyle:{color:null,colorAlpha:null,colorSaturation:null,borderWidth:0,gapWidth:0,borderColor:"#fff",borderColorSaturation:null},emphasis:{upperLabel:{show:!0,position:[0,"50%"],overflow:"truncate",verticalAlign:"middle"}},visualDimension:0,visualMin:null,visualMax:null,color:[],colorAlpha:null,colorSaturation:null,colorMappingBy:"index",visibleMin:10,childrenVisibleMin:null,levels:[]},e})(Xi);function EG(r){var e=0;se(r.children,function(i){EG(i);var n=i.value;xt(n)&&(n=n[0]),e+=n});var t=r.value;xt(t)&&(t=t[0]),(t==null||isNaN(t))&&(t=e),t<0&&(t=0),xt(r.value)?r.value[0]=t:r.value=t}function c0e(r,e){var t=Gi(e.get("color")),i=Gi(e.get(["aria","decal","decals"]));if(t){r=r||[];var n,a;se(r,function(o){var l=new Si(o),c=l.get("color"),f=l.get("decal");(l.get(["itemStyle","color"])||c&&c!=="none")&&(n=!0),(l.get(["itemStyle","decal"])||f&&f!=="none")&&(a=!0)});var s=r[0]||(r[0]={});return n||(s.color=t.slice()),!a&&i&&(s.decal=i.slice()),r}}var h0e=8,o6=8,GI=5,f0e=(function(){function r(e){this.group=new mr,e.add(this.group)}return r.prototype.render=function(e,t,i,n){var a=e.getModel("breadcrumb"),s=this.group;if(s.removeAll(),!(!a.get("show")||!i)){var o=a.getModel("itemStyle"),l=a.getModel("emphasis"),c=o.getModel("textStyle"),f=l.getModel(["itemStyle","textStyle"]),p={pos:{left:a.get("left"),right:a.get("right"),top:a.get("top"),bottom:a.get("bottom")},box:{width:t.getWidth(),height:t.getHeight()},emptyItemWidth:a.get("emptyItemWidth"),totalWidth:0,renderList:[]};this._prepare(i,p,c),this._renderContent(e,p,o,l,c,f,n),XC(s,p.pos,p.box)}},r.prototype._prepare=function(e,t,i){for(var n=e;n;n=n.parentNode){var a=Za(n.getModel().get("name"),""),s=i.getTextRect(a),o=Math.max(s.width+h0e*2,t.emptyItemWidth);t.totalWidth+=o+o6,t.renderList.push({node:n,text:a,width:o})}},r.prototype._renderContent=function(e,t,i,n,a,s,o){for(var l=0,c=t.emptyItemWidth,f=e.get(["breadcrumb","height"]),p=nfe(t.pos,t.box),y=t.totalWidth,b=t.renderList,S=n.getModel("itemStyle").getItemStyle(),C=b.length-1;C>=0;C--){var E=b[C],P=E.node,O=E.width,B=E.text;y>p.width&&(y-=O-c,O=c,B=null);var F=new Rs({shape:{points:d0e(l,0,O,f,C===b.length-1,C===0)},style:lr(i.getItemStyle(),{lineJoin:"bevel"}),textContent:new si({style:cn(a,{text:B})}),textConfig:{position:"inside"},z2:ob*1e4,onclick:Sr(o,P)});F.disableLabelAnimation=!0,F.getTextContent().ensureState("emphasis").style=cn(s,{text:B}),F.ensureState("emphasis").style=S,Hn(F,n.get("focus"),n.get("blurScope"),n.get("disabled")),this.group.add(F),p0e(F,e,P),l+=O+o6}},r.prototype.remove=function(){this.group.removeAll()},r})();function d0e(r,e,t,i,n,a){var s=[[n?r:r-GI,e],[r+t,e],[r+t,e+i],[n?r:r-GI,e+i]];return!a&&s.splice(2,0,[r+t+GI,e+i/2]),!n&&s.push([r,e+i/2]),s}function p0e(r,e,t){br(r).eventData={componentType:"series",componentSubType:"treemap",componentIndex:e.componentIndex,seriesIndex:e.seriesIndex,seriesName:e.name,seriesType:"treemap",selfType:"breadcrumb",nodeData:{dataIndex:t&&t.dataIndex,name:t&&t.name},treePathInfo:t&&sM(t,e)}}var g0e=(function(){function r(){this._storage=[],this._elExistsMap={}}return r.prototype.add=function(e,t,i,n,a){return this._elExistsMap[e.id]?!1:(this._elExistsMap[e.id]=!0,this._storage.push({el:e,target:t,duration:i,delay:n,easing:a}),!0)},r.prototype.finished=function(e){return this._finishedCallback=e,this},r.prototype.start=function(){for(var e=this,t=this._storage.length,i=function(){t--,t<=0&&(e._storage.length=0,e._elExistsMap={},e._finishedCallback&&e._finishedCallback())},n=0,a=this._storage.length;n<a;n++){var s=this._storage[n];s.el.animateTo(s.target,{duration:s.duration,delay:s.delay,easing:s.easing,setToFinal:!0,done:i,aborted:i})}return this},r})();function v0e(){return new g0e}var z3=mr,s6=li,l6=3,u6="label",c6="upperLabel",m0e=ob*10,y0e=ob*2,_0e=ob*3,Im=yy([["fill","color"],["stroke","strokeColor"],["lineWidth","strokeWidth"],["shadowBlur"],["shadowOffsetX"],["shadowOffsetY"],["shadowColor"]]),h6=function(r){var e=Im(r);return e.stroke=e.fill=e.lineWidth=null,e},YA=fi(),b0e=(function(r){Ye(e,r);function e(){var t=r!==null&&r.apply(this,arguments)||this;return t.type=e.type,t._state="ready",t._storage=Jx(),t}return e.prototype.render=function(t,i,n,a){var s=i.findComponents({mainType:"series",subType:"treemap",query:a});if(!(Or(s,t)<0)){this.seriesModel=t,this.api=n,this.ecModel=i;var o=["treemapZoomToNode","treemapRootToNode"],l=Ew(a,o,t),c=a&&a.type,f=t.layoutInfo,p=!this._oldTree,y=this._storage,b=c==="treemapRootToNode"&&l&&y?{rootNodeGroup:y.nodeGroup[l.node.getRawIndex()],direction:a.direction}:null,S=this._giveContainerGroup(f),C=t.get("animation"),E=this._doRender(S,t,b);C&&!p&&(!c||c==="treemapZoomToNode"||c==="treemapRootToNode")?this._doAnimation(S,E,t,b):E.renderFinally(),this._resetController(n),this._renderBreadcrumb(t,n,l)}},e.prototype._giveContainerGroup=function(t){var i=this._containerGroup;return i||(i=this._containerGroup=new z3,this._initEvents(i),this.group.add(i)),i.x=t.x,i.y=t.y,i},e.prototype._doRender=function(t,i,n){var a=i.getData().tree,s=this._oldTree,o=Jx(),l=Jx(),c=this._storage,f=[];function p(O,B,F,W){return x0e(i,l,c,n,o,f,O,B,F,W)}C(a.root?[a.root]:[],s&&s.root?[s.root]:[],t,a===s||!s,0);var y=E(c);if(this._oldTree=a,this._storage=l,this._controllerHost){var b=this.seriesModel.layoutInfo,S=a.root.getLayout();S.width===b.width&&S.height===b.height&&(this._controllerHost.zoom=1)}return{lastsForAnimation:o,willDeleteEls:y,renderFinally:P};function C(O,B,F,W,$){W?(B=O,se(O,function(ee,te){!ee.isRemoved()&&Q(te,te)})):new fp(B,O,q,q).add(Q).update(Q).remove(Sr(Q,null)).execute();function q(ee){return ee.getId()}function Q(ee,te){var ae=ee!=null?O[ee]:null,de=te!=null?B[te]:null,ve=p(ae,de,F,$);ve&&C(ae&&ae.viewChildren||[],de&&de.viewChildren||[],ve,W,$+1)}}function E(O){var B=Jx();return O&&se(O,function(F,W){var $=B[W];se(F,function(q){q&&($.push(q),YA(q).willDelete=!0)})}),B}function P(){se(y,function(O){se(O,function(B){B.parent&&B.parent.remove(B)})}),se(f,function(O){O.invisible=!0,O.dirty()})}},e.prototype._doAnimation=function(t,i,n,a){var s=n.get("animationDurationUpdate"),o=n.get("animationEasing"),l=(sr(s)?0:s)||0,c=(sr(o)?null:o)||"cubicOut",f=v0e();se(i.willDeleteEls,function(p,y){se(p,function(b,S){if(!b.invisible){var C=b.parent,E,P=YA(C);if(a&&a.direction==="drillDown")E=C===a.rootNodeGroup?{shape:{x:0,y:0,width:P.nodeWidth,height:P.nodeHeight},style:{opacity:0}}:{style:{opacity:0}};else{var O=0,B=0;P.willDelete||(O=P.nodeWidth/2,B=P.nodeHeight/2),E=y==="nodeGroup"?{x:O,y:B,style:{opacity:0}}:{shape:{x:O,y:B,width:0,height:0},style:{opacity:0}}}E&&f.add(b,E,l,0,c)}})}),se(this._storage,function(p,y){se(p,function(b,S){var C=i.lastsForAnimation[y][S],E={};C&&(b instanceof mr?C.oldX!=null&&(E.x=b.x,E.y=b.y,b.x=C.oldX,b.y=C.oldY):(C.oldShape&&(E.shape=mt({},b.shape),b.setShape(C.oldShape)),C.fadein?(b.setStyle("opacity",0),E.style={opacity:1}):b.style.opacity!==1&&(E.style={opacity:1})),f.add(b,E,l,0,c))})},this),this._state="animating",f.finished(Xt(function(){this._state="ready",i.renderFinally()},this)).start()},e.prototype._resetController=function(t){var i=this._controller,n=this._controllerHost;n||(this._controllerHost={target:this.group},n=this._controllerHost),i||(i=this._controller=new sS(t.getZr()),i.enable(this.seriesModel.get("roam")),n.zoomLimit=this.seriesModel.get("scaleLimit"),n.zoom=this.seriesModel.get("zoom"),i.on("pan",Xt(this._onPan,this)),i.on("zoom",Xt(this._onZoom,this)));var a=new Dr(0,0,t.getWidth(),t.getHeight());i.setPointerChecker(function(s,o,l){return a.contain(o,l)})},e.prototype._clearController=function(){var t=this._controller;this._controllerHost=null,t&&(t.dispose(),t=null)},e.prototype._onPan=function(t){if(this._state!=="animating"&&(Math.abs(t.dx)>l6||Math.abs(t.dy)>l6)){var i=this.seriesModel.getData().tree.root;if(!i)return;var n=i.getLayout();if(!n)return;this.api.dispatchAction({type:"treemapMove",from:this.uid,seriesId:this.seriesModel.id,rootRect:{x:n.x+t.dx,y:n.y+t.dy,width:n.width,height:n.height}})}},e.prototype._onZoom=function(t){var i=t.originX,n=t.originY,a=t.scale;if(this._state!=="animating"){var s=this.seriesModel.getData().tree.root;if(!s)return;var o=s.getLayout();if(!o)return;var l=new Dr(o.x,o.y,o.width,o.height),c=null,f=this._controllerHost;c=f.zoomLimit;var p=f.zoom=f.zoom||1;if(p*=a,c){var y=c.min||0,b=c.max||1/0;p=Math.max(Math.min(b,p),y)}var S=p/f.zoom;f.zoom=p;var C=this.seriesModel.layoutInfo;i-=C.x,n-=C.y;var E=kl();Ph(E,E,[-i,-n]),EC(E,E,[S,S]),Ph(E,E,[i,n]),l.applyTransform(E),this.api.dispatchAction({type:"treemapRender",from:this.uid,seriesId:this.seriesModel.id,rootRect:{x:l.x,y:l.y,width:l.width,height:l.height}})}},e.prototype._initEvents=function(t){var i=this;t.on("click",function(n){if(i._state==="ready"){var a=i.seriesModel.get("nodeClick",!0);if(a){var s=i.findTarget(n.offsetX,n.offsetY);if(s){var o=s.node;if(o.getLayout().isLeafRoot)i._rootToNode(s);else if(a==="zoomToNode")i._zoomToNode(s);else if(a==="link"){var l=o.hostTree.data.getItemModel(o.dataIndex),c=l.get("link",!0),f=l.get("target",!0)||"blank";c&&DA(c,f)}}}}},this)},e.prototype._renderBreadcrumb=function(t,i,n){var a=this;n||(n=t.get("leafDepth",!0)!=null?{node:t.getViewRoot()}:this.findTarget(i.getWidth()/2,i.getHeight()/2),n||(n={node:t.getData().tree.root})),(this._breadcrumb||(this._breadcrumb=new f0e(this.group))).render(t,i,n.node,function(s){a._state!=="animating"&&($L(t.getViewRoot(),s)?a._rootToNode({node:s}):a._zoomToNode({node:s}))})},e.prototype.remove=function(){this._clearController(),this._containerGroup&&this._containerGroup.removeAll(),this._storage=Jx(),this._state="ready",this._breadcrumb&&this._breadcrumb.remove()},e.prototype.dispose=function(){this._clearController()},e.prototype._zoomToNode=function(t){this.api.dispatchAction({type:"treemapZoomToNode",from:this.uid,seriesId:this.seriesModel.id,targetNode:t.node})},e.prototype._rootToNode=function(t){this.api.dispatchAction({type:"treemapRootToNode",from:this.uid,seriesId:this.seriesModel.id,targetNode:t.node})},e.prototype.findTarget=function(t,i){var n,a=this.seriesModel.getViewRoot();return a.eachNode({attr:"viewChildren",order:"preorder"},function(s){var o=this._storage.background[s.getRawIndex()];if(o){var l=o.transformCoordToLocal(t,i),c=o.shape;if(c.x<=l[0]&&l[0]<=c.x+c.width&&c.y<=l[1]&&l[1]<=c.y+c.height)n={node:s,offsetX:l[0],offsetY:l[1]};else return!1}},this),n},e.type="treemap",e})(Fi);function Jx(){return{nodeGroup:[],background:[],content:[]}}function x0e(r,e,t,i,n,a,s,o,l,c){if(!s)return;var f=s.getLayout(),p=r.getData(),y=s.getModel();if(p.setItemGraphicEl(s.dataIndex,null),!f||!f.isInView)return;var b=f.width,S=f.height,C=f.borderWidth,E=f.invisible,P=s.getRawIndex(),O=o&&o.getRawIndex(),B=s.viewChildren,F=f.upperHeight,W=B&&B.length,$=y.getModel("itemStyle"),q=y.getModel(["emphasis","itemStyle"]),Q=y.getModel(["blur","itemStyle"]),ee=y.getModel(["select","itemStyle"]),te=$.get("borderRadius")||0,ae=Dt("nodeGroup",z3);if(!ae)return;if(l.add(ae),ae.x=f.x||0,ae.y=f.y||0,ae.markRedraw(),YA(ae).nodeWidth=b,YA(ae).nodeHeight=S,f.isAboveViewRoot)return ae;var de=Dt("background",s6,c,y0e);de&&ct(ae,de,W&&f.upperLabelHeight);var ve=y.getModel("emphasis"),ye=ve.get("focus"),Ae=ve.get("blurScope"),me=ve.get("disabled"),De=ye==="ancestor"?s.getAncestorsIndices():ye==="descendant"?s.getDescendantIndices():ye;if(W)gw(ae)&&jm(ae,!1),de&&(jm(de,!me),p.setItemGraphicEl(s.dataIndex,de),r3(de,De,Ae));else{var Fe=Dt("content",s6,c,_0e);Fe&&xe(ae,Fe),de.disableMorphing=!0,de&&gw(de)&&jm(de,!1),jm(ae,!me),p.setItemGraphicEl(s.dataIndex,ae);var je=y.getShallow("cursor");je&&Fe.attr("cursor",je),r3(ae,De,Ae)}return ae;function ct(Kt,zt,yr){var Gt=br(zt);if(Gt.dataIndex=s.dataIndex,Gt.seriesIndex=r.seriesIndex,zt.setShape({x:0,y:0,width:b,height:S,r:te}),E)$e(zt);else{zt.invisible=!1;var Jt=s.getVisual("style"),Tr=Jt.stroke,dr=h6($);dr.fill=Tr;var $r=Im(q);$r.fill=q.get("borderColor");var ii=Im(Q);ii.fill=Q.get("borderColor");var Zi=Im(ee);if(Zi.fill=ee.get("borderColor"),yr){var In=b-2*C;pt(zt,Tr,Jt.opacity,{x:C,y:0,width:In,height:F})}else zt.removeTextContent();zt.setStyle(dr),zt.ensureState("emphasis").style=$r,zt.ensureState("blur").style=ii,zt.ensureState("select").style=Zi,_y(zt)}Kt.add(zt)}function xe(Kt,zt){var yr=br(zt);yr.dataIndex=s.dataIndex,yr.seriesIndex=r.seriesIndex;var Gt=Math.max(b-2*C,0),Jt=Math.max(S-2*C,0);if(zt.culling=!0,zt.setShape({x:C,y:C,width:Gt,height:Jt,r:te}),E)$e(zt);else{zt.invisible=!1;var Tr=s.getVisual("style"),dr=Tr.fill,$r=h6($);$r.fill=dr,$r.decal=Tr.decal;var ii=Im(q),Zi=Im(Q),In=Im(ee);pt(zt,dr,Tr.opacity,null),zt.setStyle($r),zt.ensureState("emphasis").style=ii,zt.ensureState("blur").style=Zi,zt.ensureState("select").style=In,_y(zt)}Kt.add(zt)}function $e(Kt){!Kt.invisible&&a.push(Kt)}function pt(Kt,zt,yr,Gt){var Jt=y.getModel(Gt?c6:u6),Tr=Za(y.get("name"),null),dr=Jt.getShallow("show");rs(Kt,fo(y,Gt?c6:u6),{defaultText:dr?Tr:null,inheritColor:zt,defaultOpacity:yr,labelFetcher:r,labelDataIndex:s.dataIndex});var $r=Kt.getTextContent();if($r){var ii=$r.style,Zi=CC(ii.padding||0);Gt&&(Kt.setTextConfig({layoutRect:Gt}),$r.disableLabelLayout=!0),$r.beforeUpdate=function(){var Li=Math.max((Gt?Gt.width:Kt.shape.width)-Zi[1]-Zi[3],0),Oa=Math.max((Gt?Gt.height:Kt.shape.height)-Zi[0]-Zi[2],0);(ii.width!==Li||ii.height!==Oa)&&$r.setStyle({width:Li,height:Oa})},ii.truncateMinChar=2,ii.lineOverflow="truncate",_t(ii,Gt,f);var In=$r.getState("emphasis");_t(In?In.style:null,Gt,f)}}function _t(Kt,zt,yr){var Gt=Kt?Kt.text:null;if(!zt&&yr.isLeafRoot&&Gt!=null){var Jt=r.get("drillDownIcon",!0);Kt.text=Jt?Jt+" "+Gt:Gt}}function Dt(Kt,zt,yr,Gt){var Jt=O!=null&&t[Kt][O],Tr=n[Kt];return Jt?(t[Kt][O]=null,qt(Tr,Jt)):E||(Jt=new zt,Jt instanceof Tc&&(Jt.z2=w0e(yr,Gt)),_r(Tr,Jt)),e[Kt][P]=Jt}function qt(Kt,zt){var yr=Kt[P]={};zt instanceof z3?(yr.oldX=zt.x,yr.oldY=zt.y):yr.oldShape=mt({},zt.shape)}function _r(Kt,zt){var yr=Kt[P]={},Gt=s.parentNode,Jt=zt instanceof mr;if(Gt&&(!i||i.direction==="drillDown")){var Tr=0,dr=0,$r=n.background[Gt.getRawIndex()];!i&&$r&&$r.oldShape&&(Tr=$r.oldShape.width,dr=$r.oldShape.height),Jt?(yr.oldX=0,yr.oldY=dr):yr.oldShape={x:Tr,y:dr,width:0,height:0}}yr.fadein=!Jt}}function w0e(r,e){return r*m0e+e}var Iw=se,S0e=cr,KA=-1,ho=(function(){function r(e){var t=e.mappingMethod,i=e.type,n=this.option=hr(e);this.type=i,this.mappingMethod=t,this._normalizeData=C0e[t];var a=r.visualHandlers[i];this.applyVisual=a.applyVisual,this.getColorMapper=a.getColorMapper,this._normalizedToVisual=a._normalizedToVisual[t],t==="piecewise"?(XI(n),T0e(n)):t==="category"?n.categories?A0e(n):XI(n,!0):(Is(t!=="linear"||n.dataExtent),XI(n))}return r.prototype.mapValueToVisual=function(e){var t=this._normalizeData(e);return this._normalizedToVisual(t,e)},r.prototype.getNormalizer=function(){return Xt(this._normalizeData,this)},r.listVisualTypes=function(){return qr(r.visualHandlers)},r.isValidType=function(e){return r.visualHandlers.hasOwnProperty(e)},r.eachVisual=function(e,t,i){cr(e)?se(e,t,i):t.call(i,e)},r.mapVisual=function(e,t,i){var n,a=xt(e)?[]:cr(e)?{}:(n=!0,null);return r.eachVisual(e,function(s,o){var l=t.call(i,s,o);n?a=l:a[o]=l}),a},r.retrieveVisuals=function(e){var t={},i;return e&&Iw(r.visualHandlers,function(n,a){e.hasOwnProperty(a)&&(t[a]=e[a],i=!0)}),i?t:null},r.prepareVisualTypes=function(e){if(xt(e))e=e.slice();else if(S0e(e)){var t=[];Iw(e,function(i,n){t.push(n)}),e=t}else return[];return e.sort(function(i,n){return n==="color"&&i!=="color"&&i.indexOf("color")===0?1:-1}),e},r.dependsOn=function(e,t){return t==="color"?!!(e&&e.indexOf(t)===0):e===t},r.findPieceIndex=function(e,t,i){for(var n,a=1/0,s=0,o=t.length;s<o;s++){var l=t[s].value;if(l!=null){if(l===e||$t(l)&&l===e+"")return s;i&&y(l,s)}}for(var s=0,o=t.length;s<o;s++){var c=t[s],f=c.interval,p=c.close;if(f){if(f[0]===-1/0){if(i2(p[1],e,f[1]))return s}else if(f[1]===1/0){if(i2(p[0],f[0],e))return s}else if(i2(p[0],f[0],e)&&i2(p[1],e,f[1]))return s;i&&y(f[0],s),i&&y(f[1],s)}}if(i)return e===1/0?t.length-1:e===-1/0?0:n;function y(b,S){var C=Math.abs(b-e);C<a&&(a=C,n=S)}},r.visualHandlers={color:{applyVisual:e1("color"),getColorMapper:function(){var e=this.option;return Xt(e.mappingMethod==="category"?function(t,i){return!i&&(t=this._normalizeData(t)),S1.call(this,t)}:function(t,i,n){var a=!!n;return!i&&(t=this._normalizeData(t)),n=F1(t,e.parsedVisual,n),a?n:Ch(n,"rgba")},this)},_normalizedToVisual:{linear:function(e){return Ch(F1(e,this.option.parsedVisual),"rgba")},category:S1,piecewise:function(e,t){var i=V3.call(this,t);return i==null&&(i=Ch(F1(e,this.option.parsedVisual),"rgba")),i},fixed:Pm}},colorHue:r2(function(e,t){return E0(e,t)}),colorSaturation:r2(function(e,t){return E0(e,null,t)}),colorLightness:r2(function(e,t){return E0(e,null,null,t)}),colorAlpha:r2(function(e,t){return cw(e,t)}),decal:{applyVisual:e1("decal"),_normalizedToVisual:{linear:null,category:S1,piecewise:null,fixed:null}},opacity:{applyVisual:e1("opacity"),_normalizedToVisual:F3([0,1])},liftZ:{applyVisual:e1("liftZ"),_normalizedToVisual:{linear:Pm,category:Pm,piecewise:Pm,fixed:Pm}},symbol:{applyVisual:function(e,t,i){var n=this.mapValueToVisual(e);i("symbol",n)},_normalizedToVisual:{linear:f6,category:S1,piecewise:function(e,t){var i=V3.call(this,t);return i==null&&(i=f6.call(this,e)),i},fixed:Pm}},symbolSize:{applyVisual:e1("symbolSize"),_normalizedToVisual:F3([0,1])}},r})();function T0e(r){var e=r.pieceList;r.hasSpecialVisual=!1,se(e,function(t,i){t.originIndex=i,t.visual!=null&&(r.hasSpecialVisual=!0)})}function A0e(r){var e=r.categories,t=r.categoryMap={},i=r.visual;if(Iw(e,function(s,o){t[s]=o}),!xt(i)){var n=[];cr(i)?Iw(i,function(s,o){var l=t[o];n[l??KA]=s}):n[KA]=i,i=IG(r,n)}for(var a=e.length-1;a>=0;a--)i[a]==null&&(delete t[e[a]],e.pop())}function XI(r,e){var t=r.visual,i=[];cr(t)?Iw(t,function(a){i.push(a)}):t!=null&&i.push(t);var n={color:1,symbol:1};!e&&i.length===1&&!n.hasOwnProperty(r.type)&&(i[1]=i[0]),IG(r,i)}function r2(r){return{applyVisual:function(e,t,i){var n=this.mapValueToVisual(e);i("color",r(t("color"),n))},_normalizedToVisual:F3([0,1])}}function f6(r){var e=this.option.visual;return e[Math.round(Ii(r,[0,1],[0,e.length-1],!0))]||{}}function e1(r){return function(e,t,i){i(r,this.mapValueToVisual(e))}}function S1(r){var e=this.option.visual;return e[this.option.loop&&r!==KA?r%e.length:r]}function Pm(){return this.option.visual[0]}function F3(r){return{linear:function(e){return Ii(e,r,this.option.visual,!0)},category:S1,piecewise:function(e,t){var i=V3.call(this,t);return i==null&&(i=Ii(e,r,this.option.visual,!0)),i},fixed:Pm}}function V3(r){var e=this.option,t=e.pieceList;if(e.hasSpecialVisual){var i=ho.findPieceIndex(r,t),n=t[i];if(n&&n.visual)return n.visual[this.type]}}function IG(r,e){return r.visual=e,r.type==="color"&&(r.parsedVisual=wt(e,function(t){var i=al(t);return i||[0,0,0,1]})),e}var C0e={linear:function(r){return Ii(r,this.option.dataExtent,[0,1],!0)},piecewise:function(r){var e=this.option.pieceList,t=ho.findPieceIndex(r,e,!0);if(t!=null)return Ii(t,[0,e.length-1],[0,1],!0)},category:function(r){var e=this.option.categories?this.option.categoryMap[r]:r;return e??KA},fixed:ca};function i2(r,e,t){return r?e<=t:e<t}var M0e="itemStyle",PG=fi();const E0e={seriesType:"treemap",reset:function(r){var e=r.getData().tree,t=e.root;t.isRemoved()||RG(t,{},r.getViewRoot().getAncestors(),r)}};function RG(r,e,t,i){var n=r.getModel(),a=r.getLayout(),s=r.hostTree.data;if(!(!a||a.invisible||!a.isInView)){var o=n.getModel(M0e),l=I0e(o,e,i),c=s.ensureUniqueItemVisual(r.dataIndex,"style"),f=o.get("borderColor"),p=o.get("borderColorSaturation"),y;p!=null&&(y=d6(l),f=P0e(p,y)),c.stroke=f;var b=r.viewChildren;if(!b||!b.length)y=d6(l),c.fill=y;else{var S=R0e(r,n,a,o,l,b);se(b,function(C,E){if(C.depth>=t.length||C===t[C.depth]){var P=D0e(n,l,C,E,S,i);RG(C,P,t,i)}})}}}function I0e(r,e,t){var i=mt({},e),n=t.designatedVisualItemStyle;return se(["color","colorAlpha","colorSaturation"],function(a){n[a]=e[a];var s=r.get(a);n[a]=null,s!=null&&(i[a]=s)}),i}function d6(r){var e=ZI(r,"color");if(e){var t=ZI(r,"colorAlpha"),i=ZI(r,"colorSaturation");return i&&(e=E0(e,null,null,i)),t&&(e=cw(e,t)),e}}function P0e(r,e){return e!=null?E0(e,null,null,r):null}function ZI(r,e){var t=r[e];if(t!=null&&t!=="none")return t}function R0e(r,e,t,i,n,a){if(!(!a||!a.length)){var s=qI(e,"color")||n.color!=null&&n.color!=="none"&&(qI(e,"colorAlpha")||qI(e,"colorSaturation"));if(s){var o=e.get("visualMin"),l=e.get("visualMax"),c=t.dataExtent.slice();o!=null&&o<c[0]&&(c[0]=o),l!=null&&l>c[1]&&(c[1]=l);var f=e.get("colorMappingBy"),p={type:s.name,dataExtent:c,visual:s.range};p.type==="color"&&(f==="index"||f==="id")?(p.mappingMethod="category",p.loop=!0):p.mappingMethod="linear";var y=new ho(p);return PG(y).drColorMappingBy=f,y}}}function qI(r,e){var t=r.get(e);return xt(t)&&t.length?{name:e,range:t}:null}function D0e(r,e,t,i,n,a){var s=mt({},e);if(n){var o=n.type,l=o==="color"&&PG(n).drColorMappingBy,c=l==="index"?i:l==="id"?a.mapIdToIndex(t.getId()):t.getValue(r.get("visualDimension"));s[o]=n.mapValueToVisual(c)}return s}var Pw=Math.max,QA=Math.min,p6=uo,WL=se,DG=["itemStyle","borderWidth"],k0e=["itemStyle","gapWidth"],L0e=["upperLabel","show"],O0e=["upperLabel","height"];const N0e={seriesType:"treemap",reset:function(r,e,t,i){var n=t.getWidth(),a=t.getHeight(),s=r.option,o=La(r.getBoxLayoutParams(),{width:t.getWidth(),height:t.getHeight()}),l=s.size||[],c=Vt(p6(o.width,l[0]),n),f=Vt(p6(o.height,l[1]),a),p=i&&i.type,y=["treemapZoomToNode","treemapRootToNode"],b=Ew(i,y,r),S=p==="treemapRender"||p==="treemapMove"?i.rootRect:null,C=r.getViewRoot(),E=CG(C);if(p!=="treemapMove"){var P=p==="treemapZoomToNode"?H0e(r,b,C,c,f):S?[S.width,S.height]:[c,f],O=s.sort;O&&O!=="asc"&&O!=="desc"&&(O="desc");var B={squareRatio:s.squareRatio,sort:O,leafDepth:s.leafDepth};C.hostTree.clearLayouts();var F={x:0,y:0,width:P[0],height:P[1],area:P[0]*P[1]};C.setLayout(F),kG(C,B,!1,0),F=C.getLayout(),WL(E,function($,q){var Q=(E[q+1]||C).getValue();$.setLayout(mt({dataExtent:[Q,Q],borderWidth:0,upperHeight:0},F))})}var W=r.getData().tree.root;W.setLayout(j0e(o,S,b),!0),r.setLayoutInfo(o),LG(W,new Dr(-o.x,-o.y,n,a),E,C,0)}};function kG(r,e,t,i){var n,a;if(!r.isRemoved()){var s=r.getLayout();n=s.width,a=s.height;var o=r.getModel(),l=o.get(DG),c=o.get(k0e)/2,f=OG(o),p=Math.max(l,f),y=l-c,b=p-c;r.setLayout({borderWidth:l,upperHeight:p,upperLabelHeight:f},!0),n=Pw(n-2*y,0),a=Pw(a-y-b,0);var S=n*a,C=B0e(r,o,S,e,t,i);if(C.length){var E={x:y,y:b,width:n,height:a},P=QA(n,a),O=1/0,B=[];B.area=0;for(var F=0,W=C.length;F<W;){var $=C[F];B.push($),B.area+=$.getLayout().area;var q=U0e(B,P,e.squareRatio);q<=O?(F++,O=q):(B.area-=B.pop().getLayout().area,g6(B,P,E,c,!1),P=QA(E.width,E.height),B.length=B.area=0,O=1/0)}if(B.length&&g6(B,P,E,c,!0),!t){var Q=o.get("childrenVisibleMin");Q!=null&&S<Q&&(t=!0)}for(var F=0,W=C.length;F<W;F++)kG(C[F],e,t,i+1)}}}function B0e(r,e,t,i,n,a){var s=r.children||[],o=i.sort;o!=="asc"&&o!=="desc"&&(o=null);var l=i.leafDepth!=null&&i.leafDepth<=a;if(n&&!l)return r.viewChildren=[];s=wi(s,function(b){return!b.isRemoved()}),F0e(s,o);var c=V0e(e,s,o);if(c.sum===0)return r.viewChildren=[];if(c.sum=z0e(e,t,c.sum,o,s),c.sum===0)return r.viewChildren=[];for(var f=0,p=s.length;f<p;f++){var y=s[f].getValue()/c.sum*t;s[f].setLayout({area:y})}return l&&(s.length&&r.setLayout({isLeafRoot:!0},!0),s.length=0),r.viewChildren=s,r.setLayout({dataExtent:c.dataExtent},!0),s}function z0e(r,e,t,i,n){if(!i)return t;for(var a=r.get("visibleMin"),s=n.length,o=s,l=s-1;l>=0;l--){var c=n[i==="asc"?s-l-1:l].getValue();c/t*e<a&&(o=l,t-=c)}return i==="asc"?n.splice(0,s-o):n.splice(o,s-o),t}function F0e(r,e){return e&&r.sort(function(t,i){var n=e==="asc"?t.getValue()-i.getValue():i.getValue()-t.getValue();return n===0?e==="asc"?t.dataIndex-i.dataIndex:i.dataIndex-t.dataIndex:n}),r}function V0e(r,e,t){for(var i=0,n=0,a=e.length;n<a;n++)i+=e[n].getValue();var s=r.get("visualDimension"),o;return!e||!e.length?o=[NaN,NaN]:s==="value"&&t?(o=[e[e.length-1].getValue(),e[0].getValue()],t==="asc"&&o.reverse()):(o=[1/0,-1/0],WL(e,function(l){var c=l.getValue(s);c<o[0]&&(o[0]=c),c>o[1]&&(o[1]=c)})),{sum:i,dataExtent:o}}function U0e(r,e,t){for(var i=0,n=1/0,a=0,s=void 0,o=r.length;a<o;a++)s=r[a].getLayout().area,s&&(s<n&&(n=s),s>i&&(i=s));var l=r.area*r.area,c=e*e*t;return l?Pw(c*i/l,l/(c*n)):1/0}function g6(r,e,t,i,n){var a=e===t.width?0:1,s=1-a,o=["x","y"],l=["width","height"],c=t[o[a]],f=e?r.area/e:0;(n||f>t[l[s]])&&(f=t[l[s]]);for(var p=0,y=r.length;p<y;p++){var b=r[p],S={},C=f?b.getLayout().area/f:0,E=S[l[s]]=Pw(f-2*i,0),P=t[o[a]]+t[l[a]]-c,O=p===y-1||P<C?P:C,B=S[l[a]]=Pw(O-2*i,0);S[o[s]]=t[o[s]]+QA(i,E/2),S[o[a]]=c+QA(i,B/2),c+=O,b.setLayout(S,!0)}t[o[s]]+=f,t[l[s]]-=f}function H0e(r,e,t,i,n){var a=(e||{}).node,s=[i,n];if(!a||a===t)return s;for(var o,l=i*n,c=l*r.option.zoomToNodeRatio;o=a.parentNode;){for(var f=0,p=o.children,y=0,b=p.length;y<b;y++)f+=p[y].getValue();var S=a.getValue();if(S===0)return s;c*=f/S;var C=o.getModel(),E=C.get(DG),P=Math.max(E,OG(C));c+=4*E*E+(3*E+P)*Math.pow(c,.5),c>XR&&(c=XR),a=o}c<l&&(c=l);var O=Math.pow(c/l,.5);return[i*O,n*O]}function j0e(r,e,t){if(e)return{x:e.x,y:e.y};var i={x:0,y:0};if(!t)return i;var n=t.node,a=n.getLayout();if(!a)return i;for(var s=[a.width/2,a.height/2],o=n;o;){var l=o.getLayout();s[0]+=l.x,s[1]+=l.y,o=o.parentNode}return{x:r.width/2-s[0],y:r.height/2-s[1]}}function LG(r,e,t,i,n){var a=r.getLayout(),s=t[n],o=s&&s===r;if(!(s&&!o||n===t.length&&r!==i)){r.setLayout({isInView:!0,invisible:!o&&!e.intersect(a),isAboveViewRoot:o},!0);var l=new Dr(e.x-a.x,e.y-a.y,e.width,e.height);WL(r.viewChildren||[],function(c){LG(c,l,t,i,n+1)})}}function OG(r){return r.get(L0e)?r.get(O0e):0}function $0e(r){r.registerSeriesModel(u0e),r.registerChartView(b0e),r.registerVisual(E0e),r.registerLayout(N0e),l0e(r)}function W0e(r){var e=r.findComponents({mainType:"legend"});!e||!e.length||r.eachSeriesByType("graph",function(t){var i=t.getCategoriesData(),n=t.getGraph(),a=n.data,s=i.mapArray(i.getName);a.filterSelf(function(o){var l=a.getItemModel(o),c=l.getShallow("category");if(c!=null){di(c)&&(c=s[c]);for(var f=0;f<e.length;f++)if(!e[f].isSelected(c))return!1}return!0})})}function G0e(r){var e={};r.eachSeriesByType("graph",function(t){var i=t.getCategoriesData(),n=t.getData(),a={};i.each(function(s){var o=i.getName(s);a["ec-"+o]=s;var l=i.getItemModel(s),c=l.getModel("itemStyle").getItemStyle();c.fill||(c.fill=t.getColorFromPalette(o,e)),i.setItemVisual(s,"style",c);for(var f=["symbol","symbolSize","symbolKeepAspect"],p=0;p<f.length;p++){var y=l.getShallow(f[p],!0);y!=null&&i.setItemVisual(s,f[p],y)}}),i.count()&&n.each(function(s){var o=n.getItemModel(s),l=o.getShallow("category");if(l!=null){$t(l)&&(l=a["ec-"+l]);var c=i.getItemVisual(l,"style"),f=n.ensureUniqueItemVisual(s,"style");mt(f,c);for(var p=["symbol","symbolSize","symbolKeepAspect"],y=0;y<p.length;y++)n.setItemVisual(s,p[y],i.getItemVisual(l,p[y]))}})})}function n2(r){return r instanceof Array||(r=[r,r]),r}function X0e(r){r.eachSeriesByType("graph",function(e){var t=e.getGraph(),i=e.getEdgeData(),n=n2(e.get("edgeSymbol")),a=n2(e.get("edgeSymbolSize"));i.setVisual("fromSymbol",n&&n[0]),i.setVisual("toSymbol",n&&n[1]),i.setVisual("fromSymbolSize",a&&a[0]),i.setVisual("toSymbolSize",a&&a[1]),i.setVisual("style",e.getModel("lineStyle").getLineStyle()),i.each(function(s){var o=i.getItemModel(s),l=t.getEdgeByIndex(s),c=n2(o.getShallow("symbol",!0)),f=n2(o.getShallow("symbolSize",!0)),p=o.getModel("lineStyle").getLineStyle(),y=i.ensureUniqueItemVisual(s,"style");switch(mt(y,p),y.stroke){case"source":{var b=l.node1.getVisual("style");y.stroke=b&&b.fill;break}case"target":{var b=l.node2.getVisual("style");y.stroke=b&&b.fill;break}}c[0]&&l.setVisual("fromSymbol",c[0]),c[1]&&l.setVisual("toSymbol",c[1]),f[0]&&l.setVisual("fromSymbolSize",f[0]),f[1]&&l.setVisual("toSymbolSize",f[1])})})}var U3="-->",lM=function(r){return r.get("autoCurveness")||null},NG=function(r,e){var t=lM(r),i=20,n=[];if(di(t))i=t;else if(xt(t)){r.__curvenessList=t;return}e>i&&(i=e);var a=i%2?i+2:i+3;n=[];for(var s=0;s<a;s++)n.push((s%2?s+1:s)/10*(s%2?-1:1));r.__curvenessList=n},Rw=function(r,e,t){var i=[r.id,r.dataIndex].join("."),n=[e.id,e.dataIndex].join(".");return[t.uid,i,n].join(U3)},BG=function(r){var e=r.split(U3);return[e[0],e[2],e[1]].join(U3)},Z0e=function(r,e){var t=Rw(r.node1,r.node2,e);return e.__edgeMap[t]},q0e=function(r,e){var t=H3(Rw(r.node1,r.node2,e),e),i=H3(Rw(r.node2,r.node1,e),e);return t+i},H3=function(r,e){var t=e.__edgeMap;return t[r]?t[r].length:0};function Y0e(r){lM(r)&&(r.__curvenessList=[],r.__edgeMap={},NG(r))}function K0e(r,e,t,i){if(lM(t)){var n=Rw(r,e,t),a=t.__edgeMap,s=a[BG(n)];a[n]&&!s?a[n].isForward=!0:s&&a[n]&&(s.isForward=!0,a[n].isForward=!1),a[n]=a[n]||[],a[n].push(i)}}function GL(r,e,t,i){var n=lM(e),a=xt(n);if(!n)return null;var s=Z0e(r,e);if(!s)return null;for(var o=-1,l=0;l<s.length;l++)if(s[l]===t){o=l;break}var c=q0e(r,e);NG(e,c),r.lineStyle=r.lineStyle||{};var f=Rw(r.node1,r.node2,e),p=e.__curvenessList,y=a||c%2?0:1;if(s.isForward)return p[y+o];var b=BG(f),S=H3(b,e),C=p[o+S+y];return i?a?n&&n[0]===0?(S+y)%2?C:-C:((S%2?0:1)+y)%2?C:-C:(S+y)%2?C:-C:p[o+S+y]}function zG(r){var e=r.coordinateSystem;if(!(e&&e.type!=="view")){var t=r.getGraph();t.eachNode(function(i){var n=i.getModel();i.setLayout([+n.get("x"),+n.get("y")])}),XL(t,r)}}function XL(r,e){r.eachEdge(function(t,i){var n=Th(t.getModel().get(["lineStyle","curveness"]),-GL(t,e,i,!0),0),a=Bf(t.node1.getLayout()),s=Bf(t.node2.getLayout()),o=[a,s];+n&&o.push([(a[0]+s[0])/2-(a[1]-s[1])*n,(a[1]+s[1])/2-(s[0]-a[0])*n]),t.setLayout(o)})}function Q0e(r,e){r.eachSeriesByType("graph",function(t){var i=t.get("layout"),n=t.coordinateSystem;if(n&&n.type!=="view"){var a=t.getData(),s=[];se(n.dimensions,function(y){s=s.concat(a.mapDimensionsAll(y))});for(var o=0;o<a.count();o++){for(var l=[],c=!1,f=0;f<s.length;f++){var p=a.get(s[f],o);isNaN(p)||(c=!0),l.push(p)}c?a.setItemLayout(o,n.dataToPoint(l)):a.setItemLayout(o,[NaN,NaN])}XL(a.graph,t)}else(!i||i==="none")&&zG(t)})}function T1(r){var e=r.coordinateSystem;if(e.type!=="view")return 1;var t=r.option.nodeScaleRatio,i=e.scaleX,n=e.getZoom(),a=(n-1)*t+1;return a/i}function A1(r){var e=r.getVisual("symbolSize");return e instanceof Array&&(e=(e[0]+e[1])/2),+e}var v6=Math.PI,YI=[];function ZL(r,e,t,i){var n=r.coordinateSystem;if(!(n&&n.type!=="view")){var a=n.getBoundingRect(),s=r.getData(),o=s.graph,l=a.width/2+a.x,c=a.height/2+a.y,f=Math.min(a.width,a.height)/2,p=s.count();if(s.setLayout({cx:l,cy:c}),!!p){if(t){var y=n.pointToData(i),b=y[0],S=y[1],C=[b-l,S-c];My(C,C),N1(C,C,f),t.setLayout([l+C[0],c+C[1]],!0);var E=r.get(["circular","rotateLabel"]);FG(t,E,l,c)}J0e[e](r,o,s,f,l,c,p),o.eachEdge(function(P,O){var B=Th(P.getModel().get(["lineStyle","curveness"]),GL(P,r,O),0),F=Bf(P.node1.getLayout()),W=Bf(P.node2.getLayout()),$,q=(F[0]+W[0])/2,Q=(F[1]+W[1])/2;+B&&(B*=3,$=[l*B+q*(1-B),c*B+Q*(1-B)]),P.setLayout([F,W,$])})}}}var J0e={value:function(r,e,t,i,n,a,s){var o=0,l=t.getSum("value"),c=Math.PI*2/(l||s);e.eachNode(function(f){var p=f.getValue("value"),y=c*(l?p:1)/2;o+=y,f.setLayout([i*Math.cos(o)+n,i*Math.sin(o)+a]),o+=y})},symbolSize:function(r,e,t,i,n,a,s){var o=0;YI.length=s;var l=T1(r);e.eachNode(function(p){var y=A1(p);isNaN(y)&&(y=2),y<0&&(y=0),y*=l;var b=Math.asin(y/2/i);isNaN(b)&&(b=v6/2),YI[p.dataIndex]=b,o+=b*2});var c=(2*v6-o)/s/2,f=0;e.eachNode(function(p){var y=c+YI[p.dataIndex];f+=y,(!p.getLayout()||!p.getLayout().fixed)&&p.setLayout([i*Math.cos(f)+n,i*Math.sin(f)+a]),f+=y})}};function FG(r,e,t,i){var n=r.getGraphicEl();if(n){var a=r.getModel(),s=a.get(["label","rotate"])||0,o=n.getSymbolPath();if(e){var l=r.getLayout(),c=Math.atan2(l[1]-i,l[0]-t);c<0&&(c=Math.PI*2+c);var f=l[0]<t;f&&(c=c-Math.PI);var p=f?"left":"right";o.setTextConfig({rotation:-c,position:p,origin:"center"});var y=o.ensureState("emphasis");mt(y.textConfig||(y.textConfig={}),{position:p})}else o.setTextConfig({rotation:s*=Math.PI/180})}}function ebe(r){r.eachSeriesByType("graph",function(e){e.get("layout")==="circular"&&ZL(e,"symbolSize")})}var Q_=gA;function tbe(r,e,t){for(var i=r,n=e,a=t.rect,s=a.width,o=a.height,l=[a.x+s/2,a.y+o/2],c=t.gravity==null?.1:t.gravity,f=0;f<i.length;f++){var p=i[f];p.p||(p.p=Xg(s*(Math.random()-.5)+l[0],o*(Math.random()-.5)+l[1])),p.pp=Bf(p.p),p.edges=null}var y=t.friction==null?.6:t.friction,b=y,S,C;return{warmUp:function(){b=y*.8},setFixed:function(E){i[E].fixed=!0},setUnfixed:function(E){i[E].fixed=!1},beforeStep:function(E){S=E},afterStep:function(E){C=E},step:function(E){S&&S(i,n);for(var P=[],O=i.length,B=0;B<n.length;B++){var F=n[B];if(!F.ignoreForceLayout){var W=F.n1,$=F.n2;Ag(P,$.p,W.p);var q=sw(P)-F.d,Q=$.w/(W.w+$.w);isNaN(Q)&&(Q=0),My(P,P),!W.fixed&&Q_(W.p,W.p,P,Q*q*b),!$.fixed&&Q_($.p,$.p,P,-(1-Q)*q*b)}}for(var B=0;B<O;B++){var ee=i[B];ee.fixed||(Ag(P,l,ee.p),Q_(ee.p,ee.p,P,c*b))}for(var B=0;B<O;B++)for(var W=i[B],te=B+1;te<O;te++){var $=i[te];Ag(P,$.p,W.p);var q=sw(P);q===0&&(Gj(P,Math.random()-.5,Math.random()-.5),q=1);var ae=(W.rep+$.rep)/q/q;!W.fixed&&Q_(W.pp,W.pp,P,ae),!$.fixed&&Q_($.pp,$.pp,P,-ae)}for(var de=[],B=0;B<O;B++){var ee=i[B];ee.fixed||(Ag(de,ee.p,ee.pp),Q_(ee.p,ee.p,de,b),As(ee.pp,ee.p))}b=b*.992;var ve=b<.01;C&&C(i,n,ve),E&&E(ve)}}}function rbe(r){r.eachSeriesByType("graph",function(e){var t=e.coordinateSystem;if(!(t&&t.type!=="view"))if(e.get("layout")==="force"){var i=e.preservedPoints||{},n=e.getGraph(),a=n.data,s=n.edgeData,o=e.getModel("force"),l=o.get("initLayout");e.preservedPoints?a.each(function(B){var F=a.getId(B);a.setItemLayout(B,i[F]||[NaN,NaN])}):!l||l==="none"?zG(e):l==="circular"&&ZL(e,"value");var c=a.getDataExtent("value"),f=s.getDataExtent("value"),p=o.get("repulsion"),y=o.get("edgeLength"),b=xt(p)?p:[p,p],S=xt(y)?y:[y,y];S=[S[1],S[0]];var C=a.mapArray("value",function(B,F){var W=a.getItemLayout(F),$=Ii(B,c,b);return isNaN($)&&($=(b[0]+b[1])/2),{w:$,rep:$,fixed:a.getItemModel(F).get("fixed"),p:!W||isNaN(W[0])||isNaN(W[1])?null:W}}),E=s.mapArray("value",function(B,F){var W=n.getEdgeByIndex(F),$=Ii(B,f,S);isNaN($)&&($=(S[0]+S[1])/2);var q=W.getModel(),Q=Th(W.getModel().get(["lineStyle","curveness"]),-GL(W,e,F,!0),0);return{n1:C[W.node1.dataIndex],n2:C[W.node2.dataIndex],d:$,curveness:Q,ignoreForceLayout:q.get("ignoreForceLayout")}}),P=t.getBoundingRect(),O=tbe(C,E,{rect:P,gravity:o.get("gravity"),friction:o.get("friction")});O.beforeStep(function(B,F){for(var W=0,$=B.length;W<$;W++)B[W].fixed&&As(B[W].p,n.getNodeByIndex(W).getLayout())}),O.afterStep(function(B,F,W){for(var $=0,q=B.length;$<q;$++)B[$].fixed||n.getNodeByIndex($).setLayout(B[$].p),i[a.getId($)]=B[$].p;for(var $=0,q=F.length;$<q;$++){var Q=F[$],ee=n.getEdgeByIndex($),te=Q.n1.p,ae=Q.n2.p,de=ee.getLayout();de=de?de.slice():[],de[0]=de[0]||[],de[1]=de[1]||[],As(de[0],te),As(de[1],ae),+Q.curveness&&(de[2]=[(te[0]+ae[0])/2-(te[1]-ae[1])*Q.curveness,(te[1]+ae[1])/2-(ae[0]-te[0])*Q.curveness]),ee.setLayout(de)}}),e.forceLayout=O,e.preservedPoints=i,O.step()}else e.forceLayout=null})}function ibe(r,e,t){var i=mt(r.getBoxLayoutParams(),{aspect:t});return La(i,{width:e.getWidth(),height:e.getHeight()})}function nbe(r,e){var t=[];return r.eachSeriesByType("graph",function(i){var n=i.get("coordinateSystem");if(!n||n==="view"){var a=i.getData(),s=a.mapArray(function(E){var P=a.getItemModel(E);return[+P.get("x"),+P.get("y")]}),o=[],l=[];NC(s,o,l),l[0]-o[0]===0&&(l[0]+=1,o[0]-=1),l[1]-o[1]===0&&(l[1]+=1,o[1]-=1);var c=(l[0]-o[0])/(l[1]-o[1]),f=ibe(i,e,c);isNaN(c)&&(o=[f.x,f.y],l=[f.x+f.width,f.y+f.height]);var p=l[0]-o[0],y=l[1]-o[1],b=f.width,S=f.height,C=i.coordinateSystem=new lS;C.zoomLimit=i.get("scaleLimit"),C.setBoundingRect(o[0],o[1],p,y),C.setViewRect(f.x,f.y,b,S),C.setCenter(i.get("center"),e),C.setZoom(i.get("zoom")),t.push(C)}}),t}var m6=qa.prototype,KI=lb.prototype,VG=(function(){function r(){this.x1=0,this.y1=0,this.x2=0,this.y2=0,this.percent=1}return r})();(function(r){Ye(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e})(VG);function QI(r){return isNaN(+r.cpx1)||isNaN(+r.cpy1)}var abe=(function(r){Ye(e,r);function e(t){var i=r.call(this,t)||this;return i.type="ec-line",i}return e.prototype.getDefaultStyle=function(){return{stroke:"#000",fill:null}},e.prototype.getDefaultShape=function(){return new VG},e.prototype.buildPath=function(t,i){QI(i)?m6.buildPath.call(this,t,i):KI.buildPath.call(this,t,i)},e.prototype.pointAt=function(t){return QI(this.shape)?m6.pointAt.call(this,t):KI.pointAt.call(this,t)},e.prototype.tangentAt=function(t){var i=this.shape,n=QI(i)?[i.x2-i.x1,i.y2-i.y1]:KI.tangentAt.call(this,t);return My(n,n)},e})(Xr),JI=["fromSymbol","toSymbol"];function y6(r){return"_"+r+"Type"}function _6(r,e,t){var i=e.getItemVisual(t,r);if(!i||i==="none")return i;var n=e.getItemVisual(t,r+"Size"),a=e.getItemVisual(t,r+"Rotate"),s=e.getItemVisual(t,r+"Offset"),o=e.getItemVisual(t,r+"KeepAspect"),l=_b(n),c=Dy(s||0,l);return i+l+c+(a||"")+(o||"")}function b6(r,e,t){var i=e.getItemVisual(t,r);if(!(!i||i==="none")){var n=e.getItemVisual(t,r+"Size"),a=e.getItemVisual(t,r+"Rotate"),s=e.getItemVisual(t,r+"Offset"),o=e.getItemVisual(t,r+"KeepAspect"),l=_b(n),c=Dy(s||0,l),f=Aa(i,-l[0]/2+c[0],-l[1]/2+c[1],l[0],l[1],null,o);return f.__specifiedRotation=a==null||isNaN(a)?void 0:+a*Math.PI/180||0,f.name=r,f}}function obe(r){var e=new abe({name:"line",subPixelOptimize:!0});return j3(e.shape,r),e}function j3(r,e){r.x1=e[0][0],r.y1=e[0][1],r.x2=e[1][0],r.y2=e[1][1],r.percent=1;var t=e[2];t?(r.cpx1=t[0],r.cpy1=t[1]):(r.cpx1=NaN,r.cpy1=NaN)}var qL=(function(r){Ye(e,r);function e(t,i,n){var a=r.call(this)||this;return a._createLine(t,i,n),a}return e.prototype._createLine=function(t,i,n){var a=t.hostModel,s=t.getItemLayout(i),o=obe(s);o.shape.percent=0,An(o,{shape:{percent:1}},a,i),this.add(o),se(JI,function(l){var c=b6(l,t,i);this.add(c),this[y6(l)]=_6(l,t,i)},this),this._updateCommonStl(t,i,n)},e.prototype.updateData=function(t,i,n){var a=t.hostModel,s=this.childOfName("line"),o=t.getItemLayout(i),l={shape:{}};j3(l.shape,o),vi(s,l,a,i),se(JI,function(c){var f=_6(c,t,i),p=y6(c);if(this[p]!==f){this.remove(this.childOfName(c));var y=b6(c,t,i);this.add(y)}this[p]=f},this),this._updateCommonStl(t,i,n)},e.prototype.getLinePath=function(){return this.childAt(0)},e.prototype._updateCommonStl=function(t,i,n){var a=t.hostModel,s=this.childOfName("line"),o=n&&n.emphasisLineStyle,l=n&&n.blurLineStyle,c=n&&n.selectLineStyle,f=n&&n.labelStatesModels,p=n&&n.emphasisDisabled,y=n&&n.focus,b=n&&n.blurScope;if(!n||t.hasItemOption){var S=t.getItemModel(i),C=S.getModel("emphasis");o=C.getModel("lineStyle").getLineStyle(),l=S.getModel(["blur","lineStyle"]).getLineStyle(),c=S.getModel(["select","lineStyle"]).getLineStyle(),p=C.get("disabled"),y=C.get("focus"),b=C.get("blurScope"),f=fo(S)}var E=t.getItemVisual(i,"style"),P=E.stroke;s.useStyle(E),s.style.fill=null,s.style.strokeNoScale=!0,s.ensureState("emphasis").style=o,s.ensureState("blur").style=l,s.ensureState("select").style=c,se(JI,function($){var q=this.childOfName($);if(q){q.setColor(P),q.style.opacity=E.opacity;for(var Q=0;Q<ll.length;Q++){var ee=ll[Q],te=s.getState(ee);if(te){var ae=te.style||{},de=q.ensureState(ee),ve=de.style||(de.style={});ae.stroke!=null&&(ve[q.__isEmptyBrush?"stroke":"fill"]=ae.stroke),ae.opacity!=null&&(ve.opacity=ae.opacity)}}q.markRedraw()}},this);var O=a.getRawValue(i);rs(this,f,{labelDataIndex:i,labelFetcher:{getFormattedLabel:function($,q){return a.getFormattedLabel($,q,t.dataType)}},inheritColor:P||"#000",defaultOpacity:E.opacity,defaultText:(O==null?t.getName(i):isFinite(O)?Qn(O):O)+""});var B=this.getTextContent();if(B){var F=f.normal;B.__align=B.style.align,B.__verticalAlign=B.style.verticalAlign,B.__position=F.get("position")||"middle";var W=F.get("distance");xt(W)||(W=[W,W]),B.__labelDistance=W}this.setTextConfig({position:null,local:!0,inside:!1}),Hn(this,y,b,p)},e.prototype.highlight=function(){cp(this)},e.prototype.downplay=function(){hp(this)},e.prototype.updateLayout=function(t,i){this.setLinePoints(t.getItemLayout(i))},e.prototype.setLinePoints=function(t){var i=this.childOfName("line");j3(i.shape,t),i.dirty()},e.prototype.beforeUpdate=function(){var t=this,i=t.childOfName("fromSymbol"),n=t.childOfName("toSymbol"),a=t.getTextContent();if(!i&&!n&&(!a||a.ignore))return;for(var s=1,o=this.parent;o;)o.scaleX&&(s/=o.scaleX),o=o.parent;var l=t.childOfName("line");if(!this.__dirty&&!l.__dirty)return;var c=l.shape.percent,f=l.pointAt(0),p=l.pointAt(c),y=Ag([],p,f);My(y,y);function b(te,ae){var de=te.__specifiedRotation;if(de==null){var ve=l.tangentAt(ae);te.attr("rotation",(ae===1?-1:1)*Math.PI/2-Math.atan2(ve[1],ve[0]))}else te.attr("rotation",de)}if(i&&(i.setPosition(f),b(i,0),i.scaleX=i.scaleY=s*c,i.markRedraw()),n&&(n.setPosition(p),b(n,1),n.scaleX=n.scaleY=s*c,n.markRedraw()),a&&!a.ignore){a.x=a.y=0,a.originX=a.originY=0;var S=void 0,C=void 0,E=a.__labelDistance,P=E[0]*s,O=E[1]*s,B=c/2,F=l.tangentAt(B),W=[F[1],-F[0]],$=l.pointAt(B);W[1]>0&&(W[0]=-W[0],W[1]=-W[1]);var q=F[0]<0?-1:1;if(a.__position!=="start"&&a.__position!=="end"){var Q=-Math.atan2(F[1],F[0]);p[0]<f[0]&&(Q=Math.PI+Q),a.rotation=Q}var ee=void 0;switch(a.__position){case"insideStartTop":case"insideMiddleTop":case"insideEndTop":case"middle":ee=-O,C="bottom";break;case"insideStartBottom":case"insideMiddleBottom":case"insideEndBottom":ee=O,C="top";break;default:ee=0,C="middle"}switch(a.__position){case"end":a.x=y[0]*P+p[0],a.y=y[1]*O+p[1],S=y[0]>.8?"left":y[0]<-.8?"right":"center",C=y[1]>.8?"top":y[1]<-.8?"bottom":"middle";break;case"start":a.x=-y[0]*P+f[0],a.y=-y[1]*O+f[1],S=y[0]>.8?"right":y[0]<-.8?"left":"center",C=y[1]>.8?"bottom":y[1]<-.8?"top":"middle";break;case"insideStartTop":case"insideStart":case"insideStartBottom":a.x=P*q+f[0],a.y=f[1]+ee,S=F[0]<0?"right":"left",a.originX=-P*q,a.originY=-ee;break;case"insideMiddleTop":case"insideMiddle":case"insideMiddleBottom":case"middle":a.x=$[0],a.y=$[1]+ee,S="center",a.originY=-ee;break;case"insideEndTop":case"insideEnd":case"insideEndBottom":a.x=-P*q+p[0],a.y=p[1]+ee,S=F[0]>=0?"right":"left",a.originX=P*q,a.originY=-ee;break}a.scaleX=a.scaleY=s,a.setStyle({verticalAlign:a.__verticalAlign||C,align:a.__align||S})}},e})(mr),YL=(function(){function r(e){this.group=new mr,this._LineCtor=e||qL}return r.prototype.updateData=function(e){var t=this;this._progressiveEls=null;var i=this,n=i.group,a=i._lineData;i._lineData=e,a||n.removeAll();var s=x6(e);e.diff(a).add(function(o){t._doAdd(e,o,s)}).update(function(o,l){t._doUpdate(a,e,l,o,s)}).remove(function(o){n.remove(a.getItemGraphicEl(o))}).execute()},r.prototype.updateLayout=function(){var e=this._lineData;e&&e.eachItemGraphicEl(function(t,i){t.updateLayout(e,i)},this)},r.prototype.incrementalPrepareUpdate=function(e){this._seriesScope=x6(e),this._lineData=null,this.group.removeAll()},r.prototype.incrementalUpdate=function(e,t){this._progressiveEls=[];function i(o){!o.isGroup&&!sbe(o)&&(o.incremental=!0,o.ensureState("emphasis").hoverLayer=!0)}for(var n=e.start;n<e.end;n++){var a=t.getItemLayout(n);if(eP(a)){var s=new this._LineCtor(t,n,this._seriesScope);s.traverse(i),this.group.add(s),t.setItemGraphicEl(n,s),this._progressiveEls.push(s)}}},r.prototype.remove=function(){this.group.removeAll()},r.prototype.eachRendered=function(e){qg(this._progressiveEls||this.group,e)},r.prototype._doAdd=function(e,t,i){var n=e.getItemLayout(t);if(eP(n)){var a=new this._LineCtor(e,t,i);e.setItemGraphicEl(t,a),this.group.add(a)}},r.prototype._doUpdate=function(e,t,i,n,a){var s=e.getItemGraphicEl(i);if(!eP(t.getItemLayout(n))){this.group.remove(s);return}s?s.updateData(t,n,a):s=new this._LineCtor(t,n,a),t.setItemGraphicEl(n,s),this.group.add(s)},r})();function sbe(r){return r.animators&&r.animators.length>0}function x6(r){var e=r.hostModel,t=e.getModel("emphasis");return{lineStyle:e.getModel("lineStyle").getLineStyle(),emphasisLineStyle:t.getModel(["lineStyle"]).getLineStyle(),blurLineStyle:e.getModel(["blur","lineStyle"]).getLineStyle(),selectLineStyle:e.getModel(["select","lineStyle"]).getLineStyle(),emphasisDisabled:t.get("disabled"),blurScope:t.get("blurScope"),focus:t.get("focus"),labelStatesModels:fo(e)}}function w6(r){return isNaN(r[0])||isNaN(r[1])}function eP(r){return r&&!w6(r[0])&&!w6(r[1])}var tP=[],rP=[],iP=[],J_=Po,nP=kg,S6=Math.abs;function T6(r,e,t){for(var i=r[0],n=r[1],a=r[2],s=1/0,o,l=t*t,c=.1,f=.1;f<=.9;f+=.1){tP[0]=J_(i[0],n[0],a[0],f),tP[1]=J_(i[1],n[1],a[1],f);var p=S6(nP(tP,e)-l);p<s&&(s=p,o=f)}for(var y=0;y<32;y++){var b=o+c;rP[0]=J_(i[0],n[0],a[0],o),rP[1]=J_(i[1],n[1],a[1],o),iP[0]=J_(i[0],n[0],a[0],b),iP[1]=J_(i[1],n[1],a[1],b);var p=nP(rP,e)-l;if(S6(p)<.01)break;var S=nP(iP,e)-l;c/=2,p<0?S>=0?o=o+c:o=o-c:S>=0?o=o-c:o=o+c}return o}function aP(r,e){var t=[],i=lw,n=[[],[],[]],a=[[],[]],s=[];e/=2,r.eachEdge(function(o,l){var c=o.getLayout(),f=o.getVisual("fromSymbol"),p=o.getVisual("toSymbol");c.__original||(c.__original=[Bf(c[0]),Bf(c[1])],c[2]&&c.__original.push(Bf(c[2])));var y=c.__original;if(c[2]!=null){if(As(n[0],y[0]),As(n[1],y[2]),As(n[2],y[1]),f&&f!=="none"){var b=A1(o.node1),S=T6(n,y[0],b*e);i(n[0][0],n[1][0],n[2][0],S,t),n[0][0]=t[3],n[1][0]=t[4],i(n[0][1],n[1][1],n[2][1],S,t),n[0][1]=t[3],n[1][1]=t[4]}if(p&&p!=="none"){var b=A1(o.node2),S=T6(n,y[1],b*e);i(n[0][0],n[1][0],n[2][0],S,t),n[1][0]=t[1],n[2][0]=t[2],i(n[0][1],n[1][1],n[2][1],S,t),n[1][1]=t[1],n[2][1]=t[2]}As(c[0],n[0]),As(c[1],n[2]),As(c[2],n[1])}else{if(As(a[0],y[0]),As(a[1],y[1]),Ag(s,a[1],a[0]),My(s,s),f&&f!=="none"){var b=A1(o.node1);gA(a[0],a[0],s,b*e)}if(p&&p!=="none"){var b=A1(o.node2);gA(a[1],a[1],s,-b*e)}As(c[0],a[0]),As(c[1],a[1])}})}function A6(r){return r.type==="view"}var lbe=(function(r){Ye(e,r);function e(){var t=r!==null&&r.apply(this,arguments)||this;return t.type=e.type,t}return e.prototype.init=function(t,i){var n=new rS,a=new YL,s=this.group;this._controller=new sS(i.getZr()),this._controllerHost={target:s},s.add(n.group),s.add(a.group),this._symbolDraw=n,this._lineDraw=a,this._firstRender=!0},e.prototype.render=function(t,i,n){var a=this,s=t.coordinateSystem;this._model=t;var o=this._symbolDraw,l=this._lineDraw,c=this.group;if(A6(s)){var f={x:s.x,y:s.y,scaleX:s.scaleX,scaleY:s.scaleY};this._firstRender?c.attr(f):vi(c,f,t)}aP(t.getGraph(),T1(t));var p=t.getData();o.updateData(p);var y=t.getEdgeData();l.updateData(y),this._updateNodeAndLinkScale(),this._updateController(t,i,n),clearTimeout(this._layoutTimeout);var b=t.forceLayout,S=t.get(["force","layoutAnimation"]);b&&this._startForceLayoutIteration(b,S);var C=t.get("layout");p.graph.eachNode(function(B){var F=B.dataIndex,W=B.getGraphicEl(),$=B.getModel();if(W){W.off("drag").off("dragend");var q=$.get("draggable");q&&W.on("drag",function(ee){switch(C){case"force":b.warmUp(),!a._layouting&&a._startForceLayoutIteration(b,S),b.setFixed(F),p.setItemLayout(F,[W.x,W.y]);break;case"circular":p.setItemLayout(F,[W.x,W.y]),B.setLayout({fixed:!0},!0),ZL(t,"symbolSize",B,[ee.offsetX,ee.offsetY]),a.updateLayout(t);break;case"none":default:p.setItemLayout(F,[W.x,W.y]),XL(t.getGraph(),t),a.updateLayout(t);break}}).on("dragend",function(){b&&b.setUnfixed(F)}),W.setDraggable(q,!!$.get("cursor"));var Q=$.get(["emphasis","focus"]);Q==="adjacency"&&(br(W).focus=B.getAdjacentDataIndices())}}),p.graph.eachEdge(function(B){var F=B.getGraphicEl(),W=B.getModel().get(["emphasis","focus"]);F&&W==="adjacency"&&(br(F).focus={edge:[B.dataIndex],node:[B.node1.dataIndex,B.node2.dataIndex]})});var E=t.get("layout")==="circular"&&t.get(["circular","rotateLabel"]),P=p.getLayout("cx"),O=p.getLayout("cy");p.graph.eachNode(function(B){FG(B,E,P,O)}),this._firstRender=!1},e.prototype.dispose=function(){this.remove(),this._controller&&this._controller.dispose(),this._controllerHost=null},e.prototype._startForceLayoutIteration=function(t,i){var n=this;(function a(){t.step(function(s){n.updateLayout(n._model),(n._layouting=!s)&&(i?n._layoutTimeout=setTimeout(a,16):a())})})()},e.prototype._updateController=function(t,i,n){var a=this,s=this._controller,o=this._controllerHost,l=this.group;if(s.setPointerChecker(function(c,f,p){var y=l.getBoundingRect();return y.applyTransform(l.transform),y.contain(f,p)&&!aM(c,n,t)}),!A6(t.coordinateSystem)){s.disable();return}s.enable(t.get("roam")),o.zoomLimit=t.get("scaleLimit"),o.zoom=t.coordinateSystem.getZoom(),s.off("pan").off("zoom").on("pan",function(c){zL(o,c.dx,c.dy),n.dispatchAction({seriesId:t.id,type:"graphRoam",dx:c.dx,dy:c.dy})}).on("zoom",function(c){FL(o,c.scale,c.originX,c.originY),n.dispatchAction({seriesId:t.id,type:"graphRoam",zoom:c.scale,originX:c.originX,originY:c.originY}),a._updateNodeAndLinkScale(),aP(t.getGraph(),T1(t)),a._lineDraw.updateLayout(),n.updateLabelLayout()})},e.prototype._updateNodeAndLinkScale=function(){var t=this._model,i=t.getData(),n=T1(t);i.eachItemGraphicEl(function(a,s){a&&a.setSymbolScale(n)})},e.prototype.updateLayout=function(t){aP(t.getGraph(),T1(t)),this._symbolDraw.updateLayout(),this._lineDraw.updateLayout()},e.prototype.remove=function(){clearTimeout(this._layoutTimeout),this._layouting=!1,this._layoutTimeout=null,this._symbolDraw&&this._symbolDraw.remove(),this._lineDraw&&this._lineDraw.remove()},e.type="graph",e})(Fi);function e0(r){return"_EC_"+r}var ube=(function(){function r(e){this.type="graph",this.nodes=[],this.edges=[],this._nodesMap={},this._edgesMap={},this._directed=e||!1}return r.prototype.isDirected=function(){return this._directed},r.prototype.addNode=function(e,t){e=e==null?""+t:""+e;var i=this._nodesMap;if(!i[e0(e)]){var n=new Rm(e,t);return n.hostGraph=this,this.nodes.push(n),i[e0(e)]=n,n}},r.prototype.getNodeByIndex=function(e){var t=this.data.getRawIndex(e);return this.nodes[t]},r.prototype.getNodeById=function(e){return this._nodesMap[e0(e)]},r.prototype.addEdge=function(e,t,i){var n=this._nodesMap,a=this._edgesMap;if(di(e)&&(e=this.nodes[e]),di(t)&&(t=this.nodes[t]),e instanceof Rm||(e=n[e0(e)]),t instanceof Rm||(t=n[e0(t)]),!(!e||!t)){var s=e.id+"-"+t.id,o=new UG(e,t,i);return o.hostGraph=this,this._directed&&(e.outEdges.push(o),t.inEdges.push(o)),e.edges.push(o),e!==t&&t.edges.push(o),this.edges.push(o),a[s]=o,o}},r.prototype.getEdgeByIndex=function(e){var t=this.edgeData.getRawIndex(e);return this.edges[t]},r.prototype.getEdge=function(e,t){e instanceof Rm&&(e=e.id),t instanceof Rm&&(t=t.id);var i=this._edgesMap;return this._directed?i[e+"-"+t]:i[e+"-"+t]||i[t+"-"+e]},r.prototype.eachNode=function(e,t){for(var i=this.nodes,n=i.length,a=0;a<n;a++)i[a].dataIndex>=0&&e.call(t,i[a],a)},r.prototype.eachEdge=function(e,t){for(var i=this.edges,n=i.length,a=0;a<n;a++)i[a].dataIndex>=0&&i[a].node1.dataIndex>=0&&i[a].node2.dataIndex>=0&&e.call(t,i[a],a)},r.prototype.breadthFirstTraverse=function(e,t,i,n){if(t instanceof Rm||(t=this._nodesMap[e0(t)]),!!t){for(var a=i==="out"?"outEdges":i==="in"?"inEdges":"edges",s=0;s<this.nodes.length;s++)this.nodes[s].__visited=!1;if(!e.call(n,t,null))for(var o=[t];o.length;)for(var l=o.shift(),c=l[a],s=0;s<c.length;s++){var f=c[s],p=f.node1===l?f.node2:f.node1;if(!p.__visited){if(e.call(n,p,l))return;o.push(p),p.__visited=!0}}}},r.prototype.update=function(){for(var e=this.data,t=this.edgeData,i=this.nodes,n=this.edges,a=0,s=i.length;a<s;a++)i[a].dataIndex=-1;for(var a=0,s=e.count();a<s;a++)i[e.getRawIndex(a)].dataIndex=a;t.filterSelf(function(o){var l=n[t.getRawIndex(o)];return l.node1.dataIndex>=0&&l.node2.dataIndex>=0});for(var a=0,s=n.length;a<s;a++)n[a].dataIndex=-1;for(var a=0,s=t.count();a<s;a++)n[t.getRawIndex(a)].dataIndex=a},r.prototype.clone=function(){for(var e=new r(this._directed),t=this.nodes,i=this.edges,n=0;n<t.length;n++)e.addNode(t[n].id,t[n].dataIndex);for(var n=0;n<i.length;n++){var a=i[n];e.addEdge(a.node1.id,a.node2.id,a.dataIndex)}return e},r})(),Rm=(function(){function r(e,t){this.inEdges=[],this.outEdges=[],this.edges=[],this.dataIndex=-1,this.id=e??"",this.dataIndex=t??-1}return r.prototype.degree=function(){return this.edges.length},r.prototype.inDegree=function(){return this.inEdges.length},r.prototype.outDegree=function(){return this.outEdges.length},r.prototype.getModel=function(e){if(!(this.dataIndex<0)){var t=this.hostGraph,i=t.data.getItemModel(this.dataIndex);return i.getModel(e)}},r.prototype.getAdjacentDataIndices=function(){for(var e={edge:[],node:[]},t=0;t<this.edges.length;t++){var i=this.edges[t];i.dataIndex<0||(e.edge.push(i.dataIndex),e.node.push(i.node1.dataIndex,i.node2.dataIndex))}return e},r.prototype.getTrajectoryDataIndices=function(){for(var e=Qt(),t=Qt(),i=0;i<this.edges.length;i++){var n=this.edges[i];if(!(n.dataIndex<0)){e.set(n.dataIndex,!0);for(var a=[n.node1],s=[n.node2],o=0;o<a.length;){var l=a[o];o++,t.set(l.dataIndex,!0);for(var c=0;c<l.inEdges.length;c++)e.set(l.inEdges[c].dataIndex,!0),a.push(l.inEdges[c].node1)}for(o=0;o<s.length;){var f=s[o];o++,t.set(f.dataIndex,!0);for(var c=0;c<f.outEdges.length;c++)e.set(f.outEdges[c].dataIndex,!0),s.push(f.outEdges[c].node2)}}}return{edge:e.keys(),node:t.keys()}},r})(),UG=(function(){function r(e,t,i){this.dataIndex=-1,this.node1=e,this.node2=t,this.dataIndex=i??-1}return r.prototype.getModel=function(e){if(!(this.dataIndex<0)){var t=this.hostGraph,i=t.edgeData.getItemModel(this.dataIndex);return i.getModel(e)}},r.prototype.getAdjacentDataIndices=function(){return{edge:[this.dataIndex],node:[this.node1.dataIndex,this.node2.dataIndex]}},r.prototype.getTrajectoryDataIndices=function(){var e=Qt(),t=Qt();e.set(this.dataIndex,!0);for(var i=[this.node1],n=[this.node2],a=0;a<i.length;){var s=i[a];a++,t.set(s.dataIndex,!0);for(var o=0;o<s.inEdges.length;o++)e.set(s.inEdges[o].dataIndex,!0),i.push(s.inEdges[o].node1)}for(a=0;a<n.length;){var l=n[a];a++,t.set(l.dataIndex,!0);for(var o=0;o<l.outEdges.length;o++)e.set(l.outEdges[o].dataIndex,!0),n.push(l.outEdges[o].node2)}return{edge:e.keys(),node:t.keys()}},r})();function HG(r,e){return{getValue:function(t){var i=this[r][e];return i.getStore().get(i.getDimensionIndex(t||"value"),this.dataIndex)},setVisual:function(t,i){this.dataIndex>=0&&this[r][e].setItemVisual(this.dataIndex,t,i)},getVisual:function(t){return this[r][e].getItemVisual(this.dataIndex,t)},setLayout:function(t,i){this.dataIndex>=0&&this[r][e].setItemLayout(this.dataIndex,t,i)},getLayout:function(){return this[r][e].getItemLayout(this.dataIndex)},getGraphicEl:function(){return this[r][e].getItemGraphicEl(this.dataIndex)},getRawIndex:function(){return this[r][e].getRawIndex(this.dataIndex)}}}ha(Rm,HG("hostGraph","data"));ha(UG,HG("hostGraph","edgeData"));function jG(r,e,t,i,n){for(var a=new ube(i),s=0;s<r.length;s++)a.addNode(uo(r[s].id,r[s].name,s),s);for(var o=[],l=[],c=0,s=0;s<e.length;s++){var f=e[s],p=f.source,y=f.target;a.addEdge(p,y,c)&&(l.push(f),o.push(uo(Za(f.id,null),p+" > "+y)),c++)}var b=t.get("coordinateSystem"),S;if(b==="cartesian2d"||b==="polar")S=Gf(r,t);else{var C=vb.get(b),E=C?C.dimensions||[]:[];Or(E,"value")<0&&E.concat(["value"]);var P=bb(r,{coordDimensions:E,encodeDefine:t.getEncode()}).dimensions;S=new Es(P,t),S.initData(r)}var O=new Es(["value"],t);return O.initData(l,o),n&&n(S,O),TG({mainData:S,struct:a,structAttr:"graph",datas:{node:S,edge:O},datasAttr:{node:"data",edge:"edgeData"}}),a.update(),a}var cbe=(function(r){Ye(e,r);function e(){var t=r!==null&&r.apply(this,arguments)||this;return t.type=e.type,t.hasSymbolVisual=!0,t}return e.prototype.init=function(t){r.prototype.init.apply(this,arguments);var i=this;function n(){return i._categoriesData}this.legendVisualProvider=new oS(n,n),this.fillDataTextStyle(t.edges||t.links),this._updateCategoriesData()},e.prototype.mergeOption=function(t){r.prototype.mergeOption.apply(this,arguments),this.fillDataTextStyle(t.edges||t.links),this._updateCategoriesData()},e.prototype.mergeDefaultAndTheme=function(t){r.prototype.mergeDefaultAndTheme.apply(this,arguments),vy(t,"edgeLabel",["show"])},e.prototype.getInitialData=function(t,i){var n=t.edges||t.links||[],a=t.data||t.nodes||[],s=this;if(a&&n){Y0e(this);var o=jG(a,n,this,!0,l);return se(o.edges,function(c){K0e(c.node1,c.node2,this,c.dataIndex)},this),o.data}function l(c,f){c.wrapMethod("getItemModel",function(S){var C=s._categoriesModels,E=S.getShallow("category"),P=C[E];return P&&(P.parentModel=S.parentModel,S.parentModel=P),S});var p=Si.prototype.getModel;function y(S,C){var E=p.call(this,S,C);return E.resolveParentPath=b,E}f.wrapMethod("getItemModel",function(S){return S.resolveParentPath=b,S.getModel=y,S});function b(S){if(S&&(S[0]==="label"||S[1]==="label")){var C=S.slice();return S[0]==="label"?C[0]="edgeLabel":S[1]==="label"&&(C[1]="edgeLabel"),C}return S}}},e.prototype.getGraph=function(){return this.getData().graph},e.prototype.getEdgeData=function(){return this.getGraph().edgeData},e.prototype.getCategoriesData=function(){return this._categoriesData},e.prototype.formatTooltip=function(t,i,n){if(n==="edge"){var a=this.getData(),s=this.getDataParams(t,n),o=a.graph.getEdgeByIndex(t),l=a.getName(o.node1.dataIndex),c=a.getName(o.node2.dataIndex),f=[];return l!=null&&f.push(l),c!=null&&f.push(c),po("nameValue",{name:f.join(" > "),value:s.value,noValue:s.value==null})}var p=c9({series:this,dataIndex:t,multipleSeries:i});return p},e.prototype._updateCategoriesData=function(){var t=wt(this.option.categories||[],function(n){return n.value!=null?n:mt({value:0},n)}),i=new Es(["value"],this);i.initData(t),this._categoriesData=i,this._categoriesModels=i.mapArray(function(n){return i.getItemModel(n)})},e.prototype.setZoom=function(t){this.option.zoom=t},e.prototype.setCenter=function(t){this.option.center=t},e.prototype.isAnimationEnabled=function(){return r.prototype.isAnimationEnabled.call(this)&&!(this.get("layout")==="force"&&this.get(["force","layoutAnimation"]))},e.type="series.graph",e.dependencies=["grid","polar","geo","singleAxis","calendar"],e.defaultOption={z:2,coordinateSystem:"view",legendHoverLink:!0,layout:null,circular:{rotateLabel:!1},force:{initLayout:null,repulsion:[0,50],gravity:.1,friction:.6,edgeLength:30,layoutAnimation:!0},left:"center",top:"center",symbol:"circle",symbolSize:10,edgeSymbol:["none","none"],edgeSymbolSize:10,edgeLabel:{position:"middle",distance:5},draggable:!1,roam:!1,center:null,zoom:1,nodeScaleRatio:.6,label:{show:!1,formatter:"{b}"},itemStyle:{},lineStyle:{color:"#aaa",width:1,opacity:.5},emphasis:{scale:!0,label:{show:!0}},select:{itemStyle:{borderColor:"#212121"}}},e})(Xi),hbe={type:"graphRoam",event:"graphRoam",update:"none"};function fbe(r){r.registerChartView(lbe),r.registerSeriesModel(cbe),r.registerProcessor(W0e),r.registerVisual(G0e),r.registerVisual(X0e),r.registerLayout(Q0e),r.registerLayout(r.PRIORITY.VISUAL.POST_CHART_LAYOUT,ebe),r.registerLayout(rbe),r.registerCoordinateSystem("graphView",{dimensions:lS.dimensions,create:nbe}),r.registerAction({type:"focusNodeAdjacency",event:"focusNodeAdjacency",update:"series:focusNodeAdjacency"},ca),r.registerAction({type:"unfocusNodeAdjacency",event:"unfocusNodeAdjacency",update:"series:unfocusNodeAdjacency"},ca),r.registerAction(hbe,function(e,t,i){t.eachComponent({mainType:"series",query:e},function(n){var a=n.coordinateSystem,s=UL(a,e,void 0,i);n.setCenter&&n.setCenter(s.center),n.setZoom&&n.setZoom(s.zoom)})})}var dbe=(function(){function r(){this.angle=0,this.width=10,this.r=10,this.x=0,this.y=0}return r})(),pbe=(function(r){Ye(e,r);function e(t){var i=r.call(this,t)||this;return i.type="pointer",i}return e.prototype.getDefaultShape=function(){return new dbe},e.prototype.buildPath=function(t,i){var n=Math.cos,a=Math.sin,s=i.r,o=i.width,l=i.angle,c=i.x-n(l)*o*(o>=s/3?1:2),f=i.y-a(l)*o*(o>=s/3?1:2);l=i.angle-Math.PI/2,t.moveTo(c,f),t.lineTo(i.x+n(l)*o,i.y+a(l)*o),t.lineTo(i.x+n(i.angle)*s,i.y+a(i.angle)*s),t.lineTo(i.x-n(l)*o,i.y-a(l)*o),t.lineTo(c,f)},e})(Xr);function gbe(r,e){var t=r.get("center"),i=e.getWidth(),n=e.getHeight(),a=Math.min(i,n),s=Vt(t[0],e.getWidth()),o=Vt(t[1],e.getHeight()),l=Vt(r.get("radius"),a/2);return{cx:s,cy:o,r:l}}function a2(r,e){var t=r==null?"":r+"";return e&&($t(e)?t=e.replace("{value}",t):sr(e)&&(t=e(r))),t}var vbe=(function(r){Ye(e,r);function e(){var t=r!==null&&r.apply(this,arguments)||this;return t.type=e.type,t}return e.prototype.render=function(t,i,n){this.group.removeAll();var a=t.get(["axisLine","lineStyle","color"]),s=gbe(t,n);this._renderMain(t,i,n,a,s),this._data=t.getData()},e.prototype.dispose=function(){},e.prototype._renderMain=function(t,i,n,a,s){var o=this.group,l=t.get("clockwise"),c=-t.get("startAngle")/180*Math.PI,f=-t.get("endAngle")/180*Math.PI,p=t.getModel("axisLine"),y=p.get("roundCap"),b=y?XA:Ps,S=p.get("show"),C=p.getModel("lineStyle"),E=C.get("width"),P=[c,f];Dk(P,!l),c=P[0],f=P[1];for(var O=f-c,B=c,F=[],W=0;S&&W<a.length;W++){var $=Math.min(Math.max(a[W][0],0),1);f=c+O*$;var q=new b({shape:{startAngle:B,endAngle:f,cx:s.cx,cy:s.cy,clockwise:l,r0:s.r-E,r:s.r},silent:!0});q.setStyle({fill:a[W][1]}),q.setStyle(C.getLineStyle(["color","width"])),F.push(q),B=f}F.reverse(),se(F,function(ee){return o.add(ee)});var Q=function(ee){if(ee<=0)return a[0][1];var te;for(te=0;te<a.length;te++)if(a[te][0]>=ee&&(te===0?0:a[te-1][0])<ee)return a[te][1];return a[te-1][1]};this._renderTicks(t,i,n,Q,s,c,f,l,E),this._renderTitleAndDetail(t,i,n,Q,s),this._renderAnchor(t,s),this._renderPointer(t,i,n,Q,s,c,f,l,E)},e.prototype._renderTicks=function(t,i,n,a,s,o,l,c,f){for(var p=this.group,y=s.cx,b=s.cy,S=s.r,C=+t.get("min"),E=+t.get("max"),P=t.getModel("splitLine"),O=t.getModel("axisTick"),B=t.getModel("axisLabel"),F=t.get("splitNumber"),W=O.get("splitNumber"),$=Vt(P.get("length"),S),q=Vt(O.get("length"),S),Q=o,ee=(l-o)/F,te=ee/W,ae=P.getModel("lineStyle").getLineStyle(),de=O.getModel("lineStyle").getLineStyle(),ve=P.get("distance"),ye,Ae,me=0;me<=F;me++){if(ye=Math.cos(Q),Ae=Math.sin(Q),P.get("show")){var De=ve?ve+f:f,Fe=new qa({shape:{x1:ye*(S-De)+y,y1:Ae*(S-De)+b,x2:ye*(S-$-De)+y,y2:Ae*(S-$-De)+b},style:ae,silent:!0});ae.stroke==="auto"&&Fe.setStyle({stroke:a(me/F)}),p.add(Fe)}if(B.get("show")){var De=B.get("distance")+ve,je=a2(Qn(me/F*(E-C)+C),B.get("formatter")),ct=a(me/F),xe=ye*(S-$-De)+y,$e=Ae*(S-$-De)+b,pt=B.get("rotate"),_t=0;pt==="radial"?(_t=-Q+2*Math.PI,_t>Math.PI/2&&(_t+=Math.PI)):pt==="tangential"?_t=-Q-Math.PI/2:di(pt)&&(_t=pt*Math.PI/180),_t===0?p.add(new si({style:cn(B,{text:je,x:xe,y:$e,verticalAlign:Ae<-.8?"top":Ae>.8?"bottom":"middle",align:ye<-.4?"left":ye>.4?"right":"center"},{inheritColor:ct}),silent:!0})):p.add(new si({style:cn(B,{text:je,x:xe,y:$e,verticalAlign:"middle",align:"center"},{inheritColor:ct}),silent:!0,originX:xe,originY:$e,rotation:_t}))}if(O.get("show")&&me!==F){var De=O.get("distance");De=De?De+f:f;for(var Dt=0;Dt<=W;Dt++){ye=Math.cos(Q),Ae=Math.sin(Q);var qt=new qa({shape:{x1:ye*(S-De)+y,y1:Ae*(S-De)+b,x2:ye*(S-q-De)+y,y2:Ae*(S-q-De)+b},silent:!0,style:de});de.stroke==="auto"&&qt.setStyle({stroke:a((me+Dt/W)/F)}),p.add(qt),Q+=te}Q-=te}else Q+=ee}},e.prototype._renderPointer=function(t,i,n,a,s,o,l,c,f){var p=this.group,y=this._data,b=this._progressEls,S=[],C=t.get(["pointer","show"]),E=t.getModel("progress"),P=E.get("show"),O=t.getData(),B=O.mapDimension("value"),F=+t.get("min"),W=+t.get("max"),$=[F,W],q=[o,l];function Q(te,ae){var de=O.getItemModel(te),ve=de.getModel("pointer"),ye=Vt(ve.get("width"),s.r),Ae=Vt(ve.get("length"),s.r),me=t.get(["pointer","icon"]),De=ve.get("offsetCenter"),Fe=Vt(De[0],s.r),je=Vt(De[1],s.r),ct=ve.get("keepAspect"),xe;return me?xe=Aa(me,Fe-ye/2,je-Ae,ye,Ae,null,ct):xe=new pbe({shape:{angle:-Math.PI/2,width:ye,r:Ae,x:Fe,y:je}}),xe.rotation=-(ae+Math.PI/2),xe.x=s.cx,xe.y=s.cy,xe}function ee(te,ae){var de=E.get("roundCap"),ve=de?XA:Ps,ye=E.get("overlap"),Ae=ye?E.get("width"):f/O.count(),me=ye?s.r-Ae:s.r-(te+1)*Ae,De=ye?s.r:s.r-te*Ae,Fe=new ve({shape:{startAngle:o,endAngle:ae,cx:s.cx,cy:s.cy,clockwise:c,r0:me,r:De}});return ye&&(Fe.z2=Ii(O.get(B,te),[F,W],[100,0],!0)),Fe}(P||C)&&(O.diff(y).add(function(te){var ae=O.get(B,te);if(C){var de=Q(te,o);An(de,{rotation:-((isNaN(+ae)?q[0]:Ii(ae,$,q,!0))+Math.PI/2)},t),p.add(de),O.setItemGraphicEl(te,de)}if(P){var ve=ee(te,o),ye=E.get("clip");An(ve,{shape:{endAngle:Ii(ae,$,q,ye)}},t),p.add(ve),JR(t.seriesIndex,O.dataType,te,ve),S[te]=ve}}).update(function(te,ae){var de=O.get(B,te);if(C){var ve=y.getItemGraphicEl(ae),ye=ve?ve.rotation:o,Ae=Q(te,ye);Ae.rotation=ye,vi(Ae,{rotation:-((isNaN(+de)?q[0]:Ii(de,$,q,!0))+Math.PI/2)},t),p.add(Ae),O.setItemGraphicEl(te,Ae)}if(P){var me=b[ae],De=me?me.shape.endAngle:o,Fe=ee(te,De),je=E.get("clip");vi(Fe,{shape:{endAngle:Ii(de,$,q,je)}},t),p.add(Fe),JR(t.seriesIndex,O.dataType,te,Fe),S[te]=Fe}}).execute(),O.each(function(te){var ae=O.getItemModel(te),de=ae.getModel("emphasis"),ve=de.get("focus"),ye=de.get("blurScope"),Ae=de.get("disabled");if(C){var me=O.getItemGraphicEl(te),De=O.getItemVisual(te,"style"),Fe=De.fill;if(me instanceof go){var je=me.style;me.useStyle(mt({image:je.image,x:je.x,y:je.y,width:je.width,height:je.height},De))}else me.useStyle(De),me.type!=="pointer"&&me.setColor(Fe);me.setStyle(ae.getModel(["pointer","itemStyle"]).getItemStyle()),me.style.fill==="auto"&&me.setStyle("fill",a(Ii(O.get(B,te),$,[0,1],!0))),me.z2EmphasisLift=0,ts(me,ae),Hn(me,ve,ye,Ae)}if(P){var ct=S[te];ct.useStyle(O.getItemVisual(te,"style")),ct.setStyle(ae.getModel(["progress","itemStyle"]).getItemStyle()),ct.z2EmphasisLift=0,ts(ct,ae),Hn(ct,ve,ye,Ae)}}),this._progressEls=S)},e.prototype._renderAnchor=function(t,i){var n=t.getModel("anchor"),a=n.get("show");if(a){var s=n.get("size"),o=n.get("icon"),l=n.get("offsetCenter"),c=n.get("keepAspect"),f=Aa(o,i.cx-s/2+Vt(l[0],i.r),i.cy-s/2+Vt(l[1],i.r),s,s,null,c);f.z2=n.get("showAbove")?1:0,f.setStyle(n.getModel("itemStyle").getItemStyle()),this.group.add(f)}},e.prototype._renderTitleAndDetail=function(t,i,n,a,s){var o=this,l=t.getData(),c=l.mapDimension("value"),f=+t.get("min"),p=+t.get("max"),y=new mr,b=[],S=[],C=t.isAnimationEnabled(),E=t.get(["pointer","showAbove"]);l.diff(this._data).add(function(P){b[P]=new si({silent:!0}),S[P]=new si({silent:!0})}).update(function(P,O){b[P]=o._titleEls[O],S[P]=o._detailEls[O]}).execute(),l.each(function(P){var O=l.getItemModel(P),B=l.get(c,P),F=new mr,W=a(Ii(B,[f,p],[0,1],!0)),$=O.getModel("title");if($.get("show")){var q=$.get("offsetCenter"),Q=s.cx+Vt(q[0],s.r),ee=s.cy+Vt(q[1],s.r),te=b[P];te.attr({z2:E?0:2,style:cn($,{x:Q,y:ee,text:l.getName(P),align:"center",verticalAlign:"middle"},{inheritColor:W})}),F.add(te)}var ae=O.getModel("detail");if(ae.get("show")){var de=ae.get("offsetCenter"),ve=s.cx+Vt(de[0],s.r),ye=s.cy+Vt(de[1],s.r),Ae=Vt(ae.get("width"),s.r),me=Vt(ae.get("height"),s.r),De=t.get(["progress","show"])?l.getItemVisual(P,"style").fill:W,te=S[P],Fe=ae.get("formatter");te.attr({z2:E?0:2,style:cn(ae,{x:ve,y:ye,text:a2(B,Fe),width:isNaN(Ae)?null:Ae,height:isNaN(me)?null:me,align:"center",verticalAlign:"middle"},{inheritColor:De})}),m7(te,{normal:ae},B,function(ct){return a2(ct,Fe)}),C&&y7(te,P,l,t,{getFormattedLabel:function(ct,xe,$e,pt,_t,Dt){return a2(Dt?Dt.interpolatedValue:B,Fe)}}),F.add(te)}y.add(F)}),this.group.add(y),this._titleEls=b,this._detailEls=S},e.type="gauge",e})(Fi),mbe=(function(r){Ye(e,r);function e(){var t=r!==null&&r.apply(this,arguments)||this;return t.type=e.type,t.visualStyleAccessPath="itemStyle",t}return e.prototype.getInitialData=function(t,i){return Sb(this,["value"])},e.type="series.gauge",e.defaultOption={z:2,colorBy:"data",center:["50%","50%"],legendHoverLink:!0,radius:"75%",startAngle:225,endAngle:-45,clockwise:!0,min:0,max:100,splitNumber:10,axisLine:{show:!0,roundCap:!1,lineStyle:{color:[[1,"#E6EBF8"]],width:10}},progress:{show:!1,overlap:!0,width:10,roundCap:!1,clip:!0},splitLine:{show:!0,length:10,distance:10,lineStyle:{color:"#63677A",width:3,type:"solid"}},axisTick:{show:!0,splitNumber:5,length:6,distance:10,lineStyle:{color:"#63677A",width:1,type:"solid"}},axisLabel:{show:!0,distance:15,color:"#464646",fontSize:12,rotate:0},pointer:{icon:null,offsetCenter:[0,0],show:!0,showAbove:!0,length:"60%",width:6,keepAspect:!1},anchor:{show:!1,showAbove:!1,size:6,icon:"circle",offsetCenter:[0,0],keepAspect:!1,itemStyle:{color:"#fff",borderWidth:0,borderColor:"#5470c6"}},title:{show:!0,offsetCenter:[0,"20%"],color:"#464646",fontSize:16,valueAnimation:!1},detail:{show:!0,backgroundColor:"rgba(0,0,0,0)",borderWidth:0,borderColor:"#ccc",width:100,height:null,padding:[5,10],offsetCenter:[0,"40%"],color:"#464646",fontSize:30,fontWeight:"bold",lineHeight:30,valueAnimation:!1}},e})(Xi);function ybe(r){r.registerChartView(vbe),r.registerSeriesModel(mbe)}var _be=["itemStyle","opacity"],bbe=(function(r){Ye(e,r);function e(t,i){var n=r.call(this)||this,a=n,s=new ks,o=new si;return a.setTextContent(o),n.setTextGuideLine(s),n.updateData(t,i,!0),n}return e.prototype.updateData=function(t,i,n){var a=this,s=t.hostModel,o=t.getItemModel(i),l=t.getItemLayout(i),c=o.getModel("emphasis"),f=o.get(_be);f=f??1,n||Dh(a),a.useStyle(t.getItemVisual(i,"style")),a.style.lineJoin="round",n?(a.setShape({points:l.points}),a.style.opacity=0,An(a,{style:{opacity:f}},s,i)):vi(a,{style:{opacity:f},shape:{points:l.points}},s,i),ts(a,o),this._updateLabel(t,i),Hn(this,c.get("focus"),c.get("blurScope"),c.get("disabled"))},e.prototype._updateLabel=function(t,i){var n=this,a=this.getTextGuideLine(),s=n.getTextContent(),o=t.hostModel,l=t.getItemModel(i),c=t.getItemLayout(i),f=c.label,p=t.getItemVisual(i,"style"),y=p.fill;rs(s,fo(l),{labelFetcher:t.hostModel,labelDataIndex:i,defaultOpacity:p.opacity,defaultText:t.getName(i)},{normal:{align:f.textAlign,verticalAlign:f.verticalAlign}}),n.setTextConfig({local:!0,inside:!!f.inside,insideStroke:y,outsideFill:y});var b=f.linePoints;a.setShape({points:b}),n.textGuideLineConfig={anchor:b?new Rr(b[0][0],b[0][1]):null},vi(s,{style:{x:f.x,y:f.y}},o,i),s.attr({rotation:f.rotation,originX:f.x,originY:f.y,z2:10}),ML(n,EL(l),{stroke:y})},e})(Rs),xbe=(function(r){Ye(e,r);function e(){var t=r!==null&&r.apply(this,arguments)||this;return t.type=e.type,t.ignoreLabelLineUpdate=!0,t}return e.prototype.render=function(t,i,n){var a=t.getData(),s=this._data,o=this.group;a.diff(s).add(function(l){var c=new bbe(a,l);a.setItemGraphicEl(l,c),o.add(c)}).update(function(l,c){var f=s.getItemGraphicEl(c);f.updateData(a,l),o.add(f),a.setItemGraphicEl(l,f)}).remove(function(l){var c=s.getItemGraphicEl(l);vw(c,t,l)}).execute(),this._data=a},e.prototype.remove=function(){this.group.removeAll(),this._data=null},e.prototype.dispose=function(){},e.type="funnel",e})(Fi),wbe=(function(r){Ye(e,r);function e(){var t=r!==null&&r.apply(this,arguments)||this;return t.type=e.type,t}return e.prototype.init=function(t){r.prototype.init.apply(this,arguments),this.legendVisualProvider=new oS(Xt(this.getData,this),Xt(this.getRawData,this)),this._defaultLabelLine(t)},e.prototype.getInitialData=function(t,i){return Sb(this,{coordDimensions:["value"],encodeDefaulter:Sr(tL,this)})},e.prototype._defaultLabelLine=function(t){vy(t,"labelLine",["show"]);var i=t.labelLine,n=t.emphasis.labelLine;i.show=i.show&&t.label.show,n.show=n.show&&t.emphasis.label.show},e.prototype.getDataParams=function(t){var i=this.getData(),n=r.prototype.getDataParams.call(this,t),a=i.mapDimension("value"),s=i.getSum(a);return n.percent=s?+(i.get(a,t)/s*100).toFixed(2):0,n.$vars.push("percent"),n},e.type="series.funnel",e.defaultOption={z:2,legendHoverLink:!0,colorBy:"data",left:80,top:60,right:80,bottom:60,minSize:"0%",maxSize:"100%",sort:"descending",orient:"vertical",gap:0,funnelAlign:"center",label:{show:!0,position:"outer"},labelLine:{show:!0,length:20,lineStyle:{width:1}},itemStyle:{borderColor:"#fff",borderWidth:1},emphasis:{label:{show:!0}},select:{itemStyle:{borderColor:"#212121"}}},e})(Xi);function Sbe(r,e){return La(r.getBoxLayoutParams(),{width:e.getWidth(),height:e.getHeight()})}function Tbe(r,e){for(var t=r.mapDimension("value"),i=r.mapArray(t,function(l){return l}),n=[],a=e==="ascending",s=0,o=r.count();s<o;s++)n[s]=s;return sr(e)?n.sort(e):e!=="none"&&n.sort(function(l,c){return a?i[l]-i[c]:i[c]-i[l]}),n}function Abe(r){var e=r.hostModel,t=e.get("orient");r.each(function(i){var n=r.getItemModel(i),a=n.getModel("label"),s=a.get("position"),o=n.getModel("labelLine"),l=r.getItemLayout(i),c=l.points,f=s==="inner"||s==="inside"||s==="center"||s==="insideLeft"||s==="insideRight",p,y,b,S;if(f)s==="insideLeft"?(y=(c[0][0]+c[3][0])/2+5,b=(c[0][1]+c[3][1])/2,p="left"):s==="insideRight"?(y=(c[1][0]+c[2][0])/2-5,b=(c[1][1]+c[2][1])/2,p="right"):(y=(c[0][0]+c[1][0]+c[2][0]+c[3][0])/4,b=(c[0][1]+c[1][1]+c[2][1]+c[3][1])/4,p="center"),S=[[y,b],[y,b]];else{var C=void 0,E=void 0,P=void 0,O=void 0,B=o.get("length");s==="left"?(C=(c[3][0]+c[0][0])/2,E=(c[3][1]+c[0][1])/2,P=C-B,y=P-5,p="right"):s==="right"?(C=(c[1][0]+c[2][0])/2,E=(c[1][1]+c[2][1])/2,P=C+B,y=P+5,p="left"):s==="top"?(C=(c[3][0]+c[0][0])/2,E=(c[3][1]+c[0][1])/2,O=E-B,b=O-5,p="center"):s==="bottom"?(C=(c[1][0]+c[2][0])/2,E=(c[1][1]+c[2][1])/2,O=E+B,b=O+5,p="center"):s==="rightTop"?(C=t==="horizontal"?c[3][0]:c[1][0],E=t==="horizontal"?c[3][1]:c[1][1],t==="horizontal"?(O=E-B,b=O-5,p="center"):(P=C+B,y=P+5,p="top")):s==="rightBottom"?(C=c[2][0],E=c[2][1],t==="horizontal"?(O=E+B,b=O+5,p="center"):(P=C+B,y=P+5,p="bottom")):s==="leftTop"?(C=c[0][0],E=t==="horizontal"?c[0][1]:c[1][1],t==="horizontal"?(O=E-B,b=O-5,p="center"):(P=C-B,y=P-5,p="right")):s==="leftBottom"?(C=t==="horizontal"?c[1][0]:c[3][0],E=t==="horizontal"?c[1][1]:c[2][1],t==="horizontal"?(O=E+B,b=O+5,p="center"):(P=C-B,y=P-5,p="right")):(C=(c[1][0]+c[2][0])/2,E=(c[1][1]+c[2][1])/2,t==="horizontal"?(O=E+B,b=O+5,p="center"):(P=C+B,y=P+5,p="left")),t==="horizontal"?(P=C,y=P):(O=E,b=O),S=[[C,E],[P,O]]}l.label={linePoints:S,x:y,y:b,verticalAlign:"middle",textAlign:p,inside:f}})}function Cbe(r,e){r.eachSeriesByType("funnel",function(t){var i=t.getData(),n=i.mapDimension("value"),a=t.get("sort"),s=Sbe(t,e),o=t.get("orient"),l=s.width,c=s.height,f=Tbe(i,a),p=s.x,y=s.y,b=o==="horizontal"?[Vt(t.get("minSize"),c),Vt(t.get("maxSize"),c)]:[Vt(t.get("minSize"),l),Vt(t.get("maxSize"),l)],S=i.getDataExtent(n),C=t.get("min"),E=t.get("max");C==null&&(C=Math.min(S[0],0)),E==null&&(E=S[1]);var P=t.get("funnelAlign"),O=t.get("gap"),B=o==="horizontal"?l:c,F=(B-O*(i.count()-1))/i.count(),W=function(ye,Ae){if(o==="horizontal"){var me=i.get(n,ye)||0,De=Ii(me,[C,E],b,!0),Fe=void 0;switch(P){case"top":Fe=y;break;case"center":Fe=y+(c-De)/2;break;case"bottom":Fe=y+(c-De);break}return[[Ae,Fe],[Ae,Fe+De]]}var je=i.get(n,ye)||0,ct=Ii(je,[C,E],b,!0),xe;switch(P){case"left":xe=p;break;case"center":xe=p+(l-ct)/2;break;case"right":xe=p+l-ct;break}return[[xe,Ae],[xe+ct,Ae]]};a==="ascending"&&(F=-F,O=-O,o==="horizontal"?p+=l:y+=c,f=f.reverse());for(var $=0;$<f.length;$++){var q=f[$],Q=f[$+1],ee=i.getItemModel(q);if(o==="horizontal"){var te=ee.get(["itemStyle","width"]);te==null?te=F:(te=Vt(te,l),a==="ascending"&&(te=-te));var ae=W(q,p),de=W(Q,p+te);p+=te+O,i.setItemLayout(q,{points:ae.concat(de.slice().reverse())})}else{var ve=ee.get(["itemStyle","height"]);ve==null?ve=F:(ve=Vt(ve,c),a==="ascending"&&(ve=-ve));var ae=W(q,y),de=W(Q,y+ve);y+=ve+O,i.setItemLayout(q,{points:ae.concat(de.slice().reverse())})}}Abe(i)})}function Mbe(r){r.registerChartView(xbe),r.registerSeriesModel(wbe),r.registerLayout(Cbe),r.registerProcessor(aS("funnel"))}var Ebe=.3,Ibe=(function(r){Ye(e,r);function e(){var t=r!==null&&r.apply(this,arguments)||this;return t.type=e.type,t._dataGroup=new mr,t._initialized=!1,t}return e.prototype.init=function(){this.group.add(this._dataGroup)},e.prototype.render=function(t,i,n,a){this._progressiveEls=null;var s=this._dataGroup,o=t.getData(),l=this._data,c=t.coordinateSystem,f=c.dimensions,p=M6(t);o.diff(l).add(y).update(b).remove(S).execute();function y(E){var P=C6(o,s,E,f,c);oP(P,o,E,p)}function b(E,P){var O=l.getItemGraphicEl(P),B=$G(o,E,f,c);o.setItemGraphicEl(E,O),vi(O,{shape:{points:B}},t,E),Dh(O),oP(O,o,E,p)}function S(E){var P=l.getItemGraphicEl(E);s.remove(P)}if(!this._initialized){this._initialized=!0;var C=Pbe(c,t,function(){setTimeout(function(){s.removeClipPath()})});s.setClipPath(C)}this._data=o},e.prototype.incrementalPrepareRender=function(t,i,n){this._initialized=!0,this._data=null,this._dataGroup.removeAll()},e.prototype.incrementalRender=function(t,i,n){for(var a=i.getData(),s=i.coordinateSystem,o=s.dimensions,l=M6(i),c=this._progressiveEls=[],f=t.start;f<t.end;f++){var p=C6(a,this._dataGroup,f,o,s);p.incremental=!0,oP(p,a,f,l),c.push(p)}},e.prototype.remove=function(){this._dataGroup&&this._dataGroup.removeAll(),this._data=null},e.type="parallel",e})(Fi);function Pbe(r,e,t){var i=r.model,n=r.getRect(),a=new li({shape:{x:n.x,y:n.y,width:n.width,height:n.height}}),s=i.get("layout")==="horizontal"?"width":"height";return a.setShape(s,0),An(a,{shape:{width:n.width,height:n.height}},e,t),a}function $G(r,e,t,i){for(var n=[],a=0;a<t.length;a++){var s=t[a],o=r.get(r.mapDimension(s),e);Rbe(o,i.getAxis(s).type)||n.push(i.dataToPoint(o,s))}return n}function C6(r,e,t,i,n){var a=$G(r,t,i,n),s=new ks({shape:{points:a},z2:10});return e.add(s),r.setItemGraphicEl(t,s),s}function M6(r){var e=r.get("smooth",!0);return e===!0&&(e=Ebe),e=Hf(e),j0(e)&&(e=0),{smooth:e}}function oP(r,e,t,i){r.useStyle(e.getItemVisual(t,"style")),r.style.fill=null,r.setShape("smooth",i.smooth);var n=e.getItemModel(t),a=n.getModel("emphasis");ts(r,n,"lineStyle"),Hn(r,a.get("focus"),a.get("blurScope"),a.get("disabled"))}function Rbe(r,e){return e==="category"?r==null:r==null||isNaN(r)}var Dbe=(function(r){Ye(e,r);function e(){var t=r!==null&&r.apply(this,arguments)||this;return t.type=e.type,t.visualStyleAccessPath="lineStyle",t.visualDrawType="stroke",t}return e.prototype.getInitialData=function(t,i){return Gf(null,this,{useEncodeDefaulter:Xt(kbe,null,this)})},e.prototype.getRawIndicesByActiveState=function(t){var i=this.coordinateSystem,n=this.getData(),a=[];return i.eachActiveState(n,function(s,o){t===s&&a.push(n.getRawIndex(o))}),a},e.type="series.parallel",e.dependencies=["parallel"],e.defaultOption={z:2,coordinateSystem:"parallel",parallelIndex:0,label:{show:!1},inactiveOpacity:.05,activeOpacity:1,lineStyle:{width:1,opacity:.45,type:"solid"},emphasis:{label:{show:!1}},progressive:500,smooth:!1,animationEasing:"linear"},e})(Xi);function kbe(r){var e=r.ecModel.getComponent("parallel",r.get("parallelIndex"));if(e){var t={};return se(e.dimensions,function(i){var n=Lbe(i);t[i]=n}),t}}function Lbe(r){return+r.replace("dim","")}var Obe=["lineStyle","opacity"],Nbe={seriesType:"parallel",reset:function(r,e){var t=r.coordinateSystem,i={normal:r.get(["lineStyle","opacity"]),active:r.get("activeOpacity"),inactive:r.get("inactiveOpacity")};return{progress:function(n,a){t.eachActiveState(a,function(s,o){var l=i[s];if(s==="normal"&&a.hasItemOption){var c=a.getItemModel(o).get(Obe,!0);c!=null&&(l=c)}var f=a.ensureUniqueItemVisual(o,"style");f.opacity=l},n.start,n.end)}}}};function Bbe(r){zbe(r),Fbe(r)}function zbe(r){if(!r.parallel){var e=!1;se(r.series,function(t){t&&t.type==="parallel"&&(e=!0)}),e&&(r.parallel=[{}])}}function Fbe(r){var e=Gi(r.parallelAxis);se(e,function(t){if(cr(t)){var i=t.parallelIndex||0,n=Gi(r.parallel)[i];n&&n.parallelAxisDefault&&Cr(t,n.parallelAxisDefault,!1)}})}var Vbe=5,Ube=(function(r){Ye(e,r);function e(){var t=r!==null&&r.apply(this,arguments)||this;return t.type=e.type,t}return e.prototype.render=function(t,i,n){this._model=t,this._api=n,this._handlers||(this._handlers={},se(Hbe,function(a,s){n.getZr().on(s,this._handlers[s]=Xt(a,this))},this)),yb(this,"_throttledDispatchExpand",t.get("axisExpandRate"),"fixRate")},e.prototype.dispose=function(t,i){bw(this,"_throttledDispatchExpand"),se(this._handlers,function(n,a){i.getZr().off(a,n)}),this._handlers=null},e.prototype._throttledDispatchExpand=function(t){this._dispatchExpand(t)},e.prototype._dispatchExpand=function(t){t&&this._api.dispatchAction(mt({type:"parallelAxisExpand"},t))},e.type="parallel",e})(vn),Hbe={mousedown:function(r){sP(this,"click")&&(this._mouseDownPoint=[r.offsetX,r.offsetY])},mouseup:function(r){var e=this._mouseDownPoint;if(sP(this,"click")&&e){var t=[r.offsetX,r.offsetY],i=Math.pow(e[0]-t[0],2)+Math.pow(e[1]-t[1],2);if(i>Vbe)return;var n=this._model.coordinateSystem.getSlidedAxisExpandWindow([r.offsetX,r.offsetY]);n.behavior!=="none"&&this._dispatchExpand({axisExpandWindow:n.axisExpandWindow})}this._mouseDownPoint=null},mousemove:function(r){if(!(this._mouseDownPoint||!sP(this,"mousemove"))){var e=this._model,t=e.coordinateSystem.getSlidedAxisExpandWindow([r.offsetX,r.offsetY]),i=t.behavior;i==="jump"&&this._throttledDispatchExpand.debounceNextCall(e.get("axisExpandDebounce")),this._throttledDispatchExpand(i==="none"?null:{axisExpandWindow:t.axisExpandWindow,animation:i==="jump"?null:{duration:0}})}}};function sP(r,e){var t=r._model;return t.get("axisExpandable")&&t.get("axisExpandTriggerOn")===e}var jbe=(function(r){Ye(e,r);function e(){var t=r!==null&&r.apply(this,arguments)||this;return t.type=e.type,t}return e.prototype.init=function(){r.prototype.init.apply(this,arguments),this.mergeOption({})},e.prototype.mergeOption=function(t){var i=this.option;t&&Cr(i,t,!0),this._initDimensions()},e.prototype.contains=function(t,i){var n=t.get("parallelIndex");return n!=null&&i.getComponent("parallel",n)===this},e.prototype.setAxisExpand=function(t){se(["axisExpandable","axisExpandCenter","axisExpandCount","axisExpandWidth","axisExpandWindow"],function(i){t.hasOwnProperty(i)&&(this.option[i]=t[i])},this)},e.prototype._initDimensions=function(){var t=this.dimensions=[],i=this.parallelAxisIndex=[],n=wi(this.ecModel.queryComponents({mainType:"parallelAxis"}),function(a){return(a.get("parallelIndex")||0)===this.componentIndex},this);se(n,function(a){t.push("dim"+a.get("dim")),i.push(a.componentIndex)})},e.type="parallel",e.dependencies=["parallelAxis"],e.layoutMode="box",e.defaultOption={z:0,left:80,top:60,right:80,bottom:60,layout:"horizontal",axisExpandable:!1,axisExpandCenter:null,axisExpandCount:0,axisExpandWidth:50,axisExpandRate:17,axisExpandDebounce:50,axisExpandSlideTriggerArea:[-.15,.05,.4],axisExpandTriggerOn:"click",parallelAxisDefault:null},e})(Wr),$be=(function(r){Ye(e,r);function e(t,i,n,a,s){var o=r.call(this,t,i,n)||this;return o.type=a||"value",o.axisIndex=s,o}return e.prototype.isHorizontal=function(){return this.coordinateSystem.getModel().get("layout")!=="horizontal"},e})(Pc);function Oy(r,e,t,i,n,a){r=r||0;var s=t[1]-t[0];if(n!=null&&(n=t0(n,[0,s])),a!=null&&(a=Math.max(a,n??0)),i==="all"){var o=Math.abs(e[1]-e[0]);o=t0(o,[0,s]),n=a=t0(o,[n,a]),i=0}e[0]=t0(e[0],t),e[1]=t0(e[1],t);var l=lP(e,i);e[i]+=r;var c=n||0,f=t.slice();l.sign<0?f[0]+=c:f[1]-=c,e[i]=t0(e[i],f);var p;return p=lP(e,i),n!=null&&(p.sign!==l.sign||p.span<n)&&(e[1-i]=e[i]+l.sign*n),p=lP(e,i),a!=null&&p.span>a&&(e[1-i]=e[i]+p.sign*a),e}function lP(r,e){var t=r[e]-r[1-e];return{span:Math.abs(t),sign:t>0?-1:t<0?1:e?-1:1}}function t0(r,e){return Math.min(e[1]!=null?e[1]:1/0,Math.max(e[0]!=null?e[0]:-1/0,r))}var uP=se,WG=Math.min,GG=Math.max,E6=Math.floor,Wbe=Math.ceil,I6=Qn,Gbe=Math.PI,Xbe=(function(){function r(e,t,i){this.type="parallel",this._axesMap=Qt(),this._axesLayout={},this.dimensions=e.dimensions,this._model=e,this._init(e,t,i)}return r.prototype._init=function(e,t,i){var n=e.dimensions,a=e.parallelAxisIndex;uP(n,function(s,o){var l=a[o],c=t.getComponent("parallelAxis",l),f=this._axesMap.set(s,new $be(s,eS(c),[0,0],c.get("type"),l)),p=f.type==="category";f.onBand=p&&c.get("boundaryGap"),f.inverse=c.get("inverse"),c.axis=f,f.model=c,f.coordinateSystem=c.coordinateSystem=this},this)},r.prototype.update=function(e,t){this._updateAxesFromSeries(this._model,e)},r.prototype.containPoint=function(e){var t=this._makeLayoutInfo(),i=t.axisBase,n=t.layoutBase,a=t.pixelDimIndex,s=e[1-a],o=e[a];return s>=i&&s<=i+t.axisLength&&o>=n&&o<=n+t.layoutLength},r.prototype.getModel=function(){return this._model},r.prototype._updateAxesFromSeries=function(e,t){t.eachSeries(function(i){if(e.contains(i,t)){var n=i.getData();uP(this.dimensions,function(a){var s=this._axesMap.get(a);s.scale.unionExtentFromData(n,n.mapDimension(a)),xy(s.scale,s.model)},this)}},this)},r.prototype.resize=function(e,t){this._rect=La(e.getBoxLayoutParams(),{width:t.getWidth(),height:t.getHeight()}),this._layoutAxes()},r.prototype.getRect=function(){return this._rect},r.prototype._makeLayoutInfo=function(){var e=this._model,t=this._rect,i=["x","y"],n=["width","height"],a=e.get("layout"),s=a==="horizontal"?0:1,o=t[n[s]],l=[0,o],c=this.dimensions.length,f=o2(e.get("axisExpandWidth"),l),p=o2(e.get("axisExpandCount")||0,[0,c]),y=e.get("axisExpandable")&&c>3&&c>p&&p>1&&f>0&&o>0,b=e.get("axisExpandWindow"),S;if(b)S=o2(b[1]-b[0],l),b[1]=b[0]+S;else{S=o2(f*(p-1),l);var C=e.get("axisExpandCenter")||E6(c/2);b=[f*C-S/2],b[1]=b[0]+S}var E=(o-S)/(c-p);E<3&&(E=0);var P=[E6(I6(b[0]/f,1))+1,Wbe(I6(b[1]/f,1))-1],O=E/f*b[0];return{layout:a,pixelDimIndex:s,layoutBase:t[i[s]],layoutLength:o,axisBase:t[i[1-s]],axisLength:t[n[1-s]],axisExpandable:y,axisExpandWidth:f,axisCollapseWidth:E,axisExpandWindow:b,axisCount:c,winInnerIndices:P,axisExpandWindow0Pos:O}},r.prototype._layoutAxes=function(){var e=this._rect,t=this._axesMap,i=this.dimensions,n=this._makeLayoutInfo(),a=n.layout;t.each(function(s){var o=[0,n.axisLength],l=s.inverse?1:0;s.setExtent(o[l],o[1-l])}),uP(i,function(s,o){var l=(n.axisExpandable?qbe:Zbe)(o,n),c={horizontal:{x:l.position,y:n.axisLength},vertical:{x:0,y:l.position}},f={horizontal:Gbe/2,vertical:0},p=[c[a].x+e.x,c[a].y+e.y],y=f[a],b=kl();Zg(b,b,y),Ph(b,b,p),this._axesLayout[s]={position:p,rotation:y,transform:b,axisNameAvailableWidth:l.axisNameAvailableWidth,axisLabelShow:l.axisLabelShow,nameTruncateMaxWidth:l.nameTruncateMaxWidth,tickDirection:1,labelDirection:1}},this)},r.prototype.getAxis=function(e){return this._axesMap.get(e)},r.prototype.dataToPoint=function(e,t){return this.axisCoordToPoint(this._axesMap.get(t).dataToCoord(e),t)},r.prototype.eachActiveState=function(e,t,i,n){i==null&&(i=0),n==null&&(n=e.count());var a=this._axesMap,s=this.dimensions,o=[],l=[];se(s,function(E){o.push(e.mapDimension(E)),l.push(a.get(E).model)});for(var c=this.hasAxisBrushed(),f=i;f<n;f++){var p=void 0;if(!c)p="normal";else{p="active";for(var y=e.getValues(o,f),b=0,S=s.length;b<S;b++){var C=l[b].getActiveState(y[b]);if(C==="inactive"){p="inactive";break}}}t(p,f)}},r.prototype.hasAxisBrushed=function(){for(var e=this.dimensions,t=this._axesMap,i=!1,n=0,a=e.length;n<a;n++)t.get(e[n]).model.getActiveState()!=="normal"&&(i=!0);return i},r.prototype.axisCoordToPoint=function(e,t){var i=this._axesLayout[t];return Mh([e,0],i.transform)},r.prototype.getAxisLayout=function(e){return hr(this._axesLayout[e])},r.prototype.getSlidedAxisExpandWindow=function(e){var t=this._makeLayoutInfo(),i=t.pixelDimIndex,n=t.axisExpandWindow.slice(),a=n[1]-n[0],s=[0,t.axisExpandWidth*(t.axisCount-1)];if(!this.containPoint(e))return{behavior:"none",axisExpandWindow:n};var o=e[i]-t.layoutBase-t.axisExpandWindow0Pos,l,c="slide",f=t.axisCollapseWidth,p=this._model.get("axisExpandSlideTriggerArea"),y=p[0]!=null;if(f)y&&f&&o<a*p[0]?(c="jump",l=o-a*p[2]):y&&f&&o>a*(1-p[0])?(c="jump",l=o-a*(1-p[2])):(l=o-a*p[1])>=0&&(l=o-a*(1-p[1]))<=0&&(l=0),l*=t.axisExpandWidth/f,l?Oy(l,n,s,"all"):c="none";else{var b=n[1]-n[0],S=s[1]*o/b;n=[GG(0,S-b/2)],n[1]=WG(s[1],n[0]+b),n[0]=n[1]-b}return{axisExpandWindow:n,behavior:c}},r})();function o2(r,e){return WG(GG(r,e[0]),e[1])}function Zbe(r,e){var t=e.layoutLength/(e.axisCount-1);return{position:t*r,axisNameAvailableWidth:t,axisLabelShow:!0}}function qbe(r,e){var t=e.layoutLength,i=e.axisExpandWidth,n=e.axisCount,a=e.axisCollapseWidth,s=e.winInnerIndices,o,l=a,c=!1,f;return r<s[0]?(o=r*a,f=a):r<=s[1]?(o=e.axisExpandWindow0Pos+r*i-e.axisExpandWindow[0],l=i,c=!0):(o=t-(n-1-r)*a,f=a),{position:o,axisNameAvailableWidth:l,axisLabelShow:c,nameTruncateMaxWidth:f}}function Ybe(r,e){var t=[];return r.eachComponent("parallel",function(i,n){var a=new Xbe(i,r,e);a.name="parallel_"+n,a.resize(i,e),i.coordinateSystem=a,a.model=i,t.push(a)}),r.eachSeries(function(i){if(i.get("coordinateSystem")==="parallel"){var n=i.getReferringComponents("parallel",ka).models[0];i.coordinateSystem=n.coordinateSystem}}),t}var Kbe={create:Ybe},$3=(function(r){Ye(e,r);function e(){var t=r!==null&&r.apply(this,arguments)||this;return t.type=e.type,t.activeIntervals=[],t}return e.prototype.getAreaSelectStyle=function(){return yy([["fill","color"],["lineWidth","borderWidth"],["stroke","borderColor"],["width","width"],["opacity","opacity"]])(this.getModel("areaSelectStyle"))},e.prototype.setActiveIntervals=function(t){var i=this.activeIntervals=hr(t);if(i)for(var n=i.length-1;n>=0;n--)yu(i[n])},e.prototype.getActiveState=function(t){var i=this.activeIntervals;if(!i.length)return"normal";if(t==null||isNaN(+t))return"inactive";if(i.length===1){var n=i[0];if(n[0]<=t&&t<=n[1])return"active"}else for(var a=0,s=i.length;a<s;a++)if(i[a][0]<=t&&t<=i[a][1])return"active";return"inactive"},e})(Wr);ha($3,wb);var wy=!0,Dw=Math.min,Q0=Math.max,Qbe=Math.pow,Jbe=1e4,exe=6,txe=6,P6="globalPan",rxe={w:[0,0],e:[0,1],n:[1,0],s:[1,1]},ixe={w:"ew",e:"ew",n:"ns",s:"ns",ne:"nesw",sw:"nesw",nw:"nwse",se:"nwse"},R6={brushStyle:{lineWidth:2,stroke:"rgba(210,219,238,0.3)",fill:"#D2DBEE"},transformable:!0,brushMode:"single",removeOnClick:!1},nxe=0,KL=(function(r){Ye(e,r);function e(t){var i=r.call(this)||this;return i._track=[],i._covers=[],i._handlers={},i._zr=t,i.group=new mr,i._uid="brushController_"+nxe++,se(hxe,function(n,a){this._handlers[a]=Xt(n,this)},i),i}return e.prototype.enableBrush=function(t){return this._brushType&&this._doDisableBrush(),t.brushType&&this._doEnableBrush(t),this},e.prototype._doEnableBrush=function(t){var i=this._zr;this._enableGlobalPan||Zye(i,P6,this._uid),se(this._handlers,function(n,a){i.on(a,n)}),this._brushType=t.brushType,this._brushOption=Cr(hr(R6),t,!0)},e.prototype._doDisableBrush=function(){var t=this._zr;qye(t,P6,this._uid),se(this._handlers,function(i,n){t.off(n,i)}),this._brushType=this._brushOption=null},e.prototype.setPanels=function(t){if(t&&t.length){var i=this._panels={};se(t,function(n){i[n.panelId]=hr(n)})}else this._panels=null;return this},e.prototype.mount=function(t){t=t||{},this._enableGlobalPan=t.enableGlobalPan;var i=this.group;return this._zr.add(i),i.attr({x:t.x||0,y:t.y||0,rotation:t.rotation||0,scaleX:t.scaleX||1,scaleY:t.scaleY||1}),this._transform=i.getLocalTransform(),this},e.prototype.updateCovers=function(t){t=wt(t,function(y){return Cr(hr(R6),y,!0)});var i="\0-brush-index-",n=this._covers,a=this._covers=[],s=this,o=this._creatingCover;return new fp(n,t,c,l).add(f).update(f).remove(p).execute(),this;function l(y,b){return(y.id!=null?y.id:i+b)+"-"+y.brushType}function c(y,b){return l(y.__brushOption,b)}function f(y,b){var S=t[y];if(b!=null&&n[b]===o)a[y]=n[b];else{var C=a[y]=b!=null?(n[b].__brushOption=S,n[b]):ZG(s,XG(s,S));QL(s,C)}}function p(y){n[y]!==o&&s.group.remove(n[y])}},e.prototype.unmount=function(){return this.enableBrush(!1),W3(this),this._zr.remove(this.group),this},e.prototype.dispose=function(){this.unmount(),this.off()},e})(Cc);function XG(r,e){var t=uM[e.brushType].createCover(r,e);return t.__brushOption=e,YG(t,e),r.group.add(t),t}function ZG(r,e){var t=JL(e);return t.endCreating&&(t.endCreating(r,e),YG(e,e.__brushOption)),e}function qG(r,e){var t=e.__brushOption;JL(e).updateCoverShape(r,e,t.range,t)}function YG(r,e){var t=e.z;t==null&&(t=Jbe),r.traverse(function(i){i.z=t,i.z2=t})}function QL(r,e){JL(e).updateCommon(r,e),qG(r,e)}function JL(r){return uM[r.__brushOption.brushType]}function eO(r,e,t){var i=r._panels;if(!i)return wy;var n,a=r._transform;return se(i,function(s){s.isTargetByCursor(e,t,a)&&(n=s)}),n}function KG(r,e){var t=r._panels;if(!t)return wy;var i=e.__brushOption.panelId;return i!=null?t[i]:wy}function W3(r){var e=r._covers,t=e.length;return se(e,function(i){r.group.remove(i)},r),e.length=0,!!t}function Sy(r,e){var t=wt(r._covers,function(i){var n=i.__brushOption,a=hr(n.range);return{brushType:n.brushType,panelId:n.panelId,range:a}});r.trigger("brush",{areas:t,isEnd:!!e.isEnd,removeOnClick:!!e.removeOnClick})}function axe(r){var e=r._track;if(!e.length)return!1;var t=e[e.length-1],i=e[0],n=t[0]-i[0],a=t[1]-i[1],s=Qbe(n*n+a*a,.5);return s>exe}function QG(r){var e=r.length-1;return e<0&&(e=0),[r[0],r[e]]}function JG(r,e,t,i){var n=new mr;return n.add(new li({name:"main",style:tO(t),silent:!0,draggable:!0,cursor:"move",drift:Sr(D6,r,e,n,["n","s","w","e"]),ondragend:Sr(Sy,e,{isEnd:!0})})),se(i,function(a){n.add(new li({name:a.join(""),style:{opacity:0},draggable:!0,silent:!0,invisible:!0,drift:Sr(D6,r,e,n,a),ondragend:Sr(Sy,e,{isEnd:!0})}))}),n}function eX(r,e,t,i){var n=i.brushStyle.lineWidth||0,a=Q0(n,txe),s=t[0][0],o=t[1][0],l=s-n/2,c=o-n/2,f=t[0][1],p=t[1][1],y=f-a+n/2,b=p-a+n/2,S=f-s,C=p-o,E=S+n,P=C+n;Gd(r,e,"main",s,o,S,C),i.transformable&&(Gd(r,e,"w",l,c,a,P),Gd(r,e,"e",y,c,a,P),Gd(r,e,"n",l,c,E,a),Gd(r,e,"s",l,b,E,a),Gd(r,e,"nw",l,c,a,a),Gd(r,e,"ne",y,c,a,a),Gd(r,e,"sw",l,b,a,a),Gd(r,e,"se",y,b,a,a))}function G3(r,e){var t=e.__brushOption,i=t.transformable,n=e.childAt(0);n.useStyle(tO(t)),n.attr({silent:!i,cursor:i?"move":"default"}),se([["w"],["e"],["n"],["s"],["s","e"],["s","w"],["n","e"],["n","w"]],function(a){var s=e.childOfName(a.join("")),o=a.length===1?X3(r,a[0]):sxe(r,a);s&&s.attr({silent:!i,invisible:!i,cursor:i?ixe[o]+"-resize":null})})}function Gd(r,e,t,i,n,a,s){var o=e.childOfName(t);o&&o.setShape(uxe(rO(r,e,[[i,n],[i+a,n+s]])))}function tO(r){return lr({strokeNoScale:!0},r.brushStyle)}function tX(r,e,t,i){var n=[Dw(r,t),Dw(e,i)],a=[Q0(r,t),Q0(e,i)];return[[n[0],a[0]],[n[1],a[1]]]}function oxe(r){return Ng(r.group)}function X3(r,e){var t={w:"left",e:"right",n:"top",s:"bottom"},i={left:"w",right:"e",top:"n",bottom:"s"},n=UC(t[e],oxe(r));return i[n]}function sxe(r,e){var t=[X3(r,e[0]),X3(r,e[1])];return(t[0]==="e"||t[0]==="w")&&t.reverse(),t.join("")}function D6(r,e,t,i,n,a){var s=t.__brushOption,o=r.toRectRange(s.range),l=rX(e,n,a);se(i,function(c){var f=rxe[c];o[f[0]][f[1]]+=l[f[0]]}),s.range=r.fromRectRange(tX(o[0][0],o[1][0],o[0][1],o[1][1])),QL(e,t),Sy(e,{isEnd:!1})}function lxe(r,e,t,i){var n=e.__brushOption.range,a=rX(r,t,i);se(n,function(s){s[0]+=a[0],s[1]+=a[1]}),QL(r,e),Sy(r,{isEnd:!1})}function rX(r,e,t){var i=r.group,n=i.transformCoordToLocal(e,t),a=i.transformCoordToLocal(0,0);return[n[0]-a[0],n[1]-a[1]]}function rO(r,e,t){var i=KG(r,e);return i&&i!==wy?i.clipPath(t,r._transform):hr(t)}function uxe(r){var e=Dw(r[0][0],r[1][0]),t=Dw(r[0][1],r[1][1]),i=Q0(r[0][0],r[1][0]),n=Q0(r[0][1],r[1][1]);return{x:e,y:t,width:i-e,height:n-t}}function cxe(r,e,t){if(!(!r._brushType||fxe(r,e.offsetX,e.offsetY))){var i=r._zr,n=r._covers,a=eO(r,e,t);if(!r._dragging)for(var s=0;s<n.length;s++){var o=n[s].__brushOption;if(a&&(a===wy||o.panelId===a.panelId)&&uM[o.brushType].contain(n[s],t[0],t[1]))return}a&&i.setCursorStyle("crosshair")}}function Z3(r){var e=r.event;e.preventDefault&&e.preventDefault()}function q3(r,e,t){return r.childOfName("main").contain(e,t)}function iX(r,e,t,i){var n=r._creatingCover,a=r._creatingPanel,s=r._brushOption,o;if(r._track.push(t.slice()),axe(r)||n){if(a&&!n){s.brushMode==="single"&&W3(r);var l=hr(s);l.brushType=k6(l.brushType,a),l.panelId=a===wy?null:a.panelId,n=r._creatingCover=XG(r,l),r._covers.push(n)}if(n){var c=uM[k6(r._brushType,a)],f=n.__brushOption;f.range=c.getCreatingRange(rO(r,n,r._track)),i&&(ZG(r,n),c.updateCommon(r,n)),qG(r,n),o={isEnd:i}}}else i&&s.brushMode==="single"&&s.removeOnClick&&eO(r,e,t)&&W3(r)&&(o={isEnd:i,removeOnClick:!0});return o}function k6(r,e){return r==="auto"?e.defaultBrushType:r}var hxe={mousedown:function(r){if(this._dragging)L6(this,r);else if(!r.target||!r.target.draggable){Z3(r);var e=this.group.transformCoordToLocal(r.offsetX,r.offsetY);this._creatingCover=null;var t=this._creatingPanel=eO(this,r,e);t&&(this._dragging=!0,this._track=[e.slice()])}},mousemove:function(r){var e=r.offsetX,t=r.offsetY,i=this.group.transformCoordToLocal(e,t);if(cxe(this,r,i),this._dragging){Z3(r);var n=iX(this,r,i,!1);n&&Sy(this,n)}},mouseup:function(r){L6(this,r)}};function L6(r,e){if(r._dragging){Z3(e);var t=e.offsetX,i=e.offsetY,n=r.group.transformCoordToLocal(t,i),a=iX(r,e,n,!0);r._dragging=!1,r._track=[],r._creatingCover=null,a&&Sy(r,a)}}function fxe(r,e,t){var i=r._zr;return e<0||e>i.getWidth()||t<0||t>i.getHeight()}var uM={lineX:O6(0),lineY:O6(1),rect:{createCover:function(r,e){function t(i){return i}return JG({toRectRange:t,fromRectRange:t},r,e,[["w"],["e"],["n"],["s"],["s","e"],["s","w"],["n","e"],["n","w"]])},getCreatingRange:function(r){var e=QG(r);return tX(e[1][0],e[1][1],e[0][0],e[0][1])},updateCoverShape:function(r,e,t,i){eX(r,e,t,i)},updateCommon:G3,contain:q3},polygon:{createCover:function(r,e){var t=new mr;return t.add(new ks({name:"main",style:tO(e),silent:!0})),t},getCreatingRange:function(r){return r},endCreating:function(r,e){e.remove(e.childAt(0)),e.add(new Rs({name:"main",draggable:!0,drift:Sr(lxe,r,e),ondragend:Sr(Sy,r,{isEnd:!0})}))},updateCoverShape:function(r,e,t,i){e.childAt(0).setShape({points:rO(r,e,t)})},updateCommon:G3,contain:q3}};function O6(r){return{createCover:function(e,t){return JG({toRectRange:function(i){var n=[i,[0,100]];return r&&n.reverse(),n},fromRectRange:function(i){return i[r]}},e,t,[[["w"],["e"]],[["n"],["s"]]][r])},getCreatingRange:function(e){var t=QG(e),i=Dw(t[0][r],t[1][r]),n=Q0(t[0][r],t[1][r]);return[i,n]},updateCoverShape:function(e,t,i,n){var a,s=KG(e,t);if(s!==wy&&s.getLinearBrushOtherExtent)a=s.getLinearBrushOtherExtent(r);else{var o=e._zr;a=[0,[o.getWidth(),o.getHeight()][1-r]]}var l=[i,a];r&&l.reverse(),eX(e,t,l,n)},updateCommon:G3,contain:q3}}function nX(r){return r=iO(r),function(e){return jk(e,r)}}function aX(r,e){return r=iO(r),function(t){var i=e??t,n=i?r.width:r.height,a=i?r.x:r.y;return[a,a+(n||0)]}}function oX(r,e,t){var i=iO(r);return function(n,a){return i.contain(a[0],a[1])&&!aM(n,e,t)}}function iO(r){return Dr.create(r)}var dxe=["axisLine","axisTickLabel","axisName"],pxe=(function(r){Ye(e,r);function e(){var t=r!==null&&r.apply(this,arguments)||this;return t.type=e.type,t}return e.prototype.init=function(t,i){r.prototype.init.apply(this,arguments),(this._brushController=new KL(i.getZr())).on("brush",Xt(this._onBrush,this))},e.prototype.render=function(t,i,n,a){if(!gxe(t,i,a)){this.axisModel=t,this.api=n,this.group.removeAll();var s=this._axisGroup;if(this._axisGroup=new mr,this.group.add(this._axisGroup),!!t.get("show")){var o=mxe(t,i),l=o.coordinateSystem,c=t.getAreaSelectStyle(),f=c.width,p=t.axis.dim,y=l.getAxisLayout(p),b=mt({strokeContainThreshold:f},y),S=new ol(t,b);se(dxe,S.add,S),this._axisGroup.add(S.getGroup()),this._refreshBrushController(b,c,t,o,f,n),Kw(s,this._axisGroup,t)}}},e.prototype._refreshBrushController=function(t,i,n,a,s,o){var l=n.axis.getExtent(),c=l[1]-l[0],f=Math.min(30,Math.abs(c)*.1),p=Dr.create({x:l[0],y:-s/2,width:c,height:s});p.x-=f,p.width+=2*f,this._brushController.mount({enableGlobalPan:!0,rotation:t.rotation,x:t.position[0],y:t.position[1]}).setPanels([{panelId:"pl",clipPath:nX(p),isTargetByCursor:oX(p,o,a),getLinearBrushOtherExtent:aX(p,0)}]).enableBrush({brushType:"lineX",brushStyle:i,removeOnClick:!0}).updateCovers(vxe(n))},e.prototype._onBrush=function(t){var i=t.areas,n=this.axisModel,a=n.axis,s=wt(i,function(o){return[a.coordToData(o.range[0],!0),a.coordToData(o.range[1],!0)]});(!n.option.realtime===t.isEnd||t.removeOnClick)&&this.api.dispatchAction({type:"axisAreaSelect",parallelAxisId:n.id,intervals:s})},e.prototype.dispose=function(){this._brushController.dispose()},e.type="parallelAxis",e})(vn);function gxe(r,e,t){return t&&t.type==="axisAreaSelect"&&e.findComponents({mainType:"parallelAxis",query:t})[0]===r}function vxe(r){var e=r.axis;return wt(r.activeIntervals,function(t){return{brushType:"lineX",panelId:"pl",range:[e.dataToCoord(t[0],!0),e.dataToCoord(t[1],!0)]}})}function mxe(r,e){return e.getComponent("parallel",r.get("parallelIndex"))}var yxe={type:"axisAreaSelect",event:"axisAreaSelected"};function _xe(r){r.registerAction(yxe,function(e,t){t.eachComponent({mainType:"parallelAxis",query:e},function(i){i.axis.model.setActiveIntervals(e.intervals)})}),r.registerAction("parallelAxisExpand",function(e,t){t.eachComponent({mainType:"parallel",query:e},function(i){i.setAxisExpand(e)})})}var bxe={type:"value",areaSelectStyle:{width:20,borderWidth:1,borderColor:"rgba(160,197,232)",color:"rgba(160,197,232)",opacity:.3},realtime:!0,z:10};function sX(r){r.registerComponentView(Ube),r.registerComponentModel(jbe),r.registerCoordinateSystem("parallel",Kbe),r.registerPreprocessor(Bbe),r.registerComponentModel($3),r.registerComponentView(pxe),K0(r,"parallel",$3,bxe),_xe(r)}function xxe(r){Vr(sX),r.registerChartView(Ibe),r.registerSeriesModel(Dbe),r.registerVisual(r.PRIORITY.VISUAL.BRUSH,Nbe)}var wxe=(function(){function r(){this.x1=0,this.y1=0,this.x2=0,this.y2=0,this.cpx1=0,this.cpy1=0,this.cpx2=0,this.cpy2=0,this.extent=0}return r})(),Sxe=(function(r){Ye(e,r);function e(t){return r.call(this,t)||this}return e.prototype.getDefaultShape=function(){return new wxe},e.prototype.buildPath=function(t,i){var n=i.extent;t.moveTo(i.x1,i.y1),t.bezierCurveTo(i.cpx1,i.cpy1,i.cpx2,i.cpy2,i.x2,i.y2),i.orient==="vertical"?(t.lineTo(i.x2+n,i.y2),t.bezierCurveTo(i.cpx2+n,i.cpy2,i.cpx1+n,i.cpy1,i.x1+n,i.y1)):(t.lineTo(i.x2,i.y2+n),t.bezierCurveTo(i.cpx2,i.cpy2+n,i.cpx1,i.cpy1+n,i.x1,i.y1+n)),t.closePath()},e.prototype.highlight=function(){cp(this)},e.prototype.downplay=function(){hp(this)},e})(Xr),Txe=(function(r){Ye(e,r);function e(){var t=r!==null&&r.apply(this,arguments)||this;return t.type=e.type,t._focusAdjacencyDisabled=!1,t}return e.prototype.render=function(t,i,n){var a=this,s=t.getGraph(),o=this.group,l=t.layoutInfo,c=l.width,f=l.height,p=t.getData(),y=t.getData("edge"),b=t.get("orient");this._model=t,o.removeAll(),o.x=l.x,o.y=l.y,s.eachEdge(function(S){var C=new Sxe,E=br(C);E.dataIndex=S.dataIndex,E.seriesIndex=t.seriesIndex,E.dataType="edge";var P=S.getModel(),O=P.getModel("lineStyle"),B=O.get("curveness"),F=S.node1.getLayout(),W=S.node1.getModel(),$=W.get("localX"),q=W.get("localY"),Q=S.node2.getLayout(),ee=S.node2.getModel(),te=ee.get("localX"),ae=ee.get("localY"),de=S.getLayout(),ve,ye,Ae,me,De,Fe,je,ct;C.shape.extent=Math.max(1,de.dy),C.shape.orient=b,b==="vertical"?(ve=($!=null?$*c:F.x)+de.sy,ye=(q!=null?q*f:F.y)+F.dy,Ae=(te!=null?te*c:Q.x)+de.ty,me=ae!=null?ae*f:Q.y,De=ve,Fe=ye*(1-B)+me*B,je=Ae,ct=ye*B+me*(1-B)):(ve=($!=null?$*c:F.x)+F.dx,ye=(q!=null?q*f:F.y)+de.sy,Ae=te!=null?te*c:Q.x,me=(ae!=null?ae*f:Q.y)+de.ty,De=ve*(1-B)+Ae*B,Fe=ye,je=ve*B+Ae*(1-B),ct=me),C.setShape({x1:ve,y1:ye,x2:Ae,y2:me,cpx1:De,cpy1:Fe,cpx2:je,cpy2:ct}),C.useStyle(O.getItemStyle()),N6(C.style,b,S);var xe=""+P.get("value"),$e=fo(P,"edgeLabel");rs(C,$e,{labelFetcher:{getFormattedLabel:function(Dt,qt,_r,Kt,zt,yr){return t.getFormattedLabel(Dt,qt,"edge",Kt,Th(zt,$e.normal&&$e.normal.get("formatter"),xe),yr)}},labelDataIndex:S.dataIndex,defaultText:xe}),C.setTextConfig({position:"inside"});var pt=P.getModel("emphasis");ts(C,P,"lineStyle",function(Dt){var qt=Dt.getItemStyle();return N6(qt,b,S),qt}),o.add(C),y.setItemGraphicEl(S.dataIndex,C);var _t=pt.get("focus");Hn(C,_t==="adjacency"?S.getAdjacentDataIndices():_t==="trajectory"?S.getTrajectoryDataIndices():_t,pt.get("blurScope"),pt.get("disabled"))}),s.eachNode(function(S){var C=S.getLayout(),E=S.getModel(),P=E.get("localX"),O=E.get("localY"),B=E.getModel("emphasis"),F=E.get(["itemStyle","borderRadius"])||0,W=new li({shape:{x:P!=null?P*c:C.x,y:O!=null?O*f:C.y,width:C.dx,height:C.dy,r:F},style:E.getModel("itemStyle").getItemStyle(),z2:10});rs(W,fo(E),{labelFetcher:{getFormattedLabel:function(q,Q){return t.getFormattedLabel(q,Q,"node")}},labelDataIndex:S.dataIndex,defaultText:S.id}),W.disableLabelAnimation=!0,W.setStyle("fill",S.getVisual("color")),W.setStyle("decal",S.getVisual("style").decal),ts(W,E),o.add(W),p.setItemGraphicEl(S.dataIndex,W),br(W).dataType="node";var $=B.get("focus");Hn(W,$==="adjacency"?S.getAdjacentDataIndices():$==="trajectory"?S.getTrajectoryDataIndices():$,B.get("blurScope"),B.get("disabled"))}),p.eachItemGraphicEl(function(S,C){var E=p.getItemModel(C);E.get("draggable")&&(S.drift=function(P,O){a._focusAdjacencyDisabled=!0,this.shape.x+=P,this.shape.y+=O,this.dirty(),n.dispatchAction({type:"dragNode",seriesId:t.id,dataIndex:p.getRawIndex(C),localX:this.shape.x/c,localY:this.shape.y/f})},S.ondragend=function(){a._focusAdjacencyDisabled=!1},S.draggable=!0,S.cursor="move")}),!this._data&&t.isAnimationEnabled()&&o.setClipPath(Axe(o.getBoundingRect(),t,function(){o.removeClipPath()})),this._data=t.getData()},e.prototype.dispose=function(){},e.type="sankey",e})(Fi);function N6(r,e,t){switch(r.fill){case"source":r.fill=t.node1.getVisual("color"),r.decal=t.node1.getVisual("style").decal;break;case"target":r.fill=t.node2.getVisual("color"),r.decal=t.node2.getVisual("style").decal;break;case"gradient":var i=t.node1.getVisual("color"),n=t.node2.getVisual("color");$t(i)&&$t(n)&&(r.fill=new ub(0,0,+(e==="horizontal"),+(e==="vertical"),[{color:i,offset:0},{color:n,offset:1}]))}}function Axe(r,e,t){var i=new li({shape:{x:r.x-10,y:r.y-10,width:0,height:r.height+20}});return An(i,{shape:{width:r.width+20}},e,t),i}var Cxe=(function(r){Ye(e,r);function e(){var t=r!==null&&r.apply(this,arguments)||this;return t.type=e.type,t}return e.prototype.getInitialData=function(t,i){var n=t.edges||t.links||[],a=t.data||t.nodes||[],s=t.levels||[];this.levelModels=[];for(var o=this.levelModels,l=0;l<s.length;l++)s[l].depth!=null&&s[l].depth>=0&&(o[s[l].depth]=new Si(s[l],this,i));var c=jG(a,n,this,!0,f);return c.data;function f(p,y){p.wrapMethod("getItemModel",function(b,S){var C=b.parentModel,E=C.getData().getItemLayout(S);if(E){var P=E.depth,O=C.levelModels[P];O&&(b.parentModel=O)}return b}),y.wrapMethod("getItemModel",function(b,S){var C=b.parentModel,E=C.getGraph().getEdgeByIndex(S),P=E.node1.getLayout();if(P){var O=P.depth,B=C.levelModels[O];B&&(b.parentModel=B)}return b})}},e.prototype.setNodePosition=function(t,i){var n=this.option.data||this.option.nodes,a=n[t];a.localX=i[0],a.localY=i[1]},e.prototype.getGraph=function(){return this.getData().graph},e.prototype.getEdgeData=function(){return this.getGraph().edgeData},e.prototype.formatTooltip=function(t,i,n){function a(b){return isNaN(b)||b==null}if(n==="edge"){var s=this.getDataParams(t,n),o=s.data,l=s.value,c=o.source+" -- "+o.target;return po("nameValue",{name:c,value:l,noValue:a(l)})}else{var f=this.getGraph().getNodeByIndex(t),p=f.getLayout().value,y=this.getDataParams(t,n).data.name;return po("nameValue",{name:y!=null?y+"":null,value:p,noValue:a(p)})}},e.prototype.optionUpdated=function(){},e.prototype.getDataParams=function(t,i){var n=r.prototype.getDataParams.call(this,t,i);if(n.value==null&&i==="node"){var a=this.getGraph().getNodeByIndex(t),s=a.getLayout().value;n.value=s}return n},e.type="series.sankey",e.defaultOption={z:2,coordinateSystem:"view",left:"5%",top:"5%",right:"20%",bottom:"5%",orient:"horizontal",nodeWidth:20,nodeGap:8,draggable:!0,layoutIterations:32,label:{show:!0,position:"right",fontSize:12},edgeLabel:{show:!1,fontSize:12},levels:[],nodeAlign:"justify",lineStyle:{color:"#314656",opacity:.2,curveness:.5},emphasis:{label:{show:!0},lineStyle:{opacity:.5}},select:{itemStyle:{borderColor:"#212121"}},animationEasing:"linear",animationDuration:1e3},e})(Xi);function Mxe(r,e){r.eachSeriesByType("sankey",function(t){var i=t.get("nodeWidth"),n=t.get("nodeGap"),a=Exe(t,e);t.layoutInfo=a;var s=a.width,o=a.height,l=t.getGraph(),c=l.nodes,f=l.edges;Pxe(c);var p=wi(c,function(C){return C.getLayout().value===0}),y=p.length!==0?0:t.get("layoutIterations"),b=t.get("orient"),S=t.get("nodeAlign");Ixe(c,f,i,n,s,o,y,b,S)})}function Exe(r,e){return La(r.getBoxLayoutParams(),{width:e.getWidth(),height:e.getHeight()})}function Ixe(r,e,t,i,n,a,s,o,l){Rxe(r,e,t,n,a,o,l),Oxe(r,e,a,n,i,s,o),$xe(r,o)}function Pxe(r){se(r,function(e){var t=Fg(e.outEdges,JA),i=Fg(e.inEdges,JA),n=e.getValue()||0,a=Math.max(t,i,n);e.setLayout({value:a},!0)})}function Rxe(r,e,t,i,n,a,s){for(var o=[],l=[],c=[],f=[],p=0,y=0;y<e.length;y++)o[y]=1;for(var y=0;y<r.length;y++)l[y]=r[y].inEdges.length,l[y]===0&&c.push(r[y]);for(var b=-1;c.length;){for(var S=0;S<c.length;S++){var C=c[S],E=C.hostGraph.data.getRawDataItem(C.dataIndex),P=E.depth!=null&&E.depth>=0;P&&E.depth>b&&(b=E.depth),C.setLayout({depth:P?E.depth:p},!0),a==="vertical"?C.setLayout({dy:t},!0):C.setLayout({dx:t},!0);for(var O=0;O<C.outEdges.length;O++){var B=C.outEdges[O],F=e.indexOf(B);o[F]=0;var W=B.node2,$=r.indexOf(W);--l[$]===0&&f.indexOf(W)<0&&f.push(W)}}++p,c=f,f=[]}for(var y=0;y<o.length;y++)if(o[y]===1)throw new Error("Sankey is a DAG, the original data has cycle!");var q=b>p-1?b:p-1;s&&s!=="left"&&Dxe(r,s,a,q);var Q=a==="vertical"?(n-t)/q:(i-t)/q;Lxe(r,Q,a)}function lX(r){var e=r.hostGraph.data.getRawDataItem(r.dataIndex);return e.depth!=null&&e.depth>=0}function Dxe(r,e,t,i){if(e==="right"){for(var n=[],a=r,s=0;a.length;){for(var o=0;o<a.length;o++){var l=a[o];l.setLayout({skNodeHeight:s},!0);for(var c=0;c<l.inEdges.length;c++){var f=l.inEdges[c];n.indexOf(f.node1)<0&&n.push(f.node1)}}a=n,n=[],++s}se(r,function(p){lX(p)||p.setLayout({depth:Math.max(0,i-p.getLayout().skNodeHeight)},!0)})}else e==="justify"&&kxe(r,i)}function kxe(r,e){se(r,function(t){!lX(t)&&!t.outEdges.length&&t.setLayout({depth:e},!0)})}function Lxe(r,e,t){se(r,function(i){var n=i.getLayout().depth*e;t==="vertical"?i.setLayout({y:n},!0):i.setLayout({x:n},!0)})}function Oxe(r,e,t,i,n,a,s){var o=Nxe(r,s);Bxe(o,e,t,i,n,s),cP(o,n,t,i,s);for(var l=1;a>0;a--)l*=.99,zxe(o,l,s),cP(o,n,t,i,s),jxe(o,l,s),cP(o,n,t,i,s)}function Nxe(r,e){var t=[],i=e==="vertical"?"y":"x",n=qR(r,function(a){return a.getLayout()[i]});return n.keys.sort(function(a,s){return a-s}),se(n.keys,function(a){t.push(n.buckets.get(a))}),t}function Bxe(r,e,t,i,n,a){var s=1/0;se(r,function(o){var l=o.length,c=0;se(o,function(p){c+=p.getLayout().value});var f=a==="vertical"?(i-(l-1)*n)/c:(t-(l-1)*n)/c;f<s&&(s=f)}),se(r,function(o){se(o,function(l,c){var f=l.getLayout().value*s;a==="vertical"?(l.setLayout({x:c},!0),l.setLayout({dx:f},!0)):(l.setLayout({y:c},!0),l.setLayout({dy:f},!0))})}),se(e,function(o){var l=+o.getValue()*s;o.setLayout({dy:l},!0)})}function cP(r,e,t,i,n){var a=n==="vertical"?"x":"y";se(r,function(s){s.sort(function(C,E){return C.getLayout()[a]-E.getLayout()[a]});for(var o,l,c,f=0,p=s.length,y=n==="vertical"?"dx":"dy",b=0;b<p;b++)l=s[b],c=f-l.getLayout()[a],c>0&&(o=l.getLayout()[a]+c,n==="vertical"?l.setLayout({x:o},!0):l.setLayout({y:o},!0)),f=l.getLayout()[a]+l.getLayout()[y]+e;var S=n==="vertical"?i:t;if(c=f-e-S,c>0){o=l.getLayout()[a]-c,n==="vertical"?l.setLayout({x:o},!0):l.setLayout({y:o},!0),f=o;for(var b=p-2;b>=0;--b)l=s[b],c=l.getLayout()[a]+l.getLayout()[y]+e-f,c>0&&(o=l.getLayout()[a]-c,n==="vertical"?l.setLayout({x:o},!0):l.setLayout({y:o},!0)),f=l.getLayout()[a]}})}function zxe(r,e,t){se(r.slice().reverse(),function(i){se(i,function(n){if(n.outEdges.length){var a=Fg(n.outEdges,Fxe,t)/Fg(n.outEdges,JA);if(isNaN(a)){var s=n.outEdges.length;a=s?Fg(n.outEdges,Vxe,t)/s:0}if(t==="vertical"){var o=n.getLayout().x+(a-Wg(n,t))*e;n.setLayout({x:o},!0)}else{var l=n.getLayout().y+(a-Wg(n,t))*e;n.setLayout({y:l},!0)}}})})}function Fxe(r,e){return Wg(r.node2,e)*r.getValue()}function Vxe(r,e){return Wg(r.node2,e)}function Uxe(r,e){return Wg(r.node1,e)*r.getValue()}function Hxe(r,e){return Wg(r.node1,e)}function Wg(r,e){return e==="vertical"?r.getLayout().x+r.getLayout().dx/2:r.getLayout().y+r.getLayout().dy/2}function JA(r){return r.getValue()}function Fg(r,e,t){for(var i=0,n=r.length,a=-1;++a<n;){var s=+e(r[a],t);isNaN(s)||(i+=s)}return i}function jxe(r,e,t){se(r,function(i){se(i,function(n){if(n.inEdges.length){var a=Fg(n.inEdges,Uxe,t)/Fg(n.inEdges,JA);if(isNaN(a)){var s=n.inEdges.length;a=s?Fg(n.inEdges,Hxe,t)/s:0}if(t==="vertical"){var o=n.getLayout().x+(a-Wg(n,t))*e;n.setLayout({x:o},!0)}else{var l=n.getLayout().y+(a-Wg(n,t))*e;n.setLayout({y:l},!0)}}})})}function $xe(r,e){var t=e==="vertical"?"x":"y";se(r,function(i){i.outEdges.sort(function(n,a){return n.node2.getLayout()[t]-a.node2.getLayout()[t]}),i.inEdges.sort(function(n,a){return n.node1.getLayout()[t]-a.node1.getLayout()[t]})}),se(r,function(i){var n=0,a=0;se(i.outEdges,function(s){s.setLayout({sy:n},!0),n+=s.getLayout().dy}),se(i.inEdges,function(s){s.setLayout({ty:a},!0),a+=s.getLayout().dy})})}function Wxe(r){r.eachSeriesByType("sankey",function(e){var t=e.getGraph(),i=t.nodes,n=t.edges;if(i.length){var a=1/0,s=-1/0;se(i,function(o){var l=o.getLayout().value;l<a&&(a=l),l>s&&(s=l)}),se(i,function(o){var l=new ho({type:"color",mappingMethod:"linear",dataExtent:[a,s],visual:e.get("color")}),c=l.mapValueToVisual(o.getLayout().value),f=o.getModel().get(["itemStyle","color"]);f!=null?(o.setVisual("color",f),o.setVisual("style",{fill:f})):(o.setVisual("color",c),o.setVisual("style",{fill:c}))})}n.length&&se(n,function(o){var l=o.getModel().get("lineStyle");o.setVisual("style",l)})})}function Gxe(r){r.registerChartView(Txe),r.registerSeriesModel(Cxe),r.registerLayout(Mxe),r.registerVisual(Wxe),r.registerAction({type:"dragNode",event:"dragnode",update:"update"},function(e,t){t.eachComponent({mainType:"series",subType:"sankey",query:e},function(i){i.setNodePosition(e.dataIndex,[e.localX,e.localY])})})}var uX=(function(){function r(){}return r.prototype._hasEncodeRule=function(e){var t=this.getEncode();return t&&t.get(e)!=null},r.prototype.getInitialData=function(e,t){var i,n=t.getComponent("xAxis",this.get("xAxisIndex")),a=t.getComponent("yAxis",this.get("yAxisIndex")),s=n.get("type"),o=a.get("type"),l;s==="category"?(e.layout="horizontal",i=n.getOrdinalMeta(),l=!this._hasEncodeRule("x")):o==="category"?(e.layout="vertical",i=a.getOrdinalMeta(),l=!this._hasEncodeRule("y")):e.layout=e.layout||"horizontal";var c=["x","y"],f=e.layout==="horizontal"?0:1,p=this._baseAxisDim=c[f],y=c[1-f],b=[n,a],S=b[f].get("type"),C=b[1-f].get("type"),E=e.data;if(E&&l){var P=[];se(E,function(F,W){var $;xt(F)?($=F.slice(),F.unshift(W)):xt(F.value)?($=mt({},F),$.value=$.value.slice(),F.value.unshift(W)):$=F,P.push($)}),e.data=P}var O=this.defaultValueDimensions,B=[{name:p,type:HA(S),ordinalMeta:i,otherDims:{tooltip:!1,itemName:0},dimsDef:["base"]},{name:y,type:HA(C),dimsDef:O.slice()}];return Sb(this,{coordDimensions:B,dimensionsCount:O.length+1,encodeDefaulter:Sr(B7,B,this)})},r.prototype.getBaseAxis=function(){var e=this._baseAxisDim;return this.ecModel.getComponent(e+"Axis",this.get(e+"AxisIndex")).axis},r})(),cX=(function(r){Ye(e,r);function e(){var t=r!==null&&r.apply(this,arguments)||this;return t.type=e.type,t.defaultValueDimensions=[{name:"min",defaultTooltip:!0},{name:"Q1",defaultTooltip:!0},{name:"median",defaultTooltip:!0},{name:"Q3",defaultTooltip:!0},{name:"max",defaultTooltip:!0}],t.visualDrawType="stroke",t}return e.type="series.boxplot",e.dependencies=["xAxis","yAxis","grid"],e.defaultOption={z:2,coordinateSystem:"cartesian2d",legendHoverLink:!0,layout:null,boxWidth:[7,50],itemStyle:{color:"#fff",borderWidth:1},emphasis:{scale:!0,itemStyle:{borderWidth:2,shadowBlur:5,shadowOffsetX:1,shadowOffsetY:1,shadowColor:"rgba(0,0,0,0.2)"}},animationDuration:800},e})(Xi);ha(cX,uX,!0);var Xxe=(function(r){Ye(e,r);function e(){var t=r!==null&&r.apply(this,arguments)||this;return t.type=e.type,t}return e.prototype.render=function(t,i,n){var a=t.getData(),s=this.group,o=this._data;this._data||s.removeAll();var l=t.get("layout")==="horizontal"?1:0;a.diff(o).add(function(c){if(a.hasValue(c)){var f=a.getItemLayout(c),p=B6(f,a,c,l,!0);a.setItemGraphicEl(c,p),s.add(p)}}).update(function(c,f){var p=o.getItemGraphicEl(f);if(!a.hasValue(c)){s.remove(p);return}var y=a.getItemLayout(c);p?(Dh(p),hX(y,p,a,c)):p=B6(y,a,c,l),s.add(p),a.setItemGraphicEl(c,p)}).remove(function(c){var f=o.getItemGraphicEl(c);f&&s.remove(f)}).execute(),this._data=a},e.prototype.remove=function(t){var i=this.group,n=this._data;this._data=null,n&&n.eachItemGraphicEl(function(a){a&&i.remove(a)})},e.type="boxplot",e})(Fi),Zxe=(function(){function r(){}return r})(),qxe=(function(r){Ye(e,r);function e(t){var i=r.call(this,t)||this;return i.type="boxplotBoxPath",i}return e.prototype.getDefaultShape=function(){return new Zxe},e.prototype.buildPath=function(t,i){var n=i.points,a=0;for(t.moveTo(n[a][0],n[a][1]),a++;a<4;a++)t.lineTo(n[a][0],n[a][1]);for(t.closePath();a<n.length;a++)t.moveTo(n[a][0],n[a][1]),a++,t.lineTo(n[a][0],n[a][1])},e})(Xr);function B6(r,e,t,i,n){var a=r.ends,s=new qxe({shape:{points:n?Yxe(a,i,r):a}});return hX(r,s,e,t,n),s}function hX(r,e,t,i,n){var a=t.hostModel,s=Py[n?"initProps":"updateProps"];s(e,{shape:{points:r.ends}},a,i),e.useStyle(t.getItemVisual(i,"style")),e.style.strokeNoScale=!0,e.z2=100;var o=t.getItemModel(i),l=o.getModel("emphasis");ts(e,o),Hn(e,l.get("focus"),l.get("blurScope"),l.get("disabled"))}function Yxe(r,e,t){return wt(r,function(i){return i=i.slice(),i[e]=t.initBaseline,i})}var Y1=se;function Kxe(r){var e=Qxe(r);Y1(e,function(t){var i=t.seriesModels;i.length&&(Jxe(t),Y1(i,function(n,a){e1e(n,t.boxOffsetList[a],t.boxWidthList[a])}))})}function Qxe(r){var e=[],t=[];return r.eachSeriesByType("boxplot",function(i){var n=i.getBaseAxis(),a=Or(t,n);a<0&&(a=t.length,t[a]=n,e[a]={axis:n,seriesModels:[]}),e[a].seriesModels.push(i)}),e}function Jxe(r){var e=r.axis,t=r.seriesModels,i=t.length,n=r.boxWidthList=[],a=r.boxOffsetList=[],s=[],o;if(e.type==="category")o=e.getBandWidth();else{var l=0;Y1(t,function(S){l=Math.max(l,S.getData().count())});var c=e.getExtent();o=Math.abs(c[1]-c[0])/l}Y1(t,function(S){var C=S.get("boxWidth");xt(C)||(C=[C,C]),s.push([Vt(C[0],o)||0,Vt(C[1],o)||0])});var f=o*.8-2,p=f/i*.3,y=(f-p*(i-1))/i,b=y/2-f/2;Y1(t,function(S,C){a.push(b),b+=p+y,n.push(Math.min(Math.max(y,s[C][0]),s[C][1]))})}function e1e(r,e,t){var i=r.coordinateSystem,n=r.getData(),a=t/2,s=r.get("layout")==="horizontal"?0:1,o=1-s,l=["x","y"],c=n.mapDimension(l[s]),f=n.mapDimensionsAll(l[o]);if(c==null||f.length<5)return;for(var p=0;p<n.count();p++){var y=n.get(c,p),b=B(y,f[2],p),S=B(y,f[0],p),C=B(y,f[1],p),E=B(y,f[3],p),P=B(y,f[4],p),O=[];F(O,C,!1),F(O,E,!0),O.push(S,C,P,E),W(O,S),W(O,P),W(O,b),n.setItemLayout(p,{initBaseline:b[o],ends:O})}function B($,q,Q){var ee=n.get(q,Q),te=[];te[s]=$,te[o]=ee;var ae;return isNaN($)||isNaN(ee)?ae=[NaN,NaN]:(ae=i.dataToPoint(te),ae[s]+=e),ae}function F($,q,Q){var ee=q.slice(),te=q.slice();ee[s]+=a,te[s]-=a,Q?$.push(ee,te):$.push(te,ee)}function W($,q){var Q=q.slice(),ee=q.slice();Q[s]-=a,ee[s]+=a,$.push(Q,ee)}}function t1e(r,e){e=e||{};for(var t=[],i=[],n=e.boundIQR,a=n==="none"||n===0,s=0;s<r.length;s++){var o=yu(r[s].slice()),l=L2(o,.25),c=L2(o,.5),f=L2(o,.75),p=o[0],y=o[o.length-1],b=(n??1.5)*(f-l),S=a?p:Math.max(p,l-b),C=a?y:Math.min(y,f+b),E=e.itemNameFormatter,P=sr(E)?E({value:s}):$t(E)?E.replace("{value}",s+""):s+"";t.push([P,S,l,c,f,C]);for(var O=0;O<o.length;O++){var B=o[O];if(B<S||B>C){var F=[P,B];i.push(F)}}}return{boxData:t,outliers:i}}var r1e={type:"echarts:boxplot",transform:function(e){var t=e.upstream;if(t.sourceFormat!==Ds){var i="";Pi(i)}var n=t1e(t.getRawData(),e.config);return[{dimensions:["ItemName","Low","Q1","Q2","Q3","High"],data:n.boxData},{data:n.outliers}]}};function i1e(r){r.registerSeriesModel(cX),r.registerChartView(Xxe),r.registerLayout(Kxe),r.registerTransform(r1e)}var n1e=["itemStyle","borderColor"],a1e=["itemStyle","borderColor0"],o1e=["itemStyle","borderColorDoji"],s1e=["itemStyle","color"],l1e=["itemStyle","color0"];function nO(r,e){return e.get(r>0?s1e:l1e)}function aO(r,e){return e.get(r===0?o1e:r>0?n1e:a1e)}var u1e={seriesType:"candlestick",plan:mb(),performRawSeries:!0,reset:function(r,e){if(!e.isSeriesFiltered(r)){var t=r.pipelineContext.large;return!t&&{progress:function(i,n){for(var a;(a=i.next())!=null;){var s=n.getItemModel(a),o=n.getItemLayout(a).sign,l=s.getItemStyle();l.fill=nO(o,s),l.stroke=aO(o,s)||l.fill;var c=n.ensureUniqueItemVisual(a,"style");mt(c,l)}}}}}},c1e=["color","borderColor"],h1e=(function(r){Ye(e,r);function e(){var t=r!==null&&r.apply(this,arguments)||this;return t.type=e.type,t}return e.prototype.render=function(t,i,n){this.group.removeClipPath(),this._progressiveEls=null,this._updateDrawMode(t),this._isLargeDraw?this._renderLarge(t):this._renderNormal(t)},e.prototype.incrementalPrepareRender=function(t,i,n){this._clear(),this._updateDrawMode(t)},e.prototype.incrementalRender=function(t,i,n,a){this._progressiveEls=[],this._isLargeDraw?this._incrementalRenderLarge(t,i):this._incrementalRenderNormal(t,i)},e.prototype.eachRendered=function(t){qg(this._progressiveEls||this.group,t)},e.prototype._updateDrawMode=function(t){var i=t.pipelineContext.large;(this._isLargeDraw==null||i!==this._isLargeDraw)&&(this._isLargeDraw=i,this._clear())},e.prototype._renderNormal=function(t){var i=t.getData(),n=this._data,a=this.group,s=i.getLayout("isSimpleBox"),o=t.get("clip",!0),l=t.coordinateSystem,c=l.getArea&&l.getArea();this._data||a.removeAll(),i.diff(n).add(function(f){if(i.hasValue(f)){var p=i.getItemLayout(f);if(o&&z6(c,p))return;var y=hP(p,f,!0);An(y,{shape:{points:p.ends}},t,f),fP(y,i,f,s),a.add(y),i.setItemGraphicEl(f,y)}}).update(function(f,p){var y=n.getItemGraphicEl(p);if(!i.hasValue(f)){a.remove(y);return}var b=i.getItemLayout(f);if(o&&z6(c,b)){a.remove(y);return}y?(vi(y,{shape:{points:b.ends}},t,f),Dh(y)):y=hP(b),fP(y,i,f,s),a.add(y),i.setItemGraphicEl(f,y)}).remove(function(f){var p=n.getItemGraphicEl(f);p&&a.remove(p)}).execute(),this._data=i},e.prototype._renderLarge=function(t){this._clear(),F6(t,this.group);var i=t.get("clip",!0)?iS(t.coordinateSystem,!1,t):null;i?this.group.setClipPath(i):this.group.removeClipPath()},e.prototype._incrementalRenderNormal=function(t,i){for(var n=i.getData(),a=n.getLayout("isSimpleBox"),s;(s=t.next())!=null;){var o=n.getItemLayout(s),l=hP(o);fP(l,n,s,a),l.incremental=!0,this.group.add(l),this._progressiveEls.push(l)}},e.prototype._incrementalRenderLarge=function(t,i){F6(i,this.group,this._progressiveEls,!0)},e.prototype.remove=function(t){this._clear()},e.prototype._clear=function(){this.group.removeAll(),this._data=null},e.type="candlestick",e})(Fi),f1e=(function(){function r(){}return r})(),d1e=(function(r){Ye(e,r);function e(t){var i=r.call(this,t)||this;return i.type="normalCandlestickBox",i}return e.prototype.getDefaultShape=function(){return new f1e},e.prototype.buildPath=function(t,i){var n=i.points;this.__simpleBox?(t.moveTo(n[4][0],n[4][1]),t.lineTo(n[6][0],n[6][1])):(t.moveTo(n[0][0],n[0][1]),t.lineTo(n[1][0],n[1][1]),t.lineTo(n[2][0],n[2][1]),t.lineTo(n[3][0],n[3][1]),t.closePath(),t.moveTo(n[4][0],n[4][1]),t.lineTo(n[5][0],n[5][1]),t.moveTo(n[6][0],n[6][1]),t.lineTo(n[7][0],n[7][1]))},e})(Xr);function hP(r,e,t){var i=r.ends;return new d1e({shape:{points:t?p1e(i,r):i},z2:100})}function z6(r,e){for(var t=!0,i=0;i<e.ends.length;i++)if(r.contain(e.ends[i][0],e.ends[i][1])){t=!1;break}return t}function fP(r,e,t,i){var n=e.getItemModel(t);r.useStyle(e.getItemVisual(t,"style")),r.style.strokeNoScale=!0,r.__simpleBox=i,ts(r,n);var a=e.getItemLayout(t).sign;se(r.states,function(o,l){var c=n.getModel(l),f=nO(a,c),p=aO(a,c)||f,y=o.style||(o.style={});f&&(y.fill=f),p&&(y.stroke=p)});var s=n.getModel("emphasis");Hn(r,s.get("focus"),s.get("blurScope"),s.get("disabled"))}function p1e(r,e){return wt(r,function(t){return t=t.slice(),t[1]=e.initBaseline,t})}var g1e=(function(){function r(){}return r})(),dP=(function(r){Ye(e,r);function e(t){var i=r.call(this,t)||this;return i.type="largeCandlestickBox",i}return e.prototype.getDefaultShape=function(){return new g1e},e.prototype.buildPath=function(t,i){for(var n=i.points,a=0;a<n.length;)if(this.__sign===n[a++]){var s=n[a++];t.moveTo(s,n[a++]),t.lineTo(s,n[a++])}else a+=3},e})(Xr);function F6(r,e,t,i){var n=r.getData(),a=n.getLayout("largePoints"),s=new dP({shape:{points:a},__sign:1,ignoreCoarsePointer:!0});e.add(s);var o=new dP({shape:{points:a},__sign:-1,ignoreCoarsePointer:!0});e.add(o);var l=new dP({shape:{points:a},__sign:0,ignoreCoarsePointer:!0});e.add(l),pP(1,s,r),pP(-1,o,r),pP(0,l,r),i&&(s.incremental=!0,o.incremental=!0),t&&t.push(s,o)}function pP(r,e,t,i){var n=aO(r,t)||nO(r,t),a=t.getModel("itemStyle").getItemStyle(c1e);e.useStyle(a),e.style.fill=null,e.style.stroke=n}var fX=(function(r){Ye(e,r);function e(){var t=r!==null&&r.apply(this,arguments)||this;return t.type=e.type,t.defaultValueDimensions=[{name:"open",defaultTooltip:!0},{name:"close",defaultTooltip:!0},{name:"lowest",defaultTooltip:!0},{name:"highest",defaultTooltip:!0}],t}return e.prototype.getShadowDim=function(){return"open"},e.prototype.brushSelector=function(t,i,n){var a=i.getItemLayout(t);return a&&n.rect(a.brushRect)},e.type="series.candlestick",e.dependencies=["xAxis","yAxis","grid"],e.defaultOption={z:2,coordinateSystem:"cartesian2d",legendHoverLink:!0,layout:null,clip:!0,itemStyle:{color:"#eb5454",color0:"#47b262",borderColor:"#eb5454",borderColor0:"#47b262",borderColorDoji:null,borderWidth:1},emphasis:{itemStyle:{borderWidth:2}},barMaxWidth:null,barMinWidth:null,barWidth:null,large:!0,largeThreshold:600,progressive:3e3,progressiveThreshold:1e4,progressiveChunkMode:"mod",animationEasing:"linear",animationDuration:300},e})(Xi);ha(fX,uX,!0);function v1e(r){!r||!xt(r.series)||se(r.series,function(e){cr(e)&&e.type==="k"&&(e.type="candlestick")})}var m1e={seriesType:"candlestick",plan:mb(),reset:function(r){var e=r.coordinateSystem,t=r.getData(),i=y1e(r,t),n=0,a=1,s=["x","y"],o=t.getDimensionIndex(t.mapDimension(s[n])),l=wt(t.mapDimensionsAll(s[a]),t.getDimensionIndex,t),c=l[0],f=l[1],p=l[2],y=l[3];if(t.setLayout({candleWidth:i,isSimpleBox:i<=1.3}),o<0||l.length<4)return;return{progress:r.pipelineContext.large?S:b};function b(C,E){for(var P,O=E.getStore();(P=C.next())!=null;){var B=O.get(o,P),F=O.get(c,P),W=O.get(f,P),$=O.get(p,P),q=O.get(y,P),Q=Math.min(F,W),ee=Math.max(F,W),te=De(Q,B),ae=De(ee,B),de=De($,B),ve=De(q,B),ye=[];Fe(ye,ae,0),Fe(ye,te,1),ye.push(ct(ve),ct(ae),ct(de),ct(te));var Ae=E.getItemModel(P),me=!!Ae.get(["itemStyle","borderColorDoji"]);E.setItemLayout(P,{sign:V6(O,P,F,W,f,me),initBaseline:F>W?ae[a]:te[a],ends:ye,brushRect:je($,q,B)})}function De(xe,$e){var pt=[];return pt[n]=$e,pt[a]=xe,isNaN($e)||isNaN(xe)?[NaN,NaN]:e.dataToPoint(pt)}function Fe(xe,$e,pt){var _t=$e.slice(),Dt=$e.slice();_t[n]=B2(_t[n]+i/2,1,!1),Dt[n]=B2(Dt[n]-i/2,1,!0),pt?xe.push(_t,Dt):xe.push(Dt,_t)}function je(xe,$e,pt){var _t=De(xe,pt),Dt=De($e,pt);return _t[n]-=i/2,Dt[n]-=i/2,{x:_t[0],y:_t[1],width:i,height:Dt[1]-_t[1]}}function ct(xe){return xe[n]=B2(xe[n],1),xe}}function S(C,E){for(var P=Of(C.count*4),O=0,B,F=[],W=[],$,q=E.getStore(),Q=!!r.get(["itemStyle","borderColorDoji"]);($=C.next())!=null;){var ee=q.get(o,$),te=q.get(c,$),ae=q.get(f,$),de=q.get(p,$),ve=q.get(y,$);if(isNaN(ee)||isNaN(de)||isNaN(ve)){P[O++]=NaN,O+=3;continue}P[O++]=V6(q,$,te,ae,f,Q),F[n]=ee,F[a]=de,B=e.dataToPoint(F,null,W),P[O++]=B?B[0]:NaN,P[O++]=B?B[1]:NaN,F[a]=ve,B=e.dataToPoint(F,null,W),P[O++]=B?B[1]:NaN}E.setLayout("largePoints",P)}}};function V6(r,e,t,i,n,a){var s;return t>i?s=-1:t<i?s=1:s=a?0:e>0?r.get(n,e-1)<=i?1:-1:1,s}function y1e(r,e){var t=r.getBaseAxis(),i,n=t.type==="category"?t.getBandWidth():(i=t.getExtent(),Math.abs(i[1]-i[0])/e.count()),a=Vt(wr(r.get("barMaxWidth"),n),n),s=Vt(wr(r.get("barMinWidth"),1),n),o=r.get("barWidth");return o!=null?Vt(o,n):Math.max(Math.min(n/2,a),s)}function _1e(r){r.registerChartView(h1e),r.registerSeriesModel(fX),r.registerPreprocessor(v1e),r.registerVisual(u1e),r.registerLayout(m1e)}function U6(r,e){var t=e.rippleEffectColor||e.color;r.eachChild(function(i){i.attr({z:e.z,zlevel:e.zlevel,style:{stroke:e.brushType==="stroke"?t:null,fill:e.brushType==="fill"?t:null}})})}var b1e=(function(r){Ye(e,r);function e(t,i){var n=r.call(this)||this,a=new tS(t,i),s=new mr;return n.add(a),n.add(s),n.updateData(t,i),n}return e.prototype.stopEffectAnimation=function(){this.childAt(1).removeAll()},e.prototype.startEffectAnimation=function(t){for(var i=t.symbolType,n=t.color,a=t.rippleNumber,s=this.childAt(1),o=0;o<a;o++){var l=Aa(i,-1,-1,2,2,n);l.attr({style:{strokeNoScale:!0},z2:99,silent:!0,scaleX:.5,scaleY:.5});var c=-o/a*t.period+t.effectOffset;l.animate("",!0).when(t.period,{scaleX:t.rippleScale/2,scaleY:t.rippleScale/2}).delay(c).start(),l.animateStyle(!0).when(t.period,{opacity:0}).delay(c).start(),s.add(l)}U6(s,t)},e.prototype.updateEffectAnimation=function(t){for(var i=this._effectCfg,n=this.childAt(1),a=["symbolType","period","rippleScale","rippleNumber"],s=0;s<a.length;s++){var o=a[s];if(i[o]!==t[o]){this.stopEffectAnimation(),this.startEffectAnimation(t);return}}U6(n,t)},e.prototype.highlight=function(){cp(this)},e.prototype.downplay=function(){hp(this)},e.prototype.getSymbolType=function(){var t=this.childAt(0);return t&&t.getSymbolType()},e.prototype.updateData=function(t,i){var n=this,a=t.hostModel;this.childAt(0).updateData(t,i);var s=this.childAt(1),o=t.getItemModel(i),l=t.getItemVisual(i,"symbol"),c=_b(t.getItemVisual(i,"symbolSize")),f=t.getItemVisual(i,"style"),p=f&&f.fill,y=o.getModel("emphasis");s.setScale(c),s.traverse(function(E){E.setStyle("fill",p)});var b=Dy(t.getItemVisual(i,"symbolOffset"),c);b&&(s.x=b[0],s.y=b[1]);var S=t.getItemVisual(i,"symbolRotate");s.rotation=(S||0)*Math.PI/180||0;var C={};C.showEffectOn=a.get("showEffectOn"),C.rippleScale=o.get(["rippleEffect","scale"]),C.brushType=o.get(["rippleEffect","brushType"]),C.period=o.get(["rippleEffect","period"])*1e3,C.effectOffset=i/t.count(),C.z=a.getShallow("z")||0,C.zlevel=a.getShallow("zlevel")||0,C.symbolType=l,C.color=p,C.rippleEffectColor=o.get(["rippleEffect","color"]),C.rippleNumber=o.get(["rippleEffect","number"]),C.showEffectOn==="render"?(this._effectCfg?this.updateEffectAnimation(C):this.startEffectAnimation(C),this._effectCfg=C):(this._effectCfg=null,this.stopEffectAnimation(),this.onHoverStateChange=function(E){E==="emphasis"?C.showEffectOn!=="render"&&n.startEffectAnimation(C):E==="normal"&&C.showEffectOn!=="render"&&n.stopEffectAnimation()}),this._effectCfg=C,Hn(this,y.get("focus"),y.get("blurScope"),y.get("disabled"))},e.prototype.fadeOut=function(t){t&&t()},e})(mr),x1e=(function(r){Ye(e,r);function e(){var t=r!==null&&r.apply(this,arguments)||this;return t.type=e.type,t}return e.prototype.init=function(){this._symbolDraw=new rS(b1e)},e.prototype.render=function(t,i,n){var a=t.getData(),s=this._symbolDraw;s.updateData(a,{clipShape:this._getClipShape(t)}),this.group.add(s.group)},e.prototype._getClipShape=function(t){var i=t.coordinateSystem,n=i&&i.getArea&&i.getArea();return t.get("clip",!0)?n:null},e.prototype.updateTransform=function(t,i,n){var a=t.getData();this.group.dirty();var s=nS("").reset(t,i,n);s.progress&&s.progress({start:0,end:a.count(),count:a.count()},a),this._symbolDraw.updateLayout()},e.prototype._updateGroupTransform=function(t){var i=t.coordinateSystem;i&&i.getRoamTransform&&(this.group.transform=qj(i.getRoamTransform()),this.group.decomposeTransform())},e.prototype.remove=function(t,i){this._symbolDraw&&this._symbolDraw.remove(!0)},e.type="effectScatter",e})(Fi),w1e=(function(r){Ye(e,r);function e(){var t=r!==null&&r.apply(this,arguments)||this;return t.type=e.type,t.hasSymbolVisual=!0,t}return e.prototype.getInitialData=function(t,i){return Gf(null,this,{useEncodeDefaulter:!0})},e.prototype.brushSelector=function(t,i,n){return n.point(i.getItemLayout(t))},e.type="series.effectScatter",e.dependencies=["grid","polar"],e.defaultOption={coordinateSystem:"cartesian2d",z:2,legendHoverLink:!0,effectType:"ripple",progressive:0,showEffectOn:"render",clip:!0,rippleEffect:{period:4,scale:2.5,brushType:"fill",number:3},universalTransition:{divideShape:"clone"},symbolSize:10},e})(Xi);function S1e(r){r.registerChartView(x1e),r.registerSeriesModel(w1e),r.registerLayout(nS("effectScatter"))}var dX=(function(r){Ye(e,r);function e(t,i,n){var a=r.call(this)||this;return a.add(a.createLine(t,i,n)),a._updateEffectSymbol(t,i),a}return e.prototype.createLine=function(t,i,n){return new qL(t,i,n)},e.prototype._updateEffectSymbol=function(t,i){var n=t.getItemModel(i),a=n.getModel("effect"),s=a.get("symbolSize"),o=a.get("symbol");xt(s)||(s=[s,s]);var l=t.getItemVisual(i,"style"),c=a.get("color")||l&&l.stroke,f=this.childAt(1);this._symbolType!==o&&(this.remove(f),f=Aa(o,-.5,-.5,1,1,c),f.z2=100,f.culling=!0,this.add(f)),f&&(f.setStyle("shadowColor",c),f.setStyle(a.getItemStyle(["color"])),f.scaleX=s[0],f.scaleY=s[1],f.setColor(c),this._symbolType=o,this._symbolScale=s,this._updateEffectAnimation(t,a,i))},e.prototype._updateEffectAnimation=function(t,i,n){var a=this.childAt(1);if(a){var s=t.getItemLayout(n),o=i.get("period")*1e3,l=i.get("loop"),c=i.get("roundTrip"),f=i.get("constantSpeed"),p=uo(i.get("delay"),function(b){return b/t.count()*o/3});if(a.ignore=!0,this._updateAnimationPoints(a,s),f>0&&(o=this._getLineLength(a)/f*1e3),o!==this._period||l!==this._loop||c!==this._roundTrip){a.stopAnimation();var y=void 0;sr(p)?y=p(n):y=p,a.__t>0&&(y=-o*a.__t),this._animateSymbol(a,o,y,l,c)}this._period=o,this._loop=l,this._roundTrip=c}},e.prototype._animateSymbol=function(t,i,n,a,s){if(i>0){t.__t=0;var o=this,l=t.animate("",a).when(s?i*2:i,{__t:s?2:1}).delay(n).during(function(){o._updateSymbolPosition(t)});a||l.done(function(){o.remove(t)}),l.start()}},e.prototype._getLineLength=function(t){return tp(t.__p1,t.__cp1)+tp(t.__cp1,t.__p2)},e.prototype._updateAnimationPoints=function(t,i){t.__p1=i[0],t.__p2=i[1],t.__cp1=i[2]||[(i[0][0]+i[1][0])/2,(i[0][1]+i[1][1])/2]},e.prototype.updateData=function(t,i,n){this.childAt(0).updateData(t,i,n),this._updateEffectSymbol(t,i)},e.prototype._updateSymbolPosition=function(t){var i=t.__p1,n=t.__p2,a=t.__cp1,s=t.__t<1?t.__t:2-t.__t,o=[t.x,t.y],l=o.slice(),c=Po,f=kR;o[0]=c(i[0],a[0],n[0],s),o[1]=c(i[1],a[1],n[1],s);var p=t.__t<1?f(i[0],a[0],n[0],s):f(n[0],a[0],i[0],1-s),y=t.__t<1?f(i[1],a[1],n[1],s):f(n[1],a[1],i[1],1-s);t.rotation=-Math.atan2(y,p)-Math.PI/2,(this._symbolType==="line"||this._symbolType==="rect"||this._symbolType==="roundRect")&&(t.__lastT!==void 0&&t.__lastT<t.__t?(t.scaleY=tp(l,o)*1.05,s===1&&(o[0]=l[0]+(o[0]-l[0])/2,o[1]=l[1]+(o[1]-l[1])/2)):t.__lastT===1?t.scaleY=2*tp(i,o):t.scaleY=this._symbolScale[1]),t.__lastT=t.__t,t.ignore=!1,t.x=o[0],t.y=o[1]},e.prototype.updateLayout=function(t,i){this.childAt(0).updateLayout(t,i);var n=t.getItemModel(i).getModel("effect");this._updateEffectAnimation(t,n,i)},e})(mr),pX=(function(r){Ye(e,r);function e(t,i,n){var a=r.call(this)||this;return a._createPolyline(t,i,n),a}return e.prototype._createPolyline=function(t,i,n){var a=t.getItemLayout(i),s=new ks({shape:{points:a}});this.add(s),this._updateCommonStl(t,i,n)},e.prototype.updateData=function(t,i,n){var a=t.hostModel,s=this.childAt(0),o={shape:{points:t.getItemLayout(i)}};vi(s,o,a,i),this._updateCommonStl(t,i,n)},e.prototype._updateCommonStl=function(t,i,n){var a=this.childAt(0),s=t.getItemModel(i),o=n&&n.emphasisLineStyle,l=n&&n.focus,c=n&&n.blurScope,f=n&&n.emphasisDisabled;if(!n||t.hasItemOption){var p=s.getModel("emphasis");o=p.getModel("lineStyle").getLineStyle(),f=p.get("disabled"),l=p.get("focus"),c=p.get("blurScope")}a.useStyle(t.getItemVisual(i,"style")),a.style.fill=null,a.style.strokeNoScale=!0;var y=a.ensureState("emphasis");y.style=o,Hn(this,l,c,f)},e.prototype.updateLayout=function(t,i){var n=this.childAt(0);n.setShape("points",t.getItemLayout(i))},e})(mr),T1e=(function(r){Ye(e,r);function e(){var t=r!==null&&r.apply(this,arguments)||this;return t._lastFrame=0,t._lastFramePercent=0,t}return e.prototype.createLine=function(t,i,n){return new pX(t,i,n)},e.prototype._updateAnimationPoints=function(t,i){this._points=i;for(var n=[0],a=0,s=1;s<i.length;s++){var o=i[s-1],l=i[s];a+=tp(o,l),n.push(a)}if(a===0){this._length=0;return}for(var s=0;s<n.length;s++)n[s]/=a;this._offsets=n,this._length=a},e.prototype._getLineLength=function(){return this._length},e.prototype._updateSymbolPosition=function(t){var i=t.__t<1?t.__t:2-t.__t,n=this._points,a=this._offsets,s=n.length;if(a){var o=this._lastFrame,l;if(i<this._lastFramePercent){var c=Math.min(o+1,s-1);for(l=c;l>=0&&!(a[l]<=i);l--);l=Math.min(l,s-2)}else{for(l=o;l<s&&!(a[l]>i);l++);l=Math.min(l-1,s-2)}var f=(i-a[l])/(a[l+1]-a[l]),p=n[l],y=n[l+1];t.x=p[0]*(1-f)+f*y[0],t.y=p[1]*(1-f)+f*y[1];var b=t.__t<1?y[0]-p[0]:p[0]-y[0],S=t.__t<1?y[1]-p[1]:p[1]-y[1];t.rotation=-Math.atan2(S,b)-Math.PI/2,this._lastFrame=l,this._lastFramePercent=i,t.ignore=!1}},e})(dX),A1e=(function(){function r(){this.polyline=!1,this.curveness=0,this.segs=[]}return r})(),C1e=(function(r){Ye(e,r);function e(t){var i=r.call(this,t)||this;return i._off=0,i.hoverDataIdx=-1,i}return e.prototype.reset=function(){this.notClear=!1,this._off=0},e.prototype.getDefaultStyle=function(){return{stroke:"#000",fill:null}},e.prototype.getDefaultShape=function(){return new A1e},e.prototype.buildPath=function(t,i){var n=i.segs,a=i.curveness,s;if(i.polyline)for(s=this._off;s<n.length;){var o=n[s++];if(o>0){t.moveTo(n[s++],n[s++]);for(var l=1;l<o;l++)t.lineTo(n[s++],n[s++])}}else for(s=this._off;s<n.length;){var c=n[s++],f=n[s++],p=n[s++],y=n[s++];if(t.moveTo(c,f),a>0){var b=(c+p)/2-(f-y)*a,S=(f+y)/2-(p-c)*a;t.quadraticCurveTo(b,S,p,y)}else t.lineTo(p,y)}this.incremental&&(this._off=s,this.notClear=!0)},e.prototype.findDataIndex=function(t,i){var n=this.shape,a=n.segs,s=n.curveness,o=this.style.lineWidth;if(n.polyline)for(var l=0,c=0;c<a.length;){var f=a[c++];if(f>0)for(var p=a[c++],y=a[c++],b=1;b<f;b++){var S=a[c++],C=a[c++];if(_g(p,y,S,C,o,t,i))return l}l++}else for(var l=0,c=0;c<a.length;){var p=a[c++],y=a[c++],S=a[c++],C=a[c++];if(s>0){var E=(p+S)/2-(y-C)*s,P=(y+C)/2-(S-p)*s;if(V$(p,y,E,P,S,C,o,t,i))return l}else if(_g(p,y,S,C,o,t,i))return l;l++}return-1},e.prototype.contain=function(t,i){var n=this.transformCoordToLocal(t,i),a=this.getBoundingRect();if(t=n[0],i=n[1],a.contain(t,i)){var s=this.hoverDataIdx=this.findDataIndex(t,i);return s>=0}return this.hoverDataIdx=-1,!1},e.prototype.getBoundingRect=function(){var t=this._rect;if(!t){for(var i=this.shape,n=i.segs,a=1/0,s=1/0,o=-1/0,l=-1/0,c=0;c<n.length;){var f=n[c++],p=n[c++];a=Math.min(f,a),o=Math.max(f,o),s=Math.min(p,s),l=Math.max(p,l)}t=this._rect=new Dr(a,s,o,l)}return t},e})(Xr),M1e=(function(){function r(){this.group=new mr}return r.prototype.updateData=function(e){this._clear();var t=this._create();t.setShape({segs:e.getLayout("linesPoints")}),this._setCommon(t,e)},r.prototype.incrementalPrepareUpdate=function(e){this.group.removeAll(),this._clear()},r.prototype.incrementalUpdate=function(e,t){var i=this._newAdded[0],n=t.getLayout("linesPoints"),a=i&&i.shape.segs;if(a&&a.length<2e4){var s=a.length,o=new Float32Array(s+n.length);o.set(a),o.set(n,s),i.setShape({segs:o})}else{this._newAdded=[];var l=this._create();l.incremental=!0,l.setShape({segs:n}),this._setCommon(l,t),l.__startIndex=e.start}},r.prototype.remove=function(){this._clear()},r.prototype.eachRendered=function(e){this._newAdded[0]&&e(this._newAdded[0])},r.prototype._create=function(){var e=new C1e({cursor:"default",ignoreCoarsePointer:!0});return this._newAdded.push(e),this.group.add(e),e},r.prototype._setCommon=function(e,t,i){var n=t.hostModel;e.setShape({polyline:n.get("polyline"),curveness:n.get(["lineStyle","curveness"])}),e.useStyle(n.getModel("lineStyle").getLineStyle()),e.style.strokeNoScale=!0;var a=t.getVisual("style");a&&a.stroke&&e.setStyle("stroke",a.stroke),e.setStyle("fill",null);var s=br(e);s.seriesIndex=n.seriesIndex,e.on("mousemove",function(o){s.dataIndex=null;var l=e.hoverDataIdx;l>0&&(s.dataIndex=l+e.__startIndex)})},r.prototype._clear=function(){this._newAdded=[],this.group.removeAll()},r})(),gX={seriesType:"lines",plan:mb(),reset:function(r){var e=r.coordinateSystem;if(e){var t=r.get("polyline"),i=r.pipelineContext.large;return{progress:function(n,a){var s=[];if(i){var o=void 0,l=n.end-n.start;if(t){for(var c=0,f=n.start;f<n.end;f++)c+=r.getLineCoordsCount(f);o=new Float32Array(l+c*2)}else o=new Float32Array(l*4);for(var p=0,y=[],f=n.start;f<n.end;f++){var b=r.getLineCoords(f,s);t&&(o[p++]=b);for(var S=0;S<b;S++)y=e.dataToPoint(s[S],!1,y),o[p++]=y[0],o[p++]=y[1]}a.setLayout("linesPoints",o)}else for(var f=n.start;f<n.end;f++){var C=a.getItemModel(f),b=r.getLineCoords(f,s),E=[];if(t)for(var P=0;P<b;P++)E.push(e.dataToPoint(s[P]));else{E[0]=e.dataToPoint(s[0]),E[1]=e.dataToPoint(s[1]);var O=C.get(["lineStyle","curveness"]);+O&&(E[2]=[(E[0][0]+E[1][0])/2-(E[0][1]-E[1][1])*O,(E[0][1]+E[1][1])/2-(E[1][0]-E[0][0])*O])}a.setItemLayout(f,E)}}}}}},E1e=(function(r){Ye(e,r);function e(){var t=r!==null&&r.apply(this,arguments)||this;return t.type=e.type,t}return e.prototype.render=function(t,i,n){var a=t.getData(),s=this._updateLineDraw(a,t),o=t.get("zlevel"),l=t.get(["effect","trailLength"]),c=n.getZr(),f=c.painter.getType()==="svg";f||c.painter.getLayer(o).clear(!0),this._lastZlevel!=null&&!f&&c.configLayer(this._lastZlevel,{motionBlur:!1}),this._showEffect(t)&&l>0&&(f||c.configLayer(o,{motionBlur:!0,lastFrameAlpha:Math.max(Math.min(l/10+.9,1),0)})),s.updateData(a);var p=t.get("clip",!0)&&iS(t.coordinateSystem,!1,t);p?this.group.setClipPath(p):this.group.removeClipPath(),this._lastZlevel=o,this._finished=!0},e.prototype.incrementalPrepareRender=function(t,i,n){var a=t.getData(),s=this._updateLineDraw(a,t);s.incrementalPrepareUpdate(a),this._clearLayer(n),this._finished=!1},e.prototype.incrementalRender=function(t,i,n){this._lineDraw.incrementalUpdate(t,i.getData()),this._finished=t.end===i.getData().count()},e.prototype.eachRendered=function(t){this._lineDraw&&this._lineDraw.eachRendered(t)},e.prototype.updateTransform=function(t,i,n){var a=t.getData(),s=t.pipelineContext;if(!this._finished||s.large||s.progressiveRender)return{update:!0};var o=gX.reset(t,i,n);o.progress&&o.progress({start:0,end:a.count(),count:a.count()},a),this._lineDraw.updateLayout(),this._clearLayer(n)},e.prototype._updateLineDraw=function(t,i){var n=this._lineDraw,a=this._showEffect(i),s=!!i.get("polyline"),o=i.pipelineContext,l=o.large;return(!n||a!==this._hasEffet||s!==this._isPolyline||l!==this._isLargeDraw)&&(n&&n.remove(),n=this._lineDraw=l?new M1e:new YL(s?a?T1e:pX:a?dX:qL),this._hasEffet=a,this._isPolyline=s,this._isLargeDraw=l),this.group.add(n.group),n},e.prototype._showEffect=function(t){return!!t.get(["effect","show"])},e.prototype._clearLayer=function(t){var i=t.getZr(),n=i.painter.getType()==="svg";!n&&this._lastZlevel!=null&&i.painter.getLayer(this._lastZlevel).clear(!0)},e.prototype.remove=function(t,i){this._lineDraw&&this._lineDraw.remove(),this._lineDraw=null,this._clearLayer(i)},e.prototype.dispose=function(t,i){this.remove(t,i)},e.type="lines",e})(Fi),I1e=typeof Uint32Array>"u"?Array:Uint32Array,P1e=typeof Float64Array>"u"?Array:Float64Array;function H6(r){var e=r.data;e&&e[0]&&e[0][0]&&e[0][0].coord&&(r.data=wt(e,function(t){var i=[t[0].coord,t[1].coord],n={coords:i};return t[0].name&&(n.fromName=t[0].name),t[1].name&&(n.toName=t[1].name),TC([n,t[0],t[1]])}))}var R1e=(function(r){Ye(e,r);function e(){var t=r!==null&&r.apply(this,arguments)||this;return t.type=e.type,t.visualStyleAccessPath="lineStyle",t.visualDrawType="stroke",t}return e.prototype.init=function(t){t.data=t.data||[],H6(t);var i=this._processFlatCoordsArray(t.data);this._flatCoords=i.flatCoords,this._flatCoordsOffset=i.flatCoordsOffset,i.flatCoords&&(t.data=new Float32Array(i.count)),r.prototype.init.apply(this,arguments)},e.prototype.mergeOption=function(t){if(H6(t),t.data){var i=this._processFlatCoordsArray(t.data);this._flatCoords=i.flatCoords,this._flatCoordsOffset=i.flatCoordsOffset,i.flatCoords&&(t.data=new Float32Array(i.count))}r.prototype.mergeOption.apply(this,arguments)},e.prototype.appendData=function(t){var i=this._processFlatCoordsArray(t.data);i.flatCoords&&(this._flatCoords?(this._flatCoords=$0(this._flatCoords,i.flatCoords),this._flatCoordsOffset=$0(this._flatCoordsOffset,i.flatCoordsOffset)):(this._flatCoords=i.flatCoords,this._flatCoordsOffset=i.flatCoordsOffset),t.data=new Float32Array(i.count)),this.getRawData().appendData(t.data)},e.prototype._getCoordsFromItemModel=function(t){var i=this.getData().getItemModel(t),n=i.option instanceof Array?i.option:i.getShallow("coords");return n},e.prototype.getLineCoordsCount=function(t){return this._flatCoordsOffset?this._flatCoordsOffset[t*2+1]:this._getCoordsFromItemModel(t).length},e.prototype.getLineCoords=function(t,i){if(this._flatCoordsOffset){for(var n=this._flatCoordsOffset[t*2],a=this._flatCoordsOffset[t*2+1],s=0;s<a;s++)i[s]=i[s]||[],i[s][0]=this._flatCoords[n+s*2],i[s][1]=this._flatCoords[n+s*2+1];return a}else{for(var o=this._getCoordsFromItemModel(t),s=0;s<o.length;s++)i[s]=i[s]||[],i[s][0]=o[s][0],i[s][1]=o[s][1];return o.length}},e.prototype._processFlatCoordsArray=function(t){var i=0;if(this._flatCoords&&(i=this._flatCoords.length),di(t[0])){for(var n=t.length,a=new I1e(n),s=new P1e(n),o=0,l=0,c=0,f=0;f<n;){c++;var p=t[f++];a[l++]=o+i,a[l++]=p;for(var y=0;y<p;y++){var b=t[f++],S=t[f++];s[o++]=b,s[o++]=S}}return{flatCoordsOffset:new Uint32Array(a.buffer,0,l),flatCoords:s,count:c}}return{flatCoordsOffset:null,flatCoords:null,count:t.length}},e.prototype.getInitialData=function(t,i){var n=new Es(["value"],this);return n.hasItemOption=!1,n.initData(t.data,[],function(a,s,o,l){if(a instanceof Array)return NaN;n.hasItemOption=!0;var c=a.value;if(c!=null)return c instanceof Array?c[l]:c}),n},e.prototype.formatTooltip=function(t,i,n){var a=this.getData(),s=a.getItemModel(t),o=s.get("name");if(o)return o;var l=s.get("fromName"),c=s.get("toName"),f=[];return l!=null&&f.push(l),c!=null&&f.push(c),po("nameValue",{name:f.join(" > ")})},e.prototype.preventIncremental=function(){return!!this.get(["effect","show"])},e.prototype.getProgressive=function(){var t=this.option.progressive;return t??(this.option.large?1e4:this.get("progressive"))},e.prototype.getProgressiveThreshold=function(){var t=this.option.progressiveThreshold;return t??(this.option.large?2e4:this.get("progressiveThreshold"))},e.prototype.getZLevelKey=function(){var t=this.getModel("effect"),i=t.get("trailLength");return this.getData().count()>this.getProgressiveThreshold()?this.id:t.get("show")&&i>0?i+"":""},e.type="series.lines",e.dependencies=["grid","polar","geo","calendar"],e.defaultOption={coordinateSystem:"geo",z:2,legendHoverLink:!0,xAxisIndex:0,yAxisIndex:0,symbol:["none","none"],symbolSize:[10,10],geoIndex:0,effect:{show:!1,period:4,constantSpeed:0,symbol:"circle",symbolSize:3,loop:!0,trailLength:.2},large:!1,largeThreshold:2e3,polyline:!1,clip:!0,label:{show:!1,position:"end"},lineStyle:{opacity:.5}},e})(Xi);function s2(r){return r instanceof Array||(r=[r,r]),r}var D1e={seriesType:"lines",reset:function(r){var e=s2(r.get("symbol")),t=s2(r.get("symbolSize")),i=r.getData();i.setVisual("fromSymbol",e&&e[0]),i.setVisual("toSymbol",e&&e[1]),i.setVisual("fromSymbolSize",t&&t[0]),i.setVisual("toSymbolSize",t&&t[1]);function n(a,s){var o=a.getItemModel(s),l=s2(o.getShallow("symbol",!0)),c=s2(o.getShallow("symbolSize",!0));l[0]&&a.setItemVisual(s,"fromSymbol",l[0]),l[1]&&a.setItemVisual(s,"toSymbol",l[1]),c[0]&&a.setItemVisual(s,"fromSymbolSize",c[0]),c[1]&&a.setItemVisual(s,"toSymbolSize",c[1])}return{dataEach:i.hasItemOption?n:null}}};function k1e(r){r.registerChartView(E1e),r.registerSeriesModel(R1e),r.registerLayout(gX),r.registerVisual(D1e)}var L1e=256,O1e=(function(){function r(){this.blurSize=30,this.pointSize=20,this.maxOpacity=1,this.minOpacity=0,this._gradientPixels={inRange:null,outOfRange:null};var e=Ih.createCanvas();this.canvas=e}return r.prototype.update=function(e,t,i,n,a,s){var o=this._getBrush(),l=this._getGradient(a,"inRange"),c=this._getGradient(a,"outOfRange"),f=this.pointSize+this.blurSize,p=this.canvas,y=p.getContext("2d"),b=e.length;p.width=t,p.height=i;for(var S=0;S<b;++S){var C=e[S],E=C[0],P=C[1],O=C[2],B=n(O);y.globalAlpha=B,y.drawImage(o,E-f,P-f)}if(!p.width||!p.height)return p;for(var F=y.getImageData(0,0,p.width,p.height),W=F.data,$=0,q=W.length,Q=this.minOpacity,ee=this.maxOpacity,te=ee-Q;$<q;){var B=W[$+3]/256,ae=Math.floor(B*(L1e-1))*4;if(B>0){var de=s(B)?l:c;B>0&&(B=B*te+Q),W[$++]=de[ae],W[$++]=de[ae+1],W[$++]=de[ae+2],W[$++]=de[ae+3]*B*256}else $+=4}return y.putImageData(F,0,0),p},r.prototype._getBrush=function(){var e=this._brushCanvas||(this._brushCanvas=Ih.createCanvas()),t=this.pointSize+this.blurSize,i=t*2;e.width=i,e.height=i;var n=e.getContext("2d");return n.clearRect(0,0,i,i),n.shadowOffsetX=i,n.shadowBlur=this.blurSize,n.shadowColor="#000",n.beginPath(),n.arc(-t,t,this.pointSize,0,Math.PI*2,!0),n.closePath(),n.fill(),e},r.prototype._getGradient=function(e,t){for(var i=this._gradientPixels,n=i[t]||(i[t]=new Uint8ClampedArray(256*4)),a=[0,0,0,0],s=0,o=0;o<256;o++)e[t](o/255,!0,a),n[s++]=a[0],n[s++]=a[1],n[s++]=a[2],n[s++]=a[3];return n},r})();function N1e(r,e,t){var i=r[1]-r[0];e=wt(e,function(s){return{interval:[(s.interval[0]-r[0])/i,(s.interval[1]-r[0])/i]}});var n=e.length,a=0;return function(s){var o;for(o=a;o<n;o++){var l=e[o].interval;if(l[0]<=s&&s<=l[1]){a=o;break}}if(o===n)for(o=a-1;o>=0;o--){var l=e[o].interval;if(l[0]<=s&&s<=l[1]){a=o;break}}return o>=0&&o<n&&t[o]}}function B1e(r,e){var t=r[1]-r[0];return e=[(e[0]-r[0])/t,(e[1]-r[0])/t],function(i){return i>=e[0]&&i<=e[1]}}function j6(r){var e=r.dimensions;return e[0]==="lng"&&e[1]==="lat"}var z1e=(function(r){Ye(e,r);function e(){var t=r!==null&&r.apply(this,arguments)||this;return t.type=e.type,t}return e.prototype.render=function(t,i,n){var a;i.eachComponent("visualMap",function(o){o.eachTargetSeries(function(l){l===t&&(a=o)})}),this._progressiveEls=null,this.group.removeAll();var s=t.coordinateSystem;s.type==="cartesian2d"||s.type==="calendar"?this._renderOnCartesianAndCalendar(t,n,0,t.getData().count()):j6(s)&&this._renderOnGeo(s,t,a,n)},e.prototype.incrementalPrepareRender=function(t,i,n){this.group.removeAll()},e.prototype.incrementalRender=function(t,i,n,a){var s=i.coordinateSystem;s&&(j6(s)?this.render(i,n,a):(this._progressiveEls=[],this._renderOnCartesianAndCalendar(i,a,t.start,t.end,!0)))},e.prototype.eachRendered=function(t){qg(this._progressiveEls||this.group,t)},e.prototype._renderOnCartesianAndCalendar=function(t,i,n,a,s){var o=t.coordinateSystem,l=ky(o,"cartesian2d"),c,f,p,y;if(l){var b=o.getAxis("x"),S=o.getAxis("y");c=b.getBandWidth()+.5,f=S.getBandWidth()+.5,p=b.scale.getExtent(),y=S.scale.getExtent()}for(var C=this.group,E=t.getData(),P=t.getModel(["emphasis","itemStyle"]).getItemStyle(),O=t.getModel(["blur","itemStyle"]).getItemStyle(),B=t.getModel(["select","itemStyle"]).getItemStyle(),F=t.get(["itemStyle","borderRadius"]),W=fo(t),$=t.getModel("emphasis"),q=$.get("focus"),Q=$.get("blurScope"),ee=$.get("disabled"),te=l?[E.mapDimension("x"),E.mapDimension("y"),E.mapDimension("value")]:[E.mapDimension("time"),E.mapDimension("value")],ae=n;ae<a;ae++){var de=void 0,ve=E.getItemVisual(ae,"style");if(l){var ye=E.get(te[0],ae),Ae=E.get(te[1],ae);if(isNaN(E.get(te[2],ae))||isNaN(ye)||isNaN(Ae)||ye<p[0]||ye>p[1]||Ae<y[0]||Ae>y[1])continue;var me=o.dataToPoint([ye,Ae]);de=new li({shape:{x:me[0]-c/2,y:me[1]-f/2,width:c,height:f},style:ve})}else{if(isNaN(E.get(te[1],ae)))continue;de=new li({z2:1,shape:o.dataToRect([E.get(te[0],ae)]).contentShape,style:ve})}if(E.hasItemOption){var De=E.getItemModel(ae),Fe=De.getModel("emphasis");P=Fe.getModel("itemStyle").getItemStyle(),O=De.getModel(["blur","itemStyle"]).getItemStyle(),B=De.getModel(["select","itemStyle"]).getItemStyle(),F=De.get(["itemStyle","borderRadius"]),q=Fe.get("focus"),Q=Fe.get("blurScope"),ee=Fe.get("disabled"),W=fo(De)}de.shape.r=F;var je=t.getRawValue(ae),ct="-";je&&je[2]!=null&&(ct=je[2]+""),rs(de,W,{labelFetcher:t,labelDataIndex:ae,defaultOpacity:ve.opacity,defaultText:ct}),de.ensureState("emphasis").style=P,de.ensureState("blur").style=O,de.ensureState("select").style=B,Hn(de,q,Q,ee),de.incremental=s,s&&(de.states.emphasis.hoverLayer=!0),C.add(de),E.setItemGraphicEl(ae,de),this._progressiveEls&&this._progressiveEls.push(de)}},e.prototype._renderOnGeo=function(t,i,n,a){var s=n.targetVisuals.inRange,o=n.targetVisuals.outOfRange,l=i.getData(),c=this._hmLayer||this._hmLayer||new O1e;c.blurSize=i.get("blurSize"),c.pointSize=i.get("pointSize"),c.minOpacity=i.get("minOpacity"),c.maxOpacity=i.get("maxOpacity");var f=t.getViewRect().clone(),p=t.getRoamTransform();f.applyTransform(p);var y=Math.max(f.x,0),b=Math.max(f.y,0),S=Math.min(f.width+f.x,a.getWidth()),C=Math.min(f.height+f.y,a.getHeight()),E=S-y,P=C-b,O=[l.mapDimension("lng"),l.mapDimension("lat"),l.mapDimension("value")],B=l.mapArray(O,function(q,Q,ee){var te=t.dataToPoint([q,Q]);return te[0]-=y,te[1]-=b,te.push(ee),te}),F=n.getExtent(),W=n.type==="visualMap.continuous"?B1e(F,n.option.range):N1e(F,n.getPieceList(),n.option.selected);c.update(B,E,P,s.color.getNormalizer(),{inRange:s.color.getColorMapper(),outOfRange:o.color.getColorMapper()},W);var $=new go({style:{width:E,height:P,x:y,y:b,image:c.canvas},silent:!0});this.group.add($)},e.type="heatmap",e})(Fi),F1e=(function(r){Ye(e,r);function e(){var t=r!==null&&r.apply(this,arguments)||this;return t.type=e.type,t}return e.prototype.getInitialData=function(t,i){return Gf(null,this,{generateCoord:"value"})},e.prototype.preventIncremental=function(){var t=vb.get(this.get("coordinateSystem"));if(t&&t.dimensions)return t.dimensions[0]==="lng"&&t.dimensions[1]==="lat"},e.type="series.heatmap",e.dependencies=["grid","geo","calendar"],e.defaultOption={coordinateSystem:"cartesian2d",z:2,geoIndex:0,blurSize:30,pointSize:20,maxOpacity:1,minOpacity:0,select:{itemStyle:{borderColor:"#212121"}}},e})(Xi);function V1e(r){r.registerChartView(z1e),r.registerSeriesModel(F1e)}var U1e=["itemStyle","borderWidth"],$6=[{xy:"x",wh:"width",index:0,posDesc:["left","right"]},{xy:"y",wh:"height",index:1,posDesc:["top","bottom"]}],gP=new $f,H1e=(function(r){Ye(e,r);function e(){var t=r!==null&&r.apply(this,arguments)||this;return t.type=e.type,t}return e.prototype.render=function(t,i,n){var a=this.group,s=t.getData(),o=this._data,l=t.coordinateSystem,c=l.getBaseAxis(),f=c.isHorizontal(),p=l.master.getRect(),y={ecSize:{width:n.getWidth(),height:n.getHeight()},seriesModel:t,coordSys:l,coordSysExtent:[[p.x,p.x+p.width],[p.y,p.y+p.height]],isHorizontal:f,valueDim:$6[+f],categoryDim:$6[1-+f]};s.diff(o).add(function(S){if(s.hasValue(S)){var C=G6(s,S),E=W6(s,S,C,y),P=X6(s,y,E);s.setItemGraphicEl(S,P),a.add(P),q6(P,y,E)}}).update(function(S,C){var E=o.getItemGraphicEl(C);if(!s.hasValue(S)){a.remove(E);return}var P=G6(s,S),O=W6(s,S,P,y),B=xX(s,O);E&&B!==E.__pictorialShapeStr&&(a.remove(E),s.setItemGraphicEl(S,null),E=null),E?q1e(E,y,O):E=X6(s,y,O,!0),s.setItemGraphicEl(S,E),E.__pictorialSymbolMeta=O,a.add(E),q6(E,y,O)}).remove(function(S){var C=o.getItemGraphicEl(S);C&&Z6(o,S,C.__pictorialSymbolMeta.animationModel,C)}).execute();var b=t.get("clip",!0)?iS(t.coordinateSystem,!1,t):null;return b?a.setClipPath(b):a.removeClipPath(),this._data=s,this.group},e.prototype.remove=function(t,i){var n=this.group,a=this._data;t.get("animation")?a&&a.eachItemGraphicEl(function(s){Z6(a,br(s).dataIndex,t,s)}):n.removeAll()},e.type="pictorialBar",e})(Fi);function W6(r,e,t,i){var n=r.getItemLayout(e),a=t.get("symbolRepeat"),s=t.get("symbolClip"),o=t.get("symbolPosition")||"start",l=t.get("symbolRotate"),c=(l||0)*Math.PI/180||0,f=t.get("symbolPatternSize")||2,p=t.isAnimationEnabled(),y={dataIndex:e,layout:n,itemModel:t,symbolType:r.getItemVisual(e,"symbol")||"circle",style:r.getItemVisual(e,"style"),symbolClip:s,symbolRepeat:a,symbolRepeatDirection:t.get("symbolRepeatDirection"),symbolPatternSize:f,rotation:c,animationModel:p?t:null,hoverScale:p&&t.get(["emphasis","scale"]),z2:t.getShallow("z",!0)||0};j1e(t,a,n,i,y),$1e(r,e,n,a,s,y.boundingLength,y.pxSign,f,i,y),W1e(t,y.symbolScale,c,i,y);var b=y.symbolSize,S=Dy(t.get("symbolOffset"),b);return G1e(t,b,n,a,s,S,o,y.valueLineWidth,y.boundingLength,y.repeatCutLength,i,y),y}function j1e(r,e,t,i,n){var a=i.valueDim,s=r.get("symbolBoundingData"),o=i.coordSys.getOtherAxis(i.coordSys.getBaseAxis()),l=o.toGlobalCoord(o.dataToCoord(0)),c=1-+(t[a.wh]<=0),f;if(xt(s)){var p=[vP(o,s[0])-l,vP(o,s[1])-l];p[1]<p[0]&&p.reverse(),f=p[c]}else s!=null?f=vP(o,s)-l:e?f=i.coordSysExtent[a.index][c]-l:f=t[a.wh];n.boundingLength=f,e&&(n.repeatCutLength=t[a.wh]);var y=a.xy==="x",b=o.inverse;n.pxSign=y&&!b||!y&&b?f>=0?1:-1:f>0?1:-1}function vP(r,e){return r.toGlobalCoord(r.dataToCoord(r.scale.parse(e)))}function $1e(r,e,t,i,n,a,s,o,l,c){var f=l.valueDim,p=l.categoryDim,y=Math.abs(t[p.wh]),b=r.getItemVisual(e,"symbolSize"),S;xt(b)?S=b.slice():b==null?S=["100%","100%"]:S=[b,b],S[p.index]=Vt(S[p.index],y),S[f.index]=Vt(S[f.index],i?y:Math.abs(a)),c.symbolSize=S;var C=c.symbolScale=[S[0]/o,S[1]/o];C[f.index]*=(l.isHorizontal?-1:1)*s}function W1e(r,e,t,i,n){var a=r.get(U1e)||0;a&&(gP.attr({scaleX:e[0],scaleY:e[1],rotation:t}),gP.updateTransform(),a/=gP.getLineScale(),a*=e[i.valueDim.index]),n.valueLineWidth=a||0}function G1e(r,e,t,i,n,a,s,o,l,c,f,p){var y=f.categoryDim,b=f.valueDim,S=p.pxSign,C=Math.max(e[b.index]+o,0),E=C;if(i){var P=Math.abs(l),O=uo(r.get("symbolMargin"),"15%")+"",B=!1;O.lastIndexOf("!")===O.length-1&&(B=!0,O=O.slice(0,O.length-1));var F=Vt(O,e[b.index]),W=Math.max(C+F*2,0),$=B?0:F*2,q=Mk(i),Q=q?i:Y6((P+$)/W),ee=P-Q*C;F=ee/2/(B?Q:Math.max(Q-1,1)),W=C+F*2,$=B?0:F*2,!q&&i!=="fixed"&&(Q=c?Y6((Math.abs(c)+$)/W):0),E=Q*W-$,p.repeatTimes=Q,p.symbolMargin=F}var te=S*(E/2),ae=p.pathPosition=[];ae[y.index]=t[y.wh]/2,ae[b.index]=s==="start"?te:s==="end"?l-te:l/2,a&&(ae[0]+=a[0],ae[1]+=a[1]);var de=p.bundlePosition=[];de[y.index]=t[y.xy],de[b.index]=t[b.xy];var ve=p.barRectShape=mt({},t);ve[b.wh]=S*Math.max(Math.abs(t[b.wh]),Math.abs(ae[b.index]+te)),ve[y.wh]=t[y.wh];var ye=p.clipShape={};ye[y.xy]=-t[y.xy],ye[y.wh]=f.ecSize[y.wh],ye[b.xy]=0,ye[b.wh]=t[b.wh]}function vX(r){var e=r.symbolPatternSize,t=Aa(r.symbolType,-e/2,-e/2,e,e);return t.attr({culling:!0}),t.type!=="image"&&t.setStyle({strokeNoScale:!0}),t}function mX(r,e,t,i){var n=r.__pictorialBundle,a=t.symbolSize,s=t.valueLineWidth,o=t.pathPosition,l=e.valueDim,c=t.repeatTimes||0,f=0,p=a[e.valueDim.index]+s+t.symbolMargin*2;for(oO(r,function(C){C.__pictorialAnimationIndex=f,C.__pictorialRepeatTimes=c,f<c?k0(C,null,S(f),t,i):k0(C,null,{scaleX:0,scaleY:0},t,i,function(){n.remove(C)}),f++});f<c;f++){var y=vX(t);y.__pictorialAnimationIndex=f,y.__pictorialRepeatTimes=c,n.add(y);var b=S(f);k0(y,{x:b.x,y:b.y,scaleX:0,scaleY:0},{scaleX:b.scaleX,scaleY:b.scaleY,rotation:b.rotation},t,i)}function S(C){var E=o.slice(),P=t.pxSign,O=C;return(t.symbolRepeatDirection==="start"?P>0:P<0)&&(O=c-1-C),E[l.index]=p*(O-c/2+.5)+o[l.index],{x:E[0],y:E[1],scaleX:t.symbolScale[0],scaleY:t.symbolScale[1],rotation:t.rotation}}}function yX(r,e,t,i){var n=r.__pictorialBundle,a=r.__pictorialMainPath;a?k0(a,null,{x:t.pathPosition[0],y:t.pathPosition[1],scaleX:t.symbolScale[0],scaleY:t.symbolScale[1],rotation:t.rotation},t,i):(a=r.__pictorialMainPath=vX(t),n.add(a),k0(a,{x:t.pathPosition[0],y:t.pathPosition[1],scaleX:0,scaleY:0,rotation:t.rotation},{scaleX:t.symbolScale[0],scaleY:t.symbolScale[1]},t,i))}function _X(r,e,t){var i=mt({},e.barRectShape),n=r.__pictorialBarRect;n?k0(n,null,{shape:i},e,t):(n=r.__pictorialBarRect=new li({z2:2,shape:i,silent:!0,style:{stroke:"transparent",fill:"transparent",lineWidth:0}}),n.disableMorphing=!0,r.add(n))}function bX(r,e,t,i){if(t.symbolClip){var n=r.__pictorialClipPath,a=mt({},t.clipShape),s=e.valueDim,o=t.animationModel,l=t.dataIndex;if(n)vi(n,{shape:a},o,l);else{a[s.wh]=0,n=new li({shape:a}),r.__pictorialBundle.setClipPath(n),r.__pictorialClipPath=n;var c={};c[s.wh]=t.clipShape[s.wh],Py[i?"updateProps":"initProps"](n,{shape:c},o,l)}}}function G6(r,e){var t=r.getItemModel(e);return t.getAnimationDelayParams=X1e,t.isAnimationEnabled=Z1e,t}function X1e(r){return{index:r.__pictorialAnimationIndex,count:r.__pictorialRepeatTimes}}function Z1e(){return this.parentModel.isAnimationEnabled()&&!!this.getShallow("animation")}function X6(r,e,t,i){var n=new mr,a=new mr;return n.add(a),n.__pictorialBundle=a,a.x=t.bundlePosition[0],a.y=t.bundlePosition[1],t.symbolRepeat?mX(n,e,t):yX(n,e,t),_X(n,t,i),bX(n,e,t,i),n.__pictorialShapeStr=xX(r,t),n.__pictorialSymbolMeta=t,n}function q1e(r,e,t){var i=t.animationModel,n=t.dataIndex,a=r.__pictorialBundle;vi(a,{x:t.bundlePosition[0],y:t.bundlePosition[1]},i,n),t.symbolRepeat?mX(r,e,t,!0):yX(r,e,t,!0),_X(r,t,!0),bX(r,e,t,!0)}function Z6(r,e,t,i){var n=i.__pictorialBarRect;n&&n.removeTextContent();var a=[];oO(i,function(s){a.push(s)}),i.__pictorialMainPath&&a.push(i.__pictorialMainPath),i.__pictorialClipPath&&(t=null),se(a,function(s){jg(s,{scaleX:0,scaleY:0},t,e,function(){i.parent&&i.parent.remove(i)})}),r.setItemGraphicEl(e,null)}function xX(r,e){return[r.getItemVisual(e.dataIndex,"symbol")||"none",!!e.symbolRepeat,!!e.symbolClip].join(":")}function oO(r,e,t){se(r.__pictorialBundle.children(),function(i){i!==r.__pictorialBarRect&&e.call(t,i)})}function k0(r,e,t,i,n,a){e&&r.attr(e),i.symbolClip&&!n?t&&r.attr(t):t&&Py[n?"updateProps":"initProps"](r,t,i.animationModel,i.dataIndex,a)}function q6(r,e,t){var i=t.dataIndex,n=t.itemModel,a=n.getModel("emphasis"),s=a.getModel("itemStyle").getItemStyle(),o=n.getModel(["blur","itemStyle"]).getItemStyle(),l=n.getModel(["select","itemStyle"]).getItemStyle(),c=n.getShallow("cursor"),f=a.get("focus"),p=a.get("blurScope"),y=a.get("scale");oO(r,function(C){if(C instanceof go){var E=C.style;C.useStyle(mt({image:E.image,x:E.x,y:E.y,width:E.width,height:E.height},t.style))}else C.useStyle(t.style);var P=C.ensureState("emphasis");P.style=s,y&&(P.scaleX=C.scaleX*1.1,P.scaleY=C.scaleY*1.1),C.ensureState("blur").style=o,C.ensureState("select").style=l,c&&(C.cursor=c),C.z2=t.z2});var b=e.valueDim.posDesc[+(t.boundingLength>0)],S=r.__pictorialBarRect;S.ignoreClip=!0,rs(S,fo(n),{labelFetcher:e.seriesModel,labelDataIndex:i,defaultText:Y0(e.seriesModel.getData(),i),inheritColor:t.style.fill,defaultOpacity:t.style.opacity,defaultOutsidePosition:b}),Hn(r,f,p,a.get("disabled"))}function Y6(r){var e=Math.round(r);return Math.abs(r-e)<1e-4?e:Math.ceil(r)}var Y1e=(function(r){Ye(e,r);function e(){var t=r!==null&&r.apply(this,arguments)||this;return t.type=e.type,t.hasSymbolVisual=!0,t.defaultSymbol="roundRect",t}return e.prototype.getInitialData=function(t){return t.stack=null,r.prototype.getInitialData.apply(this,arguments)},e.type="series.pictorialBar",e.dependencies=["grid"],e.defaultOption=Yg(Cw.defaultOption,{symbol:"circle",symbolSize:null,symbolRotate:null,symbolPosition:null,symbolOffset:null,symbolMargin:null,symbolRepeat:!1,symbolRepeatDirection:"end",symbolClip:!1,symbolBoundingData:null,symbolPatternSize:400,barGap:"-100%",clip:!1,progressive:0,emphasis:{scale:!1},select:{itemStyle:{borderColor:"#212121"}}}),e})(Cw);function K1e(r){r.registerChartView(H1e),r.registerSeriesModel(Y1e),r.registerLayout(r.PRIORITY.VISUAL.LAYOUT,Sr(nW,"pictorialBar")),r.registerLayout(r.PRIORITY.VISUAL.PROGRESSIVE_LAYOUT,aW("pictorialBar"))}var Q1e=(function(r){Ye(e,r);function e(){var t=r!==null&&r.apply(this,arguments)||this;return t.type=e.type,t._layers=[],t}return e.prototype.render=function(t,i,n){var a=t.getData(),s=this,o=this.group,l=t.getLayerSeries(),c=a.getLayout("layoutInfo"),f=c.rect,p=c.boundaryGap;o.x=0,o.y=f.y+p[0];function y(E){return E.name}var b=new fp(this._layersSeries||[],l,y,y),S=[];b.add(Xt(C,this,"add")).update(Xt(C,this,"update")).remove(Xt(C,this,"remove")).execute();function C(E,P,O){var B=s._layers;if(E==="remove"){o.remove(B[P]);return}for(var F=[],W=[],$,q=l[P].indices,Q=0;Q<q.length;Q++){var ee=a.getItemLayout(q[Q]),te=ee.x,ae=ee.y0,de=ee.y;F.push(te,ae),W.push(te,ae+de),$=a.getItemVisual(q[Q],"style")}var ve,ye=a.getItemLayout(q[0]),Ae=t.getModel("label"),me=Ae.get("margin"),De=t.getModel("emphasis");if(E==="add"){var Fe=S[P]=new mr;ve=new XW({shape:{points:F,stackedOnPoints:W,smooth:.4,stackedOnSmooth:.4,smoothConstraint:!1},z2:0}),Fe.add(ve),o.add(Fe),t.isAnimationEnabled()&&ve.setClipPath(J1e(ve.getBoundingRect(),t,function(){ve.removeClipPath()}))}else{var Fe=B[O];ve=Fe.childAt(0),o.add(Fe),S[P]=Fe,vi(ve,{shape:{points:F,stackedOnPoints:W}},t),Dh(ve)}rs(ve,fo(t),{labelDataIndex:q[Q-1],defaultText:a.getName(q[Q-1]),inheritColor:$.fill},{normal:{verticalAlign:"middle"}}),ve.setTextConfig({position:null,local:!0});var je=ve.getTextContent();je&&(je.x=ye.x-me,je.y=ye.y0+ye.y/2),ve.useStyle($),a.setItemGraphicEl(P,ve),ts(ve,t),Hn(ve,De.get("focus"),De.get("blurScope"),De.get("disabled"))}this._layersSeries=l,this._layers=S},e.type="themeRiver",e})(Fi);function J1e(r,e,t){var i=new li({shape:{x:r.x-10,y:r.y-10,width:0,height:r.height+20}});return An(i,{shape:{x:r.x-50,width:r.width+100,height:r.height+20}},e,t),i}var mP=2,ewe=(function(r){Ye(e,r);function e(){var t=r!==null&&r.apply(this,arguments)||this;return t.type=e.type,t}return e.prototype.init=function(t){r.prototype.init.apply(this,arguments),this.legendVisualProvider=new oS(Xt(this.getData,this),Xt(this.getRawData,this))},e.prototype.fixData=function(t){var i=t.length,n={},a=qR(t,function(y){return n.hasOwnProperty(y[0]+"")||(n[y[0]+""]=-1),y[2]}),s=[];a.buckets.each(function(y,b){s.push({name:b,dataList:y})});for(var o=s.length,l=0;l<o;++l){for(var c=s[l].name,f=0;f<s[l].dataList.length;++f){var p=s[l].dataList[f][0]+"";n[p]=l}for(var p in n)n.hasOwnProperty(p)&&n[p]!==l&&(n[p]=l,t[i]=[p,0,c],i++)}return t},e.prototype.getInitialData=function(t,i){for(var n=this.getReferringComponents("singleAxis",ka).models[0],a=n.get("type"),s=wi(t.data,function(S){return S[2]!==void 0}),o=this.fixData(s||[]),l=[],c=this.nameMap=Qt(),f=0,p=0;p<o.length;++p)l.push(o[p][mP]),c.get(o[p][mP])||(c.set(o[p][mP],f),f++);var y=bb(o,{coordDimensions:["single"],dimensionsDefine:[{name:"time",type:HA(a)},{name:"value",type:"float"},{name:"name",type:"ordinal"}],encodeDefine:{single:0,value:1,itemName:2}}).dimensions,b=new Es(y,this);return b.initData(o),b},e.prototype.getLayerSeries=function(){for(var t=this.getData(),i=t.count(),n=[],a=0;a<i;++a)n[a]=a;var s=t.mapDimension("single"),o=qR(n,function(c){return t.get("name",c)}),l=[];return o.buckets.each(function(c,f){c.sort(function(p,y){return t.get(s,p)-t.get(s,y)}),l.push({name:f,indices:c})}),l},e.prototype.getAxisTooltipData=function(t,i,n){xt(t)||(t=t?[t]:[]);for(var a=this.getData(),s=this.getLayerSeries(),o=[],l=s.length,c,f=0;f<l;++f){for(var p=Number.MAX_VALUE,y=-1,b=s[f].indices.length,S=0;S<b;++S){var C=a.get(t[0],s[f].indices[S]),E=Math.abs(C-i);E<=p&&(c=C,p=E,y=s[f].indices[S])}o.push(y)}return{dataIndices:o,nestestValue:c}},e.prototype.formatTooltip=function(t,i,n){var a=this.getData(),s=a.getName(t),o=a.get(a.mapDimension("value"),t);return po("nameValue",{name:s,value:o})},e.type="series.themeRiver",e.dependencies=["singleAxis"],e.defaultOption={z:2,colorBy:"data",coordinateSystem:"singleAxis",boundaryGap:["10%","10%"],singleAxisIndex:0,animationEasing:"linear",label:{margin:4,show:!0,position:"left",fontSize:11},emphasis:{label:{show:!0}}},e})(Xi);function twe(r,e){r.eachSeriesByType("themeRiver",function(t){var i=t.getData(),n=t.coordinateSystem,a={},s=n.getRect();a.rect=s;var o=t.get("boundaryGap"),l=n.getAxis();if(a.boundaryGap=o,l.orient==="horizontal"){o[0]=Vt(o[0],s.height),o[1]=Vt(o[1],s.height);var c=s.height-o[0]-o[1];K6(i,t,c)}else{o[0]=Vt(o[0],s.width),o[1]=Vt(o[1],s.width);var f=s.width-o[0]-o[1];K6(i,t,f)}i.setLayout("layoutInfo",a)})}function K6(r,e,t){if(r.count())for(var i=e.coordinateSystem,n=e.getLayerSeries(),a=r.mapDimension("single"),s=r.mapDimension("value"),o=wt(n,function(E){return wt(E.indices,function(P){var O=i.dataToPoint(r.get(a,P));return O[1]=r.get(s,P),O})}),l=rwe(o),c=l.y0,f=t/l.max,p=n.length,y=n[0].indices.length,b,S=0;S<y;++S){b=c[S]*f,r.setItemLayout(n[0].indices[S],{layerIndex:0,x:o[0][S][0],y0:b,y:o[0][S][1]*f});for(var C=1;C<p;++C)b+=o[C-1][S][1]*f,r.setItemLayout(n[C].indices[S],{layerIndex:C,x:o[C][S][0],y0:b,y:o[C][S][1]*f})}}function rwe(r){for(var e=r.length,t=r[0].length,i=[],n=[],a=0,s=0;s<t;++s){for(var o=0,l=0;l<e;++l)o+=r[l][s][1];o>a&&(a=o),i.push(o)}for(var c=0;c<t;++c)n[c]=(a-i[c])/2;a=0;for(var f=0;f<t;++f){var p=i[f]+n[f];p>a&&(a=p)}return{y0:n,max:a}}function iwe(r){r.registerChartView(Q1e),r.registerSeriesModel(ewe),r.registerLayout(twe),r.registerProcessor(aS("themeRiver"))}var nwe=2,awe=4,Q6=(function(r){Ye(e,r);function e(t,i,n,a){var s=r.call(this)||this;s.z2=nwe,s.textConfig={inside:!0},br(s).seriesIndex=i.seriesIndex;var o=new si({z2:awe,silent:t.getModel().get(["label","silent"])});return s.setTextContent(o),s.updateData(!0,t,i,n,a),s}return e.prototype.updateData=function(t,i,n,a,s){this.node=i,i.piece=this,n=n||this._seriesModel,a=a||this._ecModel;var o=this;br(o).dataIndex=i.dataIndex;var l=i.getModel(),c=l.getModel("emphasis"),f=i.getLayout(),p=mt({},f);p.label=null;var y=i.getVisual("style");y.lineJoin="bevel";var b=i.getVisual("decal");b&&(y.decal=q0(b,s));var S=Zm(l.getModel("itemStyle"),p,!0);mt(p,S),se(ll,function(O){var B=o.ensureState(O),F=l.getModel([O,"itemStyle"]);B.style=F.getItemStyle();var W=Zm(F,p);W&&(B.shape=W)}),t?(o.setShape(p),o.shape.r=f.r0,An(o,{shape:{r:f.r}},n,i.dataIndex)):(vi(o,{shape:p},n),Dh(o)),o.useStyle(y),this._updateLabel(n);var C=l.getShallow("cursor");C&&o.attr("cursor",C),this._seriesModel=n||this._seriesModel,this._ecModel=a||this._ecModel;var E=c.get("focus"),P=E==="relative"?$0(i.getAncestorsIndices(),i.getDescendantIndices()):E==="ancestor"?i.getAncestorsIndices():E==="descendant"?i.getDescendantIndices():E;Hn(this,P,c.get("blurScope"),c.get("disabled"))},e.prototype._updateLabel=function(t){var i=this,n=this.node.getModel(),a=n.getModel("label"),s=this.node.getLayout(),o=s.endAngle-s.startAngle,l=(s.startAngle+s.endAngle)/2,c=Math.cos(l),f=Math.sin(l),p=this,y=p.getTextContent(),b=this.node.dataIndex,S=a.get("minAngle")/180*Math.PI,C=a.get("show")&&!(S!=null&&Math.abs(o)<S);y.ignore=!C,se(pw,function(P){var O=P==="normal"?n.getModel("label"):n.getModel([P,"label"]),B=P==="normal",F=B?y:y.ensureState(P),W=t.getFormattedLabel(b,P);B&&(W=W||i.node.name),F.style=cn(O,{},null,P!=="normal",!0),W&&(F.style.text=W);var $=O.get("show");$!=null&&!B&&(F.ignore=!$);var q=E(O,"position"),Q=B?p:p.states[P],ee=Q.style.fill;Q.textConfig={outsideFill:O.get("color")==="inherit"?ee:null,inside:q!=="outside"};var te,ae=E(O,"distance")||0,de=E(O,"align"),ve=E(O,"rotate"),ye=Math.PI*.5,Ae=Math.PI*1.5,me=_u(ve==="tangential"?Math.PI/2-l:l),De=me>ye&&!W0(me-ye)&&me<Ae;q==="outside"?(te=s.r+ae,de=De?"right":"left"):!de||de==="center"?(o===2*Math.PI&&s.r0===0?te=0:te=(s.r+s.r0)/2,de="center"):de==="left"?(te=s.r0+ae,de=De?"right":"left"):de==="right"&&(te=s.r-ae,de=De?"left":"right"),F.style.align=de,F.style.verticalAlign=E(O,"verticalAlign")||"middle",F.x=te*c+s.cx,F.y=te*f+s.cy;var Fe=0;ve==="radial"?Fe=_u(-l)+(De?Math.PI:0):ve==="tangential"?Fe=_u(Math.PI/2-l)+(De?Math.PI:0):di(ve)&&(Fe=ve*Math.PI/180),F.rotation=_u(Fe)});function E(P,O){var B=P.get(O);return B??a.get(O)}y.dirtyStyle()},e})(Ps),Y3="sunburstRootToNode",J6="sunburstHighlight",owe="sunburstUnhighlight";function swe(r){r.registerAction({type:Y3,update:"updateView"},function(e,t){t.eachComponent({mainType:"series",subType:"sunburst",query:e},i);function i(n,a){var s=Ew(e,[Y3],n);if(s){var o=n.getViewRoot();o&&(e.direction=$L(o,s.node)?"rollUp":"drillDown"),n.resetViewRoot(s.node)}}}),r.registerAction({type:J6,update:"none"},function(e,t,i){e=mt({},e),t.eachComponent({mainType:"series",subType:"sunburst",query:e},n);function n(a){var s=Ew(e,[J6],a);s&&(e.dataIndex=s.node.dataIndex)}i.dispatchAction(mt(e,{type:"highlight"}))}),r.registerAction({type:owe,update:"updateView"},function(e,t,i){e=mt({},e),i.dispatchAction(mt(e,{type:"downplay"}))})}var lwe=(function(r){Ye(e,r);function e(){var t=r!==null&&r.apply(this,arguments)||this;return t.type=e.type,t}return e.prototype.render=function(t,i,n,a){var s=this;this.seriesModel=t,this.api=n,this.ecModel=i;var o=t.getData(),l=o.tree.root,c=t.getViewRoot(),f=this.group,p=t.get("renderLabelForZeroData"),y=[];c.eachNode(function(O){y.push(O)});var b=this._oldChildren||[];S(y,b),P(l,c),this._initEvents(),this._oldChildren=y;function S(O,B){if(O.length===0&&B.length===0)return;new fp(B,O,F,F).add(W).update(W).remove(Sr(W,null)).execute();function F($){return $.getId()}function W($,q){var Q=$==null?null:O[$],ee=q==null?null:B[q];C(Q,ee)}}function C(O,B){if(!p&&O&&!O.getValue()&&(O=null),O!==l&&B!==l){if(B&&B.piece)O?(B.piece.updateData(!1,O,t,i,n),o.setItemGraphicEl(O.dataIndex,B.piece)):E(B);else if(O){var F=new Q6(O,t,i,n);f.add(F),o.setItemGraphicEl(O.dataIndex,F)}}}function E(O){O&&O.piece&&(f.remove(O.piece),O.piece=null)}function P(O,B){B.depth>0?(s.virtualPiece?s.virtualPiece.updateData(!1,O,t,i,n):(s.virtualPiece=new Q6(O,t,i,n),f.add(s.virtualPiece)),B.piece.off("click"),s.virtualPiece.on("click",function(F){s._rootToNode(B.parentNode)})):s.virtualPiece&&(f.remove(s.virtualPiece),s.virtualPiece=null)}},e.prototype._initEvents=function(){var t=this;this.group.off("click"),this.group.on("click",function(i){var n=!1,a=t.seriesModel.getViewRoot();a.eachNode(function(s){if(!n&&s.piece&&s.piece===i.target){var o=s.getModel().get("nodeClick");if(o==="rootToNode")t._rootToNode(s);else if(o==="link"){var l=s.getModel(),c=l.get("link");if(c){var f=l.get("target",!0)||"_blank";DA(c,f)}}n=!0}})})},e.prototype._rootToNode=function(t){t!==this.seriesModel.getViewRoot()&&this.api.dispatchAction({type:Y3,from:this.uid,seriesId:this.seriesModel.id,targetNode:t})},e.prototype.containPoint=function(t,i){var n=i.getData(),a=n.getItemLayout(0);if(a){var s=t[0]-a.cx,o=t[1]-a.cy,l=Math.sqrt(s*s+o*o);return l<=a.r&&l>=a.r0}},e.type="sunburst",e})(Fi),uwe=(function(r){Ye(e,r);function e(){var t=r!==null&&r.apply(this,arguments)||this;return t.type=e.type,t.ignoreStyleOnData=!0,t}return e.prototype.getInitialData=function(t,i){var n={name:t.name,children:t.data};wX(n);var a=this._levelModels=wt(t.levels||[],function(l){return new Si(l,this,i)},this),s=jL.createTree(n,this,o);function o(l){l.wrapMethod("getItemModel",function(c,f){var p=s.getNodeByDataIndex(f),y=a[p.depth];return y&&(c.parentModel=y),c})}return s.data},e.prototype.optionUpdated=function(){this.resetViewRoot()},e.prototype.getDataParams=function(t){var i=r.prototype.getDataParams.apply(this,arguments),n=this.getData().tree.getNodeByDataIndex(t);return i.treePathInfo=sM(n,this),i},e.prototype.getLevelModel=function(t){return this._levelModels&&this._levelModels[t.depth]},e.prototype.getViewRoot=function(){return this._viewRoot},e.prototype.resetViewRoot=function(t){t?this._viewRoot=t:t=this._viewRoot;var i=this.getRawData().tree.root;(!t||t!==i&&!i.contains(t))&&(this._viewRoot=i)},e.prototype.enableAriaDecal=function(){MG(this)},e.type="series.sunburst",e.defaultOption={z:2,center:["50%","50%"],radius:[0,"75%"],clockwise:!0,startAngle:90,minAngle:0,stillShowZeroSum:!0,nodeClick:"rootToNode",renderLabelForZeroData:!1,label:{rotate:"radial",show:!0,opacity:1,align:"center",position:"inside",distance:5,silent:!0},itemStyle:{borderWidth:1,borderColor:"white",borderType:"solid",shadowBlur:0,shadowColor:"rgba(0, 0, 0, 0.2)",shadowOffsetX:0,shadowOffsetY:0,opacity:1},emphasis:{focus:"descendant"},blur:{itemStyle:{opacity:.2},label:{opacity:.1}},animationType:"expansion",animationDuration:1e3,animationDurationUpdate:500,data:[],sort:"desc"},e})(Xi);function wX(r){var e=0;se(r.children,function(i){wX(i);var n=i.value;xt(n)&&(n=n[0]),e+=n});var t=r.value;xt(t)&&(t=t[0]),(t==null||isNaN(t))&&(t=e),t<0&&(t=0),xt(r.value)?r.value[0]=t:r.value=t}var eV=Math.PI/180;function cwe(r,e,t){e.eachSeriesByType(r,function(i){var n=i.get("center"),a=i.get("radius");xt(a)||(a=[0,a]),xt(n)||(n=[n,n]);var s=t.getWidth(),o=t.getHeight(),l=Math.min(s,o),c=Vt(n[0],s),f=Vt(n[1],o),p=Vt(a[0],l/2),y=Vt(a[1],l/2),b=-i.get("startAngle")*eV,S=i.get("minAngle")*eV,C=i.getData().tree.root,E=i.getViewRoot(),P=E.depth,O=i.get("sort");O!=null&&SX(E,O);var B=0;se(E.children,function(me){!isNaN(me.getValue())&&B++});var F=E.getValue(),W=Math.PI/(F||B)*2,$=E.depth>0,q=E.height-($?-1:1),Q=(y-p)/(q||1),ee=i.get("clockwise"),te=i.get("stillShowZeroSum"),ae=ee?1:-1,de=function(me,De){if(me){var Fe=De;if(me!==C){var je=me.getValue(),ct=F===0&&te?W:je*W;ct<S&&(ct=S),Fe=De+ae*ct;var xe=me.depth-P-($?-1:1),$e=p+Q*xe,pt=p+Q*(xe+1),_t=i.getLevelModel(me);if(_t){var Dt=_t.get("r0",!0),qt=_t.get("r",!0),_r=_t.get("radius",!0);_r!=null&&(Dt=_r[0],qt=_r[1]),Dt!=null&&($e=Vt(Dt,l/2)),qt!=null&&(pt=Vt(qt,l/2))}me.setLayout({angle:ct,startAngle:De,endAngle:Fe,clockwise:ee,cx:c,cy:f,r0:$e,r:pt})}if(me.children&&me.children.length){var Kt=0;se(me.children,function(zt){Kt+=de(zt,De+Kt)})}return Fe-De}};if($){var ve=p,ye=p+Q,Ae=Math.PI*2;C.setLayout({angle:Ae,startAngle:b,endAngle:b+Ae,clockwise:ee,cx:c,cy:f,r0:ve,r:ye})}de(E,b)})}function SX(r,e){var t=r.children||[];r.children=hwe(t,e),t.length&&se(r.children,function(i){SX(i,e)})}function hwe(r,e){if(sr(e)){var t=wt(r,function(n,a){var s=n.getValue();return{params:{depth:n.depth,height:n.height,dataIndex:n.dataIndex,getValue:function(){return s}},index:a}});return t.sort(function(n,a){return e(n.params,a.params)}),wt(t,function(n){return r[n.index]})}else{var i=e==="asc";return r.sort(function(n,a){var s=(n.getValue()-a.getValue())*(i?1:-1);return s===0?(n.dataIndex-a.dataIndex)*(i?-1:1):s})}}function fwe(r){var e={};function t(i,n,a){for(var s=i;s&&s.depth>1;)s=s.parentNode;var o=n.getColorFromPalette(s.name||s.dataIndex+"",e);return i.depth>1&&$t(o)&&(o=bA(o,(i.depth-1)/(a-1)*.5)),o}r.eachSeriesByType("sunburst",function(i){var n=i.getData(),a=n.tree;a.eachNode(function(s){var o=s.getModel(),l=o.getModel("itemStyle").getItemStyle();l.fill||(l.fill=t(s,i,a.root.height));var c=n.ensureUniqueItemVisual(s.dataIndex,"style");mt(c,l)})})}function dwe(r){r.registerChartView(lwe),r.registerSeriesModel(uwe),r.registerLayout(Sr(cwe,"sunburst")),r.registerProcessor(Sr(aS,"sunburst")),r.registerVisual(fwe),swe(r)}var tV={color:"fill",borderColor:"stroke"},pwe={symbol:1,symbolSize:1,symbolKeepAspect:1,legendIcon:1,visualMeta:1,liftZ:1,decal:1},op=fi(),gwe=(function(r){Ye(e,r);function e(){var t=r!==null&&r.apply(this,arguments)||this;return t.type=e.type,t}return e.prototype.optionUpdated=function(){this.currentZLevel=this.get("zlevel",!0),this.currentZ=this.get("z",!0)},e.prototype.getInitialData=function(t,i){return Gf(null,this)},e.prototype.getDataParams=function(t,i,n){var a=r.prototype.getDataParams.call(this,t,i);return n&&(a.info=op(n).info),a},e.type="series.custom",e.dependencies=["grid","polar","geo","singleAxis","calendar"],e.defaultOption={coordinateSystem:"cartesian2d",z:2,legendHoverLink:!0,clip:!1},e})(Xi);function vwe(r,e){return e=e||[0,0],wt(["x","y"],function(t,i){var n=this.getAxis(t),a=e[i],s=r[i]/2;return n.type==="category"?n.getBandWidth():Math.abs(n.dataToCoord(a-s)-n.dataToCoord(a+s))},this)}function mwe(r){var e=r.master.getRect();return{coordSys:{type:"cartesian2d",x:e.x,y:e.y,width:e.width,height:e.height},api:{coord:function(t){return r.dataToPoint(t)},size:Xt(vwe,r)}}}function ywe(r,e){return e=e||[0,0],wt([0,1],function(t){var i=e[t],n=r[t]/2,a=[],s=[];return a[t]=i-n,s[t]=i+n,a[1-t]=s[1-t]=e[1-t],Math.abs(this.dataToPoint(a)[t]-this.dataToPoint(s)[t])},this)}function _we(r){var e=r.getBoundingRect();return{coordSys:{type:"geo",x:e.x,y:e.y,width:e.width,height:e.height,zoom:r.getZoom()},api:{coord:function(t){return r.dataToPoint(t)},size:Xt(ywe,r)}}}function bwe(r,e){var t=this.getAxis(),i=e instanceof Array?e[0]:e,n=(r instanceof Array?r[0]:r)/2;return t.type==="category"?t.getBandWidth():Math.abs(t.dataToCoord(i-n)-t.dataToCoord(i+n))}function xwe(r){var e=r.getRect();return{coordSys:{type:"singleAxis",x:e.x,y:e.y,width:e.width,height:e.height},api:{coord:function(t){return r.dataToPoint(t)},size:Xt(bwe,r)}}}function wwe(r,e){return e=e||[0,0],wt(["Radius","Angle"],function(t,i){var n="get"+t+"Axis",a=this[n](),s=e[i],o=r[i]/2,l=a.type==="category"?a.getBandWidth():Math.abs(a.dataToCoord(s-o)-a.dataToCoord(s+o));return t==="Angle"&&(l=l*Math.PI/180),l},this)}function Swe(r){var e=r.getRadiusAxis(),t=r.getAngleAxis(),i=e.getExtent();return i[0]>i[1]&&i.reverse(),{coordSys:{type:"polar",cx:r.cx,cy:r.cy,r:i[1],r0:i[0]},api:{coord:function(n){var a=e.dataToRadius(n[0]),s=t.dataToAngle(n[1]),o=r.coordToPoint([a,s]);return o.push(a,s*Math.PI/180),o},size:Xt(wwe,r)}}}function Twe(r){var e=r.getRect(),t=r.getRangeInfo();return{coordSys:{type:"calendar",x:e.x,y:e.y,width:e.width,height:e.height,cellWidth:r.getCellWidth(),cellHeight:r.getCellHeight(),rangeInfo:{start:t.start,end:t.end,weeks:t.weeks,dayCount:t.allDay}},api:{coord:function(i,n){return r.dataToPoint(i,n)}}}}function TX(r,e,t,i){return r&&(r.legacy||r.legacy!==!1&&!t&&!i&&e!=="tspan"&&(e==="text"||Yt(r,"text")))}function AX(r,e,t){var i=r,n,a,s;if(e==="text")s=i;else{s={},Yt(i,"text")&&(s.text=i.text),Yt(i,"rich")&&(s.rich=i.rich),Yt(i,"textFill")&&(s.fill=i.textFill),Yt(i,"textStroke")&&(s.stroke=i.textStroke),Yt(i,"fontFamily")&&(s.fontFamily=i.fontFamily),Yt(i,"fontSize")&&(s.fontSize=i.fontSize),Yt(i,"fontStyle")&&(s.fontStyle=i.fontStyle),Yt(i,"fontWeight")&&(s.fontWeight=i.fontWeight),a={type:"text",style:s,silent:!0},n={};var o=Yt(i,"textPosition");t?n.position=o?i.textPosition:"inside":o&&(n.position=i.textPosition),Yt(i,"textPosition")&&(n.position=i.textPosition),Yt(i,"textOffset")&&(n.offset=i.textOffset),Yt(i,"textRotation")&&(n.rotation=i.textRotation),Yt(i,"textDistance")&&(n.distance=i.textDistance)}return rV(s,r),se(s.rich,function(l){rV(l,l)}),{textConfig:n,textContent:a}}function rV(r,e){e&&(e.font=e.textFont||e.font,Yt(e,"textStrokeWidth")&&(r.lineWidth=e.textStrokeWidth),Yt(e,"textAlign")&&(r.align=e.textAlign),Yt(e,"textVerticalAlign")&&(r.verticalAlign=e.textVerticalAlign),Yt(e,"textLineHeight")&&(r.lineHeight=e.textLineHeight),Yt(e,"textWidth")&&(r.width=e.textWidth),Yt(e,"textHeight")&&(r.height=e.textHeight),Yt(e,"textBackgroundColor")&&(r.backgroundColor=e.textBackgroundColor),Yt(e,"textPadding")&&(r.padding=e.textPadding),Yt(e,"textBorderColor")&&(r.borderColor=e.textBorderColor),Yt(e,"textBorderWidth")&&(r.borderWidth=e.textBorderWidth),Yt(e,"textBorderRadius")&&(r.borderRadius=e.textBorderRadius),Yt(e,"textBoxShadowColor")&&(r.shadowColor=e.textBoxShadowColor),Yt(e,"textBoxShadowBlur")&&(r.shadowBlur=e.textBoxShadowBlur),Yt(e,"textBoxShadowOffsetX")&&(r.shadowOffsetX=e.textBoxShadowOffsetX),Yt(e,"textBoxShadowOffsetY")&&(r.shadowOffsetY=e.textBoxShadowOffsetY))}function iV(r,e,t){var i=r;i.textPosition=i.textPosition||t.position||"inside",t.offset!=null&&(i.textOffset=t.offset),t.rotation!=null&&(i.textRotation=t.rotation),t.distance!=null&&(i.textDistance=t.distance);var n=i.textPosition.indexOf("inside")>=0,a=r.fill||"#000";nV(i,e);var s=i.textFill==null;return n?s&&(i.textFill=t.insideFill||"#fff",!i.textStroke&&t.insideStroke&&(i.textStroke=t.insideStroke),!i.textStroke&&(i.textStroke=a),i.textStrokeWidth==null&&(i.textStrokeWidth=2)):(s&&(i.textFill=r.fill||t.outsideFill||"#000"),!i.textStroke&&t.outsideStroke&&(i.textStroke=t.outsideStroke)),i.text=e.text,i.rich=e.rich,se(e.rich,function(o){nV(o,o)}),i}function nV(r,e){e&&(Yt(e,"fill")&&(r.textFill=e.fill),Yt(e,"stroke")&&(r.textStroke=e.fill),Yt(e,"lineWidth")&&(r.textStrokeWidth=e.lineWidth),Yt(e,"font")&&(r.font=e.font),Yt(e,"fontStyle")&&(r.fontStyle=e.fontStyle),Yt(e,"fontWeight")&&(r.fontWeight=e.fontWeight),Yt(e,"fontSize")&&(r.fontSize=e.fontSize),Yt(e,"fontFamily")&&(r.fontFamily=e.fontFamily),Yt(e,"align")&&(r.textAlign=e.align),Yt(e,"verticalAlign")&&(r.textVerticalAlign=e.verticalAlign),Yt(e,"lineHeight")&&(r.textLineHeight=e.lineHeight),Yt(e,"width")&&(r.textWidth=e.width),Yt(e,"height")&&(r.textHeight=e.height),Yt(e,"backgroundColor")&&(r.textBackgroundColor=e.backgroundColor),Yt(e,"padding")&&(r.textPadding=e.padding),Yt(e,"borderColor")&&(r.textBorderColor=e.borderColor),Yt(e,"borderWidth")&&(r.textBorderWidth=e.borderWidth),Yt(e,"borderRadius")&&(r.textBorderRadius=e.borderRadius),Yt(e,"shadowColor")&&(r.textBoxShadowColor=e.shadowColor),Yt(e,"shadowBlur")&&(r.textBoxShadowBlur=e.shadowBlur),Yt(e,"shadowOffsetX")&&(r.textBoxShadowOffsetX=e.shadowOffsetX),Yt(e,"shadowOffsetY")&&(r.textBoxShadowOffsetY=e.shadowOffsetY),Yt(e,"textShadowColor")&&(r.textShadowColor=e.textShadowColor),Yt(e,"textShadowBlur")&&(r.textShadowBlur=e.textShadowBlur),Yt(e,"textShadowOffsetX")&&(r.textShadowOffsetX=e.textShadowOffsetX),Yt(e,"textShadowOffsetY")&&(r.textShadowOffsetY=e.textShadowOffsetY))}var CX={position:["x","y"],scale:["scaleX","scaleY"],origin:["originX","originY"]},aV=qr(CX);Sc(Uf,function(r,e){return r[e]=1,r},{});Uf.join(", ");var eC=["","style","shape","extra"],J0=fi();function sO(r,e,t,i,n){var a=r+"Animation",s=cb(r,i,n)||{},o=J0(e).userDuring;return s.duration>0&&(s.during=o?Xt(Iwe,{el:e,userDuring:o}):null,s.setToFinal=!0,s.scope=r),mt(s,t[a]),s}function j2(r,e,t,i){i=i||{};var n=i.dataIndex,a=i.isInit,s=i.clearStyle,o=t.isAnimationEnabled(),l=J0(r),c=e.style;l.userDuring=e.during;var f={},p={};if(Rwe(r,e,p),sV("shape",e,p),sV("extra",e,p),!a&&o&&(Pwe(r,e,f),oV("shape",r,e,f),oV("extra",r,e,f),Dwe(r,e,c,f)),p.style=c,Awe(r,p,s),Mwe(r,e),o)if(a){var y={};se(eC,function(S){var C=S?e[S]:e;C&&C.enterFrom&&(S&&(y[S]=y[S]||{}),mt(S?y[S]:y,C.enterFrom))});var b=sO("enter",r,e,t,n);b.duration>0&&r.animateFrom(y,b)}else Cwe(r,e,n||0,t,f);MX(r,e),c?r.dirty():r.markRedraw()}function MX(r,e){for(var t=J0(r).leaveToProps,i=0;i<eC.length;i++){var n=eC[i],a=n?e[n]:e;a&&a.leaveTo&&(t||(t=J0(r).leaveToProps={}),n&&(t[n]=t[n]||{}),mt(n?t[n]:t,a.leaveTo))}}function cM(r,e,t,i){if(r){var n=r.parent,a=J0(r).leaveToProps;if(a){var s=sO("update",r,e,t,0);s.done=function(){n.remove(r)},r.animateTo(a,s)}else n.remove(r)}}function sy(r){return r==="all"}function Awe(r,e,t){var i=e.style;if(!r.isGroup&&i){if(t){r.useStyle({});for(var n=r.animators,a=0;a<n.length;a++){var s=n[a];s.targetName==="style"&&s.changeTarget(r.style)}}r.setStyle(i)}e&&(e.style=null,e&&r.attr(e),e.style=i)}function Cwe(r,e,t,i,n){if(n){var a=sO("update",r,e,i,t);a.duration>0&&r.animateFrom(n,a)}}function Mwe(r,e){Yt(e,"silent")&&(r.silent=e.silent),Yt(e,"ignore")&&(r.ignore=e.ignore),r instanceof Tc&&Yt(e,"invisible")&&(r.invisible=e.invisible),r instanceof Xr&&Yt(e,"autoBatch")&&(r.autoBatch=e.autoBatch)}var Af={},Ewe={setTransform:function(r,e){return Af.el[r]=e,this},getTransform:function(r){return Af.el[r]},setShape:function(r,e){var t=Af.el,i=t.shape||(t.shape={});return i[r]=e,t.dirtyShape&&t.dirtyShape(),this},getShape:function(r){var e=Af.el.shape;if(e)return e[r]},setStyle:function(r,e){var t=Af.el,i=t.style;return i&&(i[r]=e,t.dirtyStyle&&t.dirtyStyle()),this},getStyle:function(r){var e=Af.el.style;if(e)return e[r]},setExtra:function(r,e){var t=Af.el.extra||(Af.el.extra={});return t[r]=e,this},getExtra:function(r){var e=Af.el.extra;if(e)return e[r]}};function Iwe(){var r=this,e=r.el;if(e){var t=J0(e).userDuring,i=r.userDuring;if(t!==i){r.el=r.userDuring=null;return}Af.el=e,i(Ewe)}}function oV(r,e,t,i){var n=t[r];if(n){var a=e[r],s;if(a){var o=t.transition,l=n.transition;if(l)if(!s&&(s=i[r]={}),sy(l))mt(s,a);else for(var c=Gi(l),f=0;f<c.length;f++){var p=c[f],y=a[p];s[p]=y}else if(sy(o)||Or(o,r)>=0){!s&&(s=i[r]={});for(var b=qr(a),f=0;f<b.length;f++){var p=b[f],y=a[p];kwe(n[p],y)&&(s[p]=y)}}}}}function sV(r,e,t){var i=e[r];if(i)for(var n=t[r]={},a=qr(i),s=0;s<a.length;s++){var o=a[s];n[o]=V1(i[o])}}function Pwe(r,e,t){for(var i=e.transition,n=sy(i)?Uf:Gi(i||[]),a=0;a<n.length;a++){var s=n[a];if(!(s==="style"||s==="shape"||s==="extra")){var o=r[s];t[s]=o}}}function Rwe(r,e,t){for(var i=0;i<aV.length;i++){var n=aV[i],a=CX[n],s=e[n];s&&(t[a[0]]=s[0],t[a[1]]=s[1])}for(var i=0;i<Uf.length;i++){var o=Uf[i];e[o]!=null&&(t[o]=e[o])}}function Dwe(r,e,t,i){if(t){var n=r.style,a;if(n){var s=t.transition,o=e.transition;if(s&&!sy(s)){var l=Gi(s);!a&&(a=i.style={});for(var c=0;c<l.length;c++){var f=l[c],p=n[f];a[f]=p}}else if(r.getAnimationStyleProps&&(sy(o)||sy(s)||Or(o,"style")>=0)){var y=r.getAnimationStyleProps(),b=y?y.style:null;if(b){!a&&(a=i.style={});for(var S=qr(t),c=0;c<S.length;c++){var f=S[c];if(b[f]){var p=n[f];a[f]=p}}}}}}}function kwe(r,e){return es(r)?r!==e:r!=null&&isFinite(r)}var EX=fi(),Lwe=["percent","easing","shape","style","extra"];function IX(r){r.stopAnimation("keyframe"),r.attr(EX(r))}function tC(r,e,t){if(!(!t.isAnimationEnabled()||!e)){if(xt(e)){se(e,function(o){tC(r,o,t)});return}var i=e.keyframes,n=e.duration;if(t&&n==null){var a=cb("enter",t,0);n=a&&a.duration}if(!(!i||!n)){var s=EX(r);se(eC,function(o){if(!(o&&!r[o])){var l;i.sort(function(c,f){return c.percent-f.percent}),se(i,function(c){var f=r.animators,p=o?c[o]:c;if(p){var y=qr(p);if(o||(y=wi(y,function(C){return Or(Lwe,C)<0})),!!y.length){l||(l=r.animate(o,e.loop,!0),l.scope="keyframe");for(var b=0;b<f.length;b++)f[b]!==l&&f[b].targetName===l.targetName&&f[b].stopTracks(y);o&&(s[o]=s[o]||{});var S=o?s[o]:s;se(y,function(C){S[C]=((o?r[o]:r)||{})[C]}),l.whenWithKeys(n*c.percent,p,y,c.easing)}}}),l&&l.delay(e.delay||0).duration(n).start(e.easing)}})}}}var sp="emphasis",Pg="normal",lO="blur",uO="select",Gg=[Pg,sp,lO,uO],yP={normal:["itemStyle"],emphasis:[sp,"itemStyle"],blur:[lO,"itemStyle"],select:[uO,"itemStyle"]},_P={normal:["label"],emphasis:[sp,"label"],blur:[lO,"label"],select:[uO,"label"]},Owe=["x","y"],Nwe="e\0\0",sc={normal:{},emphasis:{},blur:{},select:{}},Bwe={cartesian2d:mwe,geo:_we,single:xwe,polar:Swe,calendar:Twe};function K3(r){return r instanceof Xr}function Q3(r){return r instanceof Tc}function zwe(r,e){e.copyTransform(r),Q3(e)&&Q3(r)&&(e.setStyle(r.style),e.z=r.z,e.z2=r.z2,e.zlevel=r.zlevel,e.invisible=r.invisible,e.ignore=r.ignore,K3(e)&&K3(r)&&e.setShape(r.shape))}var Fwe=(function(r){Ye(e,r);function e(){var t=r!==null&&r.apply(this,arguments)||this;return t.type=e.type,t}return e.prototype.render=function(t,i,n,a){this._progressiveEls=null;var s=this._data,o=t.getData(),l=this.group,c=lV(t,o,i,n);s||l.removeAll(),o.diff(s).add(function(p){bP(n,null,p,c(p,a),t,l,o)}).remove(function(p){var y=s.getItemGraphicEl(p);y&&cM(y,op(y).option,t)}).update(function(p,y){var b=s.getItemGraphicEl(y);bP(n,b,p,c(p,a),t,l,o)}).execute();var f=t.get("clip",!0)?iS(t.coordinateSystem,!1,t):null;f?l.setClipPath(f):l.removeClipPath(),this._data=o},e.prototype.incrementalPrepareRender=function(t,i,n){this.group.removeAll(),this._data=null},e.prototype.incrementalRender=function(t,i,n,a,s){var o=i.getData(),l=lV(i,o,n,a),c=this._progressiveEls=[];function f(b){b.isGroup||(b.incremental=!0,b.ensureState("emphasis").hoverLayer=!0)}for(var p=t.start;p<t.end;p++){var y=bP(null,null,p,l(p,s),i,this.group,o);y&&(y.traverse(f),c.push(y))}},e.prototype.eachRendered=function(t){qg(this._progressiveEls||this.group,t)},e.prototype.filterForExposedEvent=function(t,i,n,a){var s=i.element;if(s==null||n.name===s)return!0;for(;(n=n.__hostTarget||n.parent)&&n!==this.group;)if(n.name===s)return!0;return!1},e.type="custom",e})(Fi);function cO(r){var e=r.type,t;if(e==="path"){var i=r.shape,n=i.width!=null&&i.height!=null?{x:i.x||0,y:i.y||0,width:i.width,height:i.height}:null,a=DX(i);t=Yw(a,null,n,i.layout||"center"),op(t).customPathData=a}else if(e==="image")t=new go({}),op(t).customImagePath=r.style.image;else if(e==="text")t=new si({});else if(e==="group")t=new mr;else{if(e==="compoundPath")throw new Error('"compoundPath" is not supported yet.');var s=VC(e);if(!s){var o="";Pi(o)}t=new s}return op(t).customGraphicType=e,t.name=r.name,t.z2EmphasisLift=1,t.z2SelectLift=1,t}function hO(r,e,t,i,n,a,s){IX(e);var o=n&&n.normal.cfg;o&&e.setTextConfig(o),i&&i.transition==null&&(i.transition=Owe);var l=i&&i.style;if(l){if(e.type==="text"){var c=l;Yt(c,"textFill")&&(c.fill=c.textFill),Yt(c,"textStroke")&&(c.stroke=c.textStroke)}var f=void 0,p=K3(e)?l.decal:null;r&&p&&(p.dirty=!0,f=q0(p,r)),l.__decalPattern=f}if(Q3(e)&&l){var f=l.__decalPattern;f&&(l.decal=f)}j2(e,i,a,{dataIndex:t,isInit:s,clearStyle:!0}),tC(e,i.keyframeAnimation,a)}function PX(r,e,t,i,n){var a=e.isGroup?null:e,s=n&&n[r].cfg;if(a){var o=a.ensureState(r);if(i===!1){var l=a.getState(r);l&&(l.style=null)}else o.style=i||null;s&&(o.textConfig=s),_y(a)}}function Vwe(r,e,t){if(!r.isGroup){var i=r,n=t.currentZ,a=t.currentZLevel;i.z=n,i.zlevel=a;var s=e.z2;s!=null&&(i.z2=s||0);for(var o=0;o<Gg.length;o++)Uwe(i,e,Gg[o])}}function Uwe(r,e,t){var i=t===Pg,n=i?e:rC(e,t),a=n?n.z2:null,s;a!=null&&(s=i?r:r.ensureState(t),s.z2=a||0)}function lV(r,e,t,i){var n=r.get("renderItem"),a=r.coordinateSystem,s={};a&&(s=a.prepareCustoms?a.prepareCustoms(a):Bwe[a.type](a));for(var o=lr({getWidth:i.getWidth,getHeight:i.getHeight,getZr:i.getZr,getDevicePixelRatio:i.getDevicePixelRatio,value:F,style:$,ordinalRawValue:W,styleEmphasis:q,visual:te,barLayout:ae,currentSeriesIndices:de,font:ve},s.api||{}),l={context:{},seriesId:r.id,seriesName:r.name,seriesIndex:r.seriesIndex,coordSys:s.coordSys,dataInsideLength:e.count(),encode:Hwe(r.getData())},c,f,p={},y={},b={},S={},C=0;C<Gg.length;C++){var E=Gg[C];b[E]=r.getModel(yP[E]),S[E]=r.getModel(_P[E])}function P(ye){return ye===c?f||(f=e.getItemModel(ye)):e.getItemModel(ye)}function O(ye,Ae){return e.hasItemOption?ye===c?p[Ae]||(p[Ae]=P(ye).getModel(yP[Ae])):P(ye).getModel(yP[Ae]):b[Ae]}function B(ye,Ae){return e.hasItemOption?ye===c?y[Ae]||(y[Ae]=P(ye).getModel(_P[Ae])):P(ye).getModel(_P[Ae]):S[Ae]}return function(ye,Ae){return c=ye,f=null,p={},y={},n&&n(lr({dataIndexInside:ye,dataIndex:e.getRawIndex(ye),actionType:Ae?Ae.type:null},l),o)};function F(ye,Ae){return Ae==null&&(Ae=c),e.getStore().get(e.getDimensionIndex(ye||0),Ae)}function W(ye,Ae){Ae==null&&(Ae=c),ye=ye||0;var me=e.getDimensionInfo(ye);if(!me){var De=e.getDimensionIndex(ye);return De>=0?e.getStore().get(De,Ae):void 0}var Fe=e.get(me.name,Ae),je=me&&me.ordinalMeta;return je?je.categories[Fe]:Fe}function $(ye,Ae){Ae==null&&(Ae=c);var me=e.getItemVisual(Ae,"style"),De=me&&me.fill,Fe=me&&me.opacity,je=O(Ae,Pg).getItemStyle();De!=null&&(je.fill=De),Fe!=null&&(je.opacity=Fe);var ct={inheritColor:$t(De)?De:"#000"},xe=B(Ae,Pg),$e=cn(xe,null,ct,!1,!0);$e.text=xe.getShallow("show")?wr(r.getFormattedLabel(Ae,Pg),Y0(e,Ae)):null;var pt=PA(xe,ct,!1);return ee(ye,je),je=iV(je,$e,pt),ye&&Q(je,ye),je.legacy=!0,je}function q(ye,Ae){Ae==null&&(Ae=c);var me=O(Ae,sp).getItemStyle(),De=B(Ae,sp),Fe=cn(De,null,null,!0,!0);Fe.text=De.getShallow("show")?Th(r.getFormattedLabel(Ae,sp),r.getFormattedLabel(Ae,Pg),Y0(e,Ae)):null;var je=PA(De,null,!0);return ee(ye,me),me=iV(me,Fe,je),ye&&Q(me,ye),me.legacy=!0,me}function Q(ye,Ae){for(var me in Ae)Yt(Ae,me)&&(ye[me]=Ae[me])}function ee(ye,Ae){ye&&(ye.textFill&&(Ae.textFill=ye.textFill),ye.textPosition&&(Ae.textPosition=ye.textPosition))}function te(ye,Ae){if(Ae==null&&(Ae=c),Yt(tV,ye)){var me=e.getItemVisual(Ae,"style");return me?me[tV[ye]]:null}if(Yt(pwe,ye))return e.getItemVisual(Ae,ye)}function ae(ye){if(a.type==="cartesian2d"){var Ae=a.getBaseAxis();return mge(lr({axis:Ae},ye))}}function de(){return t.getCurrentSeriesIndices()}function ve(ye){return $k(ye,t)}}function Hwe(r){var e={};return se(r.dimensions,function(t){var i=r.getDimensionInfo(t);if(!i.isExtraCoord){var n=i.coordDim,a=e[n]=e[n]||[];a[i.coordDimIndex]=r.getDimensionIndex(t)}}),e}function bP(r,e,t,i,n,a,s){if(!i){a.remove(e);return}var o=fO(r,e,t,i,n,a);return o&&s.setItemGraphicEl(t,o),o&&Hn(o,i.focus,i.blurScope,i.emphasisDisabled),o}function fO(r,e,t,i,n,a){var s=-1,o=e;e&&RX(e,i,n)&&(s=Or(a.childrenRef(),e),e=null);var l=!e,c=e;c?c.clearStates():(c=cO(i),o&&zwe(o,c)),i.morph===!1?c.disableMorphing=!0:c.disableMorphing&&(c.disableMorphing=!1),sc.normal.cfg=sc.normal.conOpt=sc.emphasis.cfg=sc.emphasis.conOpt=sc.blur.cfg=sc.blur.conOpt=sc.select.cfg=sc.select.conOpt=null,sc.isLegacy=!1,$we(c,t,i,n,l,sc),jwe(c,t,i,n,l),hO(r,c,t,i,sc,n,l),Yt(i,"info")&&(op(c).info=i.info);for(var f=0;f<Gg.length;f++){var p=Gg[f];if(p!==Pg){var y=rC(i,p),b=dO(i,y,p);PX(p,c,y,b,sc)}}return Vwe(c,i,n),i.type==="group"&&Wwe(r,c,t,i,n),s>=0?a.replaceAt(c,s):a.add(c),c}function RX(r,e,t){var i=op(r),n=e.type,a=e.shape,s=e.style;return t.isUniversalTransitionEnabled()||n!=null&&n!==i.customGraphicType||n==="path"&&qwe(a)&&DX(a)!==i.customPathData||n==="image"&&Yt(s,"image")&&s.image!==i.customImagePath}function jwe(r,e,t,i,n){var a=t.clipPath;if(a===!1)r&&r.getClipPath()&&r.removeClipPath();else if(a){var s=r.getClipPath();s&&RX(s,a,i)&&(s=null),s||(s=cO(a),r.setClipPath(s)),hO(null,s,e,a,null,i,n)}}function $we(r,e,t,i,n,a){if(!r.isGroup){uV(t,null,a),uV(t,sp,a);var s=a.normal.conOpt,o=a.emphasis.conOpt,l=a.blur.conOpt,c=a.select.conOpt;if(s!=null||o!=null||c!=null||l!=null){var f=r.getTextContent();if(s===!1)f&&r.removeTextContent();else{s=a.normal.conOpt=s||{type:"text"},f?f.clearStates():(f=cO(s),r.setTextContent(f)),hO(null,f,e,s,null,i,n);for(var p=s&&s.style,y=0;y<Gg.length;y++){var b=Gg[y];if(b!==Pg){var S=a[b].conOpt;PX(b,f,S,dO(s,S,b),null)}}p?f.dirty():f.markRedraw()}}}}function uV(r,e,t){var i=e?rC(r,e):r,n=e?dO(r,i,sp):r.style,a=r.type,s=i?i.textConfig:null,o=r.textContent,l=o?e?rC(o,e):o:null;if(n&&(t.isLegacy||TX(n,a,!!s,!!l))){t.isLegacy=!0;var c=AX(n,a,!e);!s&&c.textConfig&&(s=c.textConfig),!l&&c.textContent&&(l=c.textContent)}if(!e&&l){var f=l;!f.type&&(f.type="text")}var p=e?t[e]:t.normal;p.cfg=s,p.conOpt=l}function rC(r,e){return e?r?r[e]:null:r}function dO(r,e,t){var i=e&&e.style;return i==null&&t===sp&&r&&(i=r.styleEmphasis),i}function Wwe(r,e,t,i,n){var a=i.children,s=a?a.length:0,o=i.$mergeChildren,l=o==="byName"||i.diffChildrenByName,c=o===!1;if(!(!s&&!l&&!c)){if(l){Xwe({api:r,oldChildren:e.children()||[],newChildren:a||[],dataIndex:t,seriesModel:n,group:e});return}c&&e.removeAll();for(var f=0;f<s;f++){var p=a[f],y=e.childAt(f);p?(p.ignore==null&&(p.ignore=!1),fO(r,y,t,p,n,e)):y.ignore=!0}for(var b=e.childCount()-1;b>=f;b--){var S=e.childAt(b);Gwe(e,S,n)}}}function Gwe(r,e,t){e&&cM(e,op(r).option,t)}function Xwe(r){new fp(r.oldChildren,r.newChildren,cV,cV,r).add(hV).update(hV).remove(Zwe).execute()}function cV(r,e){var t=r&&r.name;return t??Nwe+e}function hV(r,e){var t=this.context,i=r!=null?t.newChildren[r]:null,n=e!=null?t.oldChildren[e]:null;fO(t.api,n,t.dataIndex,i,t.seriesModel,t.group)}function Zwe(r){var e=this.context,t=e.oldChildren[r];t&&cM(t,op(t).option,e.seriesModel)}function DX(r){return r&&(r.pathData||r.d)}function qwe(r){return r&&(Yt(r,"pathData")||Yt(r,"d"))}function Ywe(r){r.registerChartView(Fwe),r.registerSeriesModel(gwe)}var Nm=fi(),fV=hr,xP=Xt,pO=(function(){function r(){this._dragging=!1,this.animationThreshold=15}return r.prototype.render=function(e,t,i,n){var a=t.get("value"),s=t.get("status");if(this._axisModel=e,this._axisPointerModel=t,this._api=i,!(!n&&this._lastValue===a&&this._lastStatus===s)){this._lastValue=a,this._lastStatus=s;var o=this._group,l=this._handle;if(!s||s==="hide"){o&&o.hide(),l&&l.hide();return}o&&o.show(),l&&l.show();var c={};this.makeElOption(c,a,e,t,i);var f=c.graphicKey;f!==this._lastGraphicKey&&this.clear(i),this._lastGraphicKey=f;var p=this._moveAnimation=this.determineAnimation(e,t);if(!o)o=this._group=new mr,this.createPointerEl(o,c,e,t),this.createLabelEl(o,c,e,t),i.getZr().add(o);else{var y=Sr(dV,t,p);this.updatePointerEl(o,c,y),this.updateLabelEl(o,c,y,t)}gV(o,t,!0),this._renderHandle(a)}},r.prototype.remove=function(e){this.clear(e)},r.prototype.dispose=function(e){this.clear(e)},r.prototype.determineAnimation=function(e,t){var i=t.get("animation"),n=e.axis,a=n.type==="category",s=t.get("snap");if(!s&&!a)return!1;if(i==="auto"||i==null){var o=this.animationThreshold;if(a&&n.getBandWidth()>o)return!0;if(s){var l=NL(e).seriesDataCount,c=n.getExtent();return Math.abs(c[0]-c[1])/l>o}return!1}return i===!0},r.prototype.makeElOption=function(e,t,i,n,a){},r.prototype.createPointerEl=function(e,t,i,n){var a=t.pointer;if(a){var s=Nm(e).pointerEl=new Py[a.type](fV(t.pointer));e.add(s)}},r.prototype.createLabelEl=function(e,t,i,n){if(t.label){var a=Nm(e).labelEl=new si(fV(t.label));e.add(a),pV(a,n)}},r.prototype.updatePointerEl=function(e,t,i){var n=Nm(e).pointerEl;n&&t.pointer&&(n.setStyle(t.pointer.style),i(n,{shape:t.pointer.shape}))},r.prototype.updateLabelEl=function(e,t,i,n){var a=Nm(e).labelEl;a&&(a.setStyle(t.label.style),i(a,{x:t.label.x,y:t.label.y}),pV(a,n))},r.prototype._renderHandle=function(e){if(!(this._dragging||!this.updateHandleTransform)){var t=this._axisPointerModel,i=this._api.getZr(),n=this._handle,a=t.getModel("handle"),s=t.get("status");if(!a.get("show")||!s||s==="hide"){n&&i.remove(n),this._handle=null;return}var o;this._handle||(o=!0,n=this._handle=hb(a.get("icon"),{cursor:"move",draggable:!0,onmousemove:function(c){up(c.event)},onmousedown:xP(this._onHandleDragMove,this,0,0),drift:xP(this._onHandleDragMove,this),ondragend:xP(this._onHandleDragEnd,this)}),i.add(n)),gV(n,t,!1),n.setStyle(a.getItemStyle(null,["color","borderColor","borderWidth","opacity","shadowColor","shadowBlur","shadowOffsetX","shadowOffsetY"]));var l=a.get("size");xt(l)||(l=[l,l]),n.scaleX=l[0]/2,n.scaleY=l[1]/2,yb(this,"_doDispatchAxisPointer",a.get("throttle")||0,"fixRate"),this._moveHandleToValue(e,o)}},r.prototype._moveHandleToValue=function(e,t){dV(this._axisPointerModel,!t&&this._moveAnimation,this._handle,wP(this.getHandleTransform(e,this._axisModel,this._axisPointerModel)))},r.prototype._onHandleDragMove=function(e,t){var i=this._handle;if(i){this._dragging=!0;var n=this.updateHandleTransform(wP(i),[e,t],this._axisModel,this._axisPointerModel);this._payloadInfo=n,i.stopAnimation(),i.attr(wP(n)),Nm(i).lastProp=null,this._doDispatchAxisPointer()}},r.prototype._doDispatchAxisPointer=function(){var e=this._handle;if(e){var t=this._payloadInfo,i=this._axisModel;this._api.dispatchAction({type:"updateAxisPointer",x:t.cursorPoint[0],y:t.cursorPoint[1],tooltipOption:t.tooltipOption,axesInfo:[{axisDim:i.axis.dim,axisIndex:i.componentIndex}]})}},r.prototype._onHandleDragEnd=function(){this._dragging=!1;var e=this._handle;if(e){var t=this._axisPointerModel.get("value");this._moveHandleToValue(t),this._api.dispatchAction({type:"hideTip"})}},r.prototype.clear=function(e){this._lastValue=null,this._lastStatus=null;var t=e.getZr(),i=this._group,n=this._handle;t&&i&&(this._lastGraphicKey=null,i&&t.remove(i),n&&t.remove(n),this._group=null,this._handle=null,this._payloadInfo=null),bw(this,"_doDispatchAxisPointer")},r.prototype.doClear=function(){},r.prototype.buildLabel=function(e,t,i){return i=i||0,{x:e[i],y:e[1-i],width:t[i],height:t[1-i]}},r})();function dV(r,e,t,i){kX(Nm(t).lastProp,i)||(Nm(t).lastProp=i,e?vi(t,i,r):(t.stopAnimation(),t.attr(i)))}function kX(r,e){if(cr(r)&&cr(e)){var t=!0;return se(e,function(i,n){t=t&&kX(r[n],i)}),!!t}else return r===e}function pV(r,e){r[e.get(["label","show"])?"show":"hide"]()}function wP(r){return{x:r.x||0,y:r.y||0,rotation:r.rotation||0}}function gV(r,e,t){var i=e.get("z"),n=e.get("zlevel");r&&r.traverse(function(a){a.type!=="group"&&(i!=null&&(a.z=i),n!=null&&(a.zlevel=n),a.silent=t)})}function gO(r){var e=r.get("type"),t=r.getModel(e+"Style"),i;return e==="line"?(i=t.getLineStyle(),i.fill=null):e==="shadow"&&(i=t.getAreaStyle(),i.stroke=null),i}function LX(r,e,t,i,n){var a=t.get("value"),s=OX(a,e.axis,e.ecModel,t.get("seriesDataIndices"),{precision:t.get(["label","precision"]),formatter:t.get(["label","formatter"])}),o=t.getModel("label"),l=Ry(o.get("padding")||0),c=o.getFont(),f=Ww(s,c),p=n.position,y=f.width+l[1]+l[3],b=f.height+l[0]+l[2],S=n.align;S==="right"&&(p[0]-=y),S==="center"&&(p[0]-=y/2);var C=n.verticalAlign;C==="bottom"&&(p[1]-=b),C==="middle"&&(p[1]-=b/2),Kwe(p,y,b,i);var E=o.get("backgroundColor");(!E||E==="auto")&&(E=e.get(["axisLine","lineStyle","color"])),r.label={x:p[0],y:p[1],style:cn(o,{text:s,font:c,fill:o.getTextColor(),padding:l,backgroundColor:E}),z2:10}}function Kwe(r,e,t,i){var n=i.getWidth(),a=i.getHeight();r[0]=Math.min(r[0]+e,n)-e,r[1]=Math.min(r[1]+t,a)-t,r[0]=Math.max(r[0],0),r[1]=Math.max(r[1],0)}function OX(r,e,t,i,n){r=e.scale.parse(r);var a=e.scale.getLabel({value:r},{precision:n.precision}),s=n.formatter;if(s){var o={value:AL(e,{value:r}),axisDimension:e.dim,axisIndex:e.index,seriesData:[]};se(i,function(l){var c=t.getSeriesByIndex(l.seriesIndex),f=l.dataIndexInside,p=c&&c.getDataParams(f);p&&o.seriesData.push(p)}),$t(s)?a=s.replace("{value}",a):sr(s)&&(a=s(o))}return a}function vO(r,e,t){var i=kl();return Zg(i,i,t.rotation),Ph(i,i,t.position),Mh([r.dataToCoord(e),(t.labelOffset||0)+(t.labelDirection||1)*(t.labelMargin||0)],i)}function NX(r,e,t,i,n,a){var s=ol.innerTextLayout(t.rotation,0,t.labelDirection);t.labelMargin=n.get(["label","margin"]),LX(e,i,n,a,{position:vO(i.axis,r,t),align:s.textAlign,verticalAlign:s.textVerticalAlign})}function mO(r,e,t){return t=t||0,{x1:r[t],y1:r[1-t],x2:e[t],y2:e[1-t]}}function BX(r,e,t){return t=t||0,{x:r[t],y:r[1-t],width:e[t],height:e[1-t]}}function vV(r,e,t,i,n,a){return{cx:r,cy:e,r0:t,r:i,startAngle:n,endAngle:a,clockwise:!0}}var Qwe=(function(r){Ye(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.makeElOption=function(t,i,n,a,s){var o=n.axis,l=o.grid,c=a.get("type"),f=mV(l,o).getOtherAxis(o).getGlobalExtent(),p=o.toGlobalCoord(o.dataToCoord(i,!0));if(c&&c!=="none"){var y=gO(a),b=Jwe[c](o,p,f);b.style=y,t.graphicKey=b.type,t.pointer=b}var S=D3(l.model,n);NX(i,t,S,n,a,s)},e.prototype.getHandleTransform=function(t,i,n){var a=D3(i.axis.grid.model,i,{labelInside:!1});a.labelMargin=n.get(["handle","margin"]);var s=vO(i.axis,t,a);return{x:s[0],y:s[1],rotation:a.rotation+(a.labelDirection<0?Math.PI:0)}},e.prototype.updateHandleTransform=function(t,i,n,a){var s=n.axis,o=s.grid,l=s.getGlobalExtent(!0),c=mV(o,s).getOtherAxis(s).getGlobalExtent(),f=s.dim==="x"?0:1,p=[t.x,t.y];p[f]+=i[f],p[f]=Math.min(l[1],p[f]),p[f]=Math.max(l[0],p[f]);var y=(c[1]+c[0])/2,b=[y,y];b[f]=p[f];var S=[{verticalAlign:"middle"},{align:"center"}];return{x:p[0],y:p[1],rotation:t.rotation,cursorPoint:b,tooltipOption:S[f]}},e})(pO);function mV(r,e){var t={};return t[e.dim+"AxisIndex"]=e.index,r.getCartesian(t)}var Jwe={line:function(r,e,t){var i=mO([e,t[0]],[e,t[1]],yV(r));return{type:"Line",subPixelOptimize:!0,shape:i}},shadow:function(r,e,t){var i=Math.max(1,r.getBandWidth()),n=t[1]-t[0];return{type:"Rect",shape:BX([e-i/2,t[0]],[i,n],yV(r))}}};function yV(r){return r.dim==="x"?0:1}var eSe=(function(r){Ye(e,r);function e(){var t=r!==null&&r.apply(this,arguments)||this;return t.type=e.type,t}return e.type="axisPointer",e.defaultOption={show:"auto",z:50,type:"line",snap:!1,triggerTooltip:!0,triggerEmphasis:!0,value:null,status:null,link:[],animation:null,animationDurationUpdate:200,lineStyle:{color:"#B9BEC9",width:1,type:"dashed"},shadowStyle:{color:"rgba(210,219,238,0.2)"},label:{show:!0,formatter:null,precision:"auto",margin:3,color:"#fff",padding:[5,7,5,7],backgroundColor:"auto",borderColor:null,borderWidth:0,borderRadius:3},handle:{show:!1,icon:"M10.7,11.9v-1.3H9.3v1.3c-4.9,0.3-8.8,4.4-8.8,9.4c0,5,3.9,9.1,8.8,9.4h1.3c4.9-0.3,8.8-4.4,8.8-9.4C19.5,16.3,15.6,12.2,10.7,11.9z M13.3,24.4H6.7v-1.2h6.6z M13.3,22H6.7v-1.2h6.6z M13.3,19.6H6.7v-1.2h6.6z",size:45,margin:50,color:"#333",shadowBlur:3,shadowColor:"#aaa",shadowOffsetX:0,shadowOffsetY:2,throttle:40}},e})(Wr),ap=fi(),tSe=se;function zX(r,e,t){if(!Gr.node){var i=e.getZr();ap(i).records||(ap(i).records={}),rSe(i,e);var n=ap(i).records[r]||(ap(i).records[r]={});n.handler=t}}function rSe(r,e){if(ap(r).initialized)return;ap(r).initialized=!0,t("click",Sr(_V,"click")),t("mousemove",Sr(_V,"mousemove")),t("globalout",nSe);function t(i,n){r.on(i,function(a){var s=aSe(e);tSe(ap(r).records,function(o){o&&n(o,a,s.dispatchAction)}),iSe(s.pendings,e)})}}function iSe(r,e){var t=r.showTip.length,i=r.hideTip.length,n;t?n=r.showTip[t-1]:i&&(n=r.hideTip[i-1]),n&&(n.dispatchAction=null,e.dispatchAction(n))}function nSe(r,e,t){r.handler("leave",null,t)}function _V(r,e,t,i){e.handler(r,t,i)}function aSe(r){var e={showTip:[],hideTip:[]},t=function(i){var n=e[i.type];n?n.push(i):(i.dispatchAction=t,r.dispatchAction(i))};return{dispatchAction:t,pendings:e}}function J3(r,e){if(!Gr.node){var t=e.getZr(),i=(ap(t).records||{})[r];i&&(ap(t).records[r]=null)}}var oSe=(function(r){Ye(e,r);function e(){var t=r!==null&&r.apply(this,arguments)||this;return t.type=e.type,t}return e.prototype.render=function(t,i,n){var a=i.getComponent("tooltip"),s=t.get("triggerOn")||a&&a.get("triggerOn")||"mousemove|click";zX("axisPointer",n,function(o,l,c){s!=="none"&&(o==="leave"||s.indexOf(o)>=0)&&c({type:"updateAxisPointer",currTrigger:o,x:l&&l.offsetX,y:l&&l.offsetY})})},e.prototype.remove=function(t,i){J3("axisPointer",i)},e.prototype.dispose=function(t,i){J3("axisPointer",i)},e.type="axisPointer",e})(vn);function FX(r,e){var t=[],i=r.seriesIndex,n;if(i==null||!(n=e.getSeriesByIndex(i)))return{point:[]};var a=n.getData(),s=my(a,r);if(s==null||s<0||xt(s))return{point:[]};var o=a.getItemGraphicEl(s),l=n.coordinateSystem;if(n.getTooltipPosition)t=n.getTooltipPosition(s)||[];else if(l&&l.dataToPoint)if(r.isStacked){var c=l.getBaseAxis(),f=l.getOtherAxis(c),p=f.dim,y=c.dim,b=p==="x"||p==="radius"?1:0,S=a.mapDimension(y),C=[];C[b]=a.get(S,s),C[1-b]=a.get(a.getCalculationInfo("stackResultDimension"),s),t=l.dataToPoint(C)||[]}else t=l.dataToPoint(a.getValues(wt(l.dimensions,function(P){return a.mapDimension(P)}),s))||[];else if(o){var E=o.getBoundingRect().clone();E.applyTransform(o.transform),t=[E.x+E.width/2,E.y+E.height/2]}return{point:t,el:o}}var bV=fi();function sSe(r,e,t){var i=r.currTrigger,n=[r.x,r.y],a=r,s=r.dispatchAction||Xt(t.dispatchAction,t),o=e.getComponent("axisPointer").coordSysAxesInfo;if(o){$2(n)&&(n=FX({seriesIndex:a.seriesIndex,dataIndex:a.dataIndex},e).point);var l=$2(n),c=a.axesInfo,f=o.axesInfo,p=i==="leave"||$2(n),y={},b={},S={list:[],map:{}},C={showPointer:Sr(uSe,b),showTooltip:Sr(cSe,S)};se(o.coordSysMap,function(P,O){var B=l||P.containPoint(n);se(o.coordSysAxesInfo[O],function(F,W){var $=F.axis,q=pSe(c,F);if(!p&&B&&(!c||q)){var Q=q&&q.value;Q==null&&!l&&(Q=$.pointToData(n)),Q!=null&&xV(F,Q,C,!1,y)}})});var E={};return se(f,function(P,O){var B=P.linkGroup;B&&!b[O]&&se(B.axesInfo,function(F,W){var $=b[W];if(F!==P&&$){var q=$.value;B.mapper&&(q=P.axis.scale.parse(B.mapper(q,wV(F),wV(P)))),E[P.key]=q}})}),se(E,function(P,O){xV(f[O],P,C,!0,y)}),hSe(b,f,y),fSe(S,n,r,s),dSe(f,s,t),y}}function xV(r,e,t,i,n){var a=r.axis;if(!(a.scale.isBlank()||!a.containData(e))){if(!r.involveSeries){t.showPointer(r,e);return}var s=lSe(e,r),o=s.payloadBatch,l=s.snapToValue;o[0]&&n.seriesIndex==null&&mt(n,o[0]),!i&&r.snap&&a.containData(l)&&l!=null&&(e=l),t.showPointer(r,e,o),t.showTooltip(r,s,l)}}function lSe(r,e){var t=e.axis,i=t.dim,n=r,a=[],s=Number.MAX_VALUE,o=-1;return se(e.seriesModels,function(l,c){var f=l.getData().mapDimensionsAll(i),p,y;if(l.getAxisTooltipData){var b=l.getAxisTooltipData(f,r,t);y=b.dataIndices,p=b.nestestValue}else{if(y=l.getData().indicesOfNearest(f[0],r,t.type==="category"?.5:null),!y.length)return;p=l.getData().get(f[0],y[0])}if(!(p==null||!isFinite(p))){var S=r-p,C=Math.abs(S);C<=s&&((C<s||S>=0&&o<0)&&(s=C,o=S,n=p,a.length=0),se(y,function(E){a.push({seriesIndex:l.seriesIndex,dataIndexInside:E,dataIndex:l.getData().getRawIndex(E)})}))}}),{payloadBatch:a,snapToValue:n}}function uSe(r,e,t,i){r[e.key]={value:t,payloadBatch:i}}function cSe(r,e,t,i){var n=t.payloadBatch,a=e.axis,s=a.model,o=e.axisPointerModel;if(!(!e.triggerTooltip||!n.length)){var l=e.coordSys.model,c=Mw(l),f=r.map[c];f||(f=r.map[c]={coordSysId:l.id,coordSysIndex:l.componentIndex,coordSysType:l.type,coordSysMainType:l.mainType,dataByAxis:[]},r.list.push(f)),f.dataByAxis.push({axisDim:a.dim,axisIndex:s.componentIndex,axisType:s.type,axisId:s.id,value:i,valueLabelOpt:{precision:o.get(["label","precision"]),formatter:o.get(["label","formatter"])},seriesDataIndices:n.slice()})}}function hSe(r,e,t){var i=t.axesInfo=[];se(e,function(n,a){var s=n.axisPointerModel.option,o=r[a];o?(!n.useHandle&&(s.status="show"),s.value=o.value,s.seriesDataIndices=(o.payloadBatch||[]).slice()):!n.useHandle&&(s.status="hide"),s.status==="show"&&i.push({axisDim:n.axis.dim,axisIndex:n.axis.model.componentIndex,value:s.value})})}function fSe(r,e,t,i){if($2(e)||!r.list.length){i({type:"hideTip"});return}var n=((r.list[0].dataByAxis[0]||{}).seriesDataIndices||[])[0]||{};i({type:"showTip",escapeConnect:!0,x:e[0],y:e[1],tooltipOption:t.tooltipOption,position:t.position,dataIndexInside:n.dataIndexInside,dataIndex:n.dataIndex,seriesIndex:n.seriesIndex,dataByCoordSys:r.list})}function dSe(r,e,t){var i=t.getZr(),n="axisPointerLastHighlights",a=bV(i)[n]||{},s=bV(i)[n]={};se(r,function(c,f){var p=c.axisPointerModel.option;p.status==="show"&&c.triggerEmphasis&&se(p.seriesDataIndices,function(y){var b=y.seriesIndex+" | "+y.dataIndex;s[b]=y})});var o=[],l=[];se(a,function(c,f){!s[f]&&l.push(c)}),se(s,function(c,f){!a[f]&&o.push(c)}),l.length&&t.dispatchAction({type:"downplay",escapeConnect:!0,notBlur:!0,batch:l}),o.length&&t.dispatchAction({type:"highlight",escapeConnect:!0,notBlur:!0,batch:o})}function pSe(r,e){for(var t=0;t<(r||[]).length;t++){var i=r[t];if(e.axis.dim===i.axisDim&&e.axis.model.componentIndex===i.axisIndex)return i}}function wV(r){var e=r.axis.model,t={},i=t.axisDim=r.axis.dim;return t.axisIndex=t[i+"AxisIndex"]=e.componentIndex,t.axisName=t[i+"AxisName"]=e.name,t.axisId=t[i+"AxisId"]=e.id,t}function $2(r){return!r||r[0]==null||isNaN(r[0])||r[1]==null||isNaN(r[1])}function uS(r){Ly.registerAxisPointerClass("CartesianAxisPointer",Qwe),r.registerComponentModel(eSe),r.registerComponentView(oSe),r.registerPreprocessor(function(e){if(e){(!e.axisPointer||e.axisPointer.length===0)&&(e.axisPointer={});var t=e.axisPointer.link;t&&!xt(t)&&(e.axisPointer.link=[t])}}),r.registerProcessor(r.PRIORITY.PROCESSOR.STATISTIC,function(e,t){e.getComponent("axisPointer").coordSysAxesInfo=Tye(e,t)}),r.registerAction({type:"updateAxisPointer",event:"updateAxisPointer",update:":updateAxisPointer"},sSe)}function gSe(r){Vr(dG),Vr(uS)}var vSe=(function(r){Ye(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.makeElOption=function(t,i,n,a,s){var o=n.axis;o.dim==="angle"&&(this.animationThreshold=Math.PI/18);var l=o.polar,c=l.getOtherAxis(o),f=c.getExtent(),p=o.dataToCoord(i),y=a.get("type");if(y&&y!=="none"){var b=gO(a),S=ySe[y](o,l,p,f);S.style=b,t.graphicKey=S.type,t.pointer=S}var C=a.get(["label","margin"]),E=mSe(i,n,a,l,C);LX(t,n,a,s,E)},e})(pO);function mSe(r,e,t,i,n){var a=e.axis,s=a.dataToCoord(r),o=i.getAngleAxis().getExtent()[0];o=o/180*Math.PI;var l=i.getRadiusAxis().getExtent(),c,f,p;if(a.dim==="radius"){var y=kl();Zg(y,y,o),Ph(y,y,[i.cx,i.cy]),c=Mh([s,-n],y);var b=e.getModel("axisLabel").get("rotate")||0,S=ol.innerTextLayout(o,b*Math.PI/180,-1);f=S.textAlign,p=S.textVerticalAlign}else{var C=l[1];c=i.coordToPoint([C+n,s]);var E=i.cx,P=i.cy;f=Math.abs(c[0]-E)/C<.3?"center":c[0]>E?"left":"right",p=Math.abs(c[1]-P)/C<.3?"middle":c[1]>P?"top":"bottom"}return{position:c,align:f,verticalAlign:p}}var ySe={line:function(r,e,t,i){return r.dim==="angle"?{type:"Line",shape:mO(e.coordToPoint([i[0],t]),e.coordToPoint([i[1],t]))}:{type:"Circle",shape:{cx:e.cx,cy:e.cy,r:t}}},shadow:function(r,e,t,i){var n=Math.max(1,r.getBandWidth()),a=Math.PI/180;return r.dim==="angle"?{type:"Sector",shape:vV(e.cx,e.cy,i[0],i[1],(-t-n/2)*a,(-t+n/2)*a)}:{type:"Sector",shape:vV(e.cx,e.cy,t-n/2,t+n/2,0,Math.PI*2)}}},_Se=(function(r){Ye(e,r);function e(){var t=r!==null&&r.apply(this,arguments)||this;return t.type=e.type,t}return e.prototype.findAxisModel=function(t){var i,n=this.ecModel;return n.eachComponent(t,function(a){a.getCoordSysModel()===this&&(i=a)},this),i},e.type="polar",e.dependencies=["radiusAxis","angleAxis"],e.defaultOption={z:0,center:["50%","50%"],radius:"80%"},e})(Wr),yO=(function(r){Ye(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.getCoordSysModel=function(){return this.getReferringComponents("polar",ka).models[0]},e.type="polarAxis",e})(Wr);ha(yO,wb);var bSe=(function(r){Ye(e,r);function e(){var t=r!==null&&r.apply(this,arguments)||this;return t.type=e.type,t}return e.type="angleAxis",e})(yO),xSe=(function(r){Ye(e,r);function e(){var t=r!==null&&r.apply(this,arguments)||this;return t.type=e.type,t}return e.type="radiusAxis",e})(yO),_O=(function(r){Ye(e,r);function e(t,i){return r.call(this,"radius",t,i)||this}return e.prototype.pointToData=function(t,i){return this.polar.pointToData(t,i)[this.dim==="radius"?0:1]},e})(Pc);_O.prototype.dataToRadius=Pc.prototype.dataToCoord;_O.prototype.radiusToData=Pc.prototype.coordToData;var wSe=fi(),bO=(function(r){Ye(e,r);function e(t,i){return r.call(this,"angle",t,i||[0,360])||this}return e.prototype.pointToData=function(t,i){return this.polar.pointToData(t,i)[this.dim==="radius"?0:1]},e.prototype.calculateCategoryInterval=function(){var t=this,i=t.getLabelModel(),n=t.scale,a=n.getExtent(),s=n.count();if(a[1]-a[0]<1)return 0;var o=a[0],l=t.dataToCoord(o+1)-t.dataToCoord(o),c=Math.abs(l),f=Ww(o==null?"":o+"",i.getFont(),"center","top"),p=Math.max(f.height,7),y=p/c;isNaN(y)&&(y=1/0);var b=Math.max(0,Math.floor(y)),S=wSe(t.model),C=S.lastAutoInterval,E=S.lastTickCount;return C!=null&&E!=null&&Math.abs(C-b)<=1&&Math.abs(E-s)<=1&&C>b?b=C:(S.lastTickCount=s,S.lastAutoInterval=b),b},e})(Pc);bO.prototype.dataToAngle=Pc.prototype.dataToCoord;bO.prototype.angleToData=Pc.prototype.coordToData;var VX=["radius","angle"],SSe=(function(){function r(e){this.dimensions=VX,this.type="polar",this.cx=0,this.cy=0,this._radiusAxis=new _O,this._angleAxis=new bO,this.axisPointerEnabled=!0,this.name=e||"",this._radiusAxis.polar=this._angleAxis.polar=this}return r.prototype.containPoint=function(e){var t=this.pointToCoord(e);return this._radiusAxis.contain(t[0])&&this._angleAxis.contain(t[1])},r.prototype.containData=function(e){return this._radiusAxis.containData(e[0])&&this._angleAxis.containData(e[1])},r.prototype.getAxis=function(e){var t="_"+e+"Axis";return this[t]},r.prototype.getAxes=function(){return[this._radiusAxis,this._angleAxis]},r.prototype.getAxesByScale=function(e){var t=[],i=this._angleAxis,n=this._radiusAxis;return i.scale.type===e&&t.push(i),n.scale.type===e&&t.push(n),t},r.prototype.getAngleAxis=function(){return this._angleAxis},r.prototype.getRadiusAxis=function(){return this._radiusAxis},r.prototype.getOtherAxis=function(e){var t=this._angleAxis;return e===t?this._radiusAxis:t},r.prototype.getBaseAxis=function(){return this.getAxesByScale("ordinal")[0]||this.getAxesByScale("time")[0]||this.getAngleAxis()},r.prototype.getTooltipAxes=function(e){var t=e!=null&&e!=="auto"?this.getAxis(e):this.getBaseAxis();return{baseAxes:[t],otherAxes:[this.getOtherAxis(t)]}},r.prototype.dataToPoint=function(e,t){return this.coordToPoint([this._radiusAxis.dataToRadius(e[0],t),this._angleAxis.dataToAngle(e[1],t)])},r.prototype.pointToData=function(e,t){var i=this.pointToCoord(e);return[this._radiusAxis.radiusToData(i[0],t),this._angleAxis.angleToData(i[1],t)]},r.prototype.pointToCoord=function(e){var t=e[0]-this.cx,i=e[1]-this.cy,n=this.getAngleAxis(),a=n.getExtent(),s=Math.min(a[0],a[1]),o=Math.max(a[0],a[1]);n.inverse?s=o-360:o=s+360;var l=Math.sqrt(t*t+i*i);t/=l,i/=l;for(var c=Math.atan2(-i,t)/Math.PI*180,f=c<s?1:-1;c<s||c>o;)c+=f*360;return[l,c]},r.prototype.coordToPoint=function(e){var t=e[0],i=e[1]/180*Math.PI,n=Math.cos(i)*t+this.cx,a=-Math.sin(i)*t+this.cy;return[n,a]},r.prototype.getArea=function(){var e=this.getAngleAxis(),t=this.getRadiusAxis(),i=t.getExtent().slice();i[0]>i[1]&&i.reverse();var n=e.getExtent(),a=Math.PI/180,s=1e-4;return{cx:this.cx,cy:this.cy,r0:i[0],r:i[1],startAngle:-n[0]*a,endAngle:-n[1]*a,clockwise:e.inverse,contain:function(o,l){var c=o-this.cx,f=l-this.cy,p=c*c+f*f,y=this.r,b=this.r0;return y!==b&&p-s<=y*y&&p+s>=b*b}}},r.prototype.convertToPixel=function(e,t,i){var n=SV(t);return n===this?this.dataToPoint(i):null},r.prototype.convertFromPixel=function(e,t,i){var n=SV(t);return n===this?this.pointToData(i):null},r})();function SV(r){var e=r.seriesModel,t=r.polarModel;return t&&t.coordinateSystem||e&&e.coordinateSystem}function TSe(r,e,t){var i=e.get("center"),n=t.getWidth(),a=t.getHeight();r.cx=Vt(i[0],n),r.cy=Vt(i[1],a);var s=r.getRadiusAxis(),o=Math.min(n,a)/2,l=e.get("radius");l==null?l=[0,"100%"]:xt(l)||(l=[0,l]);var c=[Vt(l[0],o),Vt(l[1],o)];s.inverse?s.setExtent(c[1],c[0]):s.setExtent(c[0],c[1])}function ASe(r,e){var t=this,i=t.getAngleAxis(),n=t.getRadiusAxis();if(i.scale.setExtent(1/0,-1/0),n.scale.setExtent(1/0,-1/0),r.eachSeries(function(o){if(o.coordinateSystem===t){var l=o.getData();se(jA(l,"radius"),function(c){n.scale.unionExtentFromData(l,c)}),se(jA(l,"angle"),function(c){i.scale.unionExtentFromData(l,c)})}}),xy(i.scale,i.model),xy(n.scale,n.model),i.type==="category"&&!i.onBand){var a=i.getExtent(),s=360/i.scale.count();i.inverse?a[1]+=s:a[1]-=s,i.setExtent(a[0],a[1])}}function CSe(r){return r.mainType==="angleAxis"}function TV(r,e){var t;if(r.type=e.get("type"),r.scale=eS(e),r.onBand=e.get("boundaryGap")&&r.type==="category",r.inverse=e.get("inverse"),CSe(e)){r.inverse=r.inverse!==e.get("clockwise");var i=e.get("startAngle"),n=(t=e.get("endAngle"))!==null&&t!==void 0?t:i+(r.inverse?-360:360);r.setExtent(i,n)}e.axis=r,r.model=e}var MSe={dimensions:VX,create:function(r,e){var t=[];return r.eachComponent("polar",function(i,n){var a=new SSe(n+"");a.update=ASe;var s=a.getRadiusAxis(),o=a.getAngleAxis(),l=i.findAxisModel("radiusAxis"),c=i.findAxisModel("angleAxis");TV(s,l),TV(o,c),TSe(a,i,e),t.push(a),i.coordinateSystem=a,a.model=i}),r.eachSeries(function(i){if(i.get("coordinateSystem")==="polar"){var n=i.getReferringComponents("polar",ka).models[0];i.coordinateSystem=n.coordinateSystem}}),t}},ESe=["axisLine","axisLabel","axisTick","minorTick","splitLine","minorSplitLine","splitArea"];function l2(r,e,t){e[1]>e[0]&&(e=e.slice().reverse());var i=r.coordToPoint([e[0],t]),n=r.coordToPoint([e[1],t]);return{x1:i[0],y1:i[1],x2:n[0],y2:n[1]}}function u2(r){var e=r.getRadiusAxis();return e.inverse?0:1}function AV(r){var e=r[0],t=r[r.length-1];e&&t&&Math.abs(Math.abs(e.coord-t.coord)-360)<1e-4&&r.pop()}var ISe=(function(r){Ye(e,r);function e(){var t=r!==null&&r.apply(this,arguments)||this;return t.type=e.type,t.axisPointerClass="PolarAxisPointer",t}return e.prototype.render=function(t,i){if(this.group.removeAll(),!!t.get("show")){var n=t.axis,a=n.polar,s=a.getRadiusAxis().getExtent(),o=n.getTicksCoords(),l=n.getMinorTicksCoords(),c=wt(n.getViewLabels(),function(f){f=hr(f);var p=n.scale,y=p.type==="ordinal"?p.getRawOrdinalNumber(f.tickValue):f.tickValue;return f.coord=n.dataToCoord(y),f});AV(c),AV(o),se(ESe,function(f){t.get([f,"show"])&&(!n.scale.isBlank()||f==="axisLine")&&PSe[f](this.group,t,a,o,l,s,c)},this)}},e.type="angleAxis",e})(Ly),PSe={axisLine:function(r,e,t,i,n,a){var s=e.getModel(["axisLine","lineStyle"]),o=t.getAngleAxis(),l=Math.PI/180,c=o.getExtent(),f=u2(t),p=f?0:1,y,b=Math.abs(c[1]-c[0])===360?"Circle":"Arc";a[p]===0?y=new Py[b]({shape:{cx:t.cx,cy:t.cy,r:a[f],startAngle:-c[0]*l,endAngle:-c[1]*l,clockwise:o.inverse},style:s.getLineStyle(),z2:1,silent:!0}):y=new sb({shape:{cx:t.cx,cy:t.cy,r:a[f],r0:a[p]},style:s.getLineStyle(),z2:1,silent:!0}),y.style.fill=null,r.add(y)},axisTick:function(r,e,t,i,n,a){var s=e.getModel("axisTick"),o=(s.get("inside")?-1:1)*s.get("length"),l=a[u2(t)],c=wt(i,function(f){return new qa({shape:l2(t,[l,l+o],f.coord)})});r.add(vu(c,{style:lr(s.getModel("lineStyle").getLineStyle(),{stroke:e.get(["axisLine","lineStyle","color"])})}))},minorTick:function(r,e,t,i,n,a){if(n.length){for(var s=e.getModel("axisTick"),o=e.getModel("minorTick"),l=(s.get("inside")?-1:1)*o.get("length"),c=a[u2(t)],f=[],p=0;p<n.length;p++)for(var y=0;y<n[p].length;y++)f.push(new qa({shape:l2(t,[c,c+l],n[p][y].coord)}));r.add(vu(f,{style:lr(o.getModel("lineStyle").getLineStyle(),lr(s.getLineStyle(),{stroke:e.get(["axisLine","lineStyle","color"])}))}))}},axisLabel:function(r,e,t,i,n,a,s){var o=e.getCategories(!0),l=e.getModel("axisLabel"),c=l.get("margin"),f=e.get("triggerEvent");se(s,function(p,y){var b=l,S=p.tickValue,C=a[u2(t)],E=t.coordToPoint([C+c,p.coord]),P=t.cx,O=t.cy,B=Math.abs(E[0]-P)/C<.3?"center":E[0]>P?"left":"right",F=Math.abs(E[1]-O)/C<.3?"middle":E[1]>O?"top":"bottom";if(o&&o[S]){var W=o[S];cr(W)&&W.textStyle&&(b=new Si(W.textStyle,l,l.ecModel))}var $=new si({silent:ol.isLabelSilent(e),style:cn(b,{x:E[0],y:E[1],fill:b.getTextColor()||e.get(["axisLine","lineStyle","color"]),text:p.formattedLabel,align:B,verticalAlign:F})});if(r.add($),f){var q=ol.makeAxisEventDataBase(e);q.targetType="axisLabel",q.value=p.rawLabel,br($).eventData=q}},this)},splitLine:function(r,e,t,i,n,a){var s=e.getModel("splitLine"),o=s.getModel("lineStyle"),l=o.get("color"),c=0;l=l instanceof Array?l:[l];for(var f=[],p=0;p<i.length;p++){var y=c++%l.length;f[y]=f[y]||[],f[y].push(new qa({shape:l2(t,a,i[p].coord)}))}for(var p=0;p<f.length;p++)r.add(vu(f[p],{style:lr({stroke:l[p%l.length]},o.getLineStyle()),silent:!0,z:e.get("z")}))},minorSplitLine:function(r,e,t,i,n,a){if(n.length){for(var s=e.getModel("minorSplitLine"),o=s.getModel("lineStyle"),l=[],c=0;c<n.length;c++)for(var f=0;f<n[c].length;f++)l.push(new qa({shape:l2(t,a,n[c][f].coord)}));r.add(vu(l,{style:o.getLineStyle(),silent:!0,z:e.get("z")}))}},splitArea:function(r,e,t,i,n,a){if(i.length){var s=e.getModel("splitArea"),o=s.getModel("areaStyle"),l=o.get("color"),c=0;l=l instanceof Array?l:[l];for(var f=[],p=Math.PI/180,y=-i[0].coord*p,b=Math.min(a[0],a[1]),S=Math.max(a[0],a[1]),C=e.get("clockwise"),E=1,P=i.length;E<=P;E++){var O=E===P?i[0].coord:i[E].coord,B=c++%l.length;f[B]=f[B]||[],f[B].push(new Ps({shape:{cx:t.cx,cy:t.cy,r0:b,r:S,startAngle:y,endAngle:-O*p,clockwise:C},silent:!0})),y=-O*p}for(var E=0;E<f.length;E++)r.add(vu(f[E],{style:lr({fill:l[E%l.length]},o.getAreaStyle()),silent:!0}))}}},RSe=["axisLine","axisTickLabel","axisName"],DSe=["splitLine","splitArea","minorSplitLine"],kSe=(function(r){Ye(e,r);function e(){var t=r!==null&&r.apply(this,arguments)||this;return t.type=e.type,t.axisPointerClass="PolarAxisPointer",t}return e.prototype.render=function(t,i){if(this.group.removeAll(),!!t.get("show")){var n=this._axisGroup,a=this._axisGroup=new mr;this.group.add(a);var s=t.axis,o=s.polar,l=o.getAngleAxis(),c=s.getTicksCoords(),f=s.getMinorTicksCoords(),p=l.getExtent()[0],y=s.getExtent(),b=OSe(o,t,p),S=new ol(t,b);se(RSe,S.add,S),a.add(S.getGroup()),Kw(n,a,t),se(DSe,function(C){t.get([C,"show"])&&!s.scale.isBlank()&&LSe[C](this.group,t,o,p,y,c,f)},this)}},e.type="radiusAxis",e})(Ly),LSe={splitLine:function(r,e,t,i,n,a){var s=e.getModel("splitLine"),o=s.getModel("lineStyle"),l=o.get("color"),c=0,f=t.getAngleAxis(),p=Math.PI/180,y=f.getExtent(),b=Math.abs(y[1]-y[0])===360?"Circle":"Arc";l=l instanceof Array?l:[l];for(var S=[],C=0;C<a.length;C++){var E=c++%l.length;S[E]=S[E]||[],S[E].push(new Py[b]({shape:{cx:t.cx,cy:t.cy,r:Math.max(a[C].coord,0),startAngle:-y[0]*p,endAngle:-y[1]*p,clockwise:f.inverse}}))}for(var C=0;C<S.length;C++)r.add(vu(S[C],{style:lr({stroke:l[C%l.length],fill:null},o.getLineStyle()),silent:!0}))},minorSplitLine:function(r,e,t,i,n,a,s){if(s.length){for(var o=e.getModel("minorSplitLine"),l=o.getModel("lineStyle"),c=[],f=0;f<s.length;f++)for(var p=0;p<s[f].length;p++)c.push(new $f({shape:{cx:t.cx,cy:t.cy,r:s[f][p].coord}}));r.add(vu(c,{style:lr({fill:null},l.getLineStyle()),silent:!0}))}},splitArea:function(r,e,t,i,n,a){if(a.length){var s=e.getModel("splitArea"),o=s.getModel("areaStyle"),l=o.get("color"),c=0;l=l instanceof Array?l:[l];for(var f=[],p=a[0].coord,y=1;y<a.length;y++){var b=c++%l.length;f[b]=f[b]||[],f[b].push(new Ps({shape:{cx:t.cx,cy:t.cy,r0:p,r:a[y].coord,startAngle:0,endAngle:Math.PI*2},silent:!0})),p=a[y].coord}for(var y=0;y<f.length;y++)r.add(vu(f[y],{style:lr({fill:l[y%l.length]},o.getAreaStyle()),silent:!0}))}}};function OSe(r,e,t){return{position:[r.cx,r.cy],rotation:t/180*Math.PI,labelDirection:-1,tickDirection:-1,nameDirection:1,labelRotate:e.getModel("axisLabel").get("rotate"),z2:1}}function UX(r){return r.get("stack")||"__ec_stack_"+r.seriesIndex}function HX(r,e){return e.dim+r.model.componentIndex}function NSe(r,e,t){var i={},n=BSe(wi(e.getSeriesByType(r),function(a){return!e.isSeriesFiltered(a)&&a.coordinateSystem&&a.coordinateSystem.type==="polar"}));e.eachSeriesByType(r,function(a){if(a.coordinateSystem.type==="polar"){var s=a.getData(),o=a.coordinateSystem,l=o.getBaseAxis(),c=HX(o,l),f=UX(a),p=n[c][f],y=p.offset,b=p.width,S=o.getOtherAxis(l),C=a.coordinateSystem.cx,E=a.coordinateSystem.cy,P=a.get("barMinHeight")||0,O=a.get("barMinAngle")||0;i[f]=i[f]||[];for(var B=s.mapDimension(S.dim),F=s.mapDimension(l.dim),W=dp(s,B),$=l.dim!=="radius"||!a.get("roundCap",!0),q=S.model,Q=q.get("startValue"),ee=S.dataToCoord(Q||0),te=0,ae=s.count();te<ae;te++){var de=s.get(B,te),ve=s.get(F,te),ye=de>=0?"p":"n",Ae=ee;W&&(i[f][ve]||(i[f][ve]={p:ee,n:ee}),Ae=i[f][ve][ye]);var me=void 0,De=void 0,Fe=void 0,je=void 0;if(S.dim==="radius"){var ct=S.dataToCoord(de)-ee,xe=l.dataToCoord(ve);Math.abs(ct)<P&&(ct=(ct<0?-1:1)*P),me=Ae,De=Ae+ct,Fe=xe-y,je=Fe-b,W&&(i[f][ve][ye]=De)}else{var $e=S.dataToCoord(de,$)-ee,pt=l.dataToCoord(ve);Math.abs($e)<O&&($e=($e<0?-1:1)*O),me=pt+y,De=me+b,Fe=Ae,je=Ae+$e,W&&(i[f][ve][ye]=je)}s.setItemLayout(te,{cx:C,cy:E,r0:me,r:De,startAngle:-Fe*Math.PI/180,endAngle:-je*Math.PI/180,clockwise:Fe>=je})}}})}function BSe(r){var e={};se(r,function(i,n){var a=i.getData(),s=i.coordinateSystem,o=s.getBaseAxis(),l=HX(s,o),c=o.getExtent(),f=o.type==="category"?o.getBandWidth():Math.abs(c[1]-c[0])/a.count(),p=e[l]||{bandWidth:f,remainedWidth:f,autoWidthCount:0,categoryGap:"20%",gap:"30%",stacks:{}},y=p.stacks;e[l]=p;var b=UX(i);y[b]||p.autoWidthCount++,y[b]=y[b]||{width:0,maxWidth:0};var S=Vt(i.get("barWidth"),f),C=Vt(i.get("barMaxWidth"),f),E=i.get("barGap"),P=i.get("barCategoryGap");S&&!y[b].width&&(S=Math.min(p.remainedWidth,S),y[b].width=S,p.remainedWidth-=S),C&&(y[b].maxWidth=C),E!=null&&(p.gap=E),P!=null&&(p.categoryGap=P)});var t={};return se(e,function(i,n){t[n]={};var a=i.stacks,s=i.bandWidth,o=Vt(i.categoryGap,s),l=Vt(i.gap,1),c=i.remainedWidth,f=i.autoWidthCount,p=(c-o)/(f+(f-1)*l);p=Math.max(p,0),se(a,function(C,E){var P=C.maxWidth;P&&P<p&&(P=Math.min(P,c),C.width&&(P=Math.min(P,C.width)),c-=P,C.width=P,f--)}),p=(c-o)/(f+(f-1)*l),p=Math.max(p,0);var y=0,b;se(a,function(C,E){C.width||(C.width=p),b=C,y+=C.width*(1+l)}),b&&(y-=b.width*l);var S=-y/2;se(a,function(C,E){t[n][E]=t[n][E]||{offset:S,width:C.width},S+=C.width*(1+l)})}),t}var zSe={startAngle:90,clockwise:!0,splitNumber:12,axisLabel:{rotate:0}},FSe={splitNumber:5},VSe=(function(r){Ye(e,r);function e(){var t=r!==null&&r.apply(this,arguments)||this;return t.type=e.type,t}return e.type="polar",e})(vn);function USe(r){Vr(uS),Ly.registerAxisPointerClass("PolarAxisPointer",vSe),r.registerCoordinateSystem("polar",MSe),r.registerComponentModel(_Se),r.registerComponentView(VSe),K0(r,"angle",bSe,zSe),K0(r,"radius",xSe,FSe),r.registerComponentView(ISe),r.registerComponentView(kSe),r.registerLayout(Sr(NSe,"bar"))}function eD(r,e){e=e||{};var t=r.coordinateSystem,i=r.axis,n={},a=i.position,s=i.orient,o=t.getRect(),l=[o.x,o.x+o.width,o.y,o.y+o.height],c={horizontal:{top:l[2],bottom:l[3]},vertical:{left:l[0],right:l[1]}};n.position=[s==="vertical"?c.vertical[a]:l[0],s==="horizontal"?c.horizontal[a]:l[3]];var f={horizontal:0,vertical:1};n.rotation=Math.PI/2*f[s];var p={top:-1,bottom:1,right:1,left:-1};n.labelDirection=n.tickDirection=n.nameDirection=p[a],r.get(["axisTick","inside"])&&(n.tickDirection=-n.tickDirection),uo(e.labelInside,r.get(["axisLabel","inside"]))&&(n.labelDirection=-n.labelDirection);var y=e.rotate;return y==null&&(y=r.get(["axisLabel","rotate"])),n.labelRotation=a==="top"?-y:y,n.z2=1,n}var HSe=["axisLine","axisTickLabel","axisName"],jSe=["splitArea","splitLine"],$Se=(function(r){Ye(e,r);function e(){var t=r!==null&&r.apply(this,arguments)||this;return t.type=e.type,t.axisPointerClass="SingleAxisPointer",t}return e.prototype.render=function(t,i,n,a){var s=this.group;s.removeAll();var o=this._axisGroup;this._axisGroup=new mr;var l=eD(t),c=new ol(t,l);se(HSe,c.add,c),s.add(this._axisGroup),s.add(c.getGroup()),se(jSe,function(f){t.get([f,"show"])&&WSe[f](this,this.group,this._axisGroup,t)},this),Kw(o,this._axisGroup,t),r.prototype.render.call(this,t,i,n,a)},e.prototype.remove=function(){cG(this)},e.type="singleAxis",e})(Ly),WSe={splitLine:function(r,e,t,i){var n=i.axis;if(!n.scale.isBlank()){var a=i.getModel("splitLine"),s=a.getModel("lineStyle"),o=s.get("color");o=o instanceof Array?o:[o];for(var l=s.get("width"),c=i.coordinateSystem.getRect(),f=n.isHorizontal(),p=[],y=0,b=n.getTicksCoords({tickModel:a}),S=[],C=[],E=0;E<b.length;++E){var P=n.toGlobalCoord(b[E].coord);f?(S[0]=P,S[1]=c.y,C[0]=P,C[1]=c.y+c.height):(S[0]=c.x,S[1]=P,C[0]=c.x+c.width,C[1]=P);var O=new qa({shape:{x1:S[0],y1:S[1],x2:C[0],y2:C[1]},silent:!0});X0(O.shape,l);var B=y++%o.length;p[B]=p[B]||[],p[B].push(O)}for(var F=s.getLineStyle(["color"]),E=0;E<p.length;++E)e.add(vu(p[E],{style:lr({stroke:o[E%o.length]},F),silent:!0}))}},splitArea:function(r,e,t,i){uG(r,t,i,i)}},W2=(function(r){Ye(e,r);function e(){var t=r!==null&&r.apply(this,arguments)||this;return t.type=e.type,t}return e.prototype.getCoordSysModel=function(){return this},e.type="singleAxis",e.layoutMode="box",e.defaultOption={left:"5%",top:"5%",right:"5%",bottom:"5%",type:"value",position:"bottom",orient:"horizontal",axisLine:{show:!0,lineStyle:{width:1,type:"solid"}},tooltip:{show:!0},axisTick:{show:!0,length:6,lineStyle:{width:1}},axisLabel:{show:!0,interval:"auto"},splitLine:{show:!0,lineStyle:{type:"dashed",opacity:.2}}},e})(Wr);ha(W2,wb.prototype);var GSe=(function(r){Ye(e,r);function e(t,i,n,a,s){var o=r.call(this,t,i,n)||this;return o.type=a||"value",o.position=s||"bottom",o}return e.prototype.isHorizontal=function(){var t=this.position;return t==="top"||t==="bottom"},e.prototype.pointToData=function(t,i){return this.coordinateSystem.pointToData(t)[0]},e})(Pc),jX=["single"],XSe=(function(){function r(e,t,i){this.type="single",this.dimension="single",this.dimensions=jX,this.axisPointerEnabled=!0,this.model=e,this._init(e,t,i)}return r.prototype._init=function(e,t,i){var n=this.dimension,a=new GSe(n,eS(e),[0,0],e.get("type"),e.get("position")),s=a.type==="category";a.onBand=s&&e.get("boundaryGap"),a.inverse=e.get("inverse"),a.orient=e.get("orient"),e.axis=a,a.model=e,a.coordinateSystem=this,this._axis=a},r.prototype.update=function(e,t){e.eachSeries(function(i){if(i.coordinateSystem===this){var n=i.getData();se(n.mapDimensionsAll(this.dimension),function(a){this._axis.scale.unionExtentFromData(n,a)},this),xy(this._axis.scale,this._axis.model)}},this)},r.prototype.resize=function(e,t){this._rect=La({left:e.get("left"),top:e.get("top"),right:e.get("right"),bottom:e.get("bottom"),width:e.get("width"),height:e.get("height")},{width:t.getWidth(),height:t.getHeight()}),this._adjustAxis()},r.prototype.getRect=function(){return this._rect},r.prototype._adjustAxis=function(){var e=this._rect,t=this._axis,i=t.isHorizontal(),n=i?[0,e.width]:[0,e.height],a=t.inverse?1:0;t.setExtent(n[a],n[1-a]),this._updateAxisTransform(t,i?e.x:e.y)},r.prototype._updateAxisTransform=function(e,t){var i=e.getExtent(),n=i[0]+i[1],a=e.isHorizontal();e.toGlobalCoord=a?function(s){return s+t}:function(s){return n-s+t},e.toLocalCoord=a?function(s){return s-t}:function(s){return n-s+t}},r.prototype.getAxis=function(){return this._axis},r.prototype.getBaseAxis=function(){return this._axis},r.prototype.getAxes=function(){return[this._axis]},r.prototype.getTooltipAxes=function(){return{baseAxes:[this.getAxis()],otherAxes:[]}},r.prototype.containPoint=function(e){var t=this.getRect(),i=this.getAxis(),n=i.orient;return n==="horizontal"?i.contain(i.toLocalCoord(e[0]))&&e[1]>=t.y&&e[1]<=t.y+t.height:i.contain(i.toLocalCoord(e[1]))&&e[0]>=t.y&&e[0]<=t.y+t.height},r.prototype.pointToData=function(e){var t=this.getAxis();return[t.coordToData(t.toLocalCoord(e[t.orient==="horizontal"?0:1]))]},r.prototype.dataToPoint=function(e){var t=this.getAxis(),i=this.getRect(),n=[],a=t.orient==="horizontal"?0:1;return e instanceof Array&&(e=e[0]),n[a]=t.toGlobalCoord(t.dataToCoord(+e)),n[1-a]=a===0?i.y+i.height/2:i.x+i.width/2,n},r.prototype.convertToPixel=function(e,t,i){var n=CV(t);return n===this?this.dataToPoint(i):null},r.prototype.convertFromPixel=function(e,t,i){var n=CV(t);return n===this?this.pointToData(i):null},r})();function CV(r){var e=r.seriesModel,t=r.singleAxisModel;return t&&t.coordinateSystem||e&&e.coordinateSystem}function ZSe(r,e){var t=[];return r.eachComponent("singleAxis",function(i,n){var a=new XSe(i,r,e);a.name="single_"+n,a.resize(i,e),i.coordinateSystem=a,t.push(a)}),r.eachSeries(function(i){if(i.get("coordinateSystem")==="singleAxis"){var n=i.getReferringComponents("singleAxis",ka).models[0];i.coordinateSystem=n&&n.coordinateSystem}}),t}var qSe={create:ZSe,dimensions:jX},MV=["x","y"],YSe=["width","height"],KSe=(function(r){Ye(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.makeElOption=function(t,i,n,a,s){var o=n.axis,l=o.coordinateSystem,c=SP(l,1-iC(o)),f=l.dataToPoint(i)[0],p=a.get("type");if(p&&p!=="none"){var y=gO(a),b=QSe[p](o,f,c);b.style=y,t.graphicKey=b.type,t.pointer=b}var S=eD(n);NX(i,t,S,n,a,s)},e.prototype.getHandleTransform=function(t,i,n){var a=eD(i,{labelInside:!1});a.labelMargin=n.get(["handle","margin"]);var s=vO(i.axis,t,a);return{x:s[0],y:s[1],rotation:a.rotation+(a.labelDirection<0?Math.PI:0)}},e.prototype.updateHandleTransform=function(t,i,n,a){var s=n.axis,o=s.coordinateSystem,l=iC(s),c=SP(o,l),f=[t.x,t.y];f[l]+=i[l],f[l]=Math.min(c[1],f[l]),f[l]=Math.max(c[0],f[l]);var p=SP(o,1-l),y=(p[1]+p[0])/2,b=[y,y];return b[l]=f[l],{x:f[0],y:f[1],rotation:t.rotation,cursorPoint:b,tooltipOption:{verticalAlign:"middle"}}},e})(pO),QSe={line:function(r,e,t){var i=mO([e,t[0]],[e,t[1]],iC(r));return{type:"Line",subPixelOptimize:!0,shape:i}},shadow:function(r,e,t){var i=r.getBandWidth(),n=t[1]-t[0];return{type:"Rect",shape:BX([e-i/2,t[0]],[i,n],iC(r))}}};function iC(r){return r.isHorizontal()?0:1}function SP(r,e){var t=r.getRect();return[t[MV[e]],t[MV[e]]+t[YSe[e]]]}var JSe=(function(r){Ye(e,r);function e(){var t=r!==null&&r.apply(this,arguments)||this;return t.type=e.type,t}return e.type="single",e})(vn);function eTe(r){Vr(uS),Ly.registerAxisPointerClass("SingleAxisPointer",KSe),r.registerComponentView(JSe),r.registerComponentView($Se),r.registerComponentModel(W2),K0(r,"single",W2,W2.defaultOption),r.registerCoordinateSystem("single",qSe)}var tTe=(function(r){Ye(e,r);function e(){var t=r!==null&&r.apply(this,arguments)||this;return t.type=e.type,t}return e.prototype.init=function(t,i,n){var a=pb(t);r.prototype.init.apply(this,arguments),EV(t,a)},e.prototype.mergeOption=function(t){r.prototype.mergeOption.apply(this,arguments),EV(this.option,t)},e.prototype.getCellSize=function(){return this.option.cellSize},e.type="calendar",e.defaultOption={z:2,left:80,top:60,cellSize:20,orient:"horizontal",splitLine:{show:!0,lineStyle:{color:"#000",width:1,type:"solid"}},itemStyle:{color:"#fff",borderWidth:1,borderColor:"#ccc"},dayLabel:{show:!0,firstDay:0,position:"start",margin:"50%",color:"#000"},monthLabel:{show:!0,position:"start",margin:5,align:"center",formatter:null,color:"#000"},yearLabel:{show:!0,position:null,margin:30,formatter:null,color:"#ccc",fontFamily:"sans-serif",fontWeight:"bolder",fontSize:20}},e})(Wr);function EV(r,e){var t=r.cellSize,i;xt(t)?i=t:i=r.cellSize=[t,t],i.length===1&&(i[1]=i[0]);var n=wt([0,1],function(a){return afe(e,a)&&(i[a]="auto"),i[a]!=null&&i[a]!=="auto"});$g(r,e,{type:"box",ignoreSize:n})}var rTe=(function(r){Ye(e,r);function e(){var t=r!==null&&r.apply(this,arguments)||this;return t.type=e.type,t}return e.prototype.render=function(t,i,n){var a=this.group;a.removeAll();var s=t.coordinateSystem,o=s.getRangeInfo(),l=s.getOrient(),c=i.getLocaleModel();this._renderDayRect(t,o,a),this._renderLines(t,o,l,a),this._renderYearText(t,o,l,a),this._renderMonthText(t,c,l,a),this._renderWeekText(t,c,o,l,a)},e.prototype._renderDayRect=function(t,i,n){for(var a=t.coordinateSystem,s=t.getModel("itemStyle").getItemStyle(),o=a.getCellWidth(),l=a.getCellHeight(),c=i.start.time;c<=i.end.time;c=a.getNextNDay(c,1).time){var f=a.dataToRect([c],!1).tl,p=new li({shape:{x:f[0],y:f[1],width:o,height:l},cursor:"default",style:s});n.add(p)}},e.prototype._renderLines=function(t,i,n,a){var s=this,o=t.coordinateSystem,l=t.getModel(["splitLine","lineStyle"]).getLineStyle(),c=t.get(["splitLine","show"]),f=l.lineWidth;this._tlpoints=[],this._blpoints=[],this._firstDayOfMonth=[],this._firstDayPoints=[];for(var p=i.start,y=0;p.time<=i.end.time;y++){S(p.formatedDate),y===0&&(p=o.getDateInfo(i.start.y+"-"+i.start.m));var b=p.date;b.setMonth(b.getMonth()+1),p=o.getDateInfo(b)}S(o.getNextNDay(i.end.time,1).formatedDate);function S(C){s._firstDayOfMonth.push(o.getDateInfo(C)),s._firstDayPoints.push(o.dataToRect([C],!1).tl);var E=s._getLinePointsOfOneWeek(t,C,n);s._tlpoints.push(E[0]),s._blpoints.push(E[E.length-1]),c&&s._drawSplitline(E,l,a)}c&&this._drawSplitline(s._getEdgesPoints(s._tlpoints,f,n),l,a),c&&this._drawSplitline(s._getEdgesPoints(s._blpoints,f,n),l,a)},e.prototype._getEdgesPoints=function(t,i,n){var a=[t[0].slice(),t[t.length-1].slice()],s=n==="horizontal"?0:1;return a[0][s]=a[0][s]-i/2,a[1][s]=a[1][s]+i/2,a},e.prototype._drawSplitline=function(t,i,n){var a=new ks({z2:20,shape:{points:t},style:i});n.add(a)},e.prototype._getLinePointsOfOneWeek=function(t,i,n){for(var a=t.coordinateSystem,s=a.getDateInfo(i),o=[],l=0;l<7;l++){var c=a.getNextNDay(s.time,l),f=a.dataToRect([c.time],!1);o[2*c.day]=f.tl,o[2*c.day+1]=f[n==="horizontal"?"bl":"tr"]}return o},e.prototype._formatterLabel=function(t,i){return $t(t)&&t?tfe(t,i):sr(t)?t(i):i.nameMap},e.prototype._yearTextPositionControl=function(t,i,n,a,s){var o=i[0],l=i[1],c=["center","bottom"];a==="bottom"?(l+=s,c=["center","top"]):a==="left"?o-=s:a==="right"?(o+=s,c=["center","top"]):l-=s;var f=0;return(a==="left"||a==="right")&&(f=Math.PI/2),{rotation:f,x:o,y:l,style:{align:c[0],verticalAlign:c[1]}}},e.prototype._renderYearText=function(t,i,n,a){var s=t.getModel("yearLabel");if(s.get("show")){var o=s.get("margin"),l=s.get("position");l||(l=n!=="horizontal"?"top":"left");var c=[this._tlpoints[this._tlpoints.length-1],this._blpoints[0]],f=(c[0][0]+c[1][0])/2,p=(c[0][1]+c[1][1])/2,y=n==="horizontal"?0:1,b={top:[f,c[y][1]],bottom:[f,c[1-y][1]],left:[c[1-y][0],p],right:[c[y][0],p]},S=i.start.y;+i.end.y>+i.start.y&&(S=S+"-"+i.end.y);var C=s.get("formatter"),E={start:i.start.y,end:i.end.y,nameMap:S},P=this._formatterLabel(C,E),O=new si({z2:30,style:cn(s,{text:P}),silent:s.get("silent")});O.attr(this._yearTextPositionControl(O,b[l],n,l,o)),a.add(O)}},e.prototype._monthTextPositionControl=function(t,i,n,a,s){var o="left",l="top",c=t[0],f=t[1];return n==="horizontal"?(f=f+s,i&&(o="center"),a==="start"&&(l="bottom")):(c=c+s,i&&(l="middle"),a==="start"&&(o="right")),{x:c,y:f,align:o,verticalAlign:l}},e.prototype._renderMonthText=function(t,i,n,a){var s=t.getModel("monthLabel");if(s.get("show")){var o=s.get("nameMap"),l=s.get("margin"),c=s.get("position"),f=s.get("align"),p=[this._tlpoints,this._blpoints];(!o||$t(o))&&(o&&(i=s3(o)||i),o=i.get(["time","monthAbbr"])||[]);var y=c==="start"?0:1,b=n==="horizontal"?0:1;l=c==="start"?-l:l;for(var S=f==="center",C=s.get("silent"),E=0;E<p[y].length-1;E++){var P=p[y][E].slice(),O=this._firstDayOfMonth[E];if(S){var B=this._firstDayPoints[E];P[b]=(B[b]+p[0][E+1][b])/2}var F=s.get("formatter"),W=o[+O.m-1],$={yyyy:O.y,yy:(O.y+"").slice(2),MM:O.m,M:+O.m,nameMap:W},q=this._formatterLabel(F,$),Q=new si({z2:30,style:mt(cn(s,{text:q}),this._monthTextPositionControl(P,S,n,c,l)),silent:C});a.add(Q)}}},e.prototype._weekTextPositionControl=function(t,i,n,a,s){var o="center",l="middle",c=t[0],f=t[1],p=n==="start";return i==="horizontal"?(c=c+a+(p?1:-1)*s[0]/2,o=p?"right":"left"):(f=f+a+(p?1:-1)*s[1]/2,l=p?"bottom":"top"),{x:c,y:f,align:o,verticalAlign:l}},e.prototype._renderWeekText=function(t,i,n,a,s){var o=t.getModel("dayLabel");if(o.get("show")){var l=t.coordinateSystem,c=o.get("position"),f=o.get("nameMap"),p=o.get("margin"),y=l.getFirstDayOfWeek();if(!f||$t(f)){f&&(i=s3(f)||i);var b=i.get(["time","dayOfWeekShort"]);f=b||wt(i.get(["time","dayOfWeekAbbr"]),function($){return $[0]})}var S=l.getNextNDay(n.end.time,7-n.lweek).time,C=[l.getCellWidth(),l.getCellHeight()];p=Vt(p,Math.min(C[1],C[0])),c==="start"&&(S=l.getNextNDay(n.start.time,-(7+n.fweek)).time,p=-p);for(var E=o.get("silent"),P=0;P<7;P++){var O=l.getNextNDay(S,P),B=l.dataToRect([O.time],!1).center,F=P;F=Math.abs((P+y)%7);var W=new si({z2:30,style:mt(cn(o,{text:f[F]}),this._weekTextPositionControl(B,a,c,p,C)),silent:E});s.add(W)}}},e.type="calendar",e})(vn),TP=864e5,iTe=(function(){function r(e,t,i){this.type="calendar",this.dimensions=r.dimensions,this.getDimensionsInfo=r.getDimensionsInfo,this._model=e}return r.getDimensionsInfo=function(){return[{name:"time",type:"time"},"value"]},r.prototype.getRangeInfo=function(){return this._rangeInfo},r.prototype.getModel=function(){return this._model},r.prototype.getRect=function(){return this._rect},r.prototype.getCellWidth=function(){return this._sw},r.prototype.getCellHeight=function(){return this._sh},r.prototype.getOrient=function(){return this._orient},r.prototype.getFirstDayOfWeek=function(){return this._firstDayOfWeek},r.prototype.getDateInfo=function(e){e=xu(e);var t=e.getFullYear(),i=e.getMonth()+1,n=i<10?"0"+i:""+i,a=e.getDate(),s=a<10?"0"+a:""+a,o=e.getDay();return o=Math.abs((o+7-this.getFirstDayOfWeek())%7),{y:t+"",m:n,d:s,day:o,time:e.getTime(),formatedDate:t+"-"+n+"-"+s,date:e}},r.prototype.getNextNDay=function(e,t){return t=t||0,t===0?this.getDateInfo(e):(e=new Date(this.getDateInfo(e).time),e.setDate(e.getDate()+t),this.getDateInfo(e))},r.prototype.update=function(e,t){this._firstDayOfWeek=+this._model.getModel("dayLabel").get("firstDay"),this._orient=this._model.get("orient"),this._lineWidth=this._model.getModel("itemStyle").getItemStyle().lineWidth||0,this._rangeInfo=this._getRangeInfo(this._initRangeOption());var i=this._rangeInfo.weeks||1,n=["width","height"],a=this._model.getCellSize().slice(),s=this._model.getBoxLayoutParams(),o=this._orient==="horizontal"?[i,7]:[7,i];se([0,1],function(p){f(a,p)&&(s[n[p]]=a[p]*o[p])});var l={width:t.getWidth(),height:t.getHeight()},c=this._rect=La(s,l);se([0,1],function(p){f(a,p)||(a[p]=c[n[p]]/o[p])});function f(p,y){return p[y]!=null&&p[y]!=="auto"}this._sw=a[0],this._sh=a[1]},r.prototype.dataToPoint=function(e,t){xt(e)&&(e=e[0]),t==null&&(t=!0);var i=this.getDateInfo(e),n=this._rangeInfo,a=i.formatedDate;if(t&&!(i.time>=n.start.time&&i.time<n.end.time+TP))return[NaN,NaN];var s=i.day,o=this._getRangeInfo([n.start.time,a]).nthWeek;return this._orient==="vertical"?[this._rect.x+s*this._sw+this._sw/2,this._rect.y+o*this._sh+this._sh/2]:[this._rect.x+o*this._sw+this._sw/2,this._rect.y+s*this._sh+this._sh/2]},r.prototype.pointToData=function(e){var t=this.pointToDate(e);return t&&t.time},r.prototype.dataToRect=function(e,t){var i=this.dataToPoint(e,t);return{contentShape:{x:i[0]-(this._sw-this._lineWidth)/2,y:i[1]-(this._sh-this._lineWidth)/2,width:this._sw-this._lineWidth,height:this._sh-this._lineWidth},center:i,tl:[i[0]-this._sw/2,i[1]-this._sh/2],tr:[i[0]+this._sw/2,i[1]-this._sh/2],br:[i[0]+this._sw/2,i[1]+this._sh/2],bl:[i[0]-this._sw/2,i[1]+this._sh/2]}},r.prototype.pointToDate=function(e){var t=Math.floor((e[0]-this._rect.x)/this._sw)+1,i=Math.floor((e[1]-this._rect.y)/this._sh)+1,n=this._rangeInfo.range;return this._orient==="vertical"?this._getDateByWeeksAndDay(i,t-1,n):this._getDateByWeeksAndDay(t,i-1,n)},r.prototype.convertToPixel=function(e,t,i){var n=IV(t);return n===this?n.dataToPoint(i):null},r.prototype.convertFromPixel=function(e,t,i){var n=IV(t);return n===this?n.pointToData(i):null},r.prototype.containPoint=function(e){return console.warn("Not implemented."),!1},r.prototype._initRangeOption=function(){var e=this._model.get("range"),t;if(xt(e)&&e.length===1&&(e=e[0]),xt(e))t=e;else{var i=e.toString();if(/^\d{4}$/.test(i)&&(t=[i+"-01-01",i+"-12-31"]),/^\d{4}[\/|-]\d{1,2}$/.test(i)){var n=this.getDateInfo(i),a=n.date;a.setMonth(a.getMonth()+1);var s=this.getNextNDay(a,-1);t=[n.formatedDate,s.formatedDate]}/^\d{4}[\/|-]\d{1,2}[\/|-]\d{1,2}$/.test(i)&&(t=[i,i])}if(!t)return e;var o=this._getRangeInfo(t);return o.start.time>o.end.time&&t.reverse(),t},r.prototype._getRangeInfo=function(e){var t=[this.getDateInfo(e[0]),this.getDateInfo(e[1])],i;t[0].time>t[1].time&&(i=!0,t.reverse());var n=Math.floor(t[1].time/TP)-Math.floor(t[0].time/TP)+1,a=new Date(t[0].time),s=a.getDate(),o=t[1].date.getDate();a.setDate(s+n-1);var l=a.getDate();if(l!==o)for(var c=a.getTime()-t[1].time>0?1:-1;(l=a.getDate())!==o&&(a.getTime()-t[1].time)*c>0;)n-=c,a.setDate(l-c);var f=Math.floor((n+t[0].day+6)/7),p=i?-f+1:f-1;return i&&t.reverse(),{range:[t[0].formatedDate,t[1].formatedDate],start:t[0],end:t[1],allDay:n,weeks:f,nthWeek:p,fweek:t[0].day,lweek:t[1].day}},r.prototype._getDateByWeeksAndDay=function(e,t,i){var n=this._getRangeInfo(i);if(e>n.weeks||e===0&&t<n.fweek||e===n.weeks&&t>n.lweek)return null;var a=(e-1)*7-n.fweek+t,s=new Date(n.start.time);return s.setDate(+n.start.d+a),this.getDateInfo(s)},r.create=function(e,t){var i=[];return e.eachComponent("calendar",function(n){var a=new r(n);i.push(a),n.coordinateSystem=a}),e.eachSeries(function(n){n.get("coordinateSystem")==="calendar"&&(n.coordinateSystem=i[n.get("calendarIndex")||0])}),i},r.dimensions=["time","value"],r})();function IV(r){var e=r.calendarModel,t=r.seriesModel,i=e?e.coordinateSystem:t?t.coordinateSystem:null;return i}function nTe(r){r.registerComponentModel(tTe),r.registerComponentView(rTe),r.registerCoordinateSystem("calendar",iTe)}function aTe(r,e){var t=r.existing;if(e.id=r.keyInfo.id,!e.type&&t&&(e.type=t.type),e.parentId==null){var i=e.parentOption;i?e.parentId=i.id:t&&(e.parentId=t.parentId)}e.parentOption=null}function PV(r,e){var t;return se(e,function(i){r[i]!=null&&r[i]!=="auto"&&(t=!0)}),t}function oTe(r,e,t){var i=mt({},t),n=r[e],a=t.$action||"merge";a==="merge"?n?(Cr(n,i,!0),$g(n,i,{ignoreSize:!0}),D7(t,n),c2(t,n),c2(t,n,"shape"),c2(t,n,"style"),c2(t,n,"extra"),t.clipPath=n.clipPath):r[e]=i:a==="replace"?r[e]=i:a==="remove"&&n&&(r[e]=null)}var $X=["transition","enterFrom","leaveTo"],sTe=$X.concat(["enterAnimation","updateAnimation","leaveAnimation"]);function c2(r,e,t){if(t&&(!r[t]&&e[t]&&(r[t]={}),r=r[t],e=e[t]),!(!r||!e))for(var i=t?$X:sTe,n=0;n<i.length;n++){var a=i[n];r[a]==null&&e[a]!=null&&(r[a]=e[a])}}function lTe(r,e){if(r&&(r.hv=e.hv=[PV(e,["left","right"]),PV(e,["top","bottom"])],r.type==="group")){var t=r,i=e;t.width==null&&(t.width=i.width=0),t.height==null&&(t.height=i.height=0)}}var uTe=(function(r){Ye(e,r);function e(){var t=r!==null&&r.apply(this,arguments)||this;return t.type=e.type,t.preventAutoZ=!0,t}return e.prototype.mergeOption=function(t,i){var n=this.option.elements;this.option.elements=null,r.prototype.mergeOption.call(this,t,i),this.option.elements=n},e.prototype.optionUpdated=function(t,i){var n=this.option,a=(i?n:t).elements,s=n.elements=i?[]:n.elements,o=[];this._flatten(a,o,null);var l=P$(s,o,"normalMerge"),c=this._elOptionsToUpdate=[];se(l,function(f,p){var y=f.newOption;y&&(c.push(y),aTe(f,y),oTe(s,p,y),lTe(s[p],y))},this),n.elements=wi(s,function(f){return f&&delete f.$action,f!=null})},e.prototype._flatten=function(t,i,n){se(t,function(a){if(a){n&&(a.parentOption=n),i.push(a);var s=a.children;s&&s.length&&this._flatten(s,i,a),delete a.children}},this)},e.prototype.useElOptionsToUpdate=function(){var t=this._elOptionsToUpdate;return this._elOptionsToUpdate=null,t},e.type="graphic",e.defaultOption={elements:[]},e})(Wr),RV={path:null,compoundPath:null,group:mr,image:go,text:si},fc=fi(),cTe=(function(r){Ye(e,r);function e(){var t=r!==null&&r.apply(this,arguments)||this;return t.type=e.type,t}return e.prototype.init=function(){this._elMap=Qt()},e.prototype.render=function(t,i,n){t!==this._lastGraphicModel&&this._clear(),this._lastGraphicModel=t,this._updateElements(t),this._relocate(t,n)},e.prototype._updateElements=function(t){var i=t.useElOptionsToUpdate();if(i){var n=this._elMap,a=this.group,s=t.get("z"),o=t.get("zlevel");se(i,function(l){var c=Za(l.id,null),f=c!=null?n.get(c):null,p=Za(l.parentId,null),y=p!=null?n.get(p):a,b=l.type,S=l.style;b==="text"&&S&&l.hv&&l.hv[1]&&(S.textVerticalAlign=S.textBaseline=S.verticalAlign=S.align=null);var C=l.textContent,E=l.textConfig;if(S&&TX(S,b,!!E,!!C)){var P=AX(S,b,!0);!E&&P.textConfig&&(E=l.textConfig=P.textConfig),!C&&P.textContent&&(C=P.textContent)}var O=hTe(l),B=l.$action||"merge",F=B==="merge",W=B==="replace";if(F){var $=!f,q=f;$?q=DV(c,y,l.type,n):(q&&(fc(q).isNew=!1),IX(q)),q&&(j2(q,O,t,{isInit:$}),kV(q,l,s,o))}else if(W){G2(f,l,n,t);var Q=DV(c,y,l.type,n);Q&&(j2(Q,O,t,{isInit:!0}),kV(Q,l,s,o))}else B==="remove"&&(MX(f,l),G2(f,l,n,t));var ee=n.get(c);if(ee&&C)if(F){var te=ee.getTextContent();te?te.attr(C):ee.setTextContent(new si(C))}else W&&ee.setTextContent(new si(C));if(ee){var ae=l.clipPath;if(ae){var de=ae.type,ve=void 0,$=!1;if(F){var ye=ee.getClipPath();$=!ye||fc(ye).type!==de,ve=$?tD(de):ye}else W&&($=!0,ve=tD(de));ee.setClipPath(ve),j2(ve,ae,t,{isInit:$}),tC(ve,ae.keyframeAnimation,t)}var Ae=fc(ee);ee.setTextConfig(E),Ae.option=l,fTe(ee,t,l),Iy({el:ee,componentModel:t,itemName:ee.name,itemTooltipOption:l.tooltip}),tC(ee,l.keyframeAnimation,t)}})}},e.prototype._relocate=function(t,i){for(var n=t.option.elements,a=this.group,s=this._elMap,o=i.getWidth(),l=i.getHeight(),c=["x","y"],f=0;f<n.length;f++){var p=n[f],y=Za(p.id,null),b=y!=null?s.get(y):null;if(!(!b||!b.isGroup)){var S=b.parent,C=S===a,E=fc(b),P=fc(S);E.width=Vt(E.option.width,C?o:P.width)||0,E.height=Vt(E.option.height,C?l:P.height)||0}}for(var f=n.length-1;f>=0;f--){var p=n[f],y=Za(p.id,null),b=y!=null?s.get(y):null;if(b){var S=b.parent,P=fc(S),O=S===a?{width:o,height:l}:{width:P.width,height:P.height},B={},F=XC(b,p,O,null,{hv:p.hv,boundingMode:p.bounding},B);if(!fc(b).isNew&&F){for(var W=p.transition,$={},q=0;q<c.length;q++){var Q=c[q],ee=B[Q];W&&(sy(W)||Or(W,Q)>=0)?$[Q]=ee:b[Q]=ee}vi(b,$,t,0)}else b.attr(B)}}},e.prototype._clear=function(){var t=this,i=this._elMap;i.each(function(n){G2(n,fc(n).option,i,t._lastGraphicModel)}),this._elMap=Qt()},e.prototype.dispose=function(){this._clear()},e.type="graphic",e})(vn);function tD(r){var e=Yt(RV,r)?RV[r]:VC(r),t=new e({});return fc(t).type=r,t}function DV(r,e,t,i){var n=tD(t);return e.add(n),i.set(r,n),fc(n).id=r,fc(n).isNew=!0,n}function G2(r,e,t,i){var n=r&&r.parent;n&&(r.type==="group"&&r.traverse(function(a){G2(a,e,t,i)}),cM(r,e,i),t.removeKey(fc(r).id))}function kV(r,e,t,i){r.isGroup||se([["cursor",Tc.prototype.cursor],["zlevel",i||0],["z",t||0],["z2",0]],function(n){var a=n[0];Yt(e,a)?r[a]=wr(e[a],n[1]):r[a]==null&&(r[a]=n[1])}),se(qr(e),function(n){if(n.indexOf("on")===0){var a=e[n];r[n]=sr(a)?a:null}}),Yt(e,"draggable")&&(r.draggable=e.draggable),e.name!=null&&(r.name=e.name),e.id!=null&&(r.id=e.id)}function hTe(r){return r=mt({},r),se(["id","parentId","$action","hv","bounding","textContent","clipPath"].concat(R7),function(e){delete r[e]}),r}function fTe(r,e,t){var i=br(r).eventData;!r.silent&&!r.ignore&&!i&&(i=br(r).eventData={componentType:"graphic",componentIndex:e.componentIndex,name:r.name}),i&&(i.info=t.info)}function dTe(r){r.registerComponentModel(uTe),r.registerComponentView(cTe),r.registerPreprocessor(function(e){var t=e.graphic;xt(t)?!t[0]||!t[0].elements?e.graphic=[{elements:t}]:e.graphic=[e.graphic[0]]:t&&!t.elements&&(e.graphic=[{elements:[t]}])})}var LV=["x","y","radius","angle","single"],pTe=["cartesian2d","polar","singleAxis"];function gTe(r){var e=r.get("coordinateSystem");return Or(pTe,e)>=0}function Rg(r){return r+"Axis"}function vTe(r,e){var t=Qt(),i=[],n=Qt();r.eachComponent({mainType:"dataZoom",query:e},function(f){n.get(f.uid)||o(f)});var a;do a=!1,r.eachComponent("dataZoom",s);while(a);function s(f){!n.get(f.uid)&&l(f)&&(o(f),a=!0)}function o(f){n.set(f.uid,!0),i.push(f),c(f)}function l(f){var p=!1;return f.eachTargetAxis(function(y,b){var S=t.get(y);S&&S[b]&&(p=!0)}),p}function c(f){f.eachTargetAxis(function(p,y){(t.get(p)||t.set(p,[]))[y]=!0})}return i}function WX(r){var e=r.ecModel,t={infoList:[],infoMap:Qt()};return r.eachTargetAxis(function(i,n){var a=e.getComponent(Rg(i),n);if(a){var s=a.getCoordSysModel();if(s){var o=s.uid,l=t.infoMap.get(o);l||(l={model:s,axisModels:[]},t.infoList.push(l),t.infoMap.set(o,l)),l.axisModels.push(a)}}}),t}var AP=(function(){function r(){this.indexList=[],this.indexMap=[]}return r.prototype.add=function(e){this.indexMap[e]||(this.indexList.push(e),this.indexMap[e]=!0)},r})(),kw=(function(r){Ye(e,r);function e(){var t=r!==null&&r.apply(this,arguments)||this;return t.type=e.type,t._autoThrottle=!0,t._noTarget=!0,t._rangePropMode=["percent","percent"],t}return e.prototype.init=function(t,i,n){var a=OV(t);this.settledOption=a,this.mergeDefaultAndTheme(t,n),this._doInit(a)},e.prototype.mergeOption=function(t){var i=OV(t);Cr(this.option,t,!0),Cr(this.settledOption,i,!0),this._doInit(i)},e.prototype._doInit=function(t){var i=this.option;this._setDefaultThrottle(t),this._updateRangeUse(t);var n=this.settledOption;se([["start","startValue"],["end","endValue"]],function(a,s){this._rangePropMode[s]==="value"&&(i[a[0]]=n[a[0]]=null)},this),this._resetTarget()},e.prototype._resetTarget=function(){var t=this.get("orient",!0),i=this._targetAxisInfoMap=Qt(),n=this._fillSpecifiedTargetAxis(i);n?this._orient=t||this._makeAutoOrientByTargetAxis():(this._orient=t||"horizontal",this._fillAutoTargetAxisByOrient(i,this._orient)),this._noTarget=!0,i.each(function(a){a.indexList.length&&(this._noTarget=!1)},this)},e.prototype._fillSpecifiedTargetAxis=function(t){var i=!1;return se(LV,function(n){var a=this.getReferringComponents(Rg(n),Xue);if(a.specified){i=!0;var s=new AP;se(a.models,function(o){s.add(o.componentIndex)}),t.set(n,s)}},this),i},e.prototype._fillAutoTargetAxisByOrient=function(t,i){var n=this.ecModel,a=!0;if(a){var s=i==="vertical"?"y":"x",o=n.findComponents({mainType:s+"Axis"});l(o,s)}if(a){var o=n.findComponents({mainType:"singleAxis",filter:function(f){return f.get("orient",!0)===i}});l(o,"single")}function l(c,f){var p=c[0];if(p){var y=new AP;if(y.add(p.componentIndex),t.set(f,y),a=!1,f==="x"||f==="y"){var b=p.getReferringComponents("grid",ka).models[0];b&&se(c,function(S){p.componentIndex!==S.componentIndex&&b===S.getReferringComponents("grid",ka).models[0]&&y.add(S.componentIndex)})}}}a&&se(LV,function(c){if(a){var f=n.findComponents({mainType:Rg(c),filter:function(y){return y.get("type",!0)==="category"}});if(f[0]){var p=new AP;p.add(f[0].componentIndex),t.set(c,p),a=!1}}},this)},e.prototype._makeAutoOrientByTargetAxis=function(){var t;return this.eachTargetAxis(function(i){!t&&(t=i)},this),t==="y"?"vertical":"horizontal"},e.prototype._setDefaultThrottle=function(t){if(t.hasOwnProperty("throttle")&&(this._autoThrottle=!1),this._autoThrottle){var i=this.ecModel.option;this.option.throttle=i.animation&&i.animationDurationUpdate>0?100:20}},e.prototype._updateRangeUse=function(t){var i=this._rangePropMode,n=this.get("rangeMode");se([["start","startValue"],["end","endValue"]],function(a,s){var o=t[a[0]]!=null,l=t[a[1]]!=null;o&&!l?i[s]="percent":!o&&l?i[s]="value":n?i[s]=n[s]:o&&(i[s]="percent")})},e.prototype.noTarget=function(){return this._noTarget},e.prototype.getFirstTargetAxisModel=function(){var t;return this.eachTargetAxis(function(i,n){t==null&&(t=this.ecModel.getComponent(Rg(i),n))},this),t},e.prototype.eachTargetAxis=function(t,i){this._targetAxisInfoMap.each(function(n,a){se(n.indexList,function(s){t.call(i,a,s)})})},e.prototype.getAxisProxy=function(t,i){var n=this.getAxisModel(t,i);if(n)return n.__dzAxisProxy},e.prototype.getAxisModel=function(t,i){var n=this._targetAxisInfoMap.get(t);if(n&&n.indexMap[i])return this.ecModel.getComponent(Rg(t),i)},e.prototype.setRawRange=function(t){var i=this.option,n=this.settledOption;se([["start","startValue"],["end","endValue"]],function(a){(t[a[0]]!=null||t[a[1]]!=null)&&(i[a[0]]=n[a[0]]=t[a[0]],i[a[1]]=n[a[1]]=t[a[1]])},this),this._updateRangeUse(t)},e.prototype.setCalculatedRange=function(t){var i=this.option;se(["start","startValue","end","endValue"],function(n){i[n]=t[n]})},e.prototype.getPercentRange=function(){var t=this.findRepresentativeAxisProxy();if(t)return t.getDataPercentWindow()},e.prototype.getValueRange=function(t,i){if(t==null&&i==null){var n=this.findRepresentativeAxisProxy();if(n)return n.getDataValueWindow()}else return this.getAxisProxy(t,i).getDataValueWindow()},e.prototype.findRepresentativeAxisProxy=function(t){if(t)return t.__dzAxisProxy;for(var i,n=this._targetAxisInfoMap.keys(),a=0;a<n.length;a++)for(var s=n[a],o=this._targetAxisInfoMap.get(s),l=0;l<o.indexList.length;l++){var c=this.getAxisProxy(s,o.indexList[l]);if(c.hostedBy(this))return c;i||(i=c)}return i},e.prototype.getRangePropMode=function(){return this._rangePropMode.slice()},e.prototype.getOrient=function(){return this._orient},e.type="dataZoom",e.dependencies=["xAxis","yAxis","radiusAxis","angleAxis","singleAxis","series","toolbox"],e.defaultOption={z:4,filterMode:"filter",start:0,end:100},e})(Wr);function OV(r){var e={};return se(["start","end","startValue","endValue","throttle"],function(t){r.hasOwnProperty(t)&&(e[t]=r[t])}),e}var mTe=(function(r){Ye(e,r);function e(){var t=r!==null&&r.apply(this,arguments)||this;return t.type=e.type,t}return e.type="dataZoom.select",e})(kw),xO=(function(r){Ye(e,r);function e(){var t=r!==null&&r.apply(this,arguments)||this;return t.type=e.type,t}return e.prototype.render=function(t,i,n,a){this.dataZoomModel=t,this.ecModel=i,this.api=n},e.type="dataZoom",e})(vn),yTe=(function(r){Ye(e,r);function e(){var t=r!==null&&r.apply(this,arguments)||this;return t.type=e.type,t}return e.type="dataZoom.select",e})(xO),h0=se,NV=yu,_Te=(function(){function r(e,t,i,n){this._dimName=e,this._axisIndex=t,this.ecModel=n,this._dataZoomModel=i}return r.prototype.hostedBy=function(e){return this._dataZoomModel===e},r.prototype.getDataValueWindow=function(){return this._valueWindow.slice()},r.prototype.getDataPercentWindow=function(){return this._percentWindow.slice()},r.prototype.getTargetSeriesModels=function(){var e=[];return this.ecModel.eachSeries(function(t){if(gTe(t)){var i=Rg(this._dimName),n=t.getReferringComponents(i,ka).models[0];n&&this._axisIndex===n.componentIndex&&e.push(t)}},this),e},r.prototype.getAxisModel=function(){return this.ecModel.getComponent(this._dimName+"Axis",this._axisIndex)},r.prototype.getMinMaxSpan=function(){return hr(this._minMaxSpan)},r.prototype.calculateDataWindow=function(e){var t=this._dataExtent,i=this.getAxisModel(),n=i.axis.scale,a=this._dataZoomModel.getRangePropMode(),s=[0,100],o=[],l=[],c;h0(["start","end"],function(y,b){var S=e[y],C=e[y+"Value"];a[b]==="percent"?(S==null&&(S=s[b]),C=n.parse(Ii(S,s,t))):(c=!0,C=C==null?t[b]:n.parse(C),S=Ii(C,t,s)),l[b]=C==null||isNaN(C)?t[b]:C,o[b]=S==null||isNaN(S)?s[b]:S}),NV(l),NV(o);var f=this._minMaxSpan;c?p(l,o,t,s,!1):p(o,l,s,t,!0);function p(y,b,S,C,E){var P=E?"Span":"ValueSpan";Oy(0,y,S,"all",f["min"+P],f["max"+P]);for(var O=0;O<2;O++)b[O]=Ii(y[O],S,C,!0),E&&(b[O]=n.parse(b[O]))}return{valueWindow:l,percentWindow:o}},r.prototype.reset=function(e){if(e===this._dataZoomModel){var t=this.getTargetSeriesModels();this._dataExtent=bTe(this,this._dimName,t),this._updateMinMaxSpan();var i=this.calculateDataWindow(e.settledOption);this._valueWindow=i.valueWindow,this._percentWindow=i.percentWindow,this._setAxisModel()}},r.prototype.filterData=function(e,t){if(e!==this._dataZoomModel)return;var i=this._dimName,n=this.getTargetSeriesModels(),a=e.get("filterMode"),s=this._valueWindow;if(a==="none")return;h0(n,function(l){var c=l.getData(),f=c.mapDimensionsAll(i);if(f.length){if(a==="weakFilter"){var p=c.getStore(),y=wt(f,function(b){return c.getDimensionIndex(b)},c);c.filterSelf(function(b){for(var S,C,E,P=0;P<f.length;P++){var O=p.get(y[P],b),B=!isNaN(O),F=O<s[0],W=O>s[1];if(B&&!F&&!W)return!0;B&&(E=!0),F&&(S=!0),W&&(C=!0)}return E&&S&&C})}else h0(f,function(b){if(a==="empty")l.setData(c=c.map(b,function(C){return o(C)?C:NaN}));else{var S={};S[b]=s,c.selectRange(S)}});h0(f,function(b){c.setApproximateExtent(s,b)})}});function o(l){return l>=s[0]&&l<=s[1]}},r.prototype._updateMinMaxSpan=function(){var e=this._minMaxSpan={},t=this._dataZoomModel,i=this._dataExtent;h0(["min","max"],function(n){var a=t.get(n+"Span"),s=t.get(n+"ValueSpan");s!=null&&(s=this.getAxisModel().axis.scale.parse(s)),s!=null?a=Ii(i[0]+s,i,[0,100],!0):a!=null&&(s=Ii(a,[0,100],i,!0)-i[0]),e[n+"Span"]=a,e[n+"ValueSpan"]=s},this)},r.prototype._setAxisModel=function(){var e=this.getAxisModel(),t=this._percentWindow,i=this._valueWindow;if(t){var n=Tk(i,[0,500]);n=Math.min(n,20);var a=e.axis.scale.rawExtentInfo;t[0]!==0&&a.setDeterminedMinMax("min",+i[0].toFixed(n)),t[1]!==100&&a.setDeterminedMinMax("max",+i[1].toFixed(n)),a.freeze()}},r})();function bTe(r,e,t){var i=[1/0,-1/0];h0(t,function(s){Fge(i,s.getData(),e)});var n=r.getAxisModel(),a=uW(n.axis.scale,n,i).calculate();return[a.min,a.max]}var xTe={getTargetSeries:function(r){function e(n){r.eachComponent("dataZoom",function(a){a.eachTargetAxis(function(s,o){var l=r.getComponent(Rg(s),o);n(s,o,l,a)})})}e(function(n,a,s,o){s.__dzAxisProxy=null});var t=[];e(function(n,a,s,o){s.__dzAxisProxy||(s.__dzAxisProxy=new _Te(n,a,o,r),t.push(s.__dzAxisProxy))});var i=Qt();return se(t,function(n){se(n.getTargetSeriesModels(),function(a){i.set(a.uid,a)})}),i},overallReset:function(r,e){r.eachComponent("dataZoom",function(t){t.eachTargetAxis(function(i,n){t.getAxisProxy(i,n).reset(t)}),t.eachTargetAxis(function(i,n){t.getAxisProxy(i,n).filterData(t,e)})}),r.eachComponent("dataZoom",function(t){var i=t.findRepresentativeAxisProxy();if(i){var n=i.getDataPercentWindow(),a=i.getDataValueWindow();t.setCalculatedRange({start:n[0],end:n[1],startValue:a[0],endValue:a[1]})}})}};function wTe(r){r.registerAction("dataZoom",function(e,t){var i=vTe(t,e);se(i,function(n){n.setRawRange({start:e.start,end:e.end,startValue:e.startValue,endValue:e.endValue})})})}var BV=!1;function wO(r){BV||(BV=!0,r.registerProcessor(r.PRIORITY.PROCESSOR.FILTER,xTe),wTe(r),r.registerSubTypeDefaulter("dataZoom",function(){return"slider"}))}function STe(r){r.registerComponentModel(mTe),r.registerComponentView(yTe),wO(r)}var pc=(function(){function r(){}return r})(),GX={};function f0(r,e){GX[r]=e}function XX(r){return GX[r]}var TTe=(function(r){Ye(e,r);function e(){var t=r!==null&&r.apply(this,arguments)||this;return t.type=e.type,t}return e.prototype.optionUpdated=function(){r.prototype.optionUpdated.apply(this,arguments);var t=this.ecModel;se(this.option.feature,function(i,n){var a=XX(n);a&&(a.getDefaultOption&&(a.defaultOption=a.getDefaultOption(t)),Cr(i,a.defaultOption))})},e.type="toolbox",e.layoutMode={type:"box",ignoreSize:!0},e.defaultOption={show:!0,z:6,orient:"horizontal",left:"right",top:"top",backgroundColor:"transparent",borderColor:"#ccc",borderRadius:0,borderWidth:0,padding:5,itemSize:15,itemGap:8,showTitle:!0,iconStyle:{borderColor:"#666",color:"none"},emphasis:{iconStyle:{borderColor:"#3E98C5"}},tooltip:{show:!1,position:"bottom"}},e})(Wr);function ATe(r,e,t){var i=e.getBoxLayoutParams(),n=e.get("padding"),a={width:t.getWidth(),height:t.getHeight()},s=La(i,a,n);ny(e.get("orient"),r,e.get("itemGap"),s.width,s.height),XC(r,i,a,n)}function ZX(r,e){var t=Ry(e.get("padding")),i=e.getItemStyle(["color","opacity"]);return i.fill=e.get("backgroundColor"),r=new li({shape:{x:r.x-t[3],y:r.y-t[0],width:r.width+t[1]+t[3],height:r.height+t[0]+t[2],r:e.get("borderRadius")},style:i,silent:!0,z2:-1}),r}var CTe=(function(r){Ye(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.render=function(t,i,n,a){var s=this.group;if(s.removeAll(),!t.get("show"))return;var o=+t.get("itemSize"),l=t.get("orient")==="vertical",c=t.get("feature")||{},f=this._features||(this._features={}),p=[];se(c,function(S,C){p.push(C)}),new fp(this._featureNames||[],p).add(y).update(y).remove(Sr(y,null)).execute(),this._featureNames=p;function y(S,C){var E=p[S],P=p[C],O=c[E],B=new Si(O,t,t.ecModel),F;if(a&&a.newTitle!=null&&a.featureName===E&&(O.title=a.newTitle),E&&!P){if(MTe(E))F={onclick:B.option.onclick,featureName:E};else{var W=XX(E);if(!W)return;F=new W}f[E]=F}else if(F=f[P],!F)return;F.uid=db("toolbox-feature"),F.model=B,F.ecModel=i,F.api=n;var $=F instanceof pc;if(!E&&P){$&&F.dispose&&F.dispose(i,n);return}if(!B.get("show")||$&&F.unusable){$&&F.remove&&F.remove(i,n);return}b(B,F,E),B.setIconStatus=function(q,Q){var ee=this.option,te=this.iconPaths;ee.iconStatus=ee.iconStatus||{},ee.iconStatus[q]=Q,te[q]&&(Q==="emphasis"?cp:hp)(te[q])},F instanceof pc&&F.render&&F.render(B,i,n,a)}function b(S,C,E){var P=S.getModel("iconStyle"),O=S.getModel(["emphasis","iconStyle"]),B=C instanceof pc&&C.getIcons?C.getIcons():S.get("icon"),F=S.get("title")||{},W,$;$t(B)?(W={},W[E]=B):W=B,$t(F)?($={},$[E]=F):$=F;var q=S.iconPaths={};se(W,function(Q,ee){var te=hb(Q,{},{x:-o/2,y:-o/2,width:o,height:o});te.setStyle(P.getItemStyle());var ae=te.ensureState("emphasis");ae.style=O.getItemStyle();var de=new si({style:{text:$[ee],align:O.get("textAlign"),borderRadius:O.get("textBorderRadius"),padding:O.get("textPadding"),fill:null,font:$k({fontStyle:O.get("textFontStyle"),fontFamily:O.get("textFontFamily"),fontSize:O.get("textFontSize"),fontWeight:O.get("textFontWeight")},i)},ignore:!0});te.setTextContent(de),Iy({el:te,componentModel:t,itemName:ee,formatterParamsExtra:{title:$[ee]}}),te.__title=$[ee],te.on("mouseover",function(){var ve=O.getItemStyle(),ye=l?t.get("right")==null&&t.get("left")!=="right"?"right":"left":t.get("bottom")==null&&t.get("top")!=="bottom"?"bottom":"top";de.setStyle({fill:O.get("textFill")||ve.fill||ve.stroke||"#000",backgroundColor:O.get("textBackgroundColor")}),te.setTextConfig({position:O.get("textPosition")||ye}),de.ignore=!t.get("showTitle"),n.enterEmphasis(this)}).on("mouseout",function(){S.get(["iconStatus",ee])!=="emphasis"&&n.leaveEmphasis(this),de.hide()}),(S.get(["iconStatus",ee])==="emphasis"?cp:hp)(te),s.add(te),te.on("click",Xt(C.onclick,C,i,n,ee)),q[ee]=te})}ATe(s,t,n),s.add(ZX(s.getBoundingRect(),t)),l||s.eachChild(function(S){var C=S.__title,E=S.ensureState("emphasis"),P=E.textConfig||(E.textConfig={}),O=S.getTextContent(),B=O&&O.ensureState("emphasis");if(B&&!sr(B)&&C){var F=B.style||(B.style={}),W=Ww(C,si.makeFont(F)),$=S.x+s.x,q=S.y+s.y+o,Q=!1;q+W.height>n.getHeight()&&(P.position="top",Q=!0);var ee=Q?-5-W.height:o+10;$+W.width/2>n.getWidth()?(P.position=["100%",ee],F.align="right"):$-W.width/2<0&&(P.position=[0,ee],F.align="left")}})},e.prototype.updateView=function(t,i,n,a){se(this._features,function(s){s instanceof pc&&s.updateView&&s.updateView(s.model,i,n,a)})},e.prototype.remove=function(t,i){se(this._features,function(n){n instanceof pc&&n.remove&&n.remove(t,i)}),this.group.removeAll()},e.prototype.dispose=function(t,i){se(this._features,function(n){n instanceof pc&&n.dispose&&n.dispose(t,i)})},e.type="toolbox",e})(vn);function MTe(r){return r.indexOf("my")===0}var ETe=(function(r){Ye(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.onclick=function(t,i){var n=this.model,a=n.get("name")||t.get("title.0.text")||"echarts",s=i.getZr().painter.getType()==="svg",o=s?"svg":n.get("type",!0)||"png",l=i.getConnectedDataURL({type:o,backgroundColor:n.get("backgroundColor",!0)||t.get("backgroundColor")||"#fff",connectedBackgroundColor:n.get("connectedBackgroundColor"),excludeComponents:n.get("excludeComponents"),pixelRatio:n.get("pixelRatio")}),c=Gr.browser;if(typeof MouseEvent=="function"&&(c.newEdge||!c.ie&&!c.edge)){var f=document.createElement("a");f.download=a+"."+o,f.target="_blank",f.href=l;var p=new MouseEvent("click",{view:document.defaultView,bubbles:!0,cancelable:!1});f.dispatchEvent(p)}else if(window.navigator.msSaveOrOpenBlob||s){var y=l.split(","),b=y[0].indexOf("base64")>-1,S=s?decodeURIComponent(y[1]):y[1];b&&(S=window.atob(S));var C=a+"."+o;if(window.navigator.msSaveOrOpenBlob){for(var E=S.length,P=new Uint8Array(E);E--;)P[E]=S.charCodeAt(E);var O=new Blob([P]);window.navigator.msSaveOrOpenBlob(O,C)}else{var B=document.createElement("iframe");document.body.appendChild(B);var F=B.contentWindow,W=F.document;W.open("image/svg+xml","replace"),W.write(S),W.close(),F.focus(),W.execCommand("SaveAs",!0,C),document.body.removeChild(B)}}else{var $=n.get("lang"),q='<body style="margin:0;"><img src="'+l+'" style="max-width:100%;" title="'+($&&$[0]||"")+'" /></body>',Q=window.open();Q.document.write(q),Q.document.title=a}},e.getDefaultOption=function(t){var i={show:!0,icon:"M4.7,22.9L29.3,45.5L54.7,23.4M4.6,43.6L4.6,58L53.8,58L53.8,43.6M29.2,45.1L29.2,0",title:t.getLocaleModel().get(["toolbox","saveAsImage","title"]),type:"png",connectedBackgroundColor:"#fff",name:"",excludeComponents:["toolbox"],lang:t.getLocaleModel().get(["toolbox","saveAsImage","lang"])};return i},e})(pc),zV="__ec_magicType_stack__",ITe=[["line","bar"],["stack"]],PTe=(function(r){Ye(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.getIcons=function(){var t=this.model,i=t.get("icon"),n={};return se(t.get("type"),function(a){i[a]&&(n[a]=i[a])}),n},e.getDefaultOption=function(t){var i={show:!0,type:[],icon:{line:"M4.1,28.9h7.1l9.3-22l7.4,38l9.7-19.7l3,12.8h14.9M4.1,58h51.4",bar:"M6.7,22.9h10V48h-10V22.9zM24.9,13h10v35h-10V13zM43.2,2h10v46h-10V2zM3.1,58h53.7",stack:"M8.2,38.4l-8.4,4.1l30.6,15.3L60,42.5l-8.1-4.1l-21.5,11L8.2,38.4z M51.9,30l-8.1,4.2l-13.4,6.9l-13.9-6.9L8.2,30l-8.4,4.2l8.4,4.2l22.2,11l21.5-11l8.1-4.2L51.9,30z M51.9,21.7l-8.1,4.2L35.7,30l-5.3,2.8L24.9,30l-8.4-4.1l-8.3-4.2l-8.4,4.2L8.2,30l8.3,4.2l13.9,6.9l13.4-6.9l8.1-4.2l8.1-4.1L51.9,21.7zM30.4,2.2L-0.2,17.5l8.4,4.1l8.3,4.2l8.4,4.2l5.5,2.7l5.3-2.7l8.1-4.2l8.1-4.2l8.1-4.1L30.4,2.2z"},title:t.getLocaleModel().get(["toolbox","magicType","title"]),option:{},seriesIndex:{}};return i},e.prototype.onclick=function(t,i,n){var a=this.model,s=a.get(["seriesIndex",n]);if(FV[n]){var o={series:[]},l=function(p){var y=p.subType,b=p.id,S=FV[n](y,b,p,a);S&&(lr(S,p.option),o.series.push(S));var C=p.coordinateSystem;if(C&&C.type==="cartesian2d"&&(n==="line"||n==="bar")){var E=C.getAxesByScale("ordinal")[0];if(E){var P=E.dim,O=P+"Axis",B=p.getReferringComponents(O,ka).models[0],F=B.componentIndex;o[O]=o[O]||[];for(var W=0;W<=F;W++)o[O][F]=o[O][F]||{};o[O][F].boundaryGap=n==="bar"}}};se(ITe,function(p){Or(p,n)>=0&&se(p,function(y){a.setIconStatus(y,"normal")})}),a.setIconStatus(n,"emphasis"),t.eachComponent({mainType:"series",query:s==null?null:{seriesIndex:s}},l);var c,f=n;n==="stack"&&(c=Cr({stack:a.option.title.tiled,tiled:a.option.title.stack},a.option.title),a.get(["iconStatus",n])!=="emphasis"&&(f="tiled")),i.dispatchAction({type:"changeMagicType",currentType:f,newOption:o,newTitle:c,featureName:"magicType"})}},e})(pc),FV={line:function(r,e,t,i){if(r==="bar")return Cr({id:e,type:"line",data:t.get("data"),stack:t.get("stack"),markPoint:t.get("markPoint"),markLine:t.get("markLine")},i.get(["option","line"])||{},!0)},bar:function(r,e,t,i){if(r==="line")return Cr({id:e,type:"bar",data:t.get("data"),stack:t.get("stack"),markPoint:t.get("markPoint"),markLine:t.get("markLine")},i.get(["option","bar"])||{},!0)},stack:function(r,e,t,i){var n=t.get("stack")===zV;if(r==="line"||r==="bar")return i.setIconStatus("stack",n?"normal":"emphasis"),Cr({id:e,stack:n?"":zV},i.get(["option","stack"])||{},!0)}};Lh({type:"changeMagicType",event:"magicTypeChanged",update:"prepareAndUpdate"},function(r,e){e.mergeOption(r.newOption)});var hM=new Array(60).join("-"),eb="	";function RTe(r){var e={},t=[],i=[];return r.eachRawSeries(function(n){var a=n.coordinateSystem;if(a&&(a.type==="cartesian2d"||a.type==="polar")){var s=a.getBaseAxis();if(s.type==="category"){var o=s.dim+"_"+s.index;e[o]||(e[o]={categoryAxis:s,valueAxis:a.getOtherAxis(s),series:[]},i.push({axisDim:s.dim,axisIndex:s.index})),e[o].series.push(n)}else t.push(n)}else t.push(n)}),{seriesGroupByCategoryAxis:e,other:t,meta:i}}function DTe(r){var e=[];return se(r,function(t,i){var n=t.categoryAxis,a=t.valueAxis,s=a.dim,o=[" "].concat(wt(t.series,function(b){return b.name})),l=[n.model.getCategories()];se(t.series,function(b){var S=b.getRawData();l.push(b.getRawData().mapArray(S.mapDimension(s),function(C){return C}))});for(var c=[o.join(eb)],f=0;f<l[0].length;f++){for(var p=[],y=0;y<l.length;y++)p.push(l[y][f]);c.push(p.join(eb))}e.push(c.join(`
`))}),e.join(`

`+hM+`

`)}function kTe(r){return wt(r,function(e){var t=e.getRawData(),i=[e.name],n=[];return t.each(t.dimensions,function(){for(var a=arguments.length,s=arguments[a-1],o=t.getName(s),l=0;l<a-1;l++)n[l]=arguments[l];i.push((o?o+eb:"")+n.join(eb))}),i.join(`
`)}).join(`

`+hM+`

`)}function LTe(r){var e=RTe(r);return{value:wi([DTe(e.seriesGroupByCategoryAxis),kTe(e.other)],function(t){return!!t.replace(/[\n\t\s]/g,"")}).join(`

`+hM+`

`),meta:e.meta}}function nC(r){return r.replace(/^\s\s*/,"").replace(/\s\s*$/,"")}function OTe(r){var e=r.slice(0,r.indexOf(`
`));if(e.indexOf(eb)>=0)return!0}var rD=new RegExp("["+eb+"]+","g");function NTe(r){for(var e=r.split(/\n+/g),t=nC(e.shift()).split(rD),i=[],n=wt(t,function(l){return{name:l,data:[]}}),a=0;a<e.length;a++){var s=nC(e[a]).split(rD);i.push(s.shift());for(var o=0;o<s.length;o++)n[o]&&(n[o].data[a]=s[o])}return{series:n,categories:i}}function BTe(r){for(var e=r.split(/\n+/g),t=nC(e.shift()),i=[],n=0;n<e.length;n++){var a=nC(e[n]);if(a){var s=a.split(rD),o="",l=void 0,c=!1;isNaN(s[0])?(c=!0,o=s[0],s=s.slice(1),i[n]={name:o,value:[]},l=i[n].value):l=i[n]=[];for(var f=0;f<s.length;f++)l.push(+s[f]);l.length===1&&(c?i[n].value=l[0]:i[n]=l[0])}}return{name:t,data:i}}function zTe(r,e){var t=r.split(new RegExp(`
*`+hM+`
*`,"g")),i={series:[]};return se(t,function(n,a){if(OTe(n)){var s=NTe(n),o=e[a],l=o.axisDim+"Axis";o&&(i[l]=i[l]||[],i[l][o.axisIndex]={data:s.categories},i.series=i.series.concat(s.series))}else{var s=BTe(n);i.series.push(s)}}),i}var FTe=(function(r){Ye(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.onclick=function(t,i){setTimeout(function(){i.dispatchAction({type:"hideTip"})});var n=i.getDom(),a=this.model;this._dom&&n.removeChild(this._dom);var s=document.createElement("div");s.style.cssText="position:absolute;top:0;bottom:0;left:0;right:0;padding:5px",s.style.backgroundColor=a.get("backgroundColor")||"#fff";var o=document.createElement("h4"),l=a.get("lang")||[];o.innerHTML=l[0]||a.get("title"),o.style.cssText="margin:10px 20px",o.style.color=a.get("textColor");var c=document.createElement("div"),f=document.createElement("textarea");c.style.cssText="overflow:auto";var p=a.get("optionToContent"),y=a.get("contentToOption"),b=LTe(t);if(sr(p)){var S=p(i.getOption());$t(S)?c.innerHTML=S:gy(S)&&c.appendChild(S)}else{f.readOnly=a.get("readOnly");var C=f.style;C.cssText="display:block;width:100%;height:100%;font-family:monospace;font-size:14px;line-height:1.6rem;resize:none;box-sizing:border-box;outline:none",C.color=a.get("textColor"),C.borderColor=a.get("textareaBorderColor"),C.backgroundColor=a.get("textareaColor"),f.value=b.value,c.appendChild(f)}var E=b.meta,P=document.createElement("div");P.style.cssText="position:absolute;bottom:5px;left:0;right:0";var O="float:right;margin-right:20px;border:none;cursor:pointer;padding:2px 5px;font-size:12px;border-radius:3px",B=document.createElement("div"),F=document.createElement("div");O+=";background-color:"+a.get("buttonColor"),O+=";color:"+a.get("buttonTextColor");var W=this;function $(){n.removeChild(s),W._dom=null}DR(B,"click",$),DR(F,"click",function(){if(y==null&&p!=null||y!=null&&p==null){$();return}var q;try{sr(y)?q=y(c,i.getOption()):q=zTe(f.value,E)}catch(Q){throw $(),new Error("Data view format error "+Q)}q&&i.dispatchAction({type:"changeDataView",newOption:q}),$()}),B.innerHTML=l[1],F.innerHTML=l[2],F.style.cssText=B.style.cssText=O,!a.get("readOnly")&&P.appendChild(F),P.appendChild(B),s.appendChild(o),s.appendChild(c),s.appendChild(P),c.style.height=n.clientHeight-80+"px",n.appendChild(s),this._dom=s},e.prototype.remove=function(t,i){this._dom&&i.getDom().removeChild(this._dom)},e.prototype.dispose=function(t,i){this.remove(t,i)},e.getDefaultOption=function(t){var i={show:!0,readOnly:!1,optionToContent:null,contentToOption:null,icon:"M17.5,17.3H33 M17.5,17.3H33 M45.4,29.5h-28 M11.5,2v56H51V14.8L38.4,2H11.5z M38.4,2.2v12.7H51 M45.4,41.7h-28",title:t.getLocaleModel().get(["toolbox","dataView","title"]),lang:t.getLocaleModel().get(["toolbox","dataView","lang"]),backgroundColor:"#fff",textColor:"#000",textareaColor:"#fff",textareaBorderColor:"#333",buttonColor:"#c23531",buttonTextColor:"#fff"};return i},e})(pc);function VTe(r,e){return wt(r,function(t,i){var n=e&&e[i];if(cr(n)&&!xt(n)){var a=cr(t)&&!xt(t);a||(t={value:t});var s=n.name!=null&&t.name==null;return t=lr(t,n),s&&delete t.name,t}else return t})}Lh({type:"changeDataView",event:"dataViewChanged",update:"prepareAndUpdate"},function(r,e){var t=[];se(r.newOption.series,function(i){var n=e.getSeriesByName(i.name)[0];if(!n)t.push(mt({type:"scatter"},i));else{var a=n.get("data");t.push({name:i.name,data:VTe(i.data,a)})}}),e.mergeOption(lr({series:t},r.newOption))});var qX=se,YX=fi();function UTe(r,e){var t=SO(r);qX(e,function(i,n){for(var a=t.length-1;a>=0;a--){var s=t[a];if(s[n])break}if(a<0){var o=r.queryComponents({mainType:"dataZoom",subType:"select",id:n})[0];if(o){var l=o.getPercentRange();t[0][n]={dataZoomId:n,start:l[0],end:l[1]}}}}),t.push(e)}function HTe(r){var e=SO(r),t=e[e.length-1];e.length>1&&e.pop();var i={};return qX(t,function(n,a){for(var s=e.length-1;s>=0;s--)if(n=e[s][a],n){i[a]=n;break}}),i}function jTe(r){YX(r).snapshots=null}function $Te(r){return SO(r).length}function SO(r){var e=YX(r);return e.snapshots||(e.snapshots=[{}]),e.snapshots}var WTe=(function(r){Ye(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.onclick=function(t,i){jTe(t),i.dispatchAction({type:"restore",from:this.uid})},e.getDefaultOption=function(t){var i={show:!0,icon:"M3.8,33.4 M47,18.9h9.8V8.7 M56.3,20.1 C52.1,9,40.5,0.6,26.8,2.1C12.6,3.7,1.6,16.2,2.1,30.6 M13,41.1H3.1v10.2 M3.7,39.9c4.2,11.1,15.8,19.5,29.5,18 c14.2-1.6,25.2-14.1,24.7-28.5",title:t.getLocaleModel().get(["toolbox","restore","title"])};return i},e})(pc);Lh({type:"restore",event:"restore",update:"prepareAndUpdate"},function(r,e){e.resetOption("recreate")});var GTe=["grid","xAxis","yAxis","geo","graph","polar","radiusAxis","angleAxis","bmap"],TO=(function(){function r(e,t,i){var n=this;this._targetInfoList=[];var a=VV(t,e);se(XTe,function(s,o){(!i||!i.include||Or(i.include,o)>=0)&&s(a,n._targetInfoList)})}return r.prototype.setOutputRanges=function(e,t){return this.matchOutputRanges(e,t,function(i,n,a){if((i.coordRanges||(i.coordRanges=[])).push(n),!i.coordRange){i.coordRange=n;var s=CP[i.brushType](0,a,n);i.__rangeOffset={offset:$V[i.brushType](s.values,i.range,[1,1]),xyMinMax:s.xyMinMax}}}),e},r.prototype.matchOutputRanges=function(e,t,i){se(e,function(n){var a=this.findTargetInfo(n,t);a&&a!==!0&&se(a.coordSyses,function(s){var o=CP[n.brushType](1,s,n.range,!0);i(n,o.values,s,t)})},this)},r.prototype.setInputRanges=function(e,t){se(e,function(i){var n=this.findTargetInfo(i,t);if(i.range=i.range||[],n&&n!==!0){i.panelId=n.panelId;var a=CP[i.brushType](0,n.coordSys,i.coordRange),s=i.__rangeOffset;i.range=s?$V[i.brushType](a.values,s.offset,ZTe(a.xyMinMax,s.xyMinMax)):a.values}},this)},r.prototype.makePanelOpts=function(e,t){return wt(this._targetInfoList,function(i){var n=i.getPanelRect();return{panelId:i.panelId,defaultBrushType:t?t(i):null,clipPath:nX(n),isTargetByCursor:oX(n,e,i.coordSysModel),getLinearBrushOtherExtent:aX(n)}})},r.prototype.controlSeries=function(e,t,i){var n=this.findTargetInfo(e,i);return n===!0||n&&Or(n.coordSyses,t.coordinateSystem)>=0},r.prototype.findTargetInfo=function(e,t){for(var i=this._targetInfoList,n=VV(t,e),a=0;a<i.length;a++){var s=i[a],o=e.panelId;if(o){if(s.panelId===o)return s}else for(var l=0;l<UV.length;l++)if(UV[l](n,s))return s}return!0},r})();function iD(r){return r[0]>r[1]&&r.reverse(),r}function VV(r,e){return H1(r,e,{includeMainTypes:GTe})}var XTe={grid:function(r,e){var t=r.xAxisModels,i=r.yAxisModels,n=r.gridModels,a=Qt(),s={},o={};!t&&!i&&!n||(se(t,function(l){var c=l.axis.grid.model;a.set(c.id,c),s[c.id]=!0}),se(i,function(l){var c=l.axis.grid.model;a.set(c.id,c),o[c.id]=!0}),se(n,function(l){a.set(l.id,l),s[l.id]=!0,o[l.id]=!0}),a.each(function(l){var c=l.coordinateSystem,f=[];se(c.getCartesians(),function(p,y){(Or(t,p.getAxis("x").model)>=0||Or(i,p.getAxis("y").model)>=0)&&f.push(p)}),e.push({panelId:"grid--"+l.id,gridModel:l,coordSysModel:l,coordSys:f[0],coordSyses:f,getPanelRect:HV.grid,xAxisDeclared:s[l.id],yAxisDeclared:o[l.id]})}))},geo:function(r,e){se(r.geoModels,function(t){var i=t.coordinateSystem;e.push({panelId:"geo--"+t.id,geoModel:t,coordSysModel:t,coordSys:i,coordSyses:[i],getPanelRect:HV.geo})})}},UV=[function(r,e){var t=r.xAxisModel,i=r.yAxisModel,n=r.gridModel;return!n&&t&&(n=t.axis.grid.model),!n&&i&&(n=i.axis.grid.model),n&&n===e.gridModel},function(r,e){var t=r.geoModel;return t&&t===e.geoModel}],HV={grid:function(){return this.coordSys.master.getRect().clone()},geo:function(){var r=this.coordSys,e=r.getBoundingRect().clone();return e.applyTransform(Ng(r)),e}},CP={lineX:Sr(jV,0),lineY:Sr(jV,1),rect:function(r,e,t,i){var n=r?e.pointToData([t[0][0],t[1][0]],i):e.dataToPoint([t[0][0],t[1][0]],i),a=r?e.pointToData([t[0][1],t[1][1]],i):e.dataToPoint([t[0][1],t[1][1]],i),s=[iD([n[0],a[0]]),iD([n[1],a[1]])];return{values:s,xyMinMax:s}},polygon:function(r,e,t,i){var n=[[1/0,-1/0],[1/0,-1/0]],a=wt(t,function(s){var o=r?e.pointToData(s,i):e.dataToPoint(s,i);return n[0][0]=Math.min(n[0][0],o[0]),n[1][0]=Math.min(n[1][0],o[1]),n[0][1]=Math.max(n[0][1],o[0]),n[1][1]=Math.max(n[1][1],o[1]),o});return{values:a,xyMinMax:n}}};function jV(r,e,t,i){var n=t.getAxis(["x","y"][r]),a=iD(wt([0,1],function(o){return e?n.coordToData(n.toLocalCoord(i[o]),!0):n.toGlobalCoord(n.dataToCoord(i[o]))})),s=[];return s[r]=a,s[1-r]=[NaN,NaN],{values:a,xyMinMax:s}}var $V={lineX:Sr(WV,0),lineY:Sr(WV,1),rect:function(r,e,t){return[[r[0][0]-t[0]*e[0][0],r[0][1]-t[0]*e[0][1]],[r[1][0]-t[1]*e[1][0],r[1][1]-t[1]*e[1][1]]]},polygon:function(r,e,t){return wt(r,function(i,n){return[i[0]-t[0]*e[n][0],i[1]-t[1]*e[n][1]]})}};function WV(r,e,t,i){return[e[0]-i[r]*t[0],e[1]-i[r]*t[1]]}function ZTe(r,e){var t=GV(r),i=GV(e),n=[t[0]/i[0],t[1]/i[1]];return isNaN(n[0])&&(n[0]=1),isNaN(n[1])&&(n[1]=1),n}function GV(r){return r?[r[0][1]-r[0][0],r[1][1]-r[1][0]]:[NaN,NaN]}var nD=se,qTe=Hue("toolbox-dataZoom_"),YTe=(function(r){Ye(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.render=function(t,i,n,a){this._brushController||(this._brushController=new KL(n.getZr()),this._brushController.on("brush",Xt(this._onBrush,this)).mount()),JTe(t,i,this,a,n),QTe(t,i)},e.prototype.onclick=function(t,i,n){KTe[n].call(this)},e.prototype.remove=function(t,i){this._brushController&&this._brushController.unmount()},e.prototype.dispose=function(t,i){this._brushController&&this._brushController.dispose()},e.prototype._onBrush=function(t){var i=t.areas;if(!t.isEnd||!i.length)return;var n={},a=this.ecModel;this._brushController.updateCovers([]);var s=new TO(AO(this.model),a,{include:["grid"]});s.matchOutputRanges(i,a,function(c,f,p){if(p.type==="cartesian2d"){var y=c.brushType;y==="rect"?(o("x",p,f[0]),o("y",p,f[1])):o({lineX:"x",lineY:"y"}[y],p,f)}}),UTe(a,n),this._dispatchZoomAction(n);function o(c,f,p){var y=f.getAxis(c),b=y.model,S=l(c,b,a),C=S.findRepresentativeAxisProxy(b).getMinMaxSpan();(C.minValueSpan!=null||C.maxValueSpan!=null)&&(p=Oy(0,p.slice(),y.scale.getExtent(),0,C.minValueSpan,C.maxValueSpan)),S&&(n[S.id]={dataZoomId:S.id,startValue:p[0],endValue:p[1]})}function l(c,f,p){var y;return p.eachComponent({mainType:"dataZoom",subType:"select"},function(b){var S=b.getAxisModel(c,f.componentIndex);S&&(y=b)}),y}},e.prototype._dispatchZoomAction=function(t){var i=[];nD(t,function(n,a){i.push(hr(n))}),i.length&&this.api.dispatchAction({type:"dataZoom",from:this.uid,batch:i})},e.getDefaultOption=function(t){var i={show:!0,filterMode:"filter",icon:{zoom:"M0,13.5h26.9 M13.5,26.9V0 M32.1,13.5H58V58H13.5 V32.1",back:"M22,1.4L9.9,13.5l12.3,12.3 M10.3,13.5H54.9v44.6 H10.3v-26"},title:t.getLocaleModel().get(["toolbox","dataZoom","title"]),brushStyle:{borderWidth:0,color:"rgba(210,219,238,0.2)"}};return i},e})(pc),KTe={zoom:function(){var r=!this._isZoomActive;this.api.dispatchAction({type:"takeGlobalCursor",key:"dataZoomSelect",dataZoomSelectActive:r})},back:function(){this._dispatchZoomAction(HTe(this.ecModel))}};function AO(r){var e={xAxisIndex:r.get("xAxisIndex",!0),yAxisIndex:r.get("yAxisIndex",!0),xAxisId:r.get("xAxisId",!0),yAxisId:r.get("yAxisId",!0)};return e.xAxisIndex==null&&e.xAxisId==null&&(e.xAxisIndex="all"),e.yAxisIndex==null&&e.yAxisId==null&&(e.yAxisIndex="all"),e}function QTe(r,e){r.setIconStatus("back",$Te(e)>1?"emphasis":"normal")}function JTe(r,e,t,i,n){var a=t._isZoomActive;i&&i.type==="takeGlobalCursor"&&(a=i.key==="dataZoomSelect"?i.dataZoomSelectActive:!1),t._isZoomActive=a,r.setIconStatus("zoom",a?"emphasis":"normal");var s=new TO(AO(r),e,{include:["grid"]}),o=s.makePanelOpts(n,function(l){return l.xAxisDeclared&&!l.yAxisDeclared?"lineX":!l.xAxisDeclared&&l.yAxisDeclared?"lineY":"rect"});t._brushController.setPanels(o).enableBrush(a&&o.length?{brushType:"auto",brushStyle:r.getModel("brushStyle").getItemStyle()}:!1)}hfe("dataZoom",function(r){var e=r.getComponent("toolbox",0),t=["feature","dataZoom"];if(!e||e.get(t)==null)return;var i=e.getModel(t),n=[],a=AO(i),s=H1(r,a);nD(s.xAxisModels,function(l){return o(l,"xAxis","xAxisIndex")}),nD(s.yAxisModels,function(l){return o(l,"yAxis","yAxisIndex")});function o(l,c,f){var p=l.componentIndex,y={type:"select",$fromToolbox:!0,filterMode:i.get("filterMode",!0)||"filter",id:qTe+c+p};y[f]=p,n.push(y)}return n});function e2e(r){r.registerComponentModel(TTe),r.registerComponentView(CTe),f0("saveAsImage",ETe),f0("magicType",PTe),f0("dataView",FTe),f0("dataZoom",YTe),f0("restore",WTe),Vr(STe)}var t2e=(function(r){Ye(e,r);function e(){var t=r!==null&&r.apply(this,arguments)||this;return t.type=e.type,t}return e.type="tooltip",e.dependencies=["axisPointer"],e.defaultOption={z:60,show:!0,showContent:!0,trigger:"item",triggerOn:"mousemove|click",alwaysShowContent:!1,displayMode:"single",renderMode:"auto",confine:null,showDelay:0,hideDelay:100,transitionDuration:.4,enterable:!1,backgroundColor:"#fff",shadowBlur:10,shadowColor:"rgba(0, 0, 0, .2)",shadowOffsetX:1,shadowOffsetY:2,borderRadius:4,borderWidth:1,padding:null,extraCssText:"",axisPointer:{type:"line",axis:"auto",animation:"auto",animationDurationUpdate:200,animationEasingUpdate:"exponentialOut",crossStyle:{color:"#999",width:1,type:"dashed",textStyle:{}}},textStyle:{color:"#666",fontSize:14}},e})(Wr);function KX(r){var e=r.get("confine");return e!=null?!!e:r.get("renderMode")==="richText"}function QX(r){if(Gr.domSupported){for(var e=document.documentElement.style,t=0,i=r.length;t<i;t++)if(r[t]in e)return r[t]}}var JX=QX(["transform","webkitTransform","OTransform","MozTransform","msTransform"]),r2e=QX(["webkitTransition","transition","OTransition","MozTransition","msTransition"]);function eZ(r,e){if(!r)return e;e=Qk(e,!0);var t=r.indexOf(e);return r=t===-1?e:"-"+r.slice(0,t)+"-"+e,r.toLowerCase()}function i2e(r,e){var t=r.currentStyle||document.defaultView&&document.defaultView.getComputedStyle(r);return t?t[e]:null}var n2e=eZ(r2e,"transition"),CO=eZ(JX,"transform"),a2e="position:absolute;display:block;border-style:solid;white-space:nowrap;z-index:9999999;"+(Gr.transform3dSupported?"will-change:transform;":"");function o2e(r){return r=r==="left"?"right":r==="right"?"left":r==="top"?"bottom":"top",r}function s2e(r,e,t){if(!$t(t)||t==="inside")return"";var i=r.get("backgroundColor"),n=r.get("borderWidth");e=by(e);var a=o2e(t),s=Math.max(Math.round(n)*1.5,6),o="",l=CO+":",c;Or(["left","right"],a)>-1?(o+="top:50%",l+="translateY(-50%) rotate("+(c=a==="left"?-225:-45)+"deg)"):(o+="left:50%",l+="translateX(-50%) rotate("+(c=a==="top"?225:45)+"deg)");var f=c*Math.PI/180,p=s+n,y=p*Math.abs(Math.cos(f))+p*Math.abs(Math.sin(f)),b=Math.round(((y-Math.SQRT2*n)/2+Math.SQRT2*n-(y-p)/2)*100)/100;o+=";"+a+":-"+b+"px";var S=e+" solid "+n+"px;",C=["position:absolute;width:"+s+"px;height:"+s+"px;z-index:-1;",o+";"+l+";","border-bottom:"+S,"border-right:"+S,"background-color:"+i+";"];return'<div style="'+C.join("")+'"></div>'}function l2e(r,e){var t="cubic-bezier(0.23,1,0.32,1)",i=" "+r/2+"s "+t,n="opacity"+i+",visibility"+i;return e||(i=" "+r+"s "+t,n+=Gr.transformSupported?","+CO+i:",left"+i+",top"+i),n2e+":"+n}function XV(r,e,t){var i=r.toFixed(0)+"px",n=e.toFixed(0)+"px";if(!Gr.transformSupported)return t?"top:"+n+";left:"+i+";":[["top",n],["left",i]];var a=Gr.transform3dSupported,s="translate"+(a?"3d":"")+"("+i+","+n+(a?",0":"")+")";return t?"top:0;left:0;"+CO+":"+s+";":[["top",0],["left",0],[JX,s]]}function u2e(r){var e=[],t=r.get("fontSize"),i=r.getTextColor();i&&e.push("color:"+i),e.push("font:"+r.getFont());var n=wr(r.get("lineHeight"),Math.round(t*3/2));t&&e.push("line-height:"+n+"px");var a=r.get("textShadowColor"),s=r.get("textShadowBlur")||0,o=r.get("textShadowOffsetX")||0,l=r.get("textShadowOffsetY")||0;return a&&s&&e.push("text-shadow:"+o+"px "+l+"px "+s+"px "+a),se(["decoration","align"],function(c){var f=r.get(c);f&&e.push("text-"+c+":"+f)}),e.join(";")}function c2e(r,e,t){var i=[],n=r.get("transitionDuration"),a=r.get("backgroundColor"),s=r.get("shadowBlur"),o=r.get("shadowColor"),l=r.get("shadowOffsetX"),c=r.get("shadowOffsetY"),f=r.getModel("textStyle"),p=u9(r,"html"),y=l+"px "+c+"px "+s+"px "+o;return i.push("box-shadow:"+y),e&&n&&i.push(l2e(n,t)),a&&i.push("background-color:"+a),se(["width","color","radius"],function(b){var S="border-"+b,C=Qk(S),E=r.get(C);E!=null&&i.push(S+":"+E+(b==="color"?"":"px"))}),i.push(u2e(f)),p!=null&&i.push("padding:"+Ry(p).join("px ")+"px"),i.join(";")+";"}function ZV(r,e,t,i,n){var a=e&&e.painter;if(t){var s=a&&a.getViewportRoot();s&&vle(r,s,t,i,n)}else{r[0]=i,r[1]=n;var o=a&&a.getViewportRootOffset();o&&(r[0]+=o.offsetLeft,r[1]+=o.offsetTop)}r[2]=r[0]/e.getWidth(),r[3]=r[1]/e.getHeight()}var h2e=(function(){function r(e,t){if(this._show=!1,this._styleCoord=[0,0,0,0],this._enterable=!0,this._alwaysShowContent=!1,this._firstShow=!0,this._longHide=!0,Gr.wxa)return null;var i=document.createElement("div");i.domBelongToZr=!0,this.el=i;var n=this._zr=e.getZr(),a=t.appendTo,s=a&&($t(a)?document.querySelector(a):gy(a)?a:sr(a)&&a(e.getDom()));ZV(this._styleCoord,n,s,e.getWidth()/2,e.getHeight()/2),(s||e.getDom()).appendChild(i),this._api=e,this._container=s;var o=this;i.onmouseenter=function(){o._enterable&&(clearTimeout(o._hideTimeout),o._show=!0),o._inContent=!0},i.onmousemove=function(l){if(l=l||window.event,!o._enterable){var c=n.handler,f=n.painter.getViewportRoot();uc(f,l,!0),c.dispatch("mousemove",l)}},i.onmouseleave=function(){o._inContent=!1,o._enterable&&o._show&&o.hideLater(o._hideDelay)}}return r.prototype.update=function(e){if(!this._container){var t=this._api.getDom(),i=i2e(t,"position"),n=t.style;n.position!=="absolute"&&i!=="absolute"&&(n.position="relative")}var a=e.get("alwaysShowContent");a&&this._moveIfResized(),this._alwaysShowContent=a,this.el.className=e.get("className")||""},r.prototype.show=function(e,t){clearTimeout(this._hideTimeout),clearTimeout(this._longHideTimeout);var i=this.el,n=i.style,a=this._styleCoord;i.innerHTML?n.cssText=a2e+c2e(e,!this._firstShow,this._longHide)+XV(a[0],a[1],!0)+("border-color:"+by(t)+";")+(e.get("extraCssText")||"")+(";pointer-events:"+(this._enterable?"auto":"none")):n.display="none",this._show=!0,this._firstShow=!1,this._longHide=!1},r.prototype.setContent=function(e,t,i,n,a){var s=this.el;if(e==null){s.innerHTML="";return}var o="";if($t(a)&&i.get("trigger")==="item"&&!KX(i)&&(o=s2e(i,n,a)),$t(e))s.innerHTML=e+o;else if(e){s.innerHTML="",xt(e)||(e=[e]);for(var l=0;l<e.length;l++)gy(e[l])&&e[l].parentNode!==s&&s.appendChild(e[l]);if(o&&s.childNodes.length){var c=document.createElement("div");c.innerHTML=o,s.appendChild(c)}}},r.prototype.setEnterable=function(e){this._enterable=e},r.prototype.getSize=function(){var e=this.el;return e?[e.offsetWidth,e.offsetHeight]:[0,0]},r.prototype.moveTo=function(e,t){if(this.el){var i=this._styleCoord;if(ZV(i,this._zr,this._container,e,t),i[0]!=null&&i[1]!=null){var n=this.el.style,a=XV(i[0],i[1]);se(a,function(s){n[s[0]]=s[1]})}}},r.prototype._moveIfResized=function(){var e=this._styleCoord[2],t=this._styleCoord[3];this.moveTo(e*this._zr.getWidth(),t*this._zr.getHeight())},r.prototype.hide=function(){var e=this,t=this.el.style;t.visibility="hidden",t.opacity="0",Gr.transform3dSupported&&(t.willChange=""),this._show=!1,this._longHideTimeout=setTimeout(function(){return e._longHide=!0},500)},r.prototype.hideLater=function(e){this._show&&!(this._inContent&&this._enterable)&&!this._alwaysShowContent&&(e?(this._hideDelay=e,this._show=!1,this._hideTimeout=setTimeout(Xt(this.hide,this),e)):this.hide())},r.prototype.isShow=function(){return this._show},r.prototype.dispose=function(){clearTimeout(this._hideTimeout),clearTimeout(this._longHideTimeout);var e=this.el.parentNode;e&&e.removeChild(this.el),this.el=this._container=null},r})(),f2e=(function(){function r(e){this._show=!1,this._styleCoord=[0,0,0,0],this._alwaysShowContent=!1,this._enterable=!0,this._zr=e.getZr(),YV(this._styleCoord,this._zr,e.getWidth()/2,e.getHeight()/2)}return r.prototype.update=function(e){var t=e.get("alwaysShowContent");t&&this._moveIfResized(),this._alwaysShowContent=t},r.prototype.show=function(){this._hideTimeout&&clearTimeout(this._hideTimeout),this.el.show(),this._show=!0},r.prototype.setContent=function(e,t,i,n,a){var s=this;cr(e)&&Pi(""),this.el&&this._zr.remove(this.el);var o=i.getModel("textStyle");this.el=new si({style:{rich:t.richTextStyles,text:e,lineHeight:22,borderWidth:1,borderColor:n,textShadowColor:o.get("textShadowColor"),fill:i.get(["textStyle","color"]),padding:u9(i,"richText"),verticalAlign:"top",align:"left"},z:i.get("z")}),se(["backgroundColor","borderRadius","shadowColor","shadowBlur","shadowOffsetX","shadowOffsetY"],function(c){s.el.style[c]=i.get(c)}),se(["textShadowBlur","textShadowOffsetX","textShadowOffsetY"],function(c){s.el.style[c]=o.get(c)||0}),this._zr.add(this.el);var l=this;this.el.on("mouseover",function(){l._enterable&&(clearTimeout(l._hideTimeout),l._show=!0),l._inContent=!0}),this.el.on("mouseout",function(){l._enterable&&l._show&&l.hideLater(l._hideDelay),l._inContent=!1})},r.prototype.setEnterable=function(e){this._enterable=e},r.prototype.getSize=function(){var e=this.el,t=this.el.getBoundingRect(),i=qV(e.style);return[t.width+i.left+i.right,t.height+i.top+i.bottom]},r.prototype.moveTo=function(e,t){var i=this.el;if(i){var n=this._styleCoord;YV(n,this._zr,e,t),e=n[0],t=n[1];var a=i.style,s=mg(a.borderWidth||0),o=qV(a);i.x=e+s+o.left,i.y=t+s+o.top,i.markRedraw()}},r.prototype._moveIfResized=function(){var e=this._styleCoord[2],t=this._styleCoord[3];this.moveTo(e*this._zr.getWidth(),t*this._zr.getHeight())},r.prototype.hide=function(){this.el&&this.el.hide(),this._show=!1},r.prototype.hideLater=function(e){this._show&&!(this._inContent&&this._enterable)&&!this._alwaysShowContent&&(e?(this._hideDelay=e,this._show=!1,this._hideTimeout=setTimeout(Xt(this.hide,this),e)):this.hide())},r.prototype.isShow=function(){return this._show},r.prototype.dispose=function(){this._zr.remove(this.el)},r})();function mg(r){return Math.max(0,r)}function qV(r){var e=mg(r.shadowBlur||0),t=mg(r.shadowOffsetX||0),i=mg(r.shadowOffsetY||0);return{left:mg(e-t),right:mg(e+t),top:mg(e-i),bottom:mg(e+i)}}function YV(r,e,t,i){r[0]=t,r[1]=i,r[2]=r[0]/e.getWidth(),r[3]=r[1]/e.getHeight()}var d2e=new li({shape:{x:-1,y:-1,width:2,height:2}}),p2e=(function(r){Ye(e,r);function e(){var t=r!==null&&r.apply(this,arguments)||this;return t.type=e.type,t}return e.prototype.init=function(t,i){if(!(Gr.node||!i.getDom())){var n=t.getComponent("tooltip"),a=this._renderMode=que(n.get("renderMode"));this._tooltipContent=a==="richText"?new f2e(i):new h2e(i,{appendTo:n.get("appendToBody",!0)?"body":n.get("appendTo",!0)})}},e.prototype.render=function(t,i,n){if(!(Gr.node||!n.getDom())){this.group.removeAll(),this._tooltipModel=t,this._ecModel=i,this._api=n;var a=this._tooltipContent;a.update(t),a.setEnterable(t.get("enterable")),this._initGlobalListener(),this._keepShow(),this._renderMode!=="richText"&&t.get("transitionDuration")?yb(this,"_updatePosition",50,"fixRate"):bw(this,"_updatePosition")}},e.prototype._initGlobalListener=function(){var t=this._tooltipModel,i=t.get("triggerOn");zX("itemTooltip",this._api,Xt(function(n,a,s){i!=="none"&&(i.indexOf(n)>=0?this._tryShow(a,s):n==="leave"&&this._hide(s))},this))},e.prototype._keepShow=function(){var t=this._tooltipModel,i=this._ecModel,n=this._api,a=t.get("triggerOn");if(this._lastX!=null&&this._lastY!=null&&a!=="none"&&a!=="click"){var s=this;clearTimeout(this._refreshUpdateTimeout),this._refreshUpdateTimeout=setTimeout(function(){!n.isDisposed()&&s.manuallyShowTip(t,i,n,{x:s._lastX,y:s._lastY,dataByCoordSys:s._lastDataByCoordSys})})}},e.prototype.manuallyShowTip=function(t,i,n,a){if(!(a.from===this.uid||Gr.node||!n.getDom())){var s=KV(a,n);this._ticket="";var o=a.dataByCoordSys,l=y2e(a,i,n);if(l){var c=l.el.getBoundingRect().clone();c.applyTransform(l.el.transform),this._tryShow({offsetX:c.x+c.width/2,offsetY:c.y+c.height/2,target:l.el,position:a.position,positionDefault:"bottom"},s)}else if(a.tooltip&&a.x!=null&&a.y!=null){var f=d2e;f.x=a.x,f.y=a.y,f.update(),br(f).tooltipConfig={name:null,option:a.tooltip},this._tryShow({offsetX:a.x,offsetY:a.y,target:f},s)}else if(o)this._tryShow({offsetX:a.x,offsetY:a.y,position:a.position,dataByCoordSys:o,tooltipOption:a.tooltipOption},s);else if(a.seriesIndex!=null){if(this._manuallyAxisShowTip(t,i,n,a))return;var p=FX(a,i),y=p.point[0],b=p.point[1];y!=null&&b!=null&&this._tryShow({offsetX:y,offsetY:b,target:p.el,position:a.position,positionDefault:"bottom"},s)}else a.x!=null&&a.y!=null&&(n.dispatchAction({type:"updateAxisPointer",x:a.x,y:a.y}),this._tryShow({offsetX:a.x,offsetY:a.y,position:a.position,target:n.getZr().findHover(a.x,a.y).target},s))}},e.prototype.manuallyHideTip=function(t,i,n,a){var s=this._tooltipContent;this._tooltipModel&&s.hideLater(this._tooltipModel.get("hideDelay")),this._lastX=this._lastY=this._lastDataByCoordSys=null,a.from!==this.uid&&this._hide(KV(a,n))},e.prototype._manuallyAxisShowTip=function(t,i,n,a){var s=a.seriesIndex,o=a.dataIndex,l=i.getComponent("axisPointer").coordSysAxesInfo;if(!(s==null||o==null||l==null)){var c=i.getSeriesByIndex(s);if(c){var f=c.getData(),p=t1([f.getItemModel(o),c,(c.coordinateSystem||{}).model],this._tooltipModel);if(p.get("trigger")==="axis")return n.dispatchAction({type:"updateAxisPointer",seriesIndex:s,dataIndex:o,position:a.position}),!0}}},e.prototype._tryShow=function(t,i){var n=t.target,a=this._tooltipModel;if(a){this._lastX=t.offsetX,this._lastY=t.offsetY;var s=t.dataByCoordSys;if(s&&s.length)this._showAxisTooltip(s,t);else if(n){var o=br(n);if(o.ssrType==="legend")return;this._lastDataByCoordSys=null;var l,c;Wm(n,function(f){if(br(f).dataIndex!=null)return l=f,!0;if(br(f).tooltipConfig!=null)return c=f,!0},!0),l?this._showSeriesItemTooltip(t,l,i):c?this._showComponentItemTooltip(t,c,i):this._hide(i)}else this._lastDataByCoordSys=null,this._hide(i)}},e.prototype._showOrMove=function(t,i){var n=t.get("showDelay");i=Xt(i,this),clearTimeout(this._showTimout),n>0?this._showTimout=setTimeout(i,n):i()},e.prototype._showAxisTooltip=function(t,i){var n=this._ecModel,a=this._tooltipModel,s=[i.offsetX,i.offsetY],o=t1([i.tooltipOption],a),l=this._renderMode,c=[],f=po("section",{blocks:[],noHeader:!0}),p=[],y=new hI;se(t,function(O){se(O.dataByAxis,function(B){var F=n.getComponent(B.axisDim+"Axis",B.axisIndex),W=B.value;if(!(!F||W==null)){var $=OX(W,F.axis,n,B.seriesDataIndices,B.valueLabelOpt),q=po("section",{header:$,noHeader:!mc($),sortBlocks:!0,blocks:[]});f.blocks.push(q),se(B.seriesDataIndices,function(Q){var ee=n.getSeriesByIndex(Q.seriesIndex),te=Q.dataIndexInside,ae=ee.getDataParams(te);if(!(ae.dataIndex<0)){ae.axisDim=B.axisDim,ae.axisIndex=B.axisIndex,ae.axisType=B.axisType,ae.axisId=B.axisId,ae.axisValue=AL(F.axis,{value:W}),ae.axisValueLabel=$,ae.marker=y.makeTooltipMarker("item",by(ae.color),l);var de=zz(ee.formatTooltip(te,!0,null)),ve=de.frag;if(ve){var ye=t1([ee],a).get("valueFormatter");q.blocks.push(ye?mt({valueFormatter:ye},ve):ve)}de.text&&p.push(de.text),c.push(ae)}})}})}),f.blocks.reverse(),p.reverse();var b=i.position,S=o.get("order"),C=$z(f,y,l,S,n.get("useUTC"),o.get("textStyle"));C&&p.unshift(C);var E=l==="richText"?`

`:"<br/>",P=p.join(E);this._showOrMove(o,function(){this._updateContentNotChangedOnAxis(t,c)?this._updatePosition(o,b,s[0],s[1],this._tooltipContent,c):this._showTooltipContent(o,P,c,Math.random()+"",s[0],s[1],b,null,y)})},e.prototype._showSeriesItemTooltip=function(t,i,n){var a=this._ecModel,s=br(i),o=s.seriesIndex,l=a.getSeriesByIndex(o),c=s.dataModel||l,f=s.dataIndex,p=s.dataType,y=c.getData(p),b=this._renderMode,S=t.positionDefault,C=t1([y.getItemModel(f),c,l&&(l.coordinateSystem||{}).model],this._tooltipModel,S?{position:S}:null),E=C.get("trigger");if(!(E!=null&&E!=="item")){var P=c.getDataParams(f,p),O=new hI;P.marker=O.makeTooltipMarker("item",by(P.color),b);var B=zz(c.formatTooltip(f,!1,p)),F=C.get("order"),W=C.get("valueFormatter"),$=B.frag,q=$?$z(W?mt({valueFormatter:W},$):$,O,b,F,a.get("useUTC"),C.get("textStyle")):B.text,Q="item_"+c.name+"_"+f;this._showOrMove(C,function(){this._showTooltipContent(C,q,P,Q,t.offsetX,t.offsetY,t.position,t.target,O)}),n({type:"showTip",dataIndexInside:f,dataIndex:y.getRawIndex(f),seriesIndex:o,from:this.uid})}},e.prototype._showComponentItemTooltip=function(t,i,n){var a=this._renderMode==="html",s=br(i),o=s.tooltipConfig,l=o.option||{},c=l.encodeHTMLContent;if($t(l)){var f=l;l={content:f,formatter:f},c=!0}c&&a&&l.content&&(l=hr(l),l.content=Ms(l.content));var p=[l],y=this._ecModel.getComponent(s.componentMainType,s.componentIndex);y&&p.push(y),p.push({formatter:l.content});var b=t.positionDefault,S=t1(p,this._tooltipModel,b?{position:b}:null),C=S.get("content"),E=Math.random()+"",P=new hI;this._showOrMove(S,function(){var O=hr(S.get("formatterParams")||{});this._showTooltipContent(S,C,O,E,t.offsetX,t.offsetY,t.position,i,P)}),n({type:"showTip",from:this.uid})},e.prototype._showTooltipContent=function(t,i,n,a,s,o,l,c,f){if(this._ticket="",!(!t.get("showContent")||!t.get("show"))){var p=this._tooltipContent;p.setEnterable(t.get("enterable"));var y=t.get("formatter");l=l||t.get("position");var b=i,S=this._getNearestPoint([s,o],n,t.get("trigger"),t.get("borderColor")),C=S.color;if(y)if($t(y)){var E=t.ecModel.get("useUTC"),P=xt(n)?n[0]:n,O=P&&P.axisType&&P.axisType.indexOf("time")>=0;b=y,O&&(b=Qw(P.axisValue,b,E)),b=Jk(b,n,!0)}else if(sr(y)){var B=Xt(function(F,W){F===this._ticket&&(p.setContent(W,f,t,C,l),this._updatePosition(t,l,s,o,p,n,c))},this);this._ticket=a,b=y(n,a,B)}else b=y;p.setContent(b,f,t,C,l),p.show(t,C),this._updatePosition(t,l,s,o,p,n,c)}},e.prototype._getNearestPoint=function(t,i,n,a){if(n==="axis"||xt(i))return{color:a||(this._renderMode==="html"?"#fff":"none")};if(!xt(i))return{color:a||i.color||i.borderColor}},e.prototype._updatePosition=function(t,i,n,a,s,o,l){var c=this._api.getWidth(),f=this._api.getHeight();i=i||t.get("position");var p=s.getSize(),y=t.get("align"),b=t.get("verticalAlign"),S=l&&l.getBoundingRect().clone();if(l&&S.applyTransform(l.transform),sr(i)&&(i=i([n,a],o,s.el,S,{viewSize:[c,f],contentSize:p.slice()})),xt(i))n=Vt(i[0],c),a=Vt(i[1],f);else if(cr(i)){var C=i;C.width=p[0],C.height=p[1];var E=La(C,{width:c,height:f});n=E.x,a=E.y,y=null,b=null}else if($t(i)&&l){var P=m2e(i,S,p,t.get("borderWidth"));n=P[0],a=P[1]}else{var P=g2e(n,a,s,c,f,y?null:20,b?null:20);n=P[0],a=P[1]}if(y&&(n-=QV(y)?p[0]/2:y==="right"?p[0]:0),b&&(a-=QV(b)?p[1]/2:b==="bottom"?p[1]:0),KX(t)){var P=v2e(n,a,s,c,f);n=P[0],a=P[1]}s.moveTo(n,a)},e.prototype._updateContentNotChangedOnAxis=function(t,i){var n=this._lastDataByCoordSys,a=this._cbParamsList,s=!!n&&n.length===t.length;return s&&se(n,function(o,l){var c=o.dataByAxis||[],f=t[l]||{},p=f.dataByAxis||[];s=s&&c.length===p.length,s&&se(c,function(y,b){var S=p[b]||{},C=y.seriesDataIndices||[],E=S.seriesDataIndices||[];s=s&&y.value===S.value&&y.axisType===S.axisType&&y.axisId===S.axisId&&C.length===E.length,s&&se(C,function(P,O){var B=E[O];s=s&&P.seriesIndex===B.seriesIndex&&P.dataIndex===B.dataIndex}),a&&se(y.seriesDataIndices,function(P){var O=P.seriesIndex,B=i[O],F=a[O];B&&F&&F.data!==B.data&&(s=!1)})})}),this._lastDataByCoordSys=t,this._cbParamsList=i,!!s},e.prototype._hide=function(t){this._lastDataByCoordSys=null,t({type:"hideTip",from:this.uid})},e.prototype.dispose=function(t,i){Gr.node||!i.getDom()||(bw(this,"_updatePosition"),this._tooltipContent.dispose(),J3("itemTooltip",i))},e.type="tooltip",e})(vn);function t1(r,e,t){var i=e.ecModel,n;t?(n=new Si(t,i,i),n=new Si(e.option,n,i)):n=e;for(var a=r.length-1;a>=0;a--){var s=r[a];s&&(s instanceof Si&&(s=s.get("tooltip",!0)),$t(s)&&(s={formatter:s}),s&&(n=new Si(s,n,i)))}return n}function KV(r,e){return r.dispatchAction||Xt(e.dispatchAction,e)}function g2e(r,e,t,i,n,a,s){var o=t.getSize(),l=o[0],c=o[1];return a!=null&&(r+l+a+2>i?r-=l+a:r+=a),s!=null&&(e+c+s>n?e-=c+s:e+=s),[r,e]}function v2e(r,e,t,i,n){var a=t.getSize(),s=a[0],o=a[1];return r=Math.min(r+s,i)-s,e=Math.min(e+o,n)-o,r=Math.max(r,0),e=Math.max(e,0),[r,e]}function m2e(r,e,t,i){var n=t[0],a=t[1],s=Math.ceil(Math.SQRT2*i)+8,o=0,l=0,c=e.width,f=e.height;switch(r){case"inside":o=e.x+c/2-n/2,l=e.y+f/2-a/2;break;case"top":o=e.x+c/2-n/2,l=e.y-a-s;break;case"bottom":o=e.x+c/2-n/2,l=e.y+f+s;break;case"left":o=e.x-n-s,l=e.y+f/2-a/2;break;case"right":o=e.x+c+s,l=e.y+f/2-a/2}return[o,l]}function QV(r){return r==="center"||r==="middle"}function y2e(r,e,t){var i=Ik(r).queryOptionMap,n=i.keys()[0];if(!(!n||n==="series")){var a=Gw(e,n,i.get(n),{useDefault:!1,enableAll:!1,enableNone:!1}),s=a.models[0];if(s){var o=t.getViewOfComponentModel(s),l;if(o.group.traverse(function(c){var f=br(c).tooltipConfig;if(f&&f.name===r.name)return l=c,!0}),l)return{componentMainType:n,componentIndex:s.componentIndex,el:l}}}}function _2e(r){Vr(uS),r.registerComponentModel(t2e),r.registerComponentView(p2e),r.registerAction({type:"showTip",event:"showTip",update:"tooltip:manuallyShowTip"},ca),r.registerAction({type:"hideTip",event:"hideTip",update:"tooltip:manuallyHideTip"},ca)}var b2e=["rect","polygon","keep","clear"];function x2e(r,e){var t=Gi(r?r.brush:[]);if(t.length){var i=[];se(t,function(l){var c=l.hasOwnProperty("toolbox")?l.toolbox:[];c instanceof Array&&(i=i.concat(c))});var n=r&&r.toolbox;xt(n)&&(n=n[0]),n||(n={feature:{}},r.toolbox=[n]);var a=n.feature||(n.feature={}),s=a.brush||(a.brush={}),o=s.type||(s.type=[]);o.push.apply(o,i),w2e(o),e&&!o.length&&o.push.apply(o,b2e)}}function w2e(r){var e={};se(r,function(t){e[t]=1}),r.length=0,se(e,function(t,i){r.push(i)})}var JV=se;function eU(r){if(r){for(var e in r)if(r.hasOwnProperty(e))return!0}}function aD(r,e,t){var i={};return JV(e,function(a){var s=i[a]=n();JV(r[a],function(o,l){if(ho.isValidType(l)){var c={type:l,visual:o};t&&t(c,a),s[l]=new ho(c),l==="opacity"&&(c=hr(c),c.type="colorAlpha",s.__hidden.__alphaForOpacity=new ho(c))}})}),i;function n(){var a=function(){};a.prototype.__hidden=a.prototype;var s=new a;return s}}function tZ(r,e,t){var i;se(t,function(n){e.hasOwnProperty(n)&&eU(e[n])&&(i=!0)}),i&&se(t,function(n){e.hasOwnProperty(n)&&eU(e[n])?r[n]=hr(e[n]):delete r[n]})}function S2e(r,e,t,i,n,a){var s={};se(r,function(p){var y=ho.prepareVisualTypes(e[p]);s[p]=y});var o;function l(p){return uL(t,o,p)}function c(p,y){_9(t,o,p,y)}t.each(f);function f(p,y){o=p;var b=t.getRawDataItem(o);if(!(b&&b.visualMap===!1))for(var S=i.call(n,p),C=e[S],E=s[S],P=0,O=E.length;P<O;P++){var B=E[P];C[B]&&C[B].applyVisual(p,l,c)}}}function T2e(r,e,t,i){var n={};return se(r,function(a){var s=ho.prepareVisualTypes(e[a]);n[a]=s}),{progress:function(s,o){var l;i!=null&&(l=o.getDimensionIndex(i));function c(W){return uL(o,p,W)}function f(W,$){_9(o,p,W,$)}for(var p,y=o.getStore();(p=s.next())!=null;){var b=o.getRawDataItem(p);if(!(b&&b.visualMap===!1))for(var S=i!=null?y.get(l,p):p,C=t(S),E=e[C],P=n[C],O=0,B=P.length;O<B;O++){var F=P[O];E[F]&&E[F].applyVisual(S,c,f)}}}}}function A2e(r){var e=r.brushType,t={point:function(i){return tU[e].point(i,t,r)},rect:function(i){return tU[e].rect(i,t,r)}};return t}var tU={lineX:rU(0),lineY:rU(1),rect:{point:function(r,e,t){return r&&t.boundingRect.contain(r[0],r[1])},rect:function(r,e,t){return r&&t.boundingRect.intersect(r)}},polygon:{point:function(r,e,t){return r&&t.boundingRect.contain(r[0],r[1])&&Lm(t.range,r[0],r[1])},rect:function(r,e,t){var i=t.range;if(!r||i.length<=1)return!1;var n=r.x,a=r.y,s=r.width,o=r.height,l=i[0];if(Lm(i,n,a)||Lm(i,n+s,a)||Lm(i,n,a+o)||Lm(i,n+s,a+o)||Dr.create(r).contain(l[0],l[1])||y1(n,a,n+s,a,i)||y1(n,a,n,a+o,i)||y1(n+s,a,n+s,a+o,i)||y1(n,a+o,n+s,a+o,i))return!0}}};function rU(r){var e=["x","y"],t=["width","height"];return{point:function(i,n,a){if(i){var s=a.range,o=i[r];return r1(o,s)}},rect:function(i,n,a){if(i){var s=a.range,o=[i[e[r]],i[e[r]]+i[t[r]]];return o[1]<o[0]&&o.reverse(),r1(o[0],s)||r1(o[1],s)||r1(s[0],o)||r1(s[1],o)}}}}function r1(r,e){return e[0]<=r&&r<=e[1]}var iU=["inBrush","outOfBrush"],MP="__ecBrushSelect",oD="__ecInBrushSelectEvent";function rZ(r){r.eachComponent({mainType:"brush"},function(e){var t=e.brushTargetManager=new TO(e.option,r);t.setInputRanges(e.areas,r)})}function C2e(r,e,t){var i=[],n,a;r.eachComponent({mainType:"brush"},function(s){t&&t.type==="takeGlobalCursor"&&s.setBrushOption(t.key==="brush"?t.brushOption:{brushType:!1})}),rZ(r),r.eachComponent({mainType:"brush"},function(s,o){var l={brushId:s.id,brushIndex:o,brushName:s.name,areas:hr(s.areas),selected:[]};i.push(l);var c=s.option,f=c.brushLink,p=[],y=[],b=[],S=!1;o||(n=c.throttleType,a=c.throttleDelay);var C=wt(s.areas,function(W){var $=P2e[W.brushType],q=lr({boundingRect:$?$(W):void 0},W);return q.selectors=A2e(q),q}),E=aD(s.option,iU,function(W){W.mappingMethod="fixed"});xt(f)&&se(f,function(W){p[W]=1});function P(W){return f==="all"||!!p[W]}function O(W){return!!W.length}r.eachSeries(function(W,$){var q=b[$]=[];W.subType==="parallel"?B(W,$):F(W,$,q)});function B(W,$){var q=W.coordinateSystem;S=S||q.hasAxisBrushed(),P($)&&q.eachActiveState(W.getData(),function(Q,ee){Q==="active"&&(y[ee]=1)})}function F(W,$,q){if(!(!W.brushSelector||I2e(s,$))&&(se(C,function(ee){s.brushTargetManager.controlSeries(ee,W,r)&&q.push(ee),S=S||O(q)}),P($)&&O(q))){var Q=W.getData();Q.each(function(ee){nU(W,q,Q,ee)&&(y[ee]=1)})}}r.eachSeries(function(W,$){var q={seriesId:W.id,seriesIndex:$,seriesName:W.name,dataIndex:[]};l.selected.push(q);var Q=b[$],ee=W.getData(),te=P($)?function(ae){return y[ae]?(q.dataIndex.push(ee.getRawIndex(ae)),"inBrush"):"outOfBrush"}:function(ae){return nU(W,Q,ee,ae)?(q.dataIndex.push(ee.getRawIndex(ae)),"inBrush"):"outOfBrush"};(P($)?S:O(Q))&&S2e(iU,E,ee,te)})}),M2e(e,n,a,i,t)}function M2e(r,e,t,i,n){if(n){var a=r.getZr();if(!a[oD]){a[MP]||(a[MP]=E2e);var s=yb(a,MP,t,e);s(r,i)}}}function E2e(r,e){if(!r.isDisposed()){var t=r.getZr();t[oD]=!0,r.dispatchAction({type:"brushSelect",batch:e}),t[oD]=!1}}function nU(r,e,t,i){for(var n=0,a=e.length;n<a;n++){var s=e[n];if(r.brushSelector(i,t,s.selectors,s))return!0}}function I2e(r,e){var t=r.option.seriesIndex;return t!=null&&t!=="all"&&(xt(t)?Or(t,e)<0:e!==t)}var P2e={rect:function(r){return aU(r.range)},polygon:function(r){for(var e,t=r.range,i=0,n=t.length;i<n;i++){e=e||[[1/0,-1/0],[1/0,-1/0]];var a=t[i];a[0]<e[0][0]&&(e[0][0]=a[0]),a[0]>e[0][1]&&(e[0][1]=a[0]),a[1]<e[1][0]&&(e[1][0]=a[1]),a[1]>e[1][1]&&(e[1][1]=a[1])}return e&&aU(e)}};function aU(r){return new Dr(r[0][0],r[1][0],r[0][1]-r[0][0],r[1][1]-r[1][0])}var R2e=(function(r){Ye(e,r);function e(){var t=r!==null&&r.apply(this,arguments)||this;return t.type=e.type,t}return e.prototype.init=function(t,i){this.ecModel=t,this.api=i,this.model,(this._brushController=new KL(i.getZr())).on("brush",Xt(this._onBrush,this)).mount()},e.prototype.render=function(t,i,n,a){this.model=t,this._updateController(t,i,n,a)},e.prototype.updateTransform=function(t,i,n,a){rZ(i),this._updateController(t,i,n,a)},e.prototype.updateVisual=function(t,i,n,a){this.updateTransform(t,i,n,a)},e.prototype.updateView=function(t,i,n,a){this._updateController(t,i,n,a)},e.prototype._updateController=function(t,i,n,a){(!a||a.$from!==t.id)&&this._brushController.setPanels(t.brushTargetManager.makePanelOpts(n)).enableBrush(t.brushOption).updateCovers(t.areas.slice())},e.prototype.dispose=function(){this._brushController.dispose()},e.prototype._onBrush=function(t){var i=this.model.id,n=this.model.brushTargetManager.setOutputRanges(t.areas,this.ecModel);(!t.isEnd||t.removeOnClick)&&this.api.dispatchAction({type:"brush",brushId:i,areas:hr(n),$from:i}),t.isEnd&&this.api.dispatchAction({type:"brushEnd",brushId:i,areas:hr(n),$from:i})},e.type="brush",e})(vn),D2e="#ddd",k2e=(function(r){Ye(e,r);function e(){var t=r!==null&&r.apply(this,arguments)||this;return t.type=e.type,t.areas=[],t.brushOption={},t}return e.prototype.optionUpdated=function(t,i){var n=this.option;!i&&tZ(n,t,["inBrush","outOfBrush"]);var a=n.inBrush=n.inBrush||{};n.outOfBrush=n.outOfBrush||{color:D2e},a.hasOwnProperty("liftZ")||(a.liftZ=5)},e.prototype.setAreas=function(t){t&&(this.areas=wt(t,function(i){return oU(this.option,i)},this))},e.prototype.setBrushOption=function(t){this.brushOption=oU(this.option,t),this.brushType=this.brushOption.brushType},e.type="brush",e.dependencies=["geo","grid","xAxis","yAxis","parallel","series"],e.defaultOption={seriesIndex:"all",brushType:"rect",brushMode:"single",transformable:!0,brushStyle:{borderWidth:1,color:"rgba(210,219,238,0.3)",borderColor:"#D2DBEE"},throttleType:"fixRate",throttleDelay:0,removeOnClick:!0,z:1e4},e})(Wr);function oU(r,e){return Cr({brushType:r.brushType,brushMode:r.brushMode,transformable:r.transformable,brushStyle:new Si(r.brushStyle).getItemStyle(),removeOnClick:r.removeOnClick,z:r.z},e,!0)}var L2e=["rect","polygon","lineX","lineY","keep","clear"],O2e=(function(r){Ye(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.render=function(t,i,n){var a,s,o;i.eachComponent({mainType:"brush"},function(l){a=l.brushType,s=l.brushOption.brushMode||"single",o=o||!!l.areas.length}),this._brushType=a,this._brushMode=s,se(t.get("type",!0),function(l){t.setIconStatus(l,(l==="keep"?s==="multiple":l==="clear"?o:l===a)?"emphasis":"normal")})},e.prototype.updateView=function(t,i,n){this.render(t,i,n)},e.prototype.getIcons=function(){var t=this.model,i=t.get("icon",!0),n={};return se(t.get("type",!0),function(a){i[a]&&(n[a]=i[a])}),n},e.prototype.onclick=function(t,i,n){var a=this._brushType,s=this._brushMode;n==="clear"?(i.dispatchAction({type:"axisAreaSelect",intervals:[]}),i.dispatchAction({type:"brush",command:"clear",areas:[]})):i.dispatchAction({type:"takeGlobalCursor",key:"brush",brushOption:{brushType:n==="keep"?a:a===n?!1:n,brushMode:n==="keep"?s==="multiple"?"single":"multiple":s}})},e.getDefaultOption=function(t){var i={show:!0,type:L2e.slice(),icon:{rect:"M7.3,34.7 M0.4,10V-0.2h9.8 M89.6,10V-0.2h-9.8 M0.4,60v10.2h9.8 M89.6,60v10.2h-9.8 M12.3,22.4V10.5h13.1 M33.6,10.5h7.8 M49.1,10.5h7.8 M77.5,22.4V10.5h-13 M12.3,31.1v8.2 M77.7,31.1v8.2 M12.3,47.6v11.9h13.1 M33.6,59.5h7.6 M49.1,59.5 h7.7 M77.5,47.6v11.9h-13",polygon:"M55.2,34.9c1.7,0,3.1,1.4,3.1,3.1s-1.4,3.1-3.1,3.1 s-3.1-1.4-3.1-3.1S53.5,34.9,55.2,34.9z M50.4,51c1.7,0,3.1,1.4,3.1,3.1c0,1.7-1.4,3.1-3.1,3.1c-1.7,0-3.1-1.4-3.1-3.1 C47.3,52.4,48.7,51,50.4,51z M55.6,37.1l1.5-7.8 M60.1,13.5l1.6-8.7l-7.8,4 M59,19l-1,5.3 M24,16.1l6.4,4.9l6.4-3.3 M48.5,11.6 l-5.9,3.1 M19.1,12.8L9.7,5.1l1.1,7.7 M13.4,29.8l1,7.3l6.6,1.6 M11.6,18.4l1,6.1 M32.8,41.9 M26.6,40.4 M27.3,40.2l6.1,1.6 M49.9,52.1l-5.6-7.6l-4.9-1.2",lineX:"M15.2,30 M19.7,15.6V1.9H29 M34.8,1.9H40.4 M55.3,15.6V1.9H45.9 M19.7,44.4V58.1H29 M34.8,58.1H40.4 M55.3,44.4 V58.1H45.9 M12.5,20.3l-9.4,9.6l9.6,9.8 M3.1,29.9h16.5 M62.5,20.3l9.4,9.6L62.3,39.7 M71.9,29.9H55.4",lineY:"M38.8,7.7 M52.7,12h13.2v9 M65.9,26.6V32 M52.7,46.3h13.2v-9 M24.9,12H11.8v9 M11.8,26.6V32 M24.9,46.3H11.8v-9 M48.2,5.1l-9.3-9l-9.4,9.2 M38.9-3.9V12 M48.2,53.3l-9.3,9l-9.4-9.2 M38.9,62.3V46.4",keep:"M4,10.5V1h10.3 M20.7,1h6.1 M33,1h6.1 M55.4,10.5V1H45.2 M4,17.3v6.6 M55.6,17.3v6.6 M4,30.5V40h10.3 M20.7,40 h6.1 M33,40h6.1 M55.4,30.5V40H45.2 M21,18.9h62.9v48.6H21V18.9z",clear:"M22,14.7l30.9,31 M52.9,14.7L22,45.7 M4.7,16.8V4.2h13.1 M26,4.2h7.8 M41.6,4.2h7.8 M70.3,16.8V4.2H57.2 M4.7,25.9v8.6 M70.3,25.9v8.6 M4.7,43.2v12.6h13.1 M26,55.8h7.8 M41.6,55.8h7.8 M70.3,43.2v12.6H57.2"},title:t.getLocaleModel().get(["toolbox","brush","title"])};return i},e})(pc);function N2e(r){r.registerComponentView(R2e),r.registerComponentModel(k2e),r.registerPreprocessor(x2e),r.registerVisual(r.PRIORITY.VISUAL.BRUSH,C2e),r.registerAction({type:"brush",event:"brush",update:"updateVisual"},function(e,t){t.eachComponent({mainType:"brush",query:e},function(i){i.setAreas(e.areas)})}),r.registerAction({type:"brushSelect",event:"brushSelected",update:"none"},ca),r.registerAction({type:"brushEnd",event:"brushEnd",update:"none"},ca),f0("brush",O2e)}var B2e=(function(r){Ye(e,r);function e(){var t=r!==null&&r.apply(this,arguments)||this;return t.type=e.type,t.layoutMode={type:"box",ignoreSize:!0},t}return e.type="title",e.defaultOption={z:6,show:!0,text:"",target:"blank",subtext:"",subtarget:"blank",left:0,top:0,backgroundColor:"rgba(0,0,0,0)",borderColor:"#ccc",borderWidth:0,padding:5,itemGap:10,textStyle:{fontSize:18,fontWeight:"bold",color:"#464646"},subtextStyle:{fontSize:12,color:"#6E7079"}},e})(Wr),z2e=(function(r){Ye(e,r);function e(){var t=r!==null&&r.apply(this,arguments)||this;return t.type=e.type,t}return e.prototype.render=function(t,i,n){if(this.group.removeAll(),!!t.get("show")){var a=this.group,s=t.getModel("textStyle"),o=t.getModel("subtextStyle"),l=t.get("textAlign"),c=wr(t.get("textBaseline"),t.get("textVerticalAlign")),f=new si({style:cn(s,{text:t.get("text"),fill:s.getTextColor()},{disableBox:!0}),z2:10}),p=f.getBoundingRect(),y=t.get("subtext"),b=new si({style:cn(o,{text:y,fill:o.getTextColor(),y:p.height+t.get("itemGap"),verticalAlign:"top"},{disableBox:!0}),z2:10}),S=t.get("link"),C=t.get("sublink"),E=t.get("triggerEvent",!0);f.silent=!S&&!E,b.silent=!C&&!E,S&&f.on("click",function(){DA(S,"_"+t.get("target"))}),C&&b.on("click",function(){DA(C,"_"+t.get("subtarget"))}),br(f).eventData=br(b).eventData=E?{componentType:"title",componentIndex:t.componentIndex}:null,a.add(f),y&&a.add(b);var P=a.getBoundingRect(),O=t.getBoxLayoutParams();O.width=P.width,O.height=P.height;var B=La(O,{width:n.getWidth(),height:n.getHeight()},t.get("padding"));l||(l=t.get("left")||t.get("right"),l==="middle"&&(l="center"),l==="right"?B.x+=B.width:l==="center"&&(B.x+=B.width/2)),c||(c=t.get("top")||t.get("bottom"),c==="center"&&(c="middle"),c==="bottom"?B.y+=B.height:c==="middle"&&(B.y+=B.height/2),c=c||"top"),a.x=B.x,a.y=B.y,a.markRedraw();var F={align:l,verticalAlign:c};f.setStyle(F),b.setStyle(F),P=a.getBoundingRect();var W=B.margin,$=t.getItemStyle(["color","opacity"]);$.fill=t.get("backgroundColor");var q=new li({shape:{x:P.x-W[3],y:P.y-W[0],width:P.width+W[1]+W[3],height:P.height+W[0]+W[2],r:t.get("borderRadius")},style:$,subPixelOptimize:!0,silent:!0});a.add(q)}},e.type="title",e})(vn);function F2e(r){r.registerComponentModel(B2e),r.registerComponentView(z2e)}var sU=(function(r){Ye(e,r);function e(){var t=r!==null&&r.apply(this,arguments)||this;return t.type=e.type,t.layoutMode="box",t}return e.prototype.init=function(t,i,n){this.mergeDefaultAndTheme(t,n),this._initData()},e.prototype.mergeOption=function(t){r.prototype.mergeOption.apply(this,arguments),this._initData()},e.prototype.setCurrentIndex=function(t){t==null&&(t=this.option.currentIndex);var i=this._data.count();this.option.loop?t=(t%i+i)%i:(t>=i&&(t=i-1),t<0&&(t=0)),this.option.currentIndex=t},e.prototype.getCurrentIndex=function(){return this.option.currentIndex},e.prototype.isIndexMax=function(){return this.getCurrentIndex()>=this._data.count()-1},e.prototype.setPlayState=function(t){this.option.autoPlay=!!t},e.prototype.getPlayState=function(){return!!this.option.autoPlay},e.prototype._initData=function(){var t=this.option,i=t.data||[],n=t.axisType,a=this._names=[],s;n==="category"?(s=[],se(i,function(c,f){var p=Za(ab(c),""),y;cr(c)?(y=hr(c),y.value=f):y=f,s.push(y),a.push(p)})):s=i;var o={category:"ordinal",time:"time",value:"number"}[n]||"number",l=this._data=new Es([{name:"value",type:o}],this);l.initData(s,a)},e.prototype.getData=function(){return this._data},e.prototype.getCategories=function(){if(this.get("axisType")==="category")return this._names.slice()},e.type="timeline",e.defaultOption={z:4,show:!0,axisType:"time",realtime:!0,left:"20%",top:null,right:"20%",bottom:0,width:null,height:40,padding:5,controlPosition:"left",autoPlay:!1,rewind:!1,loop:!0,playInterval:2e3,currentIndex:0,itemStyle:{},label:{color:"#000"},data:[]},e})(Wr),iZ=(function(r){Ye(e,r);function e(){var t=r!==null&&r.apply(this,arguments)||this;return t.type=e.type,t}return e.type="timeline.slider",e.defaultOption=Yg(sU.defaultOption,{backgroundColor:"rgba(0,0,0,0)",borderColor:"#ccc",borderWidth:0,orient:"horizontal",inverse:!1,tooltip:{trigger:"item"},symbol:"circle",symbolSize:12,lineStyle:{show:!0,width:2,color:"#DAE1F5"},label:{position:"auto",show:!0,interval:"auto",rotate:0,color:"#A4B1D7"},itemStyle:{color:"#A4B1D7",borderWidth:1},checkpointStyle:{symbol:"circle",symbolSize:15,color:"#316bf3",borderColor:"#fff",borderWidth:2,shadowBlur:2,shadowOffsetX:1,shadowOffsetY:1,shadowColor:"rgba(0, 0, 0, 0.3)",animation:!0,animationDuration:300,animationEasing:"quinticInOut"},controlStyle:{show:!0,showPlayBtn:!0,showPrevBtn:!0,showNextBtn:!0,itemSize:24,itemGap:12,position:"left",playIcon:"path://M31.6,53C17.5,53,6,41.5,6,27.4S17.5,1.8,31.6,1.8C45.7,1.8,57.2,13.3,57.2,27.4S45.7,53,31.6,53z M31.6,3.3 C18.4,3.3,7.5,14.1,7.5,27.4c0,13.3,10.8,24.1,24.1,24.1C44.9,51.5,55.7,40.7,55.7,27.4C55.7,14.1,44.9,3.3,31.6,3.3z M24.9,21.3 c0-2.2,1.6-3.1,3.5-2l10.5,6.1c1.899,1.1,1.899,2.9,0,4l-10.5,6.1c-1.9,1.1-3.5,0.2-3.5-2V21.3z",stopIcon:"path://M30.9,53.2C16.8,53.2,5.3,41.7,5.3,27.6S16.8,2,30.9,2C45,2,56.4,13.5,56.4,27.6S45,53.2,30.9,53.2z M30.9,3.5C17.6,3.5,6.8,14.4,6.8,27.6c0,13.3,10.8,24.1,24.101,24.1C44.2,51.7,55,40.9,55,27.6C54.9,14.4,44.1,3.5,30.9,3.5z M36.9,35.8c0,0.601-0.4,1-0.9,1h-1.3c-0.5,0-0.9-0.399-0.9-1V19.5c0-0.6,0.4-1,0.9-1H36c0.5,0,0.9,0.4,0.9,1V35.8z M27.8,35.8 c0,0.601-0.4,1-0.9,1h-1.3c-0.5,0-0.9-0.399-0.9-1V19.5c0-0.6,0.4-1,0.9-1H27c0.5,0,0.9,0.4,0.9,1L27.8,35.8L27.8,35.8z",nextIcon:"M2,18.5A1.52,1.52,0,0,1,.92,18a1.49,1.49,0,0,1,0-2.12L7.81,9.36,1,3.11A1.5,1.5,0,1,1,3,.89l8,7.34a1.48,1.48,0,0,1,.49,1.09,1.51,1.51,0,0,1-.46,1.1L3,18.08A1.5,1.5,0,0,1,2,18.5Z",prevIcon:"M10,.5A1.52,1.52,0,0,1,11.08,1a1.49,1.49,0,0,1,0,2.12L4.19,9.64,11,15.89a1.5,1.5,0,1,1-2,2.22L1,10.77A1.48,1.48,0,0,1,.5,9.68,1.51,1.51,0,0,1,1,8.58L9,.92A1.5,1.5,0,0,1,10,.5Z",prevBtnSize:18,nextBtnSize:18,color:"#A4B1D7",borderColor:"#A4B1D7",borderWidth:1},emphasis:{label:{show:!0,color:"#6f778d"},itemStyle:{color:"#316BF3"},controlStyle:{color:"#316BF3",borderColor:"#316BF3",borderWidth:2}},progress:{lineStyle:{color:"#316BF3"},itemStyle:{color:"#316BF3"},label:{color:"#6f778d"}},data:[]}),e})(sU);ha(iZ,qC.prototype);var V2e=(function(r){Ye(e,r);function e(){var t=r!==null&&r.apply(this,arguments)||this;return t.type=e.type,t}return e.type="timeline",e})(vn),U2e=(function(r){Ye(e,r);function e(t,i,n,a){var s=r.call(this,t,i,n)||this;return s.type=a||"value",s}return e.prototype.getLabelModel=function(){return this.model.getModel("label")},e.prototype.isHorizontal=function(){return this.model.get("orient")==="horizontal"},e})(Pc),EP=Math.PI,lU=fi(),H2e=(function(r){Ye(e,r);function e(){var t=r!==null&&r.apply(this,arguments)||this;return t.type=e.type,t}return e.prototype.init=function(t,i){this.api=i},e.prototype.render=function(t,i,n){if(this.model=t,this.api=n,this.ecModel=i,this.group.removeAll(),t.get("show",!0)){var a=this._layout(t,n),s=this._createGroup("_mainGroup"),o=this._createGroup("_labelGroup"),l=this._axis=this._createAxis(a,t);t.formatTooltip=function(c){var f=l.scale.getLabel({value:c});return po("nameValue",{noName:!0,value:f})},se(["AxisLine","AxisTick","Control","CurrentPointer"],function(c){this["_render"+c](a,s,l,t)},this),this._renderAxisLabel(a,o,l,t),this._position(a,t)}this._doPlayStop(),this._updateTicksStatus()},e.prototype.remove=function(){this._clearTimer(),this.group.removeAll()},e.prototype.dispose=function(){this._clearTimer()},e.prototype._layout=function(t,i){var n=t.get(["label","position"]),a=t.get("orient"),s=$2e(t,i),o;n==null||n==="auto"?o=a==="horizontal"?s.y+s.height/2<i.getHeight()/2?"-":"+":s.x+s.width/2<i.getWidth()/2?"+":"-":$t(n)?o={horizontal:{top:"-",bottom:"+"},vertical:{left:"-",right:"+"}}[a][n]:o=n;var l={horizontal:"center",vertical:o>=0||o==="+"?"left":"right"},c={horizontal:o>=0||o==="+"?"top":"bottom",vertical:"middle"},f={horizontal:0,vertical:EP/2},p=a==="vertical"?s.height:s.width,y=t.getModel("controlStyle"),b=y.get("show",!0),S=b?y.get("itemSize"):0,C=b?y.get("itemGap"):0,E=S+C,P=t.get(["label","rotate"])||0;P=P*EP/180;var O,B,F,W=y.get("position",!0),$=b&&y.get("showPlayBtn",!0),q=b&&y.get("showPrevBtn",!0),Q=b&&y.get("showNextBtn",!0),ee=0,te=p;W==="left"||W==="bottom"?($&&(O=[0,0],ee+=E),q&&(B=[ee,0],ee+=E),Q&&(F=[te-S,0],te-=E)):($&&(O=[te-S,0],te-=E),q&&(B=[0,0],ee+=E),Q&&(F=[te-S,0],te-=E));var ae=[ee,te];return t.get("inverse")&&ae.reverse(),{viewRect:s,mainLength:p,orient:a,rotation:f[a],labelRotation:P,labelPosOpt:o,labelAlign:t.get(["label","align"])||l[a],labelBaseline:t.get(["label","verticalAlign"])||t.get(["label","baseline"])||c[a],playPosition:O,prevBtnPosition:B,nextBtnPosition:F,axisExtent:ae,controlSize:S,controlGap:C}},e.prototype._position=function(t,i){var n=this._mainGroup,a=this._labelGroup,s=t.viewRect;if(t.orient==="vertical"){var o=kl(),l=s.x,c=s.y+s.height;Ph(o,o,[-l,-c]),Zg(o,o,-EP/2),Ph(o,o,[l,c]),s=s.clone(),s.applyTransform(o)}var f=O(s),p=O(n.getBoundingRect()),y=O(a.getBoundingRect()),b=[n.x,n.y],S=[a.x,a.y];S[0]=b[0]=f[0][0];var C=t.labelPosOpt;if(C==null||$t(C)){var E=C==="+"?0:1;B(b,p,f,1,E),B(S,y,f,1,1-E)}else{var E=C>=0?0:1;B(b,p,f,1,E),S[1]=b[1]+C}n.setPosition(b),a.setPosition(S),n.rotation=a.rotation=t.rotation,P(n),P(a);function P(F){F.originX=f[0][0]-F.x,F.originY=f[1][0]-F.y}function O(F){return[[F.x,F.x+F.width],[F.y,F.y+F.height]]}function B(F,W,$,q,Q){F[q]+=$[q][Q]-W[q][Q]}},e.prototype._createAxis=function(t,i){var n=i.getData(),a=i.get("axisType"),s=j2e(i,a);s.getTicks=function(){return n.mapArray(["value"],function(c){return{value:c}})};var o=n.getDataExtent("value");s.setExtent(o[0],o[1]),s.calcNiceTicks();var l=new U2e("value",s,t.axisExtent,a);return l.model=i,l},e.prototype._createGroup=function(t){var i=this[t]=new mr;return this.group.add(i),i},e.prototype._renderAxisLine=function(t,i,n,a){var s=n.getExtent();if(a.get(["lineStyle","show"])){var o=new qa({shape:{x1:s[0],y1:0,x2:s[1],y2:0},style:mt({lineCap:"round"},a.getModel("lineStyle").getLineStyle()),silent:!0,z2:1});i.add(o);var l=this._progressLine=new qa({shape:{x1:s[0],x2:this._currentPointer?this._currentPointer.x:s[0],y1:0,y2:0},style:lr({lineCap:"round",lineWidth:o.style.lineWidth},a.getModel(["progress","lineStyle"]).getLineStyle()),silent:!0,z2:1});i.add(l)}},e.prototype._renderAxisTick=function(t,i,n,a){var s=this,o=a.getData(),l=n.scale.getTicks();this._tickSymbols=[],se(l,function(c){var f=n.dataToCoord(c.value),p=o.getItemModel(c.value),y=p.getModel("itemStyle"),b=p.getModel(["emphasis","itemStyle"]),S=p.getModel(["progress","itemStyle"]),C={x:f,y:0,onclick:Xt(s._changeTimeline,s,c.value)},E=uU(p,y,i,C);E.ensureState("emphasis").style=b.getItemStyle(),E.ensureState("progress").style=S.getItemStyle(),Og(E);var P=br(E);p.get("tooltip")?(P.dataIndex=c.value,P.dataModel=a):P.dataIndex=P.dataModel=null,s._tickSymbols.push(E)})},e.prototype._renderAxisLabel=function(t,i,n,a){var s=this,o=n.getLabelModel();if(o.get("show")){var l=a.getData(),c=n.getViewLabels();this._tickLabels=[],se(c,function(f){var p=f.tickValue,y=l.getItemModel(p),b=y.getModel("label"),S=y.getModel(["emphasis","label"]),C=y.getModel(["progress","label"]),E=n.dataToCoord(f.tickValue),P=new si({x:E,y:0,rotation:t.labelRotation-t.rotation,onclick:Xt(s._changeTimeline,s,p),silent:!1,style:cn(b,{text:f.formattedLabel,align:t.labelAlign,verticalAlign:t.labelBaseline})});P.ensureState("emphasis").style=cn(S),P.ensureState("progress").style=cn(C),i.add(P),Og(P),lU(P).dataIndex=p,s._tickLabels.push(P)})}},e.prototype._renderControl=function(t,i,n,a){var s=t.controlSize,o=t.rotation,l=a.getModel("controlStyle").getItemStyle(),c=a.getModel(["emphasis","controlStyle"]).getItemStyle(),f=a.getPlayState(),p=a.get("inverse",!0);y(t.nextBtnPosition,"next",Xt(this._changeTimeline,this,p?"-":"+")),y(t.prevBtnPosition,"prev",Xt(this._changeTimeline,this,p?"+":"-")),y(t.playPosition,f?"stop":"play",Xt(this._handlePlayClick,this,!f),!0);function y(b,S,C,E){if(b){var P=Rh(wr(a.get(["controlStyle",S+"BtnSize"]),s),s),O=[0,-P/2,P,P],B=W2e(a,S+"Icon",O,{x:b[0],y:b[1],originX:s/2,originY:0,rotation:E?-o:0,rectHover:!0,style:l,onclick:C});B.ensureState("emphasis").style=c,i.add(B),Og(B)}}},e.prototype._renderCurrentPointer=function(t,i,n,a){var s=a.getData(),o=a.getCurrentIndex(),l=s.getItemModel(o).getModel("checkpointStyle"),c=this,f={onCreate:function(p){p.draggable=!0,p.drift=Xt(c._handlePointerDrag,c),p.ondragend=Xt(c._handlePointerDragend,c),cU(p,c._progressLine,o,n,a,!0)},onUpdate:function(p){cU(p,c._progressLine,o,n,a)}};this._currentPointer=uU(l,l,this._mainGroup,{},this._currentPointer,f)},e.prototype._handlePlayClick=function(t){this._clearTimer(),this.api.dispatchAction({type:"timelinePlayChange",playState:t,from:this.uid})},e.prototype._handlePointerDrag=function(t,i,n){this._clearTimer(),this._pointerChangeTimeline([n.offsetX,n.offsetY])},e.prototype._handlePointerDragend=function(t){this._pointerChangeTimeline([t.offsetX,t.offsetY],!0)},e.prototype._pointerChangeTimeline=function(t,i){var n=this._toAxisCoord(t)[0],a=this._axis,s=yu(a.getExtent().slice());n>s[1]&&(n=s[1]),n<s[0]&&(n=s[0]),this._currentPointer.x=n,this._currentPointer.markRedraw();var o=this._progressLine;o&&(o.shape.x2=n,o.dirty());var l=this._findNearestTick(n),c=this.model;(i||l!==c.getCurrentIndex()&&c.get("realtime"))&&this._changeTimeline(l)},e.prototype._doPlayStop=function(){var t=this;this._clearTimer(),this.model.getPlayState()&&(this._timer=setTimeout(function(){var i=t.model;t._changeTimeline(i.getCurrentIndex()+(i.get("rewind",!0)?-1:1))},this.model.get("playInterval")))},e.prototype._toAxisCoord=function(t){var i=this._mainGroup.getLocalTransform();return Mh(t,i,!0)},e.prototype._findNearestTick=function(t){var i=this.model.getData(),n=1/0,a,s=this._axis;return i.each(["value"],function(o,l){var c=s.dataToCoord(o),f=Math.abs(c-t);f<n&&(n=f,a=l)}),a},e.prototype._clearTimer=function(){this._timer&&(clearTimeout(this._timer),this._timer=null)},e.prototype._changeTimeline=function(t){var i=this.model.getCurrentIndex();t==="+"?t=i+1:t==="-"&&(t=i-1),this.api.dispatchAction({type:"timelineChange",currentIndex:t,from:this.uid})},e.prototype._updateTicksStatus=function(){var t=this.model.getCurrentIndex(),i=this._tickSymbols,n=this._tickLabels;if(i)for(var a=0;a<i.length;a++)i&&i[a]&&i[a].toggleState("progress",a<t);if(n)for(var a=0;a<n.length;a++)n&&n[a]&&n[a].toggleState("progress",lU(n[a]).dataIndex<=t)},e.type="timeline.slider",e})(V2e);function j2e(r,e){if(e=e||r.get("type"),e)switch(e){case"category":return new iM({ordinalMeta:r.getCategories(),extent:[1/0,-1/0]});case"time":return new SL({locale:r.ecModel.getLocaleModel(),useUTC:r.ecModel.get("useUTC")});default:return new pp}}function $2e(r,e){return La(r.getBoxLayoutParams(),{width:e.getWidth(),height:e.getHeight()},r.get("padding"))}function W2e(r,e,t,i){var n=i.style,a=hb(r.get(["controlStyle",e]),i||{},new Dr(t[0],t[1],t[2],t[3]));return n&&a.setStyle(n),a}function uU(r,e,t,i,n,a){var s=e.get("color");if(n)n.setColor(s),t.add(n),a&&a.onUpdate(n);else{var o=r.get("symbol");n=Aa(o,-1,-1,2,2,s),n.setStyle("strokeNoScale",!0),t.add(n),a&&a.onCreate(n)}var l=e.getItemStyle(["color"]);n.setStyle(l),i=Cr({rectHover:!0,z2:100},i,!0);var c=_b(r.get("symbolSize"));i.scaleX=c[0]/2,i.scaleY=c[1]/2;var f=Dy(r.get("symbolOffset"),c);f&&(i.x=(i.x||0)+f[0],i.y=(i.y||0)+f[1]);var p=r.get("symbolRotate");return i.rotation=(p||0)*Math.PI/180||0,n.attr(i),n.updateTransform(),n}function cU(r,e,t,i,n,a){if(!r.dragging){var s=n.getModel("checkpointStyle"),o=i.dataToCoord(n.getData().get("value",t));if(a||!s.get("animation",!0))r.attr({x:o,y:0}),e&&e.attr({shape:{x2:o}});else{var l={duration:s.get("animationDuration",!0),easing:s.get("animationEasing",!0)};r.stopAnimation(null,!0),r.animateTo({x:o,y:0},l),e&&e.animateTo({shape:{x2:o}},l)}}}function G2e(r){r.registerAction({type:"timelineChange",event:"timelineChanged",update:"prepareAndUpdate"},function(e,t,i){var n=t.getComponent("timeline");return n&&e.currentIndex!=null&&(n.setCurrentIndex(e.currentIndex),!n.get("loop",!0)&&n.isIndexMax()&&n.getPlayState()&&(n.setPlayState(!1),i.dispatchAction({type:"timelinePlayChange",playState:!1,from:e.from}))),t.resetOption("timeline",{replaceMerge:n.get("replaceMerge",!0)}),lr({currentIndex:n.option.currentIndex},e)}),r.registerAction({type:"timelinePlayChange",event:"timelinePlayChanged",update:"update"},function(e,t){var i=t.getComponent("timeline");i&&e.playState!=null&&i.setPlayState(e.playState)})}function X2e(r){var e=r&&r.timeline;xt(e)||(e=e?[e]:[]),se(e,function(t){t&&Z2e(t)})}function Z2e(r){var e=r.type,t={number:"value",time:"time"};if(t[e]&&(r.axisType=t[e],delete r.type),hU(r),Bm(r,"controlPosition")){var i=r.controlStyle||(r.controlStyle={});Bm(i,"position")||(i.position=r.controlPosition),i.position==="none"&&!Bm(i,"show")&&(i.show=!1,delete i.position),delete r.controlPosition}se(r.data||[],function(n){cr(n)&&!xt(n)&&(!Bm(n,"value")&&Bm(n,"name")&&(n.value=n.name),hU(n))})}function hU(r){var e=r.itemStyle||(r.itemStyle={}),t=e.emphasis||(e.emphasis={}),i=r.label||r.label||{},n=i.normal||(i.normal={}),a={normal:1,emphasis:1};se(i,function(s,o){!a[o]&&!Bm(n,o)&&(n[o]=s)}),t.label&&!Bm(i,"emphasis")&&(i.emphasis=t.label,delete t.label)}function Bm(r,e){return r.hasOwnProperty(e)}function q2e(r){r.registerComponentModel(iZ),r.registerComponentView(H2e),r.registerSubTypeDefaulter("timeline",function(){return"slider"}),G2e(r),r.registerPreprocessor(X2e)}function MO(r,e){if(!r)return!1;for(var t=xt(r)?r:[r],i=0;i<t.length;i++)if(t[i]&&t[i][e])return!0;return!1}function h2(r){vy(r,"label",["show"])}var f2=fi(),vp=(function(r){Ye(e,r);function e(){var t=r!==null&&r.apply(this,arguments)||this;return t.type=e.type,t.createdBySelf=!1,t}return e.prototype.init=function(t,i,n){this.mergeDefaultAndTheme(t,n),this._mergeOption(t,n,!1,!0)},e.prototype.isAnimationEnabled=function(){if(Gr.node)return!1;var t=this.__hostSeries;return this.getShallow("animation")&&t&&t.isAnimationEnabled()},e.prototype.mergeOption=function(t,i){this._mergeOption(t,i,!1,!1)},e.prototype._mergeOption=function(t,i,n,a){var s=this.mainType;n||i.eachSeries(function(o){var l=o.get(this.mainType,!0),c=f2(o)[s];if(!l||!l.data){f2(o)[s]=null;return}c?c._mergeOption(l,i,!0):(a&&h2(l),se(l.data,function(f){f instanceof Array?(h2(f[0]),h2(f[1])):h2(f)}),c=this.createMarkerModelFromSeries(l,this,i),mt(c,{mainType:this.mainType,seriesIndex:o.seriesIndex,name:o.name,createdBySelf:!0}),c.__hostSeries=o),f2(o)[s]=c},this)},e.prototype.formatTooltip=function(t,i,n){var a=this.getData(),s=this.getRawValue(t),o=a.getName(t);return po("section",{header:this.name,blocks:[po("nameValue",{name:o,value:s,noName:!o,noValue:s==null})]})},e.prototype.getData=function(){return this._data},e.prototype.setData=function(t){this._data=t},e.prototype.getDataParams=function(t,i){var n=qC.prototype.getDataParams.call(this,t,i),a=this.__hostSeries;return a&&(n.seriesId=a.id,n.seriesName=a.name,n.seriesType=a.subType),n},e.getMarkerModelFromSeries=function(t,i){return f2(t)[i]},e.type="marker",e.dependencies=["series","grid","polar","geo"],e})(Wr);ha(vp,qC.prototype);var Y2e=(function(r){Ye(e,r);function e(){var t=r!==null&&r.apply(this,arguments)||this;return t.type=e.type,t}return e.prototype.createMarkerModelFromSeries=function(t,i,n){return new e(t,i,n)},e.type="markPoint",e.defaultOption={z:5,symbol:"pin",symbolSize:50,tooltip:{trigger:"item"},label:{show:!0,position:"inside"},itemStyle:{borderWidth:2},emphasis:{label:{show:!0}}},e})(vp);function sD(r){return!(isNaN(parseFloat(r.x))&&isNaN(parseFloat(r.y)))}function K2e(r){return!isNaN(parseFloat(r.x))&&!isNaN(parseFloat(r.y))}function d2(r,e,t,i,n,a){var s=[],o=dp(e,i),l=o?e.getCalculationInfo("stackResultDimension"):i,c=EO(e,l,r),f=e.indicesOfNearest(l,c)[0];s[n]=e.get(t,f),s[a]=e.get(l,f);var p=e.get(i,f),y=wh(e.get(i,f));return y=Math.min(y,20),y>=0&&(s[a]=+s[a].toFixed(y)),[s,p]}var IP={min:Sr(d2,"min"),max:Sr(d2,"max"),average:Sr(d2,"average"),median:Sr(d2,"median")};function Lw(r,e){if(e){var t=r.getData(),i=r.coordinateSystem,n=i&&i.dimensions;if(!K2e(e)&&!xt(e.coord)&&xt(n)){var a=nZ(e,t,i,r);if(e=hr(e),e.type&&IP[e.type]&&a.baseAxis&&a.valueAxis){var s=Or(n,a.baseAxis.dim),o=Or(n,a.valueAxis.dim),l=IP[e.type](t,a.baseDataDim,a.valueDataDim,s,o);e.coord=l[0],e.value=l[1]}else e.coord=[e.xAxis!=null?e.xAxis:e.radiusAxis,e.yAxis!=null?e.yAxis:e.angleAxis]}if(e.coord==null||!xt(n))e.coord=[];else for(var c=e.coord,f=0;f<2;f++)IP[c[f]]&&(c[f]=EO(t,t.mapDimension(n[f]),c[f]));return e}}function nZ(r,e,t,i){var n={};return r.valueIndex!=null||r.valueDim!=null?(n.valueDataDim=r.valueIndex!=null?e.getDimension(r.valueIndex):r.valueDim,n.valueAxis=t.getAxis(Q2e(i,n.valueDataDim)),n.baseAxis=t.getOtherAxis(n.valueAxis),n.baseDataDim=e.mapDimension(n.baseAxis.dim)):(n.baseAxis=i.getBaseAxis(),n.valueAxis=t.getOtherAxis(n.baseAxis),n.baseDataDim=e.mapDimension(n.baseAxis.dim),n.valueDataDim=e.mapDimension(n.valueAxis.dim)),n}function Q2e(r,e){var t=r.getData().getDimensionInfo(e);return t&&t.coordDim}function Ow(r,e){return r&&r.containData&&e.coord&&!sD(e)?r.containData(e.coord):!0}function J2e(r,e,t){return r&&r.containZone&&e.coord&&t.coord&&!sD(e)&&!sD(t)?r.containZone(e.coord,t.coord):!0}function aZ(r,e){return r?function(t,i,n,a){var s=a<2?t.coord&&t.coord[a]:t.value;return zg(s,e[a])}:function(t,i,n,a){return zg(t.value,e[a])}}function EO(r,e,t){if(t==="average"){var i=0,n=0;return r.each(e,function(a,s){isNaN(a)||(i+=a,n++)}),i/n}else return t==="median"?r.getMedian(e):r.getDataExtent(e)[t==="max"?1:0]}var PP=fi(),IO=(function(r){Ye(e,r);function e(){var t=r!==null&&r.apply(this,arguments)||this;return t.type=e.type,t}return e.prototype.init=function(){this.markerGroupMap=Qt()},e.prototype.render=function(t,i,n){var a=this,s=this.markerGroupMap;s.each(function(o){PP(o).keep=!1}),i.eachSeries(function(o){var l=vp.getMarkerModelFromSeries(o,a.type);l&&a.renderSeries(o,l,i,n)}),s.each(function(o){!PP(o).keep&&a.group.remove(o.group)})},e.prototype.markKeep=function(t){PP(t).keep=!0},e.prototype.toggleBlurSeries=function(t,i){var n=this;se(t,function(a){var s=vp.getMarkerModelFromSeries(a,n.type);if(s){var o=s.getData();o.eachItemGraphicEl(function(l){l&&(i?Y$(l):Nk(l))})}})},e.type="marker",e})(vn);function fU(r,e,t){var i=e.coordinateSystem;r.each(function(n){var a=r.getItemModel(n),s,o=Vt(a.get("x"),t.getWidth()),l=Vt(a.get("y"),t.getHeight());if(!isNaN(o)&&!isNaN(l))s=[o,l];else if(e.getMarkerPosition)s=e.getMarkerPosition(r.getValues(r.dimensions,n));else if(i){var c=r.get(i.dimensions[0],n),f=r.get(i.dimensions[1],n);s=i.dataToPoint([c,f])}isNaN(o)||(s[0]=o),isNaN(l)||(s[1]=l),r.setItemLayout(n,s)})}var eAe=(function(r){Ye(e,r);function e(){var t=r!==null&&r.apply(this,arguments)||this;return t.type=e.type,t}return e.prototype.updateTransform=function(t,i,n){i.eachSeries(function(a){var s=vp.getMarkerModelFromSeries(a,"markPoint");s&&(fU(s.getData(),a,n),this.markerGroupMap.get(a.id).updateLayout())},this)},e.prototype.renderSeries=function(t,i,n,a){var s=t.coordinateSystem,o=t.id,l=t.getData(),c=this.markerGroupMap,f=c.get(o)||c.set(o,new rS),p=tAe(s,t,i);i.setData(p),fU(i.getData(),t,a),p.each(function(y){var b=p.getItemModel(y),S=b.getShallow("symbol"),C=b.getShallow("symbolSize"),E=b.getShallow("symbolRotate"),P=b.getShallow("symbolOffset"),O=b.getShallow("symbolKeepAspect");if(sr(S)||sr(C)||sr(E)||sr(P)){var B=i.getRawValue(y),F=i.getDataParams(y);sr(S)&&(S=S(B,F)),sr(C)&&(C=C(B,F)),sr(E)&&(E=E(B,F)),sr(P)&&(P=P(B,F))}var W=b.getModel("itemStyle").getItemStyle(),$=Jw(l,"color");W.fill||(W.fill=$),p.setItemVisual(y,{symbol:S,symbolSize:C,symbolRotate:E,symbolOffset:P,symbolKeepAspect:O,style:W})}),f.updateData(p),this.group.add(f.group),p.eachItemGraphicEl(function(y){y.traverse(function(b){br(b).dataModel=i})}),this.markKeep(f),f.group.silent=i.get("silent")||t.get("silent")},e.type="markPoint",e})(IO);function tAe(r,e,t){var i;r?i=wt(r&&r.dimensions,function(o){var l=e.getData().getDimensionInfo(e.getData().mapDimension(o))||{};return mt(mt({},l),{name:o,ordinalMeta:null})}):i=[{name:"value",type:"float"}];var n=new Es(i,t),a=wt(t.get("data"),Sr(Lw,e));r&&(a=wi(a,Sr(Ow,r)));var s=aZ(!!r,i);return n.initData(a,null,s),n}function rAe(r){r.registerComponentModel(Y2e),r.registerComponentView(eAe),r.registerPreprocessor(function(e){MO(e.series,"markPoint")&&(e.markPoint=e.markPoint||{})})}var iAe=(function(r){Ye(e,r);function e(){var t=r!==null&&r.apply(this,arguments)||this;return t.type=e.type,t}return e.prototype.createMarkerModelFromSeries=function(t,i,n){return new e(t,i,n)},e.type="markLine",e.defaultOption={z:5,symbol:["circle","arrow"],symbolSize:[8,16],symbolOffset:0,precision:2,tooltip:{trigger:"item"},label:{show:!0,position:"end",distance:5},lineStyle:{type:"dashed"},emphasis:{label:{show:!0},lineStyle:{width:3}},animationEasing:"linear"},e})(vp),p2=fi(),nAe=function(r,e,t,i){var n=r.getData(),a;if(xt(i))a=i;else{var s=i.type;if(s==="min"||s==="max"||s==="average"||s==="median"||i.xAxis!=null||i.yAxis!=null){var o=void 0,l=void 0;if(i.yAxis!=null||i.xAxis!=null)o=e.getAxis(i.yAxis!=null?"y":"x"),l=uo(i.yAxis,i.xAxis);else{var c=nZ(i,n,e,r);o=c.valueAxis;var f=xL(n,c.valueDataDim);l=EO(n,f,s)}var p=o.dim==="x"?0:1,y=1-p,b=hr(i),S={coord:[]};b.type=null,b.coord=[],b.coord[y]=-1/0,S.coord[y]=1/0;var C=t.get("precision");C>=0&&di(l)&&(l=+l.toFixed(Math.min(C,20))),b.coord[p]=S.coord[p]=l,a=[b,S,{type:s,valueIndex:i.valueIndex,value:l}]}else a=[]}var E=[Lw(r,a[0]),Lw(r,a[1]),mt({},a[2])];return E[2].type=E[2].type||null,Cr(E[2],E[0]),Cr(E[2],E[1]),E};function aC(r){return!isNaN(r)&&!isFinite(r)}function dU(r,e,t,i){var n=1-r,a=i.dimensions[r];return aC(e[n])&&aC(t[n])&&e[r]===t[r]&&i.getAxis(a).containData(e[r])}function aAe(r,e){if(r.type==="cartesian2d"){var t=e[0].coord,i=e[1].coord;if(t&&i&&(dU(1,t,i,r)||dU(0,t,i,r)))return!0}return Ow(r,e[0])&&Ow(r,e[1])}function RP(r,e,t,i,n){var a=i.coordinateSystem,s=r.getItemModel(e),o,l=Vt(s.get("x"),n.getWidth()),c=Vt(s.get("y"),n.getHeight());if(!isNaN(l)&&!isNaN(c))o=[l,c];else{if(i.getMarkerPosition)o=i.getMarkerPosition(r.getValues(r.dimensions,e));else{var f=a.dimensions,p=r.get(f[0],e),y=r.get(f[1],e);o=a.dataToPoint([p,y])}if(ky(a,"cartesian2d")){var b=a.getAxis("x"),S=a.getAxis("y"),f=a.dimensions;aC(r.get(f[0],e))?o[0]=b.toGlobalCoord(b.getExtent()[t?0:1]):aC(r.get(f[1],e))&&(o[1]=S.toGlobalCoord(S.getExtent()[t?0:1]))}isNaN(l)||(o[0]=l),isNaN(c)||(o[1]=c)}r.setItemLayout(e,o)}var oAe=(function(r){Ye(e,r);function e(){var t=r!==null&&r.apply(this,arguments)||this;return t.type=e.type,t}return e.prototype.updateTransform=function(t,i,n){i.eachSeries(function(a){var s=vp.getMarkerModelFromSeries(a,"markLine");if(s){var o=s.getData(),l=p2(s).from,c=p2(s).to;l.each(function(f){RP(l,f,!0,a,n),RP(c,f,!1,a,n)}),o.each(function(f){o.setItemLayout(f,[l.getItemLayout(f),c.getItemLayout(f)])}),this.markerGroupMap.get(a.id).updateLayout()}},this)},e.prototype.renderSeries=function(t,i,n,a){var s=t.coordinateSystem,o=t.id,l=t.getData(),c=this.markerGroupMap,f=c.get(o)||c.set(o,new YL);this.group.add(f.group);var p=sAe(s,t,i),y=p.from,b=p.to,S=p.line;p2(i).from=y,p2(i).to=b,i.setData(S);var C=i.get("symbol"),E=i.get("symbolSize"),P=i.get("symbolRotate"),O=i.get("symbolOffset");xt(C)||(C=[C,C]),xt(E)||(E=[E,E]),xt(P)||(P=[P,P]),xt(O)||(O=[O,O]),p.from.each(function(F){B(y,F,!0),B(b,F,!1)}),S.each(function(F){var W=S.getItemModel(F).getModel("lineStyle").getLineStyle();S.setItemLayout(F,[y.getItemLayout(F),b.getItemLayout(F)]),W.stroke==null&&(W.stroke=y.getItemVisual(F,"style").fill),S.setItemVisual(F,{fromSymbolKeepAspect:y.getItemVisual(F,"symbolKeepAspect"),fromSymbolOffset:y.getItemVisual(F,"symbolOffset"),fromSymbolRotate:y.getItemVisual(F,"symbolRotate"),fromSymbolSize:y.getItemVisual(F,"symbolSize"),fromSymbol:y.getItemVisual(F,"symbol"),toSymbolKeepAspect:b.getItemVisual(F,"symbolKeepAspect"),toSymbolOffset:b.getItemVisual(F,"symbolOffset"),toSymbolRotate:b.getItemVisual(F,"symbolRotate"),toSymbolSize:b.getItemVisual(F,"symbolSize"),toSymbol:b.getItemVisual(F,"symbol"),style:W})}),f.updateData(S),p.line.eachItemGraphicEl(function(F){br(F).dataModel=i,F.traverse(function(W){br(W).dataModel=i})});function B(F,W,$){var q=F.getItemModel(W);RP(F,W,$,t,a);var Q=q.getModel("itemStyle").getItemStyle();Q.fill==null&&(Q.fill=Jw(l,"color")),F.setItemVisual(W,{symbolKeepAspect:q.get("symbolKeepAspect"),symbolOffset:wr(q.get("symbolOffset",!0),O[$?0:1]),symbolRotate:wr(q.get("symbolRotate",!0),P[$?0:1]),symbolSize:wr(q.get("symbolSize"),E[$?0:1]),symbol:wr(q.get("symbol",!0),C[$?0:1]),style:Q})}this.markKeep(f),f.group.silent=i.get("silent")||t.get("silent")},e.type="markLine",e})(IO);function sAe(r,e,t){var i;r?i=wt(r&&r.dimensions,function(c){var f=e.getData().getDimensionInfo(e.getData().mapDimension(c))||{};return mt(mt({},f),{name:c,ordinalMeta:null})}):i=[{name:"value",type:"float"}];var n=new Es(i,t),a=new Es(i,t),s=new Es([],t),o=wt(t.get("data"),Sr(nAe,e,r,t));r&&(o=wi(o,Sr(aAe,r)));var l=aZ(!!r,i);return n.initData(wt(o,function(c){return c[0]}),null,l),a.initData(wt(o,function(c){return c[1]}),null,l),s.initData(wt(o,function(c){return c[2]})),s.hasItemOption=!0,{from:n,to:a,line:s}}function lAe(r){r.registerComponentModel(iAe),r.registerComponentView(oAe),r.registerPreprocessor(function(e){MO(e.series,"markLine")&&(e.markLine=e.markLine||{})})}var uAe=(function(r){Ye(e,r);function e(){var t=r!==null&&r.apply(this,arguments)||this;return t.type=e.type,t}return e.prototype.createMarkerModelFromSeries=function(t,i,n){return new e(t,i,n)},e.type="markArea",e.defaultOption={z:1,tooltip:{trigger:"item"},animation:!1,label:{show:!0,position:"top"},itemStyle:{borderWidth:0},emphasis:{label:{show:!0,position:"top"}}},e})(vp),g2=fi(),cAe=function(r,e,t,i){var n=i[0],a=i[1];if(!(!n||!a)){var s=Lw(r,n),o=Lw(r,a),l=s.coord,c=o.coord;l[0]=uo(l[0],-1/0),l[1]=uo(l[1],-1/0),c[0]=uo(c[0],1/0),c[1]=uo(c[1],1/0);var f=TC([{},s,o]);return f.coord=[s.coord,o.coord],f.x0=s.x,f.y0=s.y,f.x1=o.x,f.y1=o.y,f}};function oC(r){return!isNaN(r)&&!isFinite(r)}function pU(r,e,t,i){var n=1-r;return oC(e[n])&&oC(t[n])}function hAe(r,e){var t=e.coord[0],i=e.coord[1],n={coord:t,x:e.x0,y:e.y0},a={coord:i,x:e.x1,y:e.y1};return ky(r,"cartesian2d")?t&&i&&(pU(1,t,i)||pU(0,t,i))?!0:J2e(r,n,a):Ow(r,n)||Ow(r,a)}function gU(r,e,t,i,n){var a=i.coordinateSystem,s=r.getItemModel(e),o,l=Vt(s.get(t[0]),n.getWidth()),c=Vt(s.get(t[1]),n.getHeight());if(!isNaN(l)&&!isNaN(c))o=[l,c];else{if(i.getMarkerPosition){var f=r.getValues(["x0","y0"],e),p=r.getValues(["x1","y1"],e),y=a.clampData(f),b=a.clampData(p),S=[];t[0]==="x0"?S[0]=y[0]>b[0]?p[0]:f[0]:S[0]=y[0]>b[0]?f[0]:p[0],t[1]==="y0"?S[1]=y[1]>b[1]?p[1]:f[1]:S[1]=y[1]>b[1]?f[1]:p[1],o=i.getMarkerPosition(S,t,!0)}else{var C=r.get(t[0],e),E=r.get(t[1],e),P=[C,E];a.clampData&&a.clampData(P,P),o=a.dataToPoint(P,!0)}if(ky(a,"cartesian2d")){var O=a.getAxis("x"),B=a.getAxis("y"),C=r.get(t[0],e),E=r.get(t[1],e);oC(C)?o[0]=O.toGlobalCoord(O.getExtent()[t[0]==="x0"?0:1]):oC(E)&&(o[1]=B.toGlobalCoord(B.getExtent()[t[1]==="y0"?0:1]))}isNaN(l)||(o[0]=l),isNaN(c)||(o[1]=c)}return o}var vU=[["x0","y0"],["x1","y0"],["x1","y1"],["x0","y1"]],fAe=(function(r){Ye(e,r);function e(){var t=r!==null&&r.apply(this,arguments)||this;return t.type=e.type,t}return e.prototype.updateTransform=function(t,i,n){i.eachSeries(function(a){var s=vp.getMarkerModelFromSeries(a,"markArea");if(s){var o=s.getData();o.each(function(l){var c=wt(vU,function(p){return gU(o,l,p,a,n)});o.setItemLayout(l,c);var f=o.getItemGraphicEl(l);f.setShape("points",c)})}},this)},e.prototype.renderSeries=function(t,i,n,a){var s=t.coordinateSystem,o=t.id,l=t.getData(),c=this.markerGroupMap,f=c.get(o)||c.set(o,{group:new mr});this.group.add(f.group),this.markKeep(f);var p=dAe(s,t,i);i.setData(p),p.each(function(y){var b=wt(vU,function(Q){return gU(p,y,Q,t,a)}),S=s.getAxis("x").scale,C=s.getAxis("y").scale,E=S.getExtent(),P=C.getExtent(),O=[S.parse(p.get("x0",y)),S.parse(p.get("x1",y))],B=[C.parse(p.get("y0",y)),C.parse(p.get("y1",y))];yu(O),yu(B);var F=!(E[0]>O[1]||E[1]<O[0]||P[0]>B[1]||P[1]<B[0]),W=!F;p.setItemLayout(y,{points:b,allClipped:W});var $=p.getItemModel(y).getModel("itemStyle").getItemStyle(),q=Jw(l,"color");$.fill||($.fill=q,$t($.fill)&&($.fill=cw($.fill,.4))),$.stroke||($.stroke=q),p.setItemVisual(y,"style",$)}),p.diff(g2(f).data).add(function(y){var b=p.getItemLayout(y);if(!b.allClipped){var S=new Rs({shape:{points:b.points}});p.setItemGraphicEl(y,S),f.group.add(S)}}).update(function(y,b){var S=g2(f).data.getItemGraphicEl(b),C=p.getItemLayout(y);C.allClipped?S&&f.group.remove(S):(S?vi(S,{shape:{points:C.points}},i,y):S=new Rs({shape:{points:C.points}}),p.setItemGraphicEl(y,S),f.group.add(S))}).remove(function(y){var b=g2(f).data.getItemGraphicEl(y);f.group.remove(b)}).execute(),p.eachItemGraphicEl(function(y,b){var S=p.getItemModel(b),C=p.getItemVisual(b,"style");y.useStyle(p.getItemVisual(b,"style")),rs(y,fo(S),{labelFetcher:i,labelDataIndex:b,defaultText:p.getName(b)||"",inheritColor:$t(C.fill)?cw(C.fill,1):"#000"}),ts(y,S),Hn(y,null,null,S.get(["emphasis","disabled"])),br(y).dataModel=i}),g2(f).data=p,f.group.silent=i.get("silent")||t.get("silent")},e.type="markArea",e})(IO);function dAe(r,e,t){var i,n,a=["x0","y0","x1","y1"];if(r){var s=wt(r&&r.dimensions,function(c){var f=e.getData(),p=f.getDimensionInfo(f.mapDimension(c))||{};return mt(mt({},p),{name:c,ordinalMeta:null})});n=wt(a,function(c,f){return{name:c,type:s[f%2].type}}),i=new Es(n,t)}else n=[{name:"value",type:"float"}],i=new Es(n,t);var o=wt(t.get("data"),Sr(cAe,e,r,t));r&&(o=wi(o,Sr(hAe,r)));var l=r?function(c,f,p,y){var b=c.coord[Math.floor(y/2)][y%2];return zg(b,n[y])}:function(c,f,p,y){return zg(c.value,n[y])};return i.initData(o,null,l),i.hasItemOption=!0,i}function pAe(r){r.registerComponentModel(uAe),r.registerComponentView(fAe),r.registerPreprocessor(function(e){MO(e.series,"markArea")&&(e.markArea=e.markArea||{})})}var gAe=function(r,e){if(e==="all")return{type:"all",title:r.getLocaleModel().get(["legend","selector","all"])};if(e==="inverse")return{type:"inverse",title:r.getLocaleModel().get(["legend","selector","inverse"])}},lD=(function(r){Ye(e,r);function e(){var t=r!==null&&r.apply(this,arguments)||this;return t.type=e.type,t.layoutMode={type:"box",ignoreSize:!0},t}return e.prototype.init=function(t,i,n){this.mergeDefaultAndTheme(t,n),t.selected=t.selected||{},this._updateSelector(t)},e.prototype.mergeOption=function(t,i){r.prototype.mergeOption.call(this,t,i),this._updateSelector(t)},e.prototype._updateSelector=function(t){var i=t.selector,n=this.ecModel;i===!0&&(i=t.selector=["all","inverse"]),xt(i)&&se(i,function(a,s){$t(a)&&(a={type:a}),i[s]=Cr(a,gAe(n,a.type))})},e.prototype.optionUpdated=function(){this._updateData(this.ecModel);var t=this._data;if(t[0]&&this.get("selectedMode")==="single"){for(var i=!1,n=0;n<t.length;n++){var a=t[n].get("name");if(this.isSelected(a)){this.select(a),i=!0;break}}!i&&this.select(t[0].get("name"))}},e.prototype._updateData=function(t){var i=[],n=[];t.eachRawSeries(function(l){var c=l.name;n.push(c);var f;if(l.legendVisualProvider){var p=l.legendVisualProvider,y=p.getAllNames();t.isSeriesFiltered(l)||(n=n.concat(y)),y.length?i=i.concat(y):f=!0}else f=!0;f&&Ek(l)&&i.push(l.name)}),this._availableNames=n;var a=this.get("data")||i,s=Qt(),o=wt(a,function(l){return($t(l)||di(l))&&(l={name:l}),s.get(l.name)?null:(s.set(l.name,!0),new Si(l,this,this.ecModel))},this);this._data=wi(o,function(l){return!!l})},e.prototype.getData=function(){return this._data},e.prototype.select=function(t){var i=this.option.selected,n=this.get("selectedMode");if(n==="single"){var a=this._data;se(a,function(s){i[s.get("name")]=!1})}i[t]=!0},e.prototype.unSelect=function(t){this.get("selectedMode")!=="single"&&(this.option.selected[t]=!1)},e.prototype.toggleSelected=function(t){var i=this.option.selected;i.hasOwnProperty(t)||(i[t]=!0),this[i[t]?"unSelect":"select"](t)},e.prototype.allSelect=function(){var t=this._data,i=this.option.selected;se(t,function(n){i[n.get("name",!0)]=!0})},e.prototype.inverseSelect=function(){var t=this._data,i=this.option.selected;se(t,function(n){var a=n.get("name",!0);i.hasOwnProperty(a)||(i[a]=!0),i[a]=!i[a]})},e.prototype.isSelected=function(t){var i=this.option.selected;return!(i.hasOwnProperty(t)&&!i[t])&&Or(this._availableNames,t)>=0},e.prototype.getOrient=function(){return this.get("orient")==="vertical"?{index:1,name:"vertical"}:{index:0,name:"horizontal"}},e.type="legend.plain",e.dependencies=["series"],e.defaultOption={z:4,show:!0,orient:"horizontal",left:"center",top:0,align:"auto",backgroundColor:"rgba(0,0,0,0)",borderColor:"#ccc",borderRadius:0,borderWidth:0,padding:5,itemGap:10,itemWidth:25,itemHeight:14,symbolRotate:"inherit",symbolKeepAspect:!0,inactiveColor:"#ccc",inactiveBorderColor:"#ccc",inactiveBorderWidth:"auto",itemStyle:{color:"inherit",opacity:"inherit",borderColor:"inherit",borderWidth:"auto",borderCap:"inherit",borderJoin:"inherit",borderDashOffset:"inherit",borderMiterLimit:"inherit"},lineStyle:{width:"auto",color:"inherit",inactiveColor:"#ccc",inactiveWidth:2,opacity:"inherit",type:"inherit",cap:"inherit",join:"inherit",dashOffset:"inherit",miterLimit:"inherit"},textStyle:{color:"#333"},selectedMode:!0,selector:!1,selectorLabel:{show:!0,borderRadius:10,padding:[3,5,3,5],fontSize:12,fontFamily:"sans-serif",color:"#666",borderWidth:1,borderColor:"#666"},emphasis:{selectorLabel:{show:!0,color:"#eee",backgroundColor:"#666"}},selectorPosition:"auto",selectorItemGap:7,selectorButtonGap:10,tooltip:{show:!1}},e})(Wr),r0=Sr,uD=se,v2=mr,oZ=(function(r){Ye(e,r);function e(){var t=r!==null&&r.apply(this,arguments)||this;return t.type=e.type,t.newlineDisabled=!1,t}return e.prototype.init=function(){this.group.add(this._contentGroup=new v2),this.group.add(this._selectorGroup=new v2),this._isFirstRender=!0},e.prototype.getContentGroup=function(){return this._contentGroup},e.prototype.getSelectorGroup=function(){return this._selectorGroup},e.prototype.render=function(t,i,n){var a=this._isFirstRender;if(this._isFirstRender=!1,this.resetInner(),!!t.get("show",!0)){var s=t.get("align"),o=t.get("orient");(!s||s==="auto")&&(s=t.get("left")==="right"&&o==="vertical"?"right":"left");var l=t.get("selector",!0),c=t.get("selectorPosition",!0);l&&(!c||c==="auto")&&(c=o==="horizontal"?"end":"start"),this.renderInner(s,t,i,n,l,o,c);var f=t.getBoxLayoutParams(),p={width:n.getWidth(),height:n.getHeight()},y=t.get("padding"),b=La(f,p,y),S=this.layoutInner(t,s,b,a,l,c),C=La(lr({width:S.width,height:S.height},f),p,y);this.group.x=C.x-S.x,this.group.y=C.y-S.y,this.group.markRedraw(),this.group.add(this._backgroundEl=ZX(S,t))}},e.prototype.resetInner=function(){this.getContentGroup().removeAll(),this._backgroundEl&&this.group.remove(this._backgroundEl),this.getSelectorGroup().removeAll()},e.prototype.renderInner=function(t,i,n,a,s,o,l){var c=this.getContentGroup(),f=Qt(),p=i.get("selectedMode"),y=[];n.eachRawSeries(function(b){!b.get("legendHoverLink")&&y.push(b.id)}),uD(i.getData(),function(b,S){var C=b.get("name");if(!this.newlineDisabled&&(C===""||C===`
`)){var E=new v2;E.newline=!0,c.add(E);return}var P=n.getSeriesByName(C)[0];if(!f.get(C))if(P){var O=P.getData(),B=O.getVisual("legendLineStyle")||{},F=O.getVisual("legendIcon"),W=O.getVisual("style"),$=this._createItem(P,C,S,b,i,t,B,W,F,p,a);$.on("click",r0(mU,C,null,a,y)).on("mouseover",r0(cD,P.name,null,a,y)).on("mouseout",r0(hD,P.name,null,a,y)),n.ssr&&$.eachChild(function(q){var Q=br(q);Q.seriesIndex=P.seriesIndex,Q.dataIndex=S,Q.ssrType="legend"}),f.set(C,!0)}else n.eachRawSeries(function(q){if(!f.get(C)&&q.legendVisualProvider){var Q=q.legendVisualProvider;if(!Q.containName(C))return;var ee=Q.indexOfName(C),te=Q.getItemVisual(ee,"style"),ae=Q.getItemVisual(ee,"legendIcon"),de=al(te.fill);de&&de[3]===0&&(de[3]=.2,te=mt(mt({},te),{fill:Ch(de,"rgba")}));var ve=this._createItem(q,C,S,b,i,t,{},te,ae,p,a);ve.on("click",r0(mU,null,C,a,y)).on("mouseover",r0(cD,null,C,a,y)).on("mouseout",r0(hD,null,C,a,y)),n.ssr&&ve.eachChild(function(ye){var Ae=br(ye);Ae.seriesIndex=q.seriesIndex,Ae.dataIndex=S,Ae.ssrType="legend"}),f.set(C,!0)}},this)},this),s&&this._createSelector(s,i,a,o,l)},e.prototype._createSelector=function(t,i,n,a,s){var o=this.getSelectorGroup();uD(t,function(c){var f=c.type,p=new si({style:{x:0,y:0,align:"center",verticalAlign:"middle"},onclick:function(){n.dispatchAction({type:f==="all"?"legendAllSelect":"legendInverseSelect",legendId:i.id})}});o.add(p);var y=i.getModel("selectorLabel"),b=i.getModel(["emphasis","selectorLabel"]);rs(p,{normal:y,emphasis:b},{defaultText:c.title}),Og(p)})},e.prototype._createItem=function(t,i,n,a,s,o,l,c,f,p,y){var b=t.visualDrawType,S=s.get("itemWidth"),C=s.get("itemHeight"),E=s.isSelected(i),P=a.get("symbolRotate"),O=a.get("symbolKeepAspect"),B=a.get("icon");f=B||f||"roundRect";var F=vAe(f,a,l,c,b,E,y),W=new v2,$=a.getModel("textStyle");if(sr(t.getLegendIcon)&&(!B||B==="inherit"))W.add(t.getLegendIcon({itemWidth:S,itemHeight:C,icon:f,iconRotate:P,itemStyle:F.itemStyle,lineStyle:F.lineStyle,symbolKeepAspect:O}));else{var q=B==="inherit"&&t.getData().getVisual("symbol")?P==="inherit"?t.getData().getVisual("symbolRotate"):P:0;W.add(mAe({itemWidth:S,itemHeight:C,icon:f,iconRotate:q,itemStyle:F.itemStyle,symbolKeepAspect:O}))}var Q=o==="left"?S+5:-5,ee=o,te=s.get("formatter"),ae=i;$t(te)&&te?ae=te.replace("{name}",i??""):sr(te)&&(ae=te(i));var de=E?$.getTextColor():a.get("inactiveColor");W.add(new si({style:cn($,{text:ae,x:Q,y:C/2,fill:de,align:ee,verticalAlign:"middle"},{inheritColor:de})}));var ve=new li({shape:W.getBoundingRect(),style:{fill:"transparent"}}),ye=a.getModel("tooltip");return ye.get("show")&&Iy({el:ve,componentModel:s,itemName:i,itemTooltipOption:ye.option}),W.add(ve),W.eachChild(function(Ae){Ae.silent=!0}),ve.silent=!p,this.getContentGroup().add(W),Og(W),W.__legendDataIndex=n,W},e.prototype.layoutInner=function(t,i,n,a,s,o){var l=this.getContentGroup(),c=this.getSelectorGroup();ny(t.get("orient"),l,t.get("itemGap"),n.width,n.height);var f=l.getBoundingRect(),p=[-f.x,-f.y];if(c.markRedraw(),l.markRedraw(),s){ny("horizontal",c,t.get("selectorItemGap",!0));var y=c.getBoundingRect(),b=[-y.x,-y.y],S=t.get("selectorButtonGap",!0),C=t.getOrient().index,E=C===0?"width":"height",P=C===0?"height":"width",O=C===0?"y":"x";o==="end"?b[C]+=f[E]+S:p[C]+=y[E]+S,b[1-C]+=f[P]/2-y[P]/2,c.x=b[0],c.y=b[1],l.x=p[0],l.y=p[1];var B={x:0,y:0};return B[E]=f[E]+S+y[E],B[P]=Math.max(f[P],y[P]),B[O]=Math.min(0,y[O]+b[1-C]),B}else return l.x=p[0],l.y=p[1],this.group.getBoundingRect()},e.prototype.remove=function(){this.getContentGroup().removeAll(),this._isFirstRender=!0},e.type="legend.plain",e})(vn);function vAe(r,e,t,i,n,a,s){function o(E,P){E.lineWidth==="auto"&&(E.lineWidth=P.lineWidth>0?2:0),uD(E,function(O,B){E[B]==="inherit"&&(E[B]=P[B])})}var l=e.getModel("itemStyle"),c=l.getItemStyle(),f=r.lastIndexOf("empty",0)===0?"fill":"stroke",p=l.getShallow("decal");c.decal=!p||p==="inherit"?i.decal:q0(p,s),c.fill==="inherit"&&(c.fill=i[n]),c.stroke==="inherit"&&(c.stroke=i[f]),c.opacity==="inherit"&&(c.opacity=(n==="fill"?i:t).opacity),o(c,i);var y=e.getModel("lineStyle"),b=y.getLineStyle();if(o(b,t),c.fill==="auto"&&(c.fill=i.fill),c.stroke==="auto"&&(c.stroke=i.fill),b.stroke==="auto"&&(b.stroke=i.fill),!a){var S=e.get("inactiveBorderWidth"),C=c[f];c.lineWidth=S==="auto"?i.lineWidth>0&&C?2:0:c.lineWidth,c.fill=e.get("inactiveColor"),c.stroke=e.get("inactiveBorderColor"),b.stroke=y.get("inactiveColor"),b.lineWidth=y.get("inactiveWidth")}return{itemStyle:c,lineStyle:b}}function mAe(r){var e=r.icon||"roundRect",t=Aa(e,0,0,r.itemWidth,r.itemHeight,r.itemStyle.fill,r.symbolKeepAspect);return t.setStyle(r.itemStyle),t.rotation=(r.iconRotate||0)*Math.PI/180,t.setOrigin([r.itemWidth/2,r.itemHeight/2]),e.indexOf("empty")>-1&&(t.style.stroke=t.style.fill,t.style.fill="#fff",t.style.lineWidth=2),t}function mU(r,e,t,i){hD(r,e,t,i),t.dispatchAction({type:"legendToggleSelect",name:r??e}),cD(r,e,t,i)}function sZ(r){for(var e=r.getZr().storage.getDisplayList(),t,i=0,n=e.length;i<n&&!(t=e[i].states.emphasis);)i++;return t&&t.hoverLayer}function cD(r,e,t,i){sZ(t)||t.dispatchAction({type:"highlight",seriesName:r,name:e,excludeSeriesId:i})}function hD(r,e,t,i){sZ(t)||t.dispatchAction({type:"downplay",seriesName:r,name:e,excludeSeriesId:i})}function yAe(r){var e=r.findComponents({mainType:"legend"});e&&e.length&&r.filterSeries(function(t){for(var i=0;i<e.length;i++)if(!e[i].isSelected(t.name))return!1;return!0})}function i1(r,e,t){var i=r==="allSelect"||r==="inverseSelect",n={},a=[];t.eachComponent({mainType:"legend",query:e},function(o){i?o[r]():o[r](e.name),yU(o,n),a.push(o.componentIndex)});var s={};return t.eachComponent("legend",function(o){se(n,function(l,c){o[l?"select":"unSelect"](c)}),yU(o,s)}),i?{selected:s,legendIndex:a}:{name:e.name,selected:s}}function yU(r,e){var t=e||{};return se(r.getData(),function(i){var n=i.get("name");if(!(n===`
`||n==="")){var a=r.isSelected(n);Yt(t,n)?t[n]=t[n]&&a:t[n]=a}}),t}function _Ae(r){r.registerAction("legendToggleSelect","legendselectchanged",Sr(i1,"toggleSelected")),r.registerAction("legendAllSelect","legendselectall",Sr(i1,"allSelect")),r.registerAction("legendInverseSelect","legendinverseselect",Sr(i1,"inverseSelect")),r.registerAction("legendSelect","legendselected",Sr(i1,"select")),r.registerAction("legendUnSelect","legendunselected",Sr(i1,"unSelect"))}function lZ(r){r.registerComponentModel(lD),r.registerComponentView(oZ),r.registerProcessor(r.PRIORITY.PROCESSOR.SERIES_FILTER,yAe),r.registerSubTypeDefaulter("legend",function(){return"plain"}),_Ae(r)}var bAe=(function(r){Ye(e,r);function e(){var t=r!==null&&r.apply(this,arguments)||this;return t.type=e.type,t}return e.prototype.setScrollDataIndex=function(t){this.option.scrollDataIndex=t},e.prototype.init=function(t,i,n){var a=pb(t);r.prototype.init.call(this,t,i,n),_U(this,t,a)},e.prototype.mergeOption=function(t,i){r.prototype.mergeOption.call(this,t,i),_U(this,this.option,t)},e.type="legend.scroll",e.defaultOption=Yg(lD.defaultOption,{scrollDataIndex:0,pageButtonItemGap:5,pageButtonGap:null,pageButtonPosition:"end",pageFormatter:"{current}/{total}",pageIcons:{horizontal:["M0,0L12,-10L12,10z","M0,0L-12,-10L-12,10z"],vertical:["M0,0L20,0L10,-20z","M0,0L20,0L10,20z"]},pageIconColor:"#2f4554",pageIconInactiveColor:"#aaa",pageIconSize:15,pageTextStyle:{color:"#333"},animationDurationUpdate:800}),e})(lD);function _U(r,e,t){var i=r.getOrient(),n=[1,1];n[i.index]=0,$g(e,t,{type:"box",ignoreSize:!!n})}var bU=mr,DP=["width","height"],kP=["x","y"],xAe=(function(r){Ye(e,r);function e(){var t=r!==null&&r.apply(this,arguments)||this;return t.type=e.type,t.newlineDisabled=!0,t._currentIndex=0,t}return e.prototype.init=function(){r.prototype.init.call(this),this.group.add(this._containerGroup=new bU),this._containerGroup.add(this.getContentGroup()),this.group.add(this._controllerGroup=new bU)},e.prototype.resetInner=function(){r.prototype.resetInner.call(this),this._controllerGroup.removeAll(),this._containerGroup.removeClipPath(),this._containerGroup.__rectSize=null},e.prototype.renderInner=function(t,i,n,a,s,o,l){var c=this;r.prototype.renderInner.call(this,t,i,n,a,s,o,l);var f=this._controllerGroup,p=i.get("pageIconSize",!0),y=xt(p)?p:[p,p];S("pagePrev",0);var b=i.getModel("pageTextStyle");f.add(new si({name:"pageText",style:{text:"xx/xx",fill:b.getTextColor(),font:b.getFont(),verticalAlign:"middle",align:"center"},silent:!0})),S("pageNext",1);function S(C,E){var P=C+"DataIndex",O=hb(i.get("pageIcons",!0)[i.getOrient().name][E],{onclick:Xt(c._pageGo,c,P,i,a)},{x:-y[0]/2,y:-y[1]/2,width:y[0],height:y[1]});O.name=C,f.add(O)}},e.prototype.layoutInner=function(t,i,n,a,s,o){var l=this.getSelectorGroup(),c=t.getOrient().index,f=DP[c],p=kP[c],y=DP[1-c],b=kP[1-c];s&&ny("horizontal",l,t.get("selectorItemGap",!0));var S=t.get("selectorButtonGap",!0),C=l.getBoundingRect(),E=[-C.x,-C.y],P=hr(n);s&&(P[f]=n[f]-C[f]-S);var O=this._layoutContentAndController(t,a,P,c,f,y,b,p);if(s){if(o==="end")E[c]+=O[f]+S;else{var B=C[f]+S;E[c]-=B,O[p]-=B}O[f]+=C[f]+S,E[1-c]+=O[b]+O[y]/2-C[y]/2,O[y]=Math.max(O[y],C[y]),O[b]=Math.min(O[b],C[b]+E[1-c]),l.x=E[0],l.y=E[1],l.markRedraw()}return O},e.prototype._layoutContentAndController=function(t,i,n,a,s,o,l,c){var f=this.getContentGroup(),p=this._containerGroup,y=this._controllerGroup;ny(t.get("orient"),f,t.get("itemGap"),a?n.width:null,a?null:n.height),ny("horizontal",y,t.get("pageButtonItemGap",!0));var b=f.getBoundingRect(),S=y.getBoundingRect(),C=this._showController=b[s]>n[s],E=[-b.x,-b.y];i||(E[a]=f[c]);var P=[0,0],O=[-S.x,-S.y],B=wr(t.get("pageButtonGap",!0),t.get("itemGap",!0));if(C){var F=t.get("pageButtonPosition",!0);F==="end"?O[a]+=n[s]-S[s]:P[a]+=S[s]+B}O[1-a]+=b[o]/2-S[o]/2,f.setPosition(E),p.setPosition(P),y.setPosition(O);var W={x:0,y:0};if(W[s]=C?n[s]:b[s],W[o]=Math.max(b[o],S[o]),W[l]=Math.min(0,S[l]+O[1-a]),p.__rectSize=n[s],C){var $={x:0,y:0};$[s]=Math.max(n[s]-S[s]-B,0),$[o]=W[o],p.setClipPath(new li({shape:$})),p.__rectSize=$[s]}else y.eachChild(function(Q){Q.attr({invisible:!0,silent:!0})});var q=this._getPageInfo(t);return q.pageIndex!=null&&vi(f,{x:q.contentPosition[0],y:q.contentPosition[1]},C?t:null),this._updatePageInfoView(t,q),W},e.prototype._pageGo=function(t,i,n){var a=this._getPageInfo(i)[t];a!=null&&n.dispatchAction({type:"legendScroll",scrollDataIndex:a,legendId:i.id})},e.prototype._updatePageInfoView=function(t,i){var n=this._controllerGroup;se(["pagePrev","pageNext"],function(f){var p=f+"DataIndex",y=i[p]!=null,b=n.childOfName(f);b&&(b.setStyle("fill",y?t.get("pageIconColor",!0):t.get("pageIconInactiveColor",!0)),b.cursor=y?"pointer":"default")});var a=n.childOfName("pageText"),s=t.get("pageFormatter"),o=i.pageIndex,l=o!=null?o+1:0,c=i.pageCount;a&&s&&a.setStyle("text",$t(s)?s.replace("{current}",l==null?"":l+"").replace("{total}",c==null?"":c+""):s({current:l,total:c}))},e.prototype._getPageInfo=function(t){var i=t.get("scrollDataIndex",!0),n=this.getContentGroup(),a=this._containerGroup.__rectSize,s=t.getOrient().index,o=DP[s],l=kP[s],c=this._findTargetItemIndex(i),f=n.children(),p=f[c],y=f.length,b=y?1:0,S={contentPosition:[n.x,n.y],pageCount:b,pageIndex:b-1,pagePrevDataIndex:null,pageNextDataIndex:null};if(!p)return S;var C=F(p);S.contentPosition[s]=-C.s;for(var E=c+1,P=C,O=C,B=null;E<=y;++E)B=F(f[E]),(!B&&O.e>P.s+a||B&&!W(B,P.s))&&(O.i>P.i?P=O:P=B,P&&(S.pageNextDataIndex==null&&(S.pageNextDataIndex=P.i),++S.pageCount)),O=B;for(var E=c-1,P=C,O=C,B=null;E>=-1;--E)B=F(f[E]),(!B||!W(O,B.s))&&P.i<O.i&&(O=P,S.pagePrevDataIndex==null&&(S.pagePrevDataIndex=P.i),++S.pageCount,++S.pageIndex),P=B;return S;function F($){if($){var q=$.getBoundingRect(),Q=q[l]+$[l];return{s:Q,e:Q+q[o],i:$.__legendDataIndex}}}function W($,q){return $.e>=q&&$.s<=q+a}},e.prototype._findTargetItemIndex=function(t){if(!this._showController)return 0;var i,n=this.getContentGroup(),a;return n.eachChild(function(s,o){var l=s.__legendDataIndex;a==null&&l!=null&&(a=o),l===t&&(i=o)}),i??a},e.type="legend.scroll",e})(oZ);function wAe(r){r.registerAction("legendScroll","legendscroll",function(e,t){var i=e.scrollDataIndex;i!=null&&t.eachComponent({mainType:"legend",subType:"scroll",query:e},function(n){n.setScrollDataIndex(i)})})}function SAe(r){Vr(lZ),r.registerComponentModel(bAe),r.registerComponentView(xAe),wAe(r)}function TAe(r){Vr(lZ),Vr(SAe)}var AAe=(function(r){Ye(e,r);function e(){var t=r!==null&&r.apply(this,arguments)||this;return t.type=e.type,t}return e.type="dataZoom.inside",e.defaultOption=Yg(kw.defaultOption,{disabled:!1,zoomLock:!1,zoomOnMouseWheel:!0,moveOnMouseMove:!0,moveOnMouseWheel:!1,preventDefaultMouseMove:!0}),e})(kw),PO=fi();function CAe(r,e,t){PO(r).coordSysRecordMap.each(function(i){var n=i.dataZoomInfoMap.get(e.uid);n&&(n.getRange=t)})}function MAe(r,e){for(var t=PO(r).coordSysRecordMap,i=t.keys(),n=0;n<i.length;n++){var a=i[n],s=t.get(a),o=s.dataZoomInfoMap;if(o){var l=e.uid,c=o.get(l);c&&(o.removeKey(l),o.keys().length||uZ(t,s))}}}function uZ(r,e){if(e){r.removeKey(e.model.uid);var t=e.controller;t&&t.dispose()}}function EAe(r,e){var t={model:e,containsPoint:Sr(PAe,e),dispatchAction:Sr(IAe,r),dataZoomInfoMap:null,controller:null},i=t.controller=new sS(r.getZr());return se(["pan","zoom","scrollMove"],function(n){i.on(n,function(a){var s=[];t.dataZoomInfoMap.each(function(o){if(a.isAvailableBehavior(o.model.option)){var l=(o.getRange||{})[n],c=l&&l(o.dzReferCoordSysInfo,t.model.mainType,t.controller,a);!o.model.get("disabled",!0)&&c&&s.push({dataZoomId:o.model.id,start:c[0],end:c[1]})}}),s.length&&t.dispatchAction(s)})}),t}function IAe(r,e){r.isDisposed()||r.dispatchAction({type:"dataZoom",animation:{easing:"cubicOut",duration:100},batch:e})}function PAe(r,e,t,i){return r.coordinateSystem.containPoint([t,i])}function RAe(r){var e,t="type_",i={type_true:2,type_move:1,type_false:0,type_undefined:-1},n=!0;return r.each(function(a){var s=a.model,o=s.get("disabled",!0)?!1:s.get("zoomLock",!0)?"move":!0;i[t+o]>i[t+e]&&(e=o),n=n&&s.get("preventDefaultMouseMove",!0)}),{controlType:e,opt:{zoomOnMouseWheel:!0,moveOnMouseMove:!0,moveOnMouseWheel:!0,preventDefaultMouseMove:!!n}}}function DAe(r){r.registerProcessor(r.PRIORITY.PROCESSOR.FILTER,function(e,t){var i=PO(t),n=i.coordSysRecordMap||(i.coordSysRecordMap=Qt());n.each(function(a){a.dataZoomInfoMap=null}),e.eachComponent({mainType:"dataZoom",subType:"inside"},function(a){var s=WX(a);se(s.infoList,function(o){var l=o.model.uid,c=n.get(l)||n.set(l,EAe(t,o.model)),f=c.dataZoomInfoMap||(c.dataZoomInfoMap=Qt());f.set(a.uid,{dzReferCoordSysInfo:o,model:a,getRange:null})})}),n.each(function(a){var s=a.controller,o,l=a.dataZoomInfoMap;if(l){var c=l.keys()[0];c!=null&&(o=l.get(c))}if(!o){uZ(n,a);return}var f=RAe(l);s.enable(f.controlType,f.opt),s.setPointerChecker(a.containsPoint),yb(a,"dispatchAction",o.model.get("throttle",!0),"fixRate")})})}var kAe=(function(r){Ye(e,r);function e(){var t=r!==null&&r.apply(this,arguments)||this;return t.type="dataZoom.inside",t}return e.prototype.render=function(t,i,n){if(r.prototype.render.apply(this,arguments),t.noTarget()){this._clear();return}this.range=t.getPercentRange(),CAe(n,t,{pan:Xt(LP.pan,this),zoom:Xt(LP.zoom,this),scrollMove:Xt(LP.scrollMove,this)})},e.prototype.dispose=function(){this._clear(),r.prototype.dispose.apply(this,arguments)},e.prototype._clear=function(){MAe(this.api,this.dataZoomModel),this.range=null},e.type="dataZoom.inside",e})(xO),LP={zoom:function(r,e,t,i){var n=this.range,a=n.slice(),s=r.axisModels[0];if(s){var o=OP[e](null,[i.originX,i.originY],s,t,r),l=(o.signal>0?o.pixelStart+o.pixelLength-o.pixel:o.pixel-o.pixelStart)/o.pixelLength*(a[1]-a[0])+a[0],c=Math.max(1/i.scale,0);a[0]=(a[0]-l)*c+l,a[1]=(a[1]-l)*c+l;var f=this.dataZoomModel.findRepresentativeAxisProxy().getMinMaxSpan();if(Oy(0,a,[0,100],0,f.minSpan,f.maxSpan),this.range=a,n[0]!==a[0]||n[1]!==a[1])return a}},pan:xU(function(r,e,t,i,n,a){var s=OP[i]([a.oldX,a.oldY],[a.newX,a.newY],e,n,t);return s.signal*(r[1]-r[0])*s.pixel/s.pixelLength}),scrollMove:xU(function(r,e,t,i,n,a){var s=OP[i]([0,0],[a.scrollDelta,a.scrollDelta],e,n,t);return s.signal*(r[1]-r[0])*a.scrollDelta})};function xU(r){return function(e,t,i,n){var a=this.range,s=a.slice(),o=e.axisModels[0];if(o){var l=r(s,o,e,t,i,n);if(Oy(l,s,[0,100],"all"),this.range=s,a[0]!==s[0]||a[1]!==s[1])return s}}}var OP={grid:function(r,e,t,i,n){var a=t.axis,s={},o=n.model.coordinateSystem.getRect();return r=r||[0,0],a.dim==="x"?(s.pixel=e[0]-r[0],s.pixelLength=o.width,s.pixelStart=o.x,s.signal=a.inverse?1:-1):(s.pixel=e[1]-r[1],s.pixelLength=o.height,s.pixelStart=o.y,s.signal=a.inverse?-1:1),s},polar:function(r,e,t,i,n){var a=t.axis,s={},o=n.model.coordinateSystem,l=o.getRadiusAxis().getExtent(),c=o.getAngleAxis().getExtent();return r=r?o.pointToCoord(r):[0,0],e=o.pointToCoord(e),t.mainType==="radiusAxis"?(s.pixel=e[0]-r[0],s.pixelLength=l[1]-l[0],s.pixelStart=l[0],s.signal=a.inverse?1:-1):(s.pixel=e[1]-r[1],s.pixelLength=c[1]-c[0],s.pixelStart=c[0],s.signal=a.inverse?-1:1),s},singleAxis:function(r,e,t,i,n){var a=t.axis,s=n.model.coordinateSystem.getRect(),o={};return r=r||[0,0],a.orient==="horizontal"?(o.pixel=e[0]-r[0],o.pixelLength=s.width,o.pixelStart=s.x,o.signal=a.inverse?1:-1):(o.pixel=e[1]-r[1],o.pixelLength=s.height,o.pixelStart=s.y,o.signal=a.inverse?-1:1),o}};function cZ(r){wO(r),r.registerComponentModel(AAe),r.registerComponentView(kAe),DAe(r)}var LAe=(function(r){Ye(e,r);function e(){var t=r!==null&&r.apply(this,arguments)||this;return t.type=e.type,t}return e.type="dataZoom.slider",e.layoutMode="box",e.defaultOption=Yg(kw.defaultOption,{show:!0,right:"ph",top:"ph",width:"ph",height:"ph",left:null,bottom:null,borderColor:"#d2dbee",borderRadius:3,backgroundColor:"rgba(47,69,84,0)",dataBackground:{lineStyle:{color:"#d2dbee",width:.5},areaStyle:{color:"#d2dbee",opacity:.2}},selectedDataBackground:{lineStyle:{color:"#8fb0f7",width:.5},areaStyle:{color:"#8fb0f7",opacity:.2}},fillerColor:"rgba(135,175,274,0.2)",handleIcon:"path://M-9.35,34.56V42m0-40V9.5m-2,0h4a2,2,0,0,1,2,2v21a2,2,0,0,1-2,2h-4a2,2,0,0,1-2-2v-21A2,2,0,0,1-11.35,9.5Z",handleSize:"100%",handleStyle:{color:"#fff",borderColor:"#ACB8D1"},moveHandleSize:7,moveHandleIcon:"path://M-320.9-50L-320.9-50c18.1,0,27.1,9,27.1,27.1V85.7c0,18.1-9,27.1-27.1,27.1l0,0c-18.1,0-27.1-9-27.1-27.1V-22.9C-348-41-339-50-320.9-50z M-212.3-50L-212.3-50c18.1,0,27.1,9,27.1,27.1V85.7c0,18.1-9,27.1-27.1,27.1l0,0c-18.1,0-27.1-9-27.1-27.1V-22.9C-239.4-41-230.4-50-212.3-50z M-103.7-50L-103.7-50c18.1,0,27.1,9,27.1,27.1V85.7c0,18.1-9,27.1-27.1,27.1l0,0c-18.1,0-27.1-9-27.1-27.1V-22.9C-130.9-41-121.8-50-103.7-50z",moveHandleStyle:{color:"#D2DBEE",opacity:.7},showDetail:!0,showDataShadow:"auto",realtime:!0,zoomLock:!1,textStyle:{color:"#6E7079"},brushSelect:!0,brushStyle:{color:"rgba(135,175,274,0.15)"},emphasis:{handleLabel:{show:!0},handleStyle:{borderColor:"#8FB0F7"},moveHandleStyle:{color:"#8FB0F7"}}}),e})(kw),n1=li,wU=7,OAe=1,NP=30,NAe=7,a1="horizontal",SU="vertical",BAe=5,zAe=["line","bar","candlestick","scatter"],FAe={easing:"cubicOut",duration:100,delay:0},VAe=(function(r){Ye(e,r);function e(){var t=r!==null&&r.apply(this,arguments)||this;return t.type=e.type,t._displayables={},t}return e.prototype.init=function(t,i){this.api=i,this._onBrush=Xt(this._onBrush,this),this._onBrushEnd=Xt(this._onBrushEnd,this)},e.prototype.render=function(t,i,n,a){if(r.prototype.render.apply(this,arguments),yb(this,"_dispatchZoomAction",t.get("throttle"),"fixRate"),this._orient=t.getOrient(),t.get("show")===!1){this.group.removeAll();return}if(t.noTarget()){this._clear(),this.group.removeAll();return}(!a||a.type!=="dataZoom"||a.from!==this.uid)&&this._buildView(),this._updateView()},e.prototype.dispose=function(){this._clear(),r.prototype.dispose.apply(this,arguments)},e.prototype._clear=function(){bw(this,"_dispatchZoomAction");var t=this.api.getZr();t.off("mousemove",this._onBrush),t.off("mouseup",this._onBrushEnd)},e.prototype._buildView=function(){var t=this.group;t.removeAll(),this._brushing=!1,this._displayables.brushRect=null,this._resetLocation(),this._resetInterval();var i=this._displayables.sliderGroup=new mr;this._renderBackground(),this._renderHandle(),this._renderDataShadow(),t.add(i),this._positionGroup()},e.prototype._resetLocation=function(){var t=this.dataZoomModel,i=this.api,n=t.get("brushSelect"),a=n?NAe:0,s=this._findCoordRect(),o={width:i.getWidth(),height:i.getHeight()},l=this._orient===a1?{right:o.width-s.x-s.width,top:o.height-NP-wU-a,width:s.width,height:NP}:{right:wU,top:s.y,width:NP,height:s.height},c=pb(t.option);se(["right","top","width","height"],function(p){c[p]==="ph"&&(c[p]=l[p])});var f=La(c,o);this._location={x:f.x,y:f.y},this._size=[f.width,f.height],this._orient===SU&&this._size.reverse()},e.prototype._positionGroup=function(){var t=this.group,i=this._location,n=this._orient,a=this.dataZoomModel.getFirstTargetAxisModel(),s=a&&a.get("inverse"),o=this._displayables.sliderGroup,l=(this._dataShadowInfo||{}).otherAxisInverse;o.attr(n===a1&&!s?{scaleY:l?1:-1,scaleX:1}:n===a1&&s?{scaleY:l?1:-1,scaleX:-1}:n===SU&&!s?{scaleY:l?-1:1,scaleX:1,rotation:Math.PI/2}:{scaleY:l?-1:1,scaleX:-1,rotation:Math.PI/2});var c=t.getBoundingRect([o]);t.x=i.x-c.x,t.y=i.y-c.y,t.markRedraw()},e.prototype._getViewExtent=function(){return[0,this._size[0]]},e.prototype._renderBackground=function(){var t=this.dataZoomModel,i=this._size,n=this._displayables.sliderGroup,a=t.get("brushSelect");n.add(new n1({silent:!0,shape:{x:0,y:0,width:i[0],height:i[1]},style:{fill:t.get("backgroundColor")},z2:-40}));var s=new n1({shape:{x:0,y:0,width:i[0],height:i[1]},style:{fill:"transparent"},z2:0,onclick:Xt(this._onClickPanel,this)}),o=this.api.getZr();a?(s.on("mousedown",this._onBrushStart,this),s.cursor="crosshair",o.on("mousemove",this._onBrush),o.on("mouseup",this._onBrushEnd)):(o.off("mousemove",this._onBrush),o.off("mouseup",this._onBrushEnd)),n.add(s)},e.prototype._renderDataShadow=function(){var t=this._dataShadowInfo=this._prepareDataShadowInfo();if(this._displayables.dataShadowSegs=[],!t)return;var i=this._size,n=this._shadowSize||[],a=t.series,s=a.getRawData(),o=a.getShadowDim&&a.getShadowDim(),l=o&&s.getDimensionInfo(o)?a.getShadowDim():t.otherDim;if(l==null)return;var c=this._shadowPolygonPts,f=this._shadowPolylinePts;if(s!==this._shadowData||l!==this._shadowDim||i[0]!==n[0]||i[1]!==n[1]){var p=s.getDataExtent(l),y=(p[1]-p[0])*.3;p=[p[0]-y,p[1]+y];var b=[0,i[1]],S=[0,i[0]],C=[[i[0],0],[0,0]],E=[],P=S[1]/(s.count()-1),O=0,B=Math.round(s.count()/i[0]),F;s.each([l],function(ee,te){if(B>0&&te%B){O+=P;return}var ae=ee==null||isNaN(ee)||ee==="",de=ae?0:Ii(ee,p,b,!0);ae&&!F&&te?(C.push([C[C.length-1][0],0]),E.push([E[E.length-1][0],0])):!ae&&F&&(C.push([O,0]),E.push([O,0])),C.push([O,de]),E.push([O,de]),O+=P,F=ae}),c=this._shadowPolygonPts=C,f=this._shadowPolylinePts=E}this._shadowData=s,this._shadowDim=l,this._shadowSize=[i[0],i[1]];var W=this.dataZoomModel;function $(ee){var te=W.getModel(ee?"selectedDataBackground":"dataBackground"),ae=new mr,de=new Rs({shape:{points:c},segmentIgnoreThreshold:1,style:te.getModel("areaStyle").getAreaStyle(),silent:!0,z2:-20}),ve=new ks({shape:{points:f},segmentIgnoreThreshold:1,style:te.getModel("lineStyle").getLineStyle(),silent:!0,z2:-19});return ae.add(de),ae.add(ve),ae}for(var q=0;q<3;q++){var Q=$(q===1);this._displayables.sliderGroup.add(Q),this._displayables.dataShadowSegs.push(Q)}},e.prototype._prepareDataShadowInfo=function(){var t=this.dataZoomModel,i=t.get("showDataShadow");if(i!==!1){var n,a=this.ecModel;return t.eachTargetAxis(function(s,o){var l=t.getAxisProxy(s,o).getTargetSeriesModels();se(l,function(c){if(!n&&!(i!==!0&&Or(zAe,c.get("type"))<0)){var f=a.getComponent(Rg(s),o).axis,p=UAe(s),y,b=c.coordinateSystem;p!=null&&b.getOtherAxis&&(y=b.getOtherAxis(f).inverse),p=c.getData().mapDimension(p),n={thisAxis:f,series:c,thisDim:s,otherDim:p,otherAxisInverse:y}}},this)},this),n}},e.prototype._renderHandle=function(){var t=this.group,i=this._displayables,n=i.handles=[null,null],a=i.handleLabels=[null,null],s=this._displayables.sliderGroup,o=this._size,l=this.dataZoomModel,c=this.api,f=l.get("borderRadius")||0,p=l.get("brushSelect"),y=i.filler=new n1({silent:p,style:{fill:l.get("fillerColor")},textConfig:{position:"inside"}});s.add(y),s.add(new n1({silent:!0,subPixelOptimize:!0,shape:{x:0,y:0,width:o[0],height:o[1],r:f},style:{stroke:l.get("dataBackgroundColor")||l.get("borderColor"),lineWidth:OAe,fill:"rgba(0,0,0,0)"}})),se([0,1],function(B){var F=l.get("handleIcon");!OA[F]&&F.indexOf("path://")<0&&F.indexOf("image://")<0&&(F="path://"+F);var W=Aa(F,-1,0,2,2,null,!0);W.attr({cursor:TU(this._orient),draggable:!0,drift:Xt(this._onDragMove,this,B),ondragend:Xt(this._onDragEnd,this),onmouseover:Xt(this._showDataInfo,this,!0),onmouseout:Xt(this._showDataInfo,this,!1),z2:5});var $=W.getBoundingRect(),q=l.get("handleSize");this._handleHeight=Vt(q,this._size[1]),this._handleWidth=$.width/$.height*this._handleHeight,W.setStyle(l.getModel("handleStyle").getItemStyle()),W.style.strokeNoScale=!0,W.rectHover=!0,W.ensureState("emphasis").style=l.getModel(["emphasis","handleStyle"]).getItemStyle(),Og(W);var Q=l.get("handleColor");Q!=null&&(W.style.fill=Q),s.add(n[B]=W);var ee=l.getModel("textStyle"),te=l.get("handleLabel")||{},ae=te.show||!1;t.add(a[B]=new si({silent:!0,invisible:!ae,style:cn(ee,{x:0,y:0,text:"",verticalAlign:"middle",align:"center",fill:ee.getTextColor(),font:ee.getFont()}),z2:10}))},this);var b=y;if(p){var S=Vt(l.get("moveHandleSize"),o[1]),C=i.moveHandle=new li({style:l.getModel("moveHandleStyle").getItemStyle(),silent:!0,shape:{r:[0,0,2,2],y:o[1]-.5,height:S}}),E=S*.8,P=i.moveHandleIcon=Aa(l.get("moveHandleIcon"),-E/2,-E/2,E,E,"#fff",!0);P.silent=!0,P.y=o[1]+S/2-.5,C.ensureState("emphasis").style=l.getModel(["emphasis","moveHandleStyle"]).getItemStyle();var O=Math.min(o[1]/2,Math.max(S,10));b=i.moveZone=new li({invisible:!0,shape:{y:o[1]-O,height:S+O}}),b.on("mouseover",function(){c.enterEmphasis(C)}).on("mouseout",function(){c.leaveEmphasis(C)}),s.add(C),s.add(P),s.add(b)}b.attr({draggable:!0,cursor:TU(this._orient),drift:Xt(this._onDragMove,this,"all"),ondragstart:Xt(this._showDataInfo,this,!0),ondragend:Xt(this._onDragEnd,this),onmouseover:Xt(this._showDataInfo,this,!0),onmouseout:Xt(this._showDataInfo,this,!1)})},e.prototype._resetInterval=function(){var t=this._range=this.dataZoomModel.getPercentRange(),i=this._getViewExtent();this._handleEnds=[Ii(t[0],[0,100],i,!0),Ii(t[1],[0,100],i,!0)]},e.prototype._updateInterval=function(t,i){var n=this.dataZoomModel,a=this._handleEnds,s=this._getViewExtent(),o=n.findRepresentativeAxisProxy().getMinMaxSpan(),l=[0,100];Oy(i,a,s,n.get("zoomLock")?"all":t,o.minSpan!=null?Ii(o.minSpan,l,s,!0):null,o.maxSpan!=null?Ii(o.maxSpan,l,s,!0):null);var c=this._range,f=this._range=yu([Ii(a[0],s,l,!0),Ii(a[1],s,l,!0)]);return!c||c[0]!==f[0]||c[1]!==f[1]},e.prototype._updateView=function(t){var i=this._displayables,n=this._handleEnds,a=yu(n.slice()),s=this._size;se([0,1],function(b){var S=i.handles[b],C=this._handleHeight;S.attr({scaleX:C/2,scaleY:C/2,x:n[b]+(b?-1:1),y:s[1]/2-C/2})},this),i.filler.setShape({x:a[0],y:0,width:a[1]-a[0],height:s[1]});var o={x:a[0],width:a[1]-a[0]};i.moveHandle&&(i.moveHandle.setShape(o),i.moveZone.setShape(o),i.moveZone.getBoundingRect(),i.moveHandleIcon&&i.moveHandleIcon.attr("x",o.x+o.width/2));for(var l=i.dataShadowSegs,c=[0,a[0],a[1],s[0]],f=0;f<l.length;f++){var p=l[f],y=p.getClipPath();y||(y=new li,p.setClipPath(y)),y.setShape({x:c[f],y:0,width:c[f+1]-c[f],height:s[1]})}this._updateDataInfo(t)},e.prototype._updateDataInfo=function(t){var i=this.dataZoomModel,n=this._displayables,a=n.handleLabels,s=this._orient,o=["",""];if(i.get("showDetail")){var l=i.findRepresentativeAxisProxy();if(l){var c=l.getAxisModel().axis,f=this._range,p=t?l.calculateDataWindow({start:f[0],end:f[1]}).valueWindow:l.getDataValueWindow();o=[this._formatLabel(p[0],c),this._formatLabel(p[1],c)]}}var y=yu(this._handleEnds.slice());b.call(this,0),b.call(this,1);function b(S){var C=Ng(n.handles[S].parent,this.group),E=UC(S===0?"right":"left",C),P=this._handleWidth/2+BAe,O=Mh([y[S]+(S===0?-P:P),this._size[1]/2],C);a[S].setStyle({x:O[0],y:O[1],verticalAlign:s===a1?"middle":E,align:s===a1?E:"center",text:o[S]})}},e.prototype._formatLabel=function(t,i){var n=this.dataZoomModel,a=n.get("labelFormatter"),s=n.get("labelPrecision");(s==null||s==="auto")&&(s=i.getPixelPrecision());var o=t==null||isNaN(t)?"":i.type==="category"||i.type==="time"?i.scale.getLabel({value:Math.round(t)}):t.toFixed(Math.min(s,20));return sr(a)?a(t,o):$t(a)?a.replace("{value}",o):o},e.prototype._showDataInfo=function(t){var i=this.dataZoomModel.get("handleLabel")||{},n=i.show||!1,a=this.dataZoomModel.getModel(["emphasis","handleLabel"]),s=a.get("show")||!1,o=t||this._dragging?s:n,l=this._displayables,c=l.handleLabels;c[0].attr("invisible",!o),c[1].attr("invisible",!o),l.moveHandle&&this.api[o?"enterEmphasis":"leaveEmphasis"](l.moveHandle,1)},e.prototype._onDragMove=function(t,i,n,a){this._dragging=!0,up(a.event);var s=this._displayables.sliderGroup.getLocalTransform(),o=Mh([i,n],s,!0),l=this._updateInterval(t,o[0]),c=this.dataZoomModel.get("realtime");this._updateView(!c),l&&c&&this._dispatchZoomAction(!0)},e.prototype._onDragEnd=function(){this._dragging=!1,this._showDataInfo(!1);var t=this.dataZoomModel.get("realtime");!t&&this._dispatchZoomAction(!1)},e.prototype._onClickPanel=function(t){var i=this._size,n=this._displayables.sliderGroup.transformCoordToLocal(t.offsetX,t.offsetY);if(!(n[0]<0||n[0]>i[0]||n[1]<0||n[1]>i[1])){var a=this._handleEnds,s=(a[0]+a[1])/2,o=this._updateInterval("all",n[0]-s);this._updateView(),o&&this._dispatchZoomAction(!1)}},e.prototype._onBrushStart=function(t){var i=t.offsetX,n=t.offsetY;this._brushStart=new Rr(i,n),this._brushing=!0,this._brushStartTime=+new Date},e.prototype._onBrushEnd=function(t){if(this._brushing){var i=this._displayables.brushRect;if(this._brushing=!1,!!i){i.attr("ignore",!0);var n=i.shape,a=+new Date;if(!(a-this._brushStartTime<200&&Math.abs(n.width)<5)){var s=this._getViewExtent(),o=[0,100];this._range=yu([Ii(n.x,s,o,!0),Ii(n.x+n.width,s,o,!0)]),this._handleEnds=[n.x,n.x+n.width],this._updateView(),this._dispatchZoomAction(!1)}}}},e.prototype._onBrush=function(t){this._brushing&&(up(t.event),this._updateBrushRect(t.offsetX,t.offsetY))},e.prototype._updateBrushRect=function(t,i){var n=this._displayables,a=this.dataZoomModel,s=n.brushRect;s||(s=n.brushRect=new n1({silent:!0,style:a.getModel("brushStyle").getItemStyle()}),n.sliderGroup.add(s)),s.attr("ignore",!1);var o=this._brushStart,l=this._displayables.sliderGroup,c=l.transformCoordToLocal(t,i),f=l.transformCoordToLocal(o.x,o.y),p=this._size;c[0]=Math.max(Math.min(p[0],c[0]),0),s.setShape({x:f[0],y:0,width:c[0]-f[0],height:p[1]})},e.prototype._dispatchZoomAction=function(t){var i=this._range;this.api.dispatchAction({type:"dataZoom",from:this.uid,dataZoomId:this.dataZoomModel.id,animation:t?FAe:null,start:i[0],end:i[1]})},e.prototype._findCoordRect=function(){var t,i=WX(this.dataZoomModel).infoList;if(!t&&i.length){var n=i[0].model.coordinateSystem;t=n.getRect&&n.getRect()}if(!t){var a=this.api.getWidth(),s=this.api.getHeight();t={x:a*.2,y:s*.2,width:a*.6,height:s*.6}}return t},e.type="dataZoom.slider",e})(xO);function UAe(r){var e={x:"y",y:"x",radius:"angle",angle:"radius"};return e[r]}function TU(r){return r==="vertical"?"ns-resize":"ew-resize"}function hZ(r){r.registerComponentModel(LAe),r.registerComponentView(VAe),wO(r)}function HAe(r){Vr(cZ),Vr(hZ)}var fZ={get:function(r,e,t){var i=hr((jAe[r]||{})[e]);return t&&xt(i)?i[i.length-1]:i}},jAe={color:{active:["#006edd","#e0ffff"],inactive:["rgba(0,0,0,0)"]},colorHue:{active:[0,360],inactive:[0,0]},colorSaturation:{active:[.3,1],inactive:[0,0]},colorLightness:{active:[.9,.5],inactive:[0,0]},colorAlpha:{active:[.3,1],inactive:[0,0]},opacity:{active:[.3,1],inactive:[0,0]},symbol:{active:["circle","roundRect","diamond"],inactive:["none"]},symbolSize:{active:[10,50],inactive:[0,0]}},AU=ho.mapVisual,$Ae=ho.eachVisual,WAe=xt,CU=se,GAe=yu,XAe=Ii,sC=(function(r){Ye(e,r);function e(){var t=r!==null&&r.apply(this,arguments)||this;return t.type=e.type,t.stateList=["inRange","outOfRange"],t.replacableOptionKeys=["inRange","outOfRange","target","controller","color"],t.layoutMode={type:"box",ignoreSize:!0},t.dataBound=[-1/0,1/0],t.targetVisuals={},t.controllerVisuals={},t}return e.prototype.init=function(t,i,n){this.mergeDefaultAndTheme(t,n)},e.prototype.optionUpdated=function(t,i){var n=this.option;!i&&tZ(n,t,this.replacableOptionKeys),this.textStyleModel=this.getModel("textStyle"),this.resetItemSize(),this.completeVisualOption()},e.prototype.resetVisual=function(t){var i=this.stateList;t=Xt(t,this),this.controllerVisuals=aD(this.option.controller,i,t),this.targetVisuals=aD(this.option.target,i,t)},e.prototype.getItemSymbol=function(){return null},e.prototype.getTargetSeriesIndices=function(){var t=this.option.seriesIndex,i=[];return t==null||t==="all"?this.ecModel.eachSeries(function(n,a){i.push(a)}):i=Gi(t),i},e.prototype.eachTargetSeries=function(t,i){se(this.getTargetSeriesIndices(),function(n){var a=this.ecModel.getSeriesByIndex(n);a&&t.call(i,a)},this)},e.prototype.isTargetSeries=function(t){var i=!1;return this.eachTargetSeries(function(n){n===t&&(i=!0)}),i},e.prototype.formatValueText=function(t,i,n){var a=this.option,s=a.precision,o=this.dataBound,l=a.formatter,c;n=n||["<",">"],xt(t)&&(t=t.slice(),c=!0);var f=i?t:c?[p(t[0]),p(t[1])]:p(t);if($t(l))return l.replace("{value}",c?f[0]:f).replace("{value2}",c?f[1]:f);if(sr(l))return c?l(t[0],t[1]):l(t);if(c)return t[0]===o[0]?n[0]+" "+f[1]:t[1]===o[1]?n[1]+" "+f[0]:f[0]+" - "+f[1];return f;function p(y){return y===o[0]?"min":y===o[1]?"max":(+y).toFixed(Math.min(s,20))}},e.prototype.resetExtent=function(){var t=this.option,i=GAe([t.min,t.max]);this._dataExtent=i},e.prototype.getDataDimensionIndex=function(t){var i=this.option.dimension;if(i!=null)return t.getDimensionIndex(i);for(var n=t.dimensions,a=n.length-1;a>=0;a--){var s=n[a],o=t.getDimensionInfo(s);if(!o.isCalculationCoord)return o.storeDimIndex}},e.prototype.getExtent=function(){return this._dataExtent.slice()},e.prototype.completeVisualOption=function(){var t=this.ecModel,i=this.option,n={inRange:i.inRange,outOfRange:i.outOfRange},a=i.target||(i.target={}),s=i.controller||(i.controller={});Cr(a,n),Cr(s,n);var o=this.isCategory();l.call(this,a),l.call(this,s),c.call(this,a,"inRange","outOfRange"),f.call(this,s);function l(p){WAe(i.color)&&!p.inRange&&(p.inRange={color:i.color.slice().reverse()}),p.inRange=p.inRange||{color:t.get("gradientColor")}}function c(p,y,b){var S=p[y],C=p[b];S&&!C&&(C=p[b]={},CU(S,function(E,P){if(ho.isValidType(P)){var O=fZ.get(P,"inactive",o);O!=null&&(C[P]=O,P==="color"&&!C.hasOwnProperty("opacity")&&!C.hasOwnProperty("colorAlpha")&&(C.opacity=[0,0]))}}))}function f(p){var y=(p.inRange||{}).symbol||(p.outOfRange||{}).symbol,b=(p.inRange||{}).symbolSize||(p.outOfRange||{}).symbolSize,S=this.get("inactiveColor"),C=this.getItemSymbol(),E=C||"roundRect";CU(this.stateList,function(P){var O=this.itemSize,B=p[P];B||(B=p[P]={color:o?S:[S]}),B.symbol==null&&(B.symbol=y&&hr(y)||(o?E:[E])),B.symbolSize==null&&(B.symbolSize=b&&hr(b)||(o?O[0]:[O[0],O[0]])),B.symbol=AU(B.symbol,function($){return $==="none"?E:$});var F=B.symbolSize;if(F!=null){var W=-1/0;$Ae(F,function($){$>W&&(W=$)}),B.symbolSize=AU(F,function($){return XAe($,[0,W],[0,O[0]],!0)})}},this)}},e.prototype.resetItemSize=function(){this.itemSize=[parseFloat(this.get("itemWidth")),parseFloat(this.get("itemHeight"))]},e.prototype.isCategory=function(){return!!this.option.categories},e.prototype.setSelected=function(t){},e.prototype.getSelected=function(){return null},e.prototype.getValueState=function(t){return null},e.prototype.getVisualMeta=function(t){return null},e.type="visualMap",e.dependencies=["series"],e.defaultOption={show:!0,z:4,seriesIndex:"all",min:0,max:200,left:0,right:null,top:null,bottom:0,itemWidth:null,itemHeight:null,inverse:!1,orient:"vertical",backgroundColor:"rgba(0,0,0,0)",borderColor:"#ccc",contentColor:"#5793f3",inactiveColor:"#aaa",borderWidth:0,padding:5,textGap:10,precision:0,textStyle:{color:"#333"}},e})(Wr),MU=[20,140],ZAe=(function(r){Ye(e,r);function e(){var t=r!==null&&r.apply(this,arguments)||this;return t.type=e.type,t}return e.prototype.optionUpdated=function(t,i){r.prototype.optionUpdated.apply(this,arguments),this.resetExtent(),this.resetVisual(function(n){n.mappingMethod="linear",n.dataExtent=this.getExtent()}),this._resetRange()},e.prototype.resetItemSize=function(){r.prototype.resetItemSize.apply(this,arguments);var t=this.itemSize;(t[0]==null||isNaN(t[0]))&&(t[0]=MU[0]),(t[1]==null||isNaN(t[1]))&&(t[1]=MU[1])},e.prototype._resetRange=function(){var t=this.getExtent(),i=this.option.range;!i||i.auto?(t.auto=1,this.option.range=t):xt(i)&&(i[0]>i[1]&&i.reverse(),i[0]=Math.max(i[0],t[0]),i[1]=Math.min(i[1],t[1]))},e.prototype.completeVisualOption=function(){r.prototype.completeVisualOption.apply(this,arguments),se(this.stateList,function(t){var i=this.option.controller[t].symbolSize;i&&i[0]!==i[1]&&(i[0]=i[1]/3)},this)},e.prototype.setSelected=function(t){this.option.range=t.slice(),this._resetRange()},e.prototype.getSelected=function(){var t=this.getExtent(),i=yu((this.get("range")||[]).slice());return i[0]>t[1]&&(i[0]=t[1]),i[1]>t[1]&&(i[1]=t[1]),i[0]<t[0]&&(i[0]=t[0]),i[1]<t[0]&&(i[1]=t[0]),i},e.prototype.getValueState=function(t){var i=this.option.range,n=this.getExtent();return(i[0]<=n[0]||i[0]<=t)&&(i[1]>=n[1]||t<=i[1])?"inRange":"outOfRange"},e.prototype.findTargetDataIndices=function(t){var i=[];return this.eachTargetSeries(function(n){var a=[],s=n.getData();s.each(this.getDataDimensionIndex(s),function(o,l){t[0]<=o&&o<=t[1]&&a.push(l)},this),i.push({seriesId:n.id,dataIndex:a})},this),i},e.prototype.getVisualMeta=function(t){var i=EU(this,"outOfRange",this.getExtent()),n=EU(this,"inRange",this.option.range.slice()),a=[];function s(b,S){a.push({value:b,color:t(b,S)})}for(var o=0,l=0,c=n.length,f=i.length;l<f&&(!n.length||i[l]<=n[0]);l++)i[l]<n[o]&&s(i[l],"outOfRange");for(var p=1;o<c;o++,p=0)p&&a.length&&s(n[o],"outOfRange"),s(n[o],"inRange");for(var p=1;l<f;l++)(!n.length||n[n.length-1]<i[l])&&(p&&(a.length&&s(a[a.length-1].value,"outOfRange"),p=0),s(i[l],"outOfRange"));var y=a.length;return{stops:a,outerColors:[y?a[0].color:"transparent",y?a[y-1].color:"transparent"]}},e.type="visualMap.continuous",e.defaultOption=Yg(sC.defaultOption,{align:"auto",calculable:!1,hoverLink:!0,realtime:!0,handleIcon:"path://M-11.39,9.77h0a3.5,3.5,0,0,1-3.5,3.5h-22a3.5,3.5,0,0,1-3.5-3.5h0a3.5,3.5,0,0,1,3.5-3.5h22A3.5,3.5,0,0,1-11.39,9.77Z",handleSize:"120%",handleStyle:{borderColor:"#fff",borderWidth:1},indicatorIcon:"circle",indicatorSize:"50%",indicatorStyle:{borderColor:"#fff",borderWidth:2,shadowBlur:2,shadowOffsetX:1,shadowOffsetY:1,shadowColor:"rgba(0,0,0,0.2)"}}),e})(sC);function EU(r,e,t){if(t[0]===t[1])return t.slice();for(var i=200,n=(t[1]-t[0])/i,a=t[0],s=[],o=0;o<=i&&a<t[1];o++)s.push(a),a+=n;return s.push(t[1]),s}var dZ=(function(r){Ye(e,r);function e(){var t=r!==null&&r.apply(this,arguments)||this;return t.type=e.type,t.autoPositionValues={left:1,right:1,top:1,bottom:1},t}return e.prototype.init=function(t,i){this.ecModel=t,this.api=i},e.prototype.render=function(t,i,n,a){if(this.visualMapModel=t,t.get("show")===!1){this.group.removeAll();return}this.doRender(t,i,n,a)},e.prototype.renderBackground=function(t){var i=this.visualMapModel,n=Ry(i.get("padding")||0),a=t.getBoundingRect();t.add(new li({z2:-1,silent:!0,shape:{x:a.x-n[3],y:a.y-n[0],width:a.width+n[3]+n[1],height:a.height+n[0]+n[2]},style:{fill:i.get("backgroundColor"),stroke:i.get("borderColor"),lineWidth:i.get("borderWidth")}}))},e.prototype.getControllerVisual=function(t,i,n){n=n||{};var a=n.forceState,s=this.visualMapModel,o={};if(i==="color"){var l=s.get("contentColor");o.color=l}function c(b){return o[b]}function f(b,S){o[b]=S}var p=s.controllerVisuals[a||s.getValueState(t)],y=ho.prepareVisualTypes(p);return se(y,function(b){var S=p[b];n.convertOpacityToAlpha&&b==="opacity"&&(b="colorAlpha",S=p.__alphaForOpacity),ho.dependsOn(b,i)&&S&&S.applyVisual(t,c,f)}),o[i]},e.prototype.positionGroup=function(t){var i=this.visualMapModel,n=this.api;XC(t,i.getBoxLayoutParams(),{width:n.getWidth(),height:n.getHeight()})},e.prototype.doRender=function(t,i,n,a){},e.type="visualMap",e})(vn),IU=[["left","right","width"],["top","bottom","height"]];function pZ(r,e,t){var i=r.option,n=i.align;if(n!=null&&n!=="auto")return n;for(var a={width:e.getWidth(),height:e.getHeight()},s=i.orient==="horizontal"?1:0,o=IU[s],l=[0,null,10],c={},f=0;f<3;f++)c[IU[1-s][f]]=l[f],c[o[f]]=f===2?t[0]:i[o[f]];var p=[["x","width",3],["y","height",0]][s],y=La(c,a,i.padding);return o[(y.margin[p[2]]||0)+y[p[0]]+y[p[1]]*.5<a[p[1]]*.5?0:1]}function X2(r,e){return se(r||[],function(t){t.dataIndex!=null&&(t.dataIndexInside=t.dataIndex,t.dataIndex=null),t.highlightKey="visualMap"+(e?e.componentIndex:"")}),r}var Cf=Ii,qAe=se,PU=Math.min,BP=Math.max,YAe=12,KAe=6,QAe=(function(r){Ye(e,r);function e(){var t=r!==null&&r.apply(this,arguments)||this;return t.type=e.type,t._shapes={},t._dataInterval=[],t._handleEnds=[],t._hoverLinkDataIndices=[],t}return e.prototype.init=function(t,i){r.prototype.init.call(this,t,i),this._hoverLinkFromSeriesMouseOver=Xt(this._hoverLinkFromSeriesMouseOver,this),this._hideIndicator=Xt(this._hideIndicator,this)},e.prototype.doRender=function(t,i,n,a){(!a||a.type!=="selectDataRange"||a.from!==this.uid)&&this._buildView()},e.prototype._buildView=function(){this.group.removeAll();var t=this.visualMapModel,i=this.group;this._orient=t.get("orient"),this._useHandle=t.get("calculable"),this._resetInterval(),this._renderBar(i);var n=t.get("text");this._renderEndsText(i,n,0),this._renderEndsText(i,n,1),this._updateView(!0),this.renderBackground(i),this._updateView(),this._enableHoverLinkToSeries(),this._enableHoverLinkFromSeries(),this.positionGroup(i)},e.prototype._renderEndsText=function(t,i,n){if(i){var a=i[1-n];a=a!=null?a+"":"";var s=this.visualMapModel,o=s.get("textGap"),l=s.itemSize,c=this._shapes.mainGroup,f=this._applyTransform([l[0]/2,n===0?-o:l[1]+o],c),p=this._applyTransform(n===0?"bottom":"top",c),y=this._orient,b=this.visualMapModel.textStyleModel;this.group.add(new si({style:cn(b,{x:f[0],y:f[1],verticalAlign:y==="horizontal"?"middle":p,align:y==="horizontal"?p:"center",text:a})}))}},e.prototype._renderBar=function(t){var i=this.visualMapModel,n=this._shapes,a=i.itemSize,s=this._orient,o=this._useHandle,l=pZ(i,this.api,a),c=n.mainGroup=this._createBarGroup(l),f=new mr;c.add(f),f.add(n.outOfRange=RU()),f.add(n.inRange=RU(null,o?kU(this._orient):null,Xt(this._dragHandle,this,"all",!1),Xt(this._dragHandle,this,"all",!0))),f.setClipPath(new li({shape:{x:0,y:0,width:a[0],height:a[1],r:3}}));var p=i.textStyleModel.getTextRect("国"),y=BP(p.width,p.height);o&&(n.handleThumbs=[],n.handleLabels=[],n.handleLabelPoints=[],this._createHandle(i,c,0,a,y,s),this._createHandle(i,c,1,a,y,s)),this._createIndicator(i,c,a,y,s),t.add(c)},e.prototype._createHandle=function(t,i,n,a,s,o){var l=Xt(this._dragHandle,this,n,!1),c=Xt(this._dragHandle,this,n,!0),f=Rh(t.get("handleSize"),a[0]),p=Aa(t.get("handleIcon"),-f/2,-f/2,f,f,null,!0),y=kU(this._orient);p.attr({cursor:y,draggable:!0,drift:l,ondragend:c,onmousemove:function(P){up(P.event)}}),p.x=a[0]/2,p.useStyle(t.getModel("handleStyle").getItemStyle()),p.setStyle({strokeNoScale:!0,strokeFirst:!0}),p.style.lineWidth*=2,p.ensureState("emphasis").style=t.getModel(["emphasis","handleStyle"]).getItemStyle(),jm(p,!0),i.add(p);var b=this.visualMapModel.textStyleModel,S=new si({cursor:y,draggable:!0,drift:l,onmousemove:function(P){up(P.event)},ondragend:c,style:cn(b,{x:0,y:0,text:""})});S.ensureState("blur").style={opacity:.1},S.stateTransition={duration:200},this.group.add(S);var C=[f,0],E=this._shapes;E.handleThumbs[n]=p,E.handleLabelPoints[n]=C,E.handleLabels[n]=S},e.prototype._createIndicator=function(t,i,n,a,s){var o=Rh(t.get("indicatorSize"),n[0]),l=Aa(t.get("indicatorIcon"),-o/2,-o/2,o,o,null,!0);l.attr({cursor:"move",invisible:!0,silent:!0,x:n[0]/2});var c=t.getModel("indicatorStyle").getItemStyle();if(l instanceof go){var f=l.style;l.useStyle(mt({image:f.image,x:f.x,y:f.y,width:f.width,height:f.height},c))}else l.useStyle(c);i.add(l);var p=this.visualMapModel.textStyleModel,y=new si({silent:!0,invisible:!0,style:cn(p,{x:0,y:0,text:""})});this.group.add(y);var b=[(s==="horizontal"?a/2:KAe)+n[0]/2,0],S=this._shapes;S.indicator=l,S.indicatorLabel=y,S.indicatorLabelPoint=b,this._firstShowIndicator=!0},e.prototype._dragHandle=function(t,i,n,a){if(this._useHandle){if(this._dragging=!i,!i){var s=this._applyTransform([n,a],this._shapes.mainGroup,!0);this._updateInterval(t,s[1]),this._hideIndicator(),this._updateView()}i===!this.visualMapModel.get("realtime")&&this.api.dispatchAction({type:"selectDataRange",from:this.uid,visualMapId:this.visualMapModel.id,selected:this._dataInterval.slice()}),i?!this._hovering&&this._clearHoverLinkToSeries():DU(this.visualMapModel)&&this._doHoverLinkToSeries(this._handleEnds[t],!1)}},e.prototype._resetInterval=function(){var t=this.visualMapModel,i=this._dataInterval=t.getSelected(),n=t.getExtent(),a=[0,t.itemSize[1]];this._handleEnds=[Cf(i[0],n,a,!0),Cf(i[1],n,a,!0)]},e.prototype._updateInterval=function(t,i){i=i||0;var n=this.visualMapModel,a=this._handleEnds,s=[0,n.itemSize[1]];Oy(i,a,s,t,0);var o=n.getExtent();this._dataInterval=[Cf(a[0],s,o,!0),Cf(a[1],s,o,!0)]},e.prototype._updateView=function(t){var i=this.visualMapModel,n=i.getExtent(),a=this._shapes,s=[0,i.itemSize[1]],o=t?s:this._handleEnds,l=this._createBarVisual(this._dataInterval,n,o,"inRange"),c=this._createBarVisual(n,n,s,"outOfRange");a.inRange.setStyle({fill:l.barColor}).setShape("points",l.barPoints),a.outOfRange.setStyle({fill:c.barColor}).setShape("points",c.barPoints),this._updateHandle(o,l)},e.prototype._createBarVisual=function(t,i,n,a){var s={forceState:a,convertOpacityToAlpha:!0},o=this._makeColorGradient(t,s),l=[this.getControllerVisual(t[0],"symbolSize",s),this.getControllerVisual(t[1],"symbolSize",s)],c=this._createBarPoints(n,l);return{barColor:new ub(0,0,0,1,o),barPoints:c,handlesColor:[o[0].color,o[o.length-1].color]}},e.prototype._makeColorGradient=function(t,i){var n=100,a=[],s=(t[1]-t[0])/n;a.push({color:this.getControllerVisual(t[0],"color",i),offset:0});for(var o=1;o<n;o++){var l=t[0]+s*o;if(l>t[1])break;a.push({color:this.getControllerVisual(l,"color",i),offset:o/n})}return a.push({color:this.getControllerVisual(t[1],"color",i),offset:1}),a},e.prototype._createBarPoints=function(t,i){var n=this.visualMapModel.itemSize;return[[n[0]-i[0],t[0]],[n[0],t[0]],[n[0],t[1]],[n[0]-i[1],t[1]]]},e.prototype._createBarGroup=function(t){var i=this._orient,n=this.visualMapModel.get("inverse");return new mr(i==="horizontal"&&!n?{scaleX:t==="bottom"?1:-1,rotation:Math.PI/2}:i==="horizontal"&&n?{scaleX:t==="bottom"?-1:1,rotation:-Math.PI/2}:i==="vertical"&&!n?{scaleX:t==="left"?1:-1,scaleY:-1}:{scaleX:t==="left"?1:-1})},e.prototype._updateHandle=function(t,i){if(this._useHandle){var n=this._shapes,a=this.visualMapModel,s=n.handleThumbs,o=n.handleLabels,l=a.itemSize,c=a.getExtent(),f=this._applyTransform("left",n.mainGroup);qAe([0,1],function(p){var y=s[p];y.setStyle("fill",i.handlesColor[p]),y.y=t[p];var b=Cf(t[p],[0,l[1]],c,!0),S=this.getControllerVisual(b,"symbolSize");y.scaleX=y.scaleY=S/l[0],y.x=l[0]-S/2;var C=Mh(n.handleLabelPoints[p],Ng(y,this.group));if(this._orient==="horizontal"){var E=f==="left"||f==="top"?(l[0]-S)/2:(l[0]-S)/-2;C[1]+=E}o[p].setStyle({x:C[0],y:C[1],text:a.formatValueText(this._dataInterval[p]),verticalAlign:"middle",align:this._orient==="vertical"?this._applyTransform("left",n.mainGroup):"center"})},this)}},e.prototype._showIndicator=function(t,i,n,a){var s=this.visualMapModel,o=s.getExtent(),l=s.itemSize,c=[0,l[1]],f=this._shapes,p=f.indicator;if(p){p.attr("invisible",!1);var y={convertOpacityToAlpha:!0},b=this.getControllerVisual(t,"color",y),S=this.getControllerVisual(t,"symbolSize"),C=Cf(t,o,c,!0),E=l[0]-S/2,P={x:p.x,y:p.y};p.y=C,p.x=E;var O=Mh(f.indicatorLabelPoint,Ng(p,this.group)),B=f.indicatorLabel;B.attr("invisible",!1);var F=this._applyTransform("left",f.mainGroup),W=this._orient,$=W==="horizontal";B.setStyle({text:(n||"")+s.formatValueText(i),verticalAlign:$?F:"middle",align:$?"center":F});var q={x:E,y:C,style:{fill:b}},Q={style:{x:O[0],y:O[1]}};if(s.ecModel.isAnimationEnabled()&&!this._firstShowIndicator){var ee={duration:100,easing:"cubicInOut",additive:!0};p.x=P.x,p.y=P.y,p.animateTo(q,ee),B.animateTo(Q,ee)}else p.attr(q),B.attr(Q);this._firstShowIndicator=!1;var te=this._shapes.handleLabels;if(te)for(var ae=0;ae<te.length;ae++)this.api.enterBlur(te[ae])}},e.prototype._enableHoverLinkToSeries=function(){var t=this;this._shapes.mainGroup.on("mousemove",function(i){if(t._hovering=!0,!t._dragging){var n=t.visualMapModel.itemSize,a=t._applyTransform([i.offsetX,i.offsetY],t._shapes.mainGroup,!0,!0);a[1]=PU(BP(0,a[1]),n[1]),t._doHoverLinkToSeries(a[1],0<=a[0]&&a[0]<=n[0])}}).on("mouseout",function(){t._hovering=!1,!t._dragging&&t._clearHoverLinkToSeries()})},e.prototype._enableHoverLinkFromSeries=function(){var t=this.api.getZr();this.visualMapModel.option.hoverLink?(t.on("mouseover",this._hoverLinkFromSeriesMouseOver,this),t.on("mouseout",this._hideIndicator,this)):this._clearHoverLinkFromSeries()},e.prototype._doHoverLinkToSeries=function(t,i){var n=this.visualMapModel,a=n.itemSize;if(n.option.hoverLink){var s=[0,a[1]],o=n.getExtent();t=PU(BP(s[0],t),s[1]);var l=JAe(n,o,s),c=[t-l,t+l],f=Cf(t,s,o,!0),p=[Cf(c[0],s,o,!0),Cf(c[1],s,o,!0)];c[0]<s[0]&&(p[0]=-1/0),c[1]>s[1]&&(p[1]=1/0),i&&(p[0]===-1/0?this._showIndicator(f,p[1],"< ",l):p[1]===1/0?this._showIndicator(f,p[0],"> ",l):this._showIndicator(f,f,"≈ ",l));var y=this._hoverLinkDataIndices,b=[];(i||DU(n))&&(b=this._hoverLinkDataIndices=n.findTargetDataIndices(p));var S=Wue(y,b);this._dispatchHighDown("downplay",X2(S[0],n)),this._dispatchHighDown("highlight",X2(S[1],n))}},e.prototype._hoverLinkFromSeriesMouseOver=function(t){var i;if(Wm(t.target,function(l){var c=br(l);if(c.dataIndex!=null)return i=c,!0},!0),!!i){var n=this.ecModel.getSeriesByIndex(i.seriesIndex),a=this.visualMapModel;if(a.isTargetSeries(n)){var s=n.getData(i.dataType),o=s.getStore().get(a.getDataDimensionIndex(s),i.dataIndex);isNaN(o)||this._showIndicator(o,o)}}},e.prototype._hideIndicator=function(){var t=this._shapes;t.indicator&&t.indicator.attr("invisible",!0),t.indicatorLabel&&t.indicatorLabel.attr("invisible",!0);var i=this._shapes.handleLabels;if(i)for(var n=0;n<i.length;n++)this.api.leaveBlur(i[n])},e.prototype._clearHoverLinkToSeries=function(){this._hideIndicator();var t=this._hoverLinkDataIndices;this._dispatchHighDown("downplay",X2(t,this.visualMapModel)),t.length=0},e.prototype._clearHoverLinkFromSeries=function(){this._hideIndicator();var t=this.api.getZr();t.off("mouseover",this._hoverLinkFromSeriesMouseOver),t.off("mouseout",this._hideIndicator)},e.prototype._applyTransform=function(t,i,n,a){var s=Ng(i,a?null:this.group);return xt(t)?Mh(t,s,n):UC(t,s,n)},e.prototype._dispatchHighDown=function(t,i){i&&i.length&&this.api.dispatchAction({type:t,batch:i})},e.prototype.dispose=function(){this._clearHoverLinkFromSeries(),this._clearHoverLinkToSeries()},e.type="visualMap.continuous",e})(dZ);function RU(r,e,t,i){return new Rs({shape:{points:r},draggable:!!t,cursor:e,drift:t,onmousemove:function(n){up(n.event)},ondragend:i})}function JAe(r,e,t){var i=YAe/2,n=r.get("hoverLinkDataSize");return n&&(i=Cf(n,e,t,!0)/2),i}function DU(r){var e=r.get("hoverLinkOnHandle");return!!(e??r.get("realtime"))}function kU(r){return r==="vertical"?"ns-resize":"ew-resize"}var eCe={type:"selectDataRange",event:"dataRangeSelected",update:"update"},tCe=function(r,e){e.eachComponent({mainType:"visualMap",query:r},function(t){t.setSelected(r.selected)})},rCe=[{createOnAllSeries:!0,reset:function(r,e){var t=[];return e.eachComponent("visualMap",function(i){var n=r.pipelineContext;!i.isTargetSeries(r)||n&&n.large||t.push(T2e(i.stateList,i.targetVisuals,Xt(i.getValueState,i),i.getDataDimensionIndex(r.getData())))}),t}},{createOnAllSeries:!0,reset:function(r,e){var t=r.getData(),i=[];e.eachComponent("visualMap",function(n){if(n.isTargetSeries(r)){var a=n.getVisualMeta(Xt(iCe,null,r,n))||{stops:[],outerColors:[]},s=n.getDataDimensionIndex(t);s>=0&&(a.dimension=s,i.push(a))}}),r.getData().setVisual("visualMeta",i)}}];function iCe(r,e,t,i){for(var n=e.targetVisuals[i],a=ho.prepareVisualTypes(n),s={color:Jw(r.getData(),"color")},o=0,l=a.length;o<l;o++){var c=a[o],f=n[c==="opacity"?"__alphaForOpacity":c];f&&f.applyVisual(t,p,y)}return s.color;function p(b){return s[b]}function y(b,S){s[b]=S}}var LU=se;function nCe(r){var e=r&&r.visualMap;xt(e)||(e=e?[e]:[]),LU(e,function(t){if(t){i0(t,"splitList")&&!i0(t,"pieces")&&(t.pieces=t.splitList,delete t.splitList);var i=t.pieces;i&&xt(i)&&LU(i,function(n){cr(n)&&(i0(n,"start")&&!i0(n,"min")&&(n.min=n.start),i0(n,"end")&&!i0(n,"max")&&(n.max=n.end))})}})}function i0(r,e){return r&&r.hasOwnProperty&&r.hasOwnProperty(e)}var OU=!1;function gZ(r){OU||(OU=!0,r.registerSubTypeDefaulter("visualMap",function(e){return!e.categories&&(!(e.pieces?e.pieces.length>0:e.splitNumber>0)||e.calculable)?"continuous":"piecewise"}),r.registerAction(eCe,tCe),se(rCe,function(e){r.registerVisual(r.PRIORITY.VISUAL.COMPONENT,e)}),r.registerPreprocessor(nCe))}function vZ(r){r.registerComponentModel(ZAe),r.registerComponentView(QAe),gZ(r)}var aCe=(function(r){Ye(e,r);function e(){var t=r!==null&&r.apply(this,arguments)||this;return t.type=e.type,t._pieceList=[],t}return e.prototype.optionUpdated=function(t,i){r.prototype.optionUpdated.apply(this,arguments),this.resetExtent();var n=this._mode=this._determineMode();this._pieceList=[],oCe[this._mode].call(this,this._pieceList),this._resetSelected(t,i);var a=this.option.categories;this.resetVisual(function(s,o){n==="categories"?(s.mappingMethod="category",s.categories=hr(a)):(s.dataExtent=this.getExtent(),s.mappingMethod="piecewise",s.pieceList=wt(this._pieceList,function(l){return l=hr(l),o!=="inRange"&&(l.visual=null),l}))})},e.prototype.completeVisualOption=function(){var t=this.option,i={},n=ho.listVisualTypes(),a=this.isCategory();se(t.pieces,function(o){se(n,function(l){o.hasOwnProperty(l)&&(i[l]=1)})}),se(i,function(o,l){var c=!1;se(this.stateList,function(f){c=c||s(t,f,l)||s(t.target,f,l)},this),!c&&se(this.stateList,function(f){(t[f]||(t[f]={}))[l]=fZ.get(l,f==="inRange"?"active":"inactive",a)})},this);function s(o,l,c){return o&&o[l]&&o[l].hasOwnProperty(c)}r.prototype.completeVisualOption.apply(this,arguments)},e.prototype._resetSelected=function(t,i){var n=this.option,a=this._pieceList,s=(i?n:t).selected||{};if(n.selected=s,se(a,function(l,c){var f=this.getSelectedMapKey(l);s.hasOwnProperty(f)||(s[f]=!0)},this),n.selectedMode==="single"){var o=!1;se(a,function(l,c){var f=this.getSelectedMapKey(l);s[f]&&(o?s[f]=!1:o=!0)},this)}},e.prototype.getItemSymbol=function(){return this.get("itemSymbol")},e.prototype.getSelectedMapKey=function(t){return this._mode==="categories"?t.value+"":t.index+""},e.prototype.getPieceList=function(){return this._pieceList},e.prototype._determineMode=function(){var t=this.option;return t.pieces&&t.pieces.length>0?"pieces":this.option.categories?"categories":"splitNumber"},e.prototype.setSelected=function(t){this.option.selected=hr(t)},e.prototype.getValueState=function(t){var i=ho.findPieceIndex(t,this._pieceList);return i!=null&&this.option.selected[this.getSelectedMapKey(this._pieceList[i])]?"inRange":"outOfRange"},e.prototype.findTargetDataIndices=function(t){var i=[],n=this._pieceList;return this.eachTargetSeries(function(a){var s=[],o=a.getData();o.each(this.getDataDimensionIndex(o),function(l,c){var f=ho.findPieceIndex(l,n);f===t&&s.push(c)},this),i.push({seriesId:a.id,dataIndex:s})},this),i},e.prototype.getRepresentValue=function(t){var i;if(this.isCategory())i=t.value;else if(t.value!=null)i=t.value;else{var n=t.interval||[];i=n[0]===-1/0&&n[1]===1/0?0:(n[0]+n[1])/2}return i},e.prototype.getVisualMeta=function(t){if(this.isCategory())return;var i=[],n=["",""],a=this;function s(f,p){var y=a.getRepresentValue({interval:f});p||(p=a.getValueState(y));var b=t(y,p);f[0]===-1/0?n[0]=b:f[1]===1/0?n[1]=b:i.push({value:f[0],color:b},{value:f[1],color:b})}var o=this._pieceList.slice();if(!o.length)o.push({interval:[-1/0,1/0]});else{var l=o[0].interval[0];l!==-1/0&&o.unshift({interval:[-1/0,l]}),l=o[o.length-1].interval[1],l!==1/0&&o.push({interval:[l,1/0]})}var c=-1/0;return se(o,function(f){var p=f.interval;p&&(p[0]>c&&s([c,p[0]],"outOfRange"),s(p.slice()),c=p[1])},this),{stops:i,outerColors:n}},e.type="visualMap.piecewise",e.defaultOption=Yg(sC.defaultOption,{selected:null,minOpen:!1,maxOpen:!1,align:"auto",itemWidth:20,itemHeight:14,itemSymbol:"roundRect",pieces:null,categories:null,splitNumber:5,selectedMode:"multiple",itemGap:10,hoverLink:!0}),e})(sC),oCe={splitNumber:function(r){var e=this.option,t=Math.min(e.precision,20),i=this.getExtent(),n=e.splitNumber;n=Math.max(parseInt(n,10),1),e.splitNumber=n;for(var a=(i[1]-i[0])/n;+a.toFixed(t)!==a&&t<5;)t++;e.precision=t,a=+a.toFixed(t),e.minOpen&&r.push({interval:[-1/0,i[0]],close:[0,0]});for(var s=0,o=i[0];s<n;o+=a,s++){var l=s===n-1?i[1]:o+a;r.push({interval:[o,l],close:[1,1]})}e.maxOpen&&r.push({interval:[i[1],1/0],close:[0,0]}),ZR(r),se(r,function(c,f){c.index=f,c.text=this.formatValueText(c.interval)},this)},categories:function(r){var e=this.option;se(e.categories,function(t){r.push({text:this.formatValueText(t,!0),value:t})},this),NU(e,r)},pieces:function(r){var e=this.option;se(e.pieces,function(t,i){cr(t)||(t={value:t});var n={text:"",index:i};if(t.label!=null&&(n.text=t.label),t.hasOwnProperty("value")){var a=n.value=t.value;n.interval=[a,a],n.close=[1,1]}else{for(var s=n.interval=[],o=n.close=[0,0],l=[1,0,1],c=[-1/0,1/0],f=[],p=0;p<2;p++){for(var y=[["gte","gt","min"],["lte","lt","max"]][p],b=0;b<3&&s[p]==null;b++)s[p]=t[y[b]],o[p]=l[b],f[p]=b===2;s[p]==null&&(s[p]=c[p])}f[0]&&s[1]===1/0&&(o[0]=0),f[1]&&s[0]===-1/0&&(o[1]=0),s[0]===s[1]&&o[0]&&o[1]&&(n.value=s[0])}n.visual=ho.retrieveVisuals(t),r.push(n)},this),NU(e,r),ZR(r),se(r,function(t){var i=t.close,n=[["<","≤"][i[1]],[">","≥"][i[0]]];t.text=t.text||this.formatValueText(t.value!=null?t.value:t.interval,!1,n)},this)}};function NU(r,e){var t=r.inverse;(r.orient==="vertical"?!t:t)&&e.reverse()}var sCe=(function(r){Ye(e,r);function e(){var t=r!==null&&r.apply(this,arguments)||this;return t.type=e.type,t}return e.prototype.doRender=function(){var t=this.group;t.removeAll();var i=this.visualMapModel,n=i.get("textGap"),a=i.textStyleModel,s=a.getFont(),o=a.getTextColor(),l=this._getItemAlign(),c=i.itemSize,f=this._getViewData(),p=f.endsText,y=uo(i.get("showLabel",!0),!p),b=!i.get("selectedMode");p&&this._renderEndsText(t,p[0],c,y,l),se(f.viewPieceList,function(S){var C=S.piece,E=new mr;E.onclick=Xt(this._onItemClick,this,C),this._enableHoverLink(E,S.indexInModelPieceList);var P=i.getRepresentValue(C);if(this._createItemSymbol(E,P,[0,0,c[0],c[1]],b),y){var O=this.visualMapModel.getValueState(P);E.add(new si({style:{x:l==="right"?-n:c[0]+n,y:c[1]/2,text:C.text,verticalAlign:"middle",align:l,font:s,fill:o,opacity:O==="outOfRange"?.5:1},silent:b}))}t.add(E)},this),p&&this._renderEndsText(t,p[1],c,y,l),ny(i.get("orient"),t,i.get("itemGap")),this.renderBackground(t),this.positionGroup(t)},e.prototype._enableHoverLink=function(t,i){var n=this;t.on("mouseover",function(){return a("highlight")}).on("mouseout",function(){return a("downplay")});var a=function(s){var o=n.visualMapModel;o.option.hoverLink&&n.api.dispatchAction({type:s,batch:X2(o.findTargetDataIndices(i),o)})}},e.prototype._getItemAlign=function(){var t=this.visualMapModel,i=t.option;if(i.orient==="vertical")return pZ(t,this.api,t.itemSize);var n=i.align;return(!n||n==="auto")&&(n="left"),n},e.prototype._renderEndsText=function(t,i,n,a,s){if(i){var o=new mr,l=this.visualMapModel.textStyleModel;o.add(new si({style:cn(l,{x:a?s==="right"?n[0]:0:n[0]/2,y:n[1]/2,verticalAlign:"middle",align:a?s:"center",text:i})})),t.add(o)}},e.prototype._getViewData=function(){var t=this.visualMapModel,i=wt(t.getPieceList(),function(o,l){return{piece:o,indexInModelPieceList:l}}),n=t.get("text"),a=t.get("orient"),s=t.get("inverse");return(a==="horizontal"?s:!s)?i.reverse():n&&(n=n.slice().reverse()),{viewPieceList:i,endsText:n}},e.prototype._createItemSymbol=function(t,i,n,a){var s=Aa(this.getControllerVisual(i,"symbol"),n[0],n[1],n[2],n[3],this.getControllerVisual(i,"color"));s.silent=a,t.add(s)},e.prototype._onItemClick=function(t){var i=this.visualMapModel,n=i.option,a=n.selectedMode;if(a){var s=hr(n.selected),o=i.getSelectedMapKey(t);a==="single"||a===!0?(s[o]=!0,se(s,function(l,c){s[c]=c===o})):s[o]=!s[o],this.api.dispatchAction({type:"selectDataRange",from:this.uid,visualMapId:this.visualMapModel.id,selected:s})}},e.type="visualMap.piecewise",e})(dZ);function mZ(r){r.registerComponentModel(aCe),r.registerComponentView(sCe),gZ(r)}function lCe(r){Vr(vZ),Vr(mZ)}var uCe={label:{enabled:!0},decal:{show:!1}},BU=fi(),cCe={};function hCe(r,e){var t=r.getModel("aria");if(!t.get("enabled"))return;var i=hr(uCe);Cr(i.label,r.getLocaleModel().get("aria"),!1),Cr(t.option,i,!1),n(),a();function n(){var c=t.getModel("decal"),f=c.get("show");if(f){var p=Qt();r.eachSeries(function(y){if(!y.isColorBySeries()){var b=p.get(y.type);b||(b={},p.set(y.type,b)),BU(y).scope=b}}),r.eachRawSeries(function(y){if(r.isSeriesFiltered(y))return;if(sr(y.enableAriaDecal)){y.enableAriaDecal();return}var b=y.getData();if(y.isColorBySeries()){var O=c3(y.ecModel,y.name,cCe,r.getSeriesCount()),B=b.getVisual("decal");b.setVisual("decal",F(B,O))}else{var S=y.getRawData(),C={},E=BU(y).scope;b.each(function(W){var $=b.getRawIndex(W);C[$]=W});var P=S.count();S.each(function(W){var $=C[W],q=S.getName(W)||W+"",Q=c3(y.ecModel,q,E,P),ee=b.getItemVisual($,"decal");b.setItemVisual($,"decal",F(ee,Q))})}function F(W,$){var q=W?mt(mt({},$),W):$;return q.dirty=!0,q}})}}function a(){var c=e.getZr().dom;if(c){var f=r.getLocaleModel().get("aria"),p=t.getModel("label");if(p.option=lr(p.option,f),!!p.get("enabled")){if(c.setAttribute("role","img"),p.get("description")){c.setAttribute("aria-label",p.get("description"));return}var y=r.getSeriesCount(),b=p.get(["data","maxCount"])||10,S=p.get(["series","maxCount"])||10,C=Math.min(y,S),E;if(!(y<1)){var P=o();if(P){var O=p.get(["general","withTitle"]);E=s(O,{title:P})}else E=p.get(["general","withoutTitle"]);var B=[],F=y>1?p.get(["series","multiple","prefix"]):p.get(["series","single","prefix"]);E+=s(F,{seriesCount:y}),r.eachSeries(function(Q,ee){if(ee<C){var te=void 0,ae=Q.get("name"),de=ae?"withName":"withoutName";te=y>1?p.get(["series","multiple",de]):p.get(["series","single",de]),te=s(te,{seriesId:Q.seriesIndex,seriesName:Q.get("name"),seriesType:l(Q.subType)});var ve=Q.getData();if(ve.count()>b){var ye=p.get(["data","partialData"]);te+=s(ye,{displayCnt:b})}else te+=p.get(["data","allData"]);for(var Ae=p.get(["data","separator","middle"]),me=p.get(["data","separator","end"]),De=p.get(["data","excludeDimensionId"]),Fe=[],je=0;je<ve.count();je++)if(je<b){var ct=ve.getName(je),xe=De?wi(ve.getValues(je),function(pt,_t){return Or(De,_t)===-1}):ve.getValues(je),$e=p.get(["data",ct?"withName":"withoutName"]);Fe.push(s($e,{name:ct,value:xe.join(Ae)}))}te+=Fe.join(Ae)+me,B.push(te)}});var W=p.getModel(["series","multiple","separator"]),$=W.get("middle"),q=W.get("end");E+=B.join($)+q,c.setAttribute("aria-label",E)}}}}function s(c,f){if(!$t(c))return c;var p=c;return se(f,function(y,b){p=p.replace(new RegExp("\\{\\s*"+b+"\\s*\\}","g"),y)}),p}function o(){var c=r.get("title");return c&&c.length&&(c=c[0]),c&&c.text}function l(c){var f=r.getLocaleModel().get(["series","typeNames"]);return f[c]||f.chart}}function fCe(r){if(!(!r||!r.aria)){var e=r.aria;e.show!=null&&(e.enabled=e.show),e.label=e.label||{},se(["description","general","series","data"],function(t){e[t]!=null&&(e.label[t]=e[t])})}}function dCe(r){r.registerPreprocessor(fCe),r.registerVisual(r.PRIORITY.VISUAL.ARIA,hCe)}var zU={value:"eq","<":"lt","<=":"lte",">":"gt",">=":"gte","=":"eq","!=":"ne","<>":"ne"},pCe=(function(){function r(e){var t=this._condVal=$t(e)?new RegExp(e):Hj(e)?e:null;if(t==null){var i="";Pi(i)}}return r.prototype.evaluate=function(e){var t=typeof e;return $t(t)?this._condVal.test(e):di(t)?this._condVal.test(e+""):!1},r})(),gCe=(function(){function r(){}return r.prototype.evaluate=function(){return this.value},r})(),vCe=(function(){function r(){}return r.prototype.evaluate=function(){for(var e=this.children,t=0;t<e.length;t++)if(!e[t].evaluate())return!1;return!0},r})(),mCe=(function(){function r(){}return r.prototype.evaluate=function(){for(var e=this.children,t=0;t<e.length;t++)if(e[t].evaluate())return!0;return!1},r})(),yCe=(function(){function r(){}return r.prototype.evaluate=function(){return!this.child.evaluate()},r})(),_Ce=(function(){function r(){}return r.prototype.evaluate=function(){for(var e=!!this.valueParser,t=this.getValue,i=t(this.valueGetterParam),n=e?this.valueParser(i):null,a=0;a<this.subCondList.length;a++)if(!this.subCondList[a].evaluate(e?n:i))return!1;return!0},r})();function RO(r,e){if(r===!0||r===!1){var t=new gCe;return t.value=r,t}var i="";return yZ(r)||Pi(i),r.and?FU("and",r,e):r.or?FU("or",r,e):r.not?bCe(r,e):xCe(r,e)}function FU(r,e,t){var i=e[r],n="";xt(i)||Pi(n),i.length||Pi(n);var a=r==="and"?new vCe:new mCe;return a.children=wt(i,function(s){return RO(s,t)}),a.children.length||Pi(n),a}function bCe(r,e){var t=r.not,i="";yZ(t)||Pi(i);var n=new yCe;return n.child=RO(t,e),n.child||Pi(i),n}function xCe(r,e){for(var t="",i=e.prepareGetValue(r),n=[],a=qr(r),s=r.parser,o=s?Y7(s):null,l=0;l<a.length;l++){var c=a[l];if(!(c==="parser"||e.valueGetterAttrMap.get(c))){var f=Yt(zU,c)?zU[c]:c,p=r[c],y=o?o(p):p,b=Gfe(f,y)||f==="reg"&&new pCe(y);b||Pi(t),n.push(b)}}n.length||Pi(t);var S=new _Ce;return S.valueGetterParam=i,S.valueParser=o,S.getValue=e.getValue,S.subCondList=n,S}function yZ(r){return cr(r)&&!es(r)}var wCe=(function(){function r(e,t){this._cond=RO(e,t)}return r.prototype.evaluate=function(){return this._cond.evaluate()},r})();function SCe(r,e){return new wCe(r,e)}var TCe={type:"echarts:filter",transform:function(r){for(var e=r.upstream,t,i=SCe(r.config,{valueGetterAttrMap:Qt({dimension:!0}),prepareGetValue:function(o){var l="",c=o.dimension;Yt(o,"dimension")||Pi(l);var f=e.getDimensionInfo(c);return f||Pi(l),{dimIdx:f.index}},getValue:function(o){return e.retrieveValueFromItem(t,o.dimIdx)}}),n=[],a=0,s=e.count();a<s;a++)t=e.getRawDataItem(a),i.evaluate()&&n.push(t);return{data:n}}},ACe={type:"echarts:sort",transform:function(r){var e=r.upstream,t=r.config,i="",n=Gi(t);n.length||Pi(i);var a=[];se(n,function(f){var p=f.dimension,y=f.order,b=f.parser,S=f.incomparable;if(p==null&&Pi(i),y!=="asc"&&y!=="desc"&&Pi(i),S&&S!=="min"&&S!=="max"){var C="";Pi(C)}if(y!=="asc"&&y!=="desc"){var E="";Pi(E)}var P=e.getDimensionInfo(p);P||Pi(i);var O=b?Y7(b):null;b&&!O&&Pi(i),a.push({dimIdx:P.index,parser:O,comparator:new Q7(y,S)})});var s=e.sourceFormat;s!==Ds&&s!==Ic&&Pi(i);for(var o=[],l=0,c=e.count();l<c;l++)o.push(e.getRawDataItem(l));return o.sort(function(f,p){for(var y=0;y<a.length;y++){var b=a[y],S=e.retrieveValueFromItem(f,b.dimIdx),C=e.retrieveValueFromItem(p,b.dimIdx);b.parser&&(S=b.parser(S),C=b.parser(C));var E=b.comparator.evaluate(S,C);if(E!==0)return E}return 0}),{data:o}}};function CCe(r){r.registerTransform(TCe),r.registerTransform(ACe)}var MCe=(function(r){Ye(e,r);function e(){var t=r!==null&&r.apply(this,arguments)||this;return t.type="dataset",t}return e.prototype.init=function(t,i,n){r.prototype.init.call(this,t,i,n),this._sourceManager=new r9(this),Hz(this)},e.prototype.mergeOption=function(t,i){r.prototype.mergeOption.call(this,t,i),Hz(this)},e.prototype.optionUpdated=function(){this._sourceManager.dirty()},e.prototype.getSourceManager=function(){return this._sourceManager},e.type="dataset",e.defaultOption={seriesLayoutBy:Ff},e})(Wr),ECe=(function(r){Ye(e,r);function e(){var t=r!==null&&r.apply(this,arguments)||this;return t.type="dataset",t}return e.type="dataset",e})(vn);function ICe(r){r.registerComponentModel(MCe),r.registerComponentView(ECe)}var Tf=jf.CMD;function w0(r,e){return Math.abs(r-e)<1e-5}function fD(r){var e=r.data,t=r.len(),i=[],n,a=0,s=0,o=0,l=0;function c(ve,ye){n&&n.length>2&&i.push(n),n=[ve,ye]}function f(ve,ye,Ae,me){w0(ve,Ae)&&w0(ye,me)||n.push(ve,ye,Ae,me,Ae,me)}function p(ve,ye,Ae,me,De,Fe){var je=Math.abs(ye-ve),ct=Math.tan(je/4)*4/3,xe=ye<ve?-1:1,$e=Math.cos(ve),pt=Math.sin(ve),_t=Math.cos(ye),Dt=Math.sin(ye),qt=$e*De+Ae,_r=pt*Fe+me,Kt=_t*De+Ae,zt=Dt*Fe+me,yr=De*ct*xe,Gt=Fe*ct*xe;n.push(qt-yr*pt,_r+Gt*$e,Kt+yr*Dt,zt-Gt*_t,Kt,zt)}for(var y,b,S,C,E=0;E<t;){var P=e[E++],O=E===1;switch(O&&(a=e[E],s=e[E+1],o=a,l=s,(P===Tf.L||P===Tf.C||P===Tf.Q)&&(n=[o,l])),P){case Tf.M:a=o=e[E++],s=l=e[E++],c(o,l);break;case Tf.L:y=e[E++],b=e[E++],f(a,s,y,b),a=y,s=b;break;case Tf.C:n.push(e[E++],e[E++],e[E++],e[E++],a=e[E++],s=e[E++]);break;case Tf.Q:y=e[E++],b=e[E++],S=e[E++],C=e[E++],n.push(a+2/3*(y-a),s+2/3*(b-s),S+2/3*(y-S),C+2/3*(b-C),S,C),a=S,s=C;break;case Tf.A:var B=e[E++],F=e[E++],W=e[E++],$=e[E++],q=e[E++],Q=e[E++]+q;E+=1;var ee=!e[E++];y=Math.cos(q)*W+B,b=Math.sin(q)*$+F,O?(o=y,l=b,c(o,l)):f(a,s,y,b),a=Math.cos(Q)*W+B,s=Math.sin(Q)*$+F;for(var te=(ee?-1:1)*Math.PI/2,ae=q;ee?ae>Q:ae<Q;ae+=te){var de=ee?Math.max(ae+te,Q):Math.min(ae+te,Q);p(ae,de,B,F,W,$)}break;case Tf.R:o=a=e[E++],l=s=e[E++],y=o+e[E++],b=l+e[E++],c(y,l),f(y,l,y,b),f(y,b,o,b),f(o,b,o,l),f(o,l,y,l);break;case Tf.Z:n&&f(a,s,o,l),a=o,s=l;break}}return n&&n.length>2&&i.push(n),i}function dD(r,e,t,i,n,a,s,o,l,c){if(w0(r,t)&&w0(e,i)&&w0(n,s)&&w0(a,o)){l.push(s,o);return}var f=2/c,p=f*f,y=s-r,b=o-e,S=Math.sqrt(y*y+b*b);y/=S,b/=S;var C=t-r,E=i-e,P=n-s,O=a-o,B=C*C+E*E,F=P*P+O*O;if(B<p&&F<p){l.push(s,o);return}var W=y*C+b*E,$=-y*P-b*O,q=B-W*W,Q=F-$*$;if(q<p&&W>=0&&Q<p&&$>=0){l.push(s,o);return}var ee=[],te=[];Hg(r,t,n,s,.5,ee),Hg(e,i,a,o,.5,te),dD(ee[0],te[0],ee[1],te[1],ee[2],te[2],ee[3],te[3],l,c),dD(ee[4],te[4],ee[5],te[5],ee[6],te[6],ee[7],te[7],l,c)}function PCe(r,e){var t=fD(r),i=[];e=e||1;for(var n=0;n<t.length;n++){var a=t[n],s=[],o=a[0],l=a[1];s.push(o,l);for(var c=2;c<a.length;){var f=a[c++],p=a[c++],y=a[c++],b=a[c++],S=a[c++],C=a[c++];dD(o,l,f,p,y,b,S,C,s,e),o=S,l=C}i.push(s)}return i}function _Z(r,e,t){var i=r[e],n=r[1-e],a=Math.abs(i/n),s=Math.ceil(Math.sqrt(a*t)),o=Math.floor(t/s);o===0&&(o=1,s=t);for(var l=[],c=0;c<s;c++)l.push(o);var f=s*o,p=t-f;if(p>0)for(var c=0;c<p;c++)l[c%s]+=1;return l}function VU(r,e,t){for(var i=r.r0,n=r.r,a=r.startAngle,s=r.endAngle,o=Math.abs(s-a),l=o*n,c=n-i,f=l>Math.abs(c),p=_Z([l,c],f?0:1,e),y=(f?o:c)/p.length,b=0;b<p.length;b++)for(var S=(f?c:o)/p[b],C=0;C<p[b];C++){var E={};f?(E.startAngle=a+y*b,E.endAngle=a+y*(b+1),E.r0=i+S*C,E.r=i+S*(C+1)):(E.startAngle=a+S*C,E.endAngle=a+S*(C+1),E.r0=i+y*b,E.r=i+y*(b+1)),E.clockwise=r.clockwise,E.cx=r.cx,E.cy=r.cy,t.push(E)}}function RCe(r,e,t){for(var i=r.width,n=r.height,a=i>n,s=_Z([i,n],a?0:1,e),o=a?"width":"height",l=a?"height":"width",c=a?"x":"y",f=a?"y":"x",p=r[o]/s.length,y=0;y<s.length;y++)for(var b=r[l]/s[y],S=0;S<s[y];S++){var C={};C[c]=y*p,C[f]=S*b,C[o]=p,C[l]=b,C.x+=r.x,C.y+=r.y,t.push(C)}}function UU(r,e,t,i){return r*i-t*e}function DCe(r,e,t,i,n,a,s,o){var l=t-r,c=i-e,f=s-n,p=o-a,y=UU(f,p,l,c);if(Math.abs(y)<1e-6)return null;var b=r-n,S=e-a,C=UU(b,S,f,p)/y;return C<0||C>1?null:new Rr(C*l+r,C*c+e)}function kCe(r,e,t){var i=new Rr;Rr.sub(i,t,e),i.normalize();var n=new Rr;Rr.sub(n,r,e);var a=n.dot(i);return a}function n0(r,e){var t=r[r.length-1];t&&t[0]===e[0]&&t[1]===e[1]||r.push(e)}function LCe(r,e,t){for(var i=r.length,n=[],a=0;a<i;a++){var s=r[a],o=r[(a+1)%i],l=DCe(s[0],s[1],o[0],o[1],e.x,e.y,t.x,t.y);l&&n.push({projPt:kCe(l,e,t),pt:l,idx:a})}if(n.length<2)return[{points:r},{points:r}];n.sort(function(E,P){return E.projPt-P.projPt});var c=n[0],f=n[n.length-1];if(f.idx<c.idx){var p=c;c=f,f=p}for(var y=[c.pt.x,c.pt.y],b=[f.pt.x,f.pt.y],S=[y],C=[b],a=c.idx+1;a<=f.idx;a++)n0(S,r[a].slice());n0(S,b),n0(S,y);for(var a=f.idx+1;a<=c.idx+i;a++)n0(C,r[a%i].slice());return n0(C,y),n0(C,b),[{points:S},{points:C}]}function HU(r){var e=r.points,t=[],i=[];NC(e,t,i);var n=new Dr(t[0],t[1],i[0]-t[0],i[1]-t[1]),a=n.width,s=n.height,o=n.x,l=n.y,c=new Rr,f=new Rr;return a>s?(c.x=f.x=o+a/2,c.y=l,f.y=l+s):(c.y=f.y=l+s/2,c.x=o,f.x=o+a),LCe(e,c,f)}function lC(r,e,t,i){if(t===1)i.push(e);else{var n=Math.floor(t/2),a=r(e);lC(r,a[0],n,i),lC(r,a[1],t-n,i)}return i}function OCe(r,e){for(var t=[],i=0;i<e;i++)t.push(zk(r));return t}function NCe(r,e){e.setStyle(r.style),e.z=r.z,e.z2=r.z2,e.zlevel=r.zlevel}function BCe(r){for(var e=[],t=0;t<r.length;)e.push([r[t++],r[t++]]);return e}function zCe(r,e){var t=[],i=r.shape,n;switch(r.type){case"rect":RCe(i,e,t),n=li;break;case"sector":VU(i,e,t),n=Ps;break;case"circle":VU({r0:0,r:i.r,startAngle:0,endAngle:Math.PI*2,cx:i.cx,cy:i.cy},e,t),n=Ps;break;default:var a=r.getComputedTransform(),s=a?Math.sqrt(Math.max(a[0]*a[0]+a[1]*a[1],a[2]*a[2]+a[3]*a[3])):1,o=wt(PCe(r.getUpdatedPathProxy(),s),function(P){return BCe(P)}),l=o.length;if(l===0)lC(HU,{points:o[0]},e,t);else if(l===e)for(var c=0;c<l;c++)t.push({points:o[c]});else{var f=0,p=wt(o,function(P){var O=[],B=[];NC(P,O,B);var F=(B[1]-O[1])*(B[0]-O[0]);return f+=F,{poly:P,area:F}});p.sort(function(P,O){return O.area-P.area});for(var y=e,c=0;c<l;c++){var b=p[c];if(y<=0)break;var S=c===l-1?y:Math.ceil(b.area/f*e);S<0||(lC(HU,{points:b.poly},S,t),y-=S)}}n=Rs;break}if(!n)return OCe(r,e);for(var C=[],c=0;c<t.length;c++){var E=new n;E.setShape(t[c]),NCe(r,E),C.push(E)}return C}function FCe(r,e){var t=r.length,i=e.length;if(t===i)return[r,e];for(var n=[],a=[],s=t<i?r:e,o=Math.min(t,i),l=Math.abs(i-t)/6,c=(o-2)/6,f=Math.ceil(l/c)+1,p=[s[0],s[1]],y=l,b=2;b<o;){var S=s[b-2],C=s[b-1],E=s[b++],P=s[b++],O=s[b++],B=s[b++],F=s[b++],W=s[b++];if(y<=0){p.push(E,P,O,B,F,W);continue}for(var $=Math.min(y,f-1)+1,q=1;q<=$;q++){var Q=q/$;Hg(S,E,O,F,Q,n),Hg(C,P,B,W,Q,a),S=n[3],C=a[3],p.push(n[1],a[1],n[2],a[2],S,C),E=n[5],P=a[5],O=n[6],B=a[6]}y-=$-1}return s===r?[p,e]:[r,p]}function jU(r,e){for(var t=r.length,i=r[t-2],n=r[t-1],a=[],s=0;s<e.length;)a[s++]=i,a[s++]=n;return a}function VCe(r,e){for(var t,i,n,a=[],s=[],o=0;o<Math.max(r.length,e.length);o++){var l=r[o],c=e[o],f=void 0,p=void 0;l?c?(t=FCe(l,c),f=t[0],p=t[1],i=f,n=p):(p=jU(n||l,l),f=l):(f=jU(i||c,c),p=c),a.push(f),s.push(p)}return[a,s]}function $U(r){for(var e=0,t=0,i=0,n=r.length,a=0,s=n-2;a<n;s=a,a+=2){var o=r[s],l=r[s+1],c=r[a],f=r[a+1],p=o*f-c*l;e+=p,t+=(o+c)*p,i+=(l+f)*p}return e===0?[r[0]||0,r[1]||0]:[t/e/3,i/e/3,e]}function UCe(r,e,t,i){for(var n=(r.length-2)/6,a=1/0,s=0,o=r.length,l=o-2,c=0;c<n;c++){for(var f=c*6,p=0,y=0;y<o;y+=2){var b=y===0?f:(f+y-2)%l+2,S=r[b]-t[0],C=r[b+1]-t[1],E=e[y]-i[0],P=e[y+1]-i[1],O=E-S,B=P-C;p+=O*O+B*B}p<a&&(a=p,s=c)}return s}function HCe(r){for(var e=[],t=r.length,i=0;i<t;i+=2)e[i]=r[t-i-2],e[i+1]=r[t-i-1];return e}function jCe(r,e,t,i){for(var n=[],a,s=0;s<r.length;s++){var o=r[s],l=e[s],c=$U(o),f=$U(l);a==null&&(a=c[2]<0!=f[2]<0);var p=[],y=[],b=0,S=1/0,C=[],E=o.length;a&&(o=HCe(o));for(var P=UCe(o,l,c,f)*6,O=E-2,B=0;B<O;B+=2){var F=(P+B)%O+2;p[B+2]=o[F]-c[0],p[B+3]=o[F+1]-c[1]}p[0]=o[P]-c[0],p[1]=o[P+1]-c[1];for(var W=i/t,$=-i/2;$<=i/2;$+=W){for(var q=Math.sin($),Q=Math.cos($),ee=0,B=0;B<o.length;B+=2){var te=p[B],ae=p[B+1],de=l[B]-f[0],ve=l[B+1]-f[1],ye=de*Q-ve*q,Ae=de*q+ve*Q;C[B]=ye,C[B+1]=Ae;var me=ye-te,De=Ae-ae;ee+=me*me+De*De}if(ee<S){S=ee,b=$;for(var Fe=0;Fe<C.length;Fe++)y[Fe]=C[Fe]}}n.push({from:p,to:y,fromCp:c,toCp:f,rotation:-b})}return n}function uC(r){return r.__isCombineMorphing}var bZ="__mOriginal_";function cC(r,e,t){var i=bZ+e,n=r[i]||r[e];r[i]||(r[i]=r[e]);var a=t.replace,s=t.after,o=t.before;r[e]=function(){var l=arguments,c;return o&&o.apply(this,l),a?c=a.apply(this,l):c=n.apply(this,l),s&&s.apply(this,l),c}}function K1(r,e){var t=bZ+e;r[t]&&(r[e]=r[t],r[t]=null)}function WU(r,e){for(var t=0;t<r.length;t++)for(var i=r[t],n=0;n<i.length;){var a=i[n],s=i[n+1];i[n++]=e[0]*a+e[2]*s+e[4],i[n++]=e[1]*a+e[3]*s+e[5]}}function xZ(r,e){var t=r.getUpdatedPathProxy(),i=e.getUpdatedPathProxy(),n=VCe(fD(t),fD(i)),a=n[0],s=n[1],o=r.getComputedTransform(),l=e.getComputedTransform();function c(){this.transform=null}o&&WU(a,o),l&&WU(s,l),cC(e,"updateTransform",{replace:c}),e.transform=null;var f=jCe(a,s,10,Math.PI),p=[];cC(e,"buildPath",{replace:function(y){for(var b=e.__morphT,S=1-b,C=[],E=0;E<f.length;E++){var P=f[E],O=P.from,B=P.to,F=P.rotation*b,W=P.fromCp,$=P.toCp,q=Math.sin(F),Q=Math.cos(F);B1(C,W,$,b);for(var ee=0;ee<O.length;ee+=2){var te=O[ee],ae=O[ee+1],de=B[ee],ve=B[ee+1],ye=te*S+de*b,Ae=ae*S+ve*b;p[ee]=ye*Q-Ae*q+C[0],p[ee+1]=ye*q+Ae*Q+C[1]}var me=p[0],De=p[1];y.moveTo(me,De);for(var ee=2;ee<O.length;){var de=p[ee++],ve=p[ee++],Fe=p[ee++],je=p[ee++],ct=p[ee++],xe=p[ee++];me===de&&De===ve&&Fe===ct&&je===xe?y.lineTo(ct,xe):y.bezierCurveTo(de,ve,Fe,je,ct,xe),me=ct,De=xe}}}})}function DO(r,e,t){if(!r||!e)return e;var i=t.done,n=t.during;xZ(r,e),e.__morphT=0;function a(){K1(e,"buildPath"),K1(e,"updateTransform"),e.__morphT=-1,e.createPathProxy(),e.dirtyShape()}return e.animateTo({__morphT:1},lr({during:function(s){e.dirtyShape(),n&&n(s)},done:function(){a(),i&&i()}},t)),e}function $Ce(r,e,t,i,n,a){var s=16;r=n===t?0:Math.round(32767*(r-t)/(n-t)),e=a===i?0:Math.round(32767*(e-i)/(a-i));for(var o=0,l,c=(1<<s)/2;c>0;c/=2){var f=0,p=0;(r&c)>0&&(f=1),(e&c)>0&&(p=1),o+=c*c*(3*f^p),p===0&&(f===1&&(r=c-1-r,e=c-1-e),l=r,r=e,e=l)}return o}function hC(r){var e=1/0,t=1/0,i=-1/0,n=-1/0,a=wt(r,function(o){var l=o.getBoundingRect(),c=o.getComputedTransform(),f=l.x+l.width/2+(c?c[4]:0),p=l.y+l.height/2+(c?c[5]:0);return e=Math.min(f,e),t=Math.min(p,t),i=Math.max(f,i),n=Math.max(p,n),[f,p]}),s=wt(a,function(o,l){return{cp:o,z:$Ce(o[0],o[1],e,t,i,n),path:r[l]}});return s.sort(function(o,l){return o.z-l.z}).map(function(o){return o.path})}function wZ(r){return zCe(r.path,r.count)}function pD(){return{fromIndividuals:[],toIndividuals:[],count:0}}function WCe(r,e,t){var i=[];function n(W){for(var $=0;$<W.length;$++){var q=W[$];uC(q)?n(q.childrenRef()):q instanceof Xr&&i.push(q)}}n(r);var a=i.length;if(!a)return pD();var s=t.dividePath||wZ,o=s({path:e,count:a});if(o.length!==a)return console.error("Invalid morphing: unmatched splitted path"),pD();i=hC(i),o=hC(o);for(var l=t.done,c=t.during,f=t.individualDelay,p=new np,y=0;y<a;y++){var b=i[y],S=o[y];S.parent=e,S.copyTransform(p),f||xZ(b,S)}e.__isCombineMorphing=!0,e.childrenRef=function(){return o};function C(W){for(var $=0;$<o.length;$++)o[$].addSelfToZr(W)}cC(e,"addSelfToZr",{after:function(W){C(W)}}),cC(e,"removeSelfFromZr",{after:function(W){for(var $=0;$<o.length;$++)o[$].removeSelfFromZr(W)}});function E(){e.__isCombineMorphing=!1,e.__morphT=-1,e.childrenRef=null,K1(e,"addSelfToZr"),K1(e,"removeSelfFromZr")}var P=o.length;if(f)for(var O=P,B=function(){O--,O===0&&(E(),l&&l())},y=0;y<P;y++){var F=f?lr({delay:(t.delay||0)+f(y,P,i[y],o[y]),done:B},t):t;DO(i[y],o[y],F)}else e.__morphT=0,e.animateTo({__morphT:1},lr({during:function(W){for(var $=0;$<P;$++){var q=o[$];q.__morphT=e.__morphT,q.dirtyShape()}c&&c(W)},done:function(){E();for(var W=0;W<r.length;W++)K1(r[W],"updateTransform");l&&l()}},t));return e.__zr&&C(e.__zr),{fromIndividuals:i,toIndividuals:o,count:P}}function GCe(r,e,t){var i=e.length,n=[],a=t.dividePath||wZ;function s(b){for(var S=0;S<b.length;S++){var C=b[S];uC(C)?s(C.childrenRef()):C instanceof Xr&&n.push(C)}}if(uC(r)){s(r.childrenRef());var o=n.length;if(o<i)for(var l=0,c=o;c<i;c++)n.push(zk(n[l++%o]));n.length=i}else{n=a({path:r,count:i});for(var f=r.getComputedTransform(),c=0;c<n.length;c++)n[c].setLocalTransform(f);if(n.length!==i)return console.error("Invalid morphing: unmatched splitted path"),pD()}n=hC(n),e=hC(e);for(var p=t.individualDelay,c=0;c<i;c++){var y=p?lr({delay:(t.delay||0)+p(c,i,n[c],e[c])},t):t;DO(n[c],e[c],y)}return{fromIndividuals:n,toIndividuals:e,count:e.length}}function GU(r){return xt(r[0])}function XU(r,e){for(var t=[],i=r.length,n=0;n<i;n++)t.push({one:r[n],many:[]});for(var n=0;n<e.length;n++){var a=e[n].length,s=void 0;for(s=0;s<a;s++)t[s%i].many.push(e[n][s])}for(var o=0,n=i-1;n>=0;n--)if(!t[n].many.length){var l=t[o].many;if(l.length<=1)if(o)o=0;else return t;var a=l.length,c=Math.ceil(a/2);t[n].many=l.slice(c,a),t[o].many=l.slice(0,c),o++}return t}var XCe={clone:function(r){for(var e=[],t=1-Math.pow(1-r.path.style.opacity,1/r.count),i=0;i<r.count;i++){var n=zk(r.path);n.setStyle("opacity",t),e.push(n)}return e},split:null};function zP(r,e,t,i,n,a){if(!r.length||!e.length)return;var s=cb("update",i,n);if(!(s&&s.duration>0))return;var o=i.getModel("universalTransition").get("delay"),l=Object.assign({setToFinal:!0},s),c,f;GU(r)&&(c=r,f=e),GU(e)&&(c=e,f=r);function p(P,O,B,F,W){var $=P.many,q=P.one;if($.length===1&&!W){var Q=O?$[0]:q,ee=O?q:$[0];if(uC(Q))p({many:[Q],one:ee},!0,B,F,!0);else{var te=o?lr({delay:o(B,F)},l):l;DO(Q,ee,te),a(Q,ee,Q,ee,te)}}else for(var ae=lr({dividePath:XCe[t],individualDelay:o&&function(De,Fe,je,ct){return o(De+B,F)}},l),de=O?WCe($,q,ae):GCe(q,$,ae),ve=de.fromIndividuals,ye=de.toIndividuals,Ae=ve.length,me=0;me<Ae;me++){var te=o?lr({delay:o(me,Ae)},l):l;a(ve[me],ye[me],O?$[me]:P.one,O?P.one:$[me],te)}}for(var y=c?c===r:r.length>e.length,b=c?XU(f,c):XU(y?e:r,[y?r:e]),S=0,C=0;C<b.length;C++)S+=b[C].many.length;for(var E=0,C=0;C<b.length;C++)p(b[C],y,E,S),E+=b[C].many.length}function Dm(r){if(!r)return[];if(xt(r)){for(var e=[],t=0;t<r.length;t++)e.push(Dm(r[t]));return e}var i=[];return r.traverse(function(n){n instanceof Xr&&!n.disableMorphing&&!n.invisible&&!n.ignore&&i.push(n)}),i}var SZ=1e4,ZCe=0,ZU=1,qU=2,qCe=fi();function YCe(r,e){for(var t=r.dimensions,i=0;i<t.length;i++){var n=r.getDimensionInfo(t[i]);if(n&&n.otherDims[e]===0)return t[i]}}function KCe(r,e,t){var i=r.getDimensionInfo(t),n=i&&i.ordinalMeta;if(i){var a=r.get(i.name,e);return n&&n.categories[a]||a+""}}function YU(r,e,t,i){var n=i?"itemChildGroupId":"itemGroupId",a=YCe(r,n);if(a){var s=KCe(r,e,a);return s}var o=r.getRawDataItem(e),l=i?"childGroupId":"groupId";if(o&&o[l])return o[l]+"";if(!i)return t||r.getId(e)}function KU(r){var e=[];return se(r,function(t){var i=t.data,n=t.dataGroupId;if(!(i.count()>SZ))for(var a=i.getIndices(),s=0;s<a.length;s++)e.push({data:i,groupId:YU(i,s,n,!1),childGroupId:YU(i,s,n,!0),divide:t.divide,dataIndex:s})}),e}function FP(r,e,t){r.traverse(function(i){i instanceof Xr&&An(i,{style:{opacity:0}},e,{dataIndex:t,isFrom:!0})})}function VP(r){if(r.parent){var e=r.getComputedTransform();r.setLocalTransform(e),r.parent.remove(r)}}function a0(r){r.stopAnimation(),r.isGroup&&r.traverse(function(e){e.stopAnimation()})}function QCe(r,e,t){var i=cb("update",t,e);i&&r.traverse(function(n){if(n instanceof Tc){var a=Phe(n);a&&n.animateFrom({style:a},i)}})}function JCe(r,e){var t=r.length;if(t!==e.length)return!1;for(var i=0;i<t;i++){var n=r[i],a=e[i];if(n.data.getId(n.dataIndex)!==a.data.getId(a.dataIndex))return!1}return!0}function TZ(r,e,t){var i=KU(r),n=KU(e);function a(B,F,W,$,q){(W||B)&&F.animateFrom({style:W&&W!==B?mt(mt({},W.style),B.style):B.style},q)}var s=!1,o=ZCe,l=Qt(),c=Qt();i.forEach(function(B){B.groupId&&l.set(B.groupId,!0),B.childGroupId&&c.set(B.childGroupId,!0)});for(var f=0;f<n.length;f++){var p=n[f].groupId;if(c.get(p)){o=ZU;break}var y=n[f].childGroupId;if(y&&l.get(y)){o=qU;break}}function b(B,F){return function(W){var $=W.data,q=W.dataIndex;return F?$.getId(q):B?o===ZU?W.childGroupId:W.groupId:o===qU?W.childGroupId:W.groupId}}var S=JCe(i,n),C={};if(!S)for(var f=0;f<n.length;f++){var E=n[f],P=E.data.getItemGraphicEl(E.dataIndex);P&&(C[P.id]=!0)}function O(B,F){var W=i[F],$=n[B],q=$.data.hostModel,Q=W.data.getItemGraphicEl(W.dataIndex),ee=$.data.getItemGraphicEl($.dataIndex);if(Q===ee){ee&&QCe(ee,$.dataIndex,q);return}Q&&C[Q.id]||ee&&(a0(ee),Q?(a0(Q),VP(Q),s=!0,zP(Dm(Q),Dm(ee),$.divide,q,B,a)):FP(ee,q,B))}new fp(i,n,b(!0,S),b(!1,S),null,"multiple").update(O).updateManyToOne(function(B,F){var W=n[B],$=W.data,q=$.hostModel,Q=$.getItemGraphicEl(W.dataIndex),ee=wi(wt(F,function(te){return i[te].data.getItemGraphicEl(i[te].dataIndex)}),function(te){return te&&te!==Q&&!C[te.id]});Q&&(a0(Q),ee.length?(se(ee,function(te){a0(te),VP(te)}),s=!0,zP(Dm(ee),Dm(Q),W.divide,q,B,a)):FP(Q,q,W.dataIndex))}).updateOneToMany(function(B,F){var W=i[F],$=W.data.getItemGraphicEl(W.dataIndex);if(!($&&C[$.id])){var q=wi(wt(B,function(ee){return n[ee].data.getItemGraphicEl(n[ee].dataIndex)}),function(ee){return ee&&ee!==$}),Q=n[B[0]].data.hostModel;q.length&&(se(q,function(ee){return a0(ee)}),$?(a0($),VP($),s=!0,zP(Dm($),Dm(q),W.divide,Q,B[0],a)):se(q,function(ee){return FP(ee,Q,B[0])}))}}).updateManyToMany(function(B,F){new fp(F,B,function(W){return i[W].data.getId(i[W].dataIndex)},function(W){return n[W].data.getId(n[W].dataIndex)}).update(function(W,$){O(B[W],F[$])}).execute()}).execute(),s&&se(e,function(B){var F=B.data,W=F.hostModel,$=W&&t.getViewOfSeriesModel(W),q=cb("update",W,0);$&&W.isAnimationEnabled()&&q&&q.duration>0&&$.group.traverse(function(Q){Q instanceof Xr&&!Q.animators.length&&Q.animateFrom({style:{opacity:0}},q)})})}function QU(r){var e=r.getModel("universalTransition").get("seriesKey");return e||r.id}function JU(r){return xt(r)?r.sort().join(","):r}function bg(r){if(r.hostModel)return r.hostModel.getModel("universalTransition").get("divideShape")}function eMe(r,e){var t=Qt(),i=Qt(),n=Qt();return se(r.oldSeries,function(a,s){var o=r.oldDataGroupIds[s],l=r.oldData[s],c=QU(a),f=JU(c);i.set(f,{dataGroupId:o,data:l}),xt(c)&&se(c,function(p){n.set(p,{key:f,dataGroupId:o,data:l})})}),se(e.updatedSeries,function(a){if(a.isUniversalTransitionEnabled()&&a.isAnimationEnabled()){var s=a.get("dataGroupId"),o=a.getData(),l=QU(a),c=JU(l),f=i.get(c);if(f)t.set(c,{oldSeries:[{dataGroupId:f.dataGroupId,divide:bg(f.data),data:f.data}],newSeries:[{dataGroupId:s,divide:bg(o),data:o}]});else if(xt(l)){var p=[];se(l,function(S){var C=i.get(S);C.data&&p.push({dataGroupId:C.dataGroupId,divide:bg(C.data),data:C.data})}),p.length&&t.set(c,{oldSeries:p,newSeries:[{dataGroupId:s,data:o,divide:bg(o)}]})}else{var y=n.get(l);if(y){var b=t.get(y.key);b||(b={oldSeries:[{dataGroupId:y.dataGroupId,data:y.data,divide:bg(y.data)}],newSeries:[]},t.set(y.key,b)),b.newSeries.push({dataGroupId:s,data:o,divide:bg(o)})}}}}),t}function e8(r,e){for(var t=0;t<r.length;t++){var i=e.seriesIndex!=null&&e.seriesIndex===r[t].seriesIndex||e.seriesId!=null&&e.seriesId===r[t].id;if(i)return t}}function tMe(r,e,t,i){var n=[],a=[];se(Gi(r.from),function(s){var o=e8(e.oldSeries,s);o>=0&&n.push({dataGroupId:e.oldDataGroupIds[o],data:e.oldData[o],divide:bg(e.oldData[o]),groupIdDim:s.dimension})}),se(Gi(r.to),function(s){var o=e8(t.updatedSeries,s);if(o>=0){var l=t.updatedSeries[o].getData();a.push({dataGroupId:e.oldDataGroupIds[o],data:l,divide:bg(l),groupIdDim:s.dimension})}}),n.length>0&&a.length>0&&TZ(n,a,i)}function rMe(r){r.registerUpdateLifecycle("series:beforeupdate",function(e,t,i){se(Gi(i.seriesTransition),function(n){se(Gi(n.to),function(a){for(var s=i.updatedSeries,o=0;o<s.length;o++)(a.seriesIndex!=null&&a.seriesIndex===s[o].seriesIndex||a.seriesId!=null&&a.seriesId===s[o].id)&&(s[o][V2]=!0)})})}),r.registerUpdateLifecycle("series:transition",function(e,t,i){var n=qCe(t);if(n.oldSeries&&i.updatedSeries&&i.optionChanged){var a=i.seriesTransition;if(a)se(Gi(a),function(b){tMe(b,n,i,t)});else{var s=eMe(n,i);se(s.keys(),function(b){var S=s.get(b);TZ(S.oldSeries,S.newSeries,t)})}se(i.updatedSeries,function(b){b[V2]&&(b[V2]=!1)})}for(var o=e.getSeries(),l=n.oldSeries=[],c=n.oldDataGroupIds=[],f=n.oldData=[],p=0;p<o.length;p++){var y=o[p].getData();y.count()<SZ&&(l.push(o[p]),c.push(o[p].get("dataGroupId")),f.push(y))}})}Vr([fme]);Vr([sme]);Vr([Dme,Xme,iye,Nye,Xye,k_e,s0e,$0e,fbe,ybe,Mbe,xxe,Gxe,i1e,_1e,S1e,k1e,V1e,K1e,iwe,dwe,Ywe]);Vr(gSe);Vr(USe);Vr(wG);Vr(eTe);Vr(sX);Vr(nTe);Vr(dTe);Vr(e2e);Vr(_2e);Vr(uS);Vr(N2e);Vr(F2e);Vr(q2e);Vr(rAe);Vr(lAe);Vr(pAe);Vr(TAe);Vr(HAe);Vr(cZ);Vr(hZ);Vr(lCe);Vr(vZ);Vr(mZ);Vr(dCe);Vr(CCe);Vr(ICe);Vr(rMe);Vr(Mve);const iMe=Object.freeze(Object.defineProperty({__proto__:null,Axis:Pc,ChartView:Fi,ComponentModel:Wr,ComponentView:vn,List:Es,Model:Si,PRIORITY:R9,SeriesModel:Xi,color:qle,connect:Npe,dataTool:jpe,dependencies:ype,disConnect:Bpe,disconnect:F9,dispose:zpe,env:Gr,extendChartView:pve,extendComponentModel:hve,extendComponentView:fve,extendSeriesModel:dve,format:eve,getCoordinateSystemDimensions:Vpe,getInstanceByDom:gL,getInstanceById:Fpe,getMap:Hpe,graphic:Jge,helper:Wge,init:Ope,innerDrawElementOnCanvas:hL,matrix:Mle,number:Kge,parseGeoJSON:A3,parseGeoJson:A3,registerAction:Lh,registerCoordinateSystem:H9,registerLayout:j9,registerLoading:bL,registerLocale:Xk,registerMap:$9,registerPostInit:V9,registerPostUpdate:U9,registerPreprocessor:mL,registerProcessor:yL,registerTheme:vL,registerTransform:W9,registerUpdateLifecycle:JC,registerVisual:Kg,setCanvasCreator:Upe,setPlatformAPI:Bj,throttle:KC,time:Qge,use:Vr,util:tve,vector:dle,version:mpe,zrUtil:ole,zrender:Pue},Symbol.toStringTag,{value:"Module"}));var Xd={},Zd={},UP={},t8;function nMe(){return t8||(t8=1,(function(r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var e=1,t=function(){return"".concat(e++)};r.default=t})(UP)),UP}var o1={},s1={},HP={},r8;function AZ(){return r8||(r8=1,(function(r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var e=function(i){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:60,a=null;return function(){for(var s=this,o=arguments.length,l=new Array(o),c=0;c<o;c++)l[c]=arguments[c];clearTimeout(a),a=setTimeout(function(){i.apply(s,l)},n)}};r.default=e})(HP)),HP}var qd={},i8;function kO(){if(i8)return qd;i8=1,Object.defineProperty(qd,"__esModule",{value:!0}),qd.SizeSensorId=qd.SensorTabIndex=qd.SensorClassName=void 0;var r="size-sensor-id";qd.SizeSensorId=r;var e="size-sensor-object";qd.SensorClassName=e;var t="-1";return qd.SensorTabIndex=t,qd}var n8;function aMe(){if(n8)return s1;n8=1,Object.defineProperty(s1,"__esModule",{value:!0}),s1.createSensor=void 0;var r=t(AZ()),e=kO();function t(n){return n&&n.__esModule?n:{default:n}}var i=function(a,s){var o=void 0,l=[],c=function(){getComputedStyle(a).position==="static"&&(a.style.position="relative");var C=document.createElement("object");return C.onload=function(){C.contentDocument.defaultView.addEventListener("resize",f),f()},C.style.display="block",C.style.position="absolute",C.style.top="0",C.style.left="0",C.style.height="100%",C.style.width="100%",C.style.overflow="hidden",C.style.pointerEvents="none",C.style.zIndex="-1",C.style.opacity="0",C.setAttribute("class",e.SensorClassName),C.setAttribute("tabindex",e.SensorTabIndex),C.type="text/html",a.appendChild(C),C.data="about:blank",C},f=(0,r.default)(function(){l.forEach(function(S){S(a)})}),p=function(C){o||(o=c()),l.indexOf(C)===-1&&l.push(C)},y=function(){o&&o.parentNode&&(o.contentDocument&&o.contentDocument.defaultView.removeEventListener("resize",f),o.parentNode.removeChild(o),a.removeAttribute(e.SizeSensorId),o=void 0,l=[],s&&s())},b=function(C){var E=l.indexOf(C);E!==-1&&l.splice(E,1),l.length===0&&o&&y()};return{element:a,bind:p,destroy:y,unbind:b}};return s1.createSensor=i,s1}var l1={},a8;function oMe(){if(a8)return l1;a8=1,Object.defineProperty(l1,"__esModule",{value:!0}),l1.createSensor=void 0;var r=kO(),e=t(AZ());function t(n){return n&&n.__esModule?n:{default:n}}var i=function(a,s){var o=void 0,l=[],c=(0,e.default)(function(){l.forEach(function(S){S(a)})}),f=function(){var C=new ResizeObserver(c);return C.observe(a),c(),C},p=function(C){o||(o=f()),l.indexOf(C)===-1&&l.push(C)},y=function(){o.disconnect(),l=[],o=void 0,a.removeAttribute(r.SizeSensorId),s&&s()},b=function(C){var E=l.indexOf(C);E!==-1&&l.splice(E,1),l.length===0&&o&&y()};return{element:a,bind:p,destroy:y,unbind:b}};return l1.createSensor=i,l1}var o8;function sMe(){if(o8)return o1;o8=1,Object.defineProperty(o1,"__esModule",{value:!0}),o1.createSensor=void 0;var r=aMe(),e=oMe(),t=typeof ResizeObserver<"u"?e.createSensor:r.createSensor;return o1.createSensor=t,o1}var s8;function lMe(){if(s8)return Zd;s8=1,Object.defineProperty(Zd,"__esModule",{value:!0}),Zd.removeSensor=Zd.getSensor=Zd.Sensors=void 0;var r=i(nMe()),e=sMe(),t=kO();function i(l){return l&&l.__esModule?l:{default:l}}var n={};Zd.Sensors=n;function a(l){l&&n[l]&&delete n[l]}var s=function(c){var f=c.getAttribute(t.SizeSensorId);if(f&&n[f])return n[f];var p=(0,r.default)();c.setAttribute(t.SizeSensorId,p);var y=(0,e.createSensor)(c,function(){return a(p)});return n[p]=y,y};Zd.getSensor=s;var o=function(c){var f=c.element.getAttribute(t.SizeSensorId);c.destroy(),a(f)};return Zd.removeSensor=o,Zd}var l8;function uMe(){if(l8)return Xd;l8=1,Object.defineProperty(Xd,"__esModule",{value:!0}),Xd.ver=Xd.clear=Xd.bind=void 0;var r=lMe(),e=function(a,s){var o=(0,r.getSensor)(a);return o.bind(s),function(){o.unbind(s)}};Xd.bind=e;var t=function(a){var s=(0,r.getSensor)(a);(0,r.removeSensor)(s)};Xd.clear=t;var i="1.0.2";return Xd.ver=i,Xd}var u8=uMe();function c8(r,e){var t={};return e.forEach(function(i){t[i]=r[i]}),t}function jP(r){return typeof r=="function"}function cMe(r){return typeof r=="string"}var $P,h8;function hMe(){return h8||(h8=1,$P=function r(e,t){if(e===t)return!0;if(e&&t&&typeof e=="object"&&typeof t=="object"){if(e.constructor!==t.constructor)return!1;var i,n,a;if(Array.isArray(e)){if(i=e.length,i!=t.length)return!1;for(n=i;n--!==0;)if(!r(e[n],t[n]))return!1;return!0}if(e.constructor===RegExp)return e.source===t.source&&e.flags===t.flags;if(e.valueOf!==Object.prototype.valueOf)return e.valueOf()===t.valueOf();if(e.toString!==Object.prototype.toString)return e.toString()===t.toString();if(a=Object.keys(e),i=a.length,i!==Object.keys(t).length)return!1;for(n=i;n--!==0;)if(!Object.prototype.hasOwnProperty.call(t,a[n]))return!1;for(n=i;n--!==0;){var s=a[n];if(!r(e[s],t[s]))return!1}return!0}return e!==e&&t!==t}),$P}var fMe=hMe();const o0=gD(fMe);var dMe=(function(r){Ye(e,r);function e(t){var i=r.call(this,t)||this;return i.echarts=t.echarts,i.ele=null,i.isInitialResize=!0,i}return e.prototype.componentDidMount=function(){this.renderNewEcharts()},e.prototype.componentDidUpdate=function(t){var i=this.props.shouldSetOption;if(!(jP(i)&&!i(t,this.props))){if(!o0(t.theme,this.props.theme)||!o0(t.opts,this.props.opts)||!o0(t.onEvents,this.props.onEvents)){this.dispose(),this.renderNewEcharts();return}var n=["option","notMerge","lazyUpdate","showLoading","loadingOption"];o0(c8(this.props,n),c8(t,n))||this.updateEChartsOption(),(!o0(t.style,this.props.style)||!o0(t.className,this.props.className))&&this.resize()}},e.prototype.componentWillUnmount=function(){this.dispose()},e.prototype.getEchartsInstance=function(){return this.echarts.getInstanceByDom(this.ele)||this.echarts.init(this.ele,this.props.theme,this.props.opts)},e.prototype.dispose=function(){if(this.ele){try{u8.clear(this.ele)}catch(t){console.warn(t)}this.echarts.dispose(this.ele)}},e.prototype.renderNewEcharts=function(){var t=this,i=this.props,n=i.onEvents,a=i.onChartReady,s=this.updateEChartsOption();this.bindEvents(s,n||{}),jP(a)&&a(s),this.ele&&u8.bind(this.ele,function(){t.resize()})},e.prototype.bindEvents=function(t,i){function n(s,o){cMe(s)&&jP(o)&&t.on(s,function(l){o(l,t)})}for(var a in i)Object.prototype.hasOwnProperty.call(i,a)&&n(a,i[a])},e.prototype.updateEChartsOption=function(){var t=this.props,i=t.option,n=t.notMerge,a=n===void 0?!1:n,s=t.lazyUpdate,o=s===void 0?!1:s,l=t.showLoading,c=t.loadingOption,f=c===void 0?null:c,p=this.getEchartsInstance();return p.setOption(i,a,o),l?p.showLoading(f):p.hideLoading(),p},e.prototype.resize=function(){var t=this.getEchartsInstance();if(!this.isInitialResize)try{t.resize()}catch(i){console.warn(i)}this.isInitialResize=!1},e.prototype.render=function(){var t=this,i=this.props,n=i.style,a=i.className,s=a===void 0?"":a,o=CR({height:300},n);return IZ.createElement("div",{ref:function(l){t.ele=l},style:o,className:"echarts-for-react "+s})},e})(so.PureComponent),pMe=(function(r){Ye(e,r);function e(t){var i=r.call(this,t)||this;return i.echarts=iMe,i}return e})(dMe);const gMe=({trackPoints:r,missionColor:e="#ff5500",onMouseOver:t,onMouseLeave:i})=>{const n=so.useRef(null),{alt:a,time_boot_ms:s}=r;if(so.useEffect(()=>()=>{if(n.current)try{n.current.getEchartsInstance()?.dispose()}catch(C){console.warn("Error disposing ECharts instance:",C)}},[]),!a||!s||a.length===0||s.length===0)return pn.jsx("div",{style:{height:"300px",display:"flex",alignItems:"center",justifyContent:"center",backgroundColor:"#f5f5f5",border:"1px solid #ddd",borderRadius:"8px",color:"#666"},children:"No hay datos de altura disponibles"});const o=Math.min(a.length,s.length);if(o===0)return pn.jsx("div",{style:{height:"300px",display:"flex",alignItems:"center",justifyContent:"center",backgroundColor:"#f5f5f5",border:"1px solid #ddd",borderRadius:"8px",color:"#666"},children:"No hay datos válidos para mostrar"});const l=s.slice(0,o),c=a.slice(0,o),f=Math.min(...l),y=[...l.map(C=>(C-f)/1e3)],b=[...c],S={title:{text:"Altura del Vuelo",left:"center",textStyle:{fontSize:16,fontWeight:"bold"}},tooltip:{trigger:"axis"},grid:{left:"3%",right:"4%",bottom:"3%",containLabel:!0},xAxis:{type:"category",data:y,name:"Tiempo (s)",nameLocation:"middle",nameGap:30,axisLabel:{formatter:"{value}s"}},yAxis:{type:"value",name:"Altura (m)",nameLocation:"middle",nameGap:50,axisLabel:{formatter:"{value}m"}},series:[{name:"Altura",type:"line",data:b,smooth:!0,lineStyle:{color:e,width:2},itemStyle:{color:e},areaStyle:{color:{type:"linear",x:0,y:0,x2:0,y2:1,colorStops:[{offset:0,color:`${e}40`},{offset:1,color:`${e}10`}]}}}]};return pn.jsx("div",{style:{width:"100%",height:"300px"},children:pn.jsx(pMe,{ref:n,option:S,style:{height:"100%",width:"100%"},opts:{renderer:"canvas"},notMerge:!0,onEvents:{showTip:C=>{if(t&&C.dataIndex!==void 0){const E=C.dataIndex,P=y[E],O=b[E];t({time:P,altitude:O,index:E})}},mouseout:()=>{i&&i()}}})})};function vMe(){const[,r]=so.useState(null),[e,t]=so.useState([]),[i,n]=so.useState(null),[a,s]=so.useState(null),o=()=>{const C=Math.floor(Math.random()*256),E=Math.floor(Math.random()*256),P=Math.floor(Math.random()*256);return`#${C.toString(16).padStart(2,"0")}${E.toString(16).padStart(2,"0")}${P.toString(16).padStart(2,"0")}`},l=C=>{const E=C.target.files?Array.from(C.target.files):[];E.length!==0&&(r(E[0]),E.forEach(P=>{const O=`${Date.now()}-${Math.random().toString(36).slice(2)}`,B=o(),F={id:O,fileName:P.name,color:B,trackPoints:{lat:[],lng:[]},processing:!0};t(Q=>[F,...Q]);let W;const $=new Worker("parser.js",{type:"module"});$.onmessage=Q=>{if(Q.data.messageType==="POS"&&(W=Q.data.messageList),Q.data.hasOwnProperty("messagesDoneLoading")&&W){console.log("[aec]gpsData:",W);const ee=W.Lat[0]/10**7,te=W.Lng[0]/10**7;BZ(ee,te).then(ae=>{t(de=>{const ve=de.find(ye=>ye.id===O);return ve?(ve.trackPoints={lat:W.Lat,lng:W.Lng,alt:W.RelHomeAlt,time_boot_ms:W.time_boot_ms,color:F.color},ve.location=ae,ve.processing=!1,[...de]):de})})}};const q=new FileReader;q.onload=function(){const Q=q.result;$.postMessage({action:"parse",file:Q})},q.readAsArrayBuffer(P)}))},c=so.useMemo(()=>e.filter(C=>C.processing===!1).map(C=>({lat:C.trackPoints.lat[0]/10**7||0,lng:C.trackPoints.lng[0]/10**7||0,color:C.color,name:C.fileName})),[e]),f=so.useMemo(()=>{if(!i)return;const C=e.find(W=>W.id===i);if(!C)return;const E=C.trackPoints.lat||[],P=C.trackPoints.lng||[],O=C.trackPoints.alt||[],B=Math.min(E.length,P.length),F=[];for(let W=0;W<B;W++){const $=E[W]/1e7,q=P[W]/10**7,Q=O[W];F.push(Q!==void 0?{lat:$,lng:q,alt:Q}:{lat:$,lng:q})}return F},[e,i]),p=C=>{const E=e.find(P=>P.fileName===C.name&&P.color===C.color&&!P.processing);E&&n(E.id)},y=so.useMemo(()=>e.find(C=>C.id===i),[e,i]),b=C=>{if(!y||!y.trackPoints.lat||!y.trackPoints.lng)return;const E=y.trackPoints.lat,P=y.trackPoints.lng,O=y.trackPoints.alt||[],B=Math.min(E.length,P.length,O.length);for(let F=0;F<B;F++){const W=E[F]/1e7,$=P[F]/10**7;(O[F]||0)===C.altitude&&s({lat:W,lng:$,index:F})}},S=()=>{s(null)};return pn.jsxs("div",{className:"app",children:[pn.jsxs("div",{className:"sidepanel",children:[pn.jsxs("div",{className:"file-input-section",children:[pn.jsx("label",{htmlFor:"fileInput",className:"file-input-label",children:"Seleccionar archivo .bin"}),pn.jsx("input",{type:"file",id:"fileInput",accept:".bin",multiple:!0,onChange:l,className:"file-input"})]}),pn.jsxs("div",{className:"missions-section",children:[pn.jsx("h3",{children:"Misiones"}),e.map(C=>pn.jsx(jse,{fileName:C.fileName,color:C.color,trackPoints:C.trackPoints,location:C.location,processing:C.processing,isSelected:i===C.id,onSelect:()=>n(C.id)},C.id))]})]}),pn.jsxs("div",{className:"main",children:[pn.jsx("div",{className:"map-container",children:pn.jsx(Hse,{markers:c,className:"map",selectedTrack:f,hoverPosition:a,onMarkerClick:p})}),pn.jsx("div",{className:"chart-container",children:y&&pn.jsx(gMe,{trackPoints:y.trackPoints,missionColor:y.color,onMouseOver:b,onMouseLeave:S})})]})]})}NZ.createRoot(document.getElementById("root")).render(pn.jsx(so.StrictMode,{children:pn.jsx(vMe,{})}));
